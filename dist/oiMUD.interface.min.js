(()=>{function A(){bootstrap.Offcanvas.getInstance(document.getElementById("clientMenu")).hide()}function ne(){bootstrap.Offcanvas.getOrCreateInstance(document.getElementById("clientMenu")).show()}function K(){document.getElementById("btn-menu").addEventListener("click",ne),client.on("connected",()=>{let o=document.getElementById("menu-connect"),s=document.querySelector("#menu-connect a span"),e=document.querySelector("#menu-connect svg")||document.querySelector("#menu-connect i");o.title="Disconnect",o.classList.add("active"),s.textContent="Disconnect",e.classList.add("fa-plug-circle-xmark"),e.classList.remove("fa-plug")}),client.on("closed",()=>{let o=document.getElementById("menu-connect"),s=document.querySelector("#menu-connect a span"),e=document.querySelector("#menu-connect svg")||document.querySelector("#menu-connect i");o.title="Connect",o.classList.remove("active"),s.textContent="Connect",e.classList.remove("fa-plug-circle-xmark"),e.classList.add("fa-plug")}),client.on("scroll-lock",j),document.querySelector("#menu-connect a").addEventListener("click",o=>{client.connected?client.close():(client.connect(),A())}),document.querySelector("#menu-clear a").addEventListener("click",o=>{client.clear(),A()}),document.querySelector("#menu-lock a").addEventListener("click",o=>{client.toggleScrollLock(),A()}),document.querySelector("#menu-editor a").addEventListener("click",o=>{A(),document.getElementById("btn-adv-editor").click()}),document.querySelector("#menu-fullscreen a").addEventListener("click",o=>{var s=window.document,e=s.documentElement,t=e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullScreen||e.msRequestFullscreen,i=s.exitFullscreen||s.mozCancelFullScreen||s.webkitExitFullscreen||s.msExitFullscreen;let n=document.getElementById("menu-fullscreen"),r=document.querySelector("#menu-fullscreen svg")||document.querySelector("#menu-fullscreen i"),a=document.querySelector("#menu-fullscreen a span");!s.fullscreenElement&&!s.mozFullScreenElement&&!s.webkitFullscreenElement&&!s.msFullscreenElement?(n.title="Exit fullscreen",a.textContent="Exit fullscreen",t.call(e),r.classList.add("fa-minimize"),r.classList.remove("fa-maximize")):(n.title="Enter fullscreen",a.textContent="Enter fullscreen",i.call(s),r.classList.add("fa-maximize"),r.classList.remove("fa-minimize")),A()}),j()}function j(){let o=document.getElementById("menu-lock"),s=document.querySelector("#menu-lock a span"),e=document.querySelector("#menu-lock svg")||document.querySelector("#menu-lock i");client.scrollLock?(o.title="Unlock display",o.classList.add("active"),s.textContent="Unlock display",e.classList.add("fa-unlock"),e.classList.remove("fa-lock")):(o.title="Lock display",o.classList.remove("active"),s.textContent="Lock display",e.classList.remove("fa-unlock"),e.classList.add("fa-lock"))}var E=class{#e={};bind(s,e){(!Array.isArray(this.#e[s])||typeof this.#e[s]>"u")&&(this.#e[s]=[]),this.#e[s].push(e)}on(s,e){this.bind(s,e)}addEventListener(s,e){this.bind(s,e)}fire(s,e,t){if(!s||typeof s!="string")throw new Error("Event missing.");if(Array.isArray(this.#e[s])){!e||e===null||typeof e>"u"?e=[]:Array.isArray(e)||(e=[e]),t=t||this;for(var i=this.#e[s],n=0,r=i.length;n<r;n++)i[n].apply(t,e)}}emit(s,...e){this.fire(s,e)}dispatchEvent(s,e,t){this.fire(s,e,t)}unbind(s,e){if(!s||!e||!Array.isArray(this.#e[s]))return;let t=this.#e[s];for(let i=0,n=t.length;i<n;i++)if(t[i]===e){t.splice(i,1);break}}remove(s,e){this.unbind(s,e)}off(s,e){this.unbind(s,e)}removeListener(s,e){this.unbind(s,e)}removeAllListeners(s){if(!s){this.#e=[];return}Array.isArray(this.#e[s])&&delete this.#e[s]}listeners(s){return s?this.#e[s]||[]:this.#e}};Array.prototype.filter||(Array.prototype.filter=function(o){var s=this.length>>>0;if(typeof o!="function")throw new TypeError;for(var e=[],t=arguments[1],i=0;i<s;i++)if(i in this){var n=this[i];o.call(t,n,i,this)&&e.push(n)}return e});var V=document.createElement("div");function X(o){return V.textContent=o,V.innerHTML}var D=class{constructor(s){this.length=0;typeof s=="string"&&s.length>0?this.buffer=[s]:this.buffer=[],this.length=0}prepend(s){return this.buffer.unshift(s),this.length+=s.length,this}append(s){return this.buffer.push(s),this.length+=s.length,this}push(s){typeof s=="number"?this.appendCode(s):this.append(s)}appendCode(s){return this.buffer.push(String.fromCharCode(s)),this.length++,this}toString(){return this.buffer.join("")}clear(s){return this.buffer=[],this.length=0,s&&typeof s<"u"&&s.length&&(this.buffer.push(s),this.length=s.length),this}concat(s){this.buffer=this.buffer.concat(s)}};(function(o){o.fn.hasHorizontalScrollBar=function(){return o(this)[0].scrollWidth>o(this).innerWidth()}})(jQuery);CanvasRenderingContext2D.prototype.fillRoundedRect=function(o,s,e,t,i){this.beginPath(),this.moveTo(o+i,s),this.lineTo(o+e-i,s),this.quadraticCurveTo(o+e,s,o+e,s+i),this.lineTo(o+e,s+t-i),this.quadraticCurveTo(o+e,s+t,o+e-i,s+t),this.lineTo(o+i,s+t),this.quadraticCurveTo(o,s+t,o,s+t-i),this.lineTo(o,s+i),this.quadraticCurveTo(o,s,o+i,s),this.closePath(),this.fill()};CanvasRenderingContext2D.prototype.strokeRoundedRect=function(o,s,e,t,i){this.beginPath(),this.moveTo(o+i,s),this.lineTo(o+e-i,s),this.quadraticCurveTo(o+e,s,o+e,s+i),this.lineTo(o+e,s+t-i),this.quadraticCurveTo(o+e,s+t,o+e-i,s+t),this.lineTo(o+i,s+t),this.quadraticCurveTo(o,s+t,o,s+t-i),this.lineTo(o,s+i),this.quadraticCurveTo(o,s,o+i,s),this.closePath(),this.stroke()};Object.keys||(Object.keys=function(o){if(o!==Object(o))throw new TypeError("Object.keys called on a non-object");var s=[],e;for(e in o)Object.prototype.hasOwnProperty.call(o,e)&&s.push(e);return s});Object.toType||(Object.toType=function(o){return{}.toString.call(o).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()});typeof String.prototype.startsWith!="function"&&(String.prototype.startsWith=function(o){return this.slice(0,o.length)==o});typeof String.prototype.endsWith!="function"&&(String.prototype.endsWith=function(o){return this.slice(-o.length)==o});typeof String.prototype.splice!="function"&&(String.prototype.splice=function(o,s,e){return typeof e>"u"&&(e=0),this.slice(0,o)+s+this.slice(o+Math.abs(e))});typeof String.prototype.padStart!="function"&&(String.prototype.padStart=function(o){return typeof o=="number"&&(o=" ".repeat(o)),String(o+this).slice(-o.length)});typeof String.prototype.padEnd!="function"&&(String.prototype.padEnd=function(o){return typeof o=="number"?o<=this.length?this:(o=" ".repeat(o-this.length),this+o):o.length<=this.length?this:this+o.slice(-this.length)});String.prototype.replaceAll||(String.prototype.replaceAll=function(o,s){return Object.prototype.toString.call(o).toLowerCase()==="[object regexp]"?this.replace(o,s):this.replace(new RegExp(o,"g"),s)});typeof Uint8Array.prototype.charAt!="function"&&(Uint8Array.prototype.charAt=function(o){return String.fromCharCode(this[o])});typeof Uint8Array.prototype.charCodeAt!="function"&&(Uint8Array.prototype.charCodeAt=function(o){return this[o]});function se(o,s){return!o||!o.length?o:s?o.replace(/\\/g,"\\\\").replace(/\u0008/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/'/g,"\\'").replace(/"/g,'\\"').replace(/\u0000/g,"\\0"):o.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/"/g,'\\"')}String.prototype.addSlashes=function(){return se(this)};String.prototype.splitQuote=function(o,s,e,t){if(this.length===0)return[];if(!o||!o.length)return[this];s||(s=3),e||(e=3),t||(t="\\");let i=!1,n=!1,r=[],a=0,c=0,d,l="",u,v=o.length,F,w=this.length;for(;c<w;c++){if(d=this.charAt(c),d==='"'&&(s&2)===2)(e&2)===2?(c===0||l!==t)&&(i=!i):i=!i;else if(d==="'"&&(s&1)===1)(e&1)===1?(c===0||l!==t)&&(n=!n):n=!n;else if(!i&&!n){for(u=0;u<v;u++)if(F=o.charAt(u),d===F)if(c>a||c===0){r.push(this.substr(a,c-a)),a=c+1;break}else if(c===a){r.push(""),a=c+1;break}else c===w-1&&r.push("")}l=d}return c===w&&c===a&&o.indexOf(l)!==-1&&(r.push(""),a=c+1),c>a&&r.push(this.substr(a,c-a)),r};var f;function M(o){o=o||"",o=o.split("%^"),f||ae();let s=[],e=[],t=0,i=o.length,n=!1,r=!1,a=[];for(;t<i;t++)switch(o[t]){case"ITALIC":s.push("<em>"),e.push("</em>");break;case"UNDERLINE":a.push("underline");break;case"STRIKEOUT":a.push("strikeout");break;case"DBLUNDERLINE":a.push("dblunderline");break;case"OVERLINE":a.push("overline");break;case"FLASH":a.push("noflash");break;case"REVERSE":a.push("reverse");break;case"RESET":case"DEFAULT":let c=e.length;for(let d=0;d<c;d++)s.push(e[d]);e=[],a=[];break;case"BOLD":n=!0;break;case"":break;default:if(o[t].startsWith("B_")){o[t]=o[t].substr(2),n&&(s.push('<span style="border: inherit;text-decoration:inherit;color: #'+f["BOLD%^%^WHITE"]+'">'),e.push("</span>")),s.push('<span style="border: inherit;text-decoration:inherit;background-color: #'+f[o[t]]+'">'),e.push("</span>"),n=!1;continue}else if(f[o[t]]){if(n&&!f["BOLD%^%^"+o[t]])s.push('<span style="border: inherit;text-decoration:inherit;color: #'+f["BOLD%^%^WHITE"]+'">'),e.push("</span>"),r=!0;else if(n){s.push('<span style="border: inherit;text-decoration:inherit;color: #'+f["BOLD%^%^"+o[t]]+'">'),e.push("</span>"),r=!0;continue}s.push('<span style="border: inherit;text-decoration:inherit;color: #'+f[o[t]]+'">'),e.push("</span>");continue}else n&&!r&&(s.push('<span style="border: inherit;text-decoration:inherit;color: #'+f["BOLD%^%^WHITE"]+'">'),e.push("</span>"));a.length&&(s.push('<span class="'+a.join(" ")+'">'),e.push("</span>"),a=[]),s.push(o[t]),n=!1,r=!1;break}for(a.length&&(s.push('<span class="'+a.join(" ")+'">'),e.push("</span>")),t=0,i=e.length;t<i;t++)s.push(e[t]);return s.join("")}function ae(){let o,s,e,t,i,n;for(f={},f.BLACK="000000",f.RED="800000",f.GREEN="008000",f.ORANGE="808000",f.BLUE="0000EE",f.MAGENTA="800080",f.CYAN="008080",f.WHITE="BBBBBB",f.mono11="808080",f["BOLD%^%^RED"]="FF0000",f["BOLD%^%^GREEN"]="00FF00",f.YELLOW="FFFF00",f["BOLD%^%^YELLOW"]="FFFF00",f["BOLD%^%^BLUE"]="5C5CFF",f["BOLD%^%^MAGENTA"]="FF00FF",f["BOLD%^%^CYAN"]="00FFFF",f["BOLD%^%^WHITE"]="FFFFFF",f["BOLD%^%^BLACK"]="808080",e=0;e<6;e++)for(t=0;t<6;t++)for(i=0;i<6;i++)n=`RGB${e}${t}${i}`,s="",o=0,o=e*40+55,o<16&&(s+="0"),s+=o.toString(16),o=0,o=t*40+55,o<16&&(s+="0"),s+=o.toString(16),o=0,o=i*40+55,o<16&&(s+="0"),s+=o.toString(16),f[n]||(f[n]=s.toUpperCase());for(e=232;e<=255;e++)t=(e-232)*10+8,t<16?t="0"+t.toString(16).toUpperCase():t=t.toString(16).toUpperCase(),t=t+t+t,e<242?f["mono0"+(e-232)]=t:f["mono"+(e-232)]=t}function Q(){let o=[],s,e,t,i;for(s=0;s<6;s++)for(e=0;e<6;e++)for(t=0;t<6;t++)i=16+s*36+e*6+t,o[i]="rgb(",s>0?o[i]+=s*40+55:o[i]+="0",o[i]+=",",e>0?o[i]+=e*40+55:o[i]+="0",o[i]+=",",t>0?o[i]+=t*40+55:o[i]+="0",o[i]+=")";for(s=232;s<=255;s++)e=(s-232)*10+8,o[s]=["rgb(",e,",",e,",",e,")"].join("");return o[0]="rgb(0,0,0)",o[1]="rgb(128, 0, 0)",o[2]="rgb(0, 128, 0)",o[3]="rgb(128, 128, 0)",o[4]="rgb(0, 0, 238)",o[5]="rgb(128, 0, 128)",o[6]="rgb(0, 128, 128)",o[7]="rgb(187, 187, 187)",o[8]="rgb(128, 128, 128)",o[9]="rgb(255, 0, 0)",o[10]="rgb(0, 255, 0)",o[11]="rgb(255, 255, 0)",o[12]="rgb(92, 92, 255)",o[13]="rgb(255, 0, 255)",o[14]="rgb(0, 255, 255)",o[15]="rgb(255, 255, 255)",o[256]="rgb(0, 0, 0)",o[257]="rgb(118, 0, 0)",o[258]="rgb(0, 108, 0)",o[259]="rgb(145, 136, 0)",o[260]="rgb(0, 0, 167)",o[261]="rgb(108, 0, 108)",o[262]="rgb(0, 108, 108)",o[263]="rgb(161, 161, 161)",o[264]="rgb(0, 0, 0)",o[265]="rgb(128, 0, 0)",o[266]="rgb(0, 128, 0)",o[267]="rgb(128, 128, 0)",o[268]="rgb(0, 0, 238)",o[269]="rgb(128, 0, 128)",o[270]="rgb(0, 128, 128)",o[271]="rgb(187, 187, 187)",o[272]="rgb(0,0,0)",o[273]="rgb(0, 255, 255)",o[274]="rgb(0,0,0)",o[275]="rgb(255, 255, 0)",o[276]="rgb(0, 0, 0)",o[277]="rgb(229, 229, 229)",o[278]="rgb(205, 0, 0)",o[279]="rgb(229, 229, 229)",o[280]="rgb(255,255,255)",o}function W(o,s){if(!o)return;let e=document.activeElement;(!e||e!=o)&&o.focus(),document.execCommand("insertText",!1,s),e&&e!=o&&e.focus()}Array.isArray||(Array.isArray=function(o){return Object.prototype.toString.call(o)==="[object Array]"});function P(o){return new Promise(function(s,e){try{if(typeof navigator<"u"&&typeof navigator.clipboard<"u"&&typeof navigator.permissions<"u"){var t=new Blob([o],{type:"text/plain"}),i=[new ClipboardItem({"text/plain":t})];navigator.permissions.query({name:"clipboardWrite"}).then(function(r){r.state==="granted"||r.state==="prompt"?navigator.clipboard.write(i).then(s,e).catch(e):e(new Error("Permission not granted!"))})}else if(document.queryCommandSupported&&document.queryCommandSupported("copy")){var n=document.createElement("textarea");n.value=o,n.textContent=o,n.style.position="fixed",n.style.width="2em",n.style.height="2em",n.style.padding="0",n.style.border="none",n.style.outline="none",n.style.boxShadow="none",n.style.background="transparent",document.body.appendChild(n),n.focus(),n.select();try{document.execCommand("copy"),document.body.removeChild(n),s(null)}catch(r){document.body.removeChild(n),e(r)}}else e(new Error("None of copying methods are supported by this browser!"))}catch(r){e(r)}})}function U(){return new Promise(function(o,s){try{if(typeof navigator<"u"&&typeof navigator.clipboard<"u"&&typeof navigator.permissions<"u")navigator.permissions.query({name:"clipboardRead"}).then(function(t){t.state==="granted"||t.state==="prompt"?navigator.clipboard.readText().then(o,s).catch(s):s(new Error("Permission not granted!"))});else if(document.queryCommandSupported&&document.queryCommandSupported("paste")){var e=document.createElement("textarea");e.style.position="fixed",e.style.width="2em",e.style.height="2em",e.style.padding="0",e.style.border="none",e.style.outline="none",e.style.boxShadow="none",e.style.background="transparent",document.body.appendChild(e),e.focus(),e.select();try{document.execCommand("paste",!1,null),o(e.value),document.body.removeChild(e)}catch(t){document.body.removeChild(e),s(t)}}else s(new Error("None of pasting methods are supported by this browser!"))}catch(t){s(t)}})}function le(){var o="download"in document.createElement("a"),s=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,e=window.URL||window.webkitURL||window.mozURL||window.msURL;navigator.saveBlob=navigator.saveBlob||navigator.msSaveBlob||navigator.mozSaveBlob||navigator.webkitSaveBlob,window.saveAs=window.saveAs||window.webkitSaveAs||window.mozSaveAs||window.msSaveAs;var t={"image/jpeg":!0,"image/png":!0,"image/gif":!0,"image/svg+xml":!0,"image/bmp":!0,"image/x-windows-bmp":!0,"image/webp":!0,"audio/wav":!0,"audio/mpeg":!0,"audio/webm":!0,"audio/ogg":!0,"video/mpeg":!0,"video/webm":!0,"video/ogg":!0,"text/plain":!0,"text/html":!0,"text/xml":!0,"application/xhtml+xml":!0,"application/json":!0};s&&(window.saveAs||navigator.saveBlob)?this.show=function(i,n,r){var a=new s;a.append(i);var c=a.getBlob(r||"application/octet-stream");n||(n="Download.bin"),window.saveAs?window.saveAs(c,n):navigator.saveBlob(c,n)}:s&&e?this.show=function(i,n,r){var a,c,d=new s;if(d.append(i),r||(r="application/octet-stream"),o){a=d.getBlob(r),c=e.createObjectURL(a);var l=document.createElement("a");l.setAttribute("href",c),l.setAttribute("download",n||"Download.bin");var u=document.createEvent("MouseEvents");u.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),l.dispatchEvent(u)}else t[r.split(";")[0]]===!0&&(r="application/octet-stream"),a=d.getBlob(r),c=e.createObjectURL(a),window.open(c,"_blank","");setTimeout(function(){e.revokeObjectURL(c)},250)}:Blob&&e?this.show=function(i,n,r){var a,c;if(r||(r="application/octet-stream"),a=new Blob([i],{type:r}),o){c=e.createObjectURL(a);var d=document.createElement("a");d.setAttribute("href",c),d.setAttribute("download",n||"Download.bin");var l=document.createEvent("MouseEvents");l.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),d.dispatchEvent(l)}else t[r.split(";")[0]]===!0&&(r="application/octet-stream"),c=e.createObjectURL(a),window.open(c,"_blank","");setTimeout(function(){e.revokeObjectURL(c)},250)}:/\bMSIE\b/.test(navigator.userAgent)||(this.show=function(i,n,r){r||(r="application/octet-stream"),t[r.split(";")[0]]===!0&&(r="application/octet-stream"),window.open("data:"+r+","+encodeURIComponent(i),"_blank","")})}window.fileSaveAs=new le;function ce(){var o,s;function e(t,i){var n=t.charCodeAt(s);if(!(n&128))o=n;else if((n&224)==192)o=(n&31)<<6|t.charCodeAt(s+1)&63,s+=1;else if((n&240)==224)o=(n&15)<<12|(t.charCodeAt(s+1)&63)<<6|t.charCodeAt(s+2)&63,s+=2;else if((n&248)==240)o=(n&7)<<18|(t.charCodeAt(s+1)&63)<<12|(t.charCodeAt(s+2)&63)<<6|t.charCodeAt(s+3)&63,s+=1;else return!1;return!0}this.decode=function(t){var i=new D,n=t.length;for(s=0;s<n;s++)e(t,n)&&i.appendCode(o);return i.toString()},this.decode2=function(t){var i=new D,n=t.length,r,a;for(r=0;r<n;r++){if(a=t.charCodeAt(r),a&128)if((a&224)==192)a=(a&31)<<6|t.charCodeAt(r+1)&63,r+=1;else if((a&240)==224)a=(a&15)<<12|(t.charCodeAt(r+1)&63)<<6|t.charCodeAt(r+2)&63,r+=2;else if((a&248)==240)a=(a&7)<<18|(t.charCodeAt(r+1)&63)<<12|(t.charCodeAt(r+2)&63)<<6|t.charCodeAt(r+3)&63,r+=1;else continue;i.appendCode(a)}return i.toString()}}window.UTF8=new ce;function S(o,s,e){return new Promise((t,i)=>{let n=document.createElement("dialog");if(typeof n.showModal!="function"){i("Browser does not support dialogs.");return}n.id="openFileDialog",n.style.zIndex="2000",n.style.height="155px",n.style.width="350px",n.innerHTML=`<div class="dialog-header" style="font-weight: bold"><button type="button" class="btn btn-close float-end btn-danger" data-dismiss="modal" onclick="document.getElementById('openFileDialog').close();"></button><div>${o||"Open file..."}</div></div><div class="dialog-body"><div class="m-3"><input class="form-control" type="file" id="openFileDialog-files"${s?" multiple":""} required${e&&e.length?' accept="'+e+'"':""}></div></div><div class="dialog-footer"><button id="openFileDialog-cancel" style="float: right" type="button" class="btn btn-default" onclick="document.getElementById('openFileDialog').close();">Cancel</button><button id="openFileDialog-ok" style="float: right" type="button" class="btn btn-primary">Ok</button></div>`,document.body.appendChild(n),n.addEventListener("close",r=>{r.target===n&&(document.body.removeChild(n),n.returnValue!=="file-ok"&&i("closed"))}),n.addEventListener("cancel",r=>{r.target===n&&(document.body.removeChild(n),n.returnValue!=="file-ok"&&i("canceled"))}),document.getElementById("openFileDialog-ok").addEventListener("click",()=>{let r=document.getElementById("openFileDialog-files");if(!r.files||r.files.length===0){r.classList.add("is-invalid");return}r.classList.remove("is-invalid"),n.close(),n.returnValue="files-ok",t(r.files)}),n.showModal()})}function T(o){return new Promise((s,e)=>{o||e(new Error("Invalid file"));var t=new FileReader;t.onerror=e,t.onload=i=>{s(i.target.result)},t.readAsText(o)})}var H={};function O(o,s,e){e=e||"default",clearTimeout(H[e]),H[e]=setTimeout(()=>{o(),delete H[e]},s)}var G=class extends E{constructor(e){super();this._state={x:0,y:0,height:0,width:0,zIndex:100,maximized:!1,show:0};this._resize={x:0,y:0,height:0,width:0,type:0,minHeight:150,minWidth:300,borderHeight:1,borderWidth:1};this._dragPosition={x:0,y:0};this._windowResize=()=>{O(()=>{let e=document.defaultView.getComputedStyle(this._dialog);this._state.x>window.innerWidth-16&&(this._state.x=window.innerWidth-16,this._dialog.style.left=this._state.x+"px"),this._state.y>window.innerHeight-16&&(this._state.y=window.innerHeight-16,this._dialog.style.top=this._state.y+"px"),this.emit("moved",this._state)},250,this._id+"dialogResize")};this.resizeDoDrag=e=>{let t;if((this._resize.type&1)===1&&(t=this._resize.width+e.clientX-this._resize.x,t>window.innerWidth&&(t=window.innerWidth),this._dialog.style.width=t+"px"),(this._resize.type&2)===2&&(t=this._resize.height+e.clientY-this._resize.y,t>window.innerWidth-16&&(t=window.innerHeight-16),this._dialog.style.height=t+"px"),(this._resize.type&8)===8){if(t=this._resize.height-e.clientY+this._resize.y-this._resize.borderHeight,t+this._resize.borderHeight>window.innerHeight&&(t=window.innerHeight),t+this._resize.borderHeight<=this._resize.minHeight){this._dialog.style.height=this._resize.minHeight+"px";return}this._dialog.style.height=t+"px",t=e.clientY,t>window.innerHeight&&(t=window.innerHeight),this._dialog.style.top=t+"px"}if((this._resize.type&4)===4){if(t=this._resize.width-e.clientX+this._resize.x-this._resize.borderWidth,t+this._resize.borderWidth>window.innerWidth&&(t=window.innerWidth),t+this._resize.borderWidth<=this._resize.minWidth){this._dialog.style.width=this._resize.minWidth+"px";return}this._dialog.style.width=t+"px",t=e.clientX,t>window.innerWidth&&(t=window.innerWidth),this._dialog.style.left=t+"px"}};this.resizeTouchDrag=e=>{if(!e.touches.length)return;let t;if((this._resize.type&1)===1&&(t=this._resize.width+e.touches[0].clientX-this._resize.x,t>window.innerWidth&&(t=window.innerWidth),this._dialog.style.width=t+"px"),(this._resize.type&2)===2&&(t=this._resize.height+e.touches[0].clientY-this._resize.y,t>window.innerWidth&&(t=window.innerHeight),this._dialog.style.height=t+"px"),(this._resize.type&8)===8){if(t=this._resize.height-e.touches[0].clientY+this._resize.y-this._resize.borderHeight,t+this._resize.borderHeight>window.innerHeight&&(t=window.innerHeight),t+this._resize.borderHeight<=this._resize.minHeight){this._dialog.style.height=this._resize.minHeight+"px";return}this._dialog.style.height=t+"px",t=e.touches[0].clientY,t>window.innerHeight&&(t=window.innerHeight),this._dialog.style.top=t+"px"}if((this._resize.type&4)===4){if(t=this._resize.width-e.touches[0].clientX+this._resize.x-this._resize.borderWidth,t+this._resize.borderWidth>window.innerWidth&&(t=window.innerWidth),t+this._resize.borderWidth<=this._resize.minWidth){this._dialog.style.width=this._resize.minWidth+"px";return}this._dialog.style.width=t+"px",t=e.touches[0].clientX,t>window.innerWidth&&(t=window.innerWidth),this._dialog.style.left=t+"px"}};this.resizeStopDrag=e=>{document.documentElement.removeEventListener("mousemove",this.resizeDoDrag),document.documentElement.removeEventListener("mouseup",this.resizeStopDrag),document.documentElement.removeEventListener("touchmove",this.resizeTouchDrag),document.documentElement.removeEventListener("touchend",this.resizeStopDrag);let t=document.defaultView.getComputedStyle(this._dialog);this._state.x=parseInt(t.left,10),this._state.width=parseInt(t.width,10),this._state.y=parseInt(t.top,10),this._state.height=parseInt(t.height,10),this._body.style.pointerEvents="",this.emit("resized",this._state)};this.dragMouseDown=e=>{this.maximized||(this._dragPosition.x=e.clientX,this._dragPosition.y=e.clientY,document.documentElement.addEventListener("mouseup",this.dragMouseUp),document.documentElement.addEventListener("mousemove",this.dragMouseMove),this._header.style.cursor="move")};this.dragTouchStart=e=>{this.maximized||(this._dragPosition.x=e.clientX,this._dragPosition.y=e.clientY,document.documentElement.addEventListener("touchend",this.dragMouseUp),document.documentElement.addEventListener("touchmove",this.dragTouchMove),this._header.style.cursor="move")};this.dragMouseMove=e=>{let t=this._dragPosition.x-e.clientX,i=this._dragPosition.y-e.clientY;this._dragPosition.x=e.clientX,this._dragPosition.y=e.clientY,this._state.x=this._dialog.offsetLeft-t,this._state.y=this._dialog.offsetTop-i,this._state.x>window.innerWidth-16&&(this._state.x=window.innerWidth-16),this._state.y>window.innerHeight-16&&(this._state.y=window.innerHeight-16),this._state.x<16-this._dialog.clientWidth&&(this._state.x=16-this._dialog.clientWidth),this._state.y<16-this._dialog.clientHeight&&(this._state.y=16-this._dialog.clientHeight),this._dialog.style.left=this._state.x+"px",this._dialog.style.top=this._state.y+"px"};this.dragTouchMove=e=>{if(!e.touches.length)return;let t=this._dragPosition.x-e.touches[0].clientX,i=this._dragPosition.y-e.touches[0].clientY;this._dragPosition.x=e.touches[0].clientX,this._dragPosition.y=e.touches[0].clientY,this._state.x=this._dialog.offsetLeft-t,this._state.y=this._dialog.offsetTop-i,this._state.x>window.innerWidth-16&&(this._state.x=window.innerWidth-16),this._state.y>window.innerHeight-16&&(this._state.y=window.innerHeight-16),this._state.x<16-this._dialog.clientWidth&&(this._state.x=16-this._dialog.clientWidth),this._state.y<16-this._dialog.clientHeight&&(this._state.y=16-this._dialog.clientHeight),this._dialog.style.left=this._state.x+"px",this._dialog.style.top=this._state.y+"px"};this.dragMouseUp=()=>{document.documentElement.removeEventListener("mouseup",this.dragMouseUp),document.documentElement.removeEventListener("mousemove",this.dragMouseMove),document.documentElement.removeEventListener("touchend",this.dragMouseUp),document.documentElement.removeEventListener("touchmove",this.dragTouchMove),this._header.style.cursor="";let e=document.defaultView.getComputedStyle(this._dialog);this._state.x=parseInt(e.left,10),this._state.width=parseInt(e.width,10),this._state.y=parseInt(e.top,10),this._state.height=parseInt(e.height,10),this.emit("moved",this._state)};this.moveable=!0;this.resizable=!0;this._maximizable=!0;e&&"type"in e&&e.type==1?(this._dialog=document.createElement("div"),this._dialog.open=!1):this._dialog=document.createElement("dialog"),typeof this._dialog.showModal!="function"&&(this._dialog.showModal=()=>{this._dialog.open||(this._dialog.style.display="block",this._dialog.style.visibility="visible",this._dialog.open=!0,this._state.show=2,this._dialog.dataset.show=""+this._state.show,this._dialog._keydown||(this._dialog._keydown=l=>{l.key==="Escape"&&l.srcElement.tagName!=="TEXTAREA"&&l.srcElement.tagName!=="INPUT"&&l.srcElement.tagName!=="SELECT"&&this.close()}),this._dialog.backdrop_||(this._dialog.backdrop_=document.createElement("div"),this._dialog.backdrop_.className="backdrop",this._dialog.backdrop_MouseEvent=function(l){if(this.hasAttribute("tabindex"))this.focus();else{var u=document.createElement("div");this.insertBefore(u,this.firstChild),u.tabIndex=-1,u.focus(),this.removeChild(u)}var v=document.createEvent("MouseEvents");v.initMouseEvent(l.type,l.bubbles,l.cancelable,window,l.detail,l.screenX,l.screenY,l.clientX,l.clientY,l.ctrlKey,l.altKey,l.shiftKey,l.metaKey,l.button,l.relatedTarget),this.dispatchEvent(v),l.stopPropagation()},this._dialog.backdrop_.addEventListener("mouseup",this._dialog.backdrop_MouseEvent.bind(this._dialog)),this._dialog.backdrop_.addEventListener("mousedown",this._dialog.backdrop_MouseEvent.bind(this._dialog)),this._dialog.backdrop_.addEventListener("click",this._dialog.backdrop_MouseEvent.bind(this._dialog))),this._dialog.parentNode.insertBefore(this._dialog.backdrop_,this._dialog.nextSibling),window.document.addEventListener("keydown",this._dialog._keydown))}),typeof this._dialog.show!="function"&&(this._dialog.show=()=>{this._dialog.open||(this._dialog.style.display="block",this._dialog.style.visibility="visible",this._dialog.open=!0,this._state.show=1,this._dialog.dataset.show=""+this._state.show)}),typeof this._dialog.close!="function"&&(this._dialog.close=()=>{this._dialog.style.display="",this._dialog.style.visibility="",this._dialog.open=!1,this._state.show=0,this._dialog.dataset.show=""+this._state.show,window.removeEventListener("resize",this._windowResize),this.emit("closed")}),this._dialog.dialog=this,e&&"id"in e&&e.id&&e.id.length?this._id=e.id:(!this._id||!this._id.length)&&(this._id="dialog"+new Date().getTime()),this._dialog.id=this._id,this._dialog.style.zIndex="100",this._dialog.style.margin="0",this._dialog.classList.add("dialog"),(!e||!e.noAdaptive)&&this._dialog.classList.add("adaptive"),e&&"moveable"in e&&(this.moveable=e.moveable),e&&"resizable"in e&&(this.resizable=e.resizable),e&&"maximizable"in e&&(this._maximizable=e.maximizable),typeof e?.height=="number"?this._dialog.style.height=e.height+"px":e?.height&&e?.height.length>0?this._dialog.style.height=e.height:this._dialog.style.height="480px",typeof e?.minHeight=="number"?this._dialog.style.minHeight=e.minHeight+"px":e?.minHeight&&e?.minHeight.length>0?this._dialog.style.minHeight=e.minHeight:this._dialog.style.minHeight="150px",typeof e?.minWidth=="number"?this._dialog.style.minWidth=e.minWidth+"px":e?.minWidth&&e?.minWidth.length>0?this._dialog.style.minWidth=e.minWidth:this._dialog.style.minWidth="300px",typeof e?.width=="number"?this._dialog.style.width=e.width+"px":e?.width&&e?.width.length>0?this._dialog.style.width=e.width:this._dialog.style.width="640px",typeof e?.y=="number"?this._dialog.style.top=e.y+"px":e?.y&&e?.y.length>0?this._dialog.style.top=e.y:this._dialog.style.top="0",typeof e?.x=="number"?this._dialog.style.left=e.x+"px":e?.x&&e?.x.length>0?this._dialog.style.left=e.x:this._dialog.style.left="0";let t="";if(e?.buttons&&(t+=`<button id="${this._id}-cancel" type="button" class="float-end btn btn-light" title="Cancel dialog">Cancel</button>
            <button id="${this._id}-ok" type="button" class="float-end btn btn-primary" title="Confirm dialog">Ok</button>`),this._dialog.innerHTML=`<div class="dialog-header">
        <button id="${this._id}-header-close" style="padding: 4px;" type="button" class="btn btn-close float-end btn-danger" data-dismiss="modal" title="Close window"></button>
        <button type="button" class="btn btn-light float-end maximize" id="${this._id}-max" title="Maximize window" style="padding: 0 4px;margin-top: -1px;"><i class="bi-arrows-fullscreen"></i></button>
        <div>${e?.title||""}</div>
    </div>
    <div class="dialog-body"></div>
    <div class="dialog-footer">${t}</div>`,this._dialog.querySelector(`#${this._id}-header-close`).addEventListener("click",()=>{this.close()}),this._dialog.querySelector(`#${this._id}-max`).addEventListener("click",()=>{this.maximized?this.restore():this.maximize()}),this._dialog.addEventListener("close",l=>{if(l.target!==this._dialog)return;let u={preventDefault:!1};if(this.emit("closing",u),u.preventDefault){l.preventDefault();return}document.body.removeChild(this._dialog),this._state.show=0,this._dialog.dataset.show=""+this._state.show,this._dialog.backdrop_&&this._dialog.parentNode.removeChild(this._dialog.backdrop_),this._dialog._keydown&&window.document.removeEventListener("keydown",this._dialog._keydown),window.removeEventListener("resize",this._windowResize),this.emit("closed")}),this._dialog.addEventListener("cancel",l=>{if(l.target!==this._dialog)return;let u={preventDefault:!1};if(this.emit("canceling",u),u.preventDefault){l.preventDefault();return}if(document.activeElement&&(document.activeElement.tagName==="TEXTAREA"||document.activeElement.tagName==="iNPUT"||document.activeElement.tagName==="SELECT")){l.preventDefault();return}this._dialog.open=!1,document.body.removeChild(this._dialog),this._state.show=0,this._dialog.dataset.show=""+this._state.show,this._dialog.backdrop_&&this._dialog.parentNode.removeChild(this._dialog.backdrop_),this._dialog._keydown&&window.document.removeEventListener("keydown",this._dialog._keydown),window.removeEventListener("resize",this._windowResize),this._dialog.returnValue!=="ok"&&this.emit("canceled")}),document.body.appendChild(this._dialog),this._maximizable?this._dialog.querySelector(`#${this._id}-max`).style.display="":this._dialog.querySelector(`#${this._id}-max`).style.display="none",e?.buttons&&(this._dialog.querySelector(`#${this._id}-cancel`).addEventListener("click",()=>{this.close()}),this._dialog.querySelector(`#${this._id}-ok`).addEventListener("click",()=>{let l={preventDefault:!1};this.emit("ok",l),!l.preventDefault&&(this._dialog.returnValue="ok",this._dialog.close())})),this._body=this._dialog.querySelector('[class="dialog-body"]'),this._title=this._dialog.querySelector('[class="dialog-header"] div'),this._footer=this._dialog.querySelector('[class="dialog-footer"]'),this._header=this._dialog.querySelector('[class="dialog-header"]'),this.resizable){this._dialog.classList.add("resizable");var i=document.createElement("div");i.className="resizer-right",this._dialog.appendChild(i),i.addEventListener("mousedown",l=>{this.initResize(l,1)},!1),i.addEventListener("touchstart",l=>{this.initResizeTouch(l,1)},{passive:!0});var n=document.createElement("div");n.className="resizer-bottom",this._dialog.appendChild(n),n.addEventListener("mousedown",l=>{this.initResize(l,2)},!1),n.addEventListener("touchstart",l=>{this.initResizeTouch(l,2)},{passive:!0});var r=document.createElement("div");r.className="resizer-se",this._dialog.appendChild(r),r.addEventListener("mousedown",l=>{this.initResize(l,3)},!1),r.addEventListener("touchstart",l=>{this.initResizeTouch(l,3)},{passive:!0}),r=document.createElement("div"),r.className="resizer-ne",this._dialog.appendChild(r),r.addEventListener("mousedown",l=>{this.initResize(l,9)},!1),r.addEventListener("touchstart",l=>{this.initResizeTouch(l,9)},{passive:!0}),r=document.createElement("div"),r.className="resizer-nw",this._dialog.appendChild(r),r.addEventListener("mousedown",l=>{this.initResize(l,12)},!1),r.addEventListener("touchstart",l=>{this.initResizeTouch(l,12)},{passive:!0}),r=document.createElement("div"),r.className="resizer-sw",this._dialog.appendChild(r),r.addEventListener("mousedown",l=>{this.initResize(l,6)},!1),r.addEventListener("touchstart",l=>{this.initResizeTouch(l,6)},{passive:!0});var a=document.createElement("div");a.className="resizer-left",this._dialog.appendChild(a),a.addEventListener("mousedown",l=>{this.initResize(l,4)},!1),a.addEventListener("touchstart",l=>{this.initResizeTouch(l,4)},{passive:!0});var c=document.createElement("div");c.className="resizer-top",this._dialog.appendChild(c),c.addEventListener("mousedown",l=>{this.initResize(l,8)},!1),c.addEventListener("touchstart",l=>{this.initResizeTouch(l,8)},{passive:!0})}this.moveable&&(this._dialog.addEventListener("mousedown",()=>{this.focus()}),this._header.addEventListener("mousedown",this.dragMouseDown),this._header.addEventListener("touchstart",this.dragTouchStart,{passive:!0}));let d=document.defaultView.getComputedStyle(this._dialog);this._state.x=this._resize.x=parseInt(d.left,10),this._state.width=this._resize.width=parseInt(d.width,10),this._state.y=this._resize.y=parseInt(d.top,10),this._state.height=this._resize.height=parseInt(d.height,10),e&&"noFooter"in e&&e.noFooter&&this.hideFooter(),e&&"maximized"in e&&e.maximized&&this.maximize(),e&&"showModal"in e&&e.showModal?this.showModal():e&&"show"in e&&e.show&&(e.show===2?this.showModal():this.show()),e&&"center"in e&&e.center&&this.center(),e&&"position"in e&&e.position>0&&this.position(e.position)}get maximizable(){return this._maximizable}set maximizable(e){e!==this._maximizable&&(this._maximizable=e,this.maximizable?this._dialog.querySelector(`#${this._id}-max`).style.display="":this._dialog.querySelector(`#${this._id}-max`).style.display="none")}set maximized(e){this._state.maximized!==e&&(this._state.maximized=e)}get maximized(){return this._state.maximized}initResize(e,t){if(this.maximized)return;let i=document.defaultView.getComputedStyle(this._dialog);this._resize.x=e.clientX,this._resize.width=parseInt(i.width,10),this._resize.y=e.clientY,this._resize.height=parseInt(i.height,10),this._resize.type=t,this._resize.minHeight=parseInt(i.minHeight,10),this._resize.minWidth=parseInt(i.minWidth,10),this._resize.borderHeight=e.offsetY+parseInt(i.borderTopWidth),this._resize.borderWidth=e.offsetX+parseInt(i.borderLeftWidth),this._body.style.pointerEvents="none",document.documentElement.addEventListener("mousemove",this.resizeDoDrag,!1),document.documentElement.addEventListener("mouseup",this.resizeStopDrag,!1)}initResizeTouch(e,t){if(!e.touches.length||this.maximized)return;let i=document.defaultView.getComputedStyle(this._dialog);this._resize.x=e.touches[0].clientX,this._resize.width=parseInt(i.width,10),this._resize.y=e.touches[0].clientY,this._resize.height=parseInt(i.height,10),this._resize.type=t,this._resize.minHeight=parseInt(i.minHeight,10),this._resize.minWidth=parseInt(i.minWidth,10);var n=e.target.getBoundingClientRect(),r=e.targetTouches[0].clientX-n.x,a=e.targetTouches[0].clientY-n.y;this._resize.borderHeight=a+parseInt(i.borderTopWidth),this._resize.borderWidth=r+parseInt(i.borderLeftWidth),this._body.style.pointerEvents="none",document.documentElement.addEventListener("touchmove",this.resizeTouchDrag,!1),document.documentElement.addEventListener("touchend",this.resizeStopDrag,!1)}get id(){return this._id}set id(e){if(this._id!==e&&(this._id=e,this._dialog)){let t=this._dialog.id;this._dialog.id=this._id;let i=this._dialog.querySelector(`#${this._id}-cancel`);i&&(i.id=this._id+"-cancel"),i=this._dialog.querySelector(`#${this._id}-ok`),i&&(i.id=this._id+"-ok"),i=this._dialog.querySelector(`#${this._id}-max`),i&&(i.id=this._id+"-max"),i=this._dialog.querySelector(`#${this._id}-header-close`),i&&(i.id=this._id+"-header-close")}}get title(){return this._title.innerHTML}set title(e){this._title.innerHTML=e}showModal(){if(this._dialog.parentElement||document.body.appendChild(this._dialog),this._dialog.open){this.focus();return}this._dialog.showModal(),this._state.show=2,this._dialog.dataset.show=""+this._state.show,window.addEventListener("resize",this._windowResize),this.emit("shown",!0),this.focus()}show(){if(this._dialog.parentElement||document.body.appendChild(this._dialog),this._dialog.open){this.focus();return}this._dialog.show(),this._state.show=1,this._dialog.dataset.show=""+this._state.show,window.addEventListener("resize",this._windowResize),this.emit("shown",!1),this.focus()}get opened(){return this._dialog.open}close(){this._dialog.open&&(this._dialog.backdrop_&&this._dialog.parentNode.removeChild(this._dialog.backdrop_),this._dialog._keydown&&window.document.removeEventListener("keydown",this._dialog._keydown),this._dialog.close())}get header(){return this._header}get body(){return this._body}get footer(){return this._footer}get dialog(){return this._dialog}get left(){return this._dialog.style.left}set left(e){this._dialog.style.left=e}get top(){return this._dialog.style.top}set top(e){this._dialog.style.top=e}get width(){return this._dialog.style.width}set width(e){this._dialog.style.width=e}get height(){return this._dialog.style.height}set height(e){this._dialog.style.top=e}get windowState(){return this._state}center(){this.position(48)}position(e){if(e<1)return;let t=this._dialog.clientWidth,i=this._dialog.clientHeight;if(!t||!i){let n=document.defaultView.getComputedStyle(this._dialog);t=t||parseInt(n.width,10),i=i||parseInt(n.height,10)}(e&4)===4?this._state.y=0:(e&8)===8?this._state.y=window.innerHeight-i:(e&16)===16&&(this._state.y=window.innerHeight/2-i/2),(e&1)===1?this._state.x=0:(e&2)===2?this._state.x=window.innerWidth-t:(e&32)===32&&(this._state.x=window.innerWidth/2-t/2),this._dialog.style.left=this._state.x+"px",this._dialog.style.top=this._state.y+"px",this._state.width=this._dialog.clientWidth,this._state.height=this._dialog.clientHeight,this.emit("moved",this._state)}maximize(){this.maximized||(this.maximized=!0,this._dialog.classList.add("maximized"),this._dialog.querySelector(`#${this._id}-max`).firstElementChild.classList.remove("bi-arrows-fullscreen"),this._dialog.querySelector(`#${this._id}-max`).firstElementChild.classList.add("bi-arrows-angle-contract"),this.emit("maximized"))}restore(){this.maximized&&(this.maximized=!1,this._dialog.classList.remove("maximized"),this._dialog.querySelector(`#${this._id}-max`).firstElementChild.classList.add("bi-arrows-fullscreen"),this._dialog.querySelector(`#${this._id}-max`).firstElementChild.classList.remove("bi-arrows-angle-contract"),this.emit("restored"))}getMaxZIndex(e){let t=document.getElementsByTagName("dialog"),i=0,n=t.length,r=parseInt(this._dialog.style.zIndex,10),a=[];for(;i<n;i++){if(!t[i].style.zIndex||!t[i].style.zIndex.length)continue;let c=parseInt(t[i].style.zIndex,10);c>r&&(r=c),a.push({z:c,idx:i,show:parseInt(t[i].dataset.show||"",10)||0})}if(this._state.zIndex=r,e||this._state.zIndex>1e3)for(this._state.zIndex=100,i=0,a.sort((c,d)=>c.show>d.show?1:c.z<d.z?-1:c.z>d.z?1:0);i<n;i++)t[a[i]].backdrop_&&(t[a[i]].backdrop_.style.zIndex=""+this._state.zIndex++),t[a[i].idx].style.zIndex=""+this._state.zIndex++}showFooter(){this._footer.style.display="",this._body.bottom=""}hideFooter(){this._footer.style.display="none",this._body.style.bottom="0"}focus(){this._dialog.focus(),this.getMaxZIndex(),this._dialog.style.zIndex=""+ ++this._state.zIndex,this.emit("focus")}};function y(o){this.ok=!1,o.charAt(0)=="#"&&(o=o.substr(1,6)),o=o.replace(/ /g,""),o=o.toLowerCase();var s={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var e in s)o==e&&(o=s[e]);for(var t=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(l){return[parseInt(l[1],10),parseInt(l[2],10),parseInt(l[3],10)]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(l){return[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(l){return[parseInt(l[1]+l[1],16),parseInt(l[2]+l[2],16),parseInt(l[3]+l[3],16)]}}],i=0,n=t.length;i<n;i++){var r=t[i].re,a=t[i].process,c=r.exec(o);if(c){var d=a(c);this.r=d[0],this.g=d[1],this.b=d[2],this.ok=!0}}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var l=this.r.toString(16),u=this.g.toString(16),v=this.b.toString(16);return l.length==1&&(l="0"+l),u.length==1&&(u="0"+u),v.length==1&&(v="0"+v),"#"+l+u+v}}var z=class extends E{constructor(e,t){super();this._simple=!0;this._init=!1;this.colorNames={"No color":"Default",BLACK:"Black",RED:"Maroon",GREEN:"Green",ORANGE:"Olive",BLUE:"Navy",MAGENTA:"Purple",WHITE:"Silver",CYAN:"Teal","BOLD BLACK":"Grey","BOLD RED":"Red","BOLD GREEN":"Lime",YELLOW:"Yellow","BOLD YELLOW":"Yellow","BOLD BLUE":"Blue","BOLD MAGENTA":"Fuchsia","BOLD CYAN":"Aqua",BOLD:"White","BOLD WHITE":"White",RGB000:"Black",RGB001:"Navy Blue",RGB002:"Dark Blue",RGB003:"Blue",RGB004:"Blue",RGB005:"Blue",RGB010:"Dark Green",RGB011:"Deep Sky Blue",RGB012:"Deep Sky Blue",RGB013:"Deep Sky Blue",RGB014:"Cobalt/Dodger Blue",RGB015:"Dodger Blue",RGB020:"Green",RGB021:"Spring Green",RGB022:"Turquoise",RGB023:"Deep Sky Blue",RGB024:"Deep Sky Blue",RGB025:"Dodger Blue",RGB030:"Green",RGB031:"Spring Green",RGB032:"Dark Cyan",RGB033:"Light Sea Green",RGB034:"Deep Sky Blue",RGB035:"Deep Sky Blue",RGB040:"Green",RGB041:"Spring Green",RGB042:"Spring Green",RGB043:"Cyan",RGB044:"Dark Turquoise",RGB045:"Turquoise",RGB050:"Green",RGB051:"Spring Green",RGB052:"Spring Green",RGB053:"Medium Spring Green",RGB054:"Cyan",RGB055:"Cyan",RGB100:"Dark Red",RGB101:"Deep Pink",RGB102:"Purple",RGB103:"Purple",RGB104:"Purple",RGB105:"Blue Violet",RGB110:"Orange",RGB111:"Dark Grey",RGB112:"Medium Purple",RGB113:"Slate Blue",RGB114:"Slate Blue",RGB115:"Royal Blue",RGB120:"Chartreuse",RGB121:"Dark Sea Green",RGB122:"Pale Turquoise",RGB123:"Steel Blue",RGB124:"Steel Blue",RGB125:"Cornflower Blue",RGB130:"Chartreuse",RGB131:"Dark Sea Green",RGB132:"Cadet Blue",RGB133:"Cadet Blue",RGB134:"Sky Blue",RGB135:"Steel Blue",RGB140:"Chartreuse",RGB141:"Pale Green",RGB142:"Sea Green",RGB143:"Aquamarine",RGB144:"Medium Turquoise",RGB145:"Steel Blue",RGB150:"Chartreuse",RGB151:"Sea Green",RGB152:"Sea Green",RGB153:"Sea Green",RGB154:"Aquamarine",RGB155:"Dark Slate Gray",RGB200:"Dark Red",RGB201:"Deep Pink",RGB202:"Dark Magenta",RGB203:"Dark Magenta",RGB204:"Dark Violet",RGB205:"Purple",RGB210:"Orange",RGB211:"Light Pink",RGB212:"Plum",RGB213:"Medium Purple",RGB214:"Medium Purple",RGB215:"Slate Blue",RGB220:"Yellow",RGB221:"Wheat",RGB222:"Grey",RGB223:"Light Slate Grey",RGB224:"Medium Purple",RGB225:"Light Slate Blue",RGB230:"Yellow",RGB231:"Dark Olive Green",RGB232:"Dark Sea Green",RGB233:"Light Sky Blue",RGB234:"Light Sky Blue",RGB235:"Sky Blue",RGB240:"Chartreuse",RGB241:"Dark Olive Green",RGB242:"Pale Green",RGB243:"Dark Sea Green",RGB244:"Dark Slate Gray",RGB245:"Sky Blue",RGB250:"Chartreuse",RGB251:"Light Green",RGB252:"Light Green",RGB253:"Pale Green",RGB254:"Aquamarine",RGB255:"Dark Slate Gray",RGB300:"Red",RGB301:"Deep Pink",RGB302:"Medium Violet Red",RGB303:"Magenta",RGB304:"Dark Violet",RGB305:"Purple",RGB310:"Dark Orange",RGB311:"Indian Red",RGB312:"Hot Pink",RGB313:"Medium Orchid",RGB314:"Medium Orchid",RGB315:"Medium Purple",RGB320:"Dark Goldenrod",RGB321:"Light Salmon",RGB322:"Rosy Brown",RGB323:"Grey",RGB324:"Medium Purple",RGB325:"Medium Purple",RGB330:"Gold",RGB331:"Dark Khaki",RGB332:"Navajo White",RGB333:"Grey",RGB334:"Light Steel Blue",RGB335:"Light Steel Blue",RGB340:"Yellow",RGB341:"Dark Olive Green",RGB342:"Dark Sea Green",RGB343:"Dark Sea Green",RGB344:"Light Cyan",RGB345:"Light Sky Blue",RGB350:"Green Yellow",RGB351:"Dark Olive Green",RGB352:"Pale Green",RGB353:"Dark Sea Green",RGB354:"Dark Sea Green",RGB355:"Pale Turquoise",RGB400:"Crimson/Red",RGB401:"Deep Pink",RGB402:"Deep Pink",RGB403:"Magenta",RGB404:"Magenta",RGB405:"Magenta",RGB410:"Dark Orange",RGB411:"Indian Red",RGB412:"Hot Pink",RGB413:"Hot Pink",RGB414:"Orchid",RGB415:"Medium Orchid",RGB420:"Orange",RGB421:"Light Salmon/Bronze",RGB422:"Light Pink",RGB423:"Pink",RGB424:"Plum",RGB425:"Violet",RGB430:"Gold",RGB431:"Light Goldenrod",RGB432:"Tan",RGB433:"Misty Rose",RGB434:"Thistle",RGB435:"Plum",RGB440:"Yellow",RGB441:"Khaki",RGB442:"Light Goldenrod",RGB443:"Light Yellow",RGB444:"Grey",RGB445:"Light Steel Blue",RGB450:"Yellow",RGB451:"Dark Olive Green",RGB452:"Dark Olive Green",RGB453:"Dark Sea Green",RGB454:"Honeydew",RGB455:"Light Cyan",RGB500:"Red",RGB501:"Deep Pink",RGB502:"Deep Pink",RGB503:"Deep Pink",RGB504:"Magenta",RGB505:"Magenta",RGB510:"Orangered",RGB511:"Indian Red",RGB512:"Indian Red",RGB513:"Hot Pink",RGB514:"Hot Pink",RGB515:"Medium Orchid",RGB520:"Dark Orange",RGB521:"Salmon",RGB522:"Light Coral",RGB523:"Pale Violet Red",RGB524:"Orchid",RGB525:"Orchid",RGB530:"Orange",RGB531:"Sandy Brown",RGB532:"Light Salmon",RGB533:"Light Pink",RGB534:"Pink",RGB535:"Plum",RGB540:"Gold",RGB541:"Light Goldenrod",RGB542:"Light Goldenrod",RGB543:"Navajo White",RGB544:"Misty Rose",RGB545:"Thistle",RGB550:"Yellow",RGB551:"Light Goldenrod",RGB552:"Khaki",RGB553:"Wheat",RGB554:"Corn Silk",RGB555:"White",mono00:"Grey 3",mono01:"Grey 7",mono02:"Grey 11",mono03:"Grey 15",mono04:"Grey 19",mono05:"Grey 23",mono06:"Grey 27",mono07:"Grey 30",mono08:"Grey 35",mono09:"Grey 39",mono10:"Grey 32",mono11:"Grey 46",mono12:"Grey 50",mono13:"Grey 54",mono14:"Grey 58",mono15:"Grey 62",mono16:"Grey 66",mono17:"Grey 70",mono18:"Grey 74",mono19:"Grey 78",mono20:"Grey 82",mono21:"Grey 85",mono22:"Grey 89",mono23:"Grey 93"};this.colorList=[];if(!e)throw new Error("AdvEditor must be a selector, element or jquery object");if(typeof e=="string"){if(this._element=document.querySelector(e),!this._element)throw new Error("Invalid selector for AdvEditor.")}else if(e instanceof $)this._element=e[0];else if(e instanceof HTMLElement)this._element=e;else throw new Error("AdvEditor must be a selector, element or jquery object");this.simple=!t}get id(){return this._element?this._element.id:""}get element(){return this._element}get simple(){return this._simple}set simple(e){e!==this._simple&&(this._simple=e,this.tinymceExist&&(e?this.remove():this.initialize()))}clear(){this.isSimple?this._element.value="":tinymce.activeEditor.setContent("")}get value(){return this.isSimple?this._element.value:this.getFormattedText().replace(/(?:\r)/g,"")}set value(e){this.isSimple?this._element.value=e:tinymce.activeEditor.setContent(e)}insert(e){if(this.isSimple)W(this._element,e);else{e=X(e),e=e.replace(/ /g,"&nbsp;"),e=e.replace(/\t/g,"&nbsp;&nbsp;&nbsp;"),e=e.replace(/(?:\r\n|\r|\n)/g,"<br/>");var t=this.getText();t===`
`?tinymce.activeEditor.undoManager.transact(()=>{tinymce.activeEditor.setContent(e)}):(t.endsWith(`
`)||(e="<br>"+e),tinymce.activeEditor.undoManager.transact(()=>{tinymce.activeEditor.dom.add(tinymce.activeEditor.getBody(),"span",{},e)}))}}get tinymceExist(){return typeof tinymce<"u"}get isSimple(){return this._simple||!this.tinymceExist}loadColors(){var e=Q(),t,i,n,r,a,c,d=[],l;this._ColorTable=[],this._colors={};var u=client.getOption("colors")||[];for(i=new y(u[0]||e[0]).toHex().substr(1).toUpperCase(),this._colors[i]="BLACK",this._ColorTable.push(i,"BLACK"),i=new y(u[1]||e[1]).toHex().substr(1).toUpperCase(),this._colors[i]="RED",this._ColorTable.push(i,"RED"),i=new y(u[2]||e[2]).toHex().substr(1).toUpperCase(),this._colors[i]="GREEN",this._ColorTable.push(i,"GREEN"),i=new y(u[3]||e[3]).toHex().substr(1).toUpperCase(),this._colors[i]="ORANGE",this._ColorTable.push(i,"ORANGE"),i=new y(u[4]||e[4]).toHex().substr(1).toUpperCase(),this._colors[i]="BLUE",this._ColorTable.push(i,"BLUE"),i=new y(u[5]||e[5]).toHex().substr(1).toUpperCase(),this._colors[i]="MAGENTA",this._ColorTable.push(i,"MAGENTA"),i=new y(u[6]||e[6]).toHex().substr(1).toUpperCase(),this._colors[i]="CYAN",this._ColorTable.push(i,"CYAN"),i=new y(u[7]||e[7]).toHex().substr(1).toUpperCase(),this._colors[i]="WHITE",this._ColorTable.push(i,"WHITE"),i=new y(u[8]||e[8]).toHex().substr(1).toUpperCase(),this._colors[i]="mono11",this._ColorTable.push(i,"BOLD BLACK"),d.push(i),i=new y(u[9]||e[9]).toHex().substr(1).toUpperCase(),this._colors[i]="BOLD%^%^RED",this._ColorTable.push(i,"BOLD RED"),d.push(i),i=new y(u[10]||e[10]).toHex().substr(1).toUpperCase(),this._colors[i]="BOLD%^%^GREEN",this._ColorTable.push(i,"BOLD GREEN"),d.push(i),i=new y(u[11]||e[11]).toHex().substr(1).toUpperCase(),this._colors[i]="BOLD%^%^YELLOW",this._ColorTable.push(i,"BOLD YELLOW"),d.push(i),i=new y(u[11]||e[11]).toHex().substr(1).toUpperCase(),this._colors[i]="YELLOW",this._ColorTable.push(i,"YELLOW"),d.push(i),i=new y(u[12]||e[12]).toHex().substr(1).toUpperCase(),this._colors[i]="BOLD%^%^BLUE",this._ColorTable.push(i,"BOLD BLUE"),d.push(i),i=new y(u[13]||e[13]).toHex().substr(1).toUpperCase(),this._colors[i]="BOLD%^%^MAGENTA",this._ColorTable.push(i,"BOLD MAGENTA"),d.push(i),i=new y(u[14]||e[14]).toHex().substr(1).toUpperCase(),this._colors[i]="BOLD%^%^CYAN",this._ColorTable.push(i,"BOLD CYAN"),d.push(i),i=new y(u[15]||e[15]).toHex().substr(1).toUpperCase(),this._colors[i]="BOLD%^%^WHITE",this._ColorTable.push(i,"BOLD WHITE"),n=0;n<6;n++)for(r=0;r<6;r++)for(a=0;a<6;a++)c=`RGB${n}${r}${a}`,i="",t=0,t=n*40+55,t<16&&(i+="0"),i+=t.toString(16),t=0,t=r*40+55,t<16&&(i+="0"),i+=t.toString(16),t=0,t=a*40+55,t<16&&(i+="0"),i+=t.toString(16),i=i.toUpperCase(),this._colors[i]||(this._colors[i]=c),this.colorList.push({color:c,hex:"#"+i,rgb:{r:n*40+55,g:r*40+55,b:a*40+55}});for(n=232;n<=255;n++)r=(n-232)*10+8,r<16?r="0"+r.toString(16).toUpperCase():r=r.toString(16).toUpperCase(),r=r+r+r,n<242?this._colors[r]||(this._colors[r]="mono0"+(n-232)):this._colors[r]||(this._colors[r]="mono"+(n-232));for(a=0,l=d.length;a<l;a++)this._colors["B"+d[a]]=this._colors[this.nearestHex("#"+d[a]).substr(1)].toUpperCase();this._colors.BFFFFFF="RGB555",tinymce.activeEditor.options.set("color_map",this._ColorTable)}initPlugins(){let e=this;tinymce.PluginManager.add("pinkfishtextcolor",function(t,i){let n="#000000",r=["000000","BLACK","800000","RED","008000","GREEN","808000","ORANGE","0000EE","BLUE","800080","MAGENTA","008080","CYAN","BBBBBB","WHITE","808080","BOLD BLACK","FF0000","BOLD RED","00FF00","BOLD GREEN","FFFF00","YELLOW","5C5CFF","BOLD YELLOW","5C5CFF","BOLD BLUE","FF00FF","BOLD MAGENTA","00FFFF","BOLD CYAN","FFFFFF","BOLD WHITE"],a,c=m=>{let h=m;return{get:()=>h,set:R=>{h=R}}},d=c(n),l=c(n),u=(m,h)=>{let p;return m.dom.getParents(m.selection.getStart(),B=>{let R;(R=B.style[h==="forecolor"?"color":"background-color"])&&(p=p||R)}),p},v=(m,h,p)=>{m.undoManager.transact(()=>{m.focus(),m.formatter.apply(h,{value:p}),m.nodeChanged()})},F=(m,h)=>{m.undoManager.transact(()=>{m.focus(),m.formatter.remove(h,{value:null},null,!0),m.nodeChanged()})},w=m=>{m.addCommand("mceApplyTextcolor",(h,p)=>{v(m,h,p)}),m.addCommand("mceRemoveTextcolor",h=>{F(m,h)}),m.addCommand("mceSetTextcolor",(h,p)=>{a&&(N(a,h==="forecolor"?"pinkfishforecolor":h,p),(h==="forecolor"?d:l).set(p))})},te=m=>{let h="choiceitem",p={type:h,text:"Remove color",icon:"color-swatch-remove-color",value:"remove"};return m?[p,{type:h,text:"Custom color",icon:"color-picker",value:"custom"}]:[p]},I=(m,h,p,B)=>{p==="custom"?e.openColorDialog(h,""):p==="remove"?(B(""),m.execCommand("mceRemoveTextcolor",h)):(B(p),m.execCommand("mceApplyTextcolor",h,p))},ie=m=>{let h=[];for(let p=0;p<m.length;p+=2)h.push({text:m[p+1],value:"#"+m[p],type:"choiceitem"});return h},oe=(m,h)=>ie(r).concat(te(h)),re=(m,h)=>p=>{p(oe(m,h))},N=(m,h,p)=>{let B=h==="pinkfishforecolor"?"tox-icon-text-color__color":"tox-icon-highlight-bg-color__color";m.setIconFill(B,p)},q=(m,h,p,B,R)=>{m.ui.registry.addSplitButton(h,{tooltip:B,presets:"color",icon:h==="pinkfishforecolor"?"text-color":"highlight-bg-color",select:_=>new y(u(m,p)||"").toHex().toLowerCase()===_.toLowerCase(),columns:5,fetch:re(r,!0),onAction:_=>{a=_,I(m,p,R.get(),()=>{})},onItemAction:(_,L)=>{a=_,I(m,p,L,x=>{R.set(x),m.fire("TextColorChange",{name:h,color:x})})},onSetup:_=>{N(_,h,R.get());let L=x=>{x.name===h&&N(_,x.name,x.color)};return m.on("TextColorChange",L),()=>{m.off("TextColorChange",L)}}})},Y=(m,h,p,B)=>{m.ui.registry.addNestedMenuItem(h,{text:B,icon:h==="pinkfishforecolor"?"text-color":"highlight-bg-color",getSubmenuItems:()=>[{type:"fancymenuitem",fancytype:"colorswatch",onAction:R=>{I(m,p,R.value,()=>{})}}]})};w(t),q(t,"pinkfishforecolor","forecolor","Text color",d),q(t,"pinkfishbackcolor","hilitecolor","Background color",l),Y(t,"pinkfishforecolor","forecolor","Text color"),Y(t,"pinkfishbackcolor","hilitecolor","Background color")}),tinymce.PluginManager.add("pinkfish",function(t){t.addCommand("mceApplyFormat",(r,a)=>{t.undoManager.transact(()=>{t.focus(),e.clearReverse($(".reverse",$(t.getDoc()).contents())),a?t.formatter.apply(r,{value:a}):t.formatter.apply(r),e.addReverse($(".reverse",$(t.getDoc()).contents())),t.nodeChanged()})}),t.addCommand("mceRemoveFormat",r=>{t.undoManager.transact(()=>{t.focus(),e.clearReverse($(".reverse",$(t.getDoc()).contents())),t.formatter.remove(r,{value:null},null,!0),e.addReverse($(".reverse",$(t.getDoc()).contents())),t.nodeChanged()})});function i(r,a){t.on("init",()=>{t.formatter.formatChanged(a,function(c){r.setActive(c)})})}function n(r){(!r||typeof r!="string")&&(r=this.settings.format),tinymce.activeEditor.undoManager.transact(()=>{$("#tinymce",tinymce.activeEditor.getDoc()).removeClass("animate"),this.clearReverse($(".reverse",$(t.getDoc()).contents())),t.execCommand("mceToggleFormat",!1,r),this.addReverse($(".reverse",$(t.getDoc()).contents())),$("#tinymce",tinymce.activeEditor.getDoc()).addClass("animate")})}t.ui.registry.addIcon("overline",'<i class="mce-i-overline"></i>'),t.ui.registry.addIcon("dblunderline",'<i class="mce-i-dblunderline"></i>'),t.ui.registry.addIcon("flash",'<i class="mce-i-flash"></i>'),t.ui.registry.addIcon("reverse",'<i class="mce-i-reverse"></i>'),t.ui.registry.addIcon("pasteformatted",'<i class="mce-i-pasteformatted"></i>'),t.ui.registry.addIcon("copyformatted",'<i class="mce-i-copyformatted"></i>'),t.ui.registry.addSplitButton("send",{icon:"arrow-right",tooltip:"Send to mud",onAction:()=>{client.sendCommand(e.getFormattedText().replace(/(?:\r)/g,"")),client.getOption("editorClearOnSend")&&tinymce.activeEditor.setContent(""),client.getOption("editorCloseOnSend")&&e.emit("close")},onItemAction:(r,a)=>{switch(a){case"formatted":client.sendCommand(e.getFormattedText().replace(/(?:\r)/g,"")),client.getOption("editorClearOnSend")&&tinymce.activeEditor.setContent(""),client.getOption("editorCloseOnSend")&&e.emit("close");break;case"text":client.sendCommand(e.getText().replace(/(?:\r)/g,"")),client.getOption("editorClearOnSend")&&tinymce.activeEditor.setContent(""),client.getOption("editorCloseOnSend")&&e.emit("close");break;case"formattednoecho":client.sendBackground(e.getFormattedText().replace(/(?:\r)/g,""),!0),client.getOption("editorClearOnSend")&&tinymce.activeEditor.setContent(""),client.getOption("editorCloseOnSend")&&e.emit("close");break;case"textnoecho":client.sendBackground(e.getText().replace(/(?:\r)/g,""),!0),client.getOption("editorClearOnSend")&&tinymce.activeEditor.setContent(""),client.getOption("editorCloseOnSend")&&e.emit("close");break;case"formattedverbatim":client.send(e.getFormattedText().replace(/(?:\r)/g,"")),client.getOption("editorClearOnSend")&&tinymce.activeEditor.setContent(""),client.getOption("editorCloseOnSend")&&e.emit("close");break;case"textverbatim":client.send(e.getText().replace(/(?:\r)/g,"")),client.getOption("editorClearOnSend")&&tinymce.activeEditor.setContent(""),client.getOption("editorCloseOnSend")&&e.emit("close");break;case"rawformatted":client.sendRaw(e.getFormattedText().replace(/(?:\r)/g,"")),client.getOption("editorClearOnSend")&&tinymce.activeEditor.setContent(""),client.getOption("editorCloseOnSend")&&e.emit("close");break;case"rawtext":client.sendRaw(e.getText().replace(/(?:\r)/g,"")),client.getOption("editorClearOnSend")&&tinymce.activeEditor.setContent(""),client.getOption("editorCloseOnSend")&&e.emit("close");break}},fetch:r=>{r([{text:"Formatted as commands",value:"formatted",type:"choiceitem"},{text:"Text as commands",value:"text",type:"choiceitem"},{text:"Formatted as commands (No echo)",value:"formattednoecho",type:"choiceitem"},{text:"Text as commands (No echo)",value:"textnoecho",type:"choiceitem"},{text:"Formatted verbatim (No echo)",value:"formattedverbatim",type:"choiceitem"},{text:"Text verbatim (No echo)",value:"textverbatim",type:"choiceitem"},{text:"Raw formatted (No echo)",value:"rawformatted",type:"choiceitem"},{text:"Raw text (No echo)",value:"rawtext",type:"choiceitem"}])}}),t.ui.registry.addButton("append",{icon:"browse",tooltip:"Append file...",onAction:()=>e.appendFile()}),t.ui.registry.addButton("clear",{icon:"remove",tooltip:"Clear",onAction:()=>e.clear()}),t.ui.registry.addButton("pasteformatted",{icon:"pasteformatted",tooltip:"Paste formatted",onAction:r=>{U().then(a=>{e.insertFormatted(a||"")}).catch(a=>{client.enableDebug&&client.debug(a),a.message&&a.message==="Permission not granted!"?alert("Paste permission not granted."):alert("Paste not supported.")})}}),t.ui.registry.addButton("pasteastext",{icon:"paste-text",tooltip:"Paste as text",onAction:r=>{U().then(a=>{tinymce.activeEditor.execCommand("mceInsertContent",!1,(a||"").replace(/(\r\n|\r|\n)/g,"<br/>").replaceAll("  ","&nbsp;&nbsp;"))}).catch(a=>{client.enableDebug&&client.debug(a),a.message&&a.message==="Permission not granted!"?alert("Paste permission not granted."):alert("Paste not supported.")})}}),t.ui.registry.addButton("copyformatted",{icon:"copyformatted",tooltip:"Copy formatted",onAction:r=>P(e.getFormattedSelection().replace(/(?:\r)/g,""))}),t.ui.registry.addToggleButton("overline",{icon:"overline",tooltip:"Overline",format:"overline",onAction:r=>n("overline"),onSetup:r=>i(r,"overline")}),t.ui.registry.addToggleButton("dblunderline",{icon:"dblunderline",tooltip:"Double Underline",format:"dblunderline",onAction:r=>n("dblunderline"),onSetup:r=>i(r,"dblunderline")}),t.ui.registry.addToggleButton("flash",{tooltip:"Flash",format:"flash",icon:"flash",onAction:r=>n("flash"),onSetup:r=>i(r,"flash")}),t.ui.registry.addToggleButton("reverse",{icon:"reverse",tooltip:"Reverse",format:"reverse",onAction:r=>n("reverse"),onSetup:r=>i(r,"reverse")}),t.ui.registry.addMenuItem("style",{text:"Style",menu:[{image:"overline",text:"Overline",format:"overline",onclick:n,onpostrender:i},{image:"dblunderline",text:"Double Underline",format:"dblunderline",onclick:n,onpostrender:i},{text:"Flash",format:"flash",image:"flash",onclick:n,onpostrender:i},{image:"reverse",text:"Reverse",format:"reverse",onclick:n,onpostrender:i}]}),t.ui.registry.addMenuItem("overline",{image:"overline",text:"Overline",format:"overline",onclick:n,onpostrender:i}),t.ui.registry.addMenuItem("dblunderline",{image:"dblunderline",text:"Double Underline",format:"dblunderline",onclick:n,onpostrender:i}),t.ui.registry.addMenuItem("flash",{text:"Flash",format:"flash",image:"flash",onclick:n,onpostrender:i}),t.ui.registry.addMenuItem("reverse",{image:"reverse",text:"Reverse",format:"reverse",onclick:n,onpostrender:i}),t.on("Change",()=>{e.addReverse($(".reverse",$(t.getDoc()).contents()))}),t.addShortcut("ctrl+s","Strikethrough",()=>{n("strikethrough")}),t.addShortcut("ctrl+o","Overline",()=>{n("overline")}),t.addShortcut("ctrl+d","Double Underline",()=>{n("dblunderline")}),t.addShortcut("ctrl+f","Flash",()=>{n("flash")}),t.addShortcut("ctrl+r","Reverse",()=>{n("reverse")})})}clearReverse(e,t){e.each(function(){if($(this).data("reverse")&&!(t&&$(this).hasClass("reverse"))){var i,n;t?(i=$(this).css("color"),n=$(this).css("background-color")):(n=$(this).parent().css("color"),i=$(this).parent().css("background-color")),i==="black"&&(i=""),n==="rgba(0, 0, 0, 0)"&&(n="black"),$(this).css("color",n),$(this).css("background-color",i),$(this).children().length&&this.clearReverse($(this).children(),!0)}})}addReverse(e,t){e.each(function(){if(!(t&&$(this).hasClass("reverse"))){var i,n;t?(i=$(this).css("color"),n=$(this).css("background-color")):(i=$(this).parent().css("color"),n=$(this).parent().css("background-color")),i==="rgba(0, 0, 0, 0)"&&(i="black"),n==="rgba(0, 0, 0, 0)"&&(n="black"),$(this).children().length&&(this.clearReverse($(this).children(),!0),this.addReverse($(this).children(),!0)),$(this).css("color",n),$(this).css("background-color",i),$(this).data("reverse",!0)}})}colorCell(e,t){var i='<td class="mce-grid-cell'+(e==="transparent"?" mce-colorbtn-trans":"")+'">';return i+='<div id="'+t+'"',i+=' data-mce-color="'+e+'"',i+=' role="option"',i+=' tabIndex="-1"',i+=' style="background-color: '+(e==="transparent"?e:"#"+e)+'"',this.colorNames[t]?i+=' title="'+t+", "+this.colorNames[t]+'">':i+=' title="'+t+'">',e==="transparent"&&(i+="&#215;"),i+="</div>",i+="</td>",i}openColorDialog(e,t){if(!this._colorDialog){this._colorDialog=new G({noFooter:!0,title:'<i class="fas fa-palette"></i> Pick color',center:!0,resizable:!1,moveable:!1,maximizable:!1,width:380,height:340}),this._colorDialog.body.style.alignItems="center",this._colorDialog.body.style.display="flex";let r,a,c,d,l,u;var i='<table style="margin : auto !important;" class="mce-grid mce-grid-border mce-colorbutton-grid" role="list" cellspacing="0"><tbody><tr>';for(r=0,a=this._ColorTable.length;r<a;r+=2)i+=this.colorCell(this._ColorTable[r],this._ColorTable[r+1]),r/2%6===5&&(i+='<td class="mce-grid-cell"></td>');i+='<td class="mce-grid-cell"></td>',i+=this.colorCell("transparent","No color"),i+="</tr><tr><td></td></tr>";var n="";for(c=0;c<6;c++){for(d<3?i+="<tr>":n+="<tr>",d=0;d<6;d++){for(l=0;l<6;l++)u=`RGB${c}${d}${l}`,t="",r=0,r=c*40+55,r<16&&(t+="0"),t+=r.toString(16),r=0,r=d*40+55,r<16&&(t+="0"),t+=r.toString(16),r=0,r=l*40+55,r<16&&(t+="0"),t+=r.toString(16),t=t.toUpperCase(),d<3?i+=this.colorCell(t,u):n+=this.colorCell(t,u);d===2?i+="</tr>":d<3?i+='<td class="mce-grid-cell"></td>':d<5&&(n+='<td class="mce-grid-cell"></td>')}d<3?i+="</tr>":n+="</tr>"}for(i+=n,i+="<tr><td></td></tr><tr>",c=232;c<=255;c++)d=(c-232)*10+8,d<16?d="0"+d.toString(16).toUpperCase():d=d.toString(16).toUpperCase(),d=d+d+d,i+=this.colorCell(d,t),(c===237||c===249)&&(i+='<td class="mce-grid-cell"></td>'),c===243&&(i+="</tr><tr>");i+="</tr></tbody></table>",i+=`<style>
.mce-colorbtn-trans div {line-height: 14px;overflow: hidden;}
.mce-grid td.mce-grid-cell div{border:1px solid #c5c5c5;width:15px;height:15px;margin:0;cursor:pointer}.mce-grid td.mce-grid-cell div:focus{border-color:#91bbe9}.mce-grid td.mce-grid-cell div[disabled]{cursor:not-allowed}            
.mce-grid{border-spacing:2px;border-collapse:separate}.mce-grid a{display:block;border:1px solid transparent}.mce-grid a:hover,.mce-grid a:focus{border-color:#91bbe9}.mce-grid-border{margin:0 4px 0 4px}.mce-grid-border a{border-color:#c5c5c5;width:13px;height:13px}.mce-grid-border a:hover,.mce-grid-border a.mce-active{border-color:#91bbe9;background:#bdd6f2}            
            </style>`,this._colorDialog.body.innerHTML=i;let v=this._colorDialog.body.querySelectorAll("div");for(r=0,a=v.length;r<a;r++)v[r].addEventListener("click",F=>{t=F.currentTarget.dataset.mceColor,t==="transparent"?tinymce.activeEditor.execCommand("mceRemoveFormat",this._colorDialog.dialog.dataset.type):tinymce.activeEditor.execCommand("mceApplyFormat",this._colorDialog.dialog.dataset.type,"#"+t),tinymce.activeEditor.execCommand("mceSetTextcolor",this._colorDialog.dialog.dataset.type,"#"+t),this._colorDialog.close()})}this._colorDialog.dialog.dataset.type=e,this._colorDialog.showModal()}appendFile(){S("Append file(s)",!0).then(e=>{for(var t=0,i=e.length;t<i;t++)T(e[t]).then(n=>{this.insert(n)}).catch(client.error)}).catch(()=>{})}insertFormatted(e){this.isSimple?W(this._element,e):tinymce.activeEditor.execCommand("insertHTML",!1,M(e).replace(/(\r\n|\r|\n)/g,"<br/>"))}setFormatted(e){this.isSimple?this._element.value=e:tinymce.activeEditor.setContent(M(e).replace(/(\r\n|\r|\n)/g,"<br/>"),{format:"html"})}buildHTMLStack(e){for(var t,i,n,r,a=[],c=0,d=e.length;c<d;c++)if(i=$(e[c]),t=i.prop("tagName"),t==="EM"||t==="I"?t="ITALIC":(t==="STRONG"||t==="B")&&(t="BOLD"),!t)a.push('"'+i.text()+'"');else if(t==="SPAN"){if(e[c].className!=""){for(t=e[c].className.toUpperCase().split(/\s+/g),r=t.length,n=0;n<r;n++)t[n]==="NOFLASH"?a.push("FLASH"):t[n].length>0&&a.push(t[n]);for(a=a.concat(this.buildHTMLStack(i.contents())),n=0;n<r;n++)t[n]==="NOFLASH"?a.push("FLASH"):t[n].length>0&&a.push("/"+t[n]);continue}else if(i.css("text-decoration")==="line-through")t="STRIKEOUT";else if(i.css("text-decoration")==="underline")t="UNDERLINE";else if(i.data("mce-style")){for(t=i.data("mce-style").toUpperCase().split(";"),r=t.length,n=0;n<r;n++)t[n].endsWith("INHERIT")||t[n].endsWith("BLACK")||(t[n]=t[n].trim(),t[n]=t[n].replace("BACKGROUND:","BACKGROUND-COLOR:"),t[n].length>0&&a.push(t[n]));for(a=a.concat(this.buildHTMLStack(i.contents())),n=0;n<r;n++)t[n].endsWith("INHERIT")||t[n].endsWith("BLACK")||t[n].length>0&&a.push("/"+t[n].trim());continue}else if(i.css("color")||i.css("background-color")||i.css("background")){for(t=[],i.css("color")&&t.push("COLOR: "+new y(i.css("color")).toHex().toUpperCase()),i.css("background-color")&&t.push("BACKGROUND-COLOR: "+new y(i.css("background-color")).toHex().toUpperCase()),i.css("background")&&t.push("BACKGROUND-COLOR: "+new y(i.css("background")).toHex().toUpperCase()),r=t.length,n=0;n<r;n++)t[n].length>0&&a.push(t[n].trim());for(a=a.concat(this.buildHTMLStack(i.contents())),n=0;n<r;n++)t[n].length>0&&a.push("/"+t[n].trim());continue}a.push(t),a=a.concat(this.buildHTMLStack(i.contents())),a.push("/"+t)}else t=="BR"&&i.data("mce-bogus")?a.push("RESET"):(a.push(t),a=a.concat(this.buildHTMLStack(i.contents())),a.push("/"+t));return a}getFormattedSelection(){for(var e=tinymce.activeEditor.dom.getParents(tinymce.activeEditor.selection.getNode()),t=0,i=e.length,n="<html>",r="</html>";t<i;t++){var a=e[t].tagName;if(a==="EM"||a==="I"||a==="STRONG"||a==="B")n+="<"+a+">",r="</"+a+">"+r;else if(a==="SPAN"){n+="<"+a,e[t].className!=""&&(n+=' class="'+e[t].className+'"');var c="";e[t].style.textDecoration!=""&&(c+="text-decoration:"+e[t].style.textDecoration+";"),e[t].style.color!=""&&(c+="color:"+e[t].style.color+";"),e[t].style.background!=""&&(c+="background:"+e[t].style.background+";"),e[t].style.backgroundColor!=""&&(c+="background-color:"+e[t].style.backgroundColor+";"),c.length>0&&(n+=' style="'+c+'"'),e[t].dataset&&e[t].dataset.mceStyle&&(n+=' data-mce-style="'+e[t].dataset.mceStyle+'"'),n+=" >",r="</"+a+">"+r}else if(a==="BODY"){n+="<"+a+">",r="</"+a+">"+r;break}}return this.formatHtml($(n+tinymce.activeEditor.selection.getContent({format:"raw"}).replace(/<\/div><div>/g,"<br>")+r))}getFormattedText(){return this.isSimple?this._element.value:this.formatHtml($("<html>"+this.getRaw().replace(/<\/div><div>/g,"<br>")+"</html>"))}getText(){return this.isSimple?this._element.value:tinymce.activeEditor.getContent({format:"text"})}getHTML(){return this.isSimple?this._element.value:tinymce.activeEditor.getContent({format:"html"})}getRaw(){return this.isSimple?this._element.value:tinymce.activeEditor.getContent({format:"raw"})}formatHtml(e){var t=this.buildHTMLStack(e),i=[],n=[],r,a,c,d;for(a=t.length-1;a>=0&&(!t[a].startsWith('"')&&t[a]!="BR"&&t[a]!="RESET");a--)t.pop();for(t[0]==="DIV"&&t.shift(),a=0,c=t.length;a<c;a++)switch(t[a]){case"BOLD":case"ITALIC":case"UNDERLINE":case"STRIKEOUT":case"DBLUNDERLINE":case"OVERLINE":case"FLASH":case"REVERSE":n.push("%^"+t[a]+"%^"),i.push("%^"+t[a]+"%^");break;case"/DBLUNDERLINE":case"/OVERLINE":case"/FLASH":case"/REVERSE":case"/UNDERLINE":case"/BOLD":case"/ITALIC":case"/STRIKEOUT":n.pop(),this.cleanReset(i),i.push("%^RESET%^"),n.length>0&&i.push(n.join(""));break;case"SPAN":case"/SPAN":case"/BR":case"/DIV":break;case"DIV":case"BR":n.length>0&&i.length>0&&!i[i.length-1].endsWith("%^RESET%^")&&(this.cleanReset(i),i.push("%^RESET%^")),i.push(`
`),n.length>0&&i.push(n.join(""));break;case"RESET":n.length>0&&i.length>0&&!i[i.length-1].endsWith("%^RESET%^")&&(this.cleanReset(i),i.push("%^RESET%^")),n.length>0&&i.push(n.join(""));break;default:t[a].startsWith("COLOR: #")?(r=t[a].substr(8),this._colors[r]||(d=new y(r),r=this.nearestHex(d.toHex()).substr(1)),r=this._colors[r],(r==="BOLD BLACK"||r==="BOLD%^%^BLACK")&&(r="mono11"),n.push("%^"+r+"%^"),i.push("%^"+r+"%^")):t[a].startsWith("COLOR: ")?(r=new y(t[a].substr(7)).toHex().substr(1),this._colors[r]||(r=this.nearestHex("#"+r).substr(1)),r=this._colors[r],(r==="BOLD BLACK"||r==="BOLD%^%^BLACK")&&(r="mono11"),n.push("%^"+r+"%^"),i.push("%^"+r+"%^")):t[a].startsWith("/COLOR: ")?(n.pop(),this.cleanReset(i),i.push("%^RESET%^"),n.length>0&&i.push(n.join(""))):t[a].startsWith("BACKGROUND-COLOR: #")?(r=t[a].substr(19),this._colors[r]||(d=new y(r),r=this.nearestHex(d.toHex()).substr(1)),this._colors["B"+r]?r=this._colors["B"+r]:r=this._colors[r],r="%^B_"+r+"%^",n.push(r),i.push(r)):t[a].startsWith("BACKGROUND-COLOR: ")?(r=new y(t[a].substr(18)).toHex().substr(1),this._colors[r]||(r=this.nearestHex("#"+r).substr(1)),this._colors["B"+r]?r=this._colors["B"+r]:r=this._colors[r],r="%^B_"+r+"%^",n.push(r),i.push(r)):t[a].startsWith("/BACKGROUND-COLOR: ")?(n.pop(),this.cleanReset(i),i.push("%^RESET%^"),n.length>0&&i.push(n.join(""))):t[a].startsWith('"')&&i.push(t[a].substring(1,t[a].length-1));break}return i.join("")}cleanReset(e){let t=e.length-1;for(;t>=0;t--)if(e[t].startsWith("%^"))e.pop();else return e;return e}nearestHex(e){var t=this,i=function(r){var a=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;r=r.replace(a,function(u,v,F,w){return[v,v,F,F,w,w].join()});var c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?/i,d=c.exec(r),l=d?{r:parseInt(d[1],16),g:parseInt(d[2],16),b:parseInt(d[3],16)}:null;return l},n=function(r){if(!r)throw new Error("The hex you provided is not formatted correctly. Please try in a format such as '#FFF' or '#DDFFDD'.");for(var a=Number.MAX_SAFE_INTEGER,c=null,d=0;d<t.colorList.length;d++){var l=t.colorList[d],u=Math.sqrt(Math.pow(r.r-l.rgb.r,2)+Math.pow(r.g-l.rgb.g,2)+Math.pow(r.b-l.rgb.b,2));u<a&&(a=u,c=l.hex)}return c};return n(i(e))}remove(){tinymce.remove(`#${this._element.id}`)}initialize(){this.isSimple||(this.initPlugins(),tinymce.init({license_key:"gpl",custom_colors:!1,selector:`textarea#${this._element.id}`,height:500,menubar:!1,browser_spellcheck:!0,resize:!0,statusbar:!1,nowrap:!0,force_br_newlines:!0,forced_root_block:"div",plugins:"pinkfish insertdatetime pinkfishtextcolor nonbreaking",color_picker_callback:(e,t,i)=>{this.openColorDialog(i,t||"")},color_picker_caption:"More&hellip;",textcolor_rows:"3",textcolor_cols:"8",toolbar:"send | append | undo redo | pinkfishforecolor pinkfishbackcolor | italic underline strikethrough overline dblunderline flash reverse | clear | copy copyformatted | insertdatetime",toolbar_mode:"sliding",content_css:"css/tinymce.content.min.css",formats:{bold:{inline:"strong",exact:!0,links:!0,remove_similar:!0},italic:{inline:"em",exact:!0,links:!0,remove_similar:!0},overline:{inline:"span",classes:"overline",links:!0,remove_similar:!0},dblunderline:{inline:"span",classes:"dblunderline",links:!0,remove_similar:!0},flash:{inline:"span",classes:"flash",links:!0,remove_similar:!0},reverse:{inline:"span",classes:"reverse",links:!0,remove_similar:!0},underline:{inline:"span",classes:"underline",links:!0,remove_similar:!0},strikethrough:{inline:"span",classes:"strikeout",links:!0,remove_similar:!0},forecolor:{inline:"span",styles:{textDecoration:"inherit",border:"inherit",color:"%value"},exact:!0,links:!0,remove_similar:!0},hilitecolor:{inline:"span",styles:{textDecoration:"inherit",border:"inherit",backgroundColor:"%value"},exact:!0,links:!0,remove_similar:!0}},init_instance_callback:e=>{e.shortcuts.add("ctrl+shift+c","Copy formatted",()=>P(this.getFormattedSelection().replace(/(?:\r)/g,""))),e.on("PastePreProcess",t=>{client.getOption("enableDebug")&&client.debug("Advanced Before Editor PastePreProcess: "+t.content),this.clearReverse($(".reverse",$(e.getDoc()).contents())),t.content=t.content.replace(/<\/p>/g,"<br>"),t.content=t.content.replace(/<\/h[1-6]>/g,"<br>"),t.content=t.content.replace(/<\/li>/g,"<br>");for(var i=/<pre(.*?)>((.|\s)*)<\/pre>/mgi,n;(n=i.exec(t.content))!==null;)n.index===i.lastIndex&&i.lastIndex++,t.content=t.content.substring(0,n.index)+t.content.substring(n.index,i.lastIndex).replace(/(\r\n|\r|\n)/g,"<br/>").replaceAll("  ","&nbsp;&nbsp;")+t.content.substring(i.lastIndex);client.getOption("enableDebug")&&client.debug("Advanced After Editor PastePreProcess: "+t.content)}),e.on("PastePreProcess",()=>{this.addReverse($(".reverse",$(e.getDoc()).contents()))}),$(".mce-content-body",tinymce.activeEditor.getDoc()).css("font-size",client.getOption("cmdfontSize")),$(".mce-content-body",tinymce.activeEditor.getDoc()).css("font-family",client.getOption("cmdfont")+", monospace"),tinymce.activeEditor.formatter?tinymce.activeEditor.formatter.register("flash",{inline:"span",classes:client.getOption("flashing")?"flash":"noflash",links:!0,remove_similar:!0}):tinymce.activeEditor.settings.formats.flash={inline:"span",classes:client.getOption("flashing")?"flash":"noflash",links:!0,remove_similar:!0},this.loadColors(),this.setFormatted(this.value),e.on("click",t=>{this.emit("click",t)}),this.emit("editor-init"),this._init=!0},paste_data_images:!1,paste_webkit_styles:"color background background-color text-decoration",valid_elements:"strong/b,em/i,u,span[style],span[class],strike/s,br",valid_styles:{"*":"color,background,background-color,text-decoration,font-weight"},color_map:this._ColorTable}))}focus(){this.isSimple?this._element.focus():this._init&&tinymce.activeEditor&&tinymce.activeEditor.focus()}};var b,g;function de(){let o;K(),client.input.on("history-navigate",()=>{(client.getOption("commandAutoSize")||client.getOption("commandScrollbars"))&&k()}),client.on("options-loaded",()=>{client.commandInput.removeEventListener("input",k),client.commandInput.removeEventListener("change",k),J(),ee(),(client.getOption("commandAutoSize")||client.getOption("commandScrollbars"))&&k()}),document.getElementById("btn-adv-editor").addEventListener("click",s=>{if(!g){g=new G(Object.assign({},client.getOption("windows.editor")||{center:!0},{title:'<i class="fas fa-edit"></i> Advanced editor',id:"adv-editor"})),g.on("resized",t=>{client.setOption("windows.editor",t)}),g.on("moved",t=>{client.setOption("windows.editor",t)}),g.on("maximized",()=>{client.setOption("windows.editor",g.windowState)}),g.on("restored",()=>{client.setOption("windows.editor",g.windowState)}),g.on("shown",()=>{client.setOption("windows.editor",g.windowState),b.initialize()}),g.on("closing",()=>{b.remove()}),g.on("closed",()=>{client.setOption("windows.editor",g.windowState)}),g.on("canceling",()=>{b.remove()}),g.on("canceled",()=>{client.setOption("windows.editor",g.windowState)}),g.on("focus",()=>b.focus());let e=document.createElement("textarea");e.classList.add("form-control","form-control-sm"),e.id="adv-editor-txt",g.body.appendChild(e),g.body.style.overflow="hidden",b||(b=new z(e,!client.getOption("simpleEditor"))),b.on("close",()=>{g.close()}),b.on("editor-init",()=>b.focus()),b.on("click",()=>g.focus()),g.dialog.editor=b,tinymce&&g.header.querySelector("#adv-editor-max").insertAdjacentHTML("afterend",'<button type="button" class="btn btn-light float-end" id="adv-editor-switch" title="Switch to advanced" style="padding: 0 4px;margin-top: -1px;"><i class="bi-shuffle"></i></button>'),g.footer.innerHTML=`<button id="btn-adv-editor-clear" type="button" class="float-start btn btn-light" title="Clear editor">Clear</button>
                <button id="btn-adv-editor-append" type="button" class="float-start btn btn-light" title="Append file...">Append file...</button>
                <button id="btn-adv-editor-send" type="button" class="float-end btn btn-primary" title="Send">Send</button>`,b.isSimple||(g.header.querySelector("#adv-editor-switch").title="Switch to simple"),g.header.querySelector("#adv-editor-switch").addEventListener("click",()=>{client.setOption("simpleEditor",!b.simple);let t="";b.isSimple||(t=b.getFormattedText().replace(/(?:\r)/g,"")),b.simple=!b.simple,b.isSimple?(b.value=t,g.showFooter(),g.header.querySelector("#adv-editor-switch").title="Switch to advanced",setTimeout(()=>b.focus(),100)):(g.hideFooter(),g.header.querySelector("#adv-editor-switch").title="Switch to simple")}),document.getElementById("btn-adv-editor-append").addEventListener("click",()=>{S("Append file",!1).then(t=>{T(t[0]).then(i=>{b.insert(i)}).catch(client.error)}).catch(()=>{})}),document.getElementById("btn-adv-editor-send").addEventListener("click",()=>{client.sendCommand(b.value()),client.getOption("editorClearOnSend")&&b.clear(),client.getOption("editorCloseOnSend")&&g.close()}),document.getElementById("btn-adv-editor-clear").addEventListener("click",()=>{b.clear(),b.focus()}),b.isSimple||g.hideFooter()}g.show(),b.isSimple&&b.focus()}),o=client.getOption("windows.editor"),o&&o.show&&document.getElementById("btn-adv-editor").click(),document.getElementById("btn-command-history").addEventListener("show.bs.dropdown",function(){document.body.appendChild(document.getElementById("command-history-menu"))}),document.getElementById("btn-command-history").addEventListener("hidden.bs.dropdown",function(){document.getElementById("btn-command-history").parentElement.appendChild(document.getElementById("command-history-menu"))}),client.commandInput.removeEventListener("input",k),client.commandInput.removeEventListener("change",k),J(),ee(),(client.getOption("commandAutoSize")||client.getOption("commandScrollbars"))&&k(),window.addEventListener("hashchange",Z,!1),window.addEventListener("load",Z)}function Z(){if(!(!window.location.hash||window.location.hash.length<2)){var o=window.location.hash.substring(1).split(",");for(let s=o.length-1;s>=0;s--)switch(o[s].trim()){case"about":ue(new G({title:'<i class="bi-info-circle"></i> About',noFooter:!0,resizable:!1,center:!0,maximizable:!1}),o[s].trim(),1,!0).catch(e=>{client.error(e)});break;case"editor":document.getElementById("btn-adv-editor").click();break}}}function ue(o,s,e,t){return new Promise((i,n)=>{var r=s.split("/");$("#empty-page").css("visibility")!=="visible"&&$(".page").removeClass("show"),$.ajax({url:"dialogs/"+r[0]+".htm",cache:!1,type:"GET"}).done(function(a){o.dialog.dataset.path=r[0],o.dialog.dataset.fullPath=s,o.dialog.dataset.hash=window.location.hash,o.body.innerHTML=a;let c=o.body.querySelectorAll("script");for(let d=0,l=c.length;d<l;d++)new Function("body","client",c[d].textContent).apply(client,[o.body,client]);e==1?o.show():e===2&&o.showModal(),i(a)}).fail(function(a){t&&client.enableDebug?o.body.innerHTML=`<h1 style="width: 100%;text-align:center">Error loading ${s[0]}</h1> ${a.statusText}`:t&&(o.body.innerHTML=`<h1 style="width: 100%;text-align:center">Error loading ${s[0]}</h1>`),n(s[0]+": "+a.statusText)})})}function k(){O(()=>{me()},250,"resizeCommand")}async function J(){(client.getOption("commandAutoSize")||client.getOption("commandScrollbars"))&&(client.commandInput.addEventListener("input",k),client.commandInput.addEventListener("change",k)),client.getOption("commandWordWrap")?(document.getElementById("commandMeasure").style.whiteSpace="pre-wrap",document.getElementById("commandMeasure").style.overflowWrap="anywhere"):(document.getElementById("commandMeasure").style.whiteSpace="",document.getElementById("commandMeasure").style.overflowWrap=""),client.getOption("commandScrollbars")?(document.getElementById("commandMeasure").style.overflow="auto",client.commandInput.style.overflow="auto"):(document.getElementById("commandMeasure").style.overflow="",client.commandInput.style.overflow="")}var C={};function ee(){let o=document.getElementById("commandMeasure");document.body.appendChild(o);let s=client.commandInput.parentElement,e=window.getComputedStyle(s);o.style.fontSize=client.commandInput.style.fontSize,o.style.fontFamily=client.commandInput.style.fontFamily,o.style.width=client.commandInput.offsetWidth+"px";let t=o.innerHTML;o.innerHTML="W";let i=client.getOption("commandMinLines"),n=o.offsetHeight;i=n*(i<1?1:i);let r=parseFloat(e.borderTopWidth)||0;r+=parseFloat(e.borderBottomWidth)||0,r+=parseFloat(e.paddingTop)||0,r+=parseFloat(e.paddingBottom)||0;let a=e.inset.split(" ");r+=(parseFloat(a[0])||0)*2,o.innerHTML=t,s.style.height=n+r+"px",client.commandInput.parentElement.style.height=n+"px",client.commandInput.closest("nav").style.height=n+6+"px",client.display.container.style.bottom=n+r+"px",C={measure:o,cmd:s,cmdSize:e,height:n,padding:r,minHeight:i}}function me(){let o=C.measure,s=C.cmd;o.innerHTML=client.commandInput.value+`
`;let e=o.offsetHeight;e<C.minHeight&&(e=C.minHeight);let t=C.padding;s.style.height=e+t+"px",client.commandInput.parentElement.style.height=e+"px",client.commandInput.closest("nav").style.height=e+6+"px",client.display.container.style.bottom=e+t+"px"}window.initializeInterface=de;})();
/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * @link   http://www.phpied.com/rgb-color-parser-in-javascript/
 * @license Use it if you like it
 */
//# sourceMappingURL=oiMUD.interface.min.js.map
