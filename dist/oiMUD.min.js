(()=>{var Bi=Object.create;var si=Object.defineProperty;var Ri=Object.getOwnPropertyDescriptor;var Oi=Object.getOwnPropertyNames;var Di=Object.getPrototypeOf,Mi=Object.prototype.hasOwnProperty;var ni=(u,h)=>()=>(h||u((h={exports:{}}).exports,h),h.exports);var Ai=(u,h,t,e)=>{if(h&&typeof h=="object"||typeof h=="function")for(let i of Oi(h))!Mi.call(u,i)&&i!==t&&si(u,i,{get:()=>h[i],enumerable:!(e=Ri(h,i))||e.enumerable});return u};var ri=(u,h,t)=>(t=u!=null?Bi(Di(u)):{},Ai(h||!u||!u.__esModule?si(t,"default",{value:u,enumerable:!0}):t,u));var di=ni(fi=>{(function(){"use strict";var u=void 0,h=!0,t=this;function e(I,R){var z=I.split("."),F=t;!(z[0]in F)&&F.execScript&&F.execScript("var "+z[0]);for(var k;z.length&&(k=z.shift());)!z.length&&R!==u?F[k]=R:F=F[k]?F[k]:F[k]={}}var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u"&&typeof DataView<"u";function n(I){var R=I.length,z=0,F=Number.POSITIVE_INFINITY,k,M,O,Y,w,J,D,B,N,q;for(B=0;B<R;++B)I[B]>z&&(z=I[B]),I[B]<F&&(F=I[B]);for(k=1<<z,M=new(i?Uint32Array:Array)(k),O=1,Y=0,w=2;O<=z;){for(B=0;B<R;++B)if(I[B]===O){for(J=0,D=Y,N=0;N<O;++N)J=J<<1|D&1,D>>=1;for(q=O<<16|B,N=J;N<k;N+=w)M[N]=q;++Y}++O,Y<<=1,w<<=1}return[M,z,F]}function s(I,R,z){this.u=[],this.i=z||32768,this.v=0,this.a=R===u?0:R,this.d=this.e=0,this.input=i?new Uint8Array(I):I,this.b=new(i?Uint8Array:Array)(this.i),this.c=0,this.t=this.l=!1,this.f=0,this.status=l}var l=0;s.prototype.j=function(I,R){var z=!1;for(I!==u&&(this.input=I),R!==u&&(this.a=R);!z;)switch(this.status){case l:case 1:var F,k=u;if(this.status=1,W(this),0>(k=m(this,3)))te(this),F=-1;else{switch(k&1&&(this.l=h),k>>>=1,k){case 0:this.h=0;break;case 1:this.h=1;break;case 2:this.h=2;break;default:throw Error("unknown BTYPE: "+k)}this.status=2,F=u}0>F&&(z=h);break;case 2:case 3:switch(this.h){case 0:var M,O=u,Y=u,w=this.input,J=this.a;if(this.status=3,J+4>=w.length)M=-1;else{if(O=w[J++]|w[J++]<<8,Y=w[J++]|w[J++]<<8,O===~Y)throw Error("invalid uncompressed block header: length verify");this.d=this.e=0,this.a=J,this.m=O,this.status=4,M=u}0>M&&(z=h);break;case 1:this.status=3,this.k=_,this.n=y,this.status=4;break;case 2:var D;e:{var B=u,N=u,q=u,oe=new(i?Uint8Array:Array)(a.length),_e=u;if(this.status=3,W(this),B=m(this,5)+257,N=m(this,5)+1,q=m(this,4)+4,0>B||0>N||0>q)te(this),D=-1;else{try{for(var Se=u,ge=u,Ne=0,Ee=u,Q=u,Ce=u,ei=u,Ce=0;Ce<q;++Ce){if(0>(Se=m(this,3)))throw Error("not enough input");oe[a[Ce]]=Se}for(_e=n(oe),Q=new(i?Uint8Array:Array)(B+N),Ce=0,ei=B+N;Ce<ei;){if(ge=x(this,_e),0>ge)throw Error("not enough input");switch(ge){case 16:if(0>(Se=m(this,2)))throw Error("not enough input");for(Ee=3+Se;Ee--;)Q[Ce++]=Ne;break;case 17:if(0>(Se=m(this,3)))throw Error("not enough input");for(Ee=3+Se;Ee--;)Q[Ce++]=0;Ne=0;break;case 18:if(0>(Se=m(this,7)))throw Error("not enough input");for(Ee=11+Se;Ee--;)Q[Ce++]=0;Ne=0;break;default:Ne=Q[Ce++]=ge}}new(i?Uint8Array:Array)(B),new(i?Uint8Array:Array)(N),this.k=n(i?Q.subarray(0,B):Q.slice(0,B)),this.n=n(i?Q.subarray(B):Q.slice(B))}catch{te(this),D=-1;break e}this.status=4,D=0}}0>D&&(z=h)}break;case 4:case 5:switch(this.h){case 0:var Ft;e:{var ti=this.input,gt=this.a,Gt=this.b,bt=this.c,Wt=this.m;for(this.status=5;Wt--;){if(bt===Gt.length&&(Gt=me(this,{o:2})),gt>=ti.length){this.a=gt,this.c=bt,this.m=Wt+1,Ft=-1;break e}Gt[bt++]=ti[gt++]}0>Wt&&(this.status=6),this.a=gt,this.c=bt,Ft=0}0>Ft&&(z=h);break;case 1:case 2:0>ne(this)&&(z=h)}break;case 6:this.l?z=h:this.status=l}var T,Pe=this.c,ii;return T=this.t?i?new Uint8Array(this.b.subarray(this.f,Pe)):this.b.slice(this.f,Pe):i?this.b.subarray(this.f,Pe):this.b.slice(this.f,Pe),this.f=Pe,Pe>32768+this.i&&(this.c=this.f=32768,i?(ii=this.b,this.b=new Uint8Array(this.i+32768),this.b.set(ii.subarray(Pe-32768,Pe))):this.b=this.b.slice(Pe-32768)),T};var r=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],a=i?new Uint16Array(r):r,o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],f=i?new Uint16Array(o):o,p=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],g=i?new Uint8Array(p):p,c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],S=i?new Uint16Array(c):c,v=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],d=i?new Uint8Array(v):v,b=new(i?Uint8Array:Array)(288),L,P;for(L=0,P=b.length;L<P;++L)b[L]=143>=L?8:255>=L?9:279>=L?7:8;var _=n(b),j=new(i?Uint8Array:Array)(30),C,E;for(C=0,E=j.length;C<E;++C)j[C]=5;var y=n(j);function m(I,R){for(var z=I.e,F=I.d,k=I.input,M=I.a,O;F<R;){if(k.length<=M)return-1;O=k[M++],z|=O<<F,F+=8}return O=z&(1<<R)-1,I.e=z>>>R,I.d=F-R,I.a=M,O}function x(I,R){for(var z=I.e,F=I.d,k=I.input,M=I.a,O=R[0],Y=R[1],w,J,D;F<Y;){if(k.length<=M)return-1;w=k[M++],z|=w<<F,F+=8}if(J=O[z&(1<<Y)-1],D=J>>>16,D>F)throw Error("invalid code length: "+D);return I.e=z>>D,I.d=F-D,I.a=M,J&65535}function W(I){I.s=I.a,I.r=I.d,I.q=I.e}function te(I){I.a=I.s,I.d=I.r,I.e=I.q}function ne(I){var R=I.b,z=I.c,F,k,M,O,Y=I.k,w=I.n,J=R.length,D;for(I.status=5;;){if(W(I),F=x(I,Y),0>F)return I.c=z,te(I),-1;if(F===256)break;if(256>F)z===J&&(R=me(I),J=R.length),R[z++]=F;else{if(k=F-257,O=f[k],0<g[k]){if(D=m(I,g[k]),0>D)return I.c=z,te(I),-1;O+=D}if(F=x(I,w),0>F)return I.c=z,te(I),-1;if(M=S[F],0<d[F]){if(D=m(I,d[F]),0>D)return I.c=z,te(I),-1;M+=D}for(z+O>=J&&(R=me(I),J=R.length);O--;)R[z]=R[z++-M];if(I.a===I.input.length)return I.c=z,-1}}for(;8<=I.d;)I.d-=8,I.a--;I.c=z,I.status=6}function me(I,R){var z,F=I.input.length/I.a+1|0,k,M,O,Y=I.input,w=I.b;return R&&(typeof R.o=="number"&&(F=R.o),typeof R.p=="number"&&(F+=R.p)),2>F?(k=(Y.length-I.a)/I.k[2],O=258*(k/2)|0,M=O<w.length?w.length+O:w.length<<1):M=w.length*F,i?(z=new Uint8Array(M),z.set(w)):z=w,I.b=z,I.b}function se(I){this.input=I===u?new(i?Uint8Array:Array):I,this.a=0,this.g=new s(this.input,this.a),this.b=this.g.b}se.prototype.j=function(I){var R;if(I!==u)if(i){var z=new Uint8Array(this.input.length+I.length);z.set(this.input,0),z.set(I,this.input.length),this.input=z}else this.input=this.input.concat(I);var F;if(F=this.method===u){var k,M=this.a,O=this.input,Y=O[M++],w=O[M++];if(Y===u||w===u)k=-1;else{switch(Y&15){case 8:this.method=8;break;default:throw Error("unsupported compression method")}if(((Y<<8)+w)%31!==0)throw Error("invalid fcheck flag:"+((Y<<8)+w)%31);if(w&32)throw Error("fdict flag is not supported");this.a=M,k=u}F=0>k}return F?new(i?Uint8Array:Array):(R=this.g.j(this.input,this.a),this.g.a!==0&&(this.input=i?this.input.subarray(this.g.a):this.input.slice(this.g.a),this.a=0),R)},e("Zlib.InflateStream",se),e("Zlib.InflateStream.prototype.decompress",se.prototype.j)}).call(fi)});var wi=ni((yi,Pt)=>{(function(u,h){"use strict";typeof Pt<"u"&&Pt.exports?Pt.exports=h():typeof define=="function"&&define.amd?define([],h):u.buzz=h()})(yi,function(){"use strict";var u=window.AudioContext||window.webkitAudioContext,h={defaults:{autoplay:!1,duration:5e3,formats:[],loop:!1,placeholder:"--",preload:"metadata",volume:80,webAudioApi:!1,document:window.document},types:{mp3:"audio/mpeg",ogg:"audio/ogg",wav:"audio/wav",aac:"audio/aac",m4a:"audio/x-m4a"},sounds:[],el:document.createElement("audio"),getAudioContext:function(){if(this.audioCtx===void 0)try{this.audioCtx=u?new u:null}catch{this.audioCtx=null}return this.audioCtx},sound:function(t,e){e=e||{};var i=e.document||h.defaults.document,n=0,s=[],l={},r=h.isSupported();this.load=function(){return r?(this.sound.load(),this):this},this.play=function(){return r?(this.sound.play(),this):this},this.togglePlay=function(){return r?(this.sound.paused?this.sound.play():this.sound.pause(),this):this},this.pause=function(){return r?(this.sound.pause(),this):this},this.isPaused=function(){return r?this.sound.paused:null},this.stop=function(){return r?(this.setTime(0),this.sound.pause(),this):this},this.isEnded=function(){return r?this.sound.ended:null},this.loop=function(){return r?(this.sound.loop="loop",this.bind("ended.buzzloop",function(){this.currentTime=0,this.play()}),this):this},this.unloop=function(){return r?(this.sound.removeAttribute("loop"),this.unbind("ended.buzzloop"),this):this},this.mute=function(){return r?(this.sound.muted=!0,this):this},this.unmute=function(){return r?(this.sound.muted=!1,this):this},this.toggleMute=function(){return r?(this.sound.muted=!this.sound.muted,this):this},this.isMuted=function(){return r?this.sound.muted:null},this.setVolume=function(S){return r?(S<0&&(S=0),S>100&&(S=100),this.volume=S,this.sound.volume=S/100,this):this},this.getVolume=function(){return r?this.volume:this},this.increaseVolume=function(S){return this.setVolume(this.volume+(S||1))},this.decreaseVolume=function(S){return this.setVolume(this.volume-(S||1))},this.setTime=function(S){if(!r)return this;var v=!0;return this.whenReady(function(){v===!0&&(v=!1,this.sound.currentTime=S)}),this},this.getTime=function(){if(!r)return null;var S=Math.round(this.sound.currentTime*100)/100;return isNaN(S)?h.defaults.placeholder:S},this.setPercent=function(S){return r?this.setTime(h.fromPercent(S,this.sound.duration)):this},this.getPercent=function(){if(!r)return null;var S=Math.round(h.toPercent(this.sound.currentTime,this.sound.duration));return isNaN(S)?h.defaults.placeholder:S},this.setSpeed=function(S){return r?(this.sound.playbackRate=S,this):this},this.getSpeed=function(){return r?this.sound.playbackRate:null},this.getDuration=function(){if(!r)return null;var S=Math.round(this.sound.duration*100)/100;return isNaN(S)?h.defaults.placeholder:S},this.getPlayed=function(){return r?a(this.sound.played):null},this.getBuffered=function(){return r?a(this.sound.buffered):null},this.getSeekable=function(){return r?a(this.sound.seekable):null},this.getErrorCode=function(){return r&&this.sound.error?this.sound.error.code:0},this.getErrorMessage=function(){if(!r)return null;switch(this.getErrorCode()){case 1:return"MEDIA_ERR_ABORTED";case 2:return"MEDIA_ERR_NETWORK";case 3:return"MEDIA_ERR_DECODE";case 4:return"MEDIA_ERR_SRC_NOT_SUPPORTED";default:return null}},this.getStateCode=function(){return r?this.sound.readyState:null},this.getStateMessage=function(){if(!r)return null;switch(this.getStateCode()){case 0:return"HAVE_NOTHING";case 1:return"HAVE_METADATA";case 2:return"HAVE_CURRENT_DATA";case 3:return"HAVE_FUTURE_DATA";case 4:return"HAVE_ENOUGH_DATA";default:return null}},this.getNetworkStateCode=function(){return r?this.sound.networkState:null},this.getNetworkStateMessage=function(){if(!r)return null;switch(this.getNetworkStateCode()){case 0:return"NETWORK_EMPTY";case 1:return"NETWORK_IDLE";case 2:return"NETWORK_LOADING";case 3:return"NETWORK_NO_SOURCE";default:return null}},this.set=function(S,v){return r?(this.sound[S]=v,this):this},this.get=function(S){return r?S?this.sound[S]:this.sound:null},this.bind=function(S,v){if(!r)return this;S=S.split(" ");for(var d=this,b=function(j){v.call(d,j)},L=0;L<S.length;L++){var P=S[L],_=P;P=_.split(".")[0],s.push({idx:_,func:b}),this.sound.addEventListener(P,b,!0)}return this},this.unbind=function(S){if(!r)return this;S=S.split(" ");for(var v=0;v<S.length;v++)for(var d=S[v],b=d.split(".")[0],L=0;L<s.length;L++){var P=s[L].idx.split(".");(s[L].idx===d||P[1]&&P[1]===d.replace(".",""))&&(this.sound.removeEventListener(b,s[L].func,!0),s.splice(L,1))}return this},this.bindOnce=function(S,v){if(!r)return this;var d=this;return l[n++]=!1,this.bind(S+"."+n,function(){l[n]||(l[n]=!0,v.call(d)),d.unbind(S+"."+n)}),this},this.trigger=function(S,v){if(!r)return this;S=S.split(" ");for(var d=0;d<S.length;d++)for(var b=S[d],L=0;L<s.length;L++){var P=s[L].idx.split(".");if(s[L].idx===b||P[0]&&P[0]===b.replace(".","")){var _=i.createEvent("HTMLEvents");_.initEvent(P[0],!1,!0),_.originalEvent=v,this.sound.dispatchEvent(_)}}return this},this.fadeTo=function(S,v,d){if(!r)return this;v instanceof Function?(d=v,v=h.defaults.duration):v=v||h.defaults.duration;var b=this.volume,L=v/Math.abs(b-S),P=this;this.play();function _(){setTimeout(function(){b<S&&P.volume<S?(P.setVolume(P.volume+=1),_()):b>S&&P.volume>S?(P.setVolume(P.volume-=1),_()):d instanceof Function&&d.apply(P)},L)}return this.whenReady(function(){_()}),this},this.fadeIn=function(S,v){return r?this.setVolume(0).fadeTo(100,S,v):this},this.fadeOut=function(S,v){return r?this.fadeTo(0,S,v):this},this.fadeWith=function(S,v){return r?(this.fadeOut(v,function(){this.stop()}),S.play().fadeIn(v),this):this},this.whenReady=function(S){if(!r)return null;var v=this;this.sound.readyState===0?this.bind("canplay.buzzwhenready",function(){S.call(v)}):S.call(v)},this.addSource=function(S){var v=this,d=i.createElement("source");return d.src=S,h.types[o(S)]&&(d.type=h.types[o(S)]),this.sound.appendChild(d),d.addEventListener("error",function(b){v.trigger("sourceerror",b)}),d};function a(S){for(var v=[],d=S.length-1,b=0;b<=d;b++)v.push({start:S.start(b),end:S.end(b)});return v}function o(S){return S.split(".").pop()}if(r&&t){for(var f in h.defaults)h.defaults.hasOwnProperty(f)&&e[f]===void 0&&(e[f]=h.defaults[f]);if(this.sound=i.createElement("audio"),e.webAudioApi){var p=h.getAudioContext();p&&(this.source=p.createMediaElementSource(this.sound),this.source.connect(p.destination))}if(t instanceof Array)for(var g in t)t.hasOwnProperty(g)&&this.addSource(t[g]);else if(e.formats.length)for(var c in e.formats)e.formats.hasOwnProperty(c)&&this.addSource(t+"."+e.formats[c]);else this.addSource(t);e.loop&&this.loop(),e.autoplay&&(this.sound.autoplay="autoplay"),e.preload===!0?this.sound.preload="auto":e.preload===!1?this.sound.preload="none":this.sound.preload=e.preload,this.setVolume(e.volume),h.sounds.push(this)}},group:function(t){t=i(t,arguments),this.getSounds=function(){return t},this.add=function(n){n=i(n,arguments);for(var s=0;s<n.length;s++)t.push(n[s])},this.remove=function(n){n=i(n,arguments);for(var s=0;s<n.length;s++)for(var l=0;l<t.length;l++)if(t[l]===n[s]){t.splice(l,1);break}},this.load=function(){return e("load"),this},this.play=function(){return e("play"),this},this.togglePlay=function(){return e("togglePlay"),this},this.pause=function(n){return e("pause",n),this},this.stop=function(){return e("stop"),this},this.mute=function(){return e("mute"),this},this.unmute=function(){return e("unmute"),this},this.toggleMute=function(){return e("toggleMute"),this},this.setVolume=function(n){return e("setVolume",n),this},this.increaseVolume=function(n){return e("increaseVolume",n),this},this.decreaseVolume=function(n){return e("decreaseVolume",n),this},this.loop=function(){return e("loop"),this},this.unloop=function(){return e("unloop"),this},this.setSpeed=function(n){return e("setSpeed",n),this},this.setTime=function(n){return e("setTime",n),this},this.set=function(n,s){return e("set",n,s),this},this.bind=function(n,s){return e("bind",n,s),this},this.unbind=function(n){return e("unbind",n),this},this.bindOnce=function(n,s){return e("bindOnce",n,s),this},this.trigger=function(n){return e("trigger",n),this},this.fade=function(n,s,l,r){return e("fade",n,s,l,r),this},this.fadeIn=function(n,s){return e("fadeIn",n,s),this},this.fadeOut=function(n,s){return e("fadeOut",n,s),this};function e(){for(var n=i(null,arguments),s=n.shift(),l=0;l<t.length;l++)t[l][s].apply(t[l],n)}function i(n,s){return n instanceof Array?n:Array.prototype.slice.call(s)}},all:function(){return new h.group(h.sounds)},isSupported:function(){return!!h.el.canPlayType},isOGGSupported:function(){return!!h.el.canPlayType&&h.el.canPlayType('audio/ogg; codecs="vorbis"')},isWAVSupported:function(){return!!h.el.canPlayType&&h.el.canPlayType('audio/wav; codecs="1"')},isMP3Supported:function(){return!!h.el.canPlayType&&h.el.canPlayType("audio/mpeg;")},isAACSupported:function(){return!!h.el.canPlayType&&(h.el.canPlayType("audio/x-m4a;")||h.el.canPlayType("audio/aac;"))},toTimer:function(t,e){var i,n,s;return i=Math.floor(t/3600),i=isNaN(i)?"--":i>=10?i:"0"+i,n=Math.floor(e?t/60%60:t/60),n=isNaN(n)?"--":n>=10?n:"0"+n,s=Math.floor(t%60),s=isNaN(s)?"--":s>=10?s:"0"+s,e?i+":"+n+":"+s:n+":"+s},fromTimer:function(t){var e=t.toString().split(":");return e&&e.length===3&&(t=parseInt(e[0],10)*3600+parseInt(e[1],10)*60+parseInt(e[2],10)),e&&e.length===2&&(t=parseInt(e[0],10)*60+parseInt(e[1],10)),t},toPercent:function(t,e,i){var n=Math.pow(10,i||0);return Math.round(t*100/e*n)/n},fromPercent:function(t,e,i){var n=Math.pow(10,i||0);return Math.round(e/100*t*n)/n}};return h})});var ie=class{#e={};bind(h,t,e){(!Array.isArray(this.#e[h])||typeof this.#e[h]>"u")&&(this.#e[h]=[]),this.#e[h].push({listener:t,caller:e})}on(h,t,e){this.bind(h,t,e)}addEventListener(h,t,e){this.bind(h,t,e)}fire(h,t,e){if(!h||typeof h!="string")throw new Error("Event missing.");if(Array.isArray(this.#e[h])){!t||t===null||typeof t>"u"?t=[]:Array.isArray(t)||(t=[t]),e=e||this;for(var i=this.#e[h],n=0,s=i.length;n<s;n++)i[n].listener.apply(i[n].caller||e,t)}}emit(h,...t){this.fire(h,t)}dispatchEvent(h,t,e){this.fire(h,t,e)}unbind(h,t){if(!h||!t||!Array.isArray(this.#e[h]))return;let e=this.#e[h];for(let i=e.length-1;i>=0;i--)if(e[i].listener===t){e.splice(i,1);break}}remove(h,t){this.unbind(h,t)}off(h,t){this.unbind(h,t)}removeListener(h,t){this.unbind(h,t)}removeAllListeners(h){if(!h){this.#e=[];return}Array.isArray(this.#e[h])&&delete this.#e[h]}removeListenersFromCaller(h,t){if(!t){Object.keys(this.#e).forEach(i=>{let n=this.#e[i];for(let s=n.length-1;s>=0;s--)if(n[s].caller===h){n.splice(s,1);break}});return}if(!Array.isArray(this.#e[t]))return;let e=this.#e[t];for(let i=0,n=e.length;i<n;i++)if(e[i].caller===h){e.splice(i,1);break}}listeners(h){return h?this.#e[h]||[]:this.#e}};Array.prototype.filter||(Array.prototype.filter=function(u){var h=this.length>>>0;if(typeof u!="function")throw new TypeError;for(var t=[],e=arguments[1],i=0;i<h;i++)if(i in this){var n=this[i];u.call(e,n,i,this)&&t.push(n)}return t});function $i(u,h){return u.priority>h.priority?-1:u.priority<h.priority?1:0}function Ni(u,h){return u.priority>h.priority?-1:u.priority<h.priority?1:u.index<h.index?-1:u.index>h.index?1:0}function U(u){let h=u.map((t,e)=>({index:e,priority:t.priority}));return h.sort(Ni),h.map(t=>u[t.index])}function Fe(u,h,t){let e=[];if(!u||u.length===0)return e;let i=u.length;for(let n=0;n<i;n++)u[n].enabled&&u[n][h]===t&&e.push(u[n]);return e.length<=1?e:e.sort($i)}var yt=document.createElement("div");function ae(u){return yt.textContent=u,yt.innerHTML}function Ht(u){return yt.innerHTML=u,yt.textContent}function G(u){return u=u.replace(/^"(.+(?="$))?"$/,"$1"),u=u.replace(/^'(.+(?='$))?'$/,"$1"),u}var Be=class{constructor(h){this.length=0;typeof h=="string"&&h.length>0?this.buffer=[h]:this.buffer=[],this.length=0}prepend(h){return this.buffer.unshift(h),this.length+=h.length,this}append(h){return this.buffer.push(h),this.length+=h.length,this}push(h){typeof h=="number"?this.appendCode(h):this.append(h)}appendCode(h){return this.buffer.push(String.fromCharCode(h)),this.length++,this}toString(){return this.buffer.join("")}clear(h){return this.buffer=[],this.length=0,h&&typeof h<"u"&&h.length&&(this.buffer.push(h),this.length=h.length),this}concat(h){this.buffer=this.buffer.concat(h)}};function wt(u,h){if(u.length>1)return!1;if(u==="-"||u==="_"||u==="."||u==="~"||u==="!"||u==="*"||u==="'"||u===";"||u===":"||u==="@"||u==="&"||u==="="||u==="+"||u==="$"||u===","||u==="/"||u==="\\"||u==="?"||u==="%"||u==="#"||u==="["||u==="]"||u==="("||u===")")return!h;let t=u.charCodeAt(0);return t>64&&t<91||t>96&&t<123||t>47&&t<58||t>=160&&t<=55295||t>=57344&&t<=64975||t>=65008&&t<=65533||t>=65536&&t<=131069||t>=131072&&t<=196605||t>=196608&&t<=262141||t>=262144&&t<=327677||t>=327680&&t<=393213||t>=393216&&t<=458749||t>=458752&&t<=524285||t>=524288&&t<=589821||t>=589824&&t<=655357||t>=655360&&t<=720893||t>=720896&&t<=786429||t>=786432&&t<=851965||t>=851968&&t<=917501||t>=921600&&t<=983037||t>=983040&&t<=1048573||t>=1048576&&t<=1114109}var Ze={3:"Cancel",6:"Help",8:"Backspace",9:"Tab",19:"Pause/Break",20:"Caps Lock",21:"Kana",22:"Eisu",23:"Junja",24:"Final",25:"Hanja",27:"Esc",28:"Convert",29:"Nonconvert",30:"Accept",31:"Modechange",32:"Space",33:"Page Up",34:"Page Down",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",41:"Select",42:"Print",43:"Execute",44:"Printscreen",45:"Insert",46:"Delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",58:"Colon",59:"Semicolon",60:"Less Than",61:"Equals2",62:"Greater Than",63:"Question Mark",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",93:"Context Menu",95:"Sleep",96:"Numpad 0",97:"Numpad 1",98:"Numpad 2",99:"Numpad 3",100:"Numpad 4",101:"Numpad 5",102:"Numpad 6",103:"Numpad 7",104:"Numpad 8",105:"Numpad 9",106:"Numpad *",107:"Numpad +",109:"Numpad -",110:"Numpad .",111:"Numpad /",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",124:"F13",125:"F14",126:"F15",127:"F16",128:"F17",129:"F18",130:"F19",131:"F20",132:"F21",133:"F22",134:"F23",135:"F24",144:"Num Lock",145:"Scroll Lock",146:"Win Oem Fj Jisho",147:"Win Oem Fj Masshou",148:"Win Oem Fj Touroku",149:"Win Oem Fj Loya",150:"Win Oem Fj Roya",160:"Circumflex",161:"Exclamation",162:"Double Quote",163:"Hash",164:"Dollar",165:"Percent",166:"Ampersand",167:"Underscore",168:"Open Paren",169:"Close Paren",170:"Asterisk",171:"Plus",172:"Pipe",173:"Hyphen Minus",174:"Open Curly Bracket",175:"Close Curly Bracket",176:"Tilde",181:"Volume Mute",182:"Volume Down",183:"Volume Up",186:";",187:"Equals",188:",",189:"Minus",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",227:"Win Ico Help",228:"Win Ico 00",230:"Win Ico Clear",233:"Win Oem Reset",234:"Win Oem Jump",235:"Win Oem Pa1",236:"Win Oem Pa2",237:"Win Oem Pa3",238:"Win Oem Wsctrl",239:"Win Oem Cusel",240:"Win Oem Attn",241:"Win Oem Finish",242:"Win Oem Copy",243:"Win Oem Auto",244:"Win Oem Enlw",245:"Win Oem Backtab",246:"Attn",247:"Crsel",248:"Exsel",249:"Ereof",250:"Play",251:"Zoom",253:"Pa1",254:"Win Oem Clear"},ai={Cancel:3,Help:6,Backspace:8,Tab:9,"Pause/Break":19,"Caps Lock":20,Esc:27,Space:32,"Page Up":33,"Page Down":34,End:35,Home:36,Left:37,Up:38,Right:39,Down:40,Insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,"Numpad 0":96,"Numpad 1":97,"Numpad 2":98,"Numpad 3":99,"Numpad 4":100,"Numpad 5":101,"Numpad 6":102,"Numpad 7":103,"Numpad 8":104,"Numpad 9":105,"Numpad *":106,"Numpad +":107,"Numpad -":109,"Numpad .":110,"Numpad /":111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,"Num Lock":144,"Scroll Lock":145,";":186,",":188,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222,Kana:21,Eisu:22,Junja:23,Final:24,Hanja:25,Convert:28,Nonconvert:29,Accept:30,Modechange:31,Select:41,Print:42,Execute:43,Printscreen:44,Colon:58,Semicolon:59,"Less Than":60,Equals2:61,"Greater Than":62,"Question Mark":63,"Context Menu":93,Sleep:95,F13:124,F14:125,F15:126,F16:127,F17:128,F18:129,F19:130,F20:131,F21:132,F22:133,F23:134,F24:135,"Win Oem Fj Jisho":146,"Win Oem Fj Masshou":147,"Win Oem Fj Touroku":148,"Win Oem Fj Loya":149,"Win Oem Fj Roya":150,Circumflex:160,Exclamation:161,"Double Quote":162,Hash:163,Dollar:164,Percent:165,Ampersand:166,Underscore:167,"Open Paren":168,"Close Paren":169,Asterisk:170,Plus:171,Pipe:172,"Hyphen Minus":173,"Open Curly Bracket":174,"Close Curly Bracket":175,Tilde:176,"Volume Mute":181,"Volume Down":182,"Volume Up":183,Equals:187,Minus:189,"Win Ico Help":227,"Win Ico 00":228,"Win Ico Clear":230,"Win Oem Reset":233,"Win Oem Jump":234,"Win Oem Pa1":235,"Win Oem Pa2":236,"Win Oem Pa3":237,"Win Oem Wsctrl":238,"Win Oem Cusel":239,"Win Oem Attn":240,"Win Oem Finish":241,"Win Oem Copy":242,"Win Oem Auto":243,"Win Oem Enlw":244,"Win Oem Backtab":245,Attn:246,Crsel:247,Exsel:248,Ereof:249,Play:250,Zoom:251,Pa1:253,"Win Oem Clear":254};(function(u){u.fn.hasHorizontalScrollBar=function(){return u(this)[0].scrollWidth>u(this).innerWidth()}})(jQuery);function Te(u,h){return JSON.parse(JSON.stringify(u,h))}function hi(u){!u||u.value.length===0||(u.setSelectionRange?(u.focus(),u.setSelectionRange(0,u.value.length)):u.select())}CanvasRenderingContext2D.prototype.fillRoundedRect=function(u,h,t,e,i){this.beginPath(),this.moveTo(u+i,h),this.lineTo(u+t-i,h),this.quadraticCurveTo(u+t,h,u+t,h+i),this.lineTo(u+t,h+e-i),this.quadraticCurveTo(u+t,h+e,u+t-i,h+e),this.lineTo(u+i,h+e),this.quadraticCurveTo(u,h+e,u,h+e-i),this.lineTo(u,h+i),this.quadraticCurveTo(u,h,u+i,h),this.closePath(),this.fill()};CanvasRenderingContext2D.prototype.strokeRoundedRect=function(u,h,t,e,i){this.beginPath(),this.moveTo(u+i,h),this.lineTo(u+t-i,h),this.quadraticCurveTo(u+t,h,u+t,h+i),this.lineTo(u+t,h+e-i),this.quadraticCurveTo(u+t,h+e,u+t-i,h+e),this.lineTo(u+i,h+e),this.quadraticCurveTo(u,h+e,u,h+e-i),this.lineTo(u,h+i),this.quadraticCurveTo(u,h,u+i,h),this.closePath(),this.stroke()};Object.keys||(Object.keys=function(u){if(u!==Object(u))throw new TypeError("Object.keys called on a non-object");var h=[],t;for(t in u)Object.prototype.hasOwnProperty.call(u,t)&&h.push(t);return h});Object.toType||(Object.toType=function(u){return{}.toString.call(u).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()});typeof String.prototype.startsWith!="function"&&(String.prototype.startsWith=function(u){return this.slice(0,u.length)==u});typeof String.prototype.endsWith!="function"&&(String.prototype.endsWith=function(u){return this.slice(-u.length)==u});typeof String.prototype.splice!="function"&&(String.prototype.splice=function(u,h,t){return typeof t>"u"&&(t=0),this.slice(0,u)+h+this.slice(u+Math.abs(t))});typeof String.prototype.padStart!="function"&&(String.prototype.padStart=function(u){return typeof u=="number"&&(u=" ".repeat(u)),String(u+this).slice(-u.length)});typeof String.prototype.padEnd!="function"&&(String.prototype.padEnd=function(u){return typeof u=="number"?u<=this.length?this:(u=" ".repeat(u-this.length),this+u):u.length<=this.length?this:this+u.slice(-this.length)});String.prototype.replaceAll||(String.prototype.replaceAll=function(u,h){return Object.prototype.toString.call(u).toLowerCase()==="[object regexp]"?this.replace(u,h):this.replace(new RegExp(u,"g"),h)});typeof Uint8Array.prototype.charAt!="function"&&(Uint8Array.prototype.charAt=function(u){return String.fromCharCode(this[u])});typeof Uint8Array.prototype.charCodeAt!="function"&&(Uint8Array.prototype.charCodeAt=function(u){return this[u]});function Fi(u,h){return!u||!u.length?u:h?u.replace(/\\/g,"\\\\").replace(/\u0008/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/'/g,"\\'").replace(/"/g,'\\"').replace(/\u0000/g,"\\0"):u.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/"/g,'\\"')}String.prototype.addSlashes=function(){return Fi(this)};String.prototype.splitQuote=function(u,h,t,e){if(this.length===0)return[];if(!u||!u.length)return[this];h||(h=3),t||(t=3),e||(e="\\");let i=!1,n=!1,s=[],l=0,r=0,a,o="",f,p=u.length,g,c=this.length;for(;r<c;r++){if(a=this.charAt(r),a==='"'&&(h&2)===2)(t&2)===2?(r===0||o!==e)&&(i=!i):i=!i;else if(a==="'"&&(h&1)===1)(t&1)===1?(r===0||o!==e)&&(n=!n):n=!n;else if(!i&&!n){for(f=0;f<p;f++)if(g=u.charAt(f),a===g)if(r>l||r===0){s.push(this.substr(l,r-l)),l=r+1;break}else if(r===l){s.push(""),l=r+1;break}else r===c-1&&s.push("")}o=a}return r===c&&r===l&&u.indexOf(o)!==-1&&(s.push(""),l=r+1),r>l&&s.push(this.substr(l,r-l)),s};function Ut(u){let h,t=[];return h=Math.floor(u/(1e3*60*60*24)),u-=h*(1e3*60*60*24),h===1?t.push(h+" day"):h>0&&t.push(h+" days"),h=Math.floor(u/(1e3*60*60)),u-=h*(1e3*60*60),h===1?t.push(h+" hour"):h>0&&t.push(h+" hours"),h=Math.floor(u/(1e3*60)),u-=h*(1e3*60),h===1?t.push(h+" minute"):h>0&&t.push(h+" minutes"),h=Math.floor(u/1e3),u-=h*1e3,h===1?t.push(h+" second"):h>0&&t.push(h+" seconds"),t.length===0&&t.push("0 seconds"),t.join(", ")}function he(u,h){if(!u)return"";u=u.split(" ");let t,e,i,n=h?1:u.length;for(e=0;e<n;e++){let s=u[e].length;for(i=0;i<s;i++)if(t=u[e].charAt(i),t>="a"&&t<="z"||t>="A"&&t<="Z"){u[e]=u[e].substr(0,i)+t.toUpperCase()+u[e].substr(i+1).toLowerCase();break}}return u.join(" ")}function vt(u,h,t,e,i){if(typeof t>"u"&&(t=3),typeof e>"u"&&(e=0),typeof i>"u"&&(i="\\"),!u||u.length===0)return[];if(!h||h.length===0)return[u];h=h.split("");let n=!1,s=!1,l=[],r=0,a=0,o=u.length,f;for(;a<o;a++)if(f=u.charAt(a),f==='"'&&(t&2)===2)(e&2)===2&&a>0?a-1>0&&u.charAt(a-1)!==i&&(n=!n):n=!n;else if(f==="'"&&(t&1)===1)(e&1)===1&&a>0?a-1>0&&u.charAt(a-1)!==i&&(s=!s):s=!s;else if(!s&&!n){let p=h.length;for(let g=0;g<p;g++)if(f===h[g])if(a>r||a===0){l.push(u.substring(r,a)),r=a+1;break}else if(a===r){l.push(""),r=a+1;break}else a===o-1&&l.push("")}return a===o&&a===r&&h.indexOf(u.charAt(a-1))>-1&&(l.push(""),r=a+1),a>r&&l.push(u.substring(r,a)),l}function ci(u){if(!u)return 0;if(typeof u.selectionStart=="number")return u.selectionDirection=="backward"?u.selectionStart:u.selectionEnd;if(document.selection){u.focus();var h=document.selection.createRange();return h.moveStart("character",-u.value.length),h.text.length}return 0}var Z;function jt(u){u=u||"",u=u.split("%^"),Z||Gi();let h=[],t=[],e=0,i=u.length,n=!1,s=!1,l=[];for(;e<i;e++)switch(u[e]){case"ITALIC":h.push("<em>"),t.push("</em>");break;case"UNDERLINE":l.push("underline");break;case"STRIKEOUT":l.push("strikeout");break;case"DBLUNDERLINE":l.push("dblunderline");break;case"OVERLINE":l.push("overline");break;case"FLASH":l.push("noflash");break;case"REVERSE":l.push("reverse");break;case"RESET":case"DEFAULT":let r=t.length;for(let a=0;a<r;a++)h.push(t[a]);t=[],l=[];break;case"BOLD":n=!0;break;case"":break;default:if(u[e].startsWith("B_")){u[e]=u[e].substr(2),n&&!s&&(h.push('<span style="border: inherit;text-decoration:inherit;color: #'+Z["BOLD%^%^WHITE"]+'">'),t.push("</span>")),h.push('<span style="border: inherit;text-decoration:inherit;background-color: #'+Z[u[e]]+'">'),t.push("</span>"),n=!1;continue}else if(Z[u[e]]){if(n&&!Z["BOLD%^%^"+u[e]])h.push('<span style="border: inherit;text-decoration:inherit;color: #'+Z["BOLD%^%^WHITE"]+'">'),t.push("</span>"),s=!0;else if(n){h.push('<span style="border: inherit;text-decoration:inherit;color: #'+Z["BOLD%^%^"+u[e]]+'">'),t.push("</span>"),s=!0;continue}h.push('<span style="border: inherit;text-decoration:inherit;color: #'+Z[u[e]]+'">'),t.push("</span>");continue}else n&&!s&&(h.push('<span style="border: inherit;text-decoration:inherit;color: #'+Z["BOLD%^%^WHITE"]+'">'),t.push("</span>"));l.length&&(h.push('<span class="'+l.join(" ")+'">'),t.push("</span>"),l=[]),h.push(u[e]),n=!1,s=!1;break}for(l.length&&(h.push('<span class="'+l.join(" ")+'">'),t.push("</span>")),e=0,i=t.length;e<i;e++)h.push(t[e]);return h.join("")}function Gi(){let u,h,t,e,i,n;for(Z={},Z.BLACK="000000",Z.RED="800000",Z.GREEN="008000",Z.ORANGE="808000",Z.BLUE="0000EE",Z.MAGENTA="800080",Z.CYAN="008080",Z.WHITE="BBBBBB",Z.mono11="808080",Z["BOLD%^%^RED"]="FF0000",Z["BOLD%^%^GREEN"]="00FF00",Z.YELLOW="FFFF00",Z["BOLD%^%^YELLOW"]="FFFF00",Z["BOLD%^%^BLUE"]="5C5CFF",Z["BOLD%^%^MAGENTA"]="FF00FF",Z["BOLD%^%^CYAN"]="00FFFF",Z["BOLD%^%^WHITE"]="FFFFFF",Z["BOLD%^%^BLACK"]="808080",t=0;t<6;t++)for(e=0;e<6;e++)for(i=0;i<6;i++)n=`RGB${t}${e}${i}`,h="",u=0,u=t*40+55,u<16&&(h+="0"),h+=u.toString(16),u=0,u=e*40+55,u<16&&(h+="0"),h+=u.toString(16),u=0,u=i*40+55,u<16&&(h+="0"),h+=u.toString(16),Z[n]||(Z[n]=h.toUpperCase());for(t=232;t<=255;t++)e=(t-232)*10+8,e<16?e="0"+e.toString(16).toUpperCase():e=e.toString(16).toUpperCase(),e=e+e+e,t<242?Z["mono0"+(t-232)]=e:Z["mono"+(t-232)]=e}function ui(){let u=[],h,t,e,i;for(h=0;h<6;h++)for(t=0;t<6;t++)for(e=0;e<6;e++)i=16+h*36+t*6+e,u[i]="rgb(",h>0?u[i]+=h*40+55:u[i]+="0",u[i]+=",",t>0?u[i]+=t*40+55:u[i]+="0",u[i]+=",",e>0?u[i]+=e*40+55:u[i]+="0",u[i]+=")";for(h=232;h<=255;h++)t=(h-232)*10+8,u[h]=["rgb(",t,",",t,",",t,")"].join("");return u[0]="rgb(0,0,0)",u[1]="rgb(128, 0, 0)",u[2]="rgb(0, 128, 0)",u[3]="rgb(128, 128, 0)",u[4]="rgb(0, 0, 238)",u[5]="rgb(128, 0, 128)",u[6]="rgb(0, 128, 128)",u[7]="rgb(187, 187, 187)",u[8]="rgb(128, 128, 128)",u[9]="rgb(255, 0, 0)",u[10]="rgb(0, 255, 0)",u[11]="rgb(255, 255, 0)",u[12]="rgb(92, 92, 255)",u[13]="rgb(255, 0, 255)",u[14]="rgb(0, 255, 255)",u[15]="rgb(255, 255, 255)",u[256]="rgb(0, 0, 0)",u[257]="rgb(118, 0, 0)",u[258]="rgb(0, 108, 0)",u[259]="rgb(145, 136, 0)",u[260]="rgb(0, 0, 167)",u[261]="rgb(108, 0, 108)",u[262]="rgb(0, 108, 108)",u[263]="rgb(161, 161, 161)",u[264]="rgb(0, 0, 0)",u[265]="rgb(128, 0, 0)",u[266]="rgb(0, 128, 0)",u[267]="rgb(128, 128, 0)",u[268]="rgb(0, 0, 238)",u[269]="rgb(128, 0, 128)",u[270]="rgb(0, 128, 128)",u[271]="rgb(187, 187, 187)",u[272]="rgb(0,0,0)",u[273]="rgb(0, 255, 255)",u[274]="rgb(0,0,0)",u[275]="rgb(255, 255, 0)",u[276]="rgb(0, 0, 0)",u[277]="rgb(229, 229, 229)",u[278]="rgb(205, 0, 0)",u[279]="rgb(229, 229, 229)",u[280]="rgb(255,255,255)",u}function qe(u,h){return u&&(/^\d+c$/.test(u)?h?parseInt(u,10)*h+"px":u+"h":/^\d+$/.test(u)?parseInt(u,10)+"px":u)}function Re(u){return!u||u.length===0||!u.match(/^[a-zA-Z_$][a-zA-Z_$0-9]*$/g)?!1:["break","case","catch","continue","debugger","default","delete","do","else","finally","for","function","if","in","instanceof","new","return","switch","this","throw","try","typeof","var","void","while","with","class","const","enum","export","extends","import","super","implements","interface","let","package","private","protected","public","static","yield","null","true","false","NaN","Infinity","undefined","eval","arguments"].indexOf(u)===-1}function Ge(u,h){if(!u)return;let t=document.activeElement;(!t||t!=u)&&u.focus(),document.execCommand("insertText",!1,h),t&&t!=u&&t.focus()}Array.isArray||(Array.isArray=function(u){return Object.prototype.toString.call(u)==="[object Array]"});var li;function Xe(u){return window.TextDecoder!==void 0?(li||(li=new TextDecoder)).decode(new Uint8Array(u)):Wi(String.fromCharCode.apply(null,Array.prototype.slice.apply(new Uint8Array(u))))}function Wi(u){var h;try{return decodeURIComponent(escape(u))}catch(t){if(h=t,h instanceof URIError)return u;throw h}}function zi(u){var h,t,e,i,n,s;for(n=u.length,h=[],i=!1,e=s=0;0<=n?s<n:s>n;e=0<=n?++s:--s)if(t=String.prototype.charCodeAt.call(u,e),t>255){i=!0,h=null;break}else h.push(t);return i===!0?unescape(encodeURIComponent(u)):String.fromCharCode.apply(null,Array.prototype.slice.apply(h))}var oi;function Oe(u){var h,t,e,i,n,s;if(window.TextEncoder!==void 0)return(oi||(oi=new TextEncoder)).encode(u);for(h=zi(u),t=h.length,e=new ArrayBuffer(t),i=new Uint8Array(e),n=s=0;0<=t?s<t:s>t;n=0<=t?++s:--s)i[n]=String.prototype.charCodeAt.call(h,n);return i}function at(u){return new Promise(function(h,t){try{if(typeof navigator<"u"&&typeof navigator.clipboard<"u"&&typeof navigator.permissions<"u"){var e=new Blob([u],{type:"text/plain"}),i=[new ClipboardItem({"text/plain":e})];navigator.permissions.query({name:"clipboardWrite"}).then(function(s){s.state==="granted"||s.state==="prompt"?navigator.clipboard.write(i).then(h,t).catch(t):t(new Error("Permission not granted!"))})}else if(document.queryCommandSupported&&document.queryCommandSupported("copy")){var n=document.createElement("textarea");n.value=u,n.textContent=u,n.style.position="fixed",n.style.width="2em",n.style.height="2em",n.style.padding="0",n.style.border="none",n.style.outline="none",n.style.boxShadow="none",n.style.background="transparent",document.body.appendChild(n),n.focus(),n.select();try{document.execCommand("copy"),document.body.removeChild(n),h(null)}catch(s){document.body.removeChild(n),t(s)}}else t(new Error("None of copying methods are supported by this browser!"))}catch(s){t(s)}})}function qt(){return new Promise(function(u,h){try{if(typeof navigator<"u"&&typeof navigator.clipboard<"u"&&typeof navigator.permissions<"u")navigator.permissions.query({name:"clipboardRead"}).then(function(e){e.state==="granted"||e.state==="prompt"?navigator.clipboard.readText().then(u,h).catch(h):h(new Error("Permission not granted!"))});else if(document.queryCommandSupported&&document.queryCommandSupported("paste")){var t=document.createElement("textarea");t.style.position="fixed",t.style.width="2em",t.style.height="2em",t.style.padding="0",t.style.border="none",t.style.outline="none",t.style.boxShadow="none",t.style.background="transparent",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("paste",!1,null),u(t.value),document.body.removeChild(t)}catch(e){document.body.removeChild(t),h(e)}}else h(new Error("None of pasting methods are supported by this browser!"))}catch(e){h(e)}})}function Xt(u,h){if(!u)return null;h||(h=window.location.href),u=u.replace(/[[\]]/g,"\\$&");var t=new RegExp("[?&]"+u+"(=([^&#]*)|&|#|$)"),e=t.exec(h);return e?e[2]?decodeURIComponent(e[2].replace(/\+/g," ")):"":null}function Hi(){var u="download"in document.createElement("a"),h=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,t=window.URL||window.webkitURL||window.mozURL||window.msURL;navigator.saveBlob=navigator.saveBlob||navigator.msSaveBlob||navigator.mozSaveBlob||navigator.webkitSaveBlob,window.saveAs=window.saveAs||window.webkitSaveAs||window.mozSaveAs||window.msSaveAs;var e={"image/jpeg":!0,"image/png":!0,"image/gif":!0,"image/svg+xml":!0,"image/bmp":!0,"image/x-windows-bmp":!0,"image/webp":!0,"audio/wav":!0,"audio/mpeg":!0,"audio/webm":!0,"audio/ogg":!0,"video/mpeg":!0,"video/webm":!0,"video/ogg":!0,"text/plain":!0,"text/html":!0,"text/xml":!0,"application/xhtml+xml":!0,"application/json":!0};h&&(window.saveAs||navigator.saveBlob)?this.show=function(i,n,s){var l=new h;l.append(i);var r=l.getBlob(s||"application/octet-stream");n||(n="Download.bin"),window.saveAs?window.saveAs(r,n):navigator.saveBlob(r,n)}:h&&t?this.show=function(i,n,s){var l,r,a=new h;if(a.append(i),s||(s="application/octet-stream"),u){l=a.getBlob(s),r=t.createObjectURL(l);var o=document.createElement("a");o.setAttribute("href",r),o.setAttribute("download",n||"Download.bin");var f=document.createEvent("MouseEvents");f.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),o.dispatchEvent(f)}else e[s.split(";")[0]]===!0&&(s="application/octet-stream"),l=a.getBlob(s),r=t.createObjectURL(l),window.open(r,"_blank","");setTimeout(function(){t.revokeObjectURL(r)},250)}:Blob&&t?this.show=function(i,n,s){var l,r;if(s||(s="application/octet-stream"),l=new Blob([i],{type:s}),u){r=t.createObjectURL(l);var a=document.createElement("a");a.setAttribute("href",r),a.setAttribute("download",n||"Download.bin");var o=document.createEvent("MouseEvents");o.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),a.dispatchEvent(o)}else e[s.split(";")[0]]===!0&&(s="application/octet-stream"),r=t.createObjectURL(l),window.open(r,"_blank","");setTimeout(function(){t.revokeObjectURL(r)},250)}:/\bMSIE\b/.test(navigator.userAgent)||(this.show=function(i,n,s){s||(s="application/octet-stream"),e[s.split(";")[0]]===!0&&(s="application/octet-stream"),window.open("data:"+s+","+encodeURIComponent(i),"_blank","")})}window.fileSaveAs=new Hi;function Ui(){var u,h;function t(e,i){var n=e.charCodeAt(h);if(!(n&128))u=n;else if((n&224)==192)u=(n&31)<<6|e.charCodeAt(h+1)&63,h+=1;else if((n&240)==224)u=(n&15)<<12|(e.charCodeAt(h+1)&63)<<6|e.charCodeAt(h+2)&63,h+=2;else if((n&248)==240)u=(n&7)<<18|(e.charCodeAt(h+1)&63)<<12|(e.charCodeAt(h+2)&63)<<6|e.charCodeAt(h+3)&63,h+=1;else return!1;return!0}this.decode=function(e){var i=new Be,n=e.length;for(h=0;h<n;h++)t(e,n)&&i.appendCode(u);return i.toString()},this.decode2=function(e){var i=new Be,n=e.length,s,l;for(s=0;s<n;s++){if(l=e.charCodeAt(s),l&128)if((l&224)==192)l=(l&31)<<6|e.charCodeAt(s+1)&63,s+=1;else if((l&240)==224)l=(l&15)<<12|(e.charCodeAt(s+1)&63)<<6|e.charCodeAt(s+2)&63,s+=2;else if((l&248)==240)l=(l&7)<<18|(e.charCodeAt(s+1)&63)<<12|(e.charCodeAt(s+2)&63)<<6|e.charCodeAt(s+3)&63,s+=1;else continue;i.appendCode(l)}return i.toString()}}window.UTF8=new Ui;function De(u){if(u===null||typeof u>"u")return u;var h,t,e=0;for(h=u.byteLength,t=new Be;e<h;e++)u[e]<32||u[e]>=127?t.append("<"+u[e]+">"):t.append(String.fromCharCode(u[e]));return t.toString()}function Vt(){let u=document.createElement("div");u.style.visibility="hidden",u.style.overflow="scroll",u.style.msOverflowStyle="scrollbar",document.body.appendChild(u);let h=document.createElement("div");u.appendChild(h);let t=u.offsetWidth-h.offsetWidth;return u.parentNode.removeChild(u),t}function ue(u,h,t){return new Promise((e,i)=>{let n=document.createElement("dialog");if(typeof n.showModal!="function"){i("Browser does not support dialogs.");return}n.id="openFileDialog",n.style.zIndex="2000",n.style.height="158px",n.style.width="350px",n.innerHTML=`<div class="dialog-header" style="font-weight: bold"><button type="button" class="btn btn-close float-end btn-danger" data-dismiss="modal" onclick="document.getElementById('openFileDialog').close();"></button><div>${u||"Open file..."}</div></div><div class="dialog-body"><div class="m-3"><input class="form-control" type="file" id="openFileDialog-files"${h?" multiple":""} required${t&&t.length?' accept="'+t+'"':""}></div></div><div class="dialog-footer"><button id="openFileDialog-cancel" style="float: right" type="button" class="btn btn-default" onclick="document.getElementById('openFileDialog').close();">Cancel</button><button id="openFileDialog-ok" style="float: right" type="button" class="btn btn-primary">Ok</button></div>`,document.body.appendChild(n),n.addEventListener("close",s=>{s.target===n&&(document.body.removeChild(n),n.returnValue!=="file-ok"&&i("closed"))}),n.addEventListener("cancel",s=>{s.target===n&&(document.body.removeChild(n),n.returnValue!=="file-ok"&&i("canceled"))}),document.getElementById("openFileDialog-ok").addEventListener("click",()=>{let s=document.getElementById("openFileDialog-files");if(!s.files||s.files.length===0){s.classList.add("is-invalid");return}s.classList.remove("is-invalid"),n.close(),n.returnValue="files-ok",e(s.files)}),n.showModal()})}function pe(u){return new Promise((h,t)=>{u||t(new Error("Invalid file"));var e=new FileReader;e.onerror=t,e.onload=i=>{h(i.target.result)},e.readAsText(u)})}var zt={};function be(u,h,t){t=t||"default",clearTimeout(zt[t]),zt[t]=setTimeout(()=>{u(),delete zt[t]},h)}function pi(u,h){let t=h.getBoundingClientRect(),e=u.getBoundingClientRect();(t.top<e.top||t.bottom>e.bottom||t.left<e.left||t.right>e.right)&&h.scrollIntoView({behavior:"smooth",block:"nearest"})}var mi=ri(di()),ht=class extends ie{constructor(t){super();this._splitBuffer=[];this._connected=!1;this._MTTS=0;this.zStream=0;this._latencyTime=null;this._doPing=!1;this._closed=!0;this._zlib=!1;this.options={MCCP:!0,MXP:!0,NAWS:!0,MSDP:!0,GMCP:!0,MSSP:!1,ECHO:!0,TTYPE:!0,EOR:!0,NEWENVIRON:!1,ZMP:!1,ATCP:!1,CHARSET:!0};this.host="";this.port=23;this.prompt=!1;this.echo=!0;this.firstSent=!0;this.firstReceived=!0;this.server={NAWS:!1,MSDP:!1,GMCP:!1,MXP:!1,MCCP1:!1,MCCP2:!1,MSSP:!1,NEWENVIRON:!1,ZMP:!1,EOR:!1,ATCP:!1,CHARSET:!1};this.version="2.0";this.terminal="ansi";this.UTF8=!0;this.MSSP={};this.socket=null;this.latency=0;this.latencyAvg=null;this.enableLatency=!1;this.enablePing=!1;this.GMCPSupports=["Core 1","Char 1","Char.Vitals 1","Char.Experience 1"];this.enableDebug=!1;this.scheme="ws://";this.protocol="binary";t&&("host"in t&&(t.host&&t.host.length&&(this.host=t.host),delete t.host),"port"in t&&(this.port=t.port,delete t.port),"scheme"in t&&(t.scheme&&t.scheme.length&&(this.scheme=t.scheme),delete t.scheme),"protocol"in t&&(t.protocol&&t.protocol.length&&(this.protocol=t.protocol),delete t.protocol)),this.options=Object.assign(this.options,t||{})}get connected(){return!this.socket||typeof this.socket>"u"?!1:this._connected}reset(){this._MTTS=0,this.firstSent=!0,this.firstReceived=!0,this.prompt=!1,this.echo=!0,this.server={NAWS:!1,MSDP:!1,GMCP:!1,MXP:!1,MCCP1:!1,MCCP2:!1,MSSP:!1,EOR:!1,NEWENVIRON:!1,ATCP:!1,CHARSET:!1,ZMP:!1},this._splitBuffer=[],this._endMCCP(),this._connected=!1,this._closed=!1,this.enableDebug&&this.emit("debug","Reset")}connect(){this._destroySocket(),this.reset(),this.emit("connecting"),this.socket=this._createSocket(this.host,this.port),this.enableDebug&&this.emit("debug","Connecting to "+this.host+":"+this.port)}close(){this._closed||(this._destroySocket(),this.reset(),this.emit("close"),this._closed=!0,this.enableDebug&&this.emit("debug","Closed"))}receivedData(t,e,i){this.enableLatency&&(this._latencyTime!==null?(this.latency=new Date().getTime()-this._latencyTime.getTime(),this.latencyAvg==null?this.latencyAvg=this.latency:this.latencyAvg=(this.latency+this.latencyAvg)/2,this._latencyTime=null,this._doPing=!1,this.emit("latency-changed",this.latency,this.latencyAvg)):!this._doPing&&this.enablePing?this._doPing=!0:(this._latencyTime=null,this._doPing=!1)),this.enableDebug&&this.emit("debug","PreProcess:"+t,1),t=this.processData(t,e,!1,i),this.enableDebug&&this.emit("debug","PostProcess:"+t,1),this.emit("received-data",t),this.enableLatency&&(this._splitBuffer.length>0?(this.enablePing&&(this._doPing=!0),this._latencyTime=null):this._doPing&&this.enablePing?setTimeout(()=>{this._latencyTime=new Date,this.sendGMCP("Core.Ping "+this.latencyAvg)}):this._doPing=!1)}sendTerminal(){if(this.enableDebug&&(this._MTTS===0?this.emit("debug","REPLY: <IAC><SB><TERMINALTYPE><IS>"+this.terminal+"<IAC><SE>"):this._MTTS===1?this.emit("debug","REPLY: <IAC><SB><TERMINALTYPE><IS>ANSI-256COLOR<IAC><SE>"):this._MTTS>=2&&this.emit("debug","REPLY: <IAC><SB><TERMINALTYPE><IS>MTTS 9<IAC><SE>")),this._MTTS===0){var t=new Uint8Array(6+this.terminal.length);t.set([255,250,24,0],0),t.set(Oe(this.terminal),4),t.set([255,240],4+this.terminal.length),this.sendData(t,!0)}else this._MTTS===1?this.sendData([255,250,24,0,65,78,83,73,45,50,53,54,67,79,76,79,82,255,240],!0):this._MTTS>=2&&this.sendData([255,250,24,0,77,84,84,83,32,57,255,240],!0)}sendData(t,e){if(!(t==null||typeof t>"u"||t.length===0)){if(this.connected)try{e||(this.prompt=!1,t=this._escapeData(t),this.enableLatency&&(this._latencyTime=new Date)),this.socket!==null&&(t instanceof Uint8Array?(this.enableDebug&&this.emit("debug","sendDataU8:"+De(t)),this.socket.send(t)):Array.isArray(t)?(this.enableDebug&&this.emit("debug","sendDataBA"+De(new Uint8Array(t))),this.socket.send(new Uint8Array(t))):(this.enableDebug&&this.emit("debug","sendDataR:"+De(Oe(t))),this.socket.send(t)),e||(this.firstSent=!1))}catch(i){this.emit("error",i)}else this.enableLatency&&(this._latencyTime=null);this.emit("data-sent",t,e)}}processData(t,e,i,n){let s,l="",r;if(t==null||(e||(t=this._decompressData(t)),s=t.byteLength,s===0))return t;r=this._splitBuffer,r.length>0&&(this.enableDebug&&this.emit("debug","Split buffer length: "+r.length,1),l=new Uint8Array(s+r.length),n?(l.set(t,0),l.set(r,t.byteLength)):(l.set(r,0),l.set(t,r.length)),t=l,r=[],s=t.byteLength);let a=0,o=0,f=new Be,p=this.prompt,g=0,c=0,S="",v="",d,b=0,L,P=0;l="",this.prompt=!1;let _="";try{for(;P<s;P++)switch(b=t[P],a){case 0:if(b===255)this.enableDebug&&(_="TELOP: <IAC>"),r.push(b),a=1;else if(this.UTF8||this.options.CHARSET&&this.server.CHARSET){if((b&128)===128&&P>=s-4){let j=0;if((b&192)===192?j=1:(b&224)===224?j=2:(b&240)===240&&(j=3),P+j>=s){r.push(...t.slice(P)),this.enableDebug&&(this.emit("debug","Unicode split length: "+j,1),this.emit("debug","Split buffer length: "+r.length,1));break}}f.appendCode(b)}else f.appendCode(b);break;case 1:if(b===255)this.enableDebug&&(this.emit("debug",_+"<IAC>"),_=""),f.appendCode(b),r=[],a=0;else if((!this.options.EOR||!this.server.EOR)&&b===239)this.enableDebug&&(this.emit("debug",_+"<NOP>"),_=""),r=[],a=0;else if(b===241||b===130)this.enableDebug&&(this.emit("debug",_+"<NOP>"),_=""),r=[],a=0;else if(b===249||b===239)this.enableDebug&&(b===239?this.emit("debug",_+"<EOR>"):this.emit("debug",_+"<GA>"),_=""),P+1<s&&s-P>2?(f.push(`
`),this.prompt=!1):this.prompt=!0,r=[],a=0;else if(b===253||b===254||b===251||b===252){if(this.enableDebug)switch(b){case 253:_+="<DO>";break;case 254:_+="<DONT>";break;case 251:_+="<WILL>";break;case 252:_+="<WONT>";break}r.push(b),g=b,a=2}else b===250?(this.enableDebug&&(_+="<SB>"),r.push(b),a=3):(this.enableDebug&&(_+=this._formatByte(b)),r=[],a=0);break;case 2:b===1?(this.enableDebug&&(this.emit("debug",_+"<ECHO>"),_=""),g===253?this.options.ECHO?(this.enableDebug&&this.emit("debug","REPLY: <IAC><WILL><ECHO>"),this.replyToOption(b,251,g),this.echo=!1):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><ECHO>"),this.echo=!0,this.replyToOption(b,254,g)):g===254?(this.enableDebug&&this.emit("debug","REPLY: <IAC><WONT><ECHO>"),this.replyToOption(b,252,g),this.echo=!0):g===251?this.options.ECHO?(this.enableDebug&&this.emit("debug","REPLY: <IAC><DO><ECHO>"),this.replyToOption(b,253,g),this.echo=!1):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><ECHO>"),this.echo=!0,this.replyToOption(b,254,g)):g===252&&(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><ECHO>"),this.echo=!0,this.replyToOption(b,254,g)),a=0,r=[]):b===24?(this.enableDebug&&(this.emit("debug",_+"<TERMINALTYPE>"),_=""),g===253?this.options.TTYPE?(this.enableDebug&&this.emit("debug","REPLY: <IAC><WILL><TERMINALTYPE>"),this.replyToOption(b,251,g)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><TERMINALTYPE>"),this.replyToOption(b,254,g)):g===254?(this.enableDebug&&this.emit("debug","REPLY: <IAC><WONT><TERMINALTYPE>"),this.replyToOption(b,252,g)):g===251?this.options.TTYPE?(this.enableDebug&&this.emit("debug","REPLY: <IAC><DO><TERMINALTYPE>"),this.replyToOption(b,253,g)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><TERMINALTYPE>"),this.replyToOption(b,254,g)):g===252&&(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><TERMINALTYPE>"),this.replyToOption(b,254,g)),a=0,r=[]):b===25?(this.enableDebug&&(this.emit("debug",_+"<ENDOFRECORD>"),_=""),g===253?(this.server.EOR=!0,this.options.EOR?(this.enableDebug&&this.emit("debug","REPLY: <IAC><WILL><ENDOFRECORD>"),this.replyToOption(b,251,g)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><ENDOFRECORD>"),this.replyToOption(b,254,g))):g===254?(this.enableDebug&&this.emit("debug","REPLY: <IAC><WONT><ENDOFRECORD>"),this.replyToOption(b,252,g)):g===251?(this.server.EOR=!0,this.options.EOR?(this.enableDebug&&this.emit("debug","REPLY: <IAC><DO><ENDOFRECORD>"),this.replyToOption(b,253,g)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><ENDOFRECORD>"),this.replyToOption(b,254,g))):g===252&&(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><ENDOFRECORD>"),this.replyToOption(b,254,g)),a=0,r=[]):b===31?(this.enableDebug&&(this.emit("debug",_+"<NAWS>"),_=""),g===253?(this.server.NAWS=!0,this.options.NAWS?(this.enableDebug&&this.emit("debug","REPLY: <IAC><WILL><NAWS>"),this.replyToOption(b,251,g)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><NAWS>"),this.replyToOption(b,254,g))):g===254?(this.server.NAWS=!1,this.enableDebug&&this.emit("debug","REPLY: <IAC><WONT><NAWS>"),this.replyToOption(b,252,g)):g===251?(this.server.NAWS=!0,this.options.NAWS?(this.enableDebug&&this.emit("debug","REPLY: <IAC><DO><NAWS>"),this.replyToOption(b,253,g)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><NAWS>"),this.replyToOption(b,254,g))):g===252&&(this.server.NAWS=!1,this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><NAWS>"),this.replyToOption(b,254,g)),this.emit("windowSize"),a=0,r=[]):b===36||b===39?(this.enableDebug&&(this.emit("debug",_+"<NEWENVIRON>"),_=""),g===253?(this.server.NEWENVIRON=!0,this.options.NEWENVIRON?(this.enableDebug&&this.emit("debug","REPLY: <IAC><WILL><NEWENVIRON>"),this.replyToOption(b,251,g)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><NEWENVIRON>"),this.replyToOption(b,254,g))):g===254?(this.enableDebug&&this.emit("debug","REPLY: <IAC><WONT><NEWENVIRON>"),this.replyToOption(b,252,g)):g===251?(this.server.NEWENVIRON=!0,this.options.NEWENVIRON?(this.enableDebug&&this.emit("debug","REPLY: <IAC><DO><NEWENVIRON>"),this.replyToOption(b,253,g)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><NEWENVIRON>"),this.replyToOption(b,254,g))):g===252&&(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><NEWENVIRON>"),this.replyToOption(b,254,g)),a=0,r=[]):b===69?(this.enableDebug&&(this.emit("debug",_+"<MSDP>"),_=""),g===253?(this.server.MSDP=!0,this.options.MSDP?(this.enableDebug&&this.emit("debug","REPLY: <IAC><WILL><MSDP>"),this.replyToOption(b,251,g)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><MSDP>"),this.replyToOption(b,254,g))):g===254?(this.server.MSDP=!1,this.enableDebug&&this.emit("debug","REPLY: <IAC><WONT><MSDP>"),this.replyToOption(b,252,g)):g===251?(this.server.MSDP=!0,this.options.MSDP?(this.enableDebug&&this.emit("debug","REPLY: <IAC><DO><MSDP>"),this.replyToOption(b,253,g)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><MSDP>"),this.replyToOption(b,254,g))):g===252&&(this.server.MSDP=!1,this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><MSDP>"),this.replyToOption(b,254,g)),a=0,r=[]):b===70?(this.enableDebug&&(this.emit("debug",_+"<MSSP>"),_=""),g===253?(this.server.MSSP=!0,this.options.MSSP?(this.enableDebug&&this.emit("debug","REPLY: <IAC><WILL><MSSP>"),this.replyToOption(b,251,g)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><MSSP>"),this.replyToOption(b,254,g))):g===254?(this.server.MSSP=!1,this.enableDebug&&this.emit("debug","REPLY: <IAC><WONT><MSSP>"),this.replyToOption(b,252,g)):g===251?(this.server.MSSP=!0,this.options.MSSP?(this.enableDebug&&this.emit("debug","REPLY: <IAC><DO><MSSP>"),this.replyToOption(b,253,g)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><MSSP>"),this.replyToOption(b,254,g))):g===252&&(this.server.MSSP=!1,this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><MSSP>"),this.replyToOption(b,254,g)),a=0,r=[]):b===85?(this.enableDebug&&(this.emit("debug",_+"<MCCP1>"),_=""),g===253?(this.server.MCCP1=!0,this.options.MCCP?(this.enableDebug&&this.emit("debug","REPLY: <IAC><WILL><MCCP1>"),this.replyToOption(b,251,g)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><MCCP1>"),this.replyToOption(b,254,g))):g===254?(this.server.MCCP1=!1,this.enableDebug&&this.emit("debug","REPLY: <IAC><WONT><MCCP1>"),this.replyToOption(b,252,g)):g===251?(this.server.MCCP1=!0,this.options.MCCP?(this.enableDebug&&this.emit("debug","REPLY: <IAC><DO><MCCP1>"),this.replyToOption(b,253,g)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><MCCP1>"),this.replyToOption(b,254,g))):g===252&&(this.server.MCCP1=!1,this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><MCCP1>"),this.replyToOption(b,254,g)),a=0,r=[]):b===86?(this.enableDebug&&(this.emit("debug",_+"<MCCP2>"),_=""),g===253?(this.server.MCCP2=!0,this.options.MCCP?(this.enableDebug&&this.emit("debug","REPLY: <IAC><WILL><MCCP2>"),this.replyToOption(b,251,g)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><MCCP2>"),this.replyToOption(b,254,g))):g===254?(this.server.MCCP2=!1,this.enableDebug&&this.emit("debug","REPLY: <IAC><WONT><MCCP2>"),this.replyToOption(b,252,g)):g===251?(this.server.MCCP2=!0,this.options.MCCP?(this.enableDebug&&this.emit("debug","REPLY: <IAC><DO><MCCP2>"),this.replyToOption(b,253,g)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><MCCP2>"),this.replyToOption(b,254,g))):g===252&&(this.server.MCCP2=!1,this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><MCCP2>"),this.replyToOption(b,254,g)),a=0,r=[]):b===91?(this.enableDebug&&(this.emit("debug",_+"<MXP>"),_=""),g===253?(this.server.MXP=!0,this.options.MXP?(this.enableDebug&&this.emit("debug","REPLY: <IAC><WILL><MXP>"),this.replyToOption(b,251,g)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><MXP>"),this.replyToOption(b,254,g))):g===254?(this.server.MXP=!1,this.enableDebug&&this.emit("debug","REPLY: <IAC><WONT><MXP>"),this.replyToOption(b,252,g)):g===251?(this.server.MXP=!0,this.options.MXP?(this.enableDebug&&this.emit("debug","REPLY: <IAC><DO><MXP>"),this.replyToOption(b,253,g)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><MXP>"),this.replyToOption(b,254,g))):g===252&&(this.server.MXP=!1,this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><MXP>"),this.replyToOption(b,254,g)),a=0,r=[]):b===130||b===241?(this.enableDebug&&(this.emit("debug",_+"<NOP>"),_=""),this._fireReceiveOption(b,g,""),r=[],a=0):b===201?(this.enableDebug&&(this.emit("debug",_+"<GMCP>"),_=""),g===253?(this.server.GMCP=!0,this.options.GMCP?(this.enableDebug&&this.emit("debug","REPLY: <IAC><WILL><GMCP>"),this.replyToOption(b,251,g),this._startGMCP()):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><GMCP>"),this.replyToOption(b,254,g))):g===254?(this.server.GMCP=!1,this.enableDebug&&this.emit("debug","REPLY: <IAC><WONT><GMCP>"),this.replyToOption(b,252,g)):g===251?(this.server.GMCP=!0,this.options.GMCP?(this.enableDebug&&this.emit("debug","REPLY: <IAC><DO><GMCP>"),this.replyToOption(b,253,g),this._startGMCP()):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><GMCP>"),this.replyToOption(b,254,g))):g===252&&(this.server.GMCP=!1,this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><GMCP>"),this.replyToOption(b,254,g)),a=0,r=[]):b===42?(this.enableDebug&&(this.emit("debug",_+"<CHARSET>"),_=""),g===253?(this.server.CHARSET=!0,this.options.CHARSET?(this.enableDebug&&this.emit("debug","REPLY: <IAC><WILL><CHARSET>"),this.replyToOption(b,251,g)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><CHARSET>"),this.replyToOption(b,254,g))):g===254?(this.server.CHARSET=!1,this.enableDebug&&this.emit("debug","REPLY: <IAC><WONT><CHARSET>"),this.replyToOption(b,252,g)):g===251?(this.server.CHARSET=!0,this.options.CHARSET?(this.enableDebug&&this.emit("debug","REPLY: <IAC><DO><CHARSET>"),this.replyToOption(b,253,g)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><CHARSET>"),this.replyToOption(b,254,g))):g===252&&(this.server.CHARSET=!1,this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><CHARSET>"),this.replyToOption(b,254,g)),a=0,r=[]):(this.enableDebug&&(this.emit("debug",_+this._formatByte(b)),_=""),g===251||g===252?(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><"+b+">"),this.replyToOption(b,254,g)):(g===254||g===253)&&(this.enableDebug&&this.emit("debug","REPLY: <IAC><WONT><"+b+">"),this.replyToOption(b,252,g)),a=0,r=[]);break;case 3:c=b,b===24?(this.enableDebug&&(_+="<TERMINALTYPE>"),r.push(b),c=b,a=4):b===36||b===39?(this.enableDebug&&(_+="<NEWENVIRON>"),r.push(b),c=b,a=12,L=-1):b===69?(this.enableDebug&&(_+="<MSDP>"),r.push(b),c=b,a=4):b===70?(this.enableDebug&&(_+="<MSSP>"),r.push(b),c=b,a=8,d={}):b===85||b===86?(this.enableDebug&&(_+=b===85?"<MCCP1>":"<MCCP2>"),r.push(b),c=b,a=11):b===201?(this.enableDebug&&(_+="<GMCP>"),r.push(b),c=b,a=7):b===240?(this.enableDebug&&(this.emit("debug",_+"<SE>"),_=""),l=Xe(r.slice(1,r.length-4)),this._fireReceiveOption(c,250,l),l=null,a=0,r=[]):b===42?(this.enableDebug&&(_+="<CHARSET>"),r.push(b),c=b,a=17,S=""):(this.enableDebug&&(_+=this._formatByte(b)),r.push(b));break;case 4:c===24&&b===1?(this.enableDebug&&(_+="<SEND>"),r.push(b),g=1):b===240?(this.enableDebug&&(this.emit("debug",_+"<SE>"),_=""),c===24&&g===1&&(l=!1,this._fireReceiveOption(c,250,""),l||(this.sendTerminal(),this.sendTerminal(),this._MTTS++)),a=0,r=[]):c===69&&b===1?(this.enableDebug&&(_+="<MSDP_VAR>"),r.push(b),v="",a=5):(this.enableDebug&&(_+=this._formatByte(b)),r.push(b));break;case 5:b===2?(this.enableDebug&&(_+="<MSDP_VAL>"),r.push(b),S="",a=6):(this.enableDebug&&(_+=this._formatByte(b)),v+=String.fromCharCode(b),r.push(b));break;case 6:b===255?(this.enableDebug&&(_+="<IAC>"),r.push(b)):b===1?(this.enableDebug&&(_+="<MSDP_VAR>"),this._fireReceiveMSDP(v,S),S="",v="",r.push(b),a=5):b===240?(this.enableDebug&&(this.emit("debug",_+"<SE>"),_=""),l=Xe(r.slice(1,r.length-4)),this._fireReceiveOption(c,250,l),l=null,this._fireReceiveMSDP(v,S),S="",v="",a=0,r=[]):(this.enableDebug&&(_+=this._formatByte(b)),S+=String.fromCharCode(b),r.push(b));break;case 7:b===255?(this.enableDebug&&(_+="<IAC>"),r.push(b)):b===240?(this.enableDebug&&(this.emit("debug",_+"<SE>"),_=""),l=Xe(r.slice(1,r.length-4)),this._fireReceiveOption(c,250,l),l=null,this._fireReceiveGMCP(S),a=0,S="",r=[]):(this.enableDebug&&(_+=this._formatByte(b)),S+=String.fromCharCode(b),r.push(b));break;case 8:b===255?(this.enableDebug&&(_+="<IAC>"),r.push(b)):b===240?(this.enableDebug&&(this.emit("debug",_+"<SE>"),this.emit("debug",this.MSSP),_=""),l=Xe(r.slice(1,r.length-4)),this._fireReceiveOption(c,250,l),l=null,this.emit("receive-MSSP",d),S="",v="",d=0,a=0,r=[]):b===1?(this.enableDebug&&(_+="<MSSP_VAR>"),r.push(b),v="",a=9):(this.enableDebug&&(_+=this._formatByte(b)),r.push(b));break;case 9:b===255?(this.enableDebug&&(_+="<IAC>"),r.push(b),a=8):b===1?(this.enableDebug&&(_+="<MSSP_VAR>"),r.push(b),v=""):b===2?(this.enableDebug&&(_+="<MSSP_VAL>"),r.push(b),this.MSSP[v]="",d[v]="",a=10):(this.enableDebug&&(_+=this._formatByte(b)),v+=String.fromCharCode(b),r.push(b));break;case 10:b===255?(this.enableDebug&&(_+="<IAC>"),r.push(b),a=8):b===1?(this.enableDebug&&(_+="<MSSP_VAR>"),r.push(b),v="",a=9):b===2?(this.enableDebug&&(_+="<MSSP_VAL>"),r.push(b),this.MSSP[v]="",d[v]=""):(this.enableDebug&&(_+=this._formatByte(b)),this.MSSP[v]+=String.fromCharCode(b),d[v]+=String.fromCharCode(b),r.push(b));break;case 11:b===255?(this.enableDebug&&(_+="<IAC>"),r.push(b)):b===240&&(this.enableDebug&&(this.emit("debug",_+"<SE>"),_=""),this._fireReceiveOption(c,86,""),this._startMCCP(),a=0,r=[],P<s-1&&f.append(this.processData(t.subarray(P+1),e,!0)),P=s);break;case 12:b===255?(this.enableDebug&&(_+="<IAC>"),r.push(b)):b===240?(this.enableDebug&&(this.emit("debug",_+"<SE>"),_=""),l=Xe(r.slice(1,r.length-4)),this._fireReceiveOption(c,250,l),l=null,this._fireReceiveGMCP(S),a=0,S="",r=[]):b===0?(this.enableDebug&&(_+="<IS>"),r.push(b),a=13,g=b):b===1?(this.enableDebug&&(_+="<SEND>"),r.push(b),a=13,g=b):b===2?(this.enableDebug&&(_+="<SEND>"),r.push(b),a=13,g=b):(this.enableDebug&&(_+=this._formatByte(b)),S+=String.fromCharCode(b),r.push(b));break;case 13:b===0?(this.enableDebug&&(_+="<VAR>"),r.push(b),a=14,g=b,v="",L===-1&&(L=0)):b===1?(this.enableDebug&&(_+="<VALUE>"),r.push(b),a=13,g=b,L===-1&&(L=1)):b===3?(this.enableDebug&&(_+="<USERVAR>"),r.push(b),a=13,g=b):b===255?(this.enableDebug&&(_+="<IAC>"),r.push(b)):b===240?(this.enableDebug&&(this.emit("debug",_+"<SE>"),_=""),l=Xe(r.slice(1,r.length-4)),l=this._fireReceiveOption(c,250,l),this.emit("receive-NEWENVIRON",S),l||(this.enableDebug&&this.emit("debug","REPLY: <IAC><SB><NEWENVIRON><IS><IAC><SE>"),this.sendData(new Uint8Array([255,250]),!0),this.sendData(c,!0),this.sendData(new Uint8Array([0,255,240]),!0)),a=0,S="",r=[]):(this.enableDebug&&(_+=this._formatByte(b)),S+=String.fromCharCode(b),r.push(b));break;case 14:b===2?(this.enableDebug&&(_+=this._formatByte(b)),r.push(b),a=15,o=14):b===255||b<=3?(P--,a=13):(this.enableDebug&&(_+=this._formatByte(b)),v+=String.fromCharCode(b),r.push(b));break;case 15:this.enableDebug&&(_+=this._formatByte(b)),o===16?S+=String.fromCharCode(b):v+=String.fromCharCode(b),a=o,r.push(b);break;case 16:break;case 17:b===1?(this.enableDebug&&(_+="<REQUEST>"),r.push(b),a=18,S=""):b===255?(this.enableDebug&&(_+="<IAC>"),r.push(b)):b===240?(this.enableDebug&&(this.emit("debug",_+"<SE>"),_=""),l=this._fireReceiveOption(c,250,S),this.emit("receive-CHARSET",S),l||(this.enableDebug&&this.emit("debug","REPLY: <IAC><SB><CHARSET><REJECTED><IAC><SE>"),this.sendData(new Uint8Array([255,250,42,3,255,240]),!0)),a=0,S="",r=[]):(this.enableDebug&&(_+=this._formatByte(b)),S+=String.fromCharCode(b),r.push(b));break;case 18:b===255?(this.enableDebug&&(_+="<IAC>"),r.push(b)):b===240?(this.enableDebug&&(this.emit("debug",_+"<SE>"),_=""),l=this._fireReceiveOption(c,250,S),this.emit("receive-CHARSET",S.slice(1)),l||(this.options.CHARSET&&S.slice(1).toLowerCase()==="utf-8"?(this.server.CHARSET=!0,this.enableDebug&&this.emit("debug","REPLY: <IAC><SB><ACCEPTED>UTF-8<IAC><SE>"),this.sendData(new Uint8Array([255,250,42,2]),!0),this.sendData("UTF-8",!0),this.sendData(new Uint8Array([255,240]),!0)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><SB><CHARSET><REJECTED><IAC><SE>"),this.sendData(new Uint8Array([255,250,42,3,255,240]),!0))),a=0,S="",r=[]):(this.enableDebug&&(_+=this._formatByte(b)),S+=String.fromCharCode(b),r.push(b));break}}catch(j){this.emit("error",j)}return this.enableDebug&&(_.length>0&&this.emit("debug",_),this.emit("debug","Post Split buffer length: "+r.length,1),this.emit("debug","PostSplit buffer  "+De(new Uint8Array(r)),1)),p&&f.length>0?f.prepend(`
`):p&&(this.prompt=!0),f.length>0&&(this.firstReceived=!1),this._splitBuffer=r,i?f:this.UTF8||this.options.CHARSET&&this.server.CHARSET?UTF8.decode2(f.toString()):f.toString()}replyToOption(t,e,i,n){return typeof n>"u"&&(n=""),this._fireReceiveOption(t,i,n)?!1:(this.sendData(new Uint8Array([255,e,t]),!0),!0)}updateWindow(t,e){if(!(e<1||t<1||!this.connected||!this.server.NAWS))try{let i,n,s,l,r=Math.floor;i=r(t/256),i>256&&(i=255),n=t%256,s=r(e/256),s>256&&(s=255),l=e%256,this.enableDebug&&this.emit("debug","REPLY: <IAC><SB><NAWS><"+i+"><"+n+"><"+s+"><"+l+"><IAC><SE>"),this.sendData(new Uint8Array([255,250,31,i,n,s,l,255,240]),!0)}catch(i){this.emit("error",{message:"UpdateWindow Error: "+i,err:i})}}sendGMCP(t){this.connected&&this.server.GMCP&&(this.enableDebug&&this.emit("debug","REPLY: <IAC><SB><GMCP>"+this._escapeData(t).toString("binary")+"<IAC><SE>"),this.sendData(new Uint8Array([255,250,201]),!0),this.sendData(this._escapeData(t),!0),this.sendData(new Uint8Array([255,240]),!0))}_startGMCP(){this.server.GMCP&&(this.enableDebug&&this.emit("debug",'REPLY: <IAC><SB><GMCP>Core.Hello { "client": "'+this.terminal+'", "version": "'+this.version+'" }<IAC><SE>'),this.sendData(new Uint8Array([255,250,201]),!0),this.sendData('Core.Hello { "client": "'+this.terminal+'", "version": "'+this.version+'" }',!0),this.sendData(new Uint8Array([255,240]),!0),this.sendData(new Uint8Array([255,250,201]),!0),this.GMCPSupports.length>0?(this.GMCPSupports.indexOf("Core 1")===-1&&this.GMCPSupports.unshift("Core 1"),this.enableDebug&&this.emit("debug","REPLY: <IAC><SB><GMCP>"+JSON.stringify(this.GMCPSupports)+"<IAC><SE>"),this.sendData("Core.Supports.Set "+JSON.stringify(this.GMCPSupports))):(this.enableDebug&&this.emit("debug",'REPLY: <IAC><SB><GMCP>Core.Supports.Set [ "Core 1" ]<IAC><SE>'),this.sendData('Core.Supports.Set [ "Core 1" ]',!0)),this.sendData(new Uint8Array([255,240]),!0))}_startMCCP(){this._zlib=!0}_endMCCP(){this._zlib=!1,this.zStream=0}_decompressData(t){return this._zlib?(this.zStream||(this.zStream=new mi.Zlib.InflateStream),this.enableDebug&&this.emit("debug","Pre decompress:"+De(t),1),t=this.zStream.decompress(t),this.enableDebug&&this.emit("debug","Post decompress:"+De(t),1),new Uint8Array(t)):t}_escapeData(t){if(t==null||typeof t>"u")return t;let e,i,n=0,s,l;if(t instanceof Uint8Array){for(e=t.byteLength,i=new Be;n<e;n++)i.appendCode(t[n]),t[n]===255?i.appendCode(255):t[n]===13&&e===1?i.append(`\r
`):t[n]===10&&e===1&&i.append("\r\0");return i.toString()}for(e=t.length,i=new Be;n<e;n++)l=t.charAt(n),s=t.charCodeAt(n),i.append(l),s===255?i.append(l):s===13&&e===1?i.append(`\r
`):s===10&&e===1&&i.append("\r\0");return i.toString()}_createSocket(t,e){let i;try{let n=/^[a-z0-9]+:\/\//.test(t);return n&&e>0?i=new WebSocket(t+":"+e,this.protocol||"binary"):n?i=new WebSocket(t,this.protocol||"binary"):t&&e>0?i=new WebSocket((this.scheme||"ws://")+t+":"+e,this.protocol||"binary"):t&&(i=new WebSocket((this.scheme||"ws://")+t,this.protocol||"binary")),i.binaryType="arraybuffer",i.onclose=s=>{s.code===1006&&s.type==="close"&&!this._closed?this.close():s.code!==1e3&&!this._closed&&(this.emit("error",{message:"Closed due to transmission error",err:s}),this.close())},i.onopen=()=>{this._connected=!0,this.emit("connect")},i.onmessage=s=>{if(s.data instanceof ArrayBuffer){var l=new Uint8Array(s.data);this.enableDebug&&this.emit("debug","Data ArrayBuffer received:"+De(l)),this.receivedData(l)}else if(s.data instanceof Blob){var r=new FileReader;r.onloadend=()=>{var a=new Uint8Array(r.result);this.receivedData(a),this.enableDebug&&this.emit("debug","Data Blob received:"+De(r.result))},r.readAsArrayBuffer(s.data)}else this.enableDebug&&this.emit("debug","Data received:"+s.data),this.receivedData(s.data)},i.onerror=s=>{this._closed||this.emit("error",s)},i}catch(n){this.emit("error",n)}return null}_destroySocket(){if(!(!this.socket||this.socket==null)){try{this.socket.onopen=function(){},this.socket.onclose=function(){},this.socket.onmessage=function(){},this.socket.onerror=function(){},this.connected&&this.socket.close(),delete this.socket}catch(t){this.emit("error",t)}this.socket=null}}_fireReceiveOption(t,e,i){let n={telnet:this,option:t,verb:250,value:i,handled:!1};return this.emit("received-option",n),n.handled}_fireReceiveMSDP(t,e){let i={telnet:this,variable:t,value:e,handled:!1};return this.emit("received-MSDP",i),i.handled}_fireReceiveGMCP(t){let e={telnet:this,value:t,handled:!1};return this.emit("received-GMCP",e),e.handled}_formatByte(t){return t<32||t>=127?"<"+t+">":String.fromCharCode(t)}};window.telnet=new ht;var Je=(p=>(p[p.None=0]="None",p[p.Bold=1]="Bold",p[p.Faint=2]="Faint",p[p.Underline=4]="Underline",p[p.Italic=3]="Italic",p[p.Slow=5]="Slow",p[p.Rapid=6]="Rapid",p[p.Inverse=7]="Inverse",p[p.Hidden=8]="Hidden",p[p.Strikeout=9]="Strikeout",p[p.DoubleUnderline=21]="DoubleUnderline",p[p.Overline=53]="Overline",p))(Je||{}),ct=(T=>(T[T.ErrorBackground=-12]="ErrorBackground",T[T.ErrorText=-11]="ErrorText",T[T.InfoBackground=-8]="InfoBackground",T[T.InfoText=-7]="InfoText",T[T.LocalEcho=-3]="LocalEcho",T[T.LocalEchoBack=-4]="LocalEchoBack",T[T.Reset=0]="Reset",T[T.Bold=1]="Bold",T[T.Faint=2]="Faint",T[T.Italic=3]="Italic",T[T.Underline=4]="Underline",T[T.Blink=5]="Blink",T[T.BlinkRapid=6]="BlinkRapid",T[T.Reverse=7]="Reverse",T[T.Hidden=8]="Hidden",T[T.StrikeThrough=9]="StrikeThrough",T[T.DoubleUnderline=21]="DoubleUnderline",T[T.BoldOff=22]="BoldOff",T[T.ItalicOff=23]="ItalicOff",T[T.UnderlineOff=24]="UnderlineOff",T[T.BlinkOff=25]="BlinkOff",T[T.BlinkRapidOff=26]="BlinkRapidOff",T[T.ReverseOff=27]="ReverseOff",T[T.Visible=28]="Visible",T[T.StrikeThroughOff=29]="StrikeThroughOff",T[T.Black=30]="Black",T[T.Red=31]="Red",T[T.Green=32]="Green",T[T.Yellow=33]="Yellow",T[T.Blue=34]="Blue",T[T.Magenta=35]="Magenta",T[T.Cyan=36]="Cyan",T[T.White=37]="White",T[T.DefaultFore=39]="DefaultFore",T[T.BlackBackground=40]="BlackBackground",T[T.RedBackground=41]="RedBackground",T[T.GreenBackground=42]="GreenBackground",T[T.YellowBackground=43]="YellowBackground",T[T.BlueBackground=44]="BlueBackground",T[T.MagentaBackground=45]="MagentaBackground",T[T.CyanBackground=46]="CyanBackground",T[T.WhiteBackground=47]="WhiteBackground",T[T.DefaultBack=49]="DefaultBack",T[T.Subscript=74]="Subscript",T[T.Superscript=73]="Superscript",T[T.SubSuperOff=75]="SubSuperOff",T[T.XBlack=90]="XBlack",T[T.XRed=91]="XRed",T[T.XGreen=92]="XGreen",T[T.XYellow=93]="XYellow",T[T.XBlue=94]="XBlue",T[T.XMagenta=95]="XMagenta",T[T.XCyan=96]="XCyan",T[T.XWhite=97]="XWhite",T[T.XBlackBackground=100]="XBlackBackground",T[T.XRedBackground=101]="XRedBackground",T[T.XGreenBackground=102]="XGreenBackground",T[T.XYellowBackground=103]="XYellowBackground",T[T.XBlueBackground=104]="XBlueBackground",T[T.XMagentaBackground=105]="XMagentaBackground",T[T.XCyanBackground=106]="XCyanBackground",T[T.XWhiteBackground=107]="XWhiteBackground",T))(ct||{});function ee(u,h){switch(u.toLowerCase()){case"black":return h?40:30;case"red":return h?41:31;case"green":return h?42:32;case"yellow":return h?43:33;case"blue":return h?44:34;case"magenta":return h?45:35;case"cyan":return h?46:36;case"white":return h?47:37;case"default":return h?49:39}return-1}function Yt(u){let h=-1,t=-1,e=!1;switch(u-1024>=0&&(u-=1024),u-512>=0&&(u-=512),u-256>=0&&(u-=256),u-128>=0&&(u-=128,e=!0),u-112>=0&&(u-=112,t=47),u-96>=0&&(u-=96,t=43),u-80>=0&&(u-=80,t=45),u-64>=0&&(u-=64,t=41),u-48>=0&&(u-=48,t=46),u-32>=0&&(u-=32,t=42),u-16>=0&&(u-=16,t=44),u>=8&&(u-=8,e=!0),u){case 0:h=30;break;case 1:h=34;break;case 2:h=32;break;case 3:h=36;break;case 4:h=31;break;case 5:h=35;break;case 6:h=33;break;case 7:h=37;break}return e&&h===-1?h=370:e&&(h*=10),h===-1?`,${t}`:t===-1?h.toString():`${h},${t}`}function fe(u){return!u||u.length===0?!1:["indianred","lightcoral","salmon","darksalmon","lightsalmon","crimson","red","firebrick","darkred","pink","lightpink","hotpink","deeppink","mediumvioletred","palevioletred","lightsalmon","coral","tomato","orangered","darkorange","orange","gold","yellow","lightyellow","lemonchiffon","lightgoldenrodyellow","papayawhip","moccasin","peachpuff","palegoldenrod","khaki","darkkhaki","lavender","thistle","plum","violet","orchid","fuchsia","magenta","mediumorchid","mediumpurple","blueviolet","darkviolet","darkorchid","darkmagenta","purple","indigo","slateblue","darkslateblue","mediumslateblue","greenyellow","chartreuse","lawngreen","lime","limegreen","palegreen","lightgreen","mediumspringgreen","springgreen","mediumseagreen","seagreen","forestgreen","green","darkgreen","yellowgreen","olivedrab","olive","darkolivegreen","mediumaquamarine","darkseagreen","lightseagreen","darkcyan","teal","aqua","cyan","lightcyan","paleturquoise","aquamarine","turquoise","mediumturquoise","darkturquoise","cadetblue","steelblue","lightsteelblue","powderblue","lightblue","skyblue","lightskyblue","deepskyblue","dodgerblue","cornflowerblue","mediumslateblue","royalblue","blue","mediumblue","darkblue","navy","midnightblue","cornsilk","blanchedalmond","bisque","navajowhite","wheat","burlywood","tan","rosybrown","sandybrown","goldenrod","darkgoldenrod","peru","chocolate","saddlebrown","sienna","brown","maroon","white","snow","honeydew","mintcream","azure","aliceblue","ghostwhite","whitesmoke","seashell","beige","oldlace","floralwhite","ivory","antiquewhite","linen","lavenderblush","mistyrose","gainsboro","lightgrey","silver","darkgray","gray","dimgray","lightslategray","slategray","darkslategray","black"].indexOf(u.toLowerCase())!=-1}function Me(u,h){switch(u){case"errortextbackground":case"errorbackground":return-12;case"errortext":return h?-12:-11;case"infobackground":return-8;case"infotext":return h?-8:-7;case"localecho":return h?-4:-3;case"localechoback":return-4;case"reset":return 0;case"bold":return 1;case"faint":return 2;case"italic":return 3;case"underline":return 4;case"blink":return 5;case"blinkrapid":return 6;case"reverse":return 7;case"hidden":return 8;case"strikethrough":return 9;case"doubleunderline":return 21;case"boldoff":return 22;case"italicoff":return 23;case"underlineoff":return 24;case"blinkoff":return 25;case"blinkrapidoff":return 26;case"reverseoff":return 27;case"visible":return 28;case"strikethroughoff":return 29;case"black":return h?40:30;case"red":return h?41:31;case"green":return h?42:32;case"yellow":return h?43:33;case"blue":return h?44:34;case"magenta":return h?45:35;case"cyan":return h?46:36;case"white":return h?47:37;case"default":case"defaultfore":return h?49:39;case"blackbackground":return 40;case"redbackground":return 41;case"greenbackground":return 42;case"yellowbackground":return 43;case"bluebackground":return 44;case"magentabackground":return 45;case"cyanbackground":return 46;case"whitebackground":return 47;case"defaultbackground":case"defaultback":return 49;case"overline":return 53;case"subscript":return 74;case"superscript":return 73;case"subsuperoff":return 75;case"xblack":return h?100:90;case"xred":return h?101:91;case"xgreen":return h?102:92;case"xyellow":return h?103:93;case"xblue":return h?104:94;case"xmagenta":return h?105:95;case"xcyan":return h?106:96;case"xwhite":return h?107:97;case"xblackbackground":return 100;case"xredbackground":return 101;case"xgreenbackground":return 102;case"xyellowbackground":return 103;case"xbluebackground":return 104;case"xmagentabackground":return 105;case"xcyanbackground":return 106;case"xwhitebackground":return 107}return-1}var et=class{constructor(h,t){this.width=0;this.height=0;this.width=h,this.height=t}};var H=[["bufferSize",0,2,500],["commandDelay",0,2,500],["commandDelayCount",0,2,5],["commandHistorySize",0,2,20],["fontSize",0,0,"1em",0],["cmdfontSize",0,0,"1em",0],["commandEcho",0,1,!0],["flashing",0,1,!1],["autoConnect",0,1,!0],["enableAliases",-1,1,!0],["enableTriggers",-1,1,!0],["enableMacros",-1,1,!0],["showScriptErrors",0,1,!1],["commandStacking",0,1,!0],["commandStackingChar",0,0,";",1],["htmlLog",0,1,!0],["keepLastCommand",0,1,!0],["enableMCCP",0,1,!0],["enableUTF8",0,1,!0],["font",0,5,"'Courier New', Courier, monospace",0],["cmdfont",0,5,"'Courier New', Courier, monospace",0],["aliases",-1,4],["macros",-1,4],["triggers",-1,4],["mapFollow","mapper.follow",1,!0],["mapEnabled","mapper.enabled",1,!0],["MapperSplitArea","mapper.split",1,!1],["MapperFillWalls","mapper.fill",1,!1],["MapperOpen","showMapper",1,!1],["fullScreen",-1,3,!1],["enableMXP",0,1,!0],["enableMSP",0,1,!0],["parseCommands",0,3,!0],["lagMeter",0,1,!1],["enablePing",0,1,!1],["enableEcho",0,1,!0],["enableSpeedpaths",0,1,!0],["speedpathsChar",0,0,"!",1],["parseSpeedpaths",0,1,!0],["profile",-1,0,"Default",1],["parseSingleQuotes",0,1,!1],["parseDoubleQuotes",0,1,!0],["logEnabled",0,1,!1],["logPrepend",0,1,!1],["logOffline",0,1,!1],["logUniqueOnConnect",0,1,!0],["enableURLDetection",0,1,!0],["colors",0,4],["notifyMSPPlay",0,1,!1],["CommandonClick",0,1,!0],["allowEval",0,1,!0],["allowEscape",0,1,!0],["AutoCopySelectedToClipboard",0,1,!1],["enableDebug",0,1,!1],["editorPersistent",0,1,!1],["askonclose",0,1,!0],["dev",0,1,!1],["chat.captureLines",0,1,!1],["chat.captureAllLines",0,1,!1],["chat.captureReviews",0,1,!1],["chat.captureTells",0,1,!1],["chat.captureTalk",0,1,!1],["chat.gag",0,1,!1],["chat.CaptureOnlyOpen",0,1,!1],["checkForUpdates",0,1,!1],["autoCreateCharacter",0,1,!1],["askonchildren",0,1,!0],["mapper.legend",0,1,!1],["mapper.room",0,1,!1],["mapper.importType",0,2,1],["mapper.vscroll",0,2,0],["mapper.hscroll",0,2,0],["mapper.scale",0,2,1],["mapper.alwaysOnTop",0,1,!1],["mapper.alwaysOnTopClient",0,1,!0],["mapper.memory",0,1,!1],["mapper.memorySavePeriod",0,2,9e5],["mapper.active.ID",0,0,null],["mapper.active.x",0,2,0],["mapper.active.y",0,2,0],["mapper.active.z",0,2,0],["mapper.active.area",0,0,null],["mapper.active.zone",0,2,0],["mapper.persistent",0,1,!0],["profiles.split",0,2,200],["profiles.askoncancel",0,1,!0],["profiles.triggersAdvanced",0,1,!1],["profiles.aliasesAdvanced",0,1,!1],["profiles.buttonsAdvanced",0,1,!1],["profiles.macrosAdvanced",0,1,!1],["profiles.contextsAdvanced",0,1,!1],["profiles.codeEditor",0,1,!0],["profiles.watchFiles",0,1,!0],["chat.alwaysOnTop",0,1,!1],["chat.alwaysOnTopClient",0,1,!0],["chat.log",0,1,!1],["chat.persistent",0,1,!1],["chat.zoom",0,2,1],["chat.font",0,5,"'Courier New', Courier, monospace"],["chat.fontSize",0,0,"1em"],["title",0,0,"$t"],["logGagged",0,1,!1],["logTimeFormat",0,0,"YYYYMMDD-HHmmss"],["autoConnectDelay",0,2,600],["autoLogin",0,1,!0],["onDisconnect",0,2,2],["enableKeepAlive",0,1,!1],["keepAliveDelay",0,2,0],["newlineShortcut",0,2,1],["logWhat",0,2,1],["logErrors",0,1,!0],["showErrorsExtended",0,1,!1],["reportCrashes",0,1,!1],["enableCommands",0,1,!0],["commandChar",0,0,"#",1],["escapeChar",0,0,"\\",1],["enableVerbatim",0,1,!0],["verbatimChar",0,0,"`"],["soundPath",0,0,""],["logPath",0,0,""],["theme",0,0,""],["gamepads",0,1,!1],["buttons.connect",0,1,!0],["buttons.characters",0,1,!0],["buttons.preferences",0,1,!0],["buttons.log",0,1,!0],["buttons.clear",0,1,!0],["buttons.lock",0,1,!0],["buttons.map",0,1,!0],["buttons.user",0,1,!0],["buttons.mail",0,1,!1],["buttons.compose",0,1,!1],["buttons.immortal",0,1,!0],["buttons.codeEditor",0,1,!1],["find.case",0,1,!1],["find.word",0,1,!1],["find.reverse",0,1,!1],["find.regex",0,1,!1],["find.selection",0,1,!1],["find.show",0,1,!1],["display.split",0,1,!1],["display.splitHeight",0,2,-1],["display.splitLive",0,1,!0],["display.roundedOverlays",0,1,!0],["backupLoad",0,2,30],["backupSave",0,2,30],["backupAllProfiles",0,1,!0],["scrollLocked",0,1,!1],["showStatus",0,1,!0],["showCharacterManager",0,1,!1],["showChat",0,1,!1],["showEditor",0,1,!1],["showArmor",0,1,!1],["showStatusWeather",0,1,!0],["showStatusLimbs",0,1,!0],["showStatusHealth",0,1,!0],["showStatusExperience",0,1,!0],["showStatusPartyHealth",0,1,!0],["showStatusCombatHealth",0,1,!0],["showButtonBar",0,1,!0],["allowNegativeNumberNeeded",0,1,!1],["spellchecking",0,1,!0],["hideOnMinimize",0,1,!1],["showTrayIcon",0,1,!1],["statusExperienceNeededProgressbar",0,1,!1],["trayClick",0,2,0],["trayDblClick",0,2,0],["pasteSpecialPrefix",0,0,""],["pasteSpecialPostfix",0,0,""],["pasteSpecialReplace",0,0,""],["pasteSpecialPrefixEnabled",0,1,!0],["pasteSpecialPostfixEnabled",0,1,!0],["pasteSpecialReplaceEnabled",0,1,!0],["display.showSplitButton",0,1,!0],["chat.split",0,1,!1],["chat.splitHeight",0,2,-1],["chat.splitLive",0,1,!0],["chat.roundedOverlays",0,1,!0],["chat.showSplitButton",0,1,!0],["chat.bufferSize",0,2,500],["chat.flashing",0,1,!1],["display.hideTrailingEmptyLine",0,1,!0],["display.enableColors",0,1,!0],["display.enableBackgroundColors",0,1,!0],["enableSound",0,1,!0],["allowHalfOpen",0,1,!0],["editorClearOnSend",0,1,!0],["editorCloseOnSend",0,1,!0],["askOnCloseAll",0,1,!0],["askonloadCharacter",0,1,!0],["mapper.roomWidth",0,2,200],["mapper.roomGroups",0,2,7],["mapper.showInTaskBar",0,1,!1],["profiles.enabled",0,4,[]],["profiles.sortOrder",0,2,12],["profiles.sortDirection",0,2,1],["profiles.showInTaskBar",0,1,!1],["profiles.profileSelected",0,0,"default"],["profiles.profileExpandSelected",0,1,!0],["chat.lines",0,4,[]],["chat.showInTaskBar",0,1,!1],["chat.showTimestamp",0,1,!1],["chat.timestampFormat",0,0,"[[]MM-DD HH:mm:ss.SSS[]] "],["chat.tabWidth",0,2,8],["chat.displayControlCodes",0,1,!1],["chat.emulateTerminal",0,1,!1],["chat.emulateControlCodes",0,1,!0],["chat.wordWrap",0,1,!1],["chat.wrapAt",0,2,0],["chat.indent",0,2,4],["chat.scrollLocked",0,1,!1],["chat.find.case",0,1,!1],["chat.find.word",0,1,!1],["chat.find.reverse",0,1,!1],["chat.find.regex",0,1,!1],["chat.find.selection",0,1,!1],["chat.find.show",0,1,!1],["chat.find.highlight",0,1,!1],["chat.find.location",0,4,[5,20]],["codeEditor.showInTaskBar",0,1,!1],["codeEditor.persistent",0,1,!1],["codeEditor.alwaysOnTop",0,1,!1],["codeEditor.alwaysOnTopClient",0,1,!0],["autoTakeoverLogin",0,1,!1],["fixHiddenWindows",0,1,!0],["maxReconnectDelay",0,2,3600],["enableBackgroundThrottling",0,1,!0],["enableBackgroundThrottlingClients",0,1,!1],["showInTaskBar",0,1,!0],["showLagInTitle",0,1,!1],["mspMaxRetriesOnError",0,2,0],["logTimestamp",0,1,!1],["logTimestampFormat",0,0,"[[]MM-DD HH:mm:ss.SSS[]] "],["disableTriggerOnError",0,1,!0],["prependTriggeredLine",0,1,!0],["enableParameters",0,1,!0],["parametersChar",0,0,"%",1],["enableNParameters",0,1,!0],["nParametersChar",0,0,"$",1],["enableParsing",0,1,!0],["externalWho",0,1,!0],["externalHelp",0,1,!0],["watchForProfilesChanges",0,1,!1],["onProfileChange",0,2,0],["onProfileDeleted",0,2,0],["enableDoubleParameterEscaping",0,1,!1],["ignoreEvalUndefined",0,1,!0],["enableInlineComments",0,1,!0],["enableBlockComments",0,1,!0],["inlineCommentString",0,0,"//"],["blockCommentString",0,0,"/*"],["allowCommentsFromCommand",0,1,!1],["saveTriggerStateChanges",0,1,!0],["groupProfileSaves",0,1,!1],["groupProfileSaveDelay",0,2,2e4],["returnNewlineOnEmptyValue",0,1,!1],["pathDelay",0,2,0],["pathDelayCount",0,2,1],["echoSpeedpaths",0,1,!1],["alwaysShowTabs",0,1,!1],["scriptEngineType",0,2,4],["initializeScriptEngineOnLoad",0,1,!1],["find.highlight",0,1,!1],["find.location",0,4,[5,20]],["display.showInvalidMXPTags",0,1,!1],["display.showTimestamp",0,1,!1],["display.timestampFormat",0,0,"[[]MM-DD HH:mm:ss.SSS[]] "],["display.displayControlCodes",0,1,!1],["display.emulateTerminal",0,1,!1],["display.emulateControlCodes",0,1,!0],["display.wordWrap",0,1,!1],["display.tabWidth",0,2,8],["display.wrapAt",0,2,0],["display.indent",0,2,4],["statusWidth",0,2,-1],["showEditorInTaskBar",0,1,!0],["trayMenu",0,2,0],["lockLayout",0,1,!1],["loadLayout",0,0,""],["useSingleInstance",0,1,!0],["onSecondInstance",0,2,0],["characterManagerDblClick",0,2,0],["enableTabCompletion",1,!0],["ignoreCaseTabCompletion",0,1,!1],["tabCompletionBufferLimit",0,2,100],["enableNotifications",0,1,!0],["echo",0,2,0],["commandAutoSize",0,1,!1],["commandWordWrap",0,1,!1],["commandScrollbars",0,1,!1],["tabCompletionList",0,0,""],["tabCompletionLookupType",0,2,1],["tabCompletionReplaceCasing",0,2,0],["characterManagerAddButtonAction",0,2,0],["enableCrashReporting",0,1,!1],["characterManagerPanelWidth",0,2,0],["ignoreInputLeadingWhitespace",0,1,!1],["profiles.find.case",0,1,!1],["profiles.find.word",0,1,!1],["profiles.find.reverse",0,1,!1],["profiles.find.regex",0,1,!1],["profiles.find.selection",0,1,!1],["profiles.find.show",0,1,!1],["profiles.find.value",0,1,!1],["skipMore",0,1,!1],["skipMoreDelay",0,2,5e3],["commandMinLines",0,2,1],["backupReplaceCharacters",0,1,!0],["simpleAlarms",0,1,!1],["simpleEditor",0,1,!1],["selectLastCommand",0,1,!0]];var Le=class u{constructor(){for(var h=0,t=H.length;h<t;h++)H[h][2]!==4&&(this[H[h][0]]=u.getValue(H[h][0]));this.colors=u.getValue("colors")}static{this.settingError=!1}static getValue(h,t){var e;if(u.settingError)return t===null||typeof t>"u"?u.defaultValue(h):t;try{if(e=$.jStorage.get(h),typeof e>"u"||e===null)return t===null||typeof t>"u"?u.defaultValue(h):t;switch(h){case"showChat":case"showStatus":case"showButtons":case"enableCommands":case"enableVerbatim":case"allowEscape":case"autoConnect":case"mapFollow":case"mapEnabled":case"flashing":case"commandEcho":case"enableAliases":case"enableTriggers":case"enableButtons":case"enableMacros":case"commandStacking":case"htmlLog":case"keepLastCommand":case"fullScreen":case"enableMXP":case"enableURLDetection":case"enableMCCP":case"enableUTF8":case"parseCommands":case"lagMeter":case"showScriptErrors":case"enablePing":case"enableEcho":case"enableSpeedpaths":case"parseSpeedpaths":case"MapperSplitArea":case"parseSingleQuotes":case"parseDoubleQuotes":case"logEnabled":case"logOffline":case"logPrepend":case"logUniqueOnConnect":case"toolsPinned":case"notifyMSPPlay":case"CommandonClick":case"allowEval":case"disableTriggerOnError":case"prependTriggeredLine":case"chat.captureLines":case"chat.captureAllLines":case"chat.captureReviews":case"chat.captureTells":case"chat.captureTalk":case"chat.gag":case"chat.CaptureOnlyOpen":case"simpleAlarms":case"simpleEditor":case"selectLastCommand":return e==1;case"colors":case"chat.lines":return e===null||typeof e>"u"||e.length===0?[]:JSON.parse(e)}return e}catch(i){return u.settingError||(alert(`Unable to save to localStorage so reverting to default,

Error description: `+i.message),u.settingError=!0),t===null||typeof t>"u"?u.defaultValue(t):t}}static setValue(h,t){switch(h){case"colors":case"chat.lines":t===null||typeof t>"u"||t.length===0?$.jStorage.deleteKey(h):$.jStorage.set(h,JSON.stringify(t));break;default:typeof t=="boolean"?t?$.jStorage.set(h,1):$.jStorage.set(h,0):$.jStorage.set(h,t);break}}static clearValue(h){$.jStorage.deleteKey(h)}static defaultValue(h){switch(h){case"bufferSize":return 500;case"commandDelay":return 500;case"commandDelayCount":return 5;case"commandHistorySize":return 20;case"fontSize":return"1em";case"cmdfontSize":return"1em";case"commandEcho":return!0;case"flashing":return!1;case"autoConnect":return!0;case"enableAliases":return!0;case"enableTriggers":return!0;case"enableMacros":return!0;case"showScriptErrors":return!1;case"commandStacking":return!0;case"commandStackingChar":return";";case"htmlLog":return!0;case"keepLastCommand":return!0;case"enableMCCP":return!0;case"enableUTF8":return!0;case"font":return"'Courier New', Courier, monospace";case"cmdfont":return"'Courier New', Courier, monospace";case"mapFollow":case"mapper.follow":return!0;case"mapEnabled":case"mapper.enabled":return!0;case"MapperSplitArea":case"mapper.split":return!1;case"MapperFillWalls":case"mapper.fill":return!1;case"MapperOpen":case"showMapper":return!1;case"fullScreen":return!1;case"enableMXP":return!0;case"enableMSP":return!0;case"parseCommands":return!0;case"lagMeter":return!1;case"enablePing":return!1;case"enableEcho":return!0;case"enableSpeedpaths":return!0;case"speedpathsChar":return"!";case"parseSpeedpaths":return!0;case"profile":return"Default";case"parseSingleQuotes":return!1;case"parseDoubleQuotes":return!0;case"logEnabled":return!1;case"logPrepend":return!1;case"logOffline":return!1;case"logUniqueOnConnect":return!0;case"enableURLDetection":return!0;case"notifyMSPPlay":return!1;case"CommandonClick":return!0;case"allowEval":return!0;case"allowEscape":return!0;case"AutoCopySelectedToClipboard":return!1;case"enableDebug":return!1;case"editorPersistent":return!1;case"askonclose":return!0;case"dev":return!1;case"chat.captureLines":return!1;case"chat.captureAllLines":return!1;case"chat.captureReviews":return!1;case"chat.captureTells":return!1;case"chat.captureTalk":return!1;case"chat.gag":return!1;case"chat.CaptureOnlyOpen":return!1;case"checkForUpdates":return!1;case"autoCreateCharacter":return!1;case"askonchildren":return!0;case"mapper.legend":return!1;case"mapper.room":return!1;case"mapper.importType":return 1;case"mapper.vscroll":return 0;case"mapper.hscroll":return 0;case"mapper.scale":return 1;case"mapper.active":return{ID:null,x:0,y:0,z:0,area:null,zone:0};case"mapper.active.ID":return null;case"mapper.active.x":return 0;case"mapper.active.y":return 0;case"mapper.active.z":return 0;case"mapper.active.area":return null;case"mapper.active.zone":return 0;case"profiles.split":return 200;case"profiles.askoncancel":return!0;case"profiles.triggersAdvanced":return!1;case"profiles.aliasesAdvanced":return!1;case"profiles.buttonsAdvanced":return!1;case"profiles.macrosAdvanced":return!1;case"profiles.contextsAdvanced":return!1;case"profiles.codeEditor":return!0;case"chat.log":return!1;case"chat.zoom":return 1;case"chat.font":return"'Courier New', Courier, monospace";case"chat.fontSize":return"1em";case"title":return"$t";case"logGagged":return!1;case"logTimeFormat":return"YYYYMMDD-HHmmss";case"autoConnectDelay":return 600;case"autoLogin":return!0;case"onDisconnect":return 2;case"enableKeepAlive":return!1;case"keepAliveDelay":return 0;case"newlineShortcut":return 1;case"logWhat":return 1;case"logErrors":return!0;case"showErrorsExtended":return!1;case"reportCrashes":return!1;case"enableCommands":return!0;case"commandChar":return"#";case"escapeChar":return"\\";case"enableVerbatim":return!0;case"verbatimChar":return"`";case"soundPath":return"";case"logPath":return"";case"theme":return"";case"gamepads":return!1;case"backupLoad":return 30;case"backupSave":return 30;case"backupAllProfiles":return!0;case"backupReplaceCharacters":return!0;case"scrollLocked":return!1;case"showStatus":return!0;case"showChat":return!1;case"showEditor":return!1;case"showArmor":return!1;case"showStatusWeather":return!0;case"showStatusLimbs":return!0;case"showStatusHealth":return!0;case"showStatusExperience":return!0;case"showStatusPartyHealth":return!0;case"showStatusCombatHealth":return!0;case"allowNegativeNumberNeeded":return!1;case"spellchecking":return!0;case"statusExperienceNeededProgressbar":return!1;case"pasteSpecialPrefix":return"";case"pasteSpecialPostfix":return"";case"pasteSpecialReplace":return"";case"pasteSpecialPrefixEnabled":return!0;case"pasteSpecialPostfixEnabled":return!0;case"pasteSpecialReplaceEnabled":return!0;case"display.showSplitButton":return!0;case"chat.bufferSize":return 500;case"chat.flashing":return!1;case"display.hideTrailingEmptyLine":return!0;case"display.enableColors":return!0;case"display.enableBackgroundColors":return!0;case"enableSound":return!0;case"editorClearOnSend":return!0;case"editorCloseOnSend":return!0;case"askOnCloseAll":return!0;case"askonloadCharacter":return!0;case"mapper.roomWidth":return 200;case"mapper.roomGroups":return 7;case"mapper.showInTaskBar":return!1;case"profiles.enabled":return[];case"profiles.sortOrder":return 12;case"profiles.sortDirection":return 1;case"profiles.profileSelected":return"default";case"profiles.profileExpandSelected":return!0;case"chat.lines":return[];case"chat.showTimestamp":return!1;case"chat.timestampFormat":return"[[]MM-DD HH:mm:ss.SSS[]] ";case"chat.tabWidth":return 8;case"chat.displayControlCodes":return!1;case"chat.emulateTerminal":return!1;case"chat.emulateControlCodes":return!0;case"chat.wordWrap":return!1;case"chat.wrapAt":return 0;case"chat.indent":return 4;case"autoTakeoverLogin":return!1;case"maxReconnectDelay":return 3600;case"showLagInTitle":return!1;case"mspMaxRetriesOnError":return 0;case"logTimestamp":return!1;case"logTimestampFormat":return"[[]MM-DD HH:mm:ss.SSS[]] ";case"disableTriggerOnError":return!0;case"prependTriggeredLine":return!0;case"enableParameters":return!0;case"parametersChar":return"%";case"enableNParameters":return!0;case"nParametersChar":return"$";case"enableParsing":return!0;case"onProfileChange":return 0;case"onProfileDeleted":return 0;case"enableDoubleParameterEscaping":return!1;case"ignoreEvalUndefined":return!0;case"enableInlineComments":return!0;case"enableBlockComments":return!0;case"inlineCommentString":return"//";case"blockCommentString":return"/*";case"allowCommentsFromCommand":return!1;case"saveTriggerStateChanges":return!0;case"groupProfileSaves":return!1;case"groupProfileSaveDelay":return 2e4;case"returnNewlineOnEmptyValue":return!1;case"pathDelay":return 0;case"pathDelayCount":return 1;case"echoSpeedpaths":return!1;case"scriptEngineType":return 4;case"initializeScriptEngineOnLoad":return!1;case"display.showInvalidMXPTags":return!1;case"display.showTimestamp":return!1;case"display.timestampFormat":return"[[]MM-DD HH:mm:ss.SSS[]] ";case"display.displayControlCodes":return!1;case"display.emulateTerminal":return!1;case"display.emulateControlCodes":return!0;case"display.wordWrap":return!1;case"display.tabWidth":return 8;case"display.wrapAt":return 0;case"display.indent":return 4;case"statusWidth":return-1;case"extensions":return{};case"warnAdvancedSettings":return!0;case"showAdvancedSettings":return!1;case"enableTabCompletion":return!0;case"ignoreCaseTabCompletion":return!1;case"tabCompletionBufferLimit":return 100;case"enableNotifications":return!0;case"echo":return 0;case"commandAutoSize":return!1;case"commandWordWrap":return!1;case"commandMinLines":return 1;case"tabCompletionLookupType":return 1;case"tabCompletionList":return"";case"tabCompletionReplaceCasing":return 0;case"ignoreInputLeadingWhitespace":return!1;case"skipMore":return!1;case"skipMoreDelay":return 5e3;case"simpleAlarms":return!1;case"simpleEditor":return!1;case"selectLastCommand":return!0}return null}save(){for(var h in this)this.hasOwnProperty(h)&&u.setValue(h,this[h])}reset(){for(var h=0,t=H.length;h<t;h++)H[h][2]!==4&&(this[H[h][0]]=u.defaultValue(H[h][0]));this.colors=[]}};var ut=(r=>(r[r.Regular=0]="Regular",r[r.CommandInputRegular=1]="CommandInputRegular",r[r.Event=2]="Event",r[r.Alarm=3]="Alarm",r[r.Pattern=8]="Pattern",r[r.CommandInputPattern=16]="CommandInputPattern",r[r.Expression=64]="Expression",r[r.LoopExpression=128]="LoopExpression",r))(ut||{});var pt=(a=>(a[a.Skip=512]="Skip",a[a.Wait=1024]="Wait",a[a.LoopPattern=4096]="LoopPattern",a[a.LoopLines=8192]="LoopLines",a[a.Duration=16384]="Duration",a[a.WithinLines=32768]="WithinLines",a[a.Manual=65536]="Manual",a[a.ReParse=131072]="ReParse",a[a.ReParsePattern=262144]="ReParsePattern",a))(pt||{});function Ye(u){let h=[];if(u.gamepad>0)return h.push("Gamepad "+u.gamepad),u.key>0?h.push("Button "+u.key):u.gamepadAxes<0?h.push("Axis "+-u.gamepadAxes):u.gamepadAxes>0&&h.push("Axis "+u.gamepadAxes),h.length===1?"None":h.join("+");if(u.key===0)return u.name&&u.name.length>0?"None - "+u.name:"None";if((u.modifiers&4)===4&&h.push("Ctrl"),(u.modifiers&2)===2&&h.push("Alt"),(u.modifiers&8)===8&&h.push("Shift"),(u.modifiers&16)===16&&h.push("Meta"),Ze[u.key])h.push(Ze[u.key]);else return u.name&&u.name.length>0?"None - "+u.name:"None";return u.name&&u.name.length>0?h.join("+")+" - "+u.name:h.join("+")}var xe=class u{constructor(h,t){this.temp=!1;this.start=!1;this.seconds=-1;this.secondsWildcard=!0;this.hours=-1;this.hoursWildcard=!0;this.minutes=-1;this.minutesWildcard=!0;this.suspended=0;this.restart=0;typeof h=="string"&&(t=h,h=0),this.parent=h,this.pattern=t,this.startTime=Date.now(),this.prevTime=this.startTime}static parse(h,t,e){if(typeof h=="string"&&(t=h,h=0),!t||t.length===0)if(typeof h=="object")t=h.pattern;else throw new Error("Blank pattern");let i=new u(h,t);for(;t[0]==="-"||t[0]==="+";)t[0]==="-"?i.start=!0:t[0]==="+"&&(i.temp=!0),t=t.substr(1);if(t!=="*"){let n=t.split(":"),s;if(n.length===0)throw new Error("Invalid format: "+t);if(n.length===1)if(n[0]==="*")i.secondsWildcard=!0,i.seconds=-1;else{if(n[0][0]==="*"?(i.secondsWildcard=!0,n[0]=n[0].substr(1)):i.secondsWildcard=!1,s=parseInt(n[0],10),isNaN(s))throw new Error("Invalid Format: "+n[0]);if(s<0)throw new Error("Seconds must be greater than or equal to 0.");s>59&&(i.secondsWildcard=!0),i.seconds=s}else if(n.length===2){if(n[0]==="*")i.minutesWildcard=!0,i.minutes=-1;else{if(n[0][0]==="*"?(i.minutesWildcard=!0,n[0]=n[0].substr(1)):i.minutesWildcard=!1,s=parseInt(n[0],10),isNaN(s))throw new Error("Invalid Format: "+n[0]);if(s<0||s>59)throw new Error("Minutes can only be 0 to 59");i.minutes=s}if(n[1]==="*")i.secondsWildcard=!0,i.seconds=-1;else{if(n[1][0]==="*"?(i.secondsWildcard=!0,n[1]=n[1].substr(1)):i.secondsWildcard=!1,s=parseInt(n[1],10),isNaN(s))throw new Error("Invalid Format: "+n[1]);if(s<0||s>59)throw new Error("Seconds can only be 0 to 59");i.seconds=s}}else{if(n[0]==="*")i.hoursWildcard=!0,i.hours=-1;else{if(n[0][0]==="*"?(i.hoursWildcard=!0,n[0]=n[0].substr(1)):i.hoursWildcard=!1,s=parseInt(n[0],10),isNaN(s))throw new Error("Invalid Format: "+n[0]);if(s<0||s>23)throw new Error("Hours can only be 0 to 23");i.hours=s}if(n[1]==="*")i.minutesWildcard=!0,i.seconds=-1;else{if(n[1][0]==="*"?(i.minutesWildcard=!0,n[1]=n[1].substr(1)):i.minutesWildcard=!1,s=parseInt(n[1],10),isNaN(s))throw new Error("Invalid Format: "+n[1]);if(s<0||s>59)throw new Error("Minutes can only be 0 to 59");i.minutes=s}if(n[2]==="*")i.secondsWildcard=!0,i.seconds=-1;else{if(n[2][0]==="*"?(i.secondsWildcard=!0,n[2]=n[2].substr(2)):i.secondsWildcard=!1,s=parseInt(n[2],10),isNaN(s))throw new Error("Invalid Format: "+n[2]);if(s<0||s>59)throw new Error("Seconds can only be 0 to 59");i.seconds=s}}}return e&&(i.temp=!1),i}setTempTime(h){h?this.tempTime=Date.now()+h:this.tempTime=0}},We=class u{constructor(h,t){this.name="";this.priority=0;this.display="name";this.displaytype=0;this.value="";this.style=1;this.group="";this.enabled=!0;this.notes="";if(typeof h=="object"){let e;for(e in h)h.hasOwnProperty(e)&&(this[e]=h[e])}this.profile=t}clone(){return new u(this)}},re=class u extends We{constructor(t,e){super(t);this.caption="";this.icon="";this.append=!1;this.send=!0;this.chain=!1;this.stretch=!1;this.parse=!1;this.top=-1;this.left=-1;this.right=-1;this.bottom=-1;this.width=64;this.height=64;this.iconOnly=!1;if(this.caption="NewButton",this.display="caption",typeof t=="object"){let i;for(i in t)t.hasOwnProperty(i)&&(this[i]=t[i])}this.profile=e}clone(){return new u(this)}},Ve=class u extends We{constructor(t,e){super();this.key=0;this.append=!1;this.send=!0;this.modifiers=0;this.chain=!1;this.gamepad=0;this.gamepadAxes=0;if(this.display="return MacroDisplay(item)",this.displaytype=1,typeof t=="object"){let i;for(i in t)t.hasOwnProperty(i)&&(this[i]=t[i])}this.profile=e}clone(){return new u(this)}},ze=class u extends We{constructor(t,e,i){super();this.pattern="NewAlias";this.regexp=!1;this.multi=!1;this.append=!0;this.params="";if(typeof t=="string"&&(this.pattern=t),e!=null&&(this.value=e),this.display="pattern",typeof t=="object"){let n;for(n in t)t.hasOwnProperty(n)&&(this[n]=t[n])}this.profile=i}clone(){return new u(this)}},we=class u extends We{constructor(t,e){super(t);this.pattern="NewTrigger";this.verbatim=!1;this.triggerNewline=!0;this.triggerPrompt=!1;this.type=0;this.temp=!1;this.caseSensitive=!1;this.raw=!1;this.state=0;this.params="";this.triggers=[];this.fired=!1;if(this.display="pattern",typeof t=="object"){let i;for(i in t)if(t.hasOwnProperty(i))if(i==="triggers"){this.triggers=[];let n=t.triggers.length;for(let s=0;s<n;s++)this.triggers.push(new u(t.triggers[s]))}else this[i]=t[i]}this.profile=e}clone(){return new u(this)}getState(t){return t===0?this:(t--,t>=this.triggers.length||t<0?null:this.triggers[t])}},it=class u extends We{constructor(t,e){super(t);this.caption="";this.icon="";this.append=!1;this.send=!0;this.chain=!1;this.parent="";this.items=[];this.parse=!1;if(this.caption="NewContext",this.display="caption",typeof t=="object"){let i;for(i in t)if(t.hasOwnProperty(i))if(i==="items"){let n=0,s=t[i].length;for(;n<s;n++)this.items.push(new u(t[i][n]))}else this[i]=t[i]}this.profile=e}clone(){return new u(this)}},St=class u extends We{constructor(t,e){super(t);this._type="string";this.type=1;this.defaultValue="";this.useDefault=!1;this.params="";this.profile=e,this.useDefault&&this.setValue(this.defaultValue)}set setValue(t){switch(this.type){case 2:typeof t=="string"?(t=parseInt(t,10),isNaN(t)&&(t=0)):typeof t=="boolean"&&(t=t?1:0);break;case 7:typeof t=="string"?(t=parseFloat(t),isNaN(t)&&(t=0)):typeof t=="boolean"&&(t=t?1:0);break}this.value=t,this._type=typeof t}get getValue(){switch(this.type){case 1:if(typeof this.value!==this._type)switch(this._type){case"number":return Number(this.value);case"string":return this.value.toString();case"boolean":return!!this.value}return this.value;case 7:return parseFloat(this.value);case 2:return parseInt(this.value,10);case 6:if(typeof this.value=="string")try{return JSON.parse(this.value)}catch{return this.value}return this.value;case 5:return typeof this.value=="string"?vt(this.value,"|"):this.value}return this.value}clone(){return new u(this)}toString(){switch(this.type){case 6:return typeof this.value=="string"?this.value:JSON.stringify(this.value);case 5:return typeof this.value=="string"?this.value:'"'+this.value.join('"|"')+'"'}return this.value?.toString()}},ye=class u{constructor(h,t){this.name="";this.file="";this.priority=0;this.enabled=!0;this.aliases=[];this.triggers=[];this.macros=[];this.buttons=[];this.contexts=[];this.enableMacros=!0;this.enableTriggers=!0;this.enableAliases=!0;this.enableButtons=!0;this.enableContexts=!0;this.enableDefaultContext=!0;typeof h=="string"?(this.name=h,this.file=h.toLowerCase(),(t==null||t)&&(this.macros=u.DefaultMacros)):typeof h=="boolean"?h&&(this.macros=u.DefaultMacros):(t==null||t)&&(this.macros=u.DefaultMacros)}static get Default(){return new u("Default")}static get DefaultMacros(){let h=[{key:97,display:"return MacroDisplay(item)",displaytype:1,value:"sw",style:1,append:!1,send:!0,name:"SouthWest",group:"",enabled:!0,modifiers:0,chain:!0,priority:0,notes:""},{key:98,display:"return MacroDisplay(item)",displaytype:1,value:"s",style:1,append:!1,send:!0,name:"South",group:"",enabled:!0,modifiers:0,chain:!0,priority:0,notes:""},{key:99,display:"return MacroDisplay(item)",displaytype:1,value:"se",style:1,append:!1,send:!0,name:"SouthEast",group:"",enabled:!0,modifiers:0,chain:!0,priority:0,notes:""},{key:100,display:"return MacroDisplay(item)",displaytype:1,value:"w",style:1,append:!1,send:!0,name:"West",group:"",enabled:!0,modifiers:0,chain:!0,priority:0,notes:""},{key:101,display:"return MacroDisplay(item)",displaytype:1,value:"l",style:1,append:!1,send:!0,name:"Look",group:"",enabled:!0,modifiers:0,chain:!0,priority:0,notes:""},{key:102,display:"return MacroDisplay(item)",displaytype:1,value:"e",style:1,append:!1,send:!0,name:"East",group:"",enabled:!0,modifiers:0,chain:!0,priority:0,notes:""},{key:103,display:"return MacroDisplay(item)",displaytype:1,value:"nw",style:1,append:!1,send:!0,name:"NorthWest",group:"",enabled:!0,modifiers:0,chain:!0,priority:0,notes:""},{key:104,display:"return MacroDisplay(item)",displaytype:1,value:"n",style:1,append:!1,send:!0,name:"North",group:"",enabled:!0,modifiers:0,chain:!0,priority:0,notes:""},{key:105,display:"return MacroDisplay(item)",displaytype:1,value:"ne",style:1,append:!1,send:!0,name:"NorthEast",group:"",enabled:!0,modifiers:0,chain:!0,priority:0,notes:""}],t=[],e=h.length;for(let i=0;i<e;i++)t.push(new Ve(h[i]));return t}static get DefaultButtons(){let h=[],t;return t=new re,t.right=176,t.top=14,t.caption="fa-solid fa-angle-double-up",t.value="up",t.width=48,t.height=48,h.push(t),t=new re,t.right=124,t.top=14,t.caption="fa-solid fa-caret-up,rotate--45",t.value="northwest",t.width=48,t.height=48,h.push(t),t=new re,t.right=72,t.top=14,t.caption="fa-solid fa-caret-up",t.value="north",t.width=48,t.height=48,h.push(t),t=new re,t.right=20,t.top=14,t.caption="fa-solid fa-caret-up,rotate-45",t.value="northeast",t.width=48,t.height=48,h.push(t),t=new re,t.right=176,t.top=66,t.caption="fa-solid fa-crosshairs",t.value="kill ${selected}",t.width=48,t.height=48,h.push(t),t=new re,t.right=124,t.top=66,t.caption="fa-solid fa-caret-left",t.value="west",t.width=48,t.height=48,h.push(t),t=new re,t.right=72,t.top=66,t.caption="fa-solid fa-magnifying-glass",t.value="look ${selected}",t.width=48,t.height=48,h.push(t),t=new re,t.right=20,t.top=66,t.caption="fa-solid fa-caret-right",t.value="east",t.width=48,t.height=48,h.push(t),t=new re,t.right=176,t.top=118,t.caption="fa-solid fa-angle-double-down",t.value="down",t.width=48,t.height=48,h.push(t),t=new re,t.right=124,t.top=118,t.caption="fa-solid fa-caret-down,rotate-45",t.value="southwest",t.width=48,t.height=48,h.push(t),t=new re,t.right=72,t.top=118,t.caption="fa-solid fa-caret-down",t.value="south",t.width=48,t.height=48,h.push(t),t=new re,t.right=20,t.top=118,t.caption="fa-solid fa-caret-down,rotate--45",t.value="southeast",t.width=48,t.height=48,h.push(t),h}static load(h){let t,e;if(typeof h=="object")e=h;else return new u;t=new u(!1);let i;for(i in e)e.hasOwnProperty(i)&&(i==="aliases"||i==="triggers"||i==="macros"||i==="buttons"||i==="contexts"||i==="variables"||(t[i]=e[i]));let n,s;if(e.aliases&&e.aliases.length>0)for(s=e.aliases.length,n=0;n<s;n++)t.aliases.push(new ze(e.aliases[n],null,t));if(e.triggers&&e.triggers.length>0)for(s=e.triggers.length,n=0;n<s;n++)t.triggers.push(new we(e.triggers[n],t));if(e.macros&&e.macros.length>0)for(s=e.macros.length,t.macros=[],n=0;n<s;n++)t.macros.push(new Ve(e.macros[n],t));if(e.buttons&&e.buttons.length>0)for(s=e.buttons.length,n=0;n<s;n++)t.buttons.push(new re(e.buttons[n],t));if(e.contexts&&e.contexts.length>0)for(s=e.contexts.length,n=0;n<s;n++)t.contexts.push(new it(e.contexts[n],t));return t.file=t.name,t}clone(h){let t,e,i;if(h===2){if(t={name:this.name,priority:this.priority,enabled:this.enabled,aliases:[],triggers:[],macros:[],buttons:[],contexts:[],enableMacros:this.enableMacros,enableTriggers:this.enableTriggers,enableAliases:this.enableAliases,enableButtons:this.enableButtons,enableContexts:this.enableContexts,enableDefaultContext:this.enableDefaultContext},this.aliases.length>0)for(i=this.aliases.length,e=0;e<i;e++)t.aliases.push({pattern:this.aliases[e].pattern,value:this.aliases[e].value,priority:this.aliases[e].priority,regexp:this.aliases[e].regexp,style:this.aliases[e].style,multi:this.aliases[e].multi,append:this.aliases[e].append,name:this.aliases[e].name,group:this.aliases[e].group,enabled:this.aliases[e].enabled,params:this.aliases[e].params,display:this.aliases[e].display,notes:this.aliases[e].notes||""});if(this.triggers.length>0)for(i=this.triggers.length,e=0;e<i;e++){let l={pattern:this.triggers[e].pattern,value:this.triggers[e].value,priority:this.triggers[e].priority,verbatim:this.triggers[e].verbatim,style:this.triggers[e].style,name:this.triggers[e].name,group:this.triggers[e].group,enabled:this.triggers[e].enabled,display:this.triggers[e].display,triggernewline:this.triggers[e].triggerNewline,caseSensitive:this.triggers[e].caseSensitive,triggerprompt:this.triggers[e].triggerPrompt,raw:this.triggers[e].raw,type:this.triggers[e].type,notes:this.triggers[e].notes||"",state:this.triggers[e].state||0,params:this.triggers[e].params||"",triggers:[]};if(this.triggers[e].triggers&&this.triggers[e].triggers.length){let r=this.triggers[e].triggers.length;for(let a=0;a<r;a++)l.triggers.push({pattern:this.triggers[e].triggers[a].pattern,value:this.triggers[e].triggers[a].value,priority:this.triggers[e].triggers[a].priority,verbatim:this.triggers[e].triggers[a].verbatim,style:this.triggers[e].triggers[a].style,name:this.triggers[e].triggers[a].name,group:this.triggers[e].triggers[a].group,enabled:this.triggers[e].triggers[a].enabled,display:this.triggers[e].triggers[a].display,triggernewline:this.triggers[e].triggers[a].triggerNewline,caseSensitive:this.triggers[e].triggers[a].caseSensitive,triggerprompt:this.triggers[e].triggers[a].triggerPrompt,raw:this.triggers[e].triggers[a].raw,type:this.triggers[e].triggers[a].type,notes:this.triggers[e].triggers[a].notes||"",state:this.triggers[e].triggers[a].state||0,params:this.triggers[e].triggers[a].params||"",triggers:[]})}t.triggers.push(l)}if(this.macros.length>0)for(i=this.macros.length,e=0;e<i;e++)t.macros.push({key:this.macros[e].key,value:this.macros[e].value,style:this.macros[e].style,append:this.macros[e].append,send:this.macros[e].send,name:this.macros[e].name,group:this.macros[e].group,enabled:this.macros[e].enabled,display:'if(item.key === 0) return "None"; return keyCodeToChar[item.key]',displaytype:1,modifiers:this.macros[e].modifiers,chain:this.macros[e].chain,notes:this.macros[e].notes||""});if(this.buttons.length>0)for(i=this.buttons.length,e=0;e<i;e++)t.buttons.push(Te(this.buttons[e],(l,r)=>{if(l!=="profile")return r}));if(this.contexts.length>0)for(i=this.contexts.length,e=0;e<i;e++)t.contexts.push(Te(this.contexts[e],(l,r)=>{if(l!=="profile")return r}));return t}t=Te(this,(l,r)=>{if(l!=="profile")return r});let n=new u(!1),s;for(s in t)t.hasOwnProperty(s)&&(s==="aliases"||s==="triggers"||s==="macros"||s==="buttons"||s==="contexts"||s==="variables"||(n[s]=t[s]));if(t.aliases&&t.aliases.length>0)for(i=t.aliases.length,e=0;e<i;e++)n.aliases.push(new ze(t.aliases[e],null,n));if(t.triggers&&t.triggers.length>0)for(i=t.triggers.length,e=0;e<i;e++)n.triggers.push(new we(t.triggers[e],n));if(t.macros&&t.macros.length>0)for(i=t.macros.length,n.macros=[],e=0;e<i;e++)n.macros.push(new Ve(t.macros[e],n));if(t.buttons&&t.buttons.length>0)for(i=t.buttons.length,e=0;e<i;e++)n.buttons.push(new re(t.buttons[e],n));if(t.contexts&&t.contexts.length>0)for(i=t.contexts.length,e=0;e<i;e++)n.contexts.push(new it(t.contexts[e],n));return n}find(h,t,e){let i;if(!h||h.length===0||!this[h]||this[h].length===0)return null;i=U(this[h]);let n=i.length;for(let s=0;s<n;s++)if(i[s][t]===e)return i[s];return null}findAny(h,t,e){let i;if(!h||h.length===0||!this[h]||this[h].length===0)return null;i=U(this[h]);let n=i.length;if(typeof t=="object"){for(let s=0;s<n;s++)for(let l in t)if(t.hasOwnProperty(l)&&i[s][l]===t[l])return i[s];return-1}for(let s=0;s<n;s++)if(i[s][t]===e)return i[s];return null}indexOfAny(h,t,e){let i;if(!h||h.length===0||!this[h]||this[h].length===0)return null;i=U(this[h]);let n=i.length;if(typeof t=="object"){for(let s=0;s<n;s++)for(let l in t)if(t.hasOwnProperty(l)&&i[s][l]===t[l])return this[h].indexOf(i[s]);return-1}for(let s=0;s<n;s++)if(i[s][t]===e)return this[h].indexOf(i[s]);return-1}indexOf(h,t,e){let i;if(!h||h.length===0||!this[h]||this[h].length===0)return null;i=U(this[h]);let n=i.length;if(typeof t=="object"){for(let s=0;s<n;s++){for(let l in t)t.hasOwnProperty(l)&&(i[s][l],t[l]);return this[h].indexOf(i[s])}return-1}for(let s=0;s<n;s++)if(i[s][t]===e)return this[h].indexOf(i[s]);return-1}},xt=class u{constructor(h){this.items={};this.keys=[];this.add(h??ye.Default)}SortByPriority(){this.keys.sort((h,t)=>{let e=this.items[h].priority,i=this.items[t].priority;return e>i?-1:e<i?1:h==="default"?-1:t==="default"||(e=this.items[h].name,i=this.items[t].name,e>i)?1:e<i?-1:0})}enabled(h){return!h||this.keys.length===0?!1:typeof h=="string"?this.items[h.toLowerCase()]?this.items[h.toLowerCase()].enabled:!1:this.items[h.name.toLowerCase()]?this.items[h.name.toLowerCase()].enabled:!1}contains(h){return!h||this.keys.length===0?!1:typeof h=="string"?!!this.items[h.toLowerCase()]:!!this.items[h.name.toLowerCase()]}canDisable(h){if(!h||this.keys.length===0)return!1;let t;if(typeof h=="number"){if(h<0||h>=this.keys.length)return!1;t=this.keys[h]}else if(typeof h=="object")t=h.name.toLowerCase();else if(typeof h=="string")t=h.toLowerCase();else return!1;if(!this.items[t])return!1;if(!!this.items[t].enabled){let i=!1;for(let n in this.items)if(n!==t){this.items[n].enabled&&(i=!0);break}if(!i)return!1}return!0}toggle(h){if(!h||this.keys.length===0)return!1;let t;if(typeof h=="number"){if(h<0||h>=this.keys.length)return!1;t=this.keys[h]}else if(typeof h=="object")t=h.name.toLowerCase();else if(typeof h=="string")t=h.toLowerCase();else return!1;if(!this.items[t])return!1;let e=!this.items[t].enabled;if(!e){let i=!1;for(let n in this.items)if(n!==t){this.items[n].enabled&&(i=!0);break}if(!i)return!1}return this.items[t].enabled=e,!0}update(){this.keys=Object.keys(this.items),this.SortByPriority()}add(h){h&&(this.items[h.name.toLowerCase()]=h,this.update())}remove(h){if(!(!h||this.keys.length===0)){if(typeof h=="string")delete this.items[h.toLowerCase()];else if(typeof h=="number"){if(h<0||h>=this.keys.length)return;delete this.items[this.keys[h]]}else delete this.items[h.name.toLowerCase()];this.update()}}copy(h){return h?this.keys.length===0?null:typeof h=="string"?this.items[h.toLowerCase()]?this.items[h.toLowerCase()].clone():null:typeof h=="number"?h<0||h>=this.keys.length?null:this.items[this.keys[h]].clone():h.clone():Te(this.items)}clone(h){if(h===2){let e={};for(let i in this.items)e[this.items[i].name.toLowerCase()]=this.items[i].clone(2);return e}let t=new u;for(let e in this.items)t.items[this.items[e].name.toLowerCase()]=this.items[e].clone();return t.update(),t}static load(h){return new Promise((t,e)=>{let i=new u;localforage.getItem(h||"OoMUDProfiles").then(n=>{if(typeof n=="string"&&(n=JSON.parse(n)),!n)i.add(ye.Default);else{let s=Object.keys(n),l=0,r=s.length;for(;l<r;l++)i.add(ye.load(n[s[l]]))}t(i)}).catch(e)})}save(h){return localforage.setItem(h||"OoMUDProfiles",JSON.stringify(this.items,(t,e)=>{if(t!=="profile")return e}))}get length(){return this.keys.length}count(){return this.keys.length}get active(){let h=this.keys;if(h.length===0)return this.add(ye.Default),this.items.default;if(h.length===1)return this.items[h[0]].enabled?this.items[h[0]]:this.items[h[0]].name==="Default"?(this.items[h[0]].enable=!0,this.items.default):(this.add(ye.Default),this.items.default);for(let t in h)if(this.items[t].enabled)return this.items[t];return this.items.default?(this.items.default.enabled=!0,this.items.default):(this.add(ye.Default),this.items.default)}get aliases(){let h=this.keys,t=[],e=0,i=h.length;if(i===0)return[];if(i===1)return!this.items[h[0]].enabled||!this.items[h[0]].enableAliases?[]:this.items[h[0]].aliases;for(;e<i;e++)!this.items[h[e]].enabled||!this.items[h[e]].enableAliases||this.items[h[e]].aliases.length===0||(t=t.concat(this.items[h[e]].aliases));return t}get triggers(){let h=this.keys,t=[],e=0,i=h.length;if(i===0)return[];if(i===1)return!this.items[h[0]].enabled||!this.items[h[0]].enableTriggers?[]:this.items[h[0]].triggers;for(;e<i;e++)!this.items[h[e]].enabled||!this.items[h[e]].enableTriggers||this.items[h[e]].triggers.length===0||(t=t.concat(this.items[h[e]].triggers));return t}get macros(){let h=this.keys,t=[],e=0,i=h.length;if(i===0)return[];if(i===1)return!this.items[h[0]].enabled||!this.items[h[0]].enableMacros?[]:this.items[h[0]].macros;for(;e<i;e++)!this.items[h[e]].enabled||!this.items[h[e]].enableMacros||this.items[h[e]].macros.length===0||(t=t.concat(this.items[h[e]].macros));return t}get buttons(){let h=this.keys,t=[],e=0,i=h.length;if(i===0)return[];if(i===1)return!this.items[h[0]].enabled||!this.items[h[0]].enableButtons?[]:this.items[h[0]].buttons;for(;e<i;e++)!this.items[h[e]].enabled||!this.items[h[e]].enableButtons||this.items[h[e]].buttons.length===0||(t=t.concat(this.items[h[e]].buttons));return t}get contexts(){let h=this.keys,t=[],e=0,i=h.length;if(i===0)return[];if(i===1)return!this.items[h[0]].enabled||!this.items[h[0]].enableContexts?[]:this.items[h[0]].contexts;for(;e<i;e++)!this.items[h[e]].enabled||!this.items[h[e]].enableContexts||this.items[h[e]].contexts.length===0||(t=t.concat(this.items[h[e]].contexts));return t}get defaultContext(){let h=this.keys,t=0,e=h.length;if(e===0)return!0;if(e===1)return this.items[h[0]].enabled?this.items[h[0]].enableDefaultContext:!0;for(;t<e;t++)if(this.items[h[t]].enabled&&!this.items[h[t]].enableDefaultContext)return!1;return!0}};function tt(u,h){if(!u||!u.length)return"";let t;(C=>(C[C.None=0]="None",C[C.Ampersand=1]="Ampersand",C[C.Percent=2]="Percent",C[C.StringMatch=3]="StringMatch",C[C.SubPattern=4]="SubPattern",C[C.AmpersandPercent=5]="AmpersandPercent",C[C.AmpersandPattern=6]="AmpersandPattern",C[C.AmpersandRange=7]="AmpersandRange",C[C.PercentRegex=8]="PercentRegex",C[C.Escape=9]="Escape",C[C.Variable=10]="Variable"))(t||={});let e=0,i=[],n=0,s=u.length,l,r,a,o,f=0;for(n=0;n<s;n++)switch(l=u.charAt(n),r=u.charCodeAt(n),e){case 1:if(a.length===0&&(l==="*"||l==="?"||l==="^"||l==="$"))o=l;else if(a.length===0&&l==="%")e=5;else if(o.length===0&&l==="(")o=l,e=6;else if(o.length===0&&l==="[")o=l,e=7;else{if(l==="{")continue;if(l==="}"||!(r>=48&&r<=57||r>=65&&r<=90||r>=97&&r<=122||r===95||r===36)){if(!Re(a))throw new Error("Invalid variable name");!o.length&&/^\d+$/.exec(a)?i.push("{",a,"}"):o.length?i.push("(?<",a,">",tt(o),")"):i.push("(?<",a,">.*)"),l!=="}"&&n--,e=0}else a+=l}break;case 5:o+="%"+l,e=1;break;case 6:o+=l,l===")"&&(e=1);break;case 7:o+=l,l==="]"&&(e=1);break;case 2:switch(l){case"d":i.push("\\d+"),e=0;break;case"n":i.push("[+-]?\\d+"),e=0;break;case"w":i.push("\\w"),e=0;break;case"a":i.push("[a-zA-Z0-9]*"),e=0;break;case"s":i.push("\\s*"),e=0;break;case"x":i.push("\\S*"),e=0;break;case"y":i.push("\\S*"),e=0;break;case"p":i.push(`[\\.\\?\\!\\:\\;\\-\\\u2014\\(\\)\\[\\]\\'\\"\\\\/\\,]{1}`),e=0;break;case"q":i.push(`[\\.\\?\\!\\:\\;\\-\\\u2014\\(\\)\\[\\]\\'\\"\\\\/\\,]{1}`),e=0;break;case"t":e=0;break;case"e":i.push("\x1B"),e=0;break;case"/":e=8,a="";break}break;case 8:if(l==="%"){if(!a.endsWith("/"))throw new Error("Invalid %/regex/% pattern");i.push(a.substr(0,a.length-1))}else a+=l;break;case 3:l==="^"&&a.length===0?o=!0:l==="}"?(o?i.push("[^",a,"]"):i.push(a),e=0):a+=l;break;case 4:l===":"?(i.push("(?<",a,">"),e=0):l===")"?(i.push("(",tt(a),")"),e=0,f--):a+=l;break;case 9:i.push("\\",l),e=0;break;case 10:if(l==="{"&&a.length===0)continue;if(l==="}"||!(r>=48&&r<=57||r>=65&&r<=90||r>=97&&r<=122||r===95||r===36)){if(!Re(a))throw new Error("Invalid variable name");h&&(h.variables[a]instanceof St?i.push(h.variables[a].value||""):i.push(h.variables[a]||"")),l!=="}"&&n--,e=0}else a+=l;break;default:l==="*"?i.push(".*"):l==="?"?i.push("."):l==="~"?e=9:l==="@"?(e=10,a=""):l==="&"?(a="",o="",e=1):l==="%"?e=2:l==="{"?(e=3,a=""):l==="("?(e=4,a="",f++):(l===")"&&f--,i.push(l));break}switch(e){case 1:if(!Re(a))throw new Error("Invalid variable name");!o.length&&/^\d+$/.exec(a)?i.push("{",a,"}"):o.length?i.push("(?<",a,">",tt(o),")"):i.push("(?<",a,">.*)");break;case 5:case 6:case 7:throw new Error("Invalid &VarName pattern");case 2:throw new Error("Invalid % pattern");case 8:throw new Error("Invalid %/regex/% pattern");case 3:throw new Error("Invalid string match pattern");case 4:throw new Error("Invalid (sub:pattern) pattern");case 9:throw new Error("Invalid escape pattern");case 10:if(!Re(a))throw new Error("Invalid variable name");h&&(h.variables[a]instanceof St?i.push(h.variables[a].getValue()||""):i.push(h.variables[a]||""));break}if(f)throw new Error("Invalid save matched pattern");return i.join("")}var ft,He,_t=["$selectedword","$selword","$selectedurl","$selurl","$selectedline","$selline","$selected","$character","$copied","$action","$trigger","$caption","$characterid"];function kt(u){return u.replace(/\w*\S*/g,h=>h.charAt(0).toUpperCase()+h.substr(1).toLowerCase())}function gi(){switch(~~(Math.random()*6)+1){case 1:case 4:return-1;case 3:case 2:return 1}return 0}var Et=class extends ie{constructor(t){super();this._historyIdx=-1;this._tabIdx=-1;this._tabWords=null;this._locked=0;this._TriggerCache=null;this._TriggerStates={};this._TriggerFunctionCache={};this._TriggerRegExCache={};this._LastTriggered="";this._LastTrigger=null;this._scrollLock=!1;this._gag=0;this._gagID=[];this._gags=[];this._stack=[];this._vStack=[];this._controllers={};this._controllersCount=0;this._gamepadCaches=null;this._lastSuspend=-1;this._MacroCache={};this._loops=[];this._pathQueue=[];this._pathTimeout=null;this._pathPaused=!1;this.client=null;this.enableParsing=!0;this.enableTriggers=!0;if(!t)throw new Error("Invalid client!");this.client=t,ft=()=>He||(this.initMathJS(),He),this._commandHistory=[],document.addEventListener("keydown",e=>{!this.isLocked&&this.ProcessMacros(e.which,e.altKey,e.ctrlKey,e.shiftKey,e.metaKey)?(e.preventDefault(),e.stopPropagation()):e.key==="ScrollLock"&&this.toggleScrollLock()}),this.client.on("parse-command",e=>{this.client.getOption("parseCommands")&&(e.value=this.parseOutgoing(e.value,null,null,null,null,!e.comments))}),this.client.on("add-line",e=>{if(this.ExecuteTriggers(140,e.line,e.raw,e.fragment,!1,!0),this._gag>0&&!e.fragment&&(e.gagged=!0,this._gag--),!e.fragment)for(let i in this._TriggerStates)this._TriggerStates[i].lineCount&&this._TriggerStates[i].lineCount--}),this.client.on("options-loaded",()=>{!He&&this.client.getOption("initializeScriptEngineOnLoad")&&this.initMathJS(),this.initPads()}),this.client.commandInput.addEventListener("keyup",e=>{e.key!=="Escape"&&e.key!=="ArrowUp"&&e.key!=="ArrowDown"&&(this._historyIdx=this._commandHistory.length)}),this.client.commandInput.addEventListener("keydown",e=>{switch(e.key){case"Escape":if(e.ctrlKey||e.shiftKey||e.metaKey||e.altKey)return;this.client.commandInput.blur(),this.client.commandInput.value="",this.client.commandInput.select(),this._historyIdx=this._commandHistory.length,this._tabIdx=-1,this._tabWords=null,this._tabSearch=null,this.emit("history-navigate",e);break;case"ArrowUp":if(e.ctrlKey||e.shiftKey||e.metaKey||e.altKey)return;this._historyIdx===this._commandHistory.length&&this.client.commandInput.value.length>0&&(this.AddCommandToHistory(this.client.commandInput.value),this.client.commandInput.value===this._commandHistory[this._historyIdx-1]&&this._historyIdx--),this._historyIdx--,this._historyIdx<0&&(this._historyIdx=0),this._commandHistory.length<0?(this._historyIdx=-1,this.client.commandInput.value=""):this._commandHistory.length>0&&this._historyIdx<this._commandHistory.length&&this._historyIdx>=0&&(this.client.commandInput.value=this._commandHistory[this._historyIdx]),setTimeout(()=>this.client.commandInput.select(),0),this.emit("history-navigate",e);break;case"ArrowDown":if(e.ctrlKey||e.shiftKey||e.metaKey||e.altKey)return;this._historyIdx===this._commandHistory.length&&this.client.commandInput.value.length>0&&this.AddCommandToHistory(this.client.commandInput.value),this._historyIdx++,this._historyIdx>=this._commandHistory.length||this._commandHistory.length<1?(this._historyIdx=this._commandHistory.length,this.client.commandInput.value=""):this._commandHistory.length>0&&this._historyIdx<this._commandHistory.length&&this._historyIdx>=0&&(this.client.commandInput.value=this._commandHistory[this._historyIdx]),setTimeout(()=>this.client.commandInput.select(),0),this.emit("history-navigate",e);break;case"Enter":switch(this.client.getOption("newlineShortcut")){case 1:if(e.ctrlKey&&!e.shiftKey&&!e.metaKey&&!e.altKey)return Ge(this.client.commandInput,`
`),this.emit("history-navigate",e),this.client.commandInput.blur(),this.client.commandInput.focus(),!0;break;case 8:if(e.ctrlKey&&e.shiftKey&&!e.metaKey&&!e.altKey)return Ge(this.client.commandInput,`
`),this.emit("history-navigate",e),this.client.commandInput.blur(),this.client.commandInput.focus(),!0;break;case 4:if((e.ctrlKey||e.shiftKey)&&!e.metaKey&&!e.altKey)return Ge(this.client.commandInput,`
`),this.emit("history-navigate",e),this.client.commandInput.blur(),this.client.commandInput.focus(),!0;break;case 2:if(e.ctrlKey&&e.shiftKey&&!e.metaKey&&!e.altKey)return Ge(this.client.commandInput,`
`),this.emit("history-navigate",e),this.client.commandInput.blur(),this.client.commandInput.focus(),!0;break}!e.ctrlKey&&!e.shiftKey&&!e.metaKey&&!e.altKey&&(this._tabIdx=-1,this._tabWords=null,this._tabSearch=null,this.client.sendCommand(null,null,this.client.getOption("allowCommentsFromCommand")),this.emit("history-navigate",e)),e.preventDefault();break;case"Tab":if(!this.client.getOption("enableTabCompletion")||this.client.commandInput.value.length===0||e.altKey||e.ctrlKey||e.metaKey)return;e.shiftKey?this._tabIdx--:this._tabIdx++;let i=this.client.commandInput.selectionStart,n=this.client.commandInput.selectionEnd;if(this._tabWords===null){let l=ci(this.client.commandInput),r=this.client.commandInput.value.indexOf(" ",l);r===-1&&(r=this.client.commandInput.value.indexOf(`
`,l));let a=this.client.commandInput.value.lastIndexOf(" ",l-1);a===-1&&(a=this.client.commandInput.value.indexOf(`
`,l-1)),r===-1&&(r=this.client.commandInput.value.length),a===-1?a=0:a++,i=a,n=r,i===n&&n++;let o=this.client.commandInput.value.substring(a,r);if(o.length===0)return;this._tabSearch={start:a,end:r,find:o.length};let f=new RegExp(`^${o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}`,this.client.getOption("ignoreCaseTabCompletion")?"i":"");this.client.getOption("tabCompletionLookupType")===8?this._tabWords=[...new Set(this.client.getOption("tabCompletionList").split(/\s+/).filter(p=>p.match(f)))]:(this._tabWords=[].concat(...this.client.display.lines.slice(this.client.display.lines.length-this.client.getOption("tabCompletionBufferLimit")).map(p=>p.text.split(/\s+/))).filter(p=>p.match(f)).reverse(),this.client.getOption("tabCompletionLookupType")===1?this._tabWords=[...new Set(this.client.getOption("tabCompletionList").split(/\s+/).filter(p=>p.match(f)).reverse())].concat(this._tabWords):this.client.getOption("tabCompletionLookupType")===2&&(this._tabWords=this._tabWords.concat([...new Set(this.client.getOption("tabCompletionList").split(/\s+/).filter(p=>p.match(f)).reverse())])),this._tabWords=[...new Set(this._tabWords)])}else i-=this._tabSearch.find;if(this._tabWords.length===0)return;this._tabIdx<0&&(this._tabIdx=this._tabWords.length-1),this._tabIdx>=this._tabWords.length&&(this._tabIdx=0);let s=this.client.getOption("tabCompletionReplaceCasing");this.client.commandInput.value=this.client.commandInput.value.substring(0,i)+(s===1?this._tabWords[this._tabIdx].toLowerCase():s===2?this._tabWords[this._tabIdx].toUpperCase():this._tabWords[this._tabIdx])+this.client.commandInput.value.substring(n,this.client.commandInput.value.length),this.client.commandInput.selectionStart=this._tabSearch.start+this._tabSearch.find,this.client.commandInput.selectionEnd=this._tabSearch.start+this._tabWords[this._tabIdx].length,e.preventDefault(),this.emit("history-navigate",e);break;case"Shift":case"Control":case"Meta":case"Alt":case"CapsLock":case"Fn":case"NumLock":case"ScrollLock":case"Super":case"PageDown":case"PageUp":case"End":case"Home":case"ArrowLeft":case"ArrowRight":case"ContextMenu":break;default:this._tabIdx=-1,this._tabWords=null,this._tabSearch=null;break}}),this.client.commandInput.addEventListener("mouseup",e=>{this._tabIdx=-1,this._tabWords=null,this._tabSearch=null}),window.addEventListener("gamepadconnected",e=>{this.client.getOption("gamepads")&&(this._gamepadCaches||(this._gamepadCaches=[]),this._controllers[e.gamepad.index]={pad:e.gamepad,axes:Te(e.gamepad.axes),state:{axes:[],buttons:[]},pState:{axes:[],buttons:[]}},this._controllersCount++,this.updatePads())}),window.addEventListener("gamepaddisconnected",e=>{this.client.getOption("gamepads")&&(delete this._controllers[e.gamepad.index],this._controllersCount--)}),this.initPads()}getScope(){let t={};if(Object.assign(t,this.client.variables),_t.forEach(e=>{t[e]=window[e],t[e.substr(1)]=window[e]}),this._stack.length===0||!this.stack.named&&!this.loops.length)return t;if(this.stack.named&&Object.assign(t,this.stack.named),this.loops.length){t.repeatnum=this.repeatnum;let e=this.loops.length;for(let i=0;i<e&&i<18;i++)t[String.fromCharCode(105+i)]=this.loops[i]}return t}setScope(t){if(t===this.client.variables)return;let e=this.loops.length;for(let i in t)if(!(!Object.prototype.hasOwnProperty.call(t,i)||i==="i"||i==="repeatnum")&&!(_t.indexOf(i)!==-1||_t.indexOf("$"+i)!==-1)){switch(i){case"clientid":continue}i.length===1&&e&&i.charCodeAt(0)>=105&&i.charCodeAt(0)<105+e||this.stack.named&&Object.prototype.hasOwnProperty.call(this.stack.named,i)||(this.client.variables[i]=t[i])}}evaluate(t){let e=this.getScope(),i=ft().evaluate(t,e);return this.setScope(e),i}get stack(){return this._stack.length===0&&this._stack.push({args:0,named:0,used:0,append:!1}),this._stack[this._stack.length-1]}get repeatnum(){return this.loops.length===0?0:this.loops[this.loops.length-1]}get loops(){return this._stack.length===0||!this.stack.hasOwnProperty("loops")?this._loops:this.stack.loops}get regex(){let t=this._stack.length;if(t===0)return null;for(;t>=0;)if(t--,this._stack[t].hasOwnProperty("regex"))return this._stack[t].regex;return null}get indices(){let t=this._stack.length;if(t===0)return[];for(;t>=0;)if(t--,this._stack[t].hasOwnProperty("indices"))return this._stack[t].indices;return[]}get vStack(){return this._vStack.length===0?{}:this._vStack[this._vStack.length-1]}vStackPush(t){this._vStack.push(t)}vStackPop(){this._vStack.pop()}get scrollLock(){return this._scrollLock}set scrollLock(t){t!==this._scrollLock&&(this._scrollLock=t,this.emit("scroll-lock",this.scrollLock))}get lastTriggerExecuted(){return this._LastTrigger}get lastTriggered(){return this._LastTriggered}set lastTriggered(t){this._LastTriggered=t}getDiceArguments(t,e,i){let n=/(\d+)\s*?d(F|f|%|\d+)(\s*?[-|+|*|\/]?\s*?\d+)?/g.exec(t.toString());if(!n||n.length<3)if(n=/(\d+)\s*?d\s*?\/\s*?(100)(\s*?[-|+|*|\/]?\s*?\d+)?/g.exec(t.toString()),!n||n.length<3){if(t=t.compile().evaluate(e),n=/(\d+)\s*?d(F|f|%|\d+)(\s*?[-|+|*|\/]?\s*?\d+)?/g.exec(t.toString()),!n||n.length<3){if(n=/(\d+)\s*?d\s*?\/\s*?(100)(\s*?[-|+|*|\/]?\s*?\d+)?/g.exec(t.toString()),!n||n.length<3)throw new Error("Invalid dice for "+(i||"dice"));n[2]="%"}}else n[2]="%";return n}initMathJS(){He=math;let t={esc:"\x1B",cr:`
`,lf:"\r",crlf:`\r
`,diceavg:(e,i,n)=>{let s,l,r,a,o,f;if(e.length===0)throw new Error("Invalid arguments for diceavg");if(e.length===1)s=this.getDiceArguments(e[0],n,"diceavg"),l=parseInt(s[1]),r=s[2],s.length>3&&(a=s[3]);else if(e.length<4)l=e[0].compile().evaluate(n),r=e[1].toString().trim(),r!=="F"&&r!=="%"&&(r=e[1].compile().evaluate(n)),e.length>2&&(a=e[2].compile().evaluate(n));else throw new Error("Too many arguments for diceavg");return o=1,r==="F"||r==="f"?(o=-1,f=1):r==="%"?(f=1,o=0):f=parseInt(r),a?i.evaluate((o+f)/2*l+a,n):(o+f)/2*l},dicemin:(e,i,n)=>{let s,l,r,a,o;if(e.length===0)throw new Error("Invalid arguments for dicemin");if(e.length===1)s=s=this.getDiceArguments(e[0],n,"dicemin"),l=parseInt(s[1]),r=s[2],s.length>3&&(a=s[3]);else if(e.length<4)l=e[0].compile().evaluate(n),r=e[1].toString().trim(),r!=="F"&&r!=="%"&&(r=e[1].compile().evaluate(n)),e.length>2&&(a=e[2].compile().evaluate(n));else throw new Error("Too many arguments for dicemin");return o=1,r==="F"||r==="f"?o=-1:r==="%"&&(o=0),a?i.evaluate(o*l+a,n):o*l},dicemax:(e,i,n)=>{let s,l,r,a,o;if(e.length===0)throw new Error("Invalid arguments for dicemax");if(e.length===1)s=this.getDiceArguments(e[0],n,"dicemax"),l=parseInt(s[1]),r=s[2],s.length>3&&(a=s[3]);else if(e.length<4)l=e[0].compile().evaluate(n),r=e[1].toString().trim(),r!=="F"&&r!=="%"&&(r=e[1].compile().evaluate(n)),e.length>2&&(a=e[2].compile().evaluate(n));else throw new Error("Too many arguments for dicemax");return r==="F"||r==="f"||r==="%"?o=1:o=parseInt(r),a?i.evaluate(o*l+a,n):o*l},dicedev:(e,i,n)=>{let s,l,r,a,o;if(e.length===0)throw new Error("Invalid arguments for dicedev");if(e.length===1)s=this.getDiceArguments(e[0],n,"dicedev"),l=parseInt(s[1]),r=s[2],s.length>3&&(a=s[3]);else if(e.length<4)l=e[0].compile().evaluate(n),r=e[1].toString().trim(),r!=="F"&&r!=="%"&&(r=e[1].compile().evaluate(n)),e.length>2&&(a=e[2].compile().evaluate(n));else throw new Error("Too many arguments for dicedev");return r==="F"||r==="f"?o=6:r==="%"?o=1:o=parseInt(r),a?i.evaluate(Math.sqrt((o*o-1)/12*l)+a,n):Math.sqrt((o*o-1)/12*l)},zdicedev:(e,i,n)=>{let s,l,r,a,o;if(e.length===0)throw new Error("Invalid arguments for zdicedev");if(e.length===1)s=this.getDiceArguments(e[0],n,"zdicedev"),l=parseInt(s[1]),r=s[2],s.length>3&&(a=s[3]);else if(e.length<4)l=e[0].compile().evaluate(n),r=e[1].toString().trim(),r!=="F"&&r!=="%"&&(r=e[1].compile().evaluate(n)),e.length>2&&(a=e[2].compile().evaluate(n));else throw new Error("Too many arguments for zdicedev");return r==="F"||r==="f"?o=6:r==="%"?o=1:o=parseInt(r),o--,a?i.evaluate(Math.sqrt((o*o-1)/12*l)+a,n):Math.sqrt((o*o-1)/12*l)},dice:(e,i,n)=>{let s,l,r,a;if(e.length===1)s=this.getDiceArguments(e[0],n,"dice"),l=parseInt(s[1]),r=s[2],s.length>3&&(a=s[3]);else if(e.length>1)l=e[0].compile().evaluate(n),r=e[1].toString().trim(),r!=="F"&&r!=="%"&&(r=e[1].compile().evaluate(n)),e.length>2&&(a=e[2].compile().evaluate(n));else throw new Error("Invalid arguments for dice");let o=0;for(let f=0;f<l;f++)r==="F"||r==="f"?o+=gi():r==="%"?o+=~~(Math.random()*100)+1:o+=~~(Math.random()*r)+1;return r==="%"&&(o/=100),a?i.evaluate(o+a,n):o},isdefined:(e,i,n)=>{if(e.length===1)return e[0]=this.stripQuotes(e[0].toString()),this.client.variables.hasOwnProperty(e[0])||n.has(e[0])?1:0;throw new Error("Invalid arguments for isdefined")},defined:(e,i,n)=>{let s;if(e.length===0)throw new Error("Missing arguments for defined");if(e.length===1){e[0]=this.stripQuotes(e[0],!0);let l=this.client.profiles.keys,r=0,a=l.length;if(a===0)return 0;for(;r<a;r++)if(s=U(this.client.profiles.items[l[r]].aliases),s=s.find(o=>o.pattern===e[0]),s||(s=U(this.client.profiles.items[l[r]].triggers),s=s.find(o=>o.pattern===e[0]||o.name===e[0]),s)||(s=U(this.client.profiles.items[l[r]].macros),s=s.find(o=>Ye(o).toLowerCase()===e[0].toLowerCase()||o.name===e[0]),s)||(s=U(this.client.profiles.items[l[r]].aliases),s=s.find(o=>o.caption===e[0]||o.name===e[0]),s))return 1;return this.client.variables.hasOwnProperty(e[0])}else if(e.length===2){e[0]=this.stripQuotes(e[0].toString()),e[0]=this.stripQuotes(e[1].toString());let l=this.client.profiles.keys,r=0,a=l.length;if(a===0)return 0;for(;r<a;r++)switch(e[1]){case"alias":return s=U(this.client.profiles.items[l[r]].aliases),s=s.find(o=>o.pattern===e[0]),s?1:0;case"event":return s=U(this.client.profiles.items[l[r]].triggers),s=s.find(o=>o.type===2&&(o.pattern===e[0]||o.name===e[0])),s?1:0;case"trigger":return s=U(this.client.profiles.items[l[r]].triggers),s=s.find(o=>o.pattern===e[0]||o.name===e[0]),s?1:0;case"macro":return s=U(this.client.profiles.items[l[r]].macros),s=s.find(o=>Ye(o).toLowerCase()===e[0].toLowerCase()||o.name===e[0]),s?1:0;case"button":return s=U(this.client.profiles.items[l[r]].aliases),s=s.find(o=>o.caption===e[0]||o.name===e[0]),s?1:0}if(e[1]==="variable")return this.client.variables.hasOwnProperty(e[0])||n.has(e[0])}else throw new Error("Too many arguments for defined");return 0},time:(e,i,n)=>{if(e.length>1)throw new Error("Too many arguments for time");return moment?e.length?moment().format(e[0].compile().evaluate(n)):moment().format():new Date().toISOString()},clip:(e,i,n)=>{if(e.length>1)throw new Error("Too many arguments for clip");if(e.length){this.client.writeClipboard(e[0].compile().evaluate(n));return}return this.client.readClipboard()},if:(e,i,n)=>{if(e.length<3)throw new Error("Missing arguments for if");if(e.length!==3)throw new Error("Too many arguments for if");return e[0].compile().evaluate(n)?e[1].compile().evaluate(n):e[2].compile().evaluate(n)},len:(e,i,n)=>{if(e.length===0)throw new Error("Missing arguments for len");if(e.length!==1)throw new Error("Too many arguments for len");return e[0].compile().evaluate(n).toString().length},stripansi:(e,i,n)=>{if(e.length===0)throw new Error("Missing arguments for len");if(e.length!==1)throw new Error("Too many arguments for len");let s=new RegExp("[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)|(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-nq-uy=><~]))","g");return e[0].compile().evaluate(n).toString().replace(s,"")},ansi:(e,i,n)=>{if(e.length===0)throw new Error("Missing arguments for ansi");e=e.map(f=>Me(f.toString())===-1&&f.toString()!=="current"?f.compile().evaluate(n).toString():f.toString());let s=e.length,l=[],r={},a,o;for(a=0;a<s;a++)if(e[a].trim()==="current")l.push(e[a].trim());else{if(o=Me(e[a].trim()),o===-1)throw new Error("Invalid color or style for ansi");o>=0&&o<30?r[o]=1:l.push(e[a])}if(l.length>2)throw new Error("Too many colors for ansi");if(l.length>1&&(l[1]==="current"?l[1]="":l[1]=Me(l[1],!0)),l.length>0&&(r[1]&&l[0]==="white"||l[0]==="current"?l[0]="":l[0]=Me(l[0])),r=[...Object.keys(r),...l],!r.length)throw new Error("Invalid colors or styles for ansi");return r=r.filter(f=>f!==""),`\x1B[${r.join(";")}m`},color:(e,i,n)=>{if(e.length===0)throw new Error("Missing arguments for color");e=e.map(r=>Me(r.toString())===-1&&r.toString()!=="current"?r.compile().evaluate(n).toString():r.toString());let s,l;if(e.length===1){if(e[0]==="bold")return"370";if(s=ee(e[0]),s===-1)throw new Error("Invalid fore color");return s.toString()}else if(e.length===2){if(e[0]==="bold")s=370;else{if(s=ee(e[0]),s===-1)throw new Error("Invalid fore color");if(e[1]==="bold")return(s*10).toString()}if(l=s.toString(),s=ee(e[1],!0),s===-1)throw new Error("Invalid back color");return l+","+s.toString()}else if(e.length===3){if(e[0]==="bold"&&(e.shift(),e.push("bold")),e[2]!=="bold")throw new Error("Only bold is supported as third argument for color");if(s=ee(e[0]),s===-1)throw new Error("Invalid fore color");if(l=(s*10).toString(),s=ee(e[1],!0),s===-1)throw new Error("Invalid back color");return l+","+s.toString()}throw new Error("Too many arguments")},zcolor:(e,i,n)=>{if(e.length===0)throw new Error("Missing arguments for zcolor");if(e.length>1)throw new Error("Too many arguments for zcolor");return Yt(parseInt(e[0].compile().evaluate(n),10))},case:(e,i,n)=>{if(e.length===0)throw new Error("Missing arguments for case");let s=e[0].compile().evaluate(n);return s>0&&s<e.length?e[s].compile().evaluate(n):null},switch:(e,i,n)=>{if(e.length===0)throw new Error("Missing arguments for switch");if(e.length%2===1)throw new Error("All expressions must have a value for switch");let s=e.length;for(let l=0;l<s;l+=2)if(e[l].compile().evaluate(n))return e[l+1].compile().evaluate(n);return null},ascii:(e,i,n)=>{if(e.length===0)throw new Error("Missing arguments for ascii");if(e.length>1)throw new Error("Too many arguments for ascii");if(e[0].toString().trim().length===0)throw new Error("Invalid argument, empty string for ascii");return e[0].toString().trim().charCodeAt(0)},char:(e,i,n)=>{if(e.length===0)throw new Error("Missing arguments for char");if(e.length>1)throw new Error("Too many arguments for char");let s=e[0].compile().evaluate(n);if(isNaN(s))throw new Error("Invalid argument '"+e[0].toString()+"' must be a number for char");return String.fromCharCode(s)},bitand:(e,i,n)=>{if(e.length===0)throw new Error("Missing arguments for bitand");if(e.length!==2)throw new Error("Too many arguments for bitand");let s=e[0].compile().evaluate(n);if(isNaN(s))throw new Error("Invalid argument '"+e[0].toString()+"' must be a number for bitand");let l=e[1].compile().evaluate(n);if(isNaN(l))throw new Error("Invalid argument '"+e[1].toString()+"' must be a number for bitand");return s&l},bitnot:(e,i,n)=>{if(e.length===0)throw new Error("Missing arguments for bitnot");if(e.length!==1)throw new Error("Too many arguments for bitnot");let s=e[0].compile().evaluate(n);if(isNaN(s))throw new Error("Invalid argument '"+e[0].toString()+"' must be a number for bitnot");return~s},bitor:(e,i,n)=>{if(e.length===0)throw new Error("Missing arguments for bitor");if(e.length!==2)throw new Error("Too many arguments for bitor");let s=e[0].compile().evaluate(n);if(isNaN(s))throw new Error("Invalid argument '"+e[0].toString()+"' must be a number for bitor");let l=e[1].compile().evaluate(n);if(isNaN(l))throw new Error("Invalid argument '"+e[1].toString()+"' must be a number for bitor");return s|l},bitset:(e,i,n)=>{if(e.length===0)throw new Error("Missing arguments for bitset");if(e.length>3)throw new Error("Too many arguments for bitset");let s=e[0].compile().evaluate(n);if(isNaN(s))throw new Error("Invalid argument '"+e[0].toString()+"' must be a number for bitset");let l=e[1].compile().evaluate(n);if(isNaN(l))throw new Error("Invalid argument '"+e[1].toString()+"' must be a number for bitset");l--;let r=1;if(e.length===3&&(r=e[2].compile().evaluate(n),isNaN(r)))throw new Error("Invalid argument '"+e[2].toString()+"' must be a number for bitset");return s&~(1<<l)|(r?1:0)<<l},bitshift:(e,i,n)=>{if(e.length===0)throw new Error("Missing arguments for bitshift");if(e.length!==2)throw new Error("Too many arguments for bitshift");let s=e[0].compile().evaluate(n);if(isNaN(s))throw new Error("Invalid argument '"+e[0].toString()+"' must be a number for bitshift");let l=e[1].compile().evaluate(n);if(isNaN(l))throw new Error("Invalid argument '"+e[1].toString()+"' must be a number for bitshift");return l<0?s>>-l:s<<l},bittest:(e,i,n)=>{if(e.length===0)throw new Error("Missing arguments for bittest");if(e.length!==2)throw new Error("Too many arguments for bittest");let s=e[0].compile().evaluate(n);if(isNaN(s))throw new Error("Invalid argument '"+e[0].toString()+"' must be a number for bittest");let l=e[1].compile().evaluate(n);if(isNaN(l))throw new Error("Invalid argument '"+e[1].toString()+"' must be a number for bittest");return l--,(s>>l)%2!=0?1:0},bitxor:(e,i,n)=>{if(e.length===0)throw new Error("Missing arguments for bitxor");if(e.length!==2)throw new Error("Too many arguments for bitxor");let s=e[0].compile().evaluate(n);if(isNaN(s))throw new Error("Invalid argument '"+e[0].toString()+"' must be a number for bitxor");let l=e[1].compile().evaluate(n);if(isNaN(l))throw new Error("Invalid argument '"+e[1].toString()+"' must be a number for bitxor");return s^l},tonumber:(e,i,n)=>{if(e.length===0)throw new Error("Missing arguments for number");if(e.length>1)throw new Error("Too many arguments for number");return e[0]=e[0].compile().evaluate(n).toString(),e[0].match(/^\s*?[-|+]?\d+\s*?$/)?parseInt(e[0],10):e[0].match(/^\s*?[-|+]?\d+\.\d+\s*?$/)?parseFloat(e[0]):e[0]==="true"?1:(e[0]==="false",0)},isfloat:(e,i,n)=>{if(e.length===0)throw new Error("Missing arguments for isfloat");if(e.length>1)throw new Error("Too many arguments for isfloat");return e[0]=e[0].compile().evaluate(n).toString(),e[0].match(/^\s*?[-|+]?\d+\.\d+\s*?$/)?1:0},isnumber:(e,i,n)=>{if(e.length===0)throw new Error("Missing arguments for isnumber");if(e.length>1)throw new Error("Too many arguments for isnumber");return e[0]=e[0].compile().evaluate(n).toString(),e[0].match(/^\s*?[-|+]?\d+\s*?$/)||e[0].match(/^\s*?[-|+]?\d+\.\d+\s*?$/)?1:0},tostring:(e,i,n)=>{if(e.length===0)throw new Error("Missing arguments for string");if(e.length>1)throw new Error("Too many arguments for string");return e[0].compile().evaluate(n).toString()},float:(e,i,n)=>{if(e.length===0)throw new Error("Missing arguments for float");if(e.length>1)throw new Error("Too many arguments for float");return e[0]=e[0].compile().evaluate(n).toString(),e[0].match(/^\s*?[-|+]?\d+\s*?$/)||e[0].match(/^\s*?[-|+]?\d+\.\d+\s*?$/)?parseFloat(e[0]):e[0]==="true"?1:(e[0]==="false",0)},trim:(e,i,n)=>{if(e.length!==1)throw new Error("Missing arguments for trim");return e[0].compile().evaluate(n).toString().trim()},trimleft:(e,i,n)=>{if(e.length!==1)throw new Error("Missing arguments for trimleft");return e[0].compile().evaluate(n).toString().trimLeft()},trimright:(e,i,n)=>{if(e.length!==1)throw new Error("Missing arguments for trimright");return e[0].compile().evaluate(n).toString().trimRight()},pos:(e,i,n)=>{if(e.length<2)throw new Error("Missing arguments for pos");if(e.length>2)throw new Error("Too many arguments for pos");return e[0]=e[0].compile().evaluate(n).toString(),e[1]=e[1].compile().evaluate(n).toString(),e[1].indexOf(e[0])+1},ipos:(e,i,n)=>{if(e.length<2)throw new Error("Missing arguments for pos");if(e.length>2)throw new Error("Too many arguments for pos");return e[0]=e[0].compile().evaluate(n).toString().toLowerCase(),e[1]=e[1].compile().evaluate(n).toString().toLowerCase(),e[1].indexOf(e[0])+1},ends:(e,i,n)=>{if(e.length<2)throw new Error("Missing arguments for ends");if(e.length>2)throw new Error("Too many arguments for ends");return e[0]=e[0].compile().evaluate(n).toString().toLowerCase(),e[1]=e[1].compile().evaluate(n).toString().toLowerCase(),e[0].endsWith(e[1])},begins:(e,i,n)=>{if(e.length<2)throw new Error("Missing arguments for begins");if(e.length>2)throw new Error("Too many arguments for begins");return e[0]=e[0].compile().evaluate(n).toString().toLowerCase(),e[1]=e[1].compile().evaluate(n).toString().toLowerCase(),e[0].startsWith(e[1])},alarm:(e,i,n)=>{let s,l,r,a,o;switch(e.length){case 0:throw new Error("Missing arguments for alarm");case 1:if(e[0]=e[0].compile().evaluate(n).toString(),s=this.client.alarms,r=s.length,r===0)throw new Error("No alarms set.");for(l=0;l<r;l++)if(s[l].type===3&&(s[l].name===e[0]||s[l].pattern===e[0]))return s[l].suspended?0:this.client.getRemainingAlarmTime(l);return;case 2:if(a=e[1].compile().evaluate(n),e[0]=e[0].compile().evaluate(n).toString(),s=this.client.alarms,r=s.length,r===0)throw new Error("No alarms set.");if(l=0,typeof a=="string"){for(;l<r;l++)if(s[l].type===3&&(s[l].name===e[0]||s[l].pattern===e[0])){if(s[l].profile.name.toUpperCase()!==a.toUpperCase())continue;return s[l].suspended?0:this.client.getRemainingAlarmTime(l)}throw new Error("Alarm not found in profile: "+a+".")}else{for(;l<r;l++)if(s[l].type===3&&(s[l].name===e[0]||s[l].pattern===e[0]))return s[l].suspended||this.client.setAlarmTempTime(l,a),a;throw new Error("Alarm not found.")}case 3:if(a=e[1].compile().evaluate(n),e[0]=e[0].compile().evaluate(n).toString(),o=e[2].compile().evaluate(n).toString(),s=this.client.alarms,r=s.length,r===0)throw new Error("No alarms set.");for(l=0;l<r;l++)if(s[l].type===3&&(s[l].name===e[0]||s[l].pattern===e[0])){if(s[l].profile.name.toUpperCase()!==o.toUpperCase())continue;return s[l].suspended||this.client.setAlarmTempTime(l,a),a}throw Error("Could not set time, alarm not found in profile: "+e[2]+".")}throw new Error("Too many arguments for alarm")},state:(e,i,n)=>{let s;if(e.length===0)throw new Error("Missing arguments for state");if(e.length>2)throw new Error("Too many arguments for state");if(e[0]=e[0].compile().evaluate(n).toString(),e.length===1){let l=this.client.profiles.keys,r=0,a=l.length;if(a===0)return null;if(a===1){if(!this.client.profiles.items[l[0]].enabled||!this.client.profiles.items[l[0]].enableTriggers)throw Error("No enabled profiles found!");s=U(this.client.profiles.items[l[r]].triggers),s=s.find(o=>o.name===e[0]||o.pattern===e[0])}else for(;r<a&&!(!(!this.client.profiles.items[l[r]].enabled||!this.client.profiles.items[l[r]].enableTriggers||this.client.profiles.items[l[r]].triggers.length===0)&&(s=U(this.client.profiles.items[l[r]].triggers),s=s.find(o=>o.name===e[0]||o.pattern===e[0]),s));r++);}else if(e.length===2){e[1]=e[1].compile().evaluate(n);let l;if(this.client.profiles.contains(e[1]))l=this.client.profiles.items[e[1].toLowerCase()];else throw new Error("Profile not found: "+e[1]);s=U(l.triggers),s=s.find(r=>r.name===e[0]||r.pattern===e[0])}if(s)return s.triggers&&s.triggers.length?s.state:0;throw new Error("Trigger not found")},isnull:(e,i,n)=>{if(e.length===0)return null;if(e.length!==1)throw new Error("Too many arguments for null");return e[0].compile().evaluate(n)?1:0},escape:(e,i,n)=>{if(e.length===0)throw new Error("Missing arguments for unescape");if(e.length!==1)throw new Error("Too many arguments for unescape");let s;if(e[0]=e[0].compile().evaluate(n).toString(),this.client.getOption("allowEscape")){let l=this.client.getOption("allowEscape")?this.client.getOption("escapeChar"):"";return s=l,l==="\\"&&(s+=l),this.client.getOption("parseDoubleQuotes")&&(s+='"'),this.client.getOption("parseSingleQuotes")&&(s+="'"),this.client.getOption("commandStacking")&&(s+=this.client.getOption("commandStackingChar")),this.client.getOption("enableSpeedpaths")&&(s+=this.client.getOption("speedpathsChar")),this.client.getOption("enableCommands")&&(s+=this.client.getOption("commandChar")),this.client.getOption("enableVerbatim")&&(s+=this.client.getOption("verbatimChar")),this.client.getOption("enableDoubleParameterEscaping")&&(s+=this.client.getOption("parametersChar")),this.client.getOption("enableNParameters")&&(s+=this.client.getOption("nParametersChar")),e.replace(new RegExp(`[${s}]`,"g"),l+"$&")}return e.replace(/[\\"']/g,"$&")},unescape:(e,i,n)=>{if(e.length===0)throw new Error("Missing arguments for unescape");if(e.length!==1)throw new Error("Too many arguments for unescape");let s;if(e[0]=e[0].compile().evaluate(n).toString(),this.client.getOption("allowEscape")){let l=this.client.getOption("allowEscape")?this.client.getOption("escapeChar"):"";return s=l,l==="\\"&&(s+=l),this.client.getOption("parseDoubleQuotes")&&(s+='"'),this.client.getOption("parseSingleQuotes")&&(s+="'"),this.client.getOption("commandStacking")&&(s+=this.client.getOption("commandStackingChar")),this.client.getOption("enableSpeedpaths")&&(s+=this.client.getOption("speedpathsChar")),this.client.getOption("enableCommands")&&(s+=this.client.getOption("commandChar")),this.client.getOption("enableVerbatim")&&(s+=this.client.getOption("verbatimChar")),this.client.getOption("enableDoubleParameterEscaping")&&(s+=this.client.getOption("parametersChar")),this.client.getOption("enableNParameters")&&(s+=this.client.getOption("nParametersChar")),l==="\\"?e[0].replace(new RegExp(`\\\\[${s}]`,"g"),r=>r.substr(1)):e[0].replace(new RegExp(`${l}[${s}]`,"g"),r=>r.substr(1))}return e[0].replace(/\\[\\"']/g,l=>l.substr(1))},prompt:(e,i,n)=>{if(e.length>3)throw new Error("Too many arguments");return e.length===0?window.prompt():(e=e.map(s=>s.compile().evaluate(n).toString()),window.prompt(...e))}};for(let e in t)!t.hasOwnProperty(e)||typeof t[e]!="function"||(t[e].rawArgs=!0);He.import(t,{})}resetExpressionEngine(){He&&(He=void 0)}async initPads(){if(!this.client||!this.client.options){setTimeout(this.initPads,5);return}if(this._controllers=[],this._controllersCount=0,this._gamepadCaches=null,!this.client.getOption("gamepads"))return;let t=navigator.getGamepads(),e=0,i=t.length;for(;e<i;e++)t[e]&&(this._controllers[t[e].index]={pad:t[e],axes:Te(t[e].axes),state:{axes:[],buttons:[]},pState:{axes:[],buttons:[]}},this._controllersCount++);this.updatePads()}updatePads(){if(this._controllersCount===0||!this.client.getOption("gamepads"))return;let t=navigator.getGamepads(),e=0,i=t.length;for(!this._gamepadCaches&&i>0&&(this._gamepadCaches=[]);e<i;e++){let n=t[e];if(!n||!this._controllers[n.index])continue;let s=this._controllers[n.index].state,l=this._controllers[n.index].axes,r=n.buttons.length,a,o;this._gamepadCaches[e]||(this._gamepadCaches[e]=Fe(this.client.macros,"gamepad",e+1)),o=this._gamepadCaches[e];let f=0,p=o.length;if(p===0)continue;for(a=0;a<r;a++){let S=n.buttons[a],v;if(typeof S=="object"?(v=S.pressed,S=S.value):v=S>=.5,s.buttons[a]){if(s.buttons[a].pressed!==v&&(s.buttons[a].pressed=v,!v)){for(;f<p;f++)if(o[f].enabled&&o[f].key===a+1&&this.ExecuteMacro(o[f])){(this._controllersCount>0||t.length>0)&&requestAnimationFrame(()=>{this.updatePads()});return}}}else s.buttons[a]={pct:Math.round(S*100),pressed:v}}let g=n.axes.length,c=0;for(a=0;a<g;a++)if(s.axes[a]!==n.axes[a]&&n.axes[a]!==l[a]&&(s.axes[a]=n.axes[a]),s.axes[a]<-.75?c=-(a+1):s.axes[a]>.75&&(c=a+1),c!==0){for(;f<p;f++)if(o[f].enabled&&o[f].gamepadAxes===a+1&&this.ExecuteMacro(o[f])){(this._controllersCount>0||t.length>0)&&requestAnimationFrame(()=>{this.updatePads()});return}}}(this._controllersCount>0||t.length>0)&&requestAnimationFrame(()=>{this.updatePads()})}adjustLastLine(t,e){return!this.client.display.lines||this.client.display.lines.length===0?0:(e?t===this.client.display.lines.length?(t--,this.client.display.lines[t].text.length===0&&this.client.display.lines[t].raw.length&&t--):t===this.client.display.lines.length-1&&this.client.display.lines[t].text.length===0&&this.client.display.lines[t].raw.length&&t--:t===this.client.display.lines.length?(t--,this.client.display.lines[t].text.length===0&&t--):t===this.client.display.lines.length-1&&this.client.display.lines[t].text.length===0&&t--,t)}get isLocked(){return this._locked!==0}addLock(){this._locked++}removeLock(){this._locked--}AddCommandToHistory(t){(this._commandHistory.length<1||this._commandHistory[this._commandHistory.length-1]!==t)&&t.length>0&&(this._commandHistory.length>=this.client.getOption("commandHistorySize")&&this._commandHistory.shift(),this._commandHistory.push(t),this.emit("command-history-changed",this._commandHistory))}clearCommandHistory(){this._commandHistory=[],this._historyIdx=-1,this.emit("command-history-changed",this._commandHistory)}setHistoryIndex(t){t<0||this._commandHistory.length===0?this._historyIdx=-1:t>=this._commandHistory.length?this._historyIdx=this._commandHistory.length-1:this._historyIdx=t}get commandHistory(){return this._commandHistory}executeScript(t){if(t==null)return t;let e=0,i=0,n,s=t.length,l="",r=[],a="",o,f=0,p=this.client.getOption("parseDoubleQuotes"),g=this.client.getOption("parseSingleQuotes"),c=this.client.getOption("commandChar");for(;i<s;i++)switch(n=t.charAt(i),e){case 1:n===" "?(e=2,o+=n):(l+=n,o+=n);break;case 2:n==="{"?(e=7,a+=n):n==="("?(e=8,a+=n):n===" "?(r.push(a),a=""):(n==='"'&&p?e=3:n==="'"&&g&&(e=4),a+=n),o+=n;break;case 3:n==='"'&&(e=2),a+=n,o+=n;break;case 4:n==="'"&&(e=2),a+=n,o+=n;break;case 7:a+=n,n==="}"?f===0?e=2:f--:n==="{"&&f++,o+=n;break;case 8:a+=n,n===")"?f===0?e=2:f--:n==="("&&f++,o+=n;break;default:if(i===0&&n===c)e=1,l="",r=[],a="",o=n;else return t;break}return l.length>0?(a.endsWith(`
`)&&(a=a.substring(0,a.length-1)),a.length>0&&r.push(a),this.executeFunction(l,r,o,c)):t}executeFunction(t,e,i,n){let s,l=!1,r,a,o,f,p=null,g=null,c,S,v,d,b,L,P;switch(t.toLowerCase()){case"unaction":case"untrigger":case"unt":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),p=null,g=null,v=!0,e.length<1||e.length>2)throw new Error("Invalid syntax use \x1B[4m"+n+"unt\x1B[0;-11;-12mrigger {pattern|name} \x1B[3mprofile\x1B[0;-11;-12m");if(e[0].length===0)throw new Error("Invalid name or pattern");if(e[0].match(/^\{.*\}$/g)?e[0]=this.parseInline(e[0].substr(1,e[0].length-2)):e[0]=this.parseInline(this.stripQuotes(e[0])),e.length===2&&(p=this.stripQuotes(e[2]),p=this.parseInline(p)),!p||p.length===0){let y=this.client.profiles.keys,m=0,x=y.length;if(x===0)return null;if(x===1){if(!this.client.profiles.items[y[0]].enabled||!this.client.profiles.items[y[0]].enableTriggers)throw Error("No enabled profiles found!");c=this.client.profiles.items[y[m]].findAny("triggers",{name:e[0],pattern:e[0]})}else for(;m<x;m++)if(!(!this.client.profiles.items[y[m]].enabled||!this.client.profiles.items[y[m]].enableTriggers||this.client.profiles.items[y[m]].triggers.length===0)&&(c=this.client.profiles.items[y[m]].findAny("triggers",{name:e[0],pattern:e[0]}),c)){p=this.client.profiles.items[y[m]];break}if(!c)throw new Error("Trigger '"+e[0]+"' not found in '"+p.name+"'!");this.client.removeTrigger(c),this.client.echo("Trigger '"+e[0]+"' removed from '"+p.name+"'.",-7,-8,!0,!0)}else if(p=this.parseInline(p),this.client.profiles.contains(p)){if(p=this.client.profiles.items[p.toLowerCase()],c=p.findAny("triggers",{name:e[0],pattern:e[0]}),!c)throw new Error("Trigger '"+e[0]+"' not found in '"+p.name+"'!");this.client.removeTrigger(c),this.client.echo("Trigger '"+e[0]+"' removed from '"+p.name+"'.",-7,-8,!0,!0)}else throw new Error("Profile not found: "+p);return null;case"suspend":case"sus":switch((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length){case 0:return f=this.client.alarms,f.length===0?this.client.echo("No alarms defined.",-7,-8,!0,!0):(this.client.setAlarmState(0,!1),this._lastSuspend=0,this.client.echo("Last alarm suspended.",-7,-8,!0,!0)),null;case 1:r=this.parseInline(this.stripQuotes(e[0])),f=this.client.alarms,a=f.length;for(let y=f.length-1;y>=0;y--)if(f[y].name===r||f[y].pattern===r){this.client.setAlarmState(y,!1),this.client.echo("Alarm '"+r+"' suspended.",-7,-8,!0,!0),this._lastSuspend=y;break}return null;default:throw new Error("Invalid syntax use \x1B[4m"+n+"sus\x1B[0;-11;-12mpend id \x1B[3mprofile\x1B[0;-11;-12m or \x1B[4m"+n+"sus\x1B[0;-11;-12mpend")}case"resume":case"resu":switch((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length){case 0:return this._lastSuspend===-1||(this.client.setAlarmState(this._lastSuspend,!0),this.client.echo("Last alarm suspended resumed.",-7,-8,!0,!0),this._lastSuspend=-1),null;case 1:r=this.parseInline(this.stripQuotes(e[0])),f=this.client.alarms,a=f.length;for(let y=a-1;y>=0;y--)if(f[y].name===r||f[y].pattern===r){this.client.setAlarmState(y,!0),this.client.echo("Alarm '"+r+"' resumed.",-7,-8,!0,!0);break}return null;default:throw new Error("Invalid syntax use \x1B[4m"+n+"resu\x1B[0;-11;-12mme id \x1B[3mprofile\x1B[0;-11;-12m or \x1B[4m"+n+"resu\x1B[0;-11;-12mme")}case"action":case"ac":case"trigger":case"tr":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),c={profile:null,name:null,pattern:null,commands:null,options:{priority:0}},e.length<2||e.length>5)throw new Error("Invalid syntax use \x1B[4m"+n+"tr\x1B[0;-11;-12migger name {pattern} {commands} \x1B[3moptions profile\x1B[0;-11;-12m or \x1B[4m"+n+"tr\x1B[0;-11;-12migger {pattern} {commands} \x1B[3m{options} profile\x1B[0;-11;-12m");if(e[0].length===0)throw new Error("Invalid trigger name or pattern");if(e[0].match(/^\{.*\}$/g))c.pattern=e.shift(),c.pattern=this.parseInline(c.pattern.substr(1,c.pattern.length-2));else{if(c.name=this.parseInline(this.stripQuotes(e.shift())),!c.name||c.name.length===0)throw new Error("Invalid trigger name");e[0].match(/^\{.*\}$/g)&&(c.pattern=e.shift(),c.pattern=this.parseInline(c.pattern.substr(1,c.pattern.length-2)))}if(e.length!==0){if(e[0].match(/^\{[\s\S]*\}$/g)&&(c.commands=e.shift(),c.commands=c.commands.substr(1,c.commands.length-2)),e.length===1)if(e[0].match(/^\{[\s\S]*\}$/g)?e[0]=e[0].substr(1,e[0].length-2):e[0]=this.stripQuotes(e[0]),e[0].length!==0)this.parseInline(e[0]).split(",").forEach(y=>{switch(y.trim()){case"nocr":case"prompt":case"case":case"verbatim":case"disable":case"enable":case"cmd":case"temporary":case"temp":case"raw":case"pattern":case"regular":case"alarm":case"event":case"cmdpattern":case"loopexpression":c.options[y.trim()]=!0;break;default:if(y.trim().startsWith("param=")){if(f=y.trim().split("="),f.length!==2)throw new Error(`Invalid trigger param option '${y.trim()}'`);c.options.params=f[1]}else if(y.trim().startsWith("type=")){if(f=y.trim().split("="),f.length!==2)throw new Error(`Invalid trigger type option '${y.trim()}'`);if(!this.isTriggerType(f[1],1))throw new Error("Invalid trigger type");c.options.type=f[1]}else if(y.trim().startsWith("pri=")||y.trim().startsWith("priority=")){if(f=y.trim().split("="),f.length!==2)throw new Error(`Invalid trigger priority option '${y.trim()}'`);if(o=parseInt(f[1],10),isNaN(o))throw new Error("Invalid trigger priority value '"+f[1]+"' must be a number");c.options.priority=o}else throw new Error(`Invalid trigger option '${y.trim()}'`)}});else throw new Error("Invalid trigger options");else if(e.length===2){if(e[0].match(/^\{[\s\S]*\}$/g)&&(e[0]=e[0].substr(1,e[0].length-2)),e[0].length!==0)this.parseInline(e[0]).split(",").forEach(y=>{switch(y.trim()){case"nocr":case"prompt":case"case":case"verbatim":case"disable":case"enable":case"cmd":case"temporary":case"temp":case"raw":case"pattern":case"regular":case"alarm":case"event":case"cmdpattern":case"loopexpression":c.options[y.trim()]=!0;break;default:if(y.trim().startsWith("param=")){if(f=y.trim().split("="),f.length!==2)throw new Error(`Invalid trigger param option '${y.trim()}'`);c.options.params=f[1]}else if(y.trim().startsWith("type=")){if(f=y.trim().split("="),f.length!==2)throw new Error(`Invalid trigger type option '${y.trim()}'`);if(!this.isTriggerType(f[1],1))throw new Error("Invalid trigger type");c.options.type=f[1]}else if(y.trim().startsWith("pri=")||y.trim().startsWith("priority=")){if(f=y.trim().split("="),f.length!==2)throw new Error(`Invalid trigger priority option '${y.trim()}'`);if(o=parseInt(f[1],10),isNaN(o))throw new Error("Invalid trigger priority value '"+f[1]+"' must be a number");c.options.priority=o}else throw new Error(`Invalid trigger option '${y.trim()}'`)}});else throw new Error("Invalid trigger options");c.profile=this.stripQuotes(e[1]),c.profile.length!==0&&(c.profile=this.parseInline(c.profile))}}return this.createTrigger(c.pattern,c.commands,c.profile,c.options,c.name),null;case"event":case"ev":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),p=null,v=!0,c={profile:null,name:null,pattern:null,commands:null,options:{priority:0}},e.length<2||e.length>4)throw new Error("Invalid syntax use \x1B[4m"+n+"ev\x1B[0;-11;-12ment name {commands} \x1B[3moptions profile\x1B[0;-11;-12m");if(e[0].length===0)throw new Error("Invalid event name");if(c.name=this.parseInline(this.stripQuotes(e.shift())),!c.name||c.name.length===0)throw new Error("Invalid event name");if(e.length===0)throw new Error("Missing commands or options");if(e[0].match(/^\{[\s\S]*\}$/g))c.commands=e.shift(),c.commands=c.commands.substr(1,c.commands.length-2);else throw new Error("Missing commands");if(e.length===1)if(e[0]=e[0].substr(1,e[0].length-2),e[0].length!==0)this.parseInline(e[0]).split(",").forEach(y=>{switch(y.trim()){case"nocr":case"prompt":case"case":case"verbatim":case"disable":case"temporary":case"temp":c.options[y.trim()]=!0;break;default:if(y.trim().startsWith("pri=")||y.trim().startsWith("priority=")){if(f=y.trim().split("="),f.length!==2)throw new Error(`Invalid event priority option '${y.trim()}'`);if(o=parseInt(f[1],10),isNaN(o))throw new Error("Invalid event priority value '"+f[1]+"' must be a number");c.options.priority=o}else throw new Error(`Invalid event option '${y.trim()}'`)}});else throw new Error("Invalid event options");else if(e.length===2){if(e[0].match(/^\{[\s\S]*\}$/g)&&(e[0]=e[0].substr(1,e[0].length-2)),e[0].length!==0)this.parseInline(e[0]).split(",").forEach(y=>{switch(y.trim()){case"nocr":case"prompt":case"case":case"verbatim":case"disable":case"temporary":case"temp":c.options[y.trim()]=!0;break;default:if(y.trim().startsWith("pri=")||y.trim().startsWith("priority=")){if(f=y.trim().split("="),f.length!==2)throw new Error(`Invalid event priority option '${y.trim()}'`);if(o=parseInt(f[1],10),isNaN(o))throw new Error("Invalid event priority value '"+f[1]+"' must be a number");c.options.priority=o}else throw new Error(`Invalid event option '${y.trim()}'`)}});else throw new Error("Invalid event options");c.profile=this.stripQuotes(e[1]),c.profile.length!==0&&(c.profile=this.parseInline(c.profile))}if(!c.profile||c.profile.length===0){let y=this.client.profiles.keys,m=0,x=y.length;if(x===0)return null;if(x===1){if(!this.client.profiles.items[y[0]].enabled||!this.client.profiles.items[y[0]].enableTriggers)throw Error("No enabled profiles found!");p=this.client.profiles.items[y[0]],f=U(this.client.profiles.items[y[m]].triggers.filter(W=>W.type===2)),d=f.find(W=>W.name===c.name||W.pattern===c.name)}else{for(;m<x;m++)if(!(!this.client.profiles.items[y[m]].enabled||!this.client.profiles.items[y[m]].enableTriggers||this.client.profiles.items[y[m]].triggers.length===0)&&(f=U(this.client.profiles.items[y[m]].triggers.filter(W=>W.type===2)),d=f.find(W=>W.name===c.name||W.pattern===c.name),d)){p=this.client.profiles.items[y[m]];break}p||(p=this.client.activeProfile)}}else{if(this.client.profiles.contains(c.profile))p=this.client.profiles.items[c.profile.toLowerCase()];else throw new Error("Profile not found: "+c.profile);d=f.find(y=>y.name===c.name||y.pattern===c.name)}return d?this.client.echo("Event '"+d.name+"' updated.",-7,-8,!0,!0):(d=new we,d.name=c.name,p.triggers.push(d),this.client.echo("Event '"+d.name+"' added.",-7,-8,!0,!0),c.new=!0),d.pattern=c.name,c.commands!==null&&(d.value=c.commands),d.type=2,c.options.prompt&&(d.triggerPrompt=!0),c.options.nocr&&(d.triggerNewline=!1),c.options.case&&(d.caseSensitive=!0),c.options.raw&&(d.raw=!0),c.options.verbatim&&(d.verbatim=!0),c.options.disable?d.enabled=!1:c.options.enable&&(d.enabled=!0),(c.options.temporary||c.options.temp)&&(d.temp=!0),d.priority=c.options.priority,this.client.saveProfiles(),v&&this.client.clearCache(),c.new?this.emit("item-added","trigger",p.name,d):this.emit("item-updated","trigger",p.name,p.triggers.indexOf(d),d),p=null,null;case"unevent":case"une":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length===0)throw new Error("Invalid syntax use \x1B[4m"+n+"une\x1B[0;-11;-12mvent name or \x1B[4m"+n+"une\x1B[0;-11;-12mvent {name} \x1B[3mprofile\x1B[0;-11;-12m");if(v=!0,p=null,e[0].match(/^\{.*\}$/g)||e[0].match(/^".*"$/g)||e[0].match(/^'.*'$/g)){if(e.length>2)throw new Error("Invalid syntax use \x1B[4m"+n+"une\x1B[0;-11;-12mvent name or \x1B[4m"+n+"une\x1B[0;-11;-12mvent {name} \x1B[3mprofile\x1B[0;-11;-12m");if(e.length===2)if(p=this.parseInline(this.stripQuotes(e[1])).toLowerCase(),this.client.profiles.contains(p))p=this.client.profiles.items[p];else throw new Error("Profile not found: "+p);else p=this.client.activeProfile;e[0].match(/^".*"$/g)||e[0].match(/^'.*'$/g)?s=this.parseInline(this.stripQuotes(e[0])):s=this.parseInline(e[0].substr(1,e[0].length-2))}else s=this.parseInline(e.join(" ")),p=this.client.activeProfile;return r=U(p.triggers.filter(y=>y.type===2)),s=this.stripQuotes(s),f=s,s=r.findIndex(y=>y.pattern===s||y.name===s),l=s!==-1,l?(this.client.echo("Event '"+(r[s].name||r[s].pattern)+"' removed.",-7,-8,!0,!0),v?this.client.removeTrigger(r[s]):(s=p.triggers.indexOf(r[s]),p.triggers.splice(s,1),this.client.saveProfiles(),this.emit("item-removed","trigger",p.name,s)),p=null):this.client.echo("Event '"+f+"' not found.",-7,-8,!0,!0),null;case"button":case"bu":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length===1){if(s=this.parseInline(this.stripQuotes(e[0])),r=document.getElementById("user-buttons").children,/^\s*?\d+\s*?$/.exec(s)){if(s=parseInt(s,10),s<0||s>=r.length)throw new Error("Button index must be >= 0 and < "+r.length);r[s].click()}else if(r[s])r[s].click();else throw new Error(`Button '${s}' not found`);return null}if(p=null,v=!0,c={profile:null,name:null,caption:null,commands:null,icon:null,options:{priority:0}},e.length<2||e.length>5)throw new Error("Invalid syntax use \x1B[4m"+n+"bu\x1B[0;-11;-12mtton name|index or \x1B[4m"+n+"bu\x1B[0;-11;-12mtton name \x1B[3mcaption\x1B[0;-11;-12m {commands} \x1B[3m{icon} options profile\x1B[0;-11;-12m or \x1B[4m"+n+"by\x1B[0;-11;-12mutton \x1B[3mcaption\x1B[0;-11;-12m {commands} \x1B[3m{icon} {options} profile\x1B[0;-11;-12m");if(e[0].length===0)throw new Error("Invalid button name, caption or commands");if(e[0].match(/^\{[\s\S]*\}$/g))c.commands=e.shift(),c.commands=c.commands.substr(1,c.commands.length-2);else{if(c.name=this.parseInline(this.stripQuotes(e.shift())),!c.name||c.name.length===0)throw new Error("Invalid button name or caption");if(e[0].match(/^\{[\s\S]*\}$/g))c.commands=e.shift(),c.commands=c.commands.substr(1,c.commands.length-2);else if(c.caption=this.stripQuotes(e.shift()),!e[0].match(/^\{[\s\S]*\}$/g))throw new Error("Missing commands")}if(e.length!==0){if(e[0].match(/^\{.*\}$/g)&&(c.icon=e.shift(),c.icon=c.icon.substr(1,c.icon.length-2)),e.length===1)if(e[0].match(/^\{[\s\S]*\}$/g)?e[0]=e[0].substr(1,e[0].length-2):e[0]=this.stripQuotes(e[0]),e[0].length!==0)this.parseInline(e[0]).split(",").forEach(y=>{switch(y.trim()){case"nosend":case"chain":case"append":case"stretch":case"disable":case"enable":c.options[y.trim()]=!0;break;default:if(y.trim().startsWith("pri=")||y.trim().startsWith("priority=")){if(f=y.trim().split("="),f.length!==2)throw new Error(`Invalid button priority option '${y.trim()}'`);if(o=parseInt(f[1],10),isNaN(o))throw new Error("Invalid button priority value '"+f[1]+"' must be a number");c.options.priority=o}else throw new Error(`Invalid button option '${y.trim()}'`)}});else throw new Error("Invalid button options");else if(e.length===2){if(e[0].match(/^\{[\s\S]*\}$/g)&&(e[0]=e[0].substr(1,e[0].length-2)),e[0].length!==0)this.parseInline(e[0]).split(",").forEach(y=>{switch(y.trim()){case"nosend":case"chain":case"append":case"stretch":case"disable":case"enable":c.options[y.trim()]=!0;break;default:if(y.trim().startsWith("pri=")||y.trim().startsWith("priority=")){if(f=y.trim().split("="),f.length!==2)throw new Error(`Invalid button priority option '${y.trim()}'`);if(o=parseInt(f[1],10),isNaN(o))throw new Error("Invalid button priority value '"+f[1]+"' must be a number");c.options.priority=o}else throw new Error(`Invalid button option '${y.trim()}'`)}});else throw new Error("Invalid button options");c.profile=this.stripQuotes(e[1]),c.profile.length!==0&&(c.profile=this.parseInline(c.profile))}}if(!c.profile||c.profile.length===0){let y=this.client.profiles.keys,m=0,x=y.length;if(x===0)return null;if(x===1){if(!this.client.profiles.items[y[0]].enabled||!this.client.profiles.items[y[0]].enableTriggers)throw Error("No enabled profiles found!");p=this.client.profiles.items[y[0]],c.name!==null?d=this.client.profiles.items[y[m]].find("buttons","name",c.name):d=this.client.profiles.items[y[m]].find("buttons","caption",c.caption)}else{for(;m<x;m++)if(!(!this.client.profiles.items[y[m]].enabled||!this.client.profiles.items[y[m]].enableTriggers||this.client.profiles.items[y[m]].triggers.length===0)&&(c.name!==null?d=this.client.profiles.items[y[m]].find("buttons","name",c.name):d=this.client.profiles.items[y[m]].find("buttons","caption",c.caption),d)){p=this.client.profiles.items[y[m]];break}p||(p=this.client.activeProfile)}}else{if(this.client.profiles.contains(c.profile))p=this.client.profiles.items[c.profile.toLowerCase()];else throw new Error("Profile not found: "+c.profile);c.name!==null?d=p.find("buttons","name",c.name):d=p.find("buttons","caption",c.caption)}return d?this.client.echo("Button '"+(d.name||d.caption||"")+"' updated.",-7,-8,!0,!0):(d=new re,d.name=c.name||"",d.caption=c.caption||"",p.buttons.push(d),!c.name&&!c.caption?this.client.echo("Button added.",-7,-8,!0,!0):this.client.echo("Button '"+(d.name||d.caption||"")+"' added.",-7,-8,!0,!0),c.new=!0),c.caption!==null&&(d.caption=c.caption),c.commands!==null&&(d.value=c.commands),c.options.icon&&(d.icon=c.options.icon),c.options.nosend&&(d.send=!1),c.options.chain&&(d.chain=!0),c.options.append&&(d.append=!0),c.options.stretch&&(d.stretch=!0),c.options.disable?d.enabled=!1:c.options.enable&&(d.enabled=!0),d.priority=c.options.priority,this.client.saveProfiles(),v&&this.client.clearCache(),c.new?this.emit("item-added","button",p.name,d):this.emit("item-updated","button",p.name,p.buttons.indexOf(d),d),p=null,null;case"unbutton":case"unb":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length===0)throw new Error("Invalid syntax use \x1B[4m"+n+"unb\x1B[0;-11;-12mtton name or \x1B[4m"+n+"unb\x1B[0;-11;-12mtton {name} \x1B[3mprofile\x1B[0;-11;-12m");if(v=!0,p=null,e[0].match(/^\{.*\}$/g)||e[0].match(/^".*"$/g)||e[0].match(/^'.*'$/g)){if(e.length>2)throw new Error("Invalid syntax use \x1B[4m"+n+"unb\x1B[0;-11;-12mtton name or \x1B[4m"+n+"unb\x1B[0;-11;-12mtton {name} \x1B[3mprofile\x1B[0;-11;-12m");if(e.length===2)if(p=this.parseInline(this.stripQuotes(e[1])),this.client.profiles.contains(p))p=this.client.profiles.items[p.toLowerCase()];else throw new Error("Profile not found: "+p);else p=this.client.activeProfile;e[0].match(/^".*"$/g)||e[0].match(/^'.*'$/g)?s=this.parseInline(this.stripQuotes(e[0])):s=this.parseInline(e[0].substr(1,e[0].length-2))}else s=this.parseInline(e.join(" ")),p=this.client.activeProfile;if(r=U(p.buttons),f=s,/^\s*?\d+\s*?$/.exec(s)){if(s=parseInt(s,10),s<0||s>=r.length)throw new Error("Button index must be >= 0 and < "+r.length);l=!0}else s=this.stripQuotes(s),s=r.findIndex(y=>y.name===s||y.caption===s),l=s!==-1;return l?(r[s].name.length===0&&r[s].caption.length===0?this.client.echo("Button '"+f+"' removed.",-7,-8,!0,!0):this.client.echo("Button '"+(r[s].name||r[s].caption)+"' removed.",-7,-8,!0,!0),s=p.buttons.indexOf(r[s]),p.buttons.splice(s,1),this.client.saveProfiles(),v&&this.client.clearCache(),this.emit("item-removed","button",p.name,s),p=null):this.client.echo("Button '"+f+"' not found.",-7,-8,!0,!0),null;case"alarm":case"ala":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),p=null,g=null,v=!0,s=!1,e.length<2||e.length>4)throw new Error("Invalid syntax use \x1B[4m"+n+"ala\x1B[0;-11;-12mrm name {timepattern} {commands} \x1B[3mprofile\x1B[0;-11;-12m, \x1B[4m"+n+"ala\x1B[0;-11;-12mrm name {timepattern} \x1B[3mprofile\x1B[0;-11;-12m, or \x1B[4m"+n+"ala\x1B[0;-11;-12mrm {timepattern} {commands} \x1B[3mprofile\x1B[0;-11;-12m");if(e[0].length===0)throw new Error("Invalid name or timepattern");if(e[0].match(/^\{.*\}$/g)){if(e.length>3)throw new Error("Invalid syntax use \x1B[4m"+n+"ala\x1B[0;-11;-12mrm {timepattern} {commands} profile");if(e[0]=e[0].substr(1,e[0].length-2),e[0]=this.parseInline(e[0]),e[1].match(/^\{[\s\S]*\}$/g)&&(e[1]=e[1].substr(1,e[1].length-2)),e.length===3&&(p=this.stripQuotes(e[2]),p=this.parseInline(p)),!p||p.length===0)p=this.client.activeProfile;else if(this.client.profiles.contains(p))p=this.client.profiles.items[p.toLowerCase()];else throw new Error("Profile not found: "+p);return d=new we,d.pattern=e[0],d.value=e[1],d.type=3,p.triggers.push(d),this.client.saveProfiles(),v&&(this._lastSuspend=-1,this.client.updateAlarms()),this.client.echo("Alarm '"+d.pattern+"' added.",-7,-8,!0,!0),this.emit("item-added","trigger",p.name,d),p=null,null}if(g=this.stripQuotes(e[0]),!g||g.length===0)throw new Error("Invalid alarm name");g=this.parseInline(g);let j=e[1],C=null;if(j.match(/^\{.*\}$/g)&&(j=j.substr(1,j.length-2)),j=this.parseInline(j),e.length===3?e[2].match(/^\{[\s\S]*\}$/g)?C=e[2].substr(1,e[2].length-2):p=this.stripQuotes(e[2]):e.length===4&&(C=e[2],p=this.stripQuotes(e[3]),C.match(/^\{[\s\S]*\}$/g)&&(C=C.substr(1,C.length-2))),!p||p.length===0){let y=this.client.profiles.keys,m=0,x=y.length;if(x===0)return null;if(x===1){if(!this.client.profiles.items[y[0]].enabled||!this.client.profiles.items[y[0]].enableTriggers)throw Error("No enabled profiles found!");if(p=this.client.profiles.items[y[0]],d=p.find("triggers","name",g),!d&&!C)throw new Error("Alarm not found!");d?this.client.echo("Alarm '"+d.name+"' updated.",-7,-8,!0,!0):(d=new we,d.name=g,p.triggers.push(d),this.client.echo("Alarm '"+d.name+"' added.",-7,-8,!0,!0),s=!0)}else{for(;m<x;m++)if(!(!this.client.profiles.items[y[m]].enabled||!this.client.profiles.items[y[m]].enableTriggers||this.client.profiles.items[y[m]].triggers.length===0)&&(d=this.client.profiles.items[y[m]].find("triggers","name",g),d)){p=this.client.profiles.items[y[m]];break}if(!p&&!C)throw new Error("Alarm not found!");p||(p=this.client.activeProfile),d?this.client.echo("Alarm '"+d.name+"' updated.",-7,-8,!0,!0):(d=new we,s=!0,d.name=g,p.triggers.push(d),this.client.echo("Alarm '"+d.name+"' added.",-7,-8,!0,!0))}}else{if(p=this.parseInline(p),this.client.profiles.contains(p))p=this.client.profiles.items[p.toLowerCase()];else throw new Error("Profile not found: "+p);if(d=p.find("triggers","name",g),!d&&!C)throw new Error("Alarm not found!");d?this.client.echo("Alarm '"+d.name+"' updated.",-7,-8,!0,!0):(d=new we,d.name=g,p.triggers.push(d),s=!0,this.client.echo("Alarm '"+d.name+"' added.",-7,-8,!0,!0))}return d.pattern=j,d.type=3,C&&(d.value=C),this.client.saveProfiles(),s?this.emit("item-added","trigger",p.name,d):this.emit("item-updated","trigger",p.name,p.triggers.indexOf(d),d),p=null,v&&(this._lastSuspend=-1,this.client.updateAlarms()),null;case"ungag":case"ung":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length>0)throw new Error("Invalid syntax use \x1B[4m"+n+"ung\x1B[0;-11;-12mag number or \x1B[4m"+n+"ung\x1B[0;-11;-12mag");return this._gagID.length&&(clearTimeout(this._gagID.pop()),this._gags.pop()),this._gag=0,null;case"gag":case"ga":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length===0)return this._gags.length&&this._gags[this._gags.length-1]==this.client.display.lines.length&&(this._gag=0,this._gags.pop()),this._gags.push(this.client.display.lines.length),this._gagID.push(setTimeout(()=>{if(s=this.adjustLastLine(this._gags.pop()),this._gags.length){let y=this._gags.length;for(;y>=0;)y--,this._gags[y]>s&&this._gags[y]--}this.client.display.removeLine(s)},0)),this._gag=0,null;if(e.length>1)throw new Error("Invalid syntax use \x1B[4m"+n+"ga\x1B[0;-11;-12mg number or \x1B[4m"+n+"ga\x1B[0;-11;-12mg");if(o=parseInt(e[0],10),isNaN(o))throw new Error("Invalid number '"+e[0]+"'");return this._gags.length&&this._gags[this._gags.length-1]==this.client.display.lines.length&&(this._gag=0,this._gags.pop()),this._gags.push(this.client.display.lines.length),o>=0?(this._gagID.push(setTimeout(()=>{if(s=this.adjustLastLine(this._gags.pop()),this._gags.length){let y=this._gags.length;for(;y>=0;)y--,this._gags[y]>s&&this._gags[y]--}this.client.display.removeLine(s),this._gag=o},0)),this._gag=0):(this._gagID.push(setTimeout(()=>{s=this.adjustLastLine(this._gags.pop()),o*=-1,o>this.client.display.lines.length&&(o=this.client.display.lines.length),this.client.display.removeLines(s-o,o),this._gag=0},0)),this._gag=0),null;case"wait":case"wa":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e=e.filter(y=>y),e.length===0||e.length>1)throw new Error("Invalid syntax use \x1B[4m"+n+"wa\x1B[0;-11;-12mit number");if(o=parseInt(this.parseInline(e[0]),10),isNaN(o))throw new Error("Invalid number '"+o+"' for wait");if(o<1)throw new Error("Must be greater then zero for wait");return o;case"showclient":case"showcl":return(this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),this.client.show(),null;case"hideclient":case"hidecl":return(this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),this.client.hide(),null;case"toggleclient":case"togglecl":return(this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),this.client.toggle(),null;case"raiseevent":case"raise":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),this.client.getOption("parseDoubleQuotes")&&e.forEach(y=>y.replace(/^\"(.*)\"$/g,(m,x,W)=>x.replace(/\\\"/g,'"'))),this.client.getOption("parseSingleQuotes")&&e.forEach(y=>y.replace(/^\'(.*)\'$/g,(m,x,W)=>x.replace(/\\\'/g,"'"))),e.length===0)throw new Error("Invalid syntax use "+n+"\x1B[4mraise\x1B[0;-11;-12mevent name or "+n+"\x1B[4mraise\x1B[0;-11;-12mevent name arguments");return e.length===1?this.client.raise(e[0]):this.client.raise(e[0],e.slice(1)),null;case"window":case"win":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),this.client.getOption("parseDoubleQuotes")&&e.forEach(y=>y.replace(/^\"(.*)\"$/g,(m,x,W)=>x.replace(/\\\"/g,'"'))),this.client.getOption("parseSingleQuotes")&&e.forEach(y=>y.replace(/^\'(.*)\'$/g,(m,x,W)=>x.replace(/\\\'/g,"'"))),e.length===0||e.length>3)throw new Error("Invalid syntax use "+n+"\x1B[4mwin\x1B[0;-11;-12mdow name \x1B[3mclose\x1B[0;-11;-12m or "+n+"\x1B[4mwin\x1B[0;-11;-12mdow new \x1B[3mcharacter\x1B[0;-11;-12m");return e.length===3?this.client.emit("window",this.stripQuotes(this.parseInline(e[0])),this.stripQuotes(this.parseInline(e[1])),this.stripQuotes(this.parseInline(e.slice(2).join(" ")))):e.length===1?this.client.emit("window",this.stripQuotes(this.parseInline(e[0]))):this.client.emit("window",this.stripQuotes(this.parseInline(e[0])),this.stripQuotes(this.parseInline(e.slice(1).join(" ")))),null;case"raisedelayed":case"raisede":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length<2)throw new Error("Invalid syntax use \x1B[4m"+n+"raisede\x1B[0;-11;-12mlayed milliseconds name or \x1B[4m"+n+"raisede\x1B[0;-11;-12mlayed milliseconds name arguments");if(o=parseInt(this.stripQuotes(this.parseInline(e[0])),10),isNaN(o))throw new Error("Invalid number '"+e[0]+"' for raisedelayed");if(o<1)throw new Error("Must be greater then zero for raisedelayed");return e.shift(),this.client.getOption("parseDoubleQuotes")&&e.forEach(y=>y.replace(/^\"(.*)\"$/g,(m,x,W)=>x.replace(/\\\"/g,'"'))),this.client.getOption("parseSingleQuotes")&&e.forEach(y=>y.replace(/^\'(.*)\'$/g,(m,x,W)=>x.replace(/\\\'/g,"'"))),e.length===1?this.client.raise(e[0],0,o):this.client.raise(e[0],e.slice(1),o),null;case"notify":case"not":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length===0)throw new Error("Invalid syntax use \x1B[4m"+n+"not\x1B[0;-11;-12mify title \x1B[3mmessage icon\x1B[0;-11;-12m");if(e[0]=this.stripQuotes(e[0]),e[e.length-1].match(/^\{.*\}$/g)&&(c=e.pop(),s={icon:this.parseInline(c.substr(1,c.length-2))}),e.length===0)throw new Error("Invalid syntax use \x1B[4m"+n+"not\x1B[0;-11;-12mify title \x1B[3mmessage icon\x1B[0;-11;-12m");return e.length===1?this.client.notify(this.parseInline(this.stripQuotes(e[0])),null,s):this.client.notify(this.parseInline(this.stripQuotes(e[0])),this.parseInline(e.slice(1).join(" ")),s),null;case"idle":case"idletime":return(this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),this.client.lastSendTime?this.client.echo("You have been idle: "+Ut(Date.now()-this.client.lastSendTime),-7,-8,!0,!0):this.client.echo("Not connected",-7,-8,!0,!0),null;case"connect":case"connecttime":return(this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),this.client.connectTime?this.client.echo("You have been connected: "+Ut(Date.now()-this.client.connectTime),-7,-8,!0,!0):!moment&&this.client.disconnectTime?this.client.echo("Disconnected since: "+new Date(this.client.disconnectTime).toLocaleString(),-7,-8,!0,!0):this.client.disconnectTime?this.client.echo("Disconnected since: "+new moment(this.client.disconnectTime).format("MM/DD/YYYY hh:mm:ss A"),-7,-8,!0,!0):this.client.echo("Not connected",-7,-8,!0,!0),null;case"beep":case"be":return(this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),this.client.beep(),null;case"version":case"ve":return(this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),this.client.echo(this.client.telnet.terminal+" v"+this.client.version,-7,-8,!0,!0),null;case"showprompt":case"showp":return(this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e=this.parseInline(e.join(" ")),this.client.telnet.receivedData(Oe(e),!0,!0),this.client.telnet.prompt=!0,null;case"show":case"sh":return(this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e=this.parseInline(e.join(" ")+`
`),this.client.telnet.receivedData(Oe(e),!0,!0),null;case"sayprompt":case"sayp":case"echoprompt":case"echop":return(this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e=this.parseInline(e.join(" ")),this.client.print("\x1B[-7;-8m"+e+"\x1B[0m",!1),null;case"say":case"sa":case"echo":case"ec":return(this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e=this.parseInline(e.join(" ")),this.client.telnet.prompt?this.client.print(`
\x1B[-7;-8m`+e+`\x1B[0m
`,!1):this.client.print("\x1B[-7;-8m"+e+`\x1B[0m
`,!1),this.client.telnet.prompt=!1,null;case"print":return(this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),o=this.client.enableTriggers,this.client.enableTriggers=!1,e=this.parseInline(e.join(" ")),this.client.telnet.prompt?this.client.print(`
\x1B[-7;-8m`+e+`\x1B[0m
`,!1):this.client.print("\x1B[-7;-8m"+e+`\x1B[0m
`,!1),this.client.telnet.prompt=!1,this.client.enableTriggers=o,null;case"printprompt":case"printp":return(this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),o=this.client.enableTriggers,this.client.enableTriggers=!1,e=this.parseInline(e.join(" ")),this.client.print("\x1B[-7;-8m"+e+"\x1B[0m",!1),this.client.enableTriggers=o,null;case"alias":case"al":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length===0)throw new Error("Invalid syntax use \x1B[4m"+n+"al\x1B[0;-11;-12mias name value or \x1B[4m"+n+"al\x1B[0;-11;-12mias name {value} \x1B[3mprofile\x1B[0;-11;-12m");if(e.length===1)throw new Error("Must supply an alias value");if(s=this.parseInline(this.stripQuotes(e.shift())),v=!0,p=null,e[0].match(/^\{.*\}$/g)||e[0].match(/^".*"$/g)||e[0].match(/^'.*'$/g)){if(e.length>2)throw new Error("Invalid syntax use \x1B[4m"+n+"al\x1B[0;-11;-12mias name value or \x1B[4m"+n+"al\x1B[0;-11;-12mias name {value} \x1B[3mprofile\x1B[0;-11;-12m");if(e.length===2)if(p=this.parseInline(this.stripQuotes(e[1])),this.client.profiles.contains(p))p=this.client.profiles.items[p.toLowerCase()];else throw new Error("Profile not found: "+p);else p=this.client.activeProfile;e[0].match(/^".*"$/g)||e[0].match(/^'.*'$/g)?e=this.parseInline(this.stripQuotes(e[0])):e=this.parseInline(e[0].substr(1,e[0].length-2))}else e=e.join(" "),p=this.client.activeProfile;if(r=p.aliases,e=this.stripQuotes(e),/^\s*?\d+\s*?$/.exec(s)){if(s=parseInt(s,10),s<0||s>=r.length)throw new Error("Alias index must be >= 0 and < "+r.length);r[s].value=e,this.client.echo("Alias '"+r[s].pattern+"' updated.",-7,-8,!0,!0)}else{for(o=0,a=r.length;o<a;o++)if(r[o].pattern===s){r[o].value=e,this.client.echo("Alias '"+s+"' updated.",-7,-8,!0,!0),this.emit("item-updated","alias",p.name,o,f),l=!0;break}l||(f=new ze(s,e),r.push(f),this.emit("item-added","alias",p.name,f),this.client.echo("Alias '"+s+"' added.",-7,-8,!0,!0))}return p.aliases=r,this.client.saveProfiles(),p=null,v&&this.client.clearCache(),null;case"unalias":case"una":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length===0)throw new Error("Invalid syntax use \x1B[4m"+n+"una\x1B[0;-11;-12mlias name or \x1B[4m"+n+"una\x1B[0;-11;-12mlias {name} \x1B[3mprofile\x1B[0;-11;-12m");if(v=!0,p=null,e[0].match(/^\{.*\}$/g)||e[0].match(/^".*"$/g)||e[0].match(/^'.*'$/g)){if(e.length>2)throw new Error("Invalid syntax use \x1B[4m"+n+"una\x1B[0;-11;-12mlias name or \x1B[4m"+n+"una\x1B[0;-11;-12mlias {name} \x1B[3mprofile\x1B[0;-11;-12m");if(e.length===2)if(p=this.stripQuotes(e[1]),p=this.parseInline(p),this.client.profiles.contains(p))p=this.client.profiles.items[p.toLowerCase()];else throw new Error("Profile not found: "+p);else p=this.client.activeProfile;e[0].match(/^".*"$/g)||e[0].match(/^'.*'$/g)?s=this.parseInline(this.stripQuotes(e[0])):s=this.parseInline(e[0].substr(1,e[0].length-2))}else s=this.parseInline(e.join(" ")),p=this.client.activeProfile;if(r=p.aliases,s=this.stripQuotes(s),/^\s*?\d+\s*?$/.exec(s)){if(f=s,s=parseInt(s,10),s<0||s>=r.length)throw new Error("Alias index must be >= 0 and < "+r.length);l=!0}else f=s,s=r.findIndex(y=>y.pattern===s),l=s!==-1;return l?(this.client.echo("Alias '"+r[s].pattern+"' removed.",-7,-8,!0,!0),r.splice(s,1),p.aliases=r,this.client.saveProfiles(),v&&this.client.clearCache(),p=null,this.emit("item-removed","alias",p.name,s)):this.client.echo("Alias '"+f+"' not found.",-7,-8,!0,!0),null;case"setsetting":case"sets":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length===0)throw new Error("Invalid syntax use \x1B[4m"+n+"sets\x1B[0;-11;-12metting name value");if(e.length===1)throw new Error("Must supply a setsetting value");if(s=this.stripQuotes(this.parseInline(e[0])),e=this.stripQuotes(this.parseInline(e.slice(1).join(" "))),/^\s*?\d+\s*?$/.exec(s)){if(f=s,s=parseInt(s,10),s<0||s>=H.length)throw new Error("Setting index must be >= 0 and < "+H.length);l=!0}else for(s=s.toLowerCase(),o=0,a=H.length;o<a;o++)if(H[o][0].toLowerCase()===s){s=o,l=!0;break}if(l)switch(H[s][2]){case 0:if(H[s][4]>0&&e.length>H[s][4])throw new Error("String can not be longer then "+H[s][4]+" characters");this.client.setOption(H[s][1]||H[s][0],e),this.client.echo("Setting '"+H[s][0]+"' set to '"+e+"'.",-7,-8,!0,!0),this.client.loadOptions();break;case 1:case 3:switch(e.toLowerCase()){case"true":case"1":case"yes":this.client.setOption(H[s][1]||H[s][0],!0),this.client.echo("Setting '"+H[s][0]+"' set to true.",-7,-8,!0,!0),this.client.loadOptions();break;case"no":case"false":case"0":this.client.setOption(H[s][1]||H[s][0],!1),this.client.echo("Setting '"+H[s][0]+"' set to false.",-7,-8,!0,!0),this.client.loadOptions();break;case"toggle":e=!this.client.getOption(H[s][1]||H[s][0]),this.client.setOption(H[s][1]||H[s][0],e),this.client.echo("Setting '"+H[s][0]+"' set to "+e+".",-7,-8,!0,!0),this.client.loadOptions();break;default:throw new Error("Invalid value, must be true or false")}break;case 2:if(o=parseInt(e,10),isNaN(o))throw new Error("Invalid number '"+e+"'");this.client.setOption(H[s][1]||H[s][0],o),this.client.echo("Setting '"+H[s][0]+"' set to '"+o+"'.",-7,-8,!0,!0),this.client.loadOptions();break;case 4:case 5:throw new Error("Unsupported setting '"+s+"'")}else throw new Error("Unknown setting '"+f+"'");return null;case"getsetting":case"gets":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length===0)throw new Error("Invalid syntax use \x1B[4m"+n+"gets\x1B[0;-11;-12metting name");if(s=this.stripQuotes(this.parseInline(e.join(" "))),/^\s*?\d+\s*?$/.exec(s)){if(s=parseInt(s,10),s<0||s>=H.length)throw new Error("Setting index must be >= 0 and < "+H.length);l=!0}else{if(f=s,s=s.toLowerCase(),s!=="all"){for(o=0,a=H.length;o<a;o++)if(H[o][0].toLowerCase()===s){s=o,l=!0;break}}if(s==="all"){for(f=`Current settings:
`,o=0,a=H.length;o<a;o++)switch(H[o][2]){case 0:case 2:f+="    "+H[o][0]+": "+this.client.getOption(H[s][1]||H[s][0])+`
`;break;case 1:case 3:this.client.getOption(H[s][1]||H[s][0])?f+="    "+H[o][0]+`: true
`:f+="    "+H[o][0]+`: false
`;break}this.client.echo(f,-7,-8,!0,!0)}else if(l)switch(H[s][2]){case 0:case 2:this.client.echo("Setting '"+H[s][0]+"' is '"+this.client.getOption(H[s][1]||H[s][0])+"'",-7,-8,!0,!0);break;case 1:case 3:this.client.getOption(H[s][1]||H[s][0])?this.client.echo("Setting '"+H[s][0]+"' is true",-7,-8,!0,!0):this.client.echo("Setting '"+H[s][0]+"' is false",-7,-8,!0,!0);break}else throw new Error("Unknown setting '"+s+"'")}return null;case"profilelist":(this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),this.client.echo("\x1B[4mProfiles:\x1B[0m",-7,-8,!0,!0);let E=this.client.profiles.keys;for(a=E.length,o=0;o<a;o++)this.client.profiles.items[E[o]]&&this.client.profiles.items[E[o]].enabled?this.client.echo("   "+this.client.profiles.keys[o]+" is enabled",-7,-8,!0,!0):this.client.echo("   "+E[o]+" is disabled",-7,-8,!0,!0);return null;case"profile":case"pro":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length===0)throw new Error("Invalid syntax use \x1B[4m"+n+"pro\x1B[0;-11;-12mfile name or \x1B[4m"+n+"pro\x1B[0;-11;-12mfile name enable/disable");if(e.length===1){if(e[0]=this.parseInline(e[0]),this.client.toggleProfile(e[0]),this.client.profiles.contains(e[0])){if(this.client.profiles.length===1)throw new Error(e[0]+" can not be disabled as it is the only one enabled")}else throw new Error("Profile not found");this.client.profiles.contains(e[0].toLowerCase())?this.client.profiles.items[e[0].toLowerCase()].enabled?e=e[0]+" is enabled":e=e[0]+" is disabled":e="Profile not found"}else{if(e[0]=this.parseInline(e[0]).toLowerCase(),!this.client.profiles.contains(e[0]))throw new Error("Profile not found");if(!e[1])throw new Error("Invalid syntax use \x1B[4m"+n+"pro\x1B[0;-11;-12mfile name or \x1B[4m"+n+"pro\x1B[0;-11;-12mfile name enable/disable");switch(e[1]=this.parseInline(e[1]),e[1].toLowerCase()){case"enable":case"on":case"yes":this.client.profiles.items[e[0].toLowerCase()].enabled?e=e[0]+" is already enabled":(this.client.toggleProfile(e[0]),this.client.profiles.items[e[0].toLowerCase()].enabled!==-1?e=e[0]+" is enabled":e=e[0]+" remains disabled");break;case"disable":case"off":case"no":if(!this.client.profiles.items[e[0].toLowerCase()].enabled)e=e[0]+" is already disabled";else{if(this.client.profiles.length===1)throw new Error(e[0]+" can not be disabled as it is the only one enabled");this.client.toggleProfile(e[0]),e=e[0]+" is disabled"}break;default:throw new Error("Invalid syntax use \x1B[4m"+n+"pro\x1B[0;-11;-12mfile name or \x1B[4m"+n+"pro\x1B[0;-11;-12mfile name enable/disable")}}return this.client.telnet.prompt?this.client.print(`
\x1B[-7;-8m`+e+`\x1B[0m
`,!1):this.client.print("\x1B[-7;-8m"+e+`\x1B[0m
`,!1),this.client.telnet.prompt=!1,null;case"color":case"co":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length>1&&e.length<4)return c={profile:null,pattern:null,commands:null},c.pattern=e.shift(),c.pattern.match(/^\{.*\}$/g)?c.pattern=this.parseInline(c.pattern.substr(1,c.pattern.length-2)):c.pattern=this.parseInline(this.stripQuotes(c.pattern)),e.length===2?(c.commands=n+"COLOR "+this.parseInline(e[0]),c.profile=this.stripQuotes(e[1]),c.profile.length!==0&&(c.profile=this.parseInline(c.profile))):c.commands=n+"COLOR "+this.parseInline(e[0]),this.createTrigger(c.pattern,c.commands,c.profile),null;if(e.length!==1)throw new Error("Invalid syntax use \x1B[4m"+n+"co\x1B[0;-11;-12mlor color or \x1B[4m"+n+"co\x1B[0;-11;-12mlor {pattern} color \x1B[3mprofile\x1B[0;-11;-12m");if(e.length!==1)throw new Error("Invalid syntax use \x1B[4m"+n+"co\x1B[0;-11;-12mlor color or \x1B[4m"+n+"co\x1B[0;-11;-12mlor {pattern} color \x1B[3mprofile\x1B[0;-11;-12m");if(e[0]=this.parseInline(this.stripQuotes(e[0])),s=this.client.display.lines.length,e[0].trim().match(/^[-|+]?\d+$/g))setTimeout(()=>{s=this.adjustLastLine(s),this.client.display.colorSubStrByLine(s,parseInt(e[0],10))},0);else if(e[0].trim().match(/^[-|+]?\d+\s*?,\s*?[-|+]?\d+$/g))e[0]=e[0].split(","),setTimeout(()=>{s=this.adjustLastLine(s),this.client.display.colorSubStrByLine(s,parseInt(e[0][0],10),parseInt(e[0][1],10))},0);else if(e=e[0].toLowerCase().split(","),e.length===1){if(e[0]==="bold"&&(o=370),e[0].trim().match(/^#(?:[a-f0-9]{3}|[a-f0-9]{6})\b$/g))o=e[0].trim();else if(e[0].trim().match(/^[-|+]?\d+$/g))o=parseInt(e[0].trim(),10);else if(o=ee(e[0]),o===-1)if(fe(e[0]))o=e[0];else throw new Error("Invalid fore color");setTimeout(()=>{s=this.adjustLastLine(s),this.client.display.colorSubStrByLine(s,o)},0)}else if(e.length===2){if(e[0]==="bold"&&e[1]==="bold")throw new Error("Invalid fore color");if(e[0]==="bold")o=370;else if(e[0]==="current")o=null;else if(e[0].trim().match(/^#(?:[a-f0-9]{3}|[a-f0-9]{6})\b$/g))o=e[0].trim();else if(e[0].trim().match(/^[-|+]?\d+$/g))o=parseInt(e[0].trim(),10);else if(o=ee(e[0]),o===-1)if(fe(e[0]))o=e[0];else throw new Error("Invalid fore color");if(e[1]==="bold")setTimeout(()=>{s=this.adjustLastLine(s),o===370?this.client.display.colorSubStrByLine(s,o):this.client.display.colorSubStrByLine(s,o*10)},0);else{if(S=o,e[1].trim().match(/^#(?:[a-f0-9]{3}|[a-f0-9]{6})\b$/g))o=e[1].trim();else if(e[1].trim().match(/^[-|+]?\d+$/g))o=parseInt(e[1].trim(),10);else if(o=ee(e[1],!0),o===-1)if(fe(e[1]))o=e[1];else throw new Error("Invalid back color");setTimeout(()=>{s=this.adjustLastLine(s),this.client.display.colorSubStrByLine(s,S,o)},0)}}else if(e.length===3){if(e[0]==="bold"&&(e.shift(),e.push("bold")),e[0].trim()==="current")o=null;else if(e[0].trim().match(/^#(?:[a-f0-9]{3}|[a-f0-9]{6})\b$/g))o=e[0].trim();else if(e[0].trim().match(/^[-|+]?\d+$/g))o=parseInt(e[0].trim(),10);else if(o=ee(e[0]),o===-1)if(fe(e[0]))o=e[0];else throw new Error("Invalid fore color");if(e[2]!=="bold")throw new Error("Only bold is supported as third argument");if(o?S=o*10:o=370,e[1].trim().match(/^#(?:[a-f0-9]{3}|[a-f0-9]{6})\b$/g))o=e[1].trim();else if(e[1].trim().match(/^[-|+]?\d+$/g))o=parseInt(e[1].trim(),10);else if(o=ee(e[1],!0),o===-1)if(fe(e[1]))o=e[0];else throw new Error("Invalid back color");setTimeout(()=>{s=this.adjustLastLine(s),this.client.display.colorSubStrByLine(s,S,o)},0)}return null;case"cw":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),d=this.stack.regex,e.length>1&&e.length<4)return c={profile:null,pattern:null,commands:null},c.pattern=e.shift(),c.pattern.match(/^\{.*\}$/g)?c.pattern=this.parseInline(c.pattern.substr(1,c.pattern.length-2)):c.pattern=this.parseInline(this.stripQuotes(c.pattern)),e.length===2?(c.commands=n+"CW "+this.parseInline(e[0]),c.profile=this.stripQuotes(e[1]),c.profile.length!==0&&(c.profile=this.parseInline(c.profile))):c.commands=n+"CW "+this.parseInline(e[0]),this.createTrigger(c.pattern,c.commands,c.profile),null;if(e.length!==1)throw new Error("Invalid syntax use "+n+"cw color or "+n+"cw {pattern} color \x1B[3mprofile\x1B[0;-11;-12m");if(!d)return null;if(e[0]=this.parseInline(this.stripQuotes(e[0])),s=this.client.display.lines.length,e[0].trim().match(/^[-|+]?\d+$/g))setTimeout(()=>{if(s=this.adjustLastLine(s),d.length===1)this.client.display.colorSubStrByLine(s,parseInt(e[0],10));else{d[1].lastIndex=0,f=d[0].matchAll(d[1]);for(let y of f)this.client.display.colorSubStrByLine(s,parseInt(e[0],10),null,y.index,y[0].length)}},0);else if(e[0].trim().match(/^[-|+]?\d+,[-|+]?\d+$/g))e[0]=e[0].split(","),setTimeout(()=>{if(s=this.adjustLastLine(s),d.length===1)this.client.display.colorSubStrByLine(s,parseInt(e[0][0],10),parseInt(e[0][1],10));else{d[1].lastIndex=0,f=d[0].matchAll(d[1]);for(let y of f)this.client.display.colorSubStrByLine(s,parseInt(e[0],10),parseInt(e[0][1],10),y.index,y[0].length)}},0);else if(e=e[0].toLowerCase().split(","),e.length===1){if(e[0]==="bold"&&(o=370),e[0].trim().match(/^#(?:[a-f0-9]{3}|[a-f0-9]{6})\b$/g))o=e[0].trim();else if(e[0].trim().match(/^[-|+]?\d+$/g))o=parseInt(e[0].trim(),10);else if(o=ee(e[0]),o===-1)if(fe(e[0]))o=e[0];else throw new Error("Invalid fore color");setTimeout(()=>{if(s=this.adjustLastLine(s),d.length===1)this.client.display.colorSubStrByLine(s,o);else{d[1].lastIndex=0,f=d[0].matchAll(d[1]);for(let y of f)this.client.display.colorSubStrByLine(s,o,null,y.index,y[0].length)}},0)}else if(e.length===2){if(e[0]==="bold"&&e[1]==="bold")throw new Error("Invalid fore color");if(e[0]==="bold")o=370;else if(e[0]==="current")o=null;else if(e[0].trim().match(/^#(?:[a-f0-9]{3}|[a-f0-9]{6})\b$/g))o=e[0].trim();else if(e[0].trim().match(/^[-|+]?\d+$/g))o=parseInt(e[0].trim(),10);else if(o=ee(e[0]),o===-1)if(fe(e[0]))o=e[0];else throw new Error("Invalid fore color");if(e[1]==="bold")setTimeout(()=>{if(s=this.adjustLastLine(s),o!==370&&(o*=10),d.length===1)this.client.display.colorSubStrByLine(s,o);else{d[1].lastIndex=0,f=d[0].matchAll(d[1]);for(let y of f)this.client.display.colorSubStrByLine(s,o,null,y.index,y[0].length)}},0);else{if(S=o,e[1].trim().match(/^#(?:[a-f0-9]{3}|[a-f0-9]{6})\b$/g))o=e[1].trim();else if(e[1].trim().match(/^[-|+]?\d+$/g))o=parseInt(e[1].trim(),10);else if(o=ee(e[1],!0),o===-1)if(fe(e[1]))o=e[1];else throw new Error("Invalid back color");setTimeout(()=>{if(s=this.adjustLastLine(s),d.length===1)this.client.display.colorSubStrByLine(s,S,o);else{d[1].lastIndex=0,f=d[0].matchAll(d[1]);for(let y of f)this.client.display.colorSubStrByLine(s,S,o,y.index,y[0].length)}},0)}}else if(e.length===3){if(e[0]==="bold"&&(e.shift(),e.push("bold")),e[0].trim()==="current")o=null;else if(e[0].trim().match(/^#(?:[a-f0-9]{3}|[a-f0-9]{6})\b$/g))o=e[0].trim();else if(e[0].trim().match(/^[-|+]?\d+$/g))o=parseInt(e[0].trim(),10);else if(o=ee(e[0]),o===-1)if(fe(e[0]))o=e[0];else throw new Error("Invalid fore color");if(e[2]!=="bold")throw new Error("Only bold is supported as third argument");if(o?S=o*10:o=370,e[1].trim().match(/^#(?:[a-f0-9]{3}|[a-f0-9]{6})\b$/g))o=e[1].trim();else if(e[1].trim().match(/^[-|+]?\d+$/g))o=parseInt(e[1].trim(),10);else if(o=ee(e[1],!0),o===-1)if(fe(e[1]))o=e[0];else throw new Error("Invalid back color");setTimeout(()=>{if(s=this.adjustLastLine(s),d.length===1)this.client.display.colorSubStrByLine(s,S,o);else{d[1].lastIndex=0,f=d[0].matchAll(d[1]);for(let y of f)this.client.display.colorSubStrByLine(s,S,o,y.index,y[0].length)}},0)}return null;case"pcol":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length<1||e.length>5)throw new Error("Invalid syntax use "+n+"pcol color \x1B[3mXStart, XEnd, YStart, YEnd\x1B[0;-11;-12m");if(e.length>1){if(f=[].concat(...e.slice(1).map(y=>this.parseInline(this.stripQuotes(y)).split(" "))),f.length>4)throw new Error("Too many arguments use "+n+"pcol color \x1B[3mXStart, XEnd, YStart, YEnd\x1B[0;-11;-12m");if(c={xStart:0},f.length>0&&(c.xStart=parseInt(f[0],10)),f.length>1&&(c.xEnd=parseInt(f[1],10)),f.length>2&&(c.yStart=parseInt(f[2],10)),f.length>3&&(c.yEnd=parseInt(f[3],10)),c.hasOwnProperty("yEnd")&&c.yEnd>c.yStart)throw new Error("yEnd must be smaller or equal to yStart");if(c.hasOwnProperty("xEnd")&&c.xEnd<c.xStart)throw new Error("xEnd must be larger or equal to xStart")}else c={xStart:0};if(e[0]=this.parseInline(this.stripQuotes(e[0])),s=this.adjustLastLine(this.client.display.lines.length),e[0].trim().match(/^[-|+]?\d+$/g))setTimeout(()=>{this.colorPosition(s,parseInt(e[0],10),null,c)},0);else if(e[0].trim().match(/^[-|+]?\d+\s*?,\s*?[-|+]?\d+$/g))e[0]=e[0].split(","),setTimeout(()=>{this.colorPosition(s,parseInt(e[0][0],10),parseInt(e[0][1],10),c)},0);else if(e=e[0].toLowerCase().split(","),e.length===1){if(e[0]==="bold"&&(o=370),e[0].trim().match(/^#(?:[a-f0-9]{3}|[a-f0-9]{6})\b$/g))o=e[0].trim();else if(e[0].trim().match(/^[-|+]?\d+$/g))o=parseInt(e[0].trim(),10);else if(o=ee(e[0]),o===-1)if(fe(e[0]))o=e[0];else throw new Error("Invalid fore color");setTimeout(()=>{this.colorPosition(s,o,null,c)},0)}else if(e.length===2){if(e[0]==="bold"&&e[1]==="bold")throw new Error("Invalid fore color");if(e[0]==="bold")o=370;else if(e[0]==="current")o=null;else if(e[0].trim().match(/^#(?:[a-f0-9]{3}|[a-f0-9]{6})\b$/g))o=e[0].trim();else if(e[0].trim().match(/^[-|+]?\d+$/g))o=parseInt(e[0].trim(),10);else if(o=ee(e[0]),o===-1)if(fe(e[0]))o=e[0];else throw new Error("Invalid fore color");if(e[1]==="bold")setTimeout(()=>{this.colorPosition(s,o===370?o:o*10,null,c)},0);else{if(S=o,e[1].trim().match(/^#(?:[a-f0-9]{3}|[a-f0-9]{6})\b$/g))o=e[1].trim();else if(e[1].trim().match(/^[-|+]?\d+$/g))o=parseInt(e[1].trim(),10);else if(o=ee(e[1],!0),o===-1)if(fe(e[1]))o=e[1];else throw new Error("Invalid back color");setTimeout(()=>{this.colorPosition(s,S,o,c)},0)}}else if(e.length===3){if(e[0]==="bold"&&(e.shift(),e.push("bold")),e[0].trim()==="current")o=null;else if(e[0].trim().match(/^#(?:[a-f0-9]{3}|[a-f0-9]{6})\b$/g))o=e[0].trim();else if(e[0].trim().match(/^[-|+]?\d+$/g))o=parseInt(e[0].trim(),10);else if(o=ee(e[0]),o===-1)if(fe(e[0]))o=e[0];else throw new Error("Invalid fore color");if(e[2]!=="bold")throw new Error("Only bold is supported as third argument");if(o?S=o*10:o=370,e[1].trim().match(/^#(?:[a-f0-9]{3}|[a-f0-9]{6})\b$/g))o=e[1].trim();else if(e[1].trim().match(/^[-|+]?\d+$/g))o=parseInt(e[1].trim(),10);else if(o=ee(e[1],!0),o===-1)if(fe(e[1]))o=e[0];else throw new Error("Invalid back color");setTimeout(()=>{this.colorPosition(s,S,o,c)},0)}return null;case"highlight":case"hi":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length>0&&e.length<2)return c={profile:null,pattern:null,commands:n+"HIGHLIGHT"},c.pattern=e.shift(),c.pattern.match(/^\{.*\}$/g)?c.pattern=this.parseInline(c.pattern.substr(1,c.pattern.length-2)):c.pattern=this.parseInline(this.stripQuotes(c.pattern)),e.length===1&&(c.profile=this.parseInline(this.stripQuotes(e[0]))),this.createTrigger(c.pattern,c.commands,c.profile),null;if(e.length)throw new Error("Too many arguments use \x1B[4m"+n+"hi\x1B[0;-11;-12mghlight \x1B[3mpattern profile\x1B[0;-11;-12m");return s=this.client.display.lines.length,setTimeout(()=>{s=this.adjustLastLine(s),this.client.display.highlightSubStrByLine(s)},0),null;case"break":case"br":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length)throw new Error("Invalid syntax use \x1B[4m"+n+"br\x1B[0;-11;-12meak\x1B[0;-11;-12m");if(!this.loops.length)throw new Error("\x1B[4m"+n+"br\x1B[0;-11;-12meak\x1B[0;-11;-12m must be used in a loop.");return this.stack.break?this.stack.break++:this.stack.break=1,-1;case"continue":case"cont":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length)throw new Error("Invalid syntax use \x1B[4m"+n+"cont\x1B[0;-11;-12minue\x1B[0;-11;-12m");if(!this.loops.length)throw new Error("\x1B[4m"+n+"cont\x1B[0;-11;-12minue\x1B[0;-11;-12m must be used in a loop.");return this.stack.continue=!0,-2;case"if":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),!e.length||e.length>3)throw new Error("Invalid syntax use "+n+"if {expression} {true-command} \x1B[3m{false-command}\x1B[0;-11;-12m");return e[0].match(/^\{[\s\S]*\}$/g)&&(e[0]=e[0].substr(1,e[0].length-2)),f=null,this.evaluate(this.parseInline(e[0]))?(e[1].match(/^\{[\s\S]*\}$/g)&&(e[1]=e[1].substr(1,e[1].length-2)),f=this.parseOutgoing(e[1])):e.length>2&&(e[2].match(/^\{[\s\S]*\}$/g)&&(e[2]=e[2].substr(1,e[2].length-2)),f=this.parseOutgoing(e[2])),f!=null&&f.length>0?f:null;case"case":case"ca":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),!e.length||e.length<2)throw new Error("Invalid syntax use \x1B[4m"+n+"ca\x1B[0;-11;-12mse\x1B[0;-11;-12m index {command 1} \x1B[3m{command n}\x1B[0;-11;-12m");return e[0].match(/^\{[\s\S]*\}$/g)&&(e[0]=e[0].substr(1,e[0].length-2)),s=this.evaluate(this.parseInline(e[0])),typeof s!="number"?null:s>0&&s<e.length&&(e[s].match(/^\{[\s\S]*\}$/g)&&(e[s]=e[s].substr(1,e[s].length-2)),f=this.parseOutgoing(e[s]),f!=null&&f.length>0)?f:null;case"switch":case"sw":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),!e.length||e.length<2)throw new Error("Invalid syntax use \x1B[4m"+n+"sw\x1B[0;-11;-12mitch\x1B[0;-11;-12m (expression) {command} \x1B[3m(expression) {command} ... {else_command}\x1B[0;-11;-12m");for(e.length%2===1?s=e.pop():s=null,a=e.length,o=0;o<a;o+=2)if(e[o].match(/^\{[\s\S]*\}$/g)&&(e[o]=e[o].substr(1,e[o].length-2)),this.evaluate(this.parseInline(e[o])))return e[o+1].match(/^\{[\s\S]*\}$/g)&&(e[o+1]=e[o+1].substr(1,e[o+1].length-2)),f=this.parseOutgoing(e[o+1]),f!=null&&f.length>0?f:null;return s&&(s.match(/^\{[\s\S]*\}$/g)&&(s=s.substr(1,s.length-2)),f=this.parseOutgoing(s),f!=null&&f.length>0)?f:null;case"loop":case"loo":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length<2)throw new Error("Invalid syntax use \x1B[4m"+n+"loo\x1B[0;-11;-12mp\x1B[0;-11;-12m range {commands}");if(s=this.parseInline(e.shift()).split(","),e=e.join(" "),e.match(/^\{[\s\S]*\}$/g)&&(e=e.substr(1,e.length-2)),s.length===1){if(f=parseInt(s[0],10),isNaN(f))throw new Error("Invalid loop range '"+s[0]+"' must be a number");return this.executeForLoop(0,f,e)}if(f=parseInt(s[0],10),isNaN(f))throw new Error("Invalid loop min '"+s[0]+"' must be a number");if(o=parseInt(s[1],10),isNaN(o))throw new Error("Invalid loop max '"+s[1]+"' must be a number");return f>o?f++:f--,this.executeForLoop(f,o,e);case"repeat":case"rep":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length<2)throw new Error("Invalid syntax use \x1B[4m"+n+"rep\x1B[0;-11;-12meat\x1B[0;-11;-12m expression {commands}");if(o=e.shift(),o.match(/^\{[\s\S]*\}$/g)&&(o=o.substr(1,o.length-2)),o=this.evaluate(this.parseInline(o)),typeof o!="number")throw new Error("Arguments must be a number");return e=e.join(" "),e.match(/^\{[\s\S]*\}$/g)&&(e=e.substr(1,e.length-2)),o<1?this.executeForLoop(-o+1,1,e):this.executeForLoop(0,o,e);case"until":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length<2)throw new Error("Invalid syntax use "+n+"until expression {commands}");for(o=e.shift(),o.match(/^\{[\s\S]*\}$/g)&&(o=o.substr(1,o.length-2)),e=e.join(" "),e.match(/^\{[\s\S]*\}$/g)&&(e=e.substr(1,e.length-2)),f=[],this.loops.push(0);!this.evaluate(this.parseInline(o));){let y=this.parseOutgoing(e);if(y!=null&&y.length>0&&f.push(y),this.stack.continue){this.stack.continue=!1;continue}if(this.stack.break){this.stack.break--;break}}return this.loops.pop(),f.length>0?f.map(y=>y.trim()).join(`
`):null;case"while":case"wh":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length<2)throw new Error("Invalid syntax use \x1B[4m"+n+"wh\x1B[0;-11;-12mile expression {commands}");for(o=e.shift(),o.match(/^\{[\s\S]*\}$/g)&&(o=o.substr(1,o.length-2)),e=e.join(" "),e.match(/^\{[\s\S]*\}$/g)&&(e=e.substr(1,e.length-2)),f=[],this.loops.push(0);this.evaluate(this.parseInline(o));){let y=this.parseOutgoing(e);if(y!=null&&y.length>0&&f.push(y),this.stack.continue){this.stack.continue=!1;continue}if(this.stack.break){this.stack.break--;break}}return this.loops.pop(),f.length>0?f.map(y=>y.trim()).join(`
`):null;case"forall":case"fo":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length<2)throw new Error("Invalid syntax use \x1B[4m"+n+"fo\x1B[0;-11;-12mrall stringlist {commands}");for(o=e.shift(),o.match(/^\{[\s\S]*\}$/g)&&(o=o.substr(1,o.length-2)),e=e.join(" "),e.match(/^\{[\s\S]*\}$/g)&&(e=e.substr(1,e.length-2)),f=[],o=this.splitByQuotes(this.stripQuotes(this.parseInline(o)),"|"),a=o.length,s=0;s<a;s++){this.loops.push(o[s]);let y=this.parseOutgoing(e);if(y!=null&&y.length>0&&f.push(y),this.stack.continue){this.stack.continue=!1;continue}if(this.stack.break){this.stack.break--;break}this.loops.pop()}return f.length>0?f.map(y=>y.trim()).join(`
`):null;case"variable":case"var":case"va":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length===0){for(o=Object.keys(this.client.variables),a=o.length,f=[],s=0;s<a;s++)f.push(o[s]+" = "+this.client.variables[o[s]]);return f.join(`
`)}if(o=e.shift(),o.match(/^\{.*\}$/g)&&(o=o.substr(1,o.length-2)),o=this.parseInline(o),!Re(o))throw new Error("Invalid variable name");return e.length===0?this.client.variables[o]?.toString():(e=e.join(" "),e.match(/^\{[\s\S]*\}$/g)&&(e=e.substr(1,e.length-2)),e=this.parseInline(e),e.match(/^\s*?[-|+]?\d+\s*?$/)?this.client.variables[o]=parseInt(e,10):e.match(/^\s*?[-|+]?\d+\.\d+\s*?$/)?this.client.variables[o]=parseFloat(e):e==="true"?this.client.variables[o]=!0:e==="false"?this.client.variables[o]=!1:this.client.variables[o]=this.stripQuotes(e),null);case"unvar":case"unv":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length!==1)throw new Error("Invalid syntax use \x1B[4m"+n+"unv\x1B[0;-11;-12mar name ");return o=e.shift(),o.match(/^\{[\s\S]*\}$/g)&&(o=o.substr(1,o.length-2)),o=this.parseInline(o),delete this.client.variables[o],null;case"add":case"ad":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length<2)throw new Error("Invalid syntax use \x1B[4m"+n+"ad\x1B[0;-11;-12md name value");if(o=e.shift(),o.match(/^\{[\s\S]*\}$/g)&&(o=o.substr(1,o.length-2)),o=this.parseInline(o),this.client.variables.hasOwnProperty(o)&&typeof this.client.variables[o]!="number")throw new Error(o+" is not a number for add");if(e=e.join(" "),e.match(/^\{[\s\S]*\}$/g)&&(e=e.substr(1,e.length-2)),e=this.evaluate(this.parseInline(e)),typeof e!="number")throw new Error("Value is not a number for add");return this.client.variables.hasOwnProperty(o)?this.client.variables[o]+=e:this.client.variables[o]=e,null;case"math":case"mat":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length<2)throw new Error("Invalid syntax use \x1B[4m"+n+"mat\x1B[0;-11;-12mh name value");if(o=e.shift(),o.match(/^\{[\s\S]*\}$/g)&&(o=o.substr(1,o.length-2)),o=this.parseInline(o),e=e.join(" "),e.match(/^\{[\s\S]*\}$/g)&&(e=e.substr(1,e.length-2)),e=this.evaluate(this.parseInline(e)),typeof e!="number")throw new Error("Value is not a number for add");return this.client.variables[o]=e,null;case"evaluate":case"eva":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length===0)throw new Error("Invalid syntax use \x1B[4m"+n+"eva\x1B[0;-11;-12mluate expression");return e=this.evaluate(this.parseInline(e.join(" "))),this.client.getOption("ignoreEvalUndefined")&&typeof e>"u"?e="":e=""+e,this.client.telnet.prompt?this.client.print(`
`+e+`\x1B[0m
`,!1):this.client.print(e+`\x1B[0m
`,!1),this.client.telnet.prompt=!1,null;case"freeze":case"fr":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length===0)this.scrollLock=!this.scrollLock,this.scrollLock?this.client.display.scrollAtBottom&&this.client.display.scrollUp():this.client.display.scrollDisplay();else if(e.length===1)e[0]==="0"||e[0]==="false"?this.scrollLock&&(this.scrollLock=!1,this.client.display.scrollDisplay()):this.scrollLock||(this.scrollLock=!0,this.client.display.scrollAtBottom&&this.client.display.scrollUp());else if(e.length>1)throw new Error("Invalid syntax use \x1B[4m"+n+"fr\x1B[0;-11;-12meeze \x1B[3mnumber\x1B[0;-11;-12m");return null;case"clr":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length)throw new Error("Invalid syntax use "+n+"CLR");if(this.client.display.lines.length===0)return null;for(o=this.client.display.WindowSize.height+2,s=this.client.display.lines.length;s--&&o&&!this.client.display.lines[s].text.length;)o--;for(f=[];o--;)f.push(`
`);return this.client.print(f.join(""),!0),null;case"fire":return(this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e=this.parseInline(e.join(" ")+`
`),this.ExecuteTriggers(140,e,e,!1,!1),null;case"state":case"sta":switch((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e=e.map(y=>!y||!y.length?y:y.match(/^\{.*\}$/g)?this.parseInline(y.substr(1,y.length-2)):this.parseInline(this.stripQuotes(y))),e.length){case 0:throw new Error("Invalid syntax use \x1B[4m"+n+"sta\x1B[0;-11;-12mte \x1B[3m name|pattern state profile\x1B[0;-11;-12m");case 1:if(e[0].match(/^\s*?[-|+]?\d+\s*?$/)){if(!this._LastTrigger)throw new Error("No trigger has fired yet, unable to set state");d=this._LastTrigger,s=d.state,d.state=parseInt(e[0],10)}else{let y=this.client.profiles.keys,m=0,x=y.length;if(x===0)return null;if(x===1){if(!this.client.profiles.items[y[0]].enabled||!this.client.profiles.items[y[0]].enableTriggers)throw Error("No enabled profiles found!");d=U(this.client.profiles.items[y[m]].triggers),d=d.find(W=>W.name===e[0]||W.pattern===e[0])}else for(;m<x&&!(!(!this.client.profiles.items[y[m]].enabled||!this.client.profiles.items[y[m]].enableTriggers||this.client.profiles.items[y[m]].triggers.length===0)&&(d=U(this.client.profiles.items[y[m]].triggers),d=d.find(W=>W.name===e[0]||W.pattern===e[0]),d));m++);if(!d)throw new Error("Trigger not found: "+e[0]);s=d.state,d.state=0}break;case 2:if(e[0].match(/^\s*?[-|+]?\d+\s*?$/))throw new Error("Invalid argument to "+n+"state, first argument must be name|pattern");if(e[1].match(/^\s*?[-|+]?\d+\s*?$/)){let y=this.client.profiles.keys,m=0,x=y.length;if(x===0)return null;if(x===1){if(!this.client.profiles.items[y[0]].enabled||!this.client.profiles.items[y[0]].enableTriggers)throw Error("No enabled profiles found!");d=U(this.client.profiles.items[y[m]].triggers),d=d.find(W=>W.name===e[0]||W.pattern===e[0])}else for(;m<x&&!(!(!this.client.profiles.items[y[m]].enabled||!this.client.profiles.items[y[m]].enableTriggers||this.client.profiles.items[y[m]].triggers.length===0)&&(d=U(this.client.profiles.items[y[m]].triggers),d=d.find(W=>W.name===e[0]||W.pattern===e[0]),d));m++);if(!d)throw new Error("Trigger not found: "+e[0]);s=d.state,d.state=parseInt(e[1],10)}else{if(p=e[1],this.client.profiles.contains(p))p=this.client.profiles.items[p.toLowerCase()];else throw new Error("Profile not found: "+e[1]);if(d=U(p.triggers),d=d.find(y=>y.name===e[0]||y.pattern===e[0]),!d)throw new Error("Trigger not found: "+e[0]+" in profile: "+p.name);s=d.state,d.state=0}break;case 3:if(e[0].match(/^\s*?[-|+]?\d+\s*?$/))throw new Error("Invalid argument to "+n+"state, first argument must be name|pattern");if(p=e[2],this.client.profiles.contains(p))p=this.client.profiles.items[p.toLowerCase()];else throw new Error("Profile not found: "+e[2]);if(d=U(p.triggers),d=d.find(y=>y.name===e[0]||y.pattern===e[0]),!d)throw new Error("Trigger not found: "+e[0]);s=d.state,d.state=parseInt(e[1],10);break;default:throw new Error("Invalid syntax use \x1B[4m"+n+"sta\x1B[0;-11;-12mte \x1B[3m name|pattern state profile\x1B[0;-11;-12m")}if(d.state<0||d.state>d.triggers.length)throw d.state=s,new Error("Trigger state must be greater than or equal to 0 or less than or equal to "+d.triggers.length);return o=d.fired,d.fired=!1,this.resetTriggerState(this._TriggerCache.indexOf(d),s,o),this.client.restartAlarmState(d,s,d.state),this.client.saveProfiles(),this.client.emit("item-updated","trigger",d.profile.name,d.profile.triggers.indexOf(d),d),this.client.echo("Trigger state set to "+d.state+".",-7,-8,!0,!0),null;case"set":switch((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e=e.map(y=>!y||!y.length?y:y.match(/^\{.*\}$/g)?this.parseInline(y.substr(1,y.length-2)):this.parseInline(this.stripQuotes(y))),s=0,o=!1,e.length){case 0:throw new Error("Invalid syntax use "+n+"set \x1B[3mname|pattern\x1B[0;-11;-12m state \x1B[3mvalue profile\x1B[0;-11;-12m");case 1:if(e[0].match(/^\s*?[-|+]?\d+\s*?$/)){if(!this._LastTrigger)throw new Error("No trigger has fired yet, unable to set state");if(d=this._LastTrigger,s=parseInt(e[0],10),s<0||s>d.triggers.length)throw new Error("Trigger state must be greater than or equal to 0 or less than or equal to "+d.triggers.length);s===0?(o=d.fired,d.fired=!0):(o=d.triggers[s-1].fired,d.triggers[s-1].fired=!0)}else throw new Error("Trigger state must be greater than or equal to 0 or less than or equal to "+d.triggers.length);break;case 2:if(e[0].match(/^\s*?[-|+]?\d+\s*?$/)){if(!this._LastTrigger)throw new Error("No trigger has fired yet, unable to set state");if(d=this._LastTrigger,s=parseInt(e[0],10),s<0||s>d.triggers.length)throw new Error("Trigger state must be greater than or equal to 0 or less than or equal to "+d.triggers.length);if(e[1]!=="0"&&e[1]!=="1"&&e[1]!=="true"&&e[1]!=="false")throw new Error("Value must be 0, 1, true, or false");s===0?(o=d.fired,d.fired=e[1]==="1"||e[1]==="true"):(o=d.triggers[s-1].fired,d.triggers[s-1].fired=e[1]==="1"||e[1]==="true")}else{let y=this.client.profiles.keys,m=0,x=y.length;if(x===0)return null;if(x===1){if(!this.client.profiles.items[y[0]].enabled||!this.client.profiles.items[y[0]].enableTriggers)throw Error("No enabled profiles found!");d=U(this.client.profiles.items[y[m]].triggers),d=d.find(W=>W.name===e[0]||W.pattern===e[0])}else for(;m<x&&!(!(!this.client.profiles.items[y[m]].enabled||!this.client.profiles.items[y[m]].enableTriggers||this.client.profiles.items[y[m]].triggers.length===0)&&(d=U(this.client.profiles.items[y[m]].triggers),d=d.find(W=>W.name===e[0]||W.pattern===e[0]),d));m++);if(!d)throw new Error("Trigger not found: "+e[0]);if(s=parseInt(e[1],10),s<0||s>d.triggers.length)throw new Error("Trigger state must be greater than or equal to 0 or less than or equal to "+d.triggers.length);s===0?(o=d.fired,d.fired=!0):(o=d.triggers[s-1].fired,d.triggers[s-1].fired=!0)}break;case 3:if(e[2]==="0"&&e[2]!=="1"&&e[2]!=="true"&&e[21]!=="false"){if(p=e[2],this.client.profiles.contains(p))p=this.client.profiles.items[p.toLowerCase()];else throw new Error("Profile not found: "+p);if(d=U(p.triggers),d=d.find(y=>y.name===e[0]||y.pattern===e[0]),!d)throw new Error("Trigger not found: "+e[0]+" in profile: "+p.name);if(s=parseInt(e[1],10),s<0||s>d.triggers.length)throw new Error("Trigger state must be greater than or equal to 0 or less than or equal to "+d.triggers.length);s===0?(o=d.fired,d.fired=!0):(o=d.triggers[s-1].fired,d.triggers[s-1].fired=!0)}else{let y=this.client.profiles.keys,m=0,x=y.length;if(x===0)return null;if(x===1){if(!this.client.profiles.items[y[0]].enabled||!this.client.profiles.items[y[0]].enableTriggers)throw Error("No enabled profiles found!");d=U(this.client.profiles.items[y[m]].triggers),d=d.find(W=>W.name===e[0]||W.pattern===e[0])}else for(;m<x&&!(!(!this.client.profiles.items[y[m]].enabled||!this.client.profiles.items[y[m]].enableTriggers||this.client.profiles.items[y[m]].triggers.length===0)&&(d=U(this.client.profiles.items[y[m]].triggers),d=d.find(W=>W.name===e[0]||W.pattern===e[0]),d));m++);if(!d)throw new Error("Trigger not found: "+e[0]);if(s=parseInt(e[1],10),s<0||s>d.triggers.length)throw new Error("Trigger state must be greater than or equal to 0 or less than or equal to "+d.triggers.length);s===0?(o=d.fired,d.fired=e[2]==="1"||e[2]==="true"):(o=d.triggers[s-1].fired,d.triggers[s-1].fired=e[2]==="1"||e[2]==="true")}break;case 4:if(p=e[2],this.client.profiles.contains(p))p=this.client.profiles.items[p.toLowerCase()];else throw new Error("Profile not found: "+p);if(d=U(p.triggers),d=d.find(y=>y.name===e[0]||y.pattern===e[0]),!d)throw new Error("Trigger not found: "+e[0]+" in profile: "+p.name);if(e[2]!=="0"&&e[2]!=="1"&&e[2]!=="true"&&e[2]!=="false")throw new Error("Value must be 0, 1, true, or false");s===0?(o=d.fired,d.fired=e[2]==="1"||e[2]==="true"):(o=d.triggers[s-1].fired,d.triggers[s-1].fired=e[2]==="1"||e[2]==="true");break;default:throw new Error("Invalid syntax use "+n+"set \x1B[3mname|pattern\x1B[0;-11;-12m state \x1B[3mvalue profile\x1B[0;-11;-12m")}return this.client.saveProfiles(),this.client.emit("item-updated","trigger",d.profile.name,d.profile.triggers.indexOf(d),d),this.resetTriggerState(this._TriggerCache.indexOf(d),s,o),s===0?this.client.echo("Trigger state 0 fired state set to "+d.fired+".",-7,-8,!0,!0):(this.client.echo("Trigger state "+s+" fired state set to "+d.triggers[s-1].fired+".",-7,-8,!0,!0),d.enabled&&d.triggers[s-1].enabled&&d.triggers[s-1].type===65536&&(this._LastTriggered="",this.ExecuteTrigger(d,[],!1,this._TriggerCache.indexOf(d),0,0,d))),null;case"condition":case"cond":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),c={profile:null,name:null,pattern:null,commands:null,options:{priority:0}},e.length<2||e.length>5)throw new Error("Invalid syntax use \x1B[4m"+n+"cond\x1B[0;-11;-12mition name|pattern {pattern} {commands} \x1B[3moptions profile\x1B[0;-11;-12m or \x1B[4m"+n+"cond\x1B[0;-11;-12mition {pattern} {commands} \x1B[3m{options} profile\x1B[0;-11;-12m");if(e[0].length===0)throw new Error("Invalid trigger name or pattern");if(e[0].match(/^\{.*\}$/g))c.pattern=e.shift(),c.pattern=this.parseInline(c.pattern.substr(1,c.pattern.length-2));else{if(c.name=this.parseInline(this.stripQuotes(e.shift())),!c.name||c.name.length===0)throw new Error("Invalid trigger name");e[0].match(/^\{.*\}$/g)&&(c.pattern=e.shift(),c.pattern=this.parseInline(c.pattern.substr(1,c.pattern.length-2)))}if(e.length!==0){if(e[0].match(/^\{[\s\S]*\}$/g)&&(c.commands=e.shift(),c.commands=c.commands.substr(1,c.commands.length-2)),e.length===1)if(e[0].match(/^\{[\s\S]*\}$/g)?e[0]=e[0].substr(1,e[0].length-2):e[0]=this.stripQuotes(e[0]),e[0].length!==0)this.parseInline(e[0]).split(",").forEach(y=>{switch(y.trim()){case"nocr":case"prompt":case"case":case"verbatim":case"disable":case"enable":case"cmd":case"temporary":case"temp":case"raw":case"pattern":case"regular":case"alarm":case"event":case"cmdpattern":case"loopexpression":case"reparse":case"reparsepattern":case"manual":case"skip":case"looplines":case"looppattern":case"wait":case"duration":case"withinlines":c.options[y.trim()]=!0;break;default:if(y.trim().startsWith("param=")){if(f=y.trim().split("="),f.length!==2)throw new Error(`Invalid trigger param option '${y.trim()}'`);c.options.params=f[1]}else if(y.trim().startsWith("type=")){if(f=y.trim().split("="),f.length!==2)throw new Error(`Invalid trigger type option '${y.trim()}'`);if(!this.isTriggerType(f[1]))throw new Error("Invalid trigger type");c.options.type=f[1]}else if(y.trim().startsWith("pri=")||y.trim().startsWith("priority=")){if(f=y.trim().split("="),f.length!==2)throw new Error(`Invalid trigger priority option '${y.trim()}'`);if(o=parseInt(f[1],10),isNaN(o))throw new Error("Invalid trigger priority value '"+f[1]+"' must be a number");c.options.priority=o}else throw new Error(`Invalid trigger option '${y.trim()}'`)}});else throw new Error("Invalid trigger options");else if(e.length===2){if(e[0].match(/^\{[\s\S]*\}$/g)&&(e[0]=e[0].substr(1,e[0].length-2)),e[0].length!==0)this.parseInline(e[0]).split(",").forEach(y=>{switch(y.trim()){case"nocr":case"prompt":case"case":case"verbatim":case"disable":case"enable":case"cmd":case"temporary":case"temp":case"raw":case"pattern":case"regular":case"alarm":case"event":case"cmdpattern":case"loopexpression":case"reparse":case"reparsepattern":case"manual":case"skip":case"looplines":case"looppattern":case"wait":case"duration":case"withinlines":c.options[y.trim()]=!0;break;default:if(y.trim().startsWith("param=")){if(f=y.trim().split("="),f.length!==2)throw new Error(`Invalid trigger param option '${y.trim()}'`);c.options.params=f[1]}else if(y.trim().startsWith("type=")){if(f=y.trim().split("="),f.length!==2)throw new Error(`Invalid trigger type option '${y.trim()}'`);if(!this.isTriggerType(f[1]))throw new Error("Invalid trigger type");c.options.type=f[1]}else if(y.trim().startsWith("pri=")||y.trim().startsWith("priority=")){if(f=y.trim().split("="),f.length!==2)throw new Error(`Invalid trigger priority option '${y.trim()}'`);if(o=parseInt(f[1],10),isNaN(o))throw new Error("Invalid trigger priority value '"+f[1]+"' must be a number");c.options.priority=o}else throw new Error(`Invalid trigger option '${y.trim()}'`)}});else throw new Error("Invalid trigger options");c.profile=this.stripQuotes(e[1]),c.profile.length!==0&&(c.profile=this.parseInline(c.profile))}}return this.createTrigger(c.pattern,c.commands,c.profile,c.options,c.name,!0),null;case"cr":return(this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),this.client.sendBackground(`
`),null;case"send":case"se":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length===0)throw new Error("Invalid syntax use \x1B[4m"+n+"se\x1B[0;-11;-12mnd file \x1B[3mprefix suffix\x1B[0;-11;-12m or \x1B[4m"+n+"se\x1B[0;-11;-12mnd text");if(e=e.join(" "),e.length===0)throw new Error("Invalid syntax use \x1B[4m"+n+"se\x1B[0;-11;-12mnd file \x1B[3mprefix suffix\x1B[0;-11;-12m or \x1B[4m"+n+"se\x1B[0;-11;-12mnd text");return this.client.sendBackground(this.stripQuotes(e),this.client.getOption("allowCommentsFromCommand")),null;case"sendfile":case"sendf":return((y,m)=>{ue().then(x=>{pe(x[0]).then(W=>{(this.client.getOption("echo")&4)===4&&this.client.echo(m,-3,-4,!0,!0),S="",o="",y.length>1&&(S=this.stripQuotes(this.parseInline(y[0]))),y.length>2&&(o=this.stripQuotes(this.parseInline(y[1]))),r=W.split(/\r?\n/),r.forEach(te=>{this.client.sendBackground(S+te+o,null,this.client.getOption("allowCommentsFromCommand"))})}).catch(this.client.error)}).catch(()=>{})})(e,i),null;case"sendfileraw":case"sendfiler":return((y,m)=>{ue().then(x=>{pe(x[0]).then(W=>{(this.client.getOption("echo")&4)===4&&this.client.echo(m,-3,-4,!0,!0),S="",o="",y.length>1&&(S=this.stripQuotes(this.parseInline(y[0]))),y.length>2&&(o=this.stripQuotes(this.parseInline(y[1]))),r=W.split(/\r?\n/),r.forEach(te=>{this.client.sendRaw(S+te+o)})}).catch(this.client.error)}).catch(()=>{})})(e,i),null;case"sendraw":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length===0)throw new Error("Invalid syntax use "+n+"sendraw text or "+n+"sendraw file \x1B[3mprefix suffix\x1B[0;-11;-12m");if(e=e.join(" "),e.length===0)throw new Error("Invalid syntax use "+n+"sendraw text or "+n+"sendraw file \x1B[3mprefix suffix\x1B[0;-11;-12m");return e.endsWith(`
`)||(e=e+`
`),this.client.sendRaw(e),null;case"sendprompt":case"sendp":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length===0)throw new Error("Invalid syntax use \x1B[4m"+n+"sendp\x1B[0;-11;-12mrompt text");if(e=e.join(" "),e.length===0)throw new Error("Invalid syntax use \x1B[4m"+n+"sendp\x1B[0;-11;-12mrompt text");return this.client.sendRaw(e),null;case"character":case"char":return(this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),this.client.sendRaw(window.$character||""),null;case"speak":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length===0)throw new Error("Invalid syntax use "+n+"speak text");if(e=e.join(" "),e.length===0)throw new Error("Invalid syntax use "+n+"speak text");return e=this.stripQuotes(this.parseInline(e)),e.length!==0&&window.speechSynthesis.speak(new SpeechSynthesisUtterance(e)),null;case"speakstop":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length!==0)throw new Error("Invalid syntax use "+n+"speakstop");return window.speechSynthesis.cancel(),null;case"speakpause":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length!==0)throw new Error("Invalid syntax use "+n+"speakpause");return window.speechSynthesis.pause(),null;case"speakresume":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length!==0)throw new Error("Invalid syntax use "+n+"speakresume");return window.speechSynthesis.resume(),null;case"comment":case"comm":return(this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),null;case"noop":case"no":return(this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length&&this.parseInline(e.join(" ")),null;case"temp":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),c={profile:null,name:null,pattern:null,commands:null,options:{priority:0}},e.length<2||e.length>5)throw new Error("Invalid syntax use "+n+"temp name {pattern} {commands} \x1B[3moptions profile\x1B[0;-11;-12m or "+n+"temp {pattern} {commands} \x1B[3m{options} profile\x1B[0;-11;-12m");if(e[0].length===0)throw new Error("Invalid temporary trigger or pattern");if(e[0].match(/^\{.*\}$/g))c.pattern=e.shift(),c.pattern=this.parseInline(c.pattern.substr(1,c.pattern.length-2));else{if(c.name=this.parseInline(this.stripQuotes(e.shift())),!c.name||c.name.length===0)throw new Error("Invalid temporary trigger name");e[0].match(/^\{.*\}$/g)&&(c.pattern=e.shift(),c.pattern=this.parseInline(c.pattern.substr(1,c.pattern.length-2)))}if(e.length!==0){if(e[0].match(/^\{[\s\S]*\}$/g)&&(c.commands=e.shift(),c.commands=c.commands.substr(1,c.commands.length-2)),e.length===1)if(e[0].match(/^\{[\s\S]*\}$/g)?e[0]=e[0].substr(1,e[0].length-2):e[0]=this.stripQuotes(e[0]),e[0].length!==0)this.parseInline(e[0]).split(",").forEach(y=>{switch(y.trim()){case"nocr":case"prompt":case"case":case"verbatim":case"disable":case"enable":case"cmd":case"raw":case"pattern":case"regular":case"alarm":case"event":case"cmdpattern":case"loopexpression":c.options[y.trim()]=!0;break;default:if(y.trim().startsWith("param=")){if(f=y.trim().split("="),f.length!==2)throw new Error(`Invalid temporary trigger param option '${y.trim()}'`);c.options.params=f[1]}else if(y.trim().startsWith("type=")){if(f=y.trim().split("="),f.length!==2)throw new Error(`Invalid temporary trigger type option '${y.trim()}'`);if(!this.isTriggerType(f[1],1))throw new Error("Invalid temporary trigger type");c.options.type=f[1]}else if(y.trim().startsWith("pri=")||y.trim().startsWith("priority=")){if(f=y.trim().split("="),f.length!==2)throw new Error(`Invalid temporary trigger priority option '${y.trim()}'`);if(o=parseInt(f[1],10),isNaN(o))throw new Error("Invalid temporary trigger priority value '"+f[1]+"' must be a number");c.options.priority=o}else throw new Error(`Invalid temporary trigger option '${y.trim()}'`)}});else throw new Error("Invalid temporary trigger options");else if(e.length===2){if(e[0].match(/^\{[\s\S]*\}$/g)&&(e[0]=e[0].substr(1,e[0].length-2)),e[0].length!==0)this.parseInline(e[0]).split(",").forEach(y=>{switch(y.trim()){case"nocr":case"prompt":case"case":case"verbatim":case"disable":case"enable":case"cmd":case"raw":case"pattern":case"regular":case"alarm":case"event":case"cmdpattern":case"loopexpression":c.options[y.trim()]=!0;break;default:if(y.trim().startsWith("param=")){if(f=y.trim().split("="),f.length!==2)throw new Error(`Invalid temporary trigger param option '${y.trim()}'`);c.options.params=f[1]}else if(y.trim().startsWith("type=")){if(f=y.trim().split("="),f.length!==2)throw new Error(`Invalid temporary trigger type option '${y.trim()}'`);if(!this.isTriggerType(f[1],1))throw new Error("Invalid temporary trigger type");c.options.type=f[1]}else if(y.trim().startsWith("pri=")||y.trim().startsWith("priority=")){if(f=y.trim().split("="),f.length!==2)throw new Error(`Invalid temporary trigger priority option '${y.trim()}'`);if(o=parseInt(f[1],10),isNaN(o))throw new Error("Invalid temporary trigger priority value '"+f[1]+"' must be a number");c.options.priority=o}else throw new Error(`Invalid temporary trigger option '${y.trim()}'`)}});else throw new Error("Invalid temporary trigger options");c.profile=this.stripQuotes(e[1]),c.profile.length!==0&&(c.profile=this.parseInline(c.profile))}}return c.options.temporary=!0,this.createTrigger(c.pattern,c.commands,c.profile,c.options,c.name),null;case"wrap":case"wr":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e=e.filter(y=>y),e.length>1)throw new Error("Invalid syntax use \x1B[4m"+n+"wr\x1B[0;-11;-12map or \x1B[4m"+n+"wr\x1B[0;-11;-12map number");if(e.length===0)this.client.setOption("display.wordWrap",!this.client.getOption("display.wordWrap")),this.client.display.wordWrap=this.client.getOption("display.wordWrap");else{if(o=parseInt(this.parseInline(e[0]),10),isNaN(o))throw new Error("Invalid number '"+o+"' for wrap");if(o<0)throw new Error("Must be greater then or equal to zero for wrap");this.client.setOption("display.wordWrap",!0),this.client.setOption("display.wordWrap",o),this.client.display.wordWrap=!0,this.client.display.wrapAt=o}return null;case"prompt":case"pr":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length===0||e.length>4)throw new Error("Invalid syntax use \x1B[4m"+n+"pr\x1B[0;-11;-12mompt variable \x1B[3mmessage defaultValue mask\x1B[0;-11;-12m");if(o=e.shift(),o.match(/^\{.*\}$/g)&&(o=o.substr(1,o.length-2)),o=this.parseInline(o),!Re(o))throw new Error("Invalid variable name");return e=e.map(y=>this.parseInline(this.stripQuotes(y))),e.length===3&&e[2]&&e[2].toLowerCase()==="true"&&(e[2]=!0),e=window.prompt(...e),e?.match(/^\s*?[-|+]?\d+\s*?$/)?this.client.variables[o]=parseInt(e,10):e?.match(/^\s*?[-|+]?\d+\.\d+\s*?$/)?this.client.variables[o]=parseFloat(e):e==="true"?this.client.variables[o]=!0:e==="false"?this.client.variables[o]=!1:this.client.variables[o]=e,null;case"setmap":if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),e.length===0)throw new Error("Invalid syntax use "+n+"setmap file \x1B[3msetCharacter\x1B[0;-11;-12m");if(f=this.stripQuotes(this.parseInline(e.shift()))||"",!f||!f.length)throw new Error("Empty file\x1B[0;-11;-12m");return e.length>1?S=this.stripQuotes(this.parseInline(e.join(" "))).toLocaleLowerCase().trim():S="",this.emit("setmap",f,S==="true"||S==="yes",!0),null}if(t.match(/^[-|+]?\d+$/)){if((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),o=parseInt(t,10),e.length===0)throw new Error("Invalid syntax use "+n+"nnn commands");return e=e.join(" "),e.match(/^\{[\s\S]*\}$/g)&&(e=e.substr(1,e.length-2)),o<1?this.executeForLoop(-o+1,1,e):this.executeForLoop(0,o,e)}let _={name:t,args:e,raw:i,handled:!1,return:null};return this.client.emit("function",_),_.handled?((this.client.getOption("echo")&4)===4&&this.client.echo(i,-3,-4,!0,!0),_.return):_.raw.startsWith(n)?n+this.parseOutgoing(_.raw.substr(1),null,null,null,!0):this.parseOutgoing(_.raw+`
`,null,null,null,!0)}executeForLoop(t,e,i){let n=[],s;if(t>e)for(s=t-1;s>=e;s--){this.loops.push(s);try{let l=this.parseOutgoing(i);if(l!=null&&l.length>0&&n.push(l),this.stack.continue){this.stack.continue=!1;continue}if(this.stack.break){this.stack.break--;break}}catch(l){throw l}finally{this.loops.pop()}}else for(s=t;s<e;s++){this.loops.push(s+1);try{let l=this.parseOutgoing(i);if(l!=null&&l.length>0&&n.push(l),this.stack.continue){this.stack.continue=!1;continue}if(this.stack.break){this.stack.break--;break}}catch(l){throw l}finally{this.loops.pop()}}return n.length>0?n.map(l=>l.trim()).join(`
`):null}parseInline(t){return this.parseOutgoing(t,!1,null,!1,!0)}parseOutgoing(t,e,i,n,s,l){let r=t.length;if(!this.enableParsing||t==null||r===0)return t;let a="",o="",f,p=0,g=this.client.aliases,c=this.client.getOption("commandStackingChar"),S=this.client.getOption("speedpathsChar"),v=this.client.getOption("enableSpeedpaths"),d=this.client.getOption("enableCommands"),b=this.client.getOption("commandChar"),L=this.client.getOption("allowEscape"),P=this.client.getOption("escapeChar"),_=this.client.getOption("verbatimChar"),j=this.client.getOption("enableVerbatim"),C=this.client.getOption("enableDoubleParameterEscaping"),E=this.client.getOption("parametersChar"),y=this.client.getOption("enableParameters"),m=this.client.getOption("nParametersChar"),x=this.client.getOption("enableNParameters"),W=this.client.getOption("allowEval"),te=this.client.getOption("ignoreEvalUndefined"),ne=this.client.getOption("enableInlineComments")&&!l,me=this.client.getOption("enableBlockComments")&&!l,se=this.client.getOption("inlineCommentString").split(""),I=this.client.getOption("blockCommentString").split(""),R=this.client.getOption("ignoreInputLeadingWhitespace"),z="",F=[],k="",M=!0,O="",Y,w,J,D=0,B,N,q=!0,oe=!1,_e=!1,Se=!1,ge=0,Ne=this.client.getOption("parseDoubleQuotes"),Ee=this.client.getOption("parseSingleQuotes");for(e==null?e=g.length>0:e=e&&g.length>0,c.length===0?i=!1:i==null?i=this.client.getOption("commandStacking"):i=i&&this.client.getOption("commandStacking"),D=0;D<r;D++)switch(w=t.charAt(D),p){case 1:L&&w===P?p=27:(w==='"'&&Ne&&(p=0),e&&M?o+=w:a+=w),q=!1;break;case 27:p=1,w!=='"'&&w!==P?(D--,e&&M?o+=P:a+=P):e&&M?o+=w:a+=w;break;case 2:L&&w===P?p=27:(w==="'"&&Ee&&(p=0),e&&M?o+=w:a+=w),q=!1;break;case 28:p=2,w!=="'"&&w!==P?(D--,e&&M?o+=P:a+=P):e&&M?o+=w:a+=w;break;case 3:if(w==='"'&&Ne)k+=w,p=4,q=!1;else if(w==="'"&&Ee)k+=w,p=5,q=!1;else if(L&&w===P)p=17,q=!1;else if(D===r-1||w===`
`||i&&w===c){for(w===`
`||i&&w===c||(k+=w),k.length>0&&F.push(this.parseInline(k)),J=f.length,Y=0;Y<J;Y++){if(a=this.ExecuteAlias(f[Y],F),typeof a=="number")return a>=0&&this.executeWait(t.substr(D+1),a,e,i,n,s,l),O.length===0?null:O;if(a!==null&&(O+=a),a="",!Y.multi)break;if(this.stack.continue||this.stack.break)return O.length===0?null:O}o="",p=0,f=null,q=!0}else w===" "?(F.push(this.parseInline(k)),k="",q=!1):(k+=w,q=!1);break;case 4:w==='"'&&(p=3),k+=w,q=!1;break;case 5:w==="'"&&(p=3),k+=w,q=!1;break;case 17:p=3,w===P||i&&w===c||j&&w===_||v&&w===S||d&&w===b||C&&w===E||x&&w===m?k+=w:ne&&w==se[0]||me&&w==I[0]?N=w:`"'{`.indexOf(w)!==-1?k+=w:k+=P+w;break;case 6:if(L&&w===P)p=18,q=!1;else if(w===`
`||i&&w===c){if(p=0,a=this.ProcessPath(a),a!==null&&(O+=a),a="",q=!0,this.stack.continue||this.stack.break)return O.length===0?null:O}else D===1&&w===S?(p=0,D--,q=!1):(a+=w,q=!1);break;case 18:p=6,w===P||i&&w===c||j&&w===_||v&&w===S||d&&w===b||C&&w===E||x&&w===m?a+=w:ne&&w==se[0]||me&&w==I[0]?N=w:`"'{`.indexOf(w)!==-1?a+=w:a+=P+w;break;case 7:if(w==="{")q=!1,a+=w,ge++;else if(w==="}")q=!1,a+=w,ge--;else if(ge===0&&L&&w===P)p=19,q=!1;else if(ge===0&&(w===`
`||i&&w===c)){if(p=0,a=this.executeScript(b+a),typeof a=="number")return a>=0&&this.executeWait(t.substr(D+1),a,e,i,n,s,l),O.length===0?null:O;if(a!==null&&(O+=z+a+`
`),this.stack.continue||this.stack.break)return O.length===0?null:O;a="",q=!0}else a+=w,q=!1;break;case 19:p=7,a+=P+w;break;case 8:if(w==="{"&&k.length===0){p=9;continue}switch(w){case E:k.length===0&&(e&&M?o+=E:a+=E,p=0,C||D--);break;case"*":if(k.length===0){this.stack.args?(e&&M?o+=this.stack.args.slice(1).join(" "):a+=this.stack.args.slice(1).join(" "),this.stack.used=this.stack.args.length):e&&M?o+=E+"*":a+=E+"*",p=0;break}case"-":if(k.length===0){oe=!0;break}else if(_e&&k.length==1){oe=!0;break}else Se=!0;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":if(!Se){k+=w;break}case"x":if(!Se&&k.length===0){_e=!0;break}default:if(this.stack.args&&k.length>0)B=parseInt(k,10),_e?oe&&this.stack.args.indices&&B<this.stack.args.length?B=this.stack.indices.slice(B).map(Q=>Q?Q[0]+" "+Q[1]:"0 0").join(" "):this.stack.args.indices&&B<this.stack.args.length?B=this.stack.args.indices[B]?this.stack.args.indices[B][0]+" "+this.stack.args.indices[B][1]:"0 0":oe?B=E+"x-"+B:B=E+"x"+B:(oe&&B<this.stack.args.length?B=this.stack.args.slice(k).join(" "):B<this.stack.args.length?B=this.stack.args[B]:oe?B=E+"-"+B:B=E+B,oe?this.stack.used=this.stack.args.length:k>this.stack.used&&(this.stack.used=parseInt(k,10))),e&&M?o+=B:a+=B,D--;else{if(k.length===0&&this.loops.length>0&&(B=w.charCodeAt(0)-105,B>=0&&B<18&&B<this.loops.length)){e&&M?o+=this.loops[B]:a+=this.loops[B],p=0;break}e&&M?(o+=E,oe&&(o+="-"),_e&&(o+="x")):(a+=E,oe&&(a+="-"),_e&&(a+="x")),D=D-k.length-1}p=0,k="";break}break;case 26:w.match(/[^a-zA-Z0-9_]/g)?(this.stack.named.hasOwnProperty(k)?e&&M?o+=this.stack.named[k]:a+=this.stack.named[k]:e&&M?o+=E+k:a+=E+k,D--,p=0,k=""):k+=w;break;case 9:w==="}"&&ge===0?(k==="i"?N=this.loops[0]:k==="repeatnum"?N=this.repeatnum:this.stack.args&&k==="*"?(N=this.stack.args.slice(1).join(" "),this.stack.used=this.stack.args.length):this.stack.named&&this.stack.named.hasOwnProperty(k)?N=this.stack.named[k]:this.stack.args&&!isNaN(k)?(B=parseInt(k,10),B<0?-B>=this.stack.args.length?W?N=B:(N=E,D=D-B.length-2):(N=this.stack.args.slice(B).join(" "),this.stack.used=this.stack.args.length):B<this.stack.args.length?(N=this.stack.args[B],k>this.stack.used&&(this.stack.used=B)):W?N=B:(N=E,D=D-k.length-2)):this.stack.args&&this.stack.args.indices&&k.match(/^x[-|+]?\d+$/)?(B=parseInt(k.substring(1),10),B<0?-B>=this.stack.args.length?(N=E,D=D-B.length-2):N=this.stack.indices.slice(B).map(Q=>Q?Q[0]+" "+Q[1]:"0 0").join(" "):B<this.stack.args.length?N=this.stack.args.indices[B]?this.stack.args.indices[B][0]+" "+this.stack.args.indices[B][1]:"0 0":(N=E,D=D-k.length-2)):(B=this.parseVariable(k),B!=null?N=B:W?(N=this.evaluate(this.parseInline(k)),te&&typeof N>"u"?N=null:N=""+N):(N=E,D=D-k.length-2)),N!=null&&e&&M?o+=N:N!=null&&(a+=N),p=0,k=""):w==="{"?(ge++,k+=w):(w==="}"&&ge--,k+=w);break;case 11:w==="{"?p=12:w.match(/[^a-zA-Z_$]/g)?(p=0,D--,e&&M?o+=m:a+=m):(k=w,p=14);break;case 14:w.match(/[^a-zA-Z0-9_]/g)?(this.stack.named&&this.stack.named.hasOwnProperty(k)?e&&M?o+=this.stack.named[k]:a+=this.stack.named[k]:this.client.variables.hasOwnProperty(k)?e&&M?o+=this.client.variables[k]:a+=this.client.variables[k]:e&&M?o+=m+k:a+=m+k,D--,p=0,k=""):k+=w;break;case 12:w==="}"&&ge===0?(N=null,k==="i"?N=this.loops[0]:k==="repeatnum"?N=this.repeatnum:this.stack.args&&k==="*"?(N=this.stack.args.slice(1).join(" "),this.stack.used=this.stack.args.length):this.stack.named&&this.stack.named.hasOwnProperty(k)?N=this.stack.named[k]:this.stack.args&&!isNaN(k)?(B=parseInt(k,10),B<0?-B>=this.stack.args.length?W?N=B:(N=m,D=D-k.length-2):(N=this.stack.args.slice(B).join(" "),this.stack.used=this.stack.args.length):B<this.stack.args.length?(N=this.stack.args[B],B>this.stack.used&&(this.stack.used=B)):W?N=B:(N=m,D=D-k.length-2)):this.stack.args&&this.stack.args.indices&&k.match(/^x[-|+]?\d+$/)?(B=parseInt(k.substring(1),10),B<0?-B>=this.stack.args.length?(N=m,D=D-k.length-2):N=this.stack.indices.slice(B).map(Q=>Q?Q[0]+" "+Q[1]:"0 0").join(" "):B<this.stack.args.length?N=this.stack.args.indices[B]?this.stack.args.indices[B][0]+" "+this.stack.args.indices[B][1]:"0 0":(N=m,D=D-k.length-2)):(w=this.parseVariable(k),w!=null?N=w:W?(N=this.evaluate(this.parseInline(k)),te&&typeof N>"u"?N=null:N=""+N):(N=m,D=D-k.length-2)),N!=null&&e&&M?o+=N:N!=null&&(a+=N),p=0,k=""):w==="{"?(ge++,k+=w):(w==="}"&&ge--,k+=w);break;case 15:w===P||i&&w===c||j&&w===_||v&&w===S||d&&w===b||C&&w===E||x&&w===m||ne&&w==se[0]||me&&w==I[0]||`"'{`.indexOf(w)!==-1?N=w:N=P+w,e&&M?o+=N:a+=N,p=0;break;case 16:w===`
`?(p=0,O+=a+w,a="",q=!0):(a+=w,q=!1);break;case 20:ne&&w===se[1]?p=22:me&&w===I[1]?p=24:(p=0,e&&M?o+=se[0]:a+=se[0],D--);break;case 21:w===se[1]?p=22:(p=0,e&&M?o+=se[0]:a+=se[0],D--);break;case 23:me&&w===I[1]?p=25:(p=0,e&&M?o+=I[0]:a+=I[0],D--);break;case 22:w===`
`&&(p=0,q?(o="",M=!0,q=!0):D--);break;case 24:I.length===1?w===I[0]&&(p=0):w===I[1]&&(p=25);break;case 25:w===I[0]?p=0:p=24;break;default:if((ne||me)&&w===se[0]&&w===I[0]){ne&&se.length===1?p=22:me&&I.length===1?p=24:p=20;continue}else if(ne&&w===se[0]){se.length===1?p=22:p=21;continue}else if(me&&w===I[0]){I.length===1?p=24:p=23;continue}else if(L&&w===P){p=15,q=!1;continue}else if(y&&w===E)p=8,oe=!1,_e=!1,Se=!1,k="",q=!1;else if(x&&w===m)p=11,oe=!1,_e=!1,Se=!1,k="",q=!1;else if(!s&&d&&q&&w===b)p=7,q=!1,o.length?(z=o,o=""):(z=a||"",a="");else if(j&&q&&w===_)p=16,q=!1;else if(v&&q&&w===S)p=6,q=!1;else if(w==='"'&&Ne)e&&M?o+=w:a+=w,p=1,q=!1;else if(w==="'"&&Ee)e&&M?o+=w:a+=w,p=2,q=!1;else if(q&&R&&(w===" "||w==="	"||w==="\f"||w==="\r"||w==="\v"||w===" "||w==="\xA0"||w==="\u1680"||w==="\u2000-"||w==="\u200A"||w==="\u2028"||w==="\u2029"||w==="\u202F"||w==="\u205F"||w==="\u3000"||w==="\uFEFF"))e&&M?o+=w:a+=w;else if(e&&M&&w===" ")f=Fe(g,"pattern",R?o.trimStart():o),f.length>0?(p=3,F.length=0,k="",F.push(R?o.trimStart():o)):(a+=o+" ",o="",f=null),M=!1,q=!1;else if(w===`
`||i&&w===c){if(e&&M&&o.length>0)if(f=Fe(g,"pattern",R?o.trimStart():o),f.length>0){for(F.push(R?o.trimStart():o),J=f.length,Y=0;Y<J;Y++){if(a=this.ExecuteAlias(f[Y],F),typeof a=="number")return a>=0&&this.executeWait(t.substr(D+1),a,e,i,n,s,l),O.length===0?null:O;if(a!==null&&(O+=a),!Y.multi)break;if(this.stack.continue||this.stack.break)return O.length===0?null:O}a="",F.length=0,k=""}else{if(a=this.ExecuteTriggers(17,o,o,!1,!0),typeof a=="number")return a>=0&&this.executeWait(t.substr(D+1),a,e,i,n,s,l),O.length===0?null:O;a!==null&&(O+=a+`
`),a="",f=null}else{if(a=this.ExecuteTriggers(17,a,a,!1,!0),typeof a=="number")return a>=0&&this.executeWait(t.substr(D+1),a,e,i,n,s,l),O.length===0?null:O;a!==null&&(O+=a+`
`),a=""}if(this.stack.continue||this.stack.break)return O.length===0?null:O;o="",M=!0,q=!0}else e&&M?(o+=w,q=!1):(a+=w,q=!1);break}if(p===15?a+=P:p===14&&k.length>0?this.stack.named&&this.stack.named[k]?a+=this.stack.named[k]:this.client.variables.hasOwnProperty(k)?a+=this.client.variables[k]:(k=this.parseInline(k),a+=m,k!=null&&(a+=k)):p===8&&k.length>0?this.stack.args?(k=parseInt(k,10),_e&&this.stack.args.indices&&k<this.stack.args.length?a+=this.stack.args.indices[k]?this.stack.args.indices[k][0]+" "+this.stack.args.indices[k][1]:"0 0":(oe&&k<this.stack.args.length?a+=this.stack.args.slice(k).join(" "):k<this.stack.args.length&&(a+=this.stack.args[k]),oe?this.stack.used=this.stack.args.length:k>this.stack.used&&(this.stack.used=k))):(k=this.parseInline(k),a+=E,oe&&(a+="-"),_e&&(a+="x"),k!=null&&(a+=k)):p===9?(k=this.parseInline(k),a+=E+"{",k!=null&&(a+=k)):p===11&&k.length>0?this.stack.named?this.stack.named.hasOwnProperty(k)?a+=this.stack.named[k]:(k=this.parseInline(k),a+=m,k!=null&&(a+=k)):(k=this.parseInline(k),a+=m,k!=null&&(a+=k)):p===12?(k=this.parseInline(k),a+=`${m}{`,k!=null&&(a+=k)):p===6?(a=this.ProcessPath(a),a!==null&&(O+=a),a=""):p===20||p===21?(a+=se[0],D--):p===23&&(a+=I[0],D--),!s&&p===7){if(a=this.executeScript(b+a),typeof a=="number")return a>=0&&this.executeWait(t.substr(D+1),a,e,i,n,s,l),O.length===0?null:O;if(a!==null){if(n&&e&&this.stack.args&&this.stack.append&&this.stack.args.length-1>0&&this.stack.used+1<this.stack.args.length){let Q=!1;a.endsWith(`
`)&&(a=a.substring(0,a.length-1),Q=!0),a.endsWith(" ")||(a+=" "),this.stack.used<1?a+=this.stack.args.slice(1).join(" "):a+=this.stack.args.slice(this.stack.used+1).join(" "),this.stack.used=this.stack.args.length,Q&&(a+=`
`)}O+=z+a}else if(O.length===0)return null;if(this.stack.continue||this.stack.break)return O.length===0?null:O}else if(p===16){if(n&&e&&this.stack.args&&this.stack.append&&this.stack.args.length-1>0&&this.stack.used+1<this.stack.args.length){let Q=!1;a.endsWith(`
`)&&(a=a.substring(0,a.length-1),Q=!0),a.endsWith(" ")||(a+=" "),this.stack.used<1?a+=this.stack.args.slice(1).join(" "):a+=this.stack.args.slice(this.stack.used+1).join(" "),this.stack.used=this.stack.args.length,Q&&(a+=`
`)}O+=a}else if(o.length>0&&e&&M){if(n&&e&&this.stack.args&&this.stack.append&&this.stack.args.length-1>0&&this.stack.used+1<this.stack.args.length){let Q=!1;a.endsWith(`
`)&&(a=a.substring(0,a.length-1),Q=!0),a.endsWith(" ")||(a+=" "),this.stack.used<1?a+=this.stack.args.slice(1).join(" "):a+=this.stack.args.slice(this.stack.used+1).join(" "),this.stack.used=this.stack.args.length,Q&&(a+=`
`)}if(a.length>0&&(o+=a),f=Fe(g,"pattern",R?o.trimStart():o),f.length>0)for(F.push(R?o.trimStart():o),J=f.length,Y=0;Y<J;Y++){if(a=this.ExecuteAlias(f[Y],F),typeof a=="number")return a>=0&&this.executeWait(t.substr(D+1),a,e,i,n,s,l),O.length===0?null:O;if(a!==null)O+=a;else if(O.length===0)return null;if(this.stack.continue||this.stack.break)return O;if(!Y.multi)break}else{if(a=this.ExecuteTriggers(17,o,o,!1,!0),typeof a=="number")return a>=0&&this.executeWait(t.substr(D+1),a,e,i,n,s,l),O.length===0?null:O;if(a!==null)O+=a;else if(O.length===0)return null;if(this.stack.continue||this.stack.break)return O}f=null}else if(o.length>0){if(a.length>0&&(o+=a),a=this.ExecuteTriggers(17,o,o,!1,!0),typeof a=="number")return a>=0&&this.executeWait(t.substr(D+1),a,e,i,n,s,l),O.length===0?null:O;if(a!==null){if(n&&e&&this.stack.args&&this.stack.append&&this.stack.args.length-1>0&&this.stack.used+1<this.stack.args.length){let Q=!1;a.endsWith(`
`)&&(a=a.substring(0,a.length-1),Q=!0),a.endsWith(" ")||(a+=" "),this.stack.used<1?a+=this.stack.args.slice(1).join(" "):a+=this.stack.args.slice(this.stack.used+1).join(" "),this.stack.used=this.stack.args.length,Q&&(a+=`
`)}O+=a}else if(O.length===0)return null;if(this.stack.continue||this.stack.break)return O.length===0?null:O}else if(a.length>0){if(a=this.ExecuteTriggers(17,a,a,!1,!0),typeof a=="number")return a>=0&&this.executeWait(t.substr(D+1),a,e,i,n,s,l),O.length===0?null:O;if(a!==null){if(n&&e&&this.stack.args&&this.stack.append&&this.stack.args.length-1>0&&this.stack.used+1<this.stack.args.length){let Q=!1;a.endsWith(`
`)&&(a=a.substring(0,a.length-1),Q=!0),a.endsWith(" ")||(a+=" "),this.stack.used<1?a+=this.stack.args.slice(1).join(" "):a+=this.stack.args.slice(this.stack.used+1).join(" "),Q&&(a+=`
`)}O+=a}else if(O.length===0)return null;if(this.stack.continue||this.stack.break)return O.length===0?null:O}return F.length=0,F=null,k=null,o=null,O}parseVariable(t){let e;switch(t){case"esc":return"\x1B";case"cr":return`
`;case"lf":return"\r";case"crlf":return`\r
`;case"copied":return window.$copied;case"copied.lower":return window.$copied.toLowerCase();case"copied.upper":return window.$copied.toUpperCase();case"copied.proper":return kt(window.$copied);case"i":return this.loops[0];case"repeatnum":return this.vStack.$repeatnum||this.repeatnum;case"character":return window.$character;case"character.lower":return window.$character.toLowerCase();case"character.upper":return window.$character.toUpperCase();case"character.proper":return kt(window.$character);case"selected":case"selectedurl":case"selectedline":case"selectedword":case"selurl":case"selline":case"selword":case"action":case"trigger":return this.vStack["$"+t]||window["$"+t]||"";case"selected.lower":case"selectedurl.lower":case"selectedline.lower":case"selectedword.lower":case"selurl.lower":case"selline.lower":case"selword.lower":return(this.vStack["$"+t.substr(0,t.length-6)]||window["$"+t.substr(0,t.length-6)]||"").toLowerCase();case"selected.upper":case"selectedurl.upper":case"selectedline.upper":case"selectedword.upper":case"selurl.upper":case"selline.upper":case"selword.upper":return(this.vStack["$"+t.substr(0,t.length-6)]||window["$"+t.substr(0,t.length-6)]||"").toUpperCase();case"selected.proper":case"selectedurl.proper":case"selectedline.proper":case"selectedword.proper":case"selurl.proper":case"selline.proper":case"selword.proper":return kt(this.vStack["$"+t.substr(0,t.length-7)]||window["$"+t.substr(0,t.length-7)]);case"random":return ft().randomInt(0,100)}if(_t.indexOf(t)!==-1)return this.vStack["$"+t]||window["$"+t]||"";if(this.loops.length&&t.length===1){let g=t.charCodeAt(0)-105;if(g>=0&&g<18&&g<this.loops.length)return this.loops[g]}let n=new RegExp("^([a-zA-Z]+)\\((.*)\\)$","g").exec(t);if(!n||!n.length){let g={raw:t,name:t,args:[],handled:!1,return:null};return this.client.emit("variable",g),g.handled?g.return:null}let s,l,r,a,o,f=this.client.getOption("allowEscape")?this.client.getOption("escapeChar"):"";switch(n[1]){case"time":return moment?n[2]&&n[2].length>0?moment().format(this.stripQuotes(this.parseInline(n[2]))):moment().format():new Date().toISOString();case"clip":return n[2]&&n[2].length>0?(this.client.writeClipboard(this.stripQuotes(this.parseInline(n[2]))),null):this.client.readClipboard();case"lower":return this.stripQuotes(this.parseInline(n[2]).toLowerCase());case"upper":return this.stripQuotes(this.parseInline(n[2]).toUpperCase());case"proper":return kt(this.stripQuotes(this.parseInline(n[2])));case"eval":return r=this.evaluate(this.parseInline(n[2])),this.client.getOption("ignoreEvalUndefined")&&typeof r>"u"?null:""+r;case"dice":if(r=this.parseInline(n[2]).split(","),r.length===0)throw new Error("Invalid dice");if(r.length===1){if(n=/(\d+)\s*?d(F|f|%|\d+)(\s*?[-|+|*|\/]?\s*?\d+)?/g.exec(r[0]),!n||n.length<3)return null;e=parseInt(n[1]),s=n[2],n.length>3&&(l=n[3])}else if(r.length<4)e=parseInt(r[0]),s=r[1].trim(),r.length>2&&(l=r[2].trim());else throw new Error("Too many arguments for dice");s==="F"||s==="f"?s="F":s!=="%"&&(s=parseInt(s));let g=0;for(let v=0;v<e;v++)s==="F"||s==="f"?g+=gi():s==="%"?g+=~~(Math.random()*100)+1:g+=~~(Math.random()*s)+1;return s==="%"&&(g/=100),l?this.evaluate(g+l):""+g;case"diceavg":if(r=this.parseInline(n[2]).split(","),r.length===0)throw new Error("Invalid dice for diceavg");if(r.length===1){if(n=/(\d+)d(F|f|%|\d+)([-|+|*|/]?\d+)?/g.exec(r[0]),!n||n.length<3)return null;e=parseInt(n[1]),s=n[2],n.length>3&&(l=n[3])}else if(r.length<4)e=parseInt(r[0]),s=r[1].trim(),r.length>2&&(l=r[2].trim());else throw new Error("Too many arguments for diceavg");return a=1,s==="F"||s==="f"?(a=-1,o=1):s==="%"?(a=0,o=1):o=parseInt(s),l?this.evaluate((a+o)/2*e+l):""+(a+o)/2*e;case"dicemin":if(r=this.parseInline(n[2]).split(","),r.length===0)throw new Error("Invalid dice for dicemin");if(r.length===1){if(n=/(\d+)d(F|f|%|\d+)([-|+|*|/]?\d+)?/g.exec(r[0]),!n||n.length<3)return null;e=parseInt(n[1]),s=n[2],n.length>3&&(l=n[3])}else if(r.length<4)e=parseInt(r[0]),s=r[1].trim(),r.length>2&&(l=r[2]);else throw new Error("Too many arguments for dicemin");return a=1,s==="F"||s==="f"?a=-1:s==="%"&&(a=0),l?this.evaluate(a*e+l):""+a*e;case"dicemax":if(r=this.parseInline(n[2]).split(","),r.length===0)throw new Error("Invalid dice for dicemax");if(r.length===1){if(n=/(\d+)d(F|f|%|\d+)([-|+|*|/]?\d+)?/g.exec(r[0]),!n||n.length<3)return null;e=parseInt(n[1]),s=n[2],n.length>3&&(l=n[3])}else if(r.length<4)e=parseInt(r[0]),s=r[1].trim(),r.length>2&&(l=r[2].trim());else throw new Error("Too many arguments for dicemax");return s==="F"||s==="f"||s==="%"?o=1:o=parseInt(s),l?this.evaluate(o*e+l):""+o*e;case"zdicedev":case"dicedev":let c=n[1];if(r=this.parseInline(n[2]).split(","),r.length===0)throw new Error("Invalid dice for "+c);if(r.length===1){if(n=/(\d+)d(F|f|%|\d+)([-|+|*|/]?\d+)?/g.exec(r[0]),!n||n.length<3)return null;e=parseInt(n[1]),s=n[2],n.length>3&&(l=n[3])}else if(r.length<4)e=parseInt(r[0]),s=r[1].trim(),r.length>2&&(l=r[2].trim());else throw new Error("Too many arguments for "+c);return s==="F"||s==="f"?o=6:s==="%"?o=1:o=parseInt(s),c==="zdicedev"&&o--,l?this.evaluate(Math.sqrt((o*o-1)/12*e)+l):""+Math.sqrt((o*o-1)/12*e);case"color":if(r=this.parseInline(n[2]).split(","),r.length===0)throw new Error("Missing arguments for color");if(r.length===1){if(r[0]==="bold")return"370";if(e=ee(r[0]),e===-1)throw new Error("Invalid fore color");return e.toString()}else if(r.length===2){if(r[0]==="bold")e=370;else{if(e=ee(r[0]),e===-1)throw new Error("Invalid fore color");if(r[1]==="bold")return(e*10).toString()}if(s=e.toString(),e=ee(r[1],!0),e===-1)throw new Error("Invalid back color");return s+","+e.toString()}else if(r.length===3){if(r[0]==="bold"&&(r.shift(),r.push("bold")),r[2]!=="bold")throw new Error("Only bold is supported as third argument for color");if(e=ee(r[0]),e===-1)throw new Error("Invalid fore color");if(s=(e*10).toString(),e=ee(r[1],!0),e===-1)throw new Error("Invalid back color");return s+","+e.toString()}throw new Error("Too many arguments");case"zcolor":if(r=this.parseInline(n[2]).split(","),r.length===0)throw new Error("Missing arguments for zcolor");if(r.length>1)throw new Error("Too many arguments for zcolor");return Yt(parseInt(r[0],10));case"ansi":if(r=this.parseInline(n[2]).split(","),r.length===0)throw new Error("Missing arguments for ansi");for(e=r.length,l=[],a={},s=0;s<e;s++)if(r[s].trim()==="current")l.push(r[s].trim());else{if(o=Me(r[s].trim()),o===-1)throw new Error("Invalid color or style for ansi");o>=0&&o<30?a[o]=1:l.push(r[s])}if(l.length>2)throw new Error("Too many colors for ansi");if(l.length>1&&(l[1]==="current"?l[1]="":l[1]=Me(l[1],!0)),l.length>0&&(a[1]&&l[0]==="white"||l[0]==="current"?l[0]="":l[0]=Me(l[0])),a=[...Object.keys(a),...l],!a.length)throw new Error("Invalid colors or styles for ansi");return a=a.filter(v=>v!==""),`\x1B[${a.join(";")}m`;case"random":if(r=this.parseInline(n[2]).split(","),r.length===0)throw new Error("Invalid random");if(r.length===1)return ft().randomInt(0,parseInt(r[0],10)+1);if(r.length===2)return ft().randomInt(parseInt(r[0],10),parseInt(r[1],10)+1);throw new Error("Too many arguments for random");case"case":if(r=this.splitByQuotes(this.parseInline(n[2]),","),r.length===0)throw new Error("Missing arguments for case");return e=this.evaluate(this.parseInline(r[0])),typeof e!="number"?"":e>0&&e<r.length?this.stripQuotes(r[e]):"";case"switch":if(r=this.splitByQuotes(this.parseInline(n[2]),","),r.length===0)throw new Error("Missing arguments for switch");if(r.length%2===1)throw new Error("All expressions must have a value for switch");for(s=r.length,e=0;e<s;e+=2)if(this.evaluate(r[e]))return this.stripQuotes(r[e+1]);return"";case"if":if(r=this.splitByQuotes(this.parseInline(n[2]),","),r.length<3)throw new Error("Missing arguments for if");if(r.length!==3)throw new Error("Too many arguments for if");return this.evaluate(r[0])?this.stripQuotes(r[1].trim()):this.stripQuotes(r[2].trim());case"ascii":if(r=this.parseInline(n[2]).split(","),r.length===0)throw new Error("Missing arguments for ascii");if(r.length>1)throw new Error("Too many arguments for ascii");if(r[0].trim().length===0)throw new Error("Invalid argument, empty string for ascii");return r[0].trim().charCodeAt(0);case"char":if(r=this.parseInline(n[2]).split(","),r.length===0)throw new Error("Missing arguments for char");if(r.length>1)throw new Error("Too many arguments for char");if(e=parseInt(r[0],10),isNaN(e))throw new Error("Invalid argument '"+r[0]+"' must be a number for char");return String.fromCharCode(e);case"begins":if(r=this.splitByQuotes(this.parseInline(n[2]),","),r.length<2)throw new Error("Missing arguments for begins");if(r.length>2)throw new Error("Too many arguments for begins");return this.stripQuotes(r[0]).startsWith(this.stripQuotes(r[1]));case"ends":if(r=this.splitByQuotes(this.parseInline(n[2]),","),r.length<2)throw new Error("Missing arguments for ends");if(r.length>2)throw new Error("Too many arguments for ends");return this.stripQuotes(r[0]).endsWith(this.stripQuotes(r[1]));case"len":return this.stripQuotes(this.parseInline(n[2])).length;case"stripansi":let S=new RegExp("[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)|(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-nq-uy=><~]))","g");return this.stripQuotes(this.parseInline(n[2])).replace(S,"");case"pos":if(r=this.splitByQuotes(this.parseInline(n[2]),","),r.length<2)throw new Error("Missing arguments for pos");if(r.length>2)throw new Error("Too many arguments for pos");return this.stripQuotes(r[1]).indexOf(this.stripQuotes(r[0]))+1;case"ipos":if(r=this.splitByQuotes(this.parseInline(n[2]),","),r.length<2)throw new Error("Missing arguments for ipos");if(r.length>2)throw new Error("Too many arguments for ipos");return this.stripQuotes(r[1]).toLowerCase().indexOf(this.stripQuotes(r[0]).toLowerCase())+1;case"regex":if(r=this.splitByQuotes(n[2],","),r.length<2)throw new Error("Missing arguments for regex");if(e=new RegExp(this.stripQuotes(r[1]),"gd"),e=e.exec(this.stripQuotes(this.parseInline(r[0]))),r.shift(),r.shift(),e==null||e.length===0)return 0;if(r.length){for(s=1;s<e.length&&r.length;s++)this.client.variables[this.stripQuotes(this.parseInline(r[0]))]=e[s],r.shift();r.length&&(this.client.variables[this.stripQuotes(this.parseInline(r[0]))]=e[0].length)}return e.indices[0]?e.indices[0][0]+1:1;case"trim":return this.stripQuotes(this.parseInline(n[2])).trim();case"trimleft":return this.stripQuotes(this.parseInline(n[2])).trimLeft();case"trimright":return this.stripQuotes(this.parseInline(n[2])).trimRight();case"bitand":if(r=this.parseInline(n[2]).split(","),r.length===0)throw new Error("Missing arguments for bitand");if(r.length!==2)throw new Error("Too many arguments for bitand");if(e=parseInt(r[0],10),isNaN(e))throw new Error("Invalid argument '"+r[0]+"' must be a number for bitand");if(s=parseInt(r[1],10),isNaN(s))throw new Error("Invalid argument '"+r[1]+"' must be a number for bitand");return e&s;case"bitnot":if(r=this.parseInline(n[2]).split(","),r.length===0)throw new Error("Missing arguments for bitnot");if(r.length!==1)throw new Error("Too many arguments for bitnot");if(e=parseInt(r[0],10),isNaN(e))throw new Error("Invalid argument '"+r[0]+"' must be a number for bitnot");return~e;case"bitor":if(r=this.parseInline(n[2]).split(","),r.length===0)throw new Error("Missing arguments for bitor");if(r.length!==2)throw new Error("Too many arguments for bitor");if(e=parseInt(r[0],10),isNaN(e))throw new Error("Invalid argument '"+r[0]+"' must be a number for bitor");if(s=parseInt(r[1],10),isNaN(s))throw new Error("Invalid argument '"+r[1]+"' must be a number for bitor");return e|s;case"bitset":if(r=this.parseInline(n[2]).split(","),r.length===0)throw new Error("Missing arguments for bitset");if(r.length>3)throw new Error("Too many arguments for bitset");if(e=parseInt(r[0],10),isNaN(e))throw new Error("Invalid argument '"+r[0]+"' must be a number for bitset");if(s=parseInt(r[1],10),isNaN(s))throw new Error("Invalid argument '"+r[1]+"' must be a number for bitset");if(s--,l=1,r.length===3&&(l=parseInt(r[2],10),isNaN(l)))throw new Error("Invalid argument '"+r[2]+"' must be a number for bitset");return e&~(1<<s)|(l?1:0)<<s;case"bitshift":if(r=this.parseInline(n[2]).split(","),r.length===0)throw new Error("Missing arguments for bitshift");if(r.length!==2)throw new Error("Too many arguments for bitshift");if(e=parseInt(r[0],10),isNaN(e))throw new Error("Invalid argument '"+r[0]+"' must be a number for bitshift");if(s=parseInt(r[1],10),isNaN(s))throw new Error("Invalid argument '"+r[1]+"' must be a number for bitshift");return s<0?e>>-s:e<<s;case"bittest":if(r=this.parseInline(n[2]).split(","),r.length===0)throw new Error("Missing arguments for bittest");if(r.length!==2)throw new Error("Too many arguments for bittest");if(e=parseInt(r[0],10),isNaN(e))throw new Error("Invalid argument '"+r[0]+"' must be a number for bittest");if(s=parseInt(r[1],10),isNaN(s))throw new Error("Invalid argument '"+r[1]+"' must be a number for bittest");return s--,(e>>s)%2!=0?1:0;case"bitxor":if(r=this.parseInline(n[2]).split(","),r.length===0)throw new Error("Missing arguments for bitxor");if(r.length!==2)throw new Error("Too many arguments for bitxor");if(e=parseInt(r[0],10),isNaN(e))throw new Error("Invalid argument '"+r[0]+"' must be a number for bitxor");if(s=parseInt(r[1],10),isNaN(s))throw new Error("Invalid argument '"+r[1]+"' must be a number for bitxor");return e^s;case"number":if(r=this.splitByQuotes(this.parseInline(n[2]),","),r.length===0)throw new Error("Missing arguments for number");if(r.length>1)throw new Error("Too many arguments for number");return r[0]=this.stripQuotes(r[0],!0),r[0].match(/^\s*?[-|+]?\d+\s*?$/)?parseInt(r[0],10):r[0].match(/^\s*?[-|+]?\d+\.\d+\s*?$/)?parseFloat(r[0]):r[0]==="true"?1:(r[0]==="false",0);case"isfloat":if(r=this.splitByQuotes(this.parseInline(n[2]),","),r.length===0)throw new Error("Missing arguments for isfloat");if(r.length>1)throw new Error("Too many arguments for isfloat");return r[0].match(/^\s*?[-|+]?\d+\.\d+\s*?$/)?1:0;case"isnumber":if(r=this.splitByQuotes(this.parseInline(n[2]),","),r.length===0)throw new Error("Missing arguments for isnumber");if(r.length>1)throw new Error("Too many arguments for isnumber");return r[0].match(/^\s*?[-|+]?\d+\s*?$/)||r[0].match(/^\s*?[-|+]?\d+\.\d+\s*?$/)?1:0;case"string":if(r=this.splitByQuotes(this.parseInline(n[2]),","),r.length===0)throw new Error("Missing arguments for string");if(r.length>1)throw new Error("Too many arguments for string");return`"${this.stripQuotes(r[0]),!0}"`;case"float":if(r=this.splitByQuotes(this.parseInline(n[2]),","),r.length===0)throw new Error("Missing arguments for float");if(r.length>1)throw new Error("Too many arguments for float");return r[0]=this.stripQuotes(r[0],!0),r[0].match(/^\s*?[-|+]?\d+\s*?$/)||r[0].match(/^\s*?[-|+]?\d+\.\d+\s*?$/)?parseFloat(r[0]):r[0]==="true"?1:(r[0]==="false",0);case"isdefined":if(r=this.splitByQuotes(this.parseInline(n[2]),","),r.length===0)throw new Error("Missing arguments for isdefined");if(r.length>1)throw new Error("Too many arguments for isdefined");return r[0]=this.stripQuotes(r[0],!0),this.client.variables.hasOwnProperty(r[0])?1:0;case"defined":if(r=this.splitByQuotes(this.parseInline(n[2]),","),r.length===0)throw new Error("Missing arguments for defined");if(r.length===1){r[0]=this.stripQuotes(r[0],!0);let v=this.client.profiles.keys,d=0,b=v.length;if(b===0)return 0;for(;d<b;d++)if(s=U(this.client.profiles.items[v[d]].aliases),s=s.find(L=>L.pattern===r[0]),s||(s=U(this.client.profiles.items[v[d]].triggers),s=s.find(L=>L.pattern===r[0]||L.name===r[0]),s)||(s=U(this.client.profiles.items[v[d]].macros),s=s.find(L=>Ye(L).toLowerCase()===r[0].toLowerCase()||L.name===r[0]),s)||(s=U(this.client.profiles.items[v[d]].aliases),s=s.find(L=>L.caption===r[0]||L.name===r[0]),s))return 1;return this.client.variables.hasOwnProperty(r[0])}else if(r.length===2){r[0]=this.stripQuotes(r[0],!0),r[1]=this.stripQuotes(r[1],!0).toLowerCase();let v=this.client.profiles.keys,d=0,b=v.length;if(b===0)return 0;for(;d<b;d++)switch(r[1]){case"alias":return s=U(this.client.profiles.items[v[d]].aliases),s=s.find(L=>L.pattern===r[0]),s?1:0;case"event":return s=U(this.client.profiles.items[v[d]].triggers),s=s.find(L=>L.type===2&&(L.pattern===r[0]||L.name===r[0])),s?1:0;case"trigger":return s=U(this.client.profiles.items[v[d]].triggers),s=s.find(L=>L.pattern===r[0]||L.name===r[0]),s?1:0;case"macro":return s=U(this.client.profiles.items[v[d]].macros),s=s.find(L=>Ye(L).toLowerCase()===r[0].toLowerCase()||L.name===r[0]),s?1:0;case"button":return s=U(this.client.profiles.items[v[d]].aliases),s=s.find(L=>L.caption===r[0]||L.name===r[0]),s?1:0}if(r[1]==="variable")return this.client.variables.hasOwnProperty(r[0])}else throw new Error("Too many arguments for defined");return 0;case"escape":return r=this.stripQuotes(this.parseInline(n[2])),this.client.getOption("allowEscape")?(e=f,f==="\\"&&(e+=f),this.client.getOption("parseDoubleQuotes")&&(e+='"'),this.client.getOption("parseSingleQuotes")&&(e+="'"),this.client.getOption("commandStacking")&&(e+=this.client.getOption("commandStackingChar")),this.client.getOption("enableSpeedpaths")&&(e+=this.client.getOption("speedpathsChar")),this.client.getOption("enableCommands")&&(e+=this.client.getOption("commandChar")),this.client.getOption("enableVerbatim")&&(e+=this.client.getOption("verbatimChar")),this.client.getOption("enableDoubleParameterEscaping")&&(e+=this.client.getOption("parametersChar")),this.client.getOption("enableNParameters")&&(e+=this.client.getOption("nParametersChar")),r.replace(new RegExp(`[${e}]`,"g"),f+"$&")):r.replace(/[\\"']/g,"$&");case"unescape":return r=this.stripQuotes(this.parseInline(n[2])),this.client.getOption("allowEscape")?(e=f,f==="\\"&&(e+=f),this.client.getOption("parseDoubleQuotes")&&(e+='"'),this.client.getOption("parseSingleQuotes")&&(e+="'"),this.client.getOption("commandStacking")&&(e+=this.client.getOption("commandStackingChar")),this.client.getOption("enableSpeedpaths")&&(e+=this.client.getOption("speedpathsChar")),this.client.getOption("enableCommands")&&(e+=this.client.getOption("commandChar")),this.client.getOption("enableVerbatim")&&(e+=this.client.getOption("verbatimChar")),this.client.getOption("enableDoubleParameterEscaping")&&(e+=this.client.getOption("parametersChar")),this.client.getOption("enableNParameters")&&(e+=this.client.getOption("nParametersChar")),f==="\\"?r.replace(new RegExp(`\\\\[${e}]`,"g"),v=>v.substr(1)):r.replace(new RegExp(`${f}[${e}]`,"g"),v=>v.substr(1))):r.replace(/\\[\\"']/g,v=>v.substr(1));case"alarm":if(r=this.splitByQuotes(this.parseInline(n[2]),","),r.length===0)throw new Error("Missing arguments for alarm");if(r.length>3)throw new Error("Too many arguments for alarm");if(r[0]=this.stripQuotes(r[0]),s=this.client.alarms,o=s.length,o===0)throw new Error("No alarms set.");if(e=0,r.length===1){for(;e<o;e++)if(s[e].type===3&&(s[e].name===r[0]||s[e].pattern===r[0]))return s[e].suspended?0:this.client.getRemainingAlarmTime(e)}else if(r.length===2)if(l=parseInt(r[1],10),isNaN(l)){for(r[1]=this.stripQuotes(r[1].trim());e<o;e++)if(s[e].type===3&&(s[e].name===r[0]||s[e].pattern===r[0])){if(s[e].profile.name.toUpperCase()!==r[1].toUpperCase())continue;return s[e].suspended?0:this.client.getRemainingAlarmTime(e)}throw Error("Alarm not found in profile: "+r[1]+".")}else{for(;e<o;e++)if(s[e].type===3&&(s[e].name===r[0]||s[e].pattern===r[0]))return s[e].suspended||this.client.setAlarmTempTime(e,l),l;throw Error("Alarm not found.")}else if(r.length===3){if(l=parseInt(r[1],10),isNaN(l))throw new Error("Invalid time for alarm");for(r[2]=this.stripQuotes(r[2].trim());e<o;e++)if(s[e].type===3&&(s[e].name===r[0]||s[e].pattern===r[0])){if(s[e].profile.name.toUpperCase()!==r[2].toUpperCase())continue;return s[e].suspended||this.client.setAlarmTempTime(e,l),l}throw Error("Could not set time, alarm not found in profile: "+r[2]+".")}return 0;case"state":if(r=this.splitByQuotes(this.parseInline(n[2]),","),r.length===0)throw new Error("Missing arguments for state");if(r.length>2)throw new Error("Too many arguments for state");if(r[0]=this.stripQuotes(r[0]),l=null,r.length===1){let v=this.client.profiles.keys,d=0,b=v.length;if(b===0)return null;if(b===1){if(!this.client.profiles.items[v[0]].enabled||!this.client.profiles.items[v[0]].enableTriggers)throw Error("No enabled profiles found!");s=U(this.client.profiles.items[v[d]].triggers),s=s.find(L=>L.name===r[0]||L.pattern===r[0])}else for(;d<b&&!(!(!this.client.profiles.items[v[d]].enabled||!this.client.profiles.items[v[d]].enableTriggers||this.client.profiles.items[v[d]].triggers.length===0)&&(s=U(this.client.profiles.items[v[d]].triggers),s=s.find(L=>L.name===r[0]||L.pattern===r[0]),s));d++);}else if(r.length===2){if(r[1]=this.stripQuotes(r[1].trim()),this.client.profiles.contains(r[1]))l=this.client.profiles.items[r[1].toLowerCase()];else throw new Error("Profile not found: "+r[1]);s=U(l.triggers),s=s.find(v=>v.name===r[0]||v.pattern===r[0])}if(s)return s.triggers&&s.triggers.length?s.state:0;throw new Error("Trigger not found");case"isnull":if(r=this.splitByQuotes(this.parseInline(n[2]),","),r.length===0)return null;if(r.length!==1)throw new Error("Too many arguments for null");return this.evaluate(r[0])===null?1:0;case"prompt":if(r=this.splitByQuotes(this.parseInline(n[2]),","),r.length===0)return window.prompt()||"";if(r.length>3)throw new Error("Too many arguments");return r=r.map(v=>this.stripQuotes(v)),window.prompt(...r)||""}let p={raw:t,name:n[1],args:n[2]&&n[2].length?this.parseOutgoing(n[2]).split(","):[],handled:!1,return:null};return this.client.emit("variable",p),p.handled?p.return:null}GetNamedArguments(t,e,i){if(t==="*")return e;if(i==null&&(i=!1),t==null||t.length===0)return i?e:[];let n=t.split(","),s=n.length,l=e.length;if(s===0)return i?e:[];let r;i?r=e.slice():r=[];for(let a=0;a<s;a++)n[a]=$.trim(n[a]),!(n[a].length<1)&&(n[a].startsWith("$")&&(n[a]=n[a].substring(1)),n[a].match(/^[a-zA-Z0-9_][a-zA-Z0-9_]+$/g)&&Re(n[a])&&(r[n[a]]||(r[n[a]]=a+1<l?e[a+1]:"")));return r}ExecuteAlias(t,e){if(!t.enabled)return;let i;if(t.value.length)switch(t.style){case 1:this._stack.push({loops:[],args:e,named:this.GetNamedArguments(t.params,e),append:t.append,used:0}),i=this.parseOutgoing(t.value,null,null,!0),this._stack.pop();break;case 2:(this.client.getOption("echo")&2)===2&&this.client.echo(t.value,-7,-8,!0,!0);let n=this.GetNamedArguments(t.params,e);n?i=Object.keys(n).map(l=>`let ${l} = this.input.stack.named["${l}"];`).join("")+`
`:i="";let s=new Function("try { "+i+t.value+`
} catch (e) { if(this.getOption('showScriptErrors')) this.error(e);}`);this._stack.push({loops:[],args:e,named:n,append:t.append,used:0});try{i=s.apply(this.client,e)}catch(l){throw l}finally{this._stack.pop()}typeof i=="string"&&(i=this.parseOutgoing(i,null,null,!0));break;default:i=t.value;break}return i==null||i===void 0||(i=this.ExecuteTriggers(17,i,i,!1,!0),i==null||i===void 0)||(typeof i!="string"&&(i=i.toString()),i.length===0&&!this.client.getOption("returnNewlineOnEmptyValue"))?null:i.endsWith(`
`)?i:i+`
`}ProcessMacros(t,e,i,n,s){if(!t||t>9&&t<19)return!1;let l=this._MacroCache[t]||(this._MacroCache[t]=Fe(this.client.macros,"key",t)),r=0,a=l.length,o=0;for(e&&(o|=2),i&&(o|=4),n&&(o|=8),s&&(o|=16);r<a;r++)if(!(!l[r].enabled||o!==l[r].modifiers)&&this.ExecuteMacro(l[r]))return!0;return!1}ExecuteMacro(t){if(!t.enabled)return!1;let e;if(t.value.length)switch(t.style){case 1:this._stack.push({loops:[],args:0,named:0,used:0});try{e=this.parseOutgoing(t.value)}catch(n){throw n}finally{this._stack.pop()}break;case 2:(this.client.getOption("echo")&2)===2&&this.client.echo(t.value,-7,-8,!0,!0);let i=new Function("try { "+t.value+`
} catch (e) { if(this.getOption('showScriptErrors')) this.error(e);}`);this._stack.push({loops:[],args:0,named:0,used:0});try{e=i.apply(this.client)}catch(n){throw n}finally{this._stack.pop()}break;default:e=t.value;break}return e==null||e===void 0?!0:(typeof e!="string"&&(e=e.toString()),e.length===0&&!this.client.getOption("returnNewlineOnEmptyValue")?null:(t.send?(e.endsWith(`
`)||(e+=`
`),t.chain&&this.client.commandInput.value.endsWith(" ")?(this.client.commandInput.value=this.client.commandInput.value+e,this.client.sendCommand(null,null,this.client.getOption("allowCommentsFromCommand"))):this.client.send(e,!0)):t.append&&(this.client.commandInput.value=this.client.commandInput.value+e),!0))}ProcessPath(t,e){if(t.length===0)return"";let i=[],n=0,s="",l="",r=0,a,o,f,p,g=0,c=t.length;for(;r<c;r++)switch(a=t.charAt(r),o=t.charCodeAt(r),n){case 1:o>47&&o<58?l+=a:a==="\\"?n=2:(n=0,s=a);break;case 2:o>47&&o<58?s+=a:(s+="\\",r--),n=0;break;case 3:g===0&&a===")"?n=0:(a==="("?g++:a===")"&&g--,s+=a);break;case 4:g===0&&a==="}"?n=0:(a==="{"?g++:a==="}"&&g--,s+=a);break;default:if(o>47&&o<58){if(s.length>0){for(l.length===0?f=1:f=parseInt(l,10),p=0;p<f;p++)i.push(s);s=""}n=1,l=a}else a==="("?(n=3,g=0):a==="{"?(n=4,g=0):a==="\\"?n=2:s+=a;break}if(s.length>0)for(l.length===0?f=1:f=parseInt(l,10),p=0;p<f;p++)i.push(s);return e&&this._pathQueue.length?this._pathQueue[0]={id:t,current:i,previous:[]}:this._pathQueue.push({id:t,current:i,previous:[]}),this.ExecutePath(),null}ExecutePath(){if(this._pathTimeout||!this._pathQueue.length||this._pathPaused)return;let t=this.client.getOption("pathDelay");t<0&&(t=0),this._pathTimeout=setTimeout(()=>{let e=this.client.getOption("parseSpeedpaths"),i=this.client.getOption("echoSpeedpaths"),n=this.client.getOption("pathDelayCount");n<1&&(n=1);let s=this._pathQueue[0];for(;n--;){let l=s.current.shift();if(s.previous.push(l),e?this.client.sendBackground(l+`
`,!i):this.client.send(l+`
`,!i),!s.current.length)break}s.current.length||this._pathQueue.shift(),this._pathTimeout=null,!(this._pathQueue.length&&this._pathQueue[0].manual)&&this.ExecutePath()},t)}toggleScrollLock(){this.scrollLock=!this.scrollLock}hasTriggerType(t,e){return e===3&&(t&32)==32||e===16&&(t&16)==16||e===1&&(t&1)==1||e===2&&(t&2)==2||e===8&&(t&8)==8||e===0&&(t&4)==4||e===128&&(t&128)==128}isSubTriggerType(t){return(t&512)==512||(t&1024)==1024||(t&4096)==4096||(t&8192)==8192||(t&16384)==16384||(t&32768)==32768||(t&65536)==65536||(t&131072)==131072||(t&262144)==262144}getTriggerType(t){return t===0?4:t===3?32:t}ExecuteTriggers(t,e,i,n,s,l){if(!this.enableTriggers||e==null)return e;s==null&&(s=!1),n==null&&(n=!1),i=i||e,this.buildTriggerCache();let r=0,a,o=!1,f,p=this._TriggerCache,g=p.length,c=this._TriggerStates,S=this._TriggerRegExCache,v;for(;r<g;r++){let d=p[r],b=d;if(d.enabled){if((!b.triggers||!b.triggers.length||d.state>b.triggers.length)&&(b.state=0),d.state!==0&&b.triggers&&b.triggers.length){for(d=b.triggers[d.state-1];!d.enabled&&b.state!==0;){if(b.state++,b.state>b.triggers.length){b.state=0,d=b;break}b.state?d=b.triggers[b.state-1]:d=b,o=!0}if(o&&(this.client.getOption("saveTriggerStateChanges")&&this.client.saveProfiles(),this.client.emit("item-updated","trigger",b.profile.name,b.profile.triggers.indexOf(b),b)),!d.enabled)continue}if(v=this.getTriggerType(d.type),!(d.type!==void 0&&(t&v)!==v&&(!l||l&&!this.isSubTriggerType(d.type)))&&d.type!==65536&&!(n&&!d.triggerPrompt)&&!(!n&&!d.triggerNewline&&d.triggerNewline!==void 0)){if(c[r]){if(c[r].type===1024){if(c[r].time>Date.now())continue;delete c[r]}else if(c[r].type===16384){if(c[r].time<Date.now()){delete c[r],this.advanceTrigger(d,b,r),c[r]?c[r].reParse=!0:c[r]={reParse:!0},r=this.cleanUpTriggerState(r);continue}}else if(c[r].type===512){if(c[r].lineCount>0)continue;delete c[r]}else if(c[r].type===8192){if(c[r].lineCount<1){this.advanceTrigger(d,b,r),c[r]?c[r].reParse=!0:c[r]={reParse:!0},r=this.cleanUpTriggerState(r);continue}}else if(c[r].type===32768&&c[r].lineCount<1){this.advanceTrigger(d,b,r),c[r]?c[r].reParse=!0:c[r]={reParse:!0},r=this.cleanUpTriggerState(r);continue}}try{if(d.type===128)if(this.evaluate(this.parseInline(d.pattern))){if(c[r]){if(c[r].loop!==-1&&c[r].lineCount<1)continue}else{let L=this.createTriggerState(d,!1,b);L&&(c[r]=L)}this._LastTriggered=d.raw?i:e,f=this.ExecuteTrigger(d,[this._LastTriggered],s,r,[this._LastTriggered],0,b)}else{this.advanceTrigger(d,b,r);continue}else if(d.verbatim){if(!d.caseSensitive&&(d.raw?i:e).toLowerCase()!==d.pattern.toLowerCase()){!c[r]&&(d.type===131072||d.type===262144)&&(this.advanceTrigger(d,b,r),r=this.cleanUpTriggerState(r));continue}else if(d.caseSensitive&&(d.raw?i:e)!==d.pattern){!c[r]&&(d.type===131072||d.type===262144)&&(this.advanceTrigger(d,b,r),r=this.cleanUpTriggerState(r));continue}this._LastTriggered=d.raw?i:e,f=this.ExecuteTrigger(d,[this._LastTriggered],s,r,[this._LastTriggered],0,b)}else{let L;d.type===8||d.type===16||d.type===262144?a=tt(d.pattern,this.client):a=d.pattern,d.caseSensitive?L=S["g"+a]||(S["g"+a]=new RegExp(a,"gd")):L=S["gi"+a]||(S["gi"+a]=new RegExp(a,"gid")),L.lastIndex=0;let P=L.exec(d.raw?i:e);if(!P||!P.length){!c[r]&&(d.type===131072||d.type===262144)&&(this.advanceTrigger(d,b,r),r=this.cleanUpTriggerState(r));continue}let _;this._LastTriggered=d.raw?i:e,(d.raw?i:e)===P[0]||!this.client.getOption("prependTriggeredLine")?_=P:(_=[this._LastTriggered,...P],_.indices=[[0,_[0].length],...P.indices]),P.groups&&Object.keys(P.groups).map(j=>this.client.variables[j]=P.groups[j]),f=this.ExecuteTrigger(d,_,s,r,[this._LastTriggered,L],P.groups,b)}if(c[r]&&c[r].reParse)!c[r].type||c[r].type===131072||c[r].type===262144?delete c[r]:delete c[r].reParse,r--;else if(s)return f}catch(L){this.client.getOption("disableTriggerOnError")&&(d.enabled=!1,setTimeout(()=>{this.client.saveProfiles(),this.emit("item-updated","trigger",b.profile,b.profile.triggers.indexOf(b),b)})),this.client.getOption("showScriptErrors")?this.client.error(L):this.client.debug(L)}}}}return e}TestTrigger(t,e,i,n,s,l){let r,a;try{if(t.verbatim){if(!t.caseSensitive&&(t.raw?s:n).toLowerCase()!==t.pattern.toLowerCase())return this._TriggerStates[i]||(this.advanceTrigger(t,e,i),i=this.cleanUpTriggerState(i)),i;if(t.caseSensitive&&(t.raw?s:n)!==t.pattern)return this._TriggerStates[i]||(this.advanceTrigger(t,e,i),i=this.cleanUpTriggerState(i)),i;this._LastTriggered=t.raw?s:n,r=this.ExecuteTrigger(t,[this._LastTriggered],!1,i,[this._LastTriggered],0,e)}else{let o;t.type===8||t.type===16||t.type===262144?a=tt(t.pattern,this.client):a=t.pattern,t.caseSensitive?o=this._TriggerRegExCache["g"+a]||(this._TriggerRegExCache["g"+a]=new RegExp(a,"gd")):o=this._TriggerRegExCache["gi"+a]||(this._TriggerRegExCache["gi"+a]=new RegExp(a,"gid")),o.lastIndex=0;let f=o.exec(t.raw?s:n);if(!f||!f.length)return!this._TriggerStates[i]&&(t.type===131072||t.type===262144)&&(this.advanceTrigger(t,e,i),i=this.cleanUpTriggerState(i)),i;let p;this._LastTriggered=t.raw?s:n,(t.raw?s:n)===f[0]||!this.client.getOption("prependTriggeredLine")?p=f:(p=[this._LastTriggered,...f],p.indices=[[0,p[0].length],...f.indices]),f.groups&&Object.keys(f.groups).map(g=>this.client.variables[g]=f.groups[g]),r=this.ExecuteTrigger(t,p,!1,i,[this._LastTriggered,o],f.groups,e)}i=this.cleanUpTriggerState(i)}catch(o){this.client.getOption("disableTriggerOnError")&&(t.enabled=!1,setTimeout(()=>{this.client.saveProfiles(),this.emit("item-updated","trigger",e.profile,e.profile.triggers.indexOf(e),e)})),this.client.getOption("showScriptErrors")?this.client.error(o):this.client.debug(o)}return i}ExecuteTrigger(t,e,i,n,s,l,r){if(i==null&&(i=!1),!t.enabled)return"";if(this._TriggerStates[n]&&this._TriggerStates[n].type===16384&&delete this._TriggerStates[n],t.fired)return t.fired=!1,this.advanceTrigger(t,r,n),this._TriggerStates[n]?this._TriggerStates[n].reParse=!0:this._TriggerStates[n]={reParse:!0},"";this._LastTrigger=t;let a;if(t.temp)if(r.triggers.length)if(r.state===0){let o=r.triggers.shift();o.triggers=r.triggers,o.state=r.state,o.name=r.name,o.profile=r.profile,o.state>o.triggers.length&&(o.state=0),n>=0&&(this._TriggerCache[n]=o),this.client.saveProfiles();let f=r.profile.triggers.indexOf(r);r.profile.triggers[f]=o,this.client.emit("item-updated","trigger",r.profile.name,f,o)}else r.triggers.splice(r.state-1,1),r.state>r.triggers.length&&(r.state=0),this.client.saveProfiles(),this.client.emit("item-updated","trigger",r.profile.name,r.profile.triggers.indexOf(r),r);else n>=0&&this._TriggerCache.splice(n,1),this._TriggerStates[n]&&this.clearTriggerState(n),this.client.removeTrigger(r);else r.triggers.length&&this.advanceTrigger(t,r,n);if((this.client.getOption("echo")&8)===8&&this.client.echo("Trigger fired: "+t.pattern,-7,-8,!0,!0),t.value.length)switch(t.style){case 1:this._stack.push({loops:[],args:e,named:0,used:0,regex:s});try{a=this.parseOutgoing(t.value)}catch(o){throw o}finally{this._stack.pop()}break;case 2:if((this.client.getOption("echo")&2)===2&&this.client.echo(t.value,-7,-8,!0,!0),t.temp)a=new Function("try { "+t.value+`
} catch (e) { if(this.getOption('showScriptErrors')) this.error(e);}`),a=a.apply(this.client,e);else{this._TriggerFunctionCache[n]||(l?a=Object.keys(l).map(o=>`let ${o} = this.variables["${o}"];`).join("")+`
`:a="",this._TriggerFunctionCache[n]=new Function("try { "+a+t.value+`
} catch (e) { if(this.getOption('showScriptErrors')) this.error(e);}`)),this._stack.push({loops:[],args:e,named:0,used:0,regex:s,indices:e.indices});try{a=this._TriggerFunctionCache[n].apply(this.client,e)}catch(o){throw o}finally{this._stack.pop()}}typeof a=="string"&&(a=this.parseOutgoing(a));break;default:a=t.value;break}if(a==null||a===void 0)return null;if(i)return a;if(typeof a!="string"&&(a=a.toString()),a.length===0&&!this.client.getOption("returnNewlineOnEmptyValue"))return null;a.endsWith(`
`)||(a+=`
`),this.client.connected&&this.client.telnet.sendData(a),this.client.telnet.echo&&this.client.getOption("commandEcho")&&setTimeout(()=>{this.client.echo(a)},1)}advanceTrigger(t,e,i){if(this._TriggerStates[i]){if(this._TriggerStates[i].type===4096){if(this._TriggerStates[i].loop--,this._TriggerStates[i].loop>0)return;this.clearTriggerState(i)}else if(this._TriggerStates[i].type===8192){if(this._TriggerStates[i].lineCount>0)return;this.clearTriggerState(i)}else if(this._TriggerStates[i].type===32768)this.clearTriggerState(i);else if(this._TriggerStates[i].type===128&&(this._TriggerStates[i].loop===-1||this._TriggerStates[i].lineCount>0))return}if(e.state++,e.state>e.triggers.length&&(e.state=0),this.client.getOption("saveTriggerStateChanges")&&this.client.saveProfiles(),this.client.emit("item-updated","trigger",e.profile.name,e.profile.triggers.indexOf(e),e),e.state!==0){let n=this.createTriggerState(e.triggers[e.state-1]);n&&(this._TriggerStates[i]=n)}}createTriggerState(t,e,i){let n,s;switch(t.type){case 131072:case 262144:s={reParse:!0};break;case 16384:case 1024:n=t.params,n&&n.length?(n=parseInt(n,10),isNaN(n)&&(n=0)):n=0,s={time:Date.now()+n};break;case 32768:case 8192:case 512:n=t.params,n&&n.length?(n=parseInt(n,10),isNaN(n)&&(n=1)):n=1,s={lineCount:n+1};break;case 4096:n=t.params,n&&n.length?(n=parseInt(n,10),isNaN(n)&&(n=0)):n=0,s={loop:n};break;case 128:n=t.params,n&&n.length?(n=parseInt(n,10),isNaN(n)&&(n=1),i===t?s={lineCount:n-1}:s={lineCount:n}):s={loop:-1};break}return s&&(s.type=t.type),!s&&e?{reParse:!0}:(e&&(s.reparse=!0),s)}updateTriggerState(t,e){if(!this._TriggerStates[e])return;let i;switch(this._TriggerStates[e].type){case 1024:case 16384:i=t.params,i&&i.length?(i=parseInt(i,10),isNaN(i)&&(i=0)):i=0,this._TriggerStates[e].time=Date.now()+i;break;case 32768:case 512:case 8192:i=t.params,i&&i.length?(i=parseInt(i,10),isNaN(i)&&(i=0)):i=0,this._TriggerStates[e].lineCount=i;break;case 4096:i=t.params,i&&i.length?(i=parseInt(i,10),isNaN(i)&&(i=0)):i=0,this._TriggerStates[e].loop=i;break;case 128:i=t.params,i&&i.length?(i=parseInt(i,10),isNaN(i)&&(i=1),this._TriggerStates[e].lineCount=i+1):this._TriggerStates[e].loop=-1;break}}getTriggerState(t){return this._TriggerStates[t]}cleanUpTriggerState(t){return this._TriggerStates[t]&&this._TriggerStates[t].reParse&&(!this._TriggerStates[t].type||this._TriggerStates[t].type===131072||this._TriggerStates[t].type===262144?delete this._TriggerStates[t]:delete this._TriggerStates[t].reParse,t<0?t++:t--),t}clearTriggerState(t){delete this._TriggerStates[t]}setTriggerState(t,e){this._TriggerStates[t]=e}clearTriggerCache(){this._TriggerCache=null,this._TriggerStates={},this._TriggerFunctionCache={},this._TriggerRegExCache={}}resetTriggerState(t,e,i){if(t===-1||t<0||t>=this._TriggerCache.length)return;let n=this._TriggerCache[t],s,l=n,r,a=!1;if(l.state!==0&&(n=l.triggers[l.state-1]),e===0?s=l:s=l.triggers[e-1],e===l.state)this._TriggerStates[t]?n.fired?this.clearTriggerState(t):this.updateTriggerState(n,t):n.fired||this.updateTriggerState(n,t);else if(this._TriggerStates[t]&&(!this._TriggerStates[t].type||this._TriggerStates[t].type!==262144&&this._TriggerStates[t].type!==131072)&&(a=this._TriggerStates[t].reParse),this.clearTriggerState(t),n.fired)this._TriggerStates[t]={reParse:!0};else{let o=this.createTriggerState(n,a);o&&(this._TriggerStates[t]=o)}}buildTriggerCache(){this._TriggerCache==null&&(this._TriggerCache=$.grep(this.client.triggers,t=>{if(t&&t.enabled&&t.triggers.length){if(t.type!==3)return!0;for(let e=0,i=t.triggers.length;e<i;e++)if(t.triggers[e].enabled&&t.triggers[e].type!==3)return!0;return!1}return t.enabled&&t.type!==3}))}clearCaches(){this._TriggerCache=null,this._TriggerStates={},this._TriggerFunctionCache={},this._TriggerRegExCache={},this._gamepadCaches=null,this._lastSuspend=-1,this._MacroCache={}}triggerEvent(t,e){if(!this.enableTriggers)return;this.buildTriggerCache();let i=0;e?Array.isArray(e)?e.unshift(t):e=[t,e]:e=[t];let n=this._TriggerCache.length;for(;i<n;i++){let s=this._TriggerCache[i],l=s,r=!1;if(s.enabled){if(s.state>l.triggers.length&&(s.state=0),s.state!==0&&l.triggers&&l.triggers.length){for(s=l.triggers[s.state-1];!s.enabled&&l.state!==0;){if(l.state++,l.state>l.triggers.length){l.state=0,s=l;break}l.state?s=l.triggers[l.state-1]:s=l,r=!0}if(r&&(this.client.getOption("saveTriggerStateChanges")&&this.client.saveProfiles(),this.client.emit("item-updated","trigger",l.profile.name,l.profile.triggers.indexOf(l),l)),!s.enabled)continue}if(s.type===131072||s.type===262144){let a=this.adjustLastLine(this.client.display.lines.length,!0),o=this.client.display.lines[a];i=this.TestTrigger(s,l,i,o,this.client.display.lines[a].raw||o,a===this.client.display.lines.length-1);continue}s.type===2&&(s.caseSensitive&&t!==s.pattern||!s.caseSensitive&&t.toLowerCase()!==s.pattern.toLowerCase()||(this._LastTriggered=t,this.ExecuteTrigger(s,e,!1,i,0,0,l),i=this.cleanUpTriggerState(i)))}}}executeWait(t,e,i,n,s,l,r){if(!t||t.length===0)return;let a={loops:this.loops.splice(0),args:0,named:0,used:this.stack.used,append:this.stack.append};this.stack.args&&(a.args=this.stack.args.slice()),this.stack.named&&(a.named=this.stack.named.slice()),e<0&&(e=0),setTimeout(()=>{this._stack.push(a);let o=this.parseOutgoing(t,i,n,s,l,r);this._stack.pop(),!(o==null||typeof o>"u"||o.length===0)&&(o.endsWith(`
`)||(o=o+`
`),this.client.send(o,!0))},e)}buildScript(t){if(!t)return"";let e;this.client.getOption("commandStacking")&&this.client.getOption("commandStackingChar")&&this.client.getOption("commandStackingChar").length>0?e=t.splitQuote(`
`+this.client.getOption("commandStackingChar")):e=t.splitQuote(`
`);let i=0,n=e.length,s=[],l=[],r=this.client.getOption("commandChar");for(;i<n;i++)e[i].trim().startsWith(r+"wait ")?(s.push("setTimeout(()=> {"),l.unshift(parseInt(e[i].trim().substr(5),10)||0)):(s.push("client.sendCommand('"),s.push(e[i]),s.push("\\n');"));let a=l.length;for(i=0;i<a;i++)s.push("}, "),s.push(l[i]),s.push(");");return s.join("")}stripQuotes(t,e,i){return!t||t.length===0||((e||this.client.getOption("parseDoubleQuotes"))&&(t=t.replace(/^\"(.*)\"$/g,(n,s,l)=>s.replace(/\\\"/g,'"'))),(i||this.client.getOption("parseSingleQuotes"))&&(t=t.replace(/^\'(.*)\'$/g,(n,s,l)=>s.replace(/\\\'/g,"'")))),t}splitByQuotes(t,e,i,n){let s=0,l=0;return!t||t.length===0?[]:((i||this.client.getOption("parseDoubleQuotes"))&&(s|=2,l|=this.client.getOption("allowEscape")?2:0),(n||this.client.getOption("parseSingleQuotes"))&&(s|=1,l|=this.client.getOption("allowEscape")?1:0),vt(t,e,s,l,this.client.getOption("escapeChar")))}createTrigger(t,e,i,n,s,l){let r,a,o=!0,f=!1;if(!t&&!s)throw new Error(`Trigger '${s||""}' not found`);if(i){if(typeof i=="string"){if(this.client.profiles.contains(i.toLowerCase()))i=this.client.profiles.items[i.toLowerCase()];else throw new Error("Profile not found: "+i);if(l)if(s)r=i.findAny("triggers",{name:s,pattern:s});else{if(!i.triggers.length)throw new Error("No triggers exist");r=i.triggers[i.triggers.length-1]}else s!==null?r=i.find("triggers","name",s):r=i.find("triggers","pattern",t)}}else{let p=this.client.profiles.keys,g=0,c=p.length;if(c===0)return;if(c===1){if(!this.client.profiles.items[p[0]].enabled||!this.client.profiles.items[p[0]].enableTriggers)throw Error("No enabled profiles found!");if(i=this.client.profiles.items[p[0]],l)if(s)r=this.client.profiles.items[p[g]].findAny("triggers",{name:s,pattern:s});else{if(!this.client.profiles.items[p[g]].triggers.length)throw new Error("No triggers exist");r=this.client.profiles.items[p[g]].triggers[this.client.profiles.items[p[g]].triggers.length-1]}else s!==null?r=this.client.profiles.items[p[g]].find("triggers","name",s):r=this.client.profiles.items[p[g]].find("triggers","pattern",t)}else{for(;g<c;g++)if(!(!this.client.profiles.items[p[g]].enabled||!this.client.profiles.items[p[g]].enableTriggers||this.client.profiles.items[p[g]].triggers.length===0)){if(l)if(s)r=this.client.profiles.items[p[g]].findAny("triggers",{name:s,pattern:s});else{if(!this.client.profiles.items[p[g]].triggers.length)throw new Error("No triggers exist");r=this.client.profiles.items[p[g]].triggers[this.client.profiles.items[p[g]].triggers.length-1]}else s!==null?r=this.client.profiles.items[p[g]].find("triggers","name",s):r=this.client.profiles.items[p[g]].find("triggers","pattern",t);if(r){i=this.client.profiles.items[p[g]];break}}i||(i=this.client.activeProfile)}}if(l){if(!r)throw new Error(`Trigger '${s||""}' not found`);if(a=new we,a.pattern=t,o=!1,t!==null&&(a.pattern=t),e!==null&&(a.value=e),n&&(n.cmd&&(a.type=1),n.pattern&&(a.type=8),n.regular&&(a.type=0),n.alarm&&(a.type=3),n.event&&(a.type=2),n.cmdpattern&&(a.type=16),n.loopexpression&&(a.type=128),n.reparse&&(a.type=131072),n.reparsepattern&&(a.type=262144),n.manual&&(a.type=65536),n.skip&&(a.type=512),n.looplines&&(a.type=8192),n.looppattern&&(a.type=4096),n.wait&&(a.type=1024),n.duration&&(a.type=16384),n.withinlines&&(a.type=32768),n.prompt&&(a.triggerPrompt=!0),n.nocr&&(a.triggerNewline=!1),n.case&&(a.caseSensitive=!0),n.raw&&(a.raw=!0),n.verbatim&&(a.verbatim=!0),n.disable?a.enabled=!1:n.enable&&(a.enabled=!0),(n.temporary||n.temp)&&(a.temp=!0),n.params&&(a.params=n.params),n.type))if(this.isTriggerType(n.type))a.type=this.convertTriggerType(n.type);else throw new Error("Invalid trigger type");r.triggers.push(a),this.client.echo("Trigger sub state added.",-7,-8,!0,!0)}else{if(r)this.client.echo("Trigger updated.",-7,-8,!0,!0);else{if(!t)throw new Error(`Trigger '${s||""}' not found`);r=new we,r.name=s||"",r.pattern=t,i.triggers.push(r),this.client.echo("Trigger added.",-7,-8,!0,!0),f=!0}if(t!==null&&(r.pattern=t),e!==null&&(r.value=e),n){if(n.cmd&&(r.type=1),n.pattern&&(r.type=8),n.regular&&(r.type=0),n.alarm&&(r.type=3),n.event&&(r.type=2),n.cmdpattern&&(r.type=16),n.loopexpression&&(r.type=128),n.prompt&&(r.triggerPrompt=!0),n.nocr&&(r.triggerNewline=!1),n.case&&(r.caseSensitive=!0),n.raw&&(r.raw=!0),n.verbatim&&(r.verbatim=!0),n.disable?r.enabled=!1:n.enable&&(r.enabled=!0),(n.temporary||n.temp)&&(r.temp=!0),n.params&&(r.params=n.params),n.type)if(this.isTriggerType(n.type,1))r.type=this.convertTriggerType(n.type);else throw new Error("Invalid trigger type");r.priority=n.priority}else r.priority=0}this.client.saveProfiles(),o&&this.client.clearCache(),f?this.emit("item-added","trigger",i.name,r):this.emit("item-updated","trigger",i.name,i.triggers.indexOf(r),r),i=null}isTriggerType(t,e){switch(e||(e=3),t.replace(/ /g,"").toUpperCase()){case"REGULAREXPRESSION":case"COMMANDINPUTREGULAREXPRESSION":return(e&1)===1;case"0":case"1":case"2":case"3":case"8":case"16":case"128":case"REGULAR":case"COMMANDINPUTREGULAR":case"EVENT":case"ALARM":case"COMMAND":case"COMMANDINPUTPATTERN":case"LOOPEXPRSSION":return(e&1)===1;case"SKIP":case"512":case"WAIT":case"1024":case"LOOPPATTERN":case"4096":case"LOOPLINES":case"8192":case"DURATION":case"16384":case"WITHINLINES":case"32768":case"MANUAL":case"65536":case"REPARSE":case"131072":case"REPARSEPATTERN":case"262144":return(e&2)===2}return!1}convertTriggerType(t){switch(t.replace(/ /g,"").toUpperCase()){case"REGULAREXPRESSION":return 0;case"COMMANDINPUTREGULAREXPRESSION":return 1;case"0":case"1":case"2":case"3":case"8":case"16":case"128":return ut[parseInt(t,10)];case"REGULAR":case"COMMANDINPUTREGULAR":case"EVENT":case"ALARM":case"COMMAND":case"COMMANDINPUTPATTERN":case"LOOPEXPRSSION":return ut[t];case"512":case"1024":case"4096":case"8192":case"16384":case"32768":case"65536":case"131072":case"262144":return pt[parseInt(t,10)];case"SKIP":case"WAIT":case"LOOPPATTERN":case"LOOPLINES":case"DURATION":case"WITHINLINES":case"MANUAL":case"REPARSE":case"REPARSEPATTERN":return pt[t]}throw new Error("Invalid trigger type")}colorPosition(t,e,i,n){if(t=this.adjustLastLine(t),!n.hasOwnProperty("yStart"))this.client.display.colorSubStringByLine(t,e,i,n.xStart,n.hasOwnProperty("xEnd")&&n.xEnd>=0?n.xEnd:null);else{let s=n.hasOwnProperty("xEnd")&&n.xEnd>=0?n.xEnd:null,l=n.xStart,r=t-n.yStart,a=t;for(n.hasOwnProperty("yEnd")&&(a=t-n.yEnd);r<=a;)this.client.display.colorSubStringByLine(r,e,i,l,s),r++}}};function X(u){this.ok=!1,u.charAt(0)=="#"&&(u=u.substr(1,6)),u=u.replace(/ /g,""),u=u.toLowerCase();var h={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var t in h)u==t&&(u=h[t]);for(var e=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(o){return[parseInt(o[1],10),parseInt(o[2],10),parseInt(o[3],10)]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(o){return[parseInt(o[1],16),parseInt(o[2],16),parseInt(o[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(o){return[parseInt(o[1]+o[1],16),parseInt(o[2]+o[2],16),parseInt(o[3]+o[3],16)]}}],i=0,n=e.length;i<n;i++){var s=e[i].re,l=e[i].process,r=s.exec(u);if(r){var a=l(r);this.r=a[0],this.g=a[1],this.b=a[2],this.ok=!0}}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var o=this.r.toString(16),f=this.g.toString(16),p=this.b.toString(16);return o.length==1&&(o="0"+o),f.length==1&&(f="0"+f),p.length==1&&(p="0"+p),"#"+o+f+p}}var le=(w=>(w[w.None=0]="None",w[w.B=1]="B",w[w.BOLD=2]="BOLD",w[w.STRONG=3]="STRONG",w[w.I=4]="I",w[w.ITALIC=5]="ITALIC",w[w.EM=6]="EM",w[w.U=7]="U",w[w.UNDERLINE=8]="UNDERLINE",w[w.S=9]="S",w[w.STRIKEOUT=10]="STRIKEOUT",w[w.STRIKE=11]="STRIKE",w[w.C=12]="C",w[w.COLOR=13]="COLOR",w[w.H=14]="H",w[w.HIGH=15]="HIGH",w[w.FONT=16]="FONT",w[w.HR=17]="HR",w[w.NOBR=18]="NOBR",w[w.P=19]="P",w[w.BR=20]="BR",w[w.SBR=21]="SBR",w[w.A=22]="A",w[w.SEND=23]="SEND",w[w.EXPIRE=24]="EXPIRE",w[w.VERSION=25]="VERSION",w[w.SUPPORT=26]="SUPPORT",w[w.RESET=27]="RESET",w[w.H1=28]="H1",w[w.H2=29]="H2",w[w.H3=30]="H3",w[w.H4=31]="H4",w[w.H5=32]="H5",w[w.H6=33]="H6",w[w.V=34]="V",w[w.VAR=35]="VAR",w[w.USER=36]="USER",w[w.PASSWORD=37]="PASSWORD",w[w.Custom=38]="Custom",w[w.GAUGE=39]="GAUGE",w[w.STAT=40]="STAT",w))(le||{});var Ct=class{constructor(){this.on=!1;this.lineType=0;this.locked=!1;this.paragraph=!1;this.noBreak=!1;this.expanded=!1;this.lineExpanded=!1;this.capture=0;this.captured=[];this.gagged=!1}},Tt=class{constructor(h){this.name="";this.value="";this.description="";this.publish=!1;this.remote=!1;this.remote=h??!1}},Qt=class{constructor(h){this.name="";this.definition="";this.closeDefinition="";this.attributes={};this.attributeIndexes=[];this.tag=-1;this.flag="";this.open=!1;this.empty=!1;this.remote=!1;this.gagged=!1;this.remote=h??!1}},Lt=class{constructor(h,t,e,i){this.index=-1;this.window="";this.gag=!1;this.fore="";this.back="";this.enabled=!0;this.remote=!1;this.element="";this.definition="";this.closeDefinition="";h!=null&&(this.index=h),t!=null&&(this.fore=t),e!=null&&(this.back=e),i!=null&&(this.remote=i)}},st=class{constructor(h,t,e,i,n){this.tag=0;this.custom="";this.font=null;this.fontSize=null;this.style=0;this.fore="";this.back="";this.high=!1;this.obj=null;this.gagged=!1;this.open=!1;this.properties=null;h!=null&&(this.style=h),t!=null&&(this.fore=t),e!=null&&(this.back=e),this.high=i||!1,this.open=n||!1}},It=class extends ie{constructor(t){super();this.parsing=[];this.protocols=[["m","a","i","l","t","o"],["s","k","y","p","e"],["a","i","m"],["c","a","l","l","t","o"],["g","t","a","l","k"],["i","m"],["i","t","m","s"],["m","s","n","i","m"],["t","e","l"],["y","m","s","g","r"]];this._ColorTable=null;this._CurrentForeColor=37;this._CurrentBackColor=40;this._CurrentAttributes=0;this._SplitBuffer="";this.mxpState=new Ct;this.mxpStyles=[];this.mxpEntities={};this.mxpElements={};this.mxpLines=[];this.iMXPDefaultMode=0;this.displayControlCodes=!1;this.emulateControlCodes=!0;this.StyleVersion="";this.EndOfLine=!1;this.textLength=0;this.rawLength=0;this.enableMXP=!0;this.DefaultImgUrl="";this.enableDebug=!1;this.showInvalidMXPTags=!1;this.enableLinks=!0;this.enableMSP=!0;this.enableURLDetection=!0;this.window=new et(0,0);this.enableFlashing=!1;this.emulateTerminal=!1;this.enableBell=!0;this.display=null;this.tabWidth=8;this.busy=!1;t!=null&&(t.DefaultImageURL&&(this.DefaultImgUrl=t.DefaultImageURL),t.enableMXP!=null&&(this.enableMXP=t.enableMXP),t.enableDebug!=null&&(this.enableDebug=t.enableDebug),t.showInvalidMXPTags!=null&&(this.showInvalidMXPTags=t.showInvalidMXPTags),t.enableMSP!=null&&(this.enableMSP=t.enableMSP),t.enableURLDetection!=null&&(this.enableURLDetection=t.enableURLDetection),t.window!=null&&(this.window=t.window),t.enableFlashing!=null&&(this.enableFlashing=t.enableFlashing),t.emulateTerminal!=null&&(this.emulateTerminal=t.emulateTerminal),t.enableBell!=null&&(this.enableBell=t.enableBell),t.display!=null&&(this.display=t.display),t.enableLinks&&(this.enableLinks=t.enableLinks))}getColors(t){typeof t>"u"&&(t=this.GetCurrentStyle());let e,i,n=-1,s=-1;return t.fore.length>0?(this._CurrentAttributes&1)===1?e=this.IncreaseColor(t.fore,.5):(this._CurrentAttributes&2)===2?e=this.DecreaseColor(t.fore,.5):e=t.fore:typeof this._CurrentForeColor=="string"?e="rgb("+this._CurrentForeColor.replace(/;/g,",")+")":(e=this._CurrentForeColor,(this._CurrentAttributes&1)===1?(e>999&&(e/=1e3),e>=0&&e<99&&(e*=10),n=e,e<=-16&&(e=this.IncreaseColor(this.GetColor(e),.5))):(this._CurrentAttributes&2)===2?(e>99&&e<999&&(e/=10),e>=0&&e<999&&(e*=100),n=e,e<=-16&&(e=this.DecreaseColor(this.GetColor(e),.15))):n=e),t.high&&(typeof e=="number"?e=this.IncreaseColor(this.GetColor(e),.25):e=this.IncreaseColor(e,.25)),t.back.length>0?i=t.back:typeof this._CurrentBackColor=="string"?i="rgb("+this._CurrentBackColor.replace(/;/g,",")+")":i=s=this._CurrentBackColor,(this._CurrentAttributes&64)===64||(t.style&64)===64?{fore:i,back:e,foreCode:s,backCode:n}:{fore:e,back:i,foreCode:n,backCode:s}}getFormatBlock(t){let e=this.GetCurrentStyle(),i=this.getColors(e);return{formatType:0,offset:t,color:i.fore||0,background:i.back||0,size:e.fontSize||0,font:e.font||0,style:e.style|this._CurrentAttributes&-2,unicode:!1}}ResetColors(){this._CurrentForeColor=37,this._CurrentBackColor=40,this._CurrentAttributes=0}ProcessAnsiColorParams(t){let e=0,i=t.length,n,s;for(;e<i;e++)switch(n=+t[e]||0,n){case 0:this.ResetColors();break;case 1:this._CurrentAttributes|=1,this._CurrentAttributes&=-3;break;case 2:this._CurrentAttributes|=2,this._CurrentAttributes&=-2;break;case 3:this._CurrentAttributes|=4;break;case 4:this._CurrentAttributes|=8;break;case 5:this._CurrentAttributes|=16;break;case 6:this._CurrentAttributes|=32;break;case 7:this._CurrentAttributes|=64;break;case 8:this._CurrentAttributes|=128;break;case 9:this._CurrentAttributes|=256;break;case 21:this._CurrentAttributes|=512;break;case 22:this._CurrentAttributes&=-2,this._CurrentAttributes&=-3;break;case 23:this._CurrentAttributes&=-5;break;case 24:this._CurrentAttributes&=-9,this._CurrentAttributes&=-513;break;case 25:this._CurrentAttributes&=-17;break;case 26:this._CurrentAttributes&=-33;break;case 27:this._CurrentAttributes&=-65;break;case 28:this._CurrentAttributes&=-129;break;case 29:this._CurrentAttributes&=-257;break;case-11:case-7:case-3:case 30:case 31:case 32:case 33:case 34:case 35:case 36:case 37:this._CurrentForeColor=n;break;case 38:if(e+2<i&&t[e+1]==="5")this._CurrentForeColor=+t[e+2],isNaN(this._CurrentForeColor)?this._CurrentForeColor=37:(this._CurrentForeColor+=16,this._CurrentForeColor*=-1),e+=2;else if(e+4<i&&t[e+1]==="2"){if(n=+t[e+2]||0,n<0||n>255||(s=n+";",n=+t[e+3]||0,n<0||n>255)||(s+=n+";",n=+t[e+4]||0,n<0||n>255))continue;s+=n,this._CurrentForeColor=s,e+=4}break;case 39:this._CurrentForeColor=-1;break;case-12:case-8:case-4:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:this._CurrentBackColor=n;break;case 48:if(e+2<i&&t[e+1]==="5")this._CurrentBackColor=+t[e+2],isNaN(this._CurrentBackColor)?this._CurrentBackColor=40:(this._CurrentBackColor+=16,this._CurrentBackColor*=-1),e+=2;else if(e+4<i&&t[e+1]==="2"){if(n=+t[e+2]||0,n<0||n>255||(s=n+";",n=+t[e+3]||0,n<0||n>255)||(s+=n+";",n=+t[e+4]||0,n<0||n>255))continue;s+=n,this._CurrentBackColor=s,e+=4}break;case 49:this._CurrentBackColor=-2;break;case 53:this._CurrentAttributes|=1024;break;case 55:this._CurrentAttributes&=-1025;break;case 50:case 51:case 52:case 54:case 56:case 57:case 58:case 59:this._CurrentForeColor=n-20,this._CurrentAttributes|=1;break;case 90:case 91:case 92:case 93:case 94:case 95:case 96:case 97:this._CurrentForeColor=n;break;case 100:case 101:case 102:case 103:case 104:case 105:case 106:case 107:this._CurrentBackColor=n;break}}buildColorTable(){let t=[],e,i,n,s;for(e=0;e<6;e++)for(i=0;i<6;i++)for(n=0;n<6;n++)s=16+e*36+i*6+n,t[s]="rgb(",e>0?t[s]+=e*40+55:t[s]+="0",t[s]+=",",i>0?t[s]+=i*40+55:t[s]+="0",t[s]+=",",n>0?t[s]+=n*40+55:t[s]+="0",t[s]+=")";for(e=232;e<=255;e++)i=(e-232)*10+8,t[e]=["rgb(",i,",",i,",",i,")"].join("");t[0]="rgb(0,0,0)",t[1]="rgb(128, 0, 0)",t[2]="rgb(0, 128, 0)",t[3]="rgb(128, 128, 0)",t[4]="rgb(0, 0, 238)",t[5]="rgb(128, 0, 128)",t[6]="rgb(0, 128, 128)",t[7]="rgb(187, 187, 187)",t[8]="rgb(128, 128, 128)",t[9]="rgb(255, 0, 0)",t[10]="rgb(0, 255, 0)",t[11]="rgb(255, 255, 0)",t[12]="rgb(92, 92, 255)",t[13]="rgb(255, 0, 255)",t[14]="rgb(0, 255, 255)",t[15]="rgb(255, 255, 255)",t[256]="rgb(0, 0, 0)",t[257]="rgb(118, 0, 0)",t[258]="rgb(0, 108, 0)",t[259]="rgb(145, 136, 0)",t[260]="rgb(0, 0, 167)",t[261]="rgb(108, 0, 108)",t[262]="rgb(0, 108, 108)",t[263]="rgb(161, 161, 161)",t[264]="rgb(0, 0, 0)",t[265]="rgb(128, 0, 0)",t[266]="rgb(0, 128, 0)",t[267]="rgb(128, 128, 0)",t[268]="rgb(0, 0, 238)",t[269]="rgb(128, 0, 128)",t[270]="rgb(0, 128, 128)",t[271]="rgb(187, 187, 187)",t[272]="rgb(0,0,0)",t[273]="rgb(0, 255, 255)",t[274]="rgb(0,0,0)",t[275]="rgb(255, 255, 0)",t[276]="rgb(0, 0, 0)",t[277]="rgb(229, 229, 229)",t[278]="rgb(205, 0, 0)",t[279]="rgb(229, 229, 229)",t[280]="rgb(255,255,255)",this._ColorTable=t}GetColor(t){switch(this._ColorTable==null&&this.buildColorTable(),t){case-12:return this._ColorTable[279];case-11:return this._ColorTable[278];case-10:return this._ColorTable[280];case-8:return this._ColorTable[272];case-7:return this._ColorTable[273];case-4:return this._ColorTable[274];case-3:return this._ColorTable[275];case 49:case-2:return this._ColorTable[276];case 39:case-1:return this._ColorTable[277];case 0:case 30:return this._ColorTable[0];case 1:case 31:return this._ColorTable[1];case 2:case 32:return this._ColorTable[2];case 3:case 33:return this._ColorTable[3];case 4:case 34:return this._ColorTable[4];case 5:case 35:return this._ColorTable[5];case 6:case 36:return this._ColorTable[6];case 7:case 37:return this._ColorTable[7];case 40:return this._ColorTable[264];case 41:return this._ColorTable[265];case 42:return this._ColorTable[266];case 43:return this._ColorTable[267];case 44:return this._ColorTable[268];case 45:return this._ColorTable[269];case 46:return this._ColorTable[270];case 47:return this._ColorTable[271];case 8:case 90:case 100:case 300:case 400:return this._ColorTable[8];case 9:case 91:case 101:case 310:case 410:return this._ColorTable[9];case 10:case 92:case 102:case 320:case 420:return this._ColorTable[10];case 11:case 93:case 103:case 330:case 430:return this._ColorTable[11];case 12:case 94:case 104:case 340:case 440:return this._ColorTable[12];case 13:case 95:case 105:case 350:case 450:return this._ColorTable[13];case 14:case 96:case 106:case 360:case 460:return this._ColorTable[14];case 15:case 97:case 107:case 370:case 470:return this._ColorTable[15];case 4e3:case 3e3:return this._ColorTable[256];case 4100:case 3100:return this._ColorTable[257];case 4200:case 3200:return this._ColorTable[258];case 4300:case 3300:return this._ColorTable[259];case 4400:case 3400:return this._ColorTable[260];case 4500:case 3500:return this._ColorTable[261];case 4600:case 3600:return this._ColorTable[262];case 4700:case 3700:return this._ColorTable[263];default:return t<=-16&&(t+=16,t*=-1),t>=0&&t<281?this._ColorTable[t]:this._ColorTable[277]}}SetColor(t,e){this._ColorTable==null&&this.buildColorTable(),!(t<0||t>=this._ColorTable.length)&&(e=new X(e),e.ok&&(this._ColorTable[t]=e.toRGB()))}AddLine(t,e,i,n,s,l){let r={raw:e,line:t,fragment:i,gagged:n,formats:this.pruneFormats(s,t.length,i),remote:l};this.emit("add-line",r),this.EndOfLine=!i}pruneFormats(t,e,i){if(!t||t.length<2)return t;let n=t.length,s=[];for(let l=0;l<n;l++){let r=t[l],a;if(l<n-1){let o=t[l+1];if(r.offset===o.offset&&o.formatType===r.formatType||(a=o.offset,r.formatType===1&&a-r.offset===0&&o.formatType===2)||r.formatType===7&&a-r.offset===0&&o.formatType===8||r.formatType===3&&a-r.offset===0&&o.formatType===4)continue}else if(!i&&r.offset===e&&e!==0&&(r.formatType===0&&!r.hr||r.formatType===1||r.formatType===7||r.formatType===3))continue;s.push(r)}return s}GetEntity(t){return t==="text"?t:this.mxpEntities[t]?(this.mxpState.expanded=!0,this.mxpEntities[t].value):t}ClearMXPToTag(t,e,i){e==null&&(e="");let n=new st;n.tag=0;let s=this.mxpStyles.length-1;for(;s>=0&&(this.mxpStyles[s].tag!==t&&this.mxpStyles[s].custom!==e);s--){if(!this.mxpStyles[s].open&&!i)continue;n=this.mxpStyles.splice(s,1)[0]}return s>=0&&this.mxpStyles.length>0?n=this.mxpStyles.splice(s,1)[0]:this.mxpStyles.length===0&&this.ResetMXP(),n}ClearMXPOpen(){let t=this.mxpStyles.length;for(;t--;)this.mxpStyles[t].open&&this.mxpStyles.splice(t,1);this.mxpStyles.length===0&&this.ResetMXP()}getMXPOpenFormatBlocks(){if(!this.mxpState.on)return[];let t=0,e=this.mxpStyles.length,i=[];for(;t<e;t++)(this.mxpStyles[t].tag===22||this.mxpStyles[t].tag===23)&&i.push(Object.assign({},this.mxpStyles[t].properties));return i}getMXPCloseFormatBlocks(){if(!this.mxpState.on)return[];let t=this.mxpStyles.length,e=[];for(;t--;)this.mxpStyles[t].tag===22?e.push({formatType:4}):this.mxpStyles[t].tag===23&&e.push({formatType:8});return e}getMXPBlock(t,e,i,n,s){let l,r,a,o,f,p,g=e.length,c,S,v,d="",b="",L="",P=!1;switch(t=t.toUpperCase(),this.enableDebug&&(this.emit("debug","MXP Tag: "+t),this.emit("debug","MXP Tag Args: "+e)),t){case"C":case"COLOR":if(l=this.CloneCurrentStyle(),l.tag=le[t],l.open=!0,g>0)if(r=e[0].split("="),r.length>1){if(f=new X(G(r[1])),!f.ok)return null;r[0].toUpperCase()==="BACK"?l.back=f.toRGB():l.fore=f.toRGB()}else f=new X(G(r[0])),f.ok&&(l.fore=f.toRGB());if(g>1)if(r=e[1].split("="),r.length>1){if(f=new X(G(r[1])),!f.ok)return null;r[0].toUpperCase()==="FORE"?l.fore=f.toRGB():l.back=f.toRGB()}else f=new X(G(r[0])),f.ok&&(l.back=f.toRGB());return l.custom="",this.mxpStyles.push(l),null;case"B":case"BOLD":case"STRONG":return l=this.CloneCurrentStyle(),l.open=!0,l.tag=le[t],l.style|=1,l.custom="",this.mxpStyles.push(l),null;case"FONT":for(l=this.CloneCurrentStyle(),l.open=!0,l.tag=le[t],p=0;p<g;p++)if(r=e[p].split("="),r.length>1)switch(r[0].toUpperCase()){case"SIZE":this.isNumber(r[1])?l.fontSize=r[1]+"pt":l.fontSize=r[1]||0;break;case"COLOR":for(o=r[1].split(","),f=new X(G(o[0])),f.ok&&(l.fore=f.toRGB()),v=1,S=o.length;v<S;v++)switch(o[v].toLowerCase()){case"bold":l.style|=1;break;case"italic":l.style|=4;break;case"underline":l.style|=8;break;case"blink":l.style|=16;break;case"inverse":l.style|=64;break;case"hidden":l.style|=128;break;case"strikeout":l.style|=256;break;case"overline":l.style|=1024;break;case"doubleunderline":l.style|=512;break}break;case"BACK":f=new X(G(r[1])),f.ok&&(l.back=f.toRGB());break;case"FACE":l.font=G(r[1])||0;break;default:this.enableDebug&&this.emit("debug","Invalid Argument for "+t+": "+r[0]);break}else p===0?l.font=G(e[p])||0:p===1?this.isNumber(e[p])?l.fontSize=e[p]+"pt":l.fontSize=e[p]||0:p===2?(f=new X(G(e[p])),f.ok&&(l.fore=f.toRGB())):p===3&&(f=new X(G(e[p])),f.ok&&(l.back=f.toRGB()));return l.custom="",this.mxpStyles.push(l),null;case"H":case"HIGH":return l=this.CloneCurrentStyle(),l.open=!0,l.tag=le[t],l.high=!0,l.custom="",this.mxpStyles.push(l),null;case"I":case"ITALIC":case"EM":return l=this.CloneCurrentStyle(),l.open=!0,l.tag=le[t],l.style|=4,l.custom="",this.mxpStyles.push(l),null;case"U":case"UNDERLINE":return l=this.CloneCurrentStyle(),l.open=!0,l.tag=le[t],l.style|=8,l.custom="",this.mxpStyles.push(l),null;case"S":case"STRIKEOUT":return l=this.CloneCurrentStyle(),l.open=!0,l.tag=le[t],l.style|=256,l.custom="",this.mxpStyles.push(l),null;case"/B":case"/BOLD":case"/STRONG":case"/H":case"/HIGH":case"/I":case"/ITALIC":case"/EM":case"/U":case"/UNDERLINE":case"/S":case"/STRIKEOUT":case"/C":case"/COLOR":case"/FONT":return this.ClearMXPToTag(le[t.substring(1)]),null}if(this.mxpState.lineType===1||this.mxpState.lineType===6||this.mxpState.lineType===4)switch(t){case"IMAGE":for(c={formatType:5,name:"",url:this.DefaultImgUrl,t:"",h:"",w:"",hspace:"",vspace:"",align:"bottom",ismap:!1},p=0;p<g;p++)switch(r=e[p].split("="),r[0].toUpperCase()){case"FNAME":c.name=G(r[1]);break;case"URL":c.url=G(r[1]);break;case"TYPE":case"T":r[1].length>0&&(c.type=r[1]);break;case"HEIGHT":case"H":c.h=G(r[1]);break;case"WIDTH":case"W":c.w=G(r[1]);break;case"HSPACE":c.hspace=r[1];break;case"VSPACE":c.vspace=r[1];break;case"ALIGN":c.align=r[1].toLowerCase();break;case"ISMAP":c.ismap=!0;break;default:p===0?c.name=G(e[p]):p===1?c.url=G(e[p]):p===2&&e[p].length>0?c.type=e[p]:p===3?c.h=G(e[p]):p===4?c.w=G(e[p]):p===5?c.hspace=e[p]:p===6?c.vspace=e[p]:p===7&&(c.align=e[p].toLowerCase());break}return{format:c,text:null};case"!AT":case"!ATTLIST":if(e.length===0||(c=e[0],!this.mxpElements[c]||this.mxpEntities[c].remote!==c.remote&&!this.mxpEntities[c].open))return null;for(this.mxpElements[c].attributes={},this.mxpElements[c].attributeIndexes=[],p=1;p<g;p++)o=e[p].split("="),o.length>1?this.mxpElements[c].attributes[o[0].toLowerCase()]=o[1]:this.mxpElements[c].attributes[o[0].toLowerCase()]="",this.mxpElements[c].attributeIndexes.push(o[0].toLowerCase());break;case"!TAG":for(c=new Lt,c.remote=i,p=0;p<g;p++)switch(r=e[p].split("="),r[0].toUpperCase()){case"WINDOWNAME":c.window=G(r[1]);break;case"FORE":f=new X(G(r[1])),f.ok&&(c.fore=f.toRGB());break;case"BACK":f=new X(G(r[1])),f.ok&&(c.back=f.toRGB());break;case"GAG":c.gag=!0;break;case"ENABLE":c.enabled=!0;break;case"DISABLE":c.enabled=!1;break;default:p===0?(l=+e[p],isNaN(l)||(c.index=l)):p===1?c.window=G(e[p]):p===2?(f=new X(G(e[p])),f.ok&&(c.fore=f.toRGB())):p===3&&(f=new X(G(e[p])),f.ok&&(c.back=f.toRGB()));break}c.fore.length>0&&c.back.length>0?c.definition=`<C "${c.fore}" "${c.back}">`:c.fore.length>0?c.definition=`<C "${c.fore}">`:c.back.length>0&&(c.definition=`<C BACK="${c.fore}">`),c.definition.length>0&&(c.closeDefinition="</C>"),this.mxpLines[c.index]?(c.remote||this.mxpLines[c.index].remote===c.remote)&&(this.mxpLines[c.index]=c):this.mxpLines[c.index]=c;break;case"!EL":case"!ELEMENT":for(c=new Qt(i),p=0;p<g;p++){if(e[p].toUpperCase().startsWith("ATT=")){for(r=G(e[p]).substring(4).split(" "),v=0,S=r.length;v<S;v++)o=G(r[v]).split("="),o.length>1?c.attributes[o[0].toLowerCase()]=G(o[1]):c.attributes[o[0].toLowerCase()]="",c.attributeIndexes.push(o[0].toLowerCase());continue}switch(r=e[p].split("="),r[0].toUpperCase()){case"TAG":l=+r[1],isNaN(l)||(c.tag=l);break;case"FLAG":c.flag=G(r[1]);break;case"OPEN":c.open=!0;break;case"DELETE":return this.mxpElements[c.name]&&(this.mxpEntities[c.name].remote===c.remote||this.mxpEntities[c.name].open)&&delete this.mxpEntities[c.name],null;case"EMPTY":c.empty=!0;break;case"SECURE":c.open=!1;break;default:if(p===0)c.name=G(e[p]).toUpperCase();else if(p===1)c.definition=G(e[p]),c.closeDefinition=this.GetCloseTags(c.definition),this.enableDebug&&this.emit("debug","MXP close definition: "+c.closeDefinition);else if(p===2)for(r=e[p].substring(4).split(" "),v=0,S=r.length;v<S;v++)o=r[v].split("="),o.length>1?c.attributes[o[0]]=o[1]:c.attributes[o[0]]="",c.attributeIndexes.push(o[0]);else p===3?(l=+e[p],isNaN(l)||(c.tag=l)):p===4&&(c.flag=G(e[p]));break}}c.tag>19&&c.tag<100&&(l=new Lt(c.tag),l.element=c.name,this.mxpLines[l.index]?(c.remote||this.mxpLines[l.index].remote===c.remote)&&(this.mxpLines[l.index]=l):this.mxpLines[l.index]=l),this.mxpElements[c.name]?(this.mxpElements[c.name].remote===c.remote||this.mxpEntities[c.name].open)&&(this.mxpElements[c.name]=c):this.mxpElements[c.name]=c;break;case"!EN":case"!ENTITY":for(c=new Tt(i),p=0;p<g;p++)switch(r=e[p].split("="),r[0].toUpperCase()){case"DESC":c.description=G(r[1]);break;case"PRIVATE":c.publish=!1;break;case"PUBLISH":c.publish=!0;break;case"DELETE":return this.mxpEntities[c.name]&&this.mxpEntities[c.name].remote===c.remote&&delete this.mxpEntities[c.name],null;case"ADD":if(this.mxpEntities[c.name]&&this.mxpEntities[c.name].remote===c.remote)return this.mxpEntities[c.name].value?this.mxpEntities[c.name].value+="|"+c.value:this.mxpEntities[c.name].value=c.value,null;break;case"REMOVE":if(this.mxpEntities[c.name]&&this.mxpEntities[c.name].remote===c.remote&&this.mxpEntities[c.name].value){for(o=this.mxpEntities[c.name].value.split("|"),a=[],v=0,S=o.length;v<S;v++)o[v]!==c.value&&a.push(o[v]);this.mxpEntities[c.name].value=a.join("|")}return null;default:p===0?c.name=G(e[p]):p===1?c.value=G(e[p]):p===2&&(c.description=G(e[p]));break}this.mxpEntities[c.name]?this.mxpEntities[c.name].remote===c.remote&&(this.mxpEntities[c.name]=c):this.mxpEntities[c.name]=c;break;case"/V":case"/VAR":for(l=this.ClearMXPToTag(le[t.substring(1)]),c=new Tt(i),this.mxpState.captured.length>0?c.value=this.mxpState.captured.pop().join(""):c.value="",this.mxpState.capture--,this.enableDebug&&this.emit("debug","MXP captured: "+c.value),e=l.obj,g=e.length,p=0;p<g;p++)switch(r=e[p].split("="),r[0].toUpperCase()){case"DESC":c.description=G(r[1]);break;case"PRIVATE":c.publish=!1;break;case"PUBLISH":c.publish=!0;break;case"DELETE":return this.mxpEntities[c.name]&&this.mxpEntities[c.name].remote===c.remote&&delete this.mxpEntities[c.name],null;case"ADD":if(this.mxpEntities[c.name]&&this.mxpEntities[c.name].remote===c.remote)return this.mxpEntities[c.name].value?this.mxpEntities[c.name].value+="|"+c.value:this.mxpEntities[c.name].value=c.value,null;break;case"REMOVE":if(this.mxpEntities[c.name]&&this.mxpEntities[c.name].remote===c.remote&&this.mxpEntities[c.name].value){for(o=this.mxpEntities[c.name].value.split("|"),a=[],v=0,S=o.length;v<S;v++)o[v]!==c.value&&a.push(o[v]);this.mxpEntities[c.name].value=a.join("|")}return null;default:p===0?c.name=G(e[p]):p===1&&(c.description=G(e[p]));break}this.mxpEntities[c.name]?this.mxpEntities[c.name].remote===c.remote&&(this.mxpEntities[c.name]=c):this.mxpEntities[c.name]=c;break;case"V":case"VAR":return this.mxpState.captured.push([]),this.mxpState.capture++,l=this.CloneCurrentStyle(),l.open=!1,l.tag=le[t],l.obj=e,l.custom="",this.mxpStyles.push(l),null;case"GAUGE":for(c={value:0,max:1,caption:"",color:0},p=0;p<g;p++)if(r=e[p].split("="),r.length>1)switch(r[0].toUpperCase()){case"VALUE":l=parseFloat(this.GetEntity(r[1])),isNaN(l)&&(l=this.GetEntity(r[1])),c.value=l;break;case"MAX":l=parseFloat(this.GetEntity(r[1])),isNaN(l)&&(l=this.GetEntity(r[1])),c.max=l;break;case"CAPTION":r[1].length>0&&(c.caption=G(r[1]));break;case"COLOR":f=new X(G(r[1])),f.ok&&(c.color=f.toRGB());break}else p===0?(l=parseFloat(this.GetEntity(e[p])),isNaN(l)&&(l=this.GetEntity(e[p])),c.value=l):p===1?(l=parseFloat(this.GetEntity(e[p])),isNaN(l)&&(l=this.GetEntity(e[p])),c.max=l):p===2&&e[p].length>0?c.caption=G(e[p]):p===3&&e[p].length>0&&(f=new X(G(r[1])),f.ok&&(c.color=f.toRGB()));this.mxpState.expanded=!1,this.emit("gauge",c);break;case"STAT":for(c={value:0,max:1,caption:""},p=0;p<g;p++)if(r=e[p].split("="),r.length>1)switch(r[0].toUpperCase()){case"VALUE":l=parseFloat(this.GetEntity(r[1])),isNaN(l)&&(l=this.GetEntity(r[1])),c.value=l;break;case"MAX":l=parseFloat(this.GetEntity(r[1])),isNaN(l)&&(l=this.GetEntity(r[1])),c.max=l;break;case"CAPTION":r[1].length>0&&(c.caption=G(r[1]));break}else p===0?(l=parseFloat(this.GetEntity(e[p])),isNaN(l)&&(l=this.GetEntity(e[p])),c.value=l):p===1?(l=parseFloat(this.GetEntity(e[p])),isNaN(l)&&(l=this.GetEntity(e[p])),c.max=l):p===2&&e[p].length>0&&(c.caption=G(e[p]));this.mxpState.expanded=!1,this.emit("stat",c);break;case"MUSIC":for(c={off:!1,file:"",url:"",volume:100,repeat:1,priority:50,type:"",continue:!0},p=0;p<g;p++)if(r=e[p].split("="),r.length>1)switch(r[0].toUpperCase()){case"FNAME":c.file=G(r[1]),c.file.toLowerCase()==="off"&&(c.off=!0,c.file="");break;case"V":l=+r[1],isNaN(l)&&(l=100),c.volume=l;break;case"L":l=+r[1],isNaN(l)&&(l=1),c.repeat=l;break;case"C":c.continue=r[1]!=="0";break;case"T":r[1].length>0&&(c.type=r[1]);break;case"U":c.url=G(r[1]),!c.url.endsWith("/")&&c.url.length>0&&(c.url+="/");break}else p===0?(c.file=G(e[p]),c.file.toLowerCase()==="off"&&(c.off=!0,c.file="")):p===1?(l=+e[p],isNaN(l)&&(l=100),c.volume=l):p===2?(l=+e[p],isNaN(l)&&(l=1),c.repeat=l):p===3?c.continue=e[p]!=="0":p===4?e[p].length>0&&(c.type=e[p]):p===5&&(c.url=G(e[p]),!c.url.endsWith("/")&&c.url.length>0&&(c.url+="/"));this.emit("music",c);break;case"SOUND":for(c={off:!1,file:"",url:"",volume:100,repeat:1,priority:50,type:"",continue:!0},p=0;p<g;p++)if(r=e[p].split("="),r.length>1)switch(r[0].toUpperCase()){case"FNAME":c.file=G(r[1]),c.file.toLowerCase()==="off"&&(c.off=!0,c.file="");break;case"V":l=+r[1],isNaN(l)&&(l=100),c.volume=l;break;case"L":l=+r[1],isNaN(l)&&(l=1),c.repeat=l;break;case"P":l=+r[1],isNaN(l)&&(l=1),c.priority=l;break;case"T":r[1].length>0&&(c.type=r[1]);break;case"U":c.url=G(r[1]),!c.url.endsWith("/")&&c.url.length>0&&(c.url+="/");break}else p===0?(c.file=G(e[p]),c.file.toLowerCase()==="off"&&(c.off=!0,c.file="")):p===1?(l=+e[p],isNaN(l)&&(l=100),c.volume=l):p===2?(l=+e[p],isNaN(l)&&(l=1),c.repeat=l):p===3?(l=+e[p],isNaN(l)&&(l=1),c.priority=l):p===4?e[p].length>0&&(c.type=e[p]):p===5&&(c.url=G(e[p]),!c.url.endsWith("/")&&c.url.length>0&&(c.url+="/"));this.emit("sound",c);break;case"EXPIRE":this.emit("expire-links",e),this.cleanMXPExpired(s,e?.[0]||"");break;case"VERSION":g>0?this.StyleVersion=e[0]:this.emit("MXP-tag-reply",t,[]);break;case"USER":case"PASSWORD":this.emit("MXP-tag-reply",t,e);break;case"SUPPORT":if(o=[],g>0)for(p=0;p<g;p++)if(r=G(e[p]),r.indexOf(".")===-1)switch(r=r.toUpperCase(),r){case"IMAGE":case"HR":case"A":case"SEND":case"B":case"I":case"COLOR":case"C":case"EM":case"ITALIC":case"STRONG":case"BOLD":case"UNDERLINE":case"U":case"S":case"STRIKEOUT":case"STRIKE":case"H":case"HIGH":case"EXPIRE":case"VERSION":case"SUPPORT":case"NOBR":case"P":case"BR":case"SBR":case"SOUND":case"MUSIC":case"VAR":case"USER":case"PASSWORD":case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"RESET":case"GAUGE":case"STAT":o.push("+"+name);break;default:o.push("-"+name);break}else switch(r=e[p].split("."),r[0]=r[0].toUpperCase(),r[0]){case"IMAGE":r[1]!=="*"?o.push("+"+r[0]+"."+r[1]):(o.push("+image.fname"),o.push("+image.url"),o.push("+image.t"),o.push("+image.h"),o.push("+image.w"),o.push("+image.hspace"),o.push("+image.vspace"),o.push("+image.align"),o.push("+image.ismap"));break;case"SOUND":r[1]!=="*"?o.push("+"+r[0]+"."+r[1]):(o.push("+sound.v"),o.push("+sound.l"),o.push("+sound.p"),o.push("+sound.t"),o.push("+sound.u"));break;case"MUSIC":r[1]!=="*"?o.push("+"+r[0]+"."+r[1]):(o.push("+music.v"),o.push("+music.l"),o.push("+music.c"),o.push("+music.t"),o.push("+music.u"));break;case"A":r[1]!=="*"?o.push("+"+r[0]+"."+r[1]):(o.push("+a.href"),o.push("+a.hint"),o.push("+a.expire"));break;case"SEND":r[1]!=="*"?o.push("+"+r[0]+"."+r[1]):(o.push("+send.href"),o.push("+send.hint"),o.push("+send.prompt"),o.push("+send.expire"));break;case"COLOR":r[1]!=="*"?o.push("+"+r[0]+"."+r[1]):(o.push("+color.fore"),o.push("+color.back"));break;case"C":r[1]!=="*"?o.push("+"+r[0]+"."+r[1]):(o.push("+c.fore"),o.push("+c.back"));break;case"FONT":r[1]!=="*"?o.push("+"+r[0]+"."+r[1]):(o.push("-font.face"),o.push("-font.size"),o.push("+font.color"),o.push("+font.back"));break;case"EXPIRE":r[1]!=="*"?o.push("+"+r[0]+"."+r[1]):o.push("+expire.Name");break;case"GAUGE":r[1]!=="*"?o.push("+"+r[0]+"."+r[1]):(o.push("+gauge.max"),o.push("+gauge.caption"),o.push("+gauge.color"));break;case"STAT":r[1]!=="*"?o.push("+"+r[0]+"."+r[1]):(o.push("+stat.max"),o.push("+stat.caption"));break;default:r[1]!=="*"?o.push("-"+r[0]+"."+r[1]):o.push("-"+r[0]);break}else o=["+A","+SEND","+B","+I","+COLOR","+C","+EM","+ITALIC","+STRONG","+BOLD","+UNDERLINE","+U","+S","+STRIKEOUT","+H","+HIGH","-FONT","+EXPIRE","+VERSION","+SUPPORT","+NOBR","+P","+BR","+SBR","+VAR","+SOUND","+MUSIC","+USER","+PASSWORD","+RESET","+STRIKE","+H1","+H2","+H3","+H4","+H5","+H6","+IMAGE","+STAT","+GAUGE"];this.emit("MXP-tag-reply",t,o);break;case"A":for(l=this.CloneCurrentStyle(),l.open=!1,l.tag=le[t],p=0;p<g;p++)if(r=e[p].split("="),r.length>1)switch(r[0].toUpperCase()){case"HREF":d=G(r[1]);break;case"HINT":b=G(r[1]);break;case"EXPIRE":L=G(r[1]);break;default:this.enableDebug&&this.emit("debug","Invalid Argument for "+t+": "+r[0]);break}else p===0?d=G(e[p]):p===1?b=G(e[p]):p===2&&(L=G(e[p]));return l.custom="",l.properties={formatType:3,href:d,hint:b,expire:L},this.mxpStyles.push(l),b.length===0&&(b=d),{format:{formatType:3,href:d,hint:b,expire:L},text:null};case"SEND":for(l=this.CloneCurrentStyle(),l.open=!1,l.tag=le[t],p=0;p<g;p++)if(r=e[p].split("="),r[0]==="PROMPT")P=!0;else if(r.length>1)switch(r[0].toUpperCase()){case"HREF":d=G(r[1]);break;case"HINT":b=G(r[1]);break;case"EXPIRE":L=G(r[1]);break;case"PROMPT":P=!0;break;default:this.enableDebug&&this.emit("debug","Invalid Argument for "+t+": "+r[0]);break}else p===0?d=G(e[p]):p===1?b=G(e[p]):p===2?P=!0:p===3&&(L=G(e[p]));l.custom="",this.mxpStyles.push(l),d.length===0&&(d="&text;"),b.length===0&&(b=d);let _=d.split("|"),j;if(_.length>1){let y=b.split("|");y.length===_.length+1&&(b=y[0],y.shift(),j="['"+y.join("','")+"']"),d="['"+_.join("','")+"']"}else d="'"+d+"'";return l.properties={formatType:7,href:d,hint:b,expire:L,prompt:P,tt:j||""},{format:{formatType:7,href:d,hint:b,expire:L,prompt:P,tt:j||""},text:null};case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":return l=this.CloneCurrentStyle(),l.open=!0,l.tag=le[t],l.style|=1,l.custom="",this.mxpStyles.push(l),null;case"/A":return this.ClearMXPToTag(le[t.substring(1)]),{format:{formatType:4},text:null};case"/SEND":return this.ClearMXPToTag(le[t.substring(1)]),{format:{formatType:8},text:null};case"/H1":case"/H2":case"/H3":case"/H4":case"/H5":case"/H6":return this.ClearMXPToTag(le[t.substring(1)]),null;case"NOBR":return this.mxpState.noBreak=!0,null;case"/P":return this.ClearMXPToTag(le[t.substring(1)]),this.mxpState.paragraph=!1,null;case"P":return l=this.CloneCurrentStyle(),l.open=!1,l.tag=le[t],l.custom="",this.mxpStyles.push(l),this.mxpState.paragraph=!0,null;case"SBR":return{format:null,text:" \u200B"};case"RESET":return this.ResetMXP(),null;case"HR":let C=this.GetCurrentStyle(),E=this.getColors(C);return{format:{formatType:0,offset:0,color:E.fore,background:E.back,size:C.fontSize,font:C.font,style:C.style|this._CurrentAttributes&-2,hr:!0},text:null}}if(this.mxpElements[t]){if(c=this.mxpElements[t],!c.open&&this.mxpState.lineType!==1&&this.mxpState.lineType!==6&&this.mxpState.lineType!==4)return null;for(l=this.CloneCurrentStyle(),l.open=c.open,l.tag=38,l.custom=c.name,r=c.definition,o={},v=0,S=c.attributeIndexes.length;v<S;v++)o[c.attributeIndexes[v]]=c.attributes[c.attributeIndexes[v]];for(p=0;p<g;p++)a=e[p].split("="),a[0]=a[0].toLowerCase(),c.attributes[a[0]]?o[a[0]]=a[1]:p<c.attributeIndexes.length&&(o[c.attributeIndexes[p]]=a[0]);for(a in o)o.hasOwnProperty(a)&&(r=r.replace("&"+a+";",o[a]));return c.empty||(this.mxpState.captured.push([]),this.mxpState.capture++),c.tag>19&&c.tag<100&&this.mxpLines[c.tag].enabled&&this.mxpLines[c.tag].definition.length>0&&(r=this.mxpLines[c.tag].definition+r,l.gagged=this.mxpLines[c.tag].gag),this.mxpState.gagged=l.gagged,this.mxpState.expanded=!0,{format:null,text:r}}else if(t.startsWith("/")&&this.mxpElements[t.substring(1)]&&!this.mxpElements[t.substring(1)].empty)return t=t.substring(1),c=this.mxpElements[t],!c.open&&this.mxpState.lineType!==1&&this.mxpState.lineType!==6&&this.mxpState.lineType!==4||(!c.empty&&this.mxpState.capture>0&&(this.mxpState.captured.length>0&&(a=this.mxpState.captured.pop().join("")),this.mxpState.capture--),r=c.closeDefinition,c.flag.length>0&&(c.flag.length>4&&c.flag.toLowerCase().startsWith("set ")&&this.emit("set-variable",c.flag.substring(4),a),this.emit("MXP-flag",c.flag,a)),c.tag>19&&c.tag<100&&this.mxpLines[c.tag].enabled&&this.mxpLines[c.tag].closeDefinition.length>0&&(r+=this.mxpLines[c.tag].closeDefinition),this.mxpState.gagged=!c.gagged,c.empty)?null:(this.mxpState.expanded=!0,{format:null,text:r});if(this.showInvalidMXPTags){switch(t){case"IMAGE":case"!AT":case"!ATTLIST":case"!TAG":case"!EL":case"!ELEMENT":case"!EN":case"!ENTITY":case"/V":case"/VAR":case"V":case"VAR":case"GAUGE":case"STAT":case"MUSIC":case"SOUND":case"EXPIRE":case"VERSION":case"USER":case"PASSWORD":case"SUPPORT":case"A":case"SEND":case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"/A":case"/SEND":case"/H1":case"/H2":case"/H3":case"/H4":case"/H5":case"/H6":case"NOBR":case"/P":case"P":case"SBR":case"RESET":case"HR":return null}return{format:null,text:"<"+n+">"}}return null}cleanMXPExpired(t,e){if(!t||t.length===0||e===null)return;let i=t.length;for(let n=0;n<i;n++){let s=t[n];if(!(s.formatType!==7&&s.formatType!==3)&&(e.length===0||s.expire===e)){let l,r=0,a=0,o=s.formatType;for(s.formatType===3?l=4:l=8,s.formatType=9;a<i;a++)if(t[a].formatType===l)if(r===0){t[a].formatType=10;break}else r--;else t[a]===o&&r++}}}GetCloseTags(t){if(typeof t>"u"||t.length===0)return"";let e=0,i=t.length,n=[],s=[],l,r=0;for(;e<i;e++)switch(l=t.charAt(e),r){case 1:l===" "?(n.push(s.join("")),s=[],r=2):l===">"?(n.push(s.join("")),s=[],r=0):s.push(l);break;case 2:l===">"&&(r=0);break;default:l==="<"&&(r=1);break}return r===1&&n.push(s.join("")),n.length===0?"":"</"+n.reverse().join("></")+">"}CloneCurrentStyle(){let t;return this.mxpStyles.length===0&&this.mxpStyles.push(new st(0,"","",!1)),t=this.mxpStyles[this.mxpStyles.length-1],this.mxpLines[this.mxpState.lineType]&&this.mxpLines[this.mxpState.lineType].enabled&&(t.gagged=this.mxpLines[this.mxpState.lineType].gag),Object.assign({},t)}GetCurrentStyle(){let t;return this.mxpStyles.length===0&&this.mxpStyles.push(new st(0,"","",!1)),t=this.mxpStyles[this.mxpStyles.length-1],this.mxpLines[this.mxpState.lineType]&&this.mxpLines[this.mxpState.lineType].enabled&&(t.gagged=this.mxpLines[this.mxpState.lineType].gag),t}DecreaseColor(t,e){let i=new X(t);return i.ok?(i.b-=Math.ceil(i.b*e),i.b<0&&(i.b=0),i.g-=Math.ceil(i.g*e),i.g<0&&(i.g=0),i.r-=Math.ceil(i.r*e),i.r<0&&(i.r=0),i.toRGB()):t}IncreaseColor(t,e){let i=new X(t);return i.ok?(i.b+=Math.ceil(i.b*e),i.b>255&&(i.b=255),i.g+=Math.ceil(i.g*e),i.g>255&&(i.g=255),i.r+=Math.ceil(i.r*e),i.r>255&&(i.r=255),i.toRGB()):t}MXPCapture(t){if(this.mxpState.capture<1)return;let e=this.mxpState.captured.length;for(let i=0;i<e;i++)this.mxpState.captured[i].push(t)}MXPDeCapture(t){if(this.mxpState.capture<1)return;let e=this.mxpState.captured.length;for(let i=0;i<e;i++)for(let n=0;n<t;n++)this.mxpState.captured[i].pop()}isNumber(t){return/^\d+$/.test(t)}CurrentAnsiCode(){let t="\x1B[";return typeof this._CurrentForeColor=="string"?t+="38;2;"+this._CurrentForeColor:this._CurrentForeColor<=-16?t+="38;5;"+(this._CurrentForeColor*-1-16)+";":t+=this._CurrentForeColor+";",typeof this._CurrentBackColor=="string"?t+="48;2;"+this._CurrentBackColor:this._CurrentBackColor<=-16?t+="38;5;"+(this._CurrentBackColor*-1-16)+";":t+=this._CurrentBackColor+";",this._CurrentAttributes>0&&((this._CurrentAttributes&64)===64&&(t+="7;"),(this._CurrentAttributes&1)===1&&(t+="1;"),(this._CurrentAttributes&4)===4&&(t+="3;"),(this._CurrentAttributes&8)===8&&(t+="4;"),(this._CurrentAttributes&16)===16&&(t+="5;"),(this._CurrentAttributes&32)===32&&(t+="6;"),(this._CurrentAttributes&256)===256&&(t+="9;"),(this._CurrentAttributes&2)===2&&(t+="2;"),(this._CurrentAttributes&512)===512&&(t+="21;"),(this._CurrentAttributes&1024)===1024&&(t+="53;")),t+"m"}get parseQueueLength(){return this.parsing.length}get parseQueueEndOfLine(){return this.parsing.length?this.parsing[this.parsing.length-1][0].endsWith(`
`):!1}parse(t,e,i,n){if(t==null||t.length===0)return t;if(e==null&&(e=!1),this.parsing.length>0&&!i){this.parsing.push([t,e,n]);return}let s="",l=null,r=null,a=[],o=[],f=[],p=0,g=0,c=0,S,v=0,d,b,L,P,_,j=!1;this.busy=!0,this.parsing.unshift([t,e,n]);let C;if(this._SplitBuffer.length>0&&(n?t=t+this._SplitBuffer:t=this._SplitBuffer+t,this._SplitBuffer=""),!this.EndOfLine&&(this.textLength>0||this.rawLength>0)){let w=this.display.lines;w.length>0?(S=this.display.lines[w.length-1].text,P=this.display.lines[w.length-1].raw,o.push.apply(o,this.display.lines[w.length-1].formats),this.display.removeLine(w.length-1,!0),C=o[o.length-1],C.formatType===1&&(o.pop(),C=o[o.length-1]),C.width=0,C.height=0,C.marginWidth=0,C.marginHeight=0,c=C.offset,C.offset!==0?(a.push(S.substring(0,C.offset)),S=S.substring(C.offset),(this.mxpState.locked||this.mxpState.on)&&(v=S.length),t=S+t):((this.mxpState.locked||this.mxpState.on)&&(v=S.length),t=S+t),P.endsWith(S)?f.push(P.substr(0,P.length-S.length)):f.push(P)):o.push(C=this.getFormatBlock(c)),w=null}else o.push(C=this.getFormatBlock(c));let E=0,y=t.length,m,x,W=this.emulateControlCodes,te=this.displayControlCodes,ne=this.emulateTerminal,me=this.enableURLDetection,se=this.enableMSP,I=this.tabWidth,R=0,z=0,F=0,k=0,M=null,O,Y=this.protocols.length;try{for(E=0;E<y;E++)switch(m=t.charAt(E),x=t.charCodeAt(E),E>=v&&f.push(m),this.rawLength++,p){case 2:if(m==="C"||m==="K"||m==="s"||m==="u"||m==="l"||m==="h"||m==="A"||m==="B"||m==="D"||m==="E"||m==="F"||m==="f"||m==="G"||m==="H"||m==="n"||m==="S"||m==="T"||m==="r")this.ClearMXPOpen(),this._SplitBuffer="",r=null,p=0;else if(m==="z"){d=r.split(";"),r=0;for(let w=d.length-1;w>=0;w--)if(d[w].length>0){r=d[0];break}switch(S=+r,isNaN(S)&&(S=0),this.mxpState.on=!0,this.mxpState.noBreak=!1,this.mxpState.paragraph=!1,this.mxpState.lineType===0&&this.ClearMXPOpen(),S){case 2:this.mxpState.on=!1,this.mxpState.locked=!1,this.mxpState.lineType=2,this.ClearMXPOpen();break;case 3:this.ResetMXP();break;case 4:if(this.mxpState.lineType=4,E+1>=y){this._SplitBuffer+=m;break}t.charAt(E+1)!=="<"&&(this.mxpState.lineType=0,this.mxpState.on=!1),this.mxpState.locked=!1,this.ClearMXPOpen();break;case 5:this.iMXPDefaultMode=0,this.mxpState.locked=!0,this.mxpState.lineType=5,this.ClearMXPOpen();break;case 6:this.iMXPDefaultMode=1,this.mxpState.lineType=6,this.mxpState.locked=!0,this.ClearMXPOpen();break;case 7:this.iMXPDefaultMode=2,this.mxpState.lineType=7,this.mxpState.locked=!0,this.ClearMXPOpen();break;default:S<0||S>99?this.ClearMXPOpen():(this.mxpState.lineType=S,this.mxpState.locked=!1,this.mxpLines[this.mxpState.lineType]&&this.mxpLines[this.mxpState.lineType].enabled&&(S="",this.mxpLines[this.mxpState.lineType].element.length>0&&(S+="<"+this.mxpLines[this.mxpState.lineType].element+">"),this.mxpLines[this.mxpState.lineType].definition.length>0&&(S+=this.mxpLines[this.mxpState.lineType].definition),S.length>0&&(t=t.splice(E+1,S),y=t.length)));break}this._SplitBuffer="",r=null,p=0}else if(m==="J"){if(this.ClearMXPOpen(),r.length>0&&+r==2){c=0,S=this.window.height,o.push(...this.getMXPCloseFormatBlocks()),this.AddLine(a.join(""),f.join(""),!1,!1,o,e),a=[],f=[],o=[...this.getMXPOpenFormatBlocks(),C=this.getFormatBlock(c),...this.getMXPCloseFormatBlocks()];for(let w=0;w<S;w++)this.AddLine("",`
`,!1,!1,o,e),this.MXPCapture(`
`);this.textLength+=S,this.mxpState.noBreak=!1}o=[...this.getMXPOpenFormatBlocks(),C=this.getFormatBlock(c)],this._SplitBuffer="",r=null,p=0}else m==="m"?(this.ProcessAnsiColorParams(r.split(";")),o.push(C=this.getFormatBlock(c)),this._SplitBuffer="",r=null,p=0):m===`
`||m==="\x1B"?(E--,f.pop(),this.rawLength--,p=0,this._SplitBuffer="",this.mxpState.on&&m===`
`&&this.ClearMXPOpen()):(this._SplitBuffer+=m,r+=m);break;case 3:x===7?(this._SplitBuffer="",this.emit("set-title",s,l??0),s="",l=null,p=0):m===";"&&l==null?(l=+s,isNaN(l)&&(l=0),s="",this._SplitBuffer+=m):m==="\x1B"?this._SplitBuffer.charAt(this._SplitBuffer.length-1)===`
`&&(this._SplitBuffer=""):(this._SplitBuffer+=m,s+=m);break;case 1:m==="["?(this._SplitBuffer+=m,r="",p=2):m==="]"?(this._SplitBuffer+=m,s="",p=3):(m==="D"||m==="E"||m==="M"||m==="1"||m==="2"||m==="7"||m==="8"||m===">"||m==="="||m==="#")&&(te&&(a.push("\u241B"),x<16?(a.push(String.fromCharCode(parseInt("240"+x.toString(16),16))),this.MXPCapture("&#x241B&#x240"+x.toString(16)+";")):(a.push(String.fromCharCode(parseInt("24"+x.toString(16),16))),this.MXPCapture("&#x241B&#x24"+x.toString(16)+";")),c+=2,this.textLength+=2,this.mxpState.noBreak=!1),p=0,this._SplitBuffer="");break;case 4:if(d==="!--")E--,f.pop(),this.rawLength--,g=0,p=8,P="<!--",d="",_=[];else if(d.endsWith("<!--"))E--,f.pop(),this.rawLength--,g=p,p=8,P="<!--",d=d.substring(0,d.length-4),_=[];else if(m==='"')p=6,_[_.length-1]+=m,this._SplitBuffer+=m;else if(m==="'")p=5,_[_.length-1]+=m,this._SplitBuffer+=m;else if(m==="&")L="",g=p,p=7,this._SplitBuffer="";else if(m===`
`||m==="\x1B")E--,f.pop(),this.rawLength--,p=0,this._SplitBuffer="",this.mxpState.on&&m===`
`&&this.ClearMXPOpen();else if(m===" ")p=9,_.push(""),this._SplitBuffer+=m;else if(m===">"){if(b=d,d=d.toUpperCase(),d==="HR"&&(this.mxpState.lineType===1||this.mxpState.lineType===6||this.mxpState.lineType===4))c>0&&(c=0,this.MXPCapture(`
`),o.push(...this.getMXPCloseFormatBlocks()),this.AddLine(a.join(""),f.join(""),!1,!1,o,e),a=[],f=[],o=[...this.getMXPOpenFormatBlocks(),C=this.getFormatBlock(c)]),d=this.getMXPBlock(d,[],e),d&&d.format&&(d.format.offset=c,o.push(d.format),o[0].hr=d.format.hr),o.push(...this.getMXPCloseFormatBlocks()),this.AddLine(a.join(""),f.join(""),!1,!1,o,e),this.textLength++,a=[],f=[],o=[...this.getMXPOpenFormatBlocks(),C=this.getFormatBlock(c)];else if(d==="BR"&&(this.mxpState.lineType===1||this.mxpState.lineType===6||this.mxpState.lineType===4))this.MXPCapture(`
`),o.push(...this.getMXPCloseFormatBlocks()),this.AddLine(a.join(""),f.join(""),!1,!1,o,e),j=!1,c=0,a=[],f=[],o=[...this.getMXPOpenFormatBlocks(),C=this.getFormatBlock(c)],this.textLength++;else if(d==="IMAGE"&&(this.mxpState.lineType===1||this.mxpState.lineType===6||this.mxpState.lineType===4))d=this.getMXPBlock(d,_,e),d&&d.format!==null&&(o.push(d.format),c+=d.length,this.textLength+=d.length),o.push(C=this.getFormatBlock(c));else{if(d=this.getMXPBlock(d,[],e,b,o),this.mxpState.expanded){d&&d.text!==null&&(t=t.splice(E+1,d.text)),y=t.length,this.mxpState.expanded=!1,p=0,d="",this._SplitBuffer="";continue}d?(d.format&&(d.format.offset=c,o.push(d.format)),o.push(C=this.getFormatBlock(c)),d.text!==null&&d.text.length>0&&(a.push(d.text),c+=d.text.length,this.textLength+=d.text.length)):o.push(C=this.getFormatBlock(c))}p=0,this._SplitBuffer=""}else m==="<"?(this.enableDebug&&this.emit("debug","Malformed MXP Tag: "+d),E--,f.pop(),this.rawLength--,a.push("<"+d),c+=d.length+1,this.textLength+=d.length+1,p=0,this._SplitBuffer=""):(this._SplitBuffer+=m,d+=m);break;case 5:m==="'"?(p=9,this._SplitBuffer+=m,_[_.length-1]+=m):(this._SplitBuffer+=m,_[_.length-1]+=m);break;case 6:m==='"'?(p=9,this._SplitBuffer+=m,_[_.length-1]+=m):(this._SplitBuffer+=m,_[_.length-1]+=m);break;case 9:if(m==="'")p=5,_[_.length-1]+=m,this._SplitBuffer+=m;else if(m==='"')p=6,_[_.length-1]+=m,this._SplitBuffer+=m;else if(m===`
`||m==="\x1B")E--,f.pop(),this.rawLength--,p=0,this._SplitBuffer="",this.mxpState.on&&m===`
`&&this.ClearMXPOpen();else if(m===" ")p=9,_.push(""),this._SplitBuffer+=m;else if(m===">"){if(d.toUpperCase()==="IMAGE"&&(this.mxpState.lineType===1||this.mxpState.lineType===6||this.mxpState.lineType===4))d=this.getMXPBlock(d,_,e,d),d!==null&&d.format!==null&&(d.format.offset=c,o.push(d.format)),o.push(C=this.getFormatBlock(c));else{if(d=this.getMXPBlock(d,_,e,d,o),this.mxpState.expanded){d!==null&&(t=t.splice(E+1,d.text)),y=t.length,this.mxpState.expanded=!1,p=0,this._SplitBuffer="";continue}d!==null?(d!==null&&d.format&&(d.format.offset=c,o.push(d.format)),o.push(C=this.getFormatBlock(c)),d.text!==null&&(a.push(d.text),c+=d.text.length,this.textLength+=d.text.length)):o.push(C=this.getFormatBlock(c))}p=0,this._SplitBuffer=""}else this._SplitBuffer+=m,_[_.length-1]+=m;break;case 7:if(m===`
`||m==="\x1B"){if(E--,f.pop(),this.rawLength--,this.enableDebug&&this.emit("debug","MXP Entity: "+L),g===4)d+="&"+L,p=g;else{if(L=this.GetEntity(L),this.mxpState.expanded){d!==null&&(t=t.splice(E+1,L)),y=t.length,this.mxpState.expanded=!1,p=0,this._SplitBuffer="";continue}b=Ht("&"+L),a.push(b),this.MXPCapture("&"+L),c+=b.length,this.textLength+=b.length,this.mxpState.noBreak=!1,p=0,this._SplitBuffer="",C.unicode=!0}this.mxpState.on&&m===`
`&&this.ClearMXPOpen()}else if(m===";"){if(this.enableDebug&&this.emit("debug","MXP Entity: "+L),g!==4){if(L=this.GetEntity(L),this.mxpState.expanded){t=t.splice(E+1,L),y=t.length,this.mxpState.expanded=!1,p=g,this._SplitBuffer="";continue}b=Ht("&"+L+";"),a.push(b),this.MXPCapture("&"),this.MXPCapture(L),this.MXPCapture(";"),c+=b.length,this.textLength+=b.length,this.mxpState.noBreak=!1,this._SplitBuffer=""}else d+="&"+L+";";C.unicode=!0,p=g}else m==="&"?(this.enableDebug&&this.emit("debug","Malformed MXP Entity: "+L),g!==4?(a.push("&"+L),this.MXPCapture("&"),this.MXPCapture(L),c+=L.length+1,this.textLength+=L.length+1,this.mxpState.noBreak=!1,this._SplitBuffer="",E--,f.pop(),this.rawLength--):d+="&"+L,C.unicode=!0,p=g):(this._SplitBuffer+=m,L+=m);break;case 8:P.endsWith("-->")?(this.enableDebug&&this.emit("debug","MXP Comment: "+P),E--,f.pop(),this.rawLength--,p=g,p===0&&(this._SplitBuffer=""),P=""):m===`
`||m==="\x1B"?(this.enableDebug&&this.emit("debug","MXP Comment: "+P),E--,f.pop(),this.rawLength--,p=g,P="",this.mxpState.on&&m===`
`&&this.ClearMXPOpen()):P+=m;break;case 10:if(E>R+2)a.pop(),a.pop(),f.pop(),f.pop(),this.rawLength-=2,c-=2,this.textLength-=2,this.MXPDeCapture(2),E=R,p=0;else if(m==="/"){if(a.push(m),this.MXPCapture(m),c++,this.textLength++,E===R+2){for(p=11,R=a.length-4,k=a.length-1,z=o.length,F-=2;R>0&&wt(a[R],!0);)R--,F--;wt(a[R],!0)||(R++,F++),M=[],R>0&&a[R-1]==="("&&M.push(")"),R>0&&a[R-1]==="["&&M.push("]")}}else E>R+1?(a.pop(),f.pop(),this.rawLength--,c--,this.textLength--,this.MXPDeCapture(1),E=R,p=0):(E=R,p=0,f.pop(),this.rawLength--);break;case 11:wt(m,!1)?M.length>1&&M[M.length-1]===m?(M.pop(),a.push(m),this.MXPCapture(m),c++,this.textLength++,x>255&&(C.unicode=!0)):M.length>0&&m==="("?(M.push(")"),a.push(m),this.MXPCapture(m),c++,this.textLength++,x>255&&(C.unicode=!0)):M.length>0&&m==="["?(M.push("]"),a.push(m),this.MXPCapture(m),c++,this.textLength++,x>255&&(C.unicode=!0)):M.length===1&&M[M.length-1]===m?(k!==a.length-1&&(P+=a.slice(R).join(""),this.enableDebug&&this.emit("debug","URL Found: "+P),o.splice(z,0,{formatType:1,href:P,offset:F}),o.push({formatType:2,href:P,offset:c}),o.push(C=this.getFormatBlock(c))),p=0,E--,f.pop(),this.rawLength--):(x>255&&(C.unicode=!0),a.push(m),this.MXPCapture(m),c++,this.textLength++):(k!==a.length-1&&(P+=a.slice(R).join(""),this.enableDebug&&this.emit("debug","URL Found: "+P),o.splice(z,0,{formatType:1,offset:F,href:P}),o.push({formatType:2,offset:c,href:P}),o.push(C=this.getFormatBlock(c))),p=0,E--,f.pop(),this.rawLength--);break;case 12:m===")"?(R=this.mxpState.lineType,this.mxpState.lineType=4,this.getMXPBlock("SOUND",_,e),this.mxpState.lineType=R,p=0,E+1<y&&t.charAt(E+1)===`
`?(E++,j=!1,a=[],o=[...this.getMXPOpenFormatBlocks(),C=this.getFormatBlock(c)],this.mxpState.noBreak=!1,c=0):E+2<y&&t[E+1]==="\r"&&t[E+2]===`
`&&(E+=2,j=!1,a=[],o=[...this.getMXPOpenFormatBlocks(),C=this.getFormatBlock(c)],this.mxpState.noBreak=!1,c=0)):m===" "?_.push(""):_[_.length-1]+=m;break;case 13:m===")"?(R=this.mxpState.lineType,this.mxpState.lineType=4,this.getMXPBlock("MUSIC",_,e),this.mxpState.lineType=R,p=0,E+1<y&&t.charAt(E+1)===`
`?(E++,j=!1,a=[],o=[...this.getMXPOpenFormatBlocks(),C=this.getFormatBlock(c)],this.mxpState.noBreak=!1,c=0):E+2<y&&t[E+1]==="\r"&&t[E+2]===`
`&&(E+=2,j=!1,a=[],o=[...this.getMXPOpenFormatBlocks(),C=this.getFormatBlock(c)],this.mxpState.noBreak=!1,c=0)):m===" "?_.push(""):_[_.length-1]+=m;break;default:if(W&&x===7)ne?(m="\u2407",a.push(m),this.MXPCapture(m),c++,this.textLength++,this.mxpState.noBreak=!1):te&&(a.push(m),this.MXPCapture("&#x2407;"),c++,this.textLength++,this.mxpState.noBreak=!1),this.emit("bell");else if(W&&m==="\b"){if(j=!1,c>0){if(a.length){for(;a[a.length-1].length===0;)a.pop();a[a.length-1].length===1?a.pop():a[a.length-1]=a[a.length-1].substring(0,a[a.length-1].length-1)}C.offset===c&&C.offset--,c--,this.textLength--}te&&(m="\u25D8",a.push(m),this.MXPCapture(m),c++,this.textLength++),this.mxpState.noBreak=!1}else if(W&&m==="	"){let w=I-c%I;w>0&&(a.push(Array(w+1).join(" ")),this.MXPCapture(Array(w+1).join(" ")),c+=w,this.textLength+=w,this.mxpState.noBreak=!1)}else if(m===`
`){if(this.mxpState.noBreak||this.mxpState.paragraph)continue;if(this.mxpState.locked)o.push(...this.getMXPCloseFormatBlocks()),this.mxpState.on&&this.ClearMXPOpen();else{if(this.mxpState.lineType!==0&&this.emit("MXP-tag-end",this.mxpState.lineType,a.join(""),o),!this.mxpState.lineExpanded&&this.mxpLines[this.mxpState.lineType]&&this.mxpLines[this.mxpState.lineType].enabled&&(S="",this.mxpLines[this.mxpState.lineType].element.length>0&&(S+="</"+this.mxpLines[this.mxpState.lineType].element+">"),this.mxpLines[this.mxpState.lineType].closeDefinition.length>0&&(S+=this.mxpLines[this.mxpState.lineType].closeDefinition),S.length>0)){t=t.splice(E,S),y=t.length,E--,f.pop(),this.rawLength--,this.mxpState.lineExpanded=!0;continue}this.mxpState.lineExpanded=!1,o.push(...this.getMXPCloseFormatBlocks()),this.mxpState.on&&this.ClearMXPOpen(),this.mxpState.on=!1,this.mxpLines[this.mxpState.lineType]&&this.mxpLines[this.mxpState.lineType].enabled&&this.mxpLines[this.mxpState.lineType].gag&&(j=!0),this.mxpState.lineType=this.iMXPDefaultMode,this.mxpState.lineType!==2&&!this.enableMXP&&this.ResetMXP()}c=0,j||this.MXPCapture(`
`),this.AddLine(a.join(""),f.join(""),!1,j,o,e),j=!1,a=[],f=[],o=[...this.getMXPOpenFormatBlocks(),C=this.getFormatBlock(c)],this.textLength++,this.mxpState.noBreak=!1}else{if(W&&m==="\r")continue;if(W&&m==="\x1B")this._SplitBuffer+=m,p=1;else if(x<32||x===127)if(ne)x===1?m="\u263A":x===2?m="\u263B":x===3?m="\u2665":x===4?m="\u2666":x===5?m="\u2663":x===6?m="\u2660":x===7?m="\u2407":x===8?m="\u25D8":x===9?m="\u25CB":x===10?m="\u25D9":x===11?m="\u2642":x===12?m="\u2640":x===13?m="\u266A":x===14?m="\u266B":x===15?m="\u263C":x===16?m="\u25BA":x===17?m="\u25C4":x===18?m="\u2195":x===19?m="\u203C":x===20?m="\xB6":x===21?m="\xA7":x===22?m="\u25AC":x===23?m="\u21A8":x===24?m="\u2191":x===25?m="\u2193":x===26?m="\u2192":x===27?m="\u2190":x===28?m="\u221F":x===29?m="\u2194":x===30?m="\u25B2":x===31?m="\u25BC":x===127&&(m="\u2302"),a.push(m),this.MXPCapture(m),c++,this.textLength++,this.mxpState.noBreak=!1;else if(te)x=9216+x,a.push(String.fromCharCode(x)),this.MXPCapture("&#"),this.MXPCapture(x.toString()),this.MXPCapture(";"),c++,this.textLength++,this.mxpState.noBreak=!1;else continue;else if(m===" "||this._CurrentAttributes>0&&(this._CurrentAttributes&128)===128)a.push(" "),this.MXPCapture(" "),c++,this.textLength++,this.mxpState.noBreak=!1;else if(m==="<"&&E>=v)this.enableMXP&&this.mxpState.on?(d="",_=[],this._SplitBuffer+=m,p=4):(a.push("<"),this.MXPCapture("&lt;"),c++,this.textLength++);else if(m===">")a.push(">"),this.MXPCapture("&gt;"),c++,this.textLength++,this.mxpState.noBreak=!1;else if(m==="&"&&E>=v)this.enableMXP&&this.mxpState.on?(L="",this._SplitBuffer+=m,g=p,p=7):(a.push(m),c++,this.textLength++,this.mxpState.noBreak=!1);else if(m==='"')a.push(m),this.MXPCapture("&quot;"),c++,this.textLength++,this.mxpState.noBreak=!1;else if(m==="'")a.push(m),this.MXPCapture("&apos;"),c++,this.textLength++,this.mxpState.noBreak=!1;else if(m===":"){if(a.push(m),this.MXPCapture(m),c++,this.textLength++,this.mxpState.noBreak=!1,me){P="";let w,J=!1;for(O=0;O<Y;O++){if(E-this.protocols[O].length<0)continue;w=!1;let D=this.protocols[O].length;for(let B=0;B<D;B++)if(t[E-(D-B)]!==this.protocols[O][B]){w=!0;break}if(!w&&(R=a.length,F=c,z=o.length,!(R>1+D&&a[R-(2+D)].length===1&&/\S/.test(a[R-(2+D)])&&a[R-(2+D)]!=="("&&a[R-(2+D)]!=="[")&&(M=[],R=a.length-(1+D),F-=1+D,k=a.length-1,R>0&&a[R-1]==="("&&M.push(")"),R>0&&a[R-1]==="["&&M.push("]"),p=11,J=!0,J)))break}J||(p=10,R=E,F=c)}}else if(m==="."){if(a.push(m),this.MXPCapture(m),c++,this.textLength++,this.mxpState.noBreak=!1,me&&E-3>=0&&(P="http://",(t[E-1]==="w"||E[R-1]==="W")&&(t[E-2]==="w"||E[R-2]==="W")&&(t[E-3]==="w"||E[R-3]==="W"))){if(R=a.length,F=c,z=o.length,R>4&&a[R-5].length===1&&/\S/.test(a[R-5])&&a[R-5]!=="("&&a[R-5]!=="[")continue;M=[],R=a.length-4,F-=4,k=a.length-1,R>0&&a[R-1]==="("&&M.push(")"),R>0&&a[R-1]==="["&&M.push("]"),p=11}}else se&&c===0&&t.substring(E,E+8)==="!!MUSIC("?(_=[""],p=13,E+=7,this.mxpState.noBreak=!1):se&&c===0&&t.substring(E,E+8)==="!!SOUND("?(_=[""],p=12,E+=7,this.mxpState.noBreak=!1):(ne&&x>127&&x<255?x===128?m="\xC7":x===129?m="\xFC":x===130?m="\xE9":x===131?m="\xE2":x===132?m="\xE4":x===133?m="\xE0":x===134?m="\xE5":x===135?m="\xE7":x===136?m="\xEA":x===137?m="\xEB":x===138?m="\xE8":x===139?m="\xEF":x===140?m="\xEE":x===141?m="\xEC":x===142?m="\xC4":x===143?m="\xC5":x===144?m="\xC9":x===145?m="\xE6":x===146?m="\xC6":x===147?m="\xF4":x===148?m="\xF6":x===149?m="\xF2":x===150?m="\xFB":x===151?m="\xF9":x===152?m="\xFF":x===153?m="\xD6":x===154?m="\xDC":x===155?m="\xA2":x===156?m="\xA3":x===157?m="\xA5":x===158?m="\u20A7":x===159?m="\u0192":x===160?m="\xE1":x===161?m="\xED":x===162?m="\xF3":x===163?m="\xFA":x===164?m="\xF1":x===165?m="\xD1":x===166?m="\xAA":x===167?m="\xBA":x===168?m="\xBF":x===169?m="\u2310":x===170?m="\xAC":x===171?m="\xBD":x===172?m="\xBC":x===173?m="\xA1":x===174?m="\xAB":x===175?m="\xBB":x===176?m="\u2591":x===177?m="\u2592":x===178?m="\u2593":x===179?m="\u2502":x===180?m="\u2524":x===181?m="\u2561":x===182?m="\u2562":x===183?m="\u2556":x===184?m="\u2555":x===185?m="\u2563":x===186?m="\u2551":x===187?m="\u2557":x===188?m="\u255D":x===189?m="\u255C":x===190?m="\u255B":x===191?m="\u2510":x===192?m="\u2514":x===193?m="\u2534":x===194?m="\u252C":x===195?m="\u251C":x===196?m="\u2500":x===197?m="\u253C":x===198?m="\u255E":x===199?m="\u255F":x===200?m="\u255A":x===201?m="\u2554":x===202?m="\u2569":x===203?m="\u2566":x===204?m="\u2560":x===205?m="\u2550":x===206?m="\u256C":x===207?m="\u2567":x===208?m="\u2568":x===209?m="\u2564":x===210?m="\u2565":x===211?m="\u2559":x===212?m="\u2558":x===213?m="\u2552":x===214?m="\u2553":x===215?m="\u256B":x===216?m="\u256A":x===217?m="\u2518":x===218?m="\u250C":x===219?m="\u2588":x===220?m="\u2584":x===221?m="\u258C":x===222?m="\u2590":x===223?m="\u2580":x===224?m="\u03B1":x===225?m="\u03B2":x===226?m="\u0393":x===227?m="\u03C0":x===228?m="\u03A3":x===229?m="\u03C3":x===230?m="\xB5":x===231?m="\u03C4":x===232?m="\u03A6":x===233?m="\u0398":x===234?m="\u03A9":x===235?m="\u03B4":x===236?m="\u221E":x===237?m="\u2205":x===238?m="\u2208":x===239?m="\u2229":x===240?m="\u2261":x===241?m="\xB1":x===242?m="\u2265":x===243?m="\u2264":x===244?m="\u2320":x===245?m="\u2321":x===246?m="\xF7":x===247?m="\u2248":x===248?m="\xB0":x===249?m="\u2219":x===250?m="\xB7":x===251?m="\u221A":x===252?m="\u207F":x===253?m="\xB2":x===254&&(m="\u25A0"):x>255&&(C.unicode=!0),a.push(m),this.MXPCapture(m),c++,this.textLength++,this.mxpState.noBreak=!1)}break}this._SplitBuffer.length&&(this.rawLength-=this._SplitBuffer.length,f.splice(f.length-this._SplitBuffer.length,this._SplitBuffer.length)),o.push(...this.getMXPCloseFormatBlocks()),p===11&&o.splice(z,0,{formatType:1,offset:F,href:P+=a.slice(R).join("")}),this.AddLine(a.join(""),f.join(""),!0,!1,o,e)}catch(w){this.enableDebug&&this.emit("debug",w)}this.busy=!1,this.emit("parse-done"),this.parsing.shift(),this.parsing.length>0&&setTimeout(this.parseNext(),0)}parseNext(){let t=this.parsing.shift();return()=>{this.parse(t[0],t[1],!0,t[2])}}updateWindow(t,e){this.window={width:t,height:e}}Clear(){this.ResetColors(),this.textLength=0,this._SplitBuffer=""}ClearMXP(){this.mxpEntities={},this.ResetMXP(),this.mxpElements={},this.mxpState=new Ct}ResetMXP(){this.mxpStyles=[],this.mxpStyles.push(new st(0,"","",!1))}ResetMXPLine(){this.iMXPDefaultMode=0,this.mxpState.lineType=0}GetPublicEntity(t){return this.mxpEntities[t]&&this.mxpEntities[t].publish?this.mxpEntities[t].value:t}};var dt=class extends ie{constructor(t,e){super();this._updating=0;this._enableDebug=!1;this._maxView=0;this._padding=[0,0,0,0];this._enableColors=!0;this._enableBackgroundColors=!0;this._hideTrailingEmptyLine=!0;this._maxLines=500;this._wordWrap=!1;this._indent=4;this._indentPadding=0;this._wrapAt=0;this._scrollAtEnd=!1;this._lineCache=[];this._expireCache=[];this._timestamp=0;this._timestampFormat="[[]MM-DD HH:mm:ss.SSS[]] ";this._timestampWidth=new Date().toISOString().length+1;this._mouseDown=!1;this.scrollLock=!1;if(!t)throw new Error("Container must be a selector, element or jquery object");if(typeof t=="object"&&"container"in t&&(e=Object.assign(e||{},t),t=e.container,delete e.container),typeof t=="string"){if(this._container=document.querySelector(t),!this._container)throw new Error("Invalid selector for display.")}else if(t instanceof $)this._container=t[0];else if(t instanceof HTMLElement)this._container=t;else throw new Error("Container must be a selector, element or jquery object");this._styles=document.createElement("style"),this._container.appendChild(this._styles),this._character=document.createElement("span"),this._character.id=this.id+"-Character",this._character.className="line",this._character.innerHTML='<span style="border-bottom: 1px solid rgb(0, 0, 0);">W</span>',this._character.style.visibility="hidden",this._container.appendChild(this._character),this._view=document.createElement("div"),this._view.className="view",this._view.addEventListener("scroll",()=>{this._scrollAtEnd=this._view.clientHeight+this._view.scrollTop>=this._view.scrollHeight}),this._view.addEventListener("click",i=>{this.emit("click",i)}),this._view.addEventListener("contextmenu",i=>{this.emit("contextmenu",i)}),this._view.addEventListener("mousedown",i=>{this.emit("mousedown",i),this._mouseDown=!0}),this._view.addEventListener("mouseup",i=>{this.emit("mouseup",i),this._mouseDown&&this.emit("selection-done"),this._mouseDown=!1}),this._container.appendChild(this._view),this._charHeight=parseFloat(window.getComputedStyle(this._character).height),this._charWidth=parseFloat(window.getComputedStyle(this._character.firstElementChild).width),e?e.display=this:e={display:this},this.model=new Kt(e),this._wResize=i=>{this._scrollAtEnd&&this.scrollDisplay(),be(()=>{this.doUpdate(17)},250,"resize")},this._selection=i=>{this._mouseDown&&be(()=>{this.emit("selection-changed")},250,"selection-changed")},window.addEventListener("resize",this._wResize.bind(this)),document.addEventListener("selectionchange",this._selection.bind(this)),this._resizeObserver=new ResizeObserver((i,n)=>{i.length!==0&&(!i[0].contentRect||i[0].contentRect.width===0||i[0].contentRect.height===0||be(()=>{(!this._resizeObserverCache||this._resizeObserverCache.width!==i[0].contentRect.width||this._resizeObserverCache.height!==i[0].contentRect.height)&&(this._scrollAtEnd&&this.scrollDisplay(),this._resizeObserverCache={width:i[0].contentRect.width,height:i[0].contentRect.height},this.doUpdate(17),this.emit("resize"))},250,"resize"))}),this._resizeObserver.observe(this._container),this._observer=new MutationObserver(i=>{let n;for(n of i)n.type==="attributes"&&n.attributeName==="style"&&(this._scrollAtEnd&&this.scrollDisplay(),this.doUpdate(17),this.emit("resize"))}),this._observer.observe(this._container,{attributes:!0,attributeOldValue:!0,attributeFilter:["style"]}),!moment||this._timestamp!==2?this._timestampWidth=new Date().toISOString().length+1:this._timestampWidth=moment().format(this._timestampFormat).length,this.updateFont()}get showTimestamp(){return this._timestamp}set showTimestamp(t){t!==this._timestamp&&(this._timestamp=t,!moment||this._timestamp!==2?this._timestampWidth=new Date().toISOString().length+1:this._timestampWidth=moment().format(this._timestampFormat).length,this.buildStyleSheet(),this.doUpdate(35))}get timestampFormat(){return this._timestampFormat}set timestampFormat(t){this._timestampFormat!==t&&(this._timestampFormat=t,!moment||this._timestamp!==2?this._timestampWidth=new Date().toISOString().length+1:this._timestampWidth=moment().format(this._timestampFormat).length,this.doUpdate(51))}get wordWrap(){return this._wordWrap}set wordWrap(t){t!==this._wordWrap&&(this._wordWrap=t,this.buildStyleSheet(),this.doUpdate(1))}get wrapAt(){return this._wrapAt}set wrapAt(t){t!==this._wrapAt&&(this._wrapAt=t,this.buildStyleSheet(),this.doUpdate(3))}get indent(){return this._indent}set indent(t){t!==this._indent&&(this._indent=t,this.buildStyleSheet(),this.doUpdate(3))}get linkFunction(){return this._linkFunction||"doLink"}set linkFunction(t){this._linkFunction=t}get mxpLinkFunction(){return this._mxpLinkFunction||"doMXPLink"}set mxpLinkFunction(t){this._mxpLinkFunction=t}get mxpSendFunction(){return this._mxpSendFunction||"doMXPSend"}set mxpSendFunction(t){this._mxpSendFunction=t}get mxpTooltipFunction(){return this._mxpTooltipFunction||"doMXPTooltip"}set mxpTooltipFunction(t){this._mxpTooltipFunction=t}get id(){return this._container?this._container.id:""}get container(){return this._container}get lines(){return this._model.lines}get model(){return this._model}set model(t){this._model!==t&&(this._model&&this._model.removeAllListeners(),this._model=t,this._model.on("debug",this.debug,this),this._model.on("bell",()=>{this.emit("bell")}),this._model.on("add-line",e=>{this.emit("add-line",e)}),this._model.on("add-line-done",e=>{this.emit("add-line-done",e)}),this._model.on("line-added",(e,i)=>{this._lineCache.push(this.getLineHTML(e.idx))}),this._model.on("expire-links",e=>{if(this._expireCache.length){let i,n;for(let s=0,l=this._expireCache.length;s<l;s++)this.rebuildLine(this._expireCache[s])}this._expireCache=[],this.emit("expire-links")}),this._model.on("parse-done",()=>{this._view.insertAdjacentHTML("beforeend",this._lineCache.join("")),this._lineCache=[],this.doUpdate(2),this.emit("parse-done")}),this._model.on("set-title",(e,i)=>{this.emit("set-title",e,i)}),this._model.on("music",e=>{this.emit("music",e)}),this._model.on("sound",e=>{this.emit("sound",e)}),this._model.on("MXP-tag-reply",(e,i)=>{this.emit("MXP-tag-reply",e,i)}),this._model.on("expire-link-line",e=>{this._expireCache.push(e),this.doUpdate(2)}))}get maxLines(){return this._maxLines}set maxLines(t){t!==this._maxLines&&(this._maxLines=t,this.doUpdate(4))}get enableDebug(){return this._enableDebug}get enableColors(){return this._enableColors}set enableColors(t){t!==this._enableColors&&(this._enableColors=t,this.buildStyleSheet())}get enableBackgroundColors(){return this._enableBackgroundColors}set enableBackgroundColors(t){t!==this._enableBackgroundColors&&(this._enableBackgroundColors=t,this.buildStyleSheet())}get hideTrailingEmptyLine(){return this._hideTrailingEmptyLine}set hideTrailingEmptyLine(t){t!==this._hideTrailingEmptyLine&&(this._hideTrailingEmptyLine=t,this.doUpdate(2))}set enableDebug(t){this._enableDebug=t,this._model.enableDebug=t}get tabWidth(){return this._model.tabWidth}set tabWidth(t){this._model.tabWidth=t}get textLength(){return this._model.textLength}get EndOfLine(){return this._model.EndOfLine}get parseQueueLength(){return this._model.parseQueueLength}get parseQueueEndOfLine(){return this._model.parseQueueEndOfLine}get EndOfLineLength(){return this.lines.length===0?0:this.lines[this.lines.length-1].text.length}set enableFlashing(t){this._model.enableFlashing=t}get enableFlashing(){return this._model.enableFlashing}set enableMXP(t){this._model.enableMXP=t}get enableMXP(){return this._model.enableMXP}set showInvalidMXPTags(t){this._model.showInvalidMXPTags=t}get showInvalidMXPTags(){return this._model.showInvalidMXPTags}set enableBell(t){this._model.enableBell=t}get enableBell(){return this._model.enableBell}set enableURLDetection(t){this._model.enableURLDetection=t}get enableURLDetection(){return this._model.enableURLDetection}set enableMSP(t){this._model.enableMSP=t}get enableMSP(){return this._model.enableMSP}set displayControlCodes(t){this._model.displayControlCodes=t}get displayControlCodes(){return this._model.displayControlCodes}set emulateTerminal(t){this._model.emulateTerminal=t}get emulateTerminal(){return this._model.emulateTerminal}set emulateControlCodes(t){this._model.emulateControlCodes=t}get emulateControlCodes(){return this._model.emulateControlCodes}set MXPStyleVersion(t){this._model.MXPStyleVersion=t}get MXPStyleVersion(){return this._model.MXPStyleVersion}get WindowSize(){return new et(this.WindowWidth,this.WindowHeight)}get WindowWidth(){return Math.trunc(this._maxView/this._charWidth)}get WindowHeight(){return this._view.scrollWidth>this._view.clientWidth?Math.trunc((this._innerHeight-Vt()-this._padding[0]-this._padding[2])/this._charHeight):Math.trunc((this._innerHeight-this._padding[0]-this._padding[2])/this._charHeight)}get html(){let t=this.lines.length,e=[];for(let i=0;i<t;i++)e.push(this.getLineHTML(i));return e.join("")}get text(){return this._model.text}get raw(){return this._model.raw}get scrollAtBottom(){return this._scrollAtEnd}debug(t){this.emit("debug",t)}scrollDisplay(){this.scrollLock||(this._view.scrollTop=this._view.scrollHeight)}scrollTo(t,e){this._view.scrollTo(t,e)}scrollToCharacter(t,e){this._view.scrollTo(t*this._charHeight,e*this._charWidth)}scrollBy(t,e){this._view.scrollBy(t,e)}scrollUp(){this._view.scrollBy(0,-this._charHeight)}scrollDown(){this._view.scrollBy(0,this._charHeight)}pageUp(){this._view.scrollBy(0,-this._view.clientHeight)}pageDown(){this._view.scrollBy(0,this._view.clientHeight)}trimLines(){if(this._maxLines!==-1&&this.lines.length>this._maxLines){let t=this.lines.length-this._maxLines,e=t;for(;e-- >0;)this._view.removeChild(this._view.firstChild);this._model.removeLines(0,t)}}append(t,e,i,n){this._model.append(t,e||!1,i||!1,n||!1)}CurrentAnsiCode(){return this._model.CurrentAnsiCode()}removeLine(t,e){if(t<0||t>=this.lines.length)return;this.emit("line-removed",t,this.lines[t].text);let i=this._model.getLineID(t),n=document.querySelector(`[data-id="${i}"]`);this._view.removeChild(n),this._model.removeLine(t)}removeLines(t,e){t<0||t>=this.lines.length||(e<1&&(e=1),this.emit("lines-removed",t,this.lines.slice(t,t+e-1)),this._view.replaceChildren(...[].slice.call(this._view.children,0,t),...[].slice.call(this._view.children,t+e)),this._model.removeLines(t,e))}updateDisplay(){this._view.classList.remove("animate"),this.doUpdate(4),this._hideTrailingEmptyLine&&this.lines.length&&this.lines[this.lines.length-1].text.length===0&&(this._view.lastChild.style.display="none"),this.doUpdate(24),this._view.classList.add("animate")}updateWindow(t,e){t===void 0&&(t=this.WindowWidth,e=this.WindowHeight),this._model.updateWindow(t,e),this.emit("update-window",t,e)}clear(){this._model.clear(),this._view.innerHTML=""}dispose(){for(document.body.removeChild(this._character),document.body.removeChild(this._styles);this._container.firstChild;)this._view.removeChild(this._view.firstChild);window.removeEventListener("resize",this._wResize),document.removeEventListener("selectionchange",this._selection)}update(){let t=Vt();this._maxView=this._view.clientWidth-this._padding[1]-this._padding[3]-t-this._indentPadding,this._timestamp!==0&&(this._maxView-=this._timestampWidth*this._charWidth),this._innerHeight=this._view.clientHeight}updateFont(t,e){!t||t.length===0?t='"Courier New", Courier, monospace':t+=", monospace",(!e||e.length===0)&&(e="1em"),(t!==this._container.style.fontFamily||e!==this._container.style.fontSize)&&(this._container.style.fontSize=e,this._container.style.fontFamily=t,this._character.style.fontSize=e,this._character.style.fontFamily=t,this._charHeight=parseFloat(window.getComputedStyle(this._character).height),this._charWidth=parseFloat(window.getComputedStyle(this._character.firstElementChild).width),setTimeout(()=>{this._charHeight=parseFloat(window.getComputedStyle(this._character).height),this._charWidth=parseFloat(window.getComputedStyle(this._character.firstElementChild).width)},250),this.buildStyleSheet(),this.doUpdate(25));let i=window.getComputedStyle(this._view),n=[parseInt(i.getPropertyValue("padding-top"))||0,parseInt(i.getPropertyValue("padding-right"))||0,parseInt(i.getPropertyValue("padding-bottom"))||0,parseInt(i.getPropertyValue("padding-left"))||0];(n[0]!==this._padding[0]||n[1]!==this._padding[1]||n[2]!==this._padding[2]||n[3]!==this._padding[3])&&(this._padding=n,this.doUpdate(1))}buildStyleSheet(){let t="";this._enableColors||(t+=".view > span span {color: inherit !important;}"),(!this._enableColors||!this._enableBackgroundColors)&&(t+=".background > span span {background-color: inherit !important;}"),this._wordWrap?t+=".view {white-space: break-spaces; }":this._wrapAt>0&&(t+=`.view {white-space: break-spaces; } .line {width: ${this._wrapAt*this._charWidth}px !important;max-width:  ${this._wrapAt*this._charWidth}px;min-width:  ${this._wrapAt*this._charWidth}px;display: block;}`),(this._wordWrap||this._wrapAt>0)&&this._indent>0&&(t+=`.view {  padding-left: 0px !important; text-indent: ${this._indent*this._charWidth}px hanging; }`),t+=`.line > span { min-height: ${this._charHeight}}`,this._timestamp!==0&&(t+=".timestamp { display: inline-block; }"),this._styles.innerHTML=t,(this._wordWrap||this._wrapAt>0)&&this._indent>0?this._indentPadding=parseFloat(window.getComputedStyle(this._view).paddingLeft)/2:this._indentPadding=0}getLineHTML(t,e,i,n){t===void 0||t>=this.lines.length?t=this.lines.length-1:t<0&&(t=0),(e===void 0||e<0)&&(e=0),(i===void 0||i===-1)&&(i=this.lines[t].text.length);let s=[],l=0,r="",a="",o=this.lines[t].text,f=this.lines[t].formats,p=f.length,g=!1,c=this._model.getLineID(t);this._timestamp===2&&moment?s.push('<span class="timestamp" style="color:',this._model.GetColor(-7),";background:",this._model.GetColor(-8),';"',a,">",moment(this.lines[t].timestamp).format(this._timestampFormat),"</span>"):this._timestamp===1&&s.push('<span class="timestamp" style="color:',this._model.GetColor(-7),";background:",this._model.GetColor(-8),';"',a,">",new Date(this.lines[t].timestamp).toISOString()," </span>");for(let S=0;S<p;S++){let v=f[S],d,b,L=[];if(S<p-1){if(d=f[S+1],v.offset===d.offset&&d.formatType===v.formatType)continue;b=d.offset}else b=o.length;if(l=v.offset,b>i&&(b=i),l<e&&(l=e),v.formatType===0){if(r=[],a=[],typeof v.background=="number"?r.push("background:",this._model.GetColor(v.background),";"):v.background&&r.push("background:",v.background,";"),typeof v.color=="number"?r.push("color:",this._model.GetColor(v.color),";"):v.color&&r.push("color:",v.color,";"),v.font&&r.push("font-family: ",v.font,";"),v.size&&r.push("font-size: ",v.size,";"),v.style!==0?((v.style&1)===1&&r.push("font-weight: bold;"),(v.style&4)===4&&r.push("font-style: italic;"),(v.style&1024)===1024&&L.push("overline "),((v.style&512)===512||(v.style&8)===8)&&L.push("underline "),(v.style&512)===512?r.push("border-bottom: 1px solid ",typeof v.color=="number"?this._model.GetColor(v.color):v.color,";"):r.push("border-bottom: 1px solid ",typeof v.background=="number"?this._model.GetColor(v.background):v.background,";"),((v.style&32)===32||(v.style&16)===16)&&(this.enableFlashing?a.push(" ansi-blink"):(v.style&512)!==512&&(v.style&8)!==8&&L.push("underline ")),(v.style&256)===256&&L.push("line-through "),L.length>0&&r.push("text-decoration:",L.join("").trim(),";")):r.push("border-bottom: 1px solid ",typeof v.background=="number"?this._model.GetColor(v.background):v.background,";"),l<e||b<e)continue;r=r.join("").trim(),a.length!==0?a=' class="'+a.join("").trim()+'"':a="",v.hr?s.push('<span style="',r,'min-width:100%;width:100%;"',a,'><div style="position:relative;top: 50%;transform: translateY(-50%);height:4px;width:100%; background-color:',typeof v.color=="number"?this._model.GetColor(v.color):v.color,'"></div></span>'):b-l!==0&&s.push('<span style="',r,'"',a,">",ae(o.substring(l,b)),"</span>")}else if(v.formatType===1){if(l<e||b<e||(s.push('<a draggable="false" class="URLLink" href="javascript:void(0);" title="'),s.push(v.href.replace(/"/g,"&quot;")),s.push('" onclick="',this.linkFunction,"('",v.href.replace(/\\/g,"\\\\").replace(/"/g,"&quot;"),`');return false;">`),b-l===0))continue;s.push('<span style="',r,'"',a,">"),s.push(ae(o.substring(l,b))),s.push("</span>")}else if(v.formatType===2||v.formatType===4||v.formatType===8){if(l<e||b<e)continue;s.push("</a>")}else if(v.formatType===3){if(l<e||b<e||(s.push('<a draggable="false" class="MXPLink" href="javascript:void(0);" title="'),s.push(v.href.replace(/"/g,"&quot;")),s.push('"'),v.expire&&v.expire.length&&s.push(` data-expire="${v.expire}"`),s.push(' onclick="',this.mxpLinkFunction,"(this, '",v.href.replace(/\\/g,"\\\\").replace(/"/g,"&quot;"),`');return false;">`),b-l===0))continue;s.push('<span style="',r,'"',a,">"),s.push(ae(o.substring(l,b))),s.push("</span>")}else if(v.formatType===7){if(l<e||b<e||(s.push('<a draggable="false" class="MXPLink" href="javascript:void(0);" title="'),s.push(v.hint.replace(/"/g,"&quot;")),s.push('"'),v.expire&&v.expire.length&&s.push(` data-expire="${v.expire}"`),s.push(' onmouseover="',this.mxpTooltipFunction,'(this);"'),s.push(' onclick="',this.mxpSendFunction,"(event||window.event, this, ",v.href.replace(/\\/g,"\\\\").replace(/"/g,"&quot;"),", ",v.prompt?"1":"0",", ",v.tt.replace(/\\/g,"\\\\").replace(/"/g,"&quot;"),');return false;">'),b-l===0))continue;s.push('<span style="',r,'"',a,">"),s.push(ae(o.substring(l,b))),s.push("</span>")}else if(v.formatType===9&&b-l!==0){if(l<e||b<e)continue;s.push('<span style="',r,'"',a,">"),s.push(ae(o.substring(l,b))),s.push("</span>")}else if(v.formatType===5){if(l<e||b<e)continue;let P="";switch(s.push('<img src="'),v.url.length>0&&(s.push(v.url),P+=v.url,v.url.endsWith("/")||(s.push("/"),P+="/")),v.t.length>0&&(s.push(v.t),P+=v.t,v.t.endsWith("/")||(s.push("/"),P+="/")),P+=v.name,s.push(v.name,'"  style="'),v.w.length>0&&s.push("width:",qe(v.w,this._charWidth),";"),v.h.length>0&&s.push("height:",qe(v.h,this._charHeight),";"),v.align.toLowerCase()){case"left":s.push("float:left;");break;case"right":s.push("float:right;"),g=!0;break;case"top":case"middle":case"bottom":s.push("vertical-align:",v.align,";");break}v.hspace.length>0&&v.vspace.length>0?(s.push("margin:"),s.push(qe(v.vspace,this._charWidth)," "),s.push(qe(v.hspace,this._charHeight),";")):v.hspace.length>0?(s.push("margin:"),s.push("0px ",qe(v.hspace,this._charHeight),";")):v.vspace.length>0&&(s.push("margin:"),s.push(qe(v.vspace,this._charWidth)," 0px;")),s.push('"'),v.ismap&&s.push(' ismap onclick="return false;"'),s.push(`src="${P}"/>`)}}return n?g&&i<this.lines[t].text.length?s.join(""):g?s.join("")+"<br>":i<this.lines[t].text.length?s.join(""):s.join("")+"<br>":g&&i<this.lines[t].text.length?`<span data-id="${c}" class="line" style="min-width:100%">${s.join("")}</span>`:g?`<span data-id="${c}" class="line" style="min-width:100%">${s.join("")}<br></span>`:i<this.lines[t].text.length?`<span data-id="${c}" class="line">${s.join("")}</span>`:`<span  data-id="${c}" class="line">${s.join("")}<br></span>`}getLineText(t,e){return t<0||t>=this.lines.length||!this.lines[t]?"":this.lines[t].text}rebuildLine(t){this.rebuildLines(t,t)}rebuildLines(t,e){if(!this.lines.length)return;(t===void 0||t<0)&&(t=0),(e===void 0||e===-1||e>=this.lines.length)&&(e=this.lines.length-1);let i=this.lines,n=[],s=t;for(;s<=e;s++)n.push(this.getLineHTML(s));t===0&&e===this.lines.length-1?this._view.innerHTML=n.join(""):(this._view.replaceChildren(...[].slice.call(this._view.children,0,t),...[].slice.call(this._view.children,e+1)),t===0?this._view.firstElementChild.insertAdjacentHTML("beforebegin",n.join("")):this._view.children[t-1].insertAdjacentHTML("afterend",n.join("")))}doUpdate(t){t&&(this._updating|=t,this._updating!==0&&window.requestAnimationFrame(()=>{this._updating!==0&&((this._updating&32)===32&&(this.rebuildLines(),this._updating&=-33),(this._updating&1)===1&&(this.update(),this._updating&=-2),(this._updating&2)===2&&(this.updateDisplay(),this._updating&=-3),(this._updating&4)===4&&(this.trimLines(),this._updating&=-5),(this._updating&8)===8&&(this.scrollDisplay(),this._updating&=-9),(this._updating&16)===16&&(this.updateWindow(),this._updating&=-17),this.doUpdate(this._updating))}))}colorSubStrByLine(t,e,i,n,s,l){this.colorSubStringByLine(t,e,i,n,(n||0)+(s||0),l)}colorSubStringByLine(t,e,i,n,s,l){this._model.colorSubStringByLine(t,e,i,n,s,l)&&this.rebuildLine(t)}removeStyleSubStrByLine(t,e,i,n){this.removeStyleSubStringByLine(t,e,i,(i||0)+(n||0))}removeStyleSubStringByLine(t,e,i,n){this._model.removeStyleSubStringByLine(t,e,i,n)&&this.rebuildLine(t)}highlightSubStrByLine(t,e,i){this.highlightStyleSubStringByLine(t,e,(e||0)+(i||0))}highlightStyleSubStringByLine(t,e,i,n){this._model.highlightStyleSubStringByLine(t,e,i,n)&&this.rebuildLine(t)}SetColor(t,e){this._model.SetColor(t,e)}ClearMXP(){this._model.ClearMXP()}ResetMXPLine(){this._model.ResetMXPLine()}get hasSelection(){let t=window.getSelection();if(t.rangeCount>0){let e=t.getRangeAt(0);return this._view.contains(e.commonAncestorContainer)&&t.toString().length!==0}return!1}get selection(){if(window.getSelection){let t=window.getSelection();if(t.rangeCount>0){let e=t.getRangeAt(0);if(this._view.contains(e.startContainer)||this._view.contains(e.endContainer))return t.toString()}}return""}get selectionAsHTML(){var t;if(window.getSelection){var e=window.getSelection();if(e.rangeCount>0){if(t=e.getRangeAt(0),!this._view.contains(t.startContainer)&&!this._view.contains(t.endContainer))return"";var i=t.cloneContents(),n=document.createElement("div");return n.appendChild(i),n.innerHTML}else return""}else return document.selection&&document.selection.createRange?(t=document.selection.createRange(),t.htmlText):""}selectAll(){let t;window.getSelection?window.getSelection().selectAllChildren?window.getSelection().selectAllChildren(this._view):(t=document.createRange(),t.selectNode(this._view),window.getSelection().addRange(t)):document.selection&&(t=document.body.createTextRange(),t.moveToElementText(this._view),t.select())}clearSelection(){let t=window.getSelection();if(t.rangeCount>0){let e=t.getRangeAt(0);(this._view.contains(e.startContainer)||this._view.contains(e.endContainer))&&t.removeAllRanges()}}getLineOffset(t,e){let i=document.elementsFromPoint(t,e),n;for(let l=0,r=i.length;l<r&&this._view!==i[l];l++)if(this._view.contains(i[l])){n=i[l];break}if(!n||!this._view.contains(n)&&this._view!=n)return{x:-1,y:-1,lineID:-1};if(n.classList.contains("line"))return{x:0,y:this.model.getLineFromID(+n.dataset.id),lineID:+n.dataset.id};let s=n.closest(".line");return s?{x:0,y:this.model.getLineFromID(+s.dataset.id),lineID:+s.dataset.id}:{x:-1,y:-1,lineID:-1}}getWordFromPosition(t,e){let i=document.elementsFromPoint(t,e),n;for(let s=0,l=i.length;s<l;s++){if(this._view===i[s])return"";if(this._view.contains(i[s])){n=i[s];break}}if(n&&n.textContent){let s=n.textContent,l=s.lastIndexOf(" ",t)+1,r=s.indexOf(" ",t);return r===-1&&(r=s.length),s.substring(l,r)}return""}},Kt=class extends ie{constructor(t){super();this._lineID=0;this.lines=[];this.lineIDs=[];this._expire={};this._expire2=[];this._parser=new It(t),this._parser.on("debug",e=>{this.emit(e)}),this._parser.on("bell",()=>{this.emit("bell")}),this._parser.on("add-line",e=>{this.addParserLine(e,!0)}),this._parser.on("expire-links",e=>{let i,n,s;if(!e||e.length===0){for(n in this._expire2)this._expire2.hasOwnProperty(n)&&this.expireLineLinkFormat(this._expire2[n],+n);for(s in this._expire)if(this._expire.hasOwnProperty(s)){i=this._expire[s];for(n in i)i.hasOwnProperty(n)&&this.expireLineLinkFormat(i[n],+n)}this._expire2=[],this._expire={},this.emit("expire-links",e)}else if(this._expire[e]){i=this._expire[e];for(n in i)i.hasOwnProperty(n)&&this.expireLineLinkFormat(i[n],+n);delete this._expire[e],this.emit("expire-links",e)}}),this._parser.on("parse-done",()=>{this.emit("parse-done")}),this._parser.on("set-title",(e,i)=>{this.emit("set-title",e,i)}),this._parser.on("music",e=>{this.emit("music",e)}),this._parser.on("sound",e=>{this.emit("sound",e)}),this._parser.on("MXP-tag-reply",(e,i)=>{this.emit("MXP-tag-reply",e,i)})}get enableDebug(){return this._parser.enableDebug}set enableDebug(t){this._parser.enableDebug=t}get tabWidth(){return this._parser.tabWidth}set tabWidth(t){this._parser.tabWidth=t}get textLength(){return this._parser.textLength}get EndOfLine(){return this._parser.EndOfLine}get parseQueueLength(){return this._parser.parseQueueLength}get parseQueueEndOfLine(){return this._parser.parseQueueEndOfLine}set enableFlashing(t){this._parser.enableFlashing=t}get enableFlashing(){return this._parser.enableFlashing}set enableMXP(t){this._parser.enableMXP=t}get enableMXP(){return this._parser.enableMXP}set showInvalidMXPTags(t){this._parser.showInvalidMXPTags=t}get showInvalidMXPTags(){return this._parser.showInvalidMXPTags}set enableBell(t){this._parser.enableBell=t}get enableBell(){return this._parser.enableBell}set enableURLDetection(t){this._parser.enableURLDetection=t}get enableURLDetection(){return this._parser.enableURLDetection}set enableMSP(t){this._parser.enableMSP=t}get enableMSP(){return this._parser.enableMSP}set displayControlCodes(t){this._parser.displayControlCodes=t}get displayControlCodes(){return this._parser.displayControlCodes}set emulateTerminal(t){this._parser.emulateTerminal=t}get emulateTerminal(){return this._parser.emulateTerminal}set emulateControlCodes(t){this._parser.emulateControlCodes=t}get emulateControlCodes(){return this._parser.emulateControlCodes}set MXPStyleVersion(t){this._parser.StyleVersion=t}get MXPStyleVersion(){return this._parser.StyleVersion}addParserLine(t,e){if(t.timestamp=Date.now(),this.emit("add-line",t),t==null||typeof t>"u"||t.line==null||typeof t.line>"u"||(this.emit("add-line-done",t),t.gagged))return;let i={text:t.line===`
`||t.line.length===0?"":t.line,raw:t.raw,formats:t.formats,id:this._lineID,timestamp:t.timestamp};this.lines.push(i),this.lineIDs.push(this._lineID),this._lineID++,this.buildLineExpires(this.lines.length-1),this.emit("line-added",t,e)}expireLineLinkFormat(t,e){let i,n,s,l,r,a,o,f=0;for(n=0,l=t.length;n<l;n++)for(s=this.lines[e].formats.length,i=t[n],o=this.lines[e].formats[i],r=o.formatType,o.formatType===3?a=4:a=8,o.formatType=9,i++;i<s;i++)if(this.lines[e].formats[i]===a)if(f===0){this.lines[e].formats[i].formatType=10;break}else f--;else this.lines[e].formats[i]===r&&f++;this.emit("expire-link-line",e)}clear(){this._parser.Clear(),this.lines=[],this._expire={},this._expire2=[],this.lineIDs=[],this._lineID=0}IncreaseColor(t,e){return this._parser.IncreaseColor(t,e)}GetColor(t){return this._parser.GetColor(t)}append(t,e,i,n){this._parser.parse(t,e||!1,i||!1,n||!1)}CurrentAnsiCode(){return this._parser.CurrentAnsiCode()}updateWindow(t,e){this._parser.updateWindow(t,e)}SetColor(t,e){this._parser.SetColor(t,e)}ClearMXP(){this._parser.ClearMXP()}ResetMXPLine(){this._parser.ResetMXPLine()}get busy(){return this._parser.busy}removeLine(t){this.lines.splice(t,1),this.lineIDs.splice(t,1),this._expire2.splice(t,1)}removeLines(t,e){this.lines.splice(t,e),this.lineIDs.splice(t,e),this._expire2.splice(t,e);for(let i in this._expire)!this._expire.hasOwnProperty(i)||this._expire[i].length===0||t>=this._expire[i].length||this._expire[i].splice(t,e)}getLineID(t){return t<0||t>=this.lineIDs.length?-1:this.lineIDs[t]}get getNextLineID(){return this._lineID}getLineFromID(t){return this.lineIDs.indexOf(t)}buildLineExpires(t){t===void 0&&(t=this.lines.length-1);let e=this.lines[t].formats;for(let s in this._expire)this._expire.hasOwnProperty(s)&&this._expire[s][t]&&delete this._expire[s][t];delete this._expire2[t];let i=e.length,n;for(;i--;)n=e[i],(n.formatType===7||n.formatType===3)&&(n.expire&&n.expire.length>0?(this._expire[n.expire]||(this._expire[n.expire]=[]),this._expire[n.expire][t]||(this._expire[n.expire][t]=[]),this._expire[n.expire][t].push(i)):(this._expire2[t]||(this._expire2[t]=[]),this._expire2[t].push(i)))}colorSubStrByLine(t,e,i,n,s,l){return this.colorSubStringByLine(t,e,i,n,n+s,l)}colorSubStringByLine(t,e,i,n,s,l){if(t<0||t>=this.lines.length)return!1;let r=this.lines[t].text.length;if(n>=r||((!n||n<0)&&(n=0),(!s||s>r)&&(s=r),n===s))return!1;let a=this.lines[t].formats,o=a.length,f=!1;if(n===0&&s>=r){for(let p=0;p<o;p++){let g=a[p];g.formatType===0&&(f=!0,g.bStyle&&(g.bStyle=0,g.fStyle=0,g.fCls=0),g.color=e||g.color,g.background=i||g.background,g.style|=l||0)}f||a.unshift({formatType:0,offset:0,color:e||0,background:i||0,size:0,font:0,style:l||0,unicode:!1})}else{let p,g;for(let c=0;c<o;c++){let S=a[c];if(S.formatType===0){if(c<o-1){let v=c+1;if(p=a[v],S.offset===p.offset&&p.formatType===S.formatType)continue;for(;S.offset===p.offset&&p.formatType===S.formatType&&v<o-1;)p=a[++v];v===o&&S.offset===p.offset?g=r:g=p.offset}else g=r;n<S.offset||n>=g||(f=!0,S.bStyle&&(S.bStyle=0,S.fStyle=0,S.fCls=0),s<g&&(S.width=0,a.splice(c+1,0,{formatType:S.formatType,offset:s,color:S.color,background:S.background,size:S.size,font:S.font,style:S.style,unicode:S.unicode}),o++),n!=S.offset?(S.width=0,a.splice(c+1,0,{formatType:S.formatType,offset:n,color:e||S.color,background:i||S.background,size:S.size,font:S.font,style:S.style|(l||0),unicode:S.unicode}),o++):(S.color=e||S.color,S.background=i||S.background,S.style|=l||0),s>g&&(n=g))}}this.lines[t].formats=this.pruneFormats(a,this.textLength)}return!0}removeStyleSubStrByLine(t,e,i,n){return this.removeStyleSubStringByLine(t,e,i,i+n)}removeStyleSubStringByLine(t,e,i,n){if(t<0||t>=this.lines.length)return!1;let s=this.lines[t].text.length;if(i>=s)return!1;(!i||i<0)&&(i=0),(!n||n>s)&&(n=s);let l=this.lines[t].formats,r=l.length,a=!1;if(i===0&&n>=s){for(let o=0;o<r;o++){let f=l[o];f.formatType===0&&(a=!0,f.bStyle&&(f.bStyle=0,f.fStyle=0,f.fCls=0),f.style&=~(e||0))}a||l.unshift({formatType:0,offset:0,color:0,background:0,size:0,font:0,style:0,unicode:!1})}else{let o,f;for(let p=0;p<r;p++){let g=l[p];if(g.formatType===0){if(p<r-1){let c=p+1;if(o=l[c],g.offset===o.offset&&o.formatType===g.formatType)continue;for(;g.offset===o.offset&&o.formatType===g.formatType&&c<r-1;)o=l[++c];c===r&&g.offset===o.offset?f=s:f=o.offset}else f=s;i<g.offset||i>=f||(a=!0,g.bStyle&&(g.bStyle=0,g.fStyle=0,g.fCls=0),n<f&&(g.width=0,l.splice(p+1,0,{formatType:g.formatType,offset:n,color:g.color,background:g.background,size:g.size,font:g.font,style:g.style,unicode:g.unicode}),r++),i!=g.offset?(g.width=0,l.splice(p+1,0,{formatType:g.formatType,offset:i,color:g.color,background:g.background,size:g.size,font:g.font,style:g.style&~(e||0),unicode:g.unicode}),r++):g.style&=~(e||0),n>f&&(i=f))}}this.lines[t].formats=this.pruneFormats(l,this.textLength)}return!0}highlightSubStrByLine(t,e,i){return this.highlightStyleSubStringByLine(t,e,e+i)}highlightStyleSubStringByLine(t,e,i,n){if(t<0||t>=this.lines.length)return!1;let s=this.lines[t].text.length;if(e>=s)return!1;(!e||e<0)&&(e=0),(!i||i>s)&&(i=s);let l=this.lines[t].formats,r=l.length,a=!1;if(e===0&&i>=s){for(let o=0;o<r;o++){let f=l[o];f.formatType===0&&(a=!0,f.bStyle&&(f.bStyle=0,f.fStyle=0,f.fCls=0),n||(f.style&1)===1?typeof f.color=="number"?f.color=this._parser.IncreaseColor(this._parser.GetColor(f.color),.25):f.color=this._parser.IncreaseColor(f.color,.25):f.style|=1)}a||l.unshift({formatType:0,offset:0,color:n?370:0,background:0,size:0,font:0,style:n?0:1,unicode:!1})}else{let o,f;for(let p=0;p<r;p++){let g=l[p];if(g.formatType===0){if(p<r-1){let c=p+1;if(o=l[c],g.offset===o.offset&&o.formatType===g.formatType)continue;for(;g.offset===o.offset&&o.formatType===g.formatType&&c<r-1;)o=l[++c];c===r&&g.offset===o.offset?f=s:f=o.offset}else f=s;e<g.offset||e>=f||(a=!0,g.bStyle&&(g.bStyle=0,g.fStyle=0,g.fCls=0),i<f&&(g.width=0,l.splice(p+1,0,{formatType:g.formatType,offset:i,color:g.color,background:g.background,size:g.size,font:g.font,style:g.style,unicode:g.unicode}),r++),e!=g.offset?(g.width=0,o={formatType:g.formatType,offset:e,color:g.color,background:g.background,size:g.size,font:g.font,style:g.style,unicode:g.unicode},n||(g.style&1)===1?typeof g.color=="number"?o.color=this._parser.IncreaseColor(this._parser.GetColor(g.color),.25):o.color=this._parser.IncreaseColor(g.color,.25):o.style|=1,l.splice(p+1,0,o),r++):n||(g.style&1)===1?typeof g.color=="number"?g.color=this._parser.IncreaseColor(this._parser.GetColor(g.color),.25):g.color=this._parser.IncreaseColor(g.color,.25):g.style|=1,i>f&&(e=f))}}this.lines[t].formats=this.pruneFormats(l,this.textLength)}return!0}pruneFormats(t,e){if(!t||t.length<2)return t;let i=t.length,n=[];for(let s=0;s<i;s++){let l=t[s],r;if(s<i-1){let a=t[s+1];if(l.offset===a.offset&&a.formatType===l.formatType||(r=a.offset,l.formatType===1&&r-l.offset===0&&a.formatType===2)||l.formatType===7&&r-l.offset===0&&a.formatType===8||l.formatType===3&&r-l.offset===0&&a.formatType===4)continue;if(l.formatType===a.formatType&&l.color===a.color&&l.background===a.background&&l.size===a.size&&l.font===a.font&&l.style===a.style&&l.unicode===a.unicode){a.offset=l.offset,a.width=0;continue}}else if(l.offset===e&&e!==0&&(l.formatType===0&&!l.hr||l.formatType===1||l.formatType===7||l.formatType===3))continue;n.push(l)}return n}get text(){return this.lines.map(t=>t.text).join(`
`)}get raw(){return this.lines.map(t=>t.raw).join("")}getText(t,e,i){return t<0||t>=this.lines.length?"":(e<0&&(e=0),typeof i>"u"||i>this.lines[t].text.length?this.lines[t].text.substring(e):this.lines[t].text.substring(e,i))}};var bi="0.0.1-alpha";var Ue=ri(wi());var nt=class extends ie{#e;get client(){return this.#e}set client(h){h!==this.#e&&(this.remove(),this.#e=h,this.initialize())}constructor(h){super(),this.#e=h}};var Bt=class extends ie{constructor(){super(...arguments);this._file="";this._repeats=1;this._volume=100;this._priority=50;this._retries=0;this.current=0;this.sound=null;this.playing=!1;this.url="";this.continue=!0;this.maxErrorRetries=0}set file(t){this.continue||this.close(),this._file=t}get file(){return this._file}set repeats(t){t>=-1?this._repeats=t:this._repeats=1,this.current=0}get repeats(){return this._repeats}set volume(t){t>=0&&t<=100?this._volume=t:this._volume=1}get volume(){return this._volume}set priority(t){t>=0&&t<=100?this._priority=t:this._priority=50}get priority(){return this._priority}play(){this.playing=!0,this._repeats>0&&this.current<this._repeats?(this.current++,this.close(),this.open().then(()=>{this._retries=0,this.sound.setVolume(this._volume).play(),this.current<this._repeats?this.sound.bind("ended abort",t=>{this.play()}):this.sound.bind("ended abort",t=>{this.playing=!1,this.emit("ended")}),this.sound.isEnded()&&(this.playing=!1)}).catch(t=>{this._retries<this.maxErrorRetries?(this.current--,this.play(),this._retries++):this._retries=0})):this._repeats===-1?(this.close(),this.open().then(()=>{this._retries=0,this.sound.setVolume(this._volume).loop().play(),this.sound.isEnded()&&(this.playing=!1)}).catch(t=>{this._retries<this.maxErrorRetries?(this.play(),this._retries++):this._retries=0})):this.playing=!1}async open(){return this.close(),new Promise((t,e)=>{this.sound=new Ue.sound()(this.url+this._file),this.sound.bind("loadeddata",i=>{this.emit("playing",{file:this._file,sound:this.sound,state:this,duration:Ue.toTimer(this.sound.getDuration())}),t(1)}),this.sound.bind("error",i=>{if(i&&i.currentTarget&&i.currentTarget.error)switch(i.currentTarget.error.code){case 1:this.emit("error",new Error(`MSP - Aborted: ${this.url}${this._file}`));break;case 2:this.emit("error",new Error(`MSP - Network error: ${this.url}${this._file}`));break;case 3:this.emit("error",new Error(`MSP - Could not decode: ${this.url}${this._file}`));break;case 4:this.emit("error",new Error(`MSP - Source not supported: ${this.url}${this._file}`));break}else i&&i.currentTarget&&i.currentTarget.networkState===3?this.emit("error",new Error(`MSP - Source not found or unable to play: ${this.url}${this._file}`)):this.emit("error",new Error("MSP - Unknown error"));e()}),this.emit("opened")})}close(){this.sound?(this.stop(),delete this.sound,this.sound=null):this.playing&&(this.playing=!1),this.emit("closed")}stop(){this.sound&&this.sound.stop(),this.playing=!1,this.emit("stopped")}},Rt=class extends nt{constructor(t){super(t instanceof rt?t:t?.client);this._enabled=!0;this._enableSound=!0;this._maxErrorRetries=1;this.server=!1;this.enableDebug=!1;this.defaultSoundURL="";this.defaultMusicURL="";this.forcedDefaultMusicURL="http://"+window.location.hostname+"/sounds/";this.forcedDefaultSoundURL="http://"+window.location.hostname+"/sounds/";this.defaultSoundExt=".m4a";this.defaultMusicExt=".m4a";this.MusicState=new Bt;this.SoundState=new Bt;this.parseMode=0;t&&!(t instanceof rt)&&("forcedDefaultMusicURL"in t&&(this.forcedDefaultMusicURL=t.forcedDefaultMusicURL),"forcedDefaultSoundURL"in t&&(this.forcedDefaultSoundURL=t.forcedDefaultSoundURL)),this.MusicState.on("playing",e=>{e.type=1,this.emit("playing",e)}),this.SoundState.on("playing",e=>{e.type=0,this.emit("playing",e)}),this.MusicState.on("error",e=>{this.emit("error",e)}),this.SoundState.on("error",e=>{this.emit("error",e)}),this.MusicState.maxErrorRetries=this._maxErrorRetries,this.SoundState.maxErrorRetries=this._maxErrorRetries}remove(){if(!this.client)return;this.client.removeListenersFromCaller(this);let t=this.client.telnet.GMCPSupports.indexOf("Client.Media 1");this.client.telnet.GMCPSupports.splice(t,1)}initialize(){this.client&&(this.client.telnet.GMCPSupports.push("Client.Media 1"),this.client.on("connecting",()=>this.reset(),this),this.client.on("close",()=>this.reset(),this),this.client.on("received-option",this.processOption,this),this.client.on("received-GMCP",this.processGMCP,this),this.client.on("music",this.music,this),this.client.on("sound",this.sound,this),this.client.on("options-loaded",this.loadOptions,this),this.client.on("option-loaded",this.setOption,this),this.client.on("function",this.processFunction,this),this.on("playing",t=>{this.client&&(this.debug("MSP "+(t.type?"Music":"Sound")+" Playing "+t.file+" for "+t.duration),this.debug(t),this.client.getOption("notifyMSPPlay")&&this.client.echo((t.type?"Music":"Sound")+" Playing "+t.file+" for "+t.duration,-7,-8,!0,!0))}),this.on("debug",t=>this.client.debug(t),this),this.on("error",t=>this.client.error(t),this),this.loadOptions())}get menu(){return[]}get settings(){return[]}loadOptions(){this.enableDebug=this.client.getOption("enableDebug"),this.enabled=this.client.getOption("enableMSP"),this.enableSound=this.client.getOption("enableSound"),this.maxErrorRetries=this.client.getOption("mspMaxRetriesOnError")}setOption(t,e){switch(t){case"enableMSP":this.enabled=this.client.getOption("enableMSP");break;case"mspMaxRetriesOnError":this.maxErrorRetries=this.client.getOption("mspMaxRetriesOnError");break;case"enableSound":case"enableDebug":this[t]=e;break}}get enabled(){return this._enabled}set enabled(t){t!==this._enabled&&(this._enabled=t,this.MusicState?.close(),this.SoundState?.close())}get maxErrorRetries(){return this._maxErrorRetries}set maxErrorRetries(t){t!==this._maxErrorRetries&&(this._maxErrorRetries=t,this.MusicState&&(this.MusicState.maxErrorRetries=t),this.SoundState&&(this.SoundState.maxErrorRetries=t))}get enableSound(){return this._enableSound}set enableSound(t){t!==this._enableSound&&(this._enableSound=t,this.MusicState?.close(),this.SoundState?.close())}getArguments(t,e){let i={off:!1,file:"",url:"",volume:100,repeat:1,priority:50,type:"",continue:!0},n=[],s=0,l=[],r=0,a=t.length,o,f,p;for(;r<a;r++)switch(o=t.charAt(r),s){case 1:o==="'"&&(s=0),l.push(o);break;case 2:o==="'"&&(s=0),l.push(o);break;default:o===" "?(n.push(l.join("")),l=[]):o==="'"?(s=1,l.push(o)):(o==="'"&&(s=2),l.push(o));break}for(l.length>0&&(n.push(l.join("")),l=[]),r=0,a=n.length,this.debug("MSP arguments found: "+n),r=0;r<a;r++)if(f=n[r].split("="),f.length>1)switch(f[0].toUpperCase()){case"FNAME":i.file=G(f[1]),i.file.toLowerCase()==="off"&&(i.off=!0,i.file="");break;case"V":p=parseInt(f[1],10),isNaN(p)&&(p=100),i.volume=p;break;case"L":p=parseInt(f[1],10),isNaN(p)&&(p=1),i.repeat=p;break;case"P":p=parseInt(f[1],10),isNaN(p)&&(p=1),i.priority=p;break;case"C":i.continue=f[1]!=="0";break;case"T":f[1].length>0&&(i.type=f[1]);break;case"U":i.url=G(f[1]),!i.url.endsWith("/")&&i.url.length>0&&(i.url+="/");break}else r===0?(i.file=G(n[r]),i.file.toLowerCase()==="off"&&(i.off=!0,i.file="")):r===1?(p=parseInt(n[r],10),isNaN(p)&&(p=100),i.volume=p):r===2?(p=parseInt(n[r],10),isNaN(p)&&(p=1),i.repeat=p):r===3&&e===1?i.continue=n[r]!=="0":r===3?(p=parseInt(n[r],10),isNaN(p)&&(p=1),i.priority=p):r===4?n[r].length>0&&(i.type=n[r]):r===5&&(i.url=G(n[r]),!i.url.endsWith("/")&&i.url.length>0&&(i.url+="/"));return this.debug(i),i}reset(){this.server=!1}music(t){if(!this.enabled&&!this.enableSound)return!1;if(!t.file||t.file.length===0){t.off&&t.url&&t.url.length>0?this.defaultMusicURL=t.url:t.off&&this.MusicState.stop();return}else if(t.off){this.MusicState.stop();return}this.MusicState.volume=t.volume,this.MusicState.repeats=t.repeat,this.MusicState.continue=t.continue;let e=this.MusicState.file;t.file.lastIndexOf(".")===-1?this.MusicState.file=t.file+this.defaultMusicExt:this.MusicState.file=t.file,t.url&&t.url.length>0?this.MusicState.url=t.url:this.forcedDefaultMusicURL&&this.forcedDefaultMusicURL.length>0?this.MusicState.url=this.forcedDefaultMusicURL:this.defaultMusicURL&&this.defaultMusicURL.length>0?this.MusicState.url=this.defaultMusicURL:this.MusicState.url="",this.MusicState.url.length>0&&!this.MusicState.url.endsWith("/")&&(this.MusicState.url+="/"),t.type&&t.type.length>0&&(this.MusicState.url+=t.type,this.MusicState.url.length>0&&!this.MusicState.url.endsWith("/")&&(this.MusicState.url+="/")),(e!==this.MusicState.file||!t.continue||!this.MusicState.playing)&&(this.enableSound?this.MusicState.play():this.emit("playing",{type:1,file:this.MusicState.file,sound:this.MusicState.sound,state:this.MusicState,duration:"--:--"}))}sound(t){if(!this.enabled&&!this.enableSound)return!1;if(!t.file||t.file.length===0){t.off&&t.url&&t.url.length>0?this.defaultSoundURL=t.url:t.off&&this.SoundState.stop();return}else if(t.off){this.SoundState.stop();return}if(this.SoundState.playing&&t.priority<this.SoundState.priority)return!1;this.SoundState.volume=t.volume,this.SoundState.repeats=t.repeat,this.SoundState.priority=t.priority,t.file.lastIndexOf(".")===-1?this.SoundState.file=t.file+this.defaultSoundExt:this.SoundState.file=t.file,t.url&&t.url.length>0?this.SoundState.url=t.url:this.forcedDefaultSoundURL&&this.forcedDefaultSoundURL.length>0?this.SoundState.url=this.forcedDefaultSoundURL:this.defaultSoundURL&&this.defaultSoundURL.length>0?this.SoundState.url=this.defaultSoundURL:this.SoundState.url="",this.SoundState.url.length>0&&!this.SoundState.url.endsWith("/")&&(this.SoundState.url+="/"),t.type&&t.type.length>0&&(this.SoundState.url+=t.type,this.SoundState.url.length>0&&!this.SoundState.url.endsWith("/")&&(this.SoundState.url+="/")),this.enableSound?this.SoundState.play():this.emit("playing",{type:0,file:this.SoundState.file,sound:this.SoundState.sound,state:this.SoundState,duration:"--:--"})}processOption(t){t.option===90&&(this.debug("<MSP>"),t.verb===253?(this.server=!0,this.enabled?(this.debug("REPLY: <IAC><WILL><MSP>"),t.telnet.sendData([255,251,90],!0)):(this.debug("REPLY: <IAC><DONT><MSP>"),t.telnet.sendData([255,254,90],!0))):t.verb===254?(this.server=!1,this.debug("REPLY: <IAC><WONT><MSP>"),t.telnet.sendData([255,252,90],!0)):t.verb===251?(this.server=!0,this.enabled?(this.debug("REPLY: <IAC><DO><MSP>"),t.telnet.sendData([255,253,90],!0)):(this.debug("REPLY: <IAC><DONT><MSP>"),t.telnet.sendData([255,254,90],!0))):t.verb===252&&(this.server=!1,this.debug("REPLY: <IAC><DONT><MSP>"),t.telnet.sendData([255,254,90],!0)),t.handled=!0)}async processGMCP(t,e){switch(t){case"Client.Media.Default":e.type==="sound"||!e.type?this.sound({off:!0,url:e.url}):e.type==="music"&&this.music({off:!0,url:e.url});break;case"Client.Media.Load":break;case"Client.Media.Play":let i={off:!1,file:e.name,url:"",volume:50,repeat:1,priority:50,type:"",continue:!0};e.hasOwnProperty("url")&&(i.url=e.url),e.hasOwnProperty("tag")&&(i.type=e.tag),e.hasOwnProperty("volume")&&(i.volume=e.volume),e.hasOwnProperty("loops")&&(i.repeat=e.loops),e.hasOwnProperty("priority")&&(i.priority=e.priority),e.type==="sound"||!e.type?this.sound(i):e.type==="music"&&(e.hasOwnProperty("continue")&&(e.continue==="false"||!e.continue)&&(i.continue=!1),this.music(i));break;case"Client.Media.Stop":e.type==="sound"||!e.type?this.sound({off:!0}):e.type==="music"&&this.music({off:!0});break}}debug(t){this.enableDebug&&this.emit("debug",t)}processFunction(t){let e,i,n;if(t)switch(t.name.toLowerCase()){case"soundinfo":this.SoundState.playing?this.client.echo("Playing Sound - "+this.SoundState.file+" - "+Ue.toTimer(this.SoundState.sound.getTime())+"/"+Ue.toTimer(this.SoundState.sound.getDuration()),-7,-8,!0,!0):this.client.echo("No sound currently playing.",-7,-8,!0,!0),t.handled=!0;break;case"musicinfo":this.MusicState.playing?this.client.echo("Playing Music - "+this.MusicState.file+" -  "+Ue.toTimer(this.MusicState.sound.getTime())+"/"+Ue.toTimer(this.MusicState.sound.getDuration()),-7,-8,!0,!0):this.client.echo("No music currently playing.",-7,-8,!0,!0),t.handled=!0;break;case"playmusic":case"playm":e=this.client.input.parseOutgoing(t.args.join(" "),!1),i={off:!1,file:"",url:"",volume:100,repeat:1,priority:50,type:"",continue:!0},n=e.lastIndexOf("/"),n===-1?i.file=e:(i.file=e.substring(n+1),i.url=e.substring(0,n+1)),this.music(i),t.handled=!0;break;case"playsound":case"plays":e=this.client.input.parseOutgoing(t.args.join(" "),!1),i={off:!1,file:"",url:"",volume:100,repeat:1,priority:50,type:"",continue:!0},n=e.lastIndexOf("/"),n===-1?i.file=e:(i.file=e.substring(n+1),i.url=e.substring(0,n+1)),this.sound(i),t.handled=!0;break;case"stopmusic":case"stopm":this.MusicState.close(),t.handled=!0;break;case"stopsound":case"stops":this.SoundState.close(),t.handled=!0;break;case"stopallsound":case"stopa":this.MusicState.close(),this.SoundState.close(),t.handled=!0;break}}};var Ot=class extends nt{constructor(t){super(t);this.functions={};this._event=e=>this.processFunction(e),this.functions.testfile=e=>{if(e&&e.args&&e.args.length)throw new Error("Invalid syntax use "+this.client.getOption("commandChar")+"testfile");ue().then(i=>{console.time("testfile readFile"),pe(i[0]).then(n=>{console.timeEnd("testfile readFile"),e&&e.raw&&(this.client.getOption("echo")&4)===4&&this.client.echo(e.raw,-3,-4,!0,!0);let s=this.client.getOption("enableCommands");this.client.setOption("enableCommands",!0);let l=new Date().getTime();console.time("testfile parse"),this.client.sendCommand(n,null,this.client.getOption("allowCommentsFromCommand")),console.timeEnd("testfile parse");let r=new Date().getTime();this.client.setOption("enableCommands",s),this.client.print(`Time: ${r-l}
`,!0)}).catch(this.client.error)}).catch(()=>{})},this.functions.testfiler=e=>{if(e&&e.args&&e.args.length)throw new Error("Invalid syntax use "+this.client.getOption("commandChar")+"testfile");ue().then(i=>{console.time("testfile readFile"),pe(i[0]).then(n=>{console.timeEnd("testfile readFile"),e&&e.raw&&(this.client.getOption("echo")&4)===4&&this.client.echo(e.raw,-3,-4,!0,!0);let s=this.client.getOption("enableCommands");this.client.setOption("enableCommands",!0);let l=new Date().getTime();console.time("testfiler parse"),this.client.telnet.receivedData(Oe(n),!0,!0),console.timeEnd("testfiler parse");let r=new Date().getTime();this.client.setOption("enableCommands",s),this.client.print(`Time: ${r-l}
`,!0)}).catch(this.client.error)}).catch(()=>{})},this.functions.testspeedfile=e=>{if(e&&e.args&&e.args.length)throw new Error("Invalid syntax use "+this.client.getOption("commandChar")+"testspeedfile");ue().then(i=>{console.time("testspeedfile readFile"),pe(i[0]).then(n=>{console.timeEnd("testspeedfile readFile"),e&&e.raw&&(this.client.getOption("echo")&4)===4&&this.client.echo(e.raw,-3,-4,!0,!0);let s=0,l=0,r=0,a=[],o;console.time("testspeedfile");for(let f=0;f<10;f++){let p=new Date().getTime();console.time(`testspeedfile parse ${f}`),this.client.sendCommand(n,null,this.client.getOption("allowCommentsFromCommand")),console.timeEnd(`testspeedfile parse ${f}`),o=new Date().getTime()-p,s+=o,o>l&&(l=o),(!r||o<r)&&(r=o),a.push(`${f} - ${o}`)}console.timeEnd("testspeedfile"),a.push(`Total - ${s}`),a.push(`Average - ${s/10}`),a.push(`Min - ${r}`),a.push(`Max - ${l}`),this.client.print(a.join(`
`)+`
`,!0)}).catch(this.client.error)}).catch(()=>{})},this.functions.testspeedfiler=e=>{if(e&&e.args&&e.args.length)throw new Error("Invalid syntax use "+this.client.getOption("commandChar")+"testspeedfiler");ue().then(i=>{console.time("testspeedfile readFile"),pe(i[0]).then(n=>{console.timeEnd("testspeedfile readFile"),e&&e.raw&&(this.client.getOption("echo")&4)===4&&this.client.echo(e.raw,-3,-4,!0,!0);let s=0,l=0,r=0,a=[],o;console.time("testspeedfile");for(let f=0;f<10;f++){let p=new Date().getTime();console.time(`testspeedfile parse ${f}`),this.client.telnet.receivedData(Oe(n),!0,!0),console.timeEnd(`testspeedfile parse ${f}`),o=new Date().getTime()-p,s+=o,o>l&&(l=o),(!r||o<r)&&(r=o),a.push(`${f} - ${o}`)}console.timeEnd("testspeedfile"),a.push(`Total - ${s}`),a.push(`Average - ${s/10}`),a.push(`Min - ${r}`),a.push(`Max - ${l}`),this.client.print(a.join(`
`)+`
`,!0)}).catch(this.client.error)}).catch(()=>{})},this.functions.testlist=()=>{let e=`Test commands:
`,i;for(i in this.functions)this.functions.hasOwnProperty(i)&&(e+=`	${this.client.getOption("commandChar")+i}
`);this.client.print(e,!0)},this.functions.testcolors=()=>{let e,i=`Colors and Styles
-------------------------------------------------------------------------------------------
`;for(e=30;e<38;e++)i+="\x1B["+e+";0m"+e+"\x1B[0m ",i+="\x1B["+e+";1mBold\x1B[0m ",i+="\x1B["+e+";2mFaint\x1B[0m ",i+="\x1B["+e+";3mItalic\x1B[0m ",i+="\x1B["+e+";4mUnderline\x1B[0m ",i+="\x1B["+e+";5mFlash\x1B[0m ",i+="\x1B["+e+";7mInverse\x1B[0m ",i+="\x1B["+e+";8mConceal\x1B[0m ",i+="\x1B["+e+";9mStrikeout\x1B[0m ",i+="\x1B["+e+";21mDoubleUnderline\x1B[0m ",i+="\x1B["+e+";53mOverline\x1B[0m ",i+="\x1B["+e+";1;2;3;4;5;9;21;53mAll\x1B[0m",i+=`\x1B[0m
`;for(e=40;e<48;e++)i+="\x1B["+e+";0m"+e+"\x1B[0m ",i+="\x1B["+e+";1mBold\x1B[0m ",i+="\x1B["+e+";2mFaint\x1B[0m ",i+="\x1B["+e+";3mItalic\x1B[0m ",i+="\x1B["+e+";4mUnderline\x1B[0m ",i+="\x1B["+e+";5mFlash\x1B[0m ",i+="\x1B["+e+";7mInverse\x1B[0m ",i+="\x1B["+e+";8mConceal\x1B[0m ",i+="\x1B["+e+";9mStrikeout\x1B[0m ",i+="\x1B["+e+";21mDoubleUnderline\x1B[0m ",i+="\x1B["+e+";53mOverline\x1B[0m ",i+="\x1B["+e+";1;2;3;4;5;9;21;53mAll\x1B[0m",i+=`\x1B[0m
`;i+=`-------------------------------------------------------------------------------------------
`,this.client.print(i,!0)},this.functions.testcolorsdetails=()=>{let e="";this.client.telnet.prompt&&(e=`
`),e+=`Table for 16-color terminal escape sequences.
`,e+=`
`,e+=`Background        | Foreground colors
`,e+=`------------------------------------------------------------------------------------
`;for(let i=40;i<=47;i++){let n;for(n in Je)if(typeof Je[n]=="number"&&n!=="Rapid"){n==="None"?e+="\x1B[0m "+ct[i-10].toString().padEnd(16)+" | ":e+="\x1B[0m "+n.padEnd(16)+" | ";for(let s=30;s<=37;s++)n==="None"?e+="\x1B["+i+"m\x1B["+s+"m "+("["+s+"m").padEnd(7):e+="\x1B["+i+"m\x1B["+Je[n]+";"+s+"m "+("["+Je[n]+";"+s+"m").padEnd(7);e+=`\x1B[0m
`}e+=`------------------------------------------------------------------------------------
`}this.client.print(e,!0)},this.functions.testxterm=e=>{let i,n,s,l,r="";for(typeof e<"u"&&e.length>0&&(r+="Set Title: ",r+=e,r+="\x1B]0;",r+=e,r+=`\x07
`),r+=`System colors:
`,l=0;l<8;l++)r+="\x1B[48;5;"+l+"m  ";for(r+=`\x1B[0m
`,l=8;l<16;l++)r+="\x1B[48;5;"+l+"m  ";for(r+=`\x1B[0m

`,r+=`Color cube, 6x6x6:
`,n=0;n<6;n++){for(i=0;i<6;i++){for(s=0;s<6;s++)l=16+i*36+n*6+s,r+="\x1B[48;5;"+l+"m  ";r+="\x1B[0m "}r+=`
`}for(r+=`Grayscale ramp:
`,l=232;l<256;l++)r+="\x1B[48;5;"+l+"m  ";r+=`\x1B[0m
`,this.client.print(r,!0)},this.functions.testmxp=()=>{let e=`Text Formatting
`;e+="	\x1B[6z",e+=`<!--Test-->&lt;!--Test--&gt;
`,e+=`	<!--Test>-->&lt;!--Test&gt;--&gt;
`,e+=`	<STRONG>STRONG</STRONG>
`,e+=`	<BOLD>BOLD</BOLD>
`,e+=`	<B>B</B>
`,e+=`	<I>I</I>
`,e+=`	<ITALIC>ITALIC</ITALIC>
`,e+=`	<EM>EM</EM>
`,e+=`	<U>U</U>
`,e+=`	<UNDERLINE>UNDERLINE</UNDERLINE>
`,e+=`	<S>S</S>
`,e+=`	<STRIKEOUT>STRIKEOUT</STRIKEOUT>
`,e+=`	<H>H</H>
`,e+=`	<HIGH>HIGH</HIGH>
`,e+=`	<C RED>C RED</C>
`,e+=`	<COLOR #F00>COLOR #F00</COLOR>
`,e+=`	<C Maroon>C Maroon</C>
`,e+=`	<COLOR #800000>COLOR #800000</COLOR>
`,e+=`	<H><C Maroon>H C Maroon</C></H>
`,e+=`	<H><COLOR #800000>H COLOR #800000</COLOR></H>
`,e+=`	Run <send PROMPT>#testmxpcolors</send> for a detailed list.
`,e+=`	<FONT "Times New Roman">FONT "Times New Roman"</FONT>
`,e+=`	<FONT "Webdings">FONT "Webdings"</FONT>
`,e+=`	<FONT COLOR=Red,Blink>FONT COLOR=Red,Blink</FONT>
`,e+=`	<FONT "Times New Roman" 24 RED GREEN>FONT "Times New Roman" 24 RED GREEN</FONT>
`,e+=`Line Spacing
`,e+=`	NOBR<NOBR>
`,e+=` Continued<NOBR>
`,e+=` More
`,e+=`	<P>P
`,e+=`	1
`,e+=`	2
`,e+=`	3
`,e+=`	4</P>
`,e+=`	BR Line<BR>Break
`,e+=`	SBR Soft<SBR>Break
`,e+=`Links
`,e+=`	<A "http://shadowmud.com">Click here for ShadowMUD</A> 
`,e+=`	<send>test command</send>
`,e+=`	<send href="command2">test command2</send>
`,e+=`	<send "command1|command2|command3" hint="click to see menu|Item 1|Item 2|Item 3">this is a menu link</SEND>
`,e+=`	<SEND "sample" PROMPT EXPIRE=prompt>Prompt sample</SEND>
`,e+=`	<send PROMPT href="#testmxpexpire">&lt;EXPIRE&gt; - #testmxpexpire</send> 
`,e+=`Horizontal Rule
`,e+=`<hr>
`,e+=`<hr>Text After
`,e+=`Text Before<hr>
`,e+=`<c red blue><hr></c>
`,e+=`Text Before<hr>Text After
`,e+=`Custom Element
`,e+=`	<!ELEMENT help '<send href="help &text;">'>&lt;!ELEMENT help '&lt;send href="help &amp;text;"&gt;'&gt;
`,e+=`	&lt;help&gt;test&lt;/help&gt; = <help>test</help>
`,e+=`	<!ELEMENT redbu '<c red><b><u>'>&lt;!ELEMENT redbu '&lt;c red&gt;&lt;b&gt;&lt;u&gt;'&gt;
`,e+=`	&lt;redbu&gt;test&lt;/redbu&gt; = <redbu>test</redbu>
`,e+=`Entities
`,e+=`	&#243;&brvbar;&copy;&plusmn;&sup3;&para;&frac34;&infin;&Dagger;&dagger;&spades;&clubs;&hearts;&diams;
`,e+=`Custom Entity
`,e+='	<!ENTITY version "'+this.client.version+'">&lt;!ENTITY version "'+this.client.version+`"&gt;
`,e+=`	&amp;version; = &version;
`,e+=`	&lt;V Hp&gt;<V Hp>100</V>&lt;/V&gt; &amp;Hp; = &Hp; &amp;hp; = &hp;
`,e+=`	&lt;VAR Sp&gt;<VAR Sp>200</VAR>&lt;/VAR&gt; &amp;Sp; = &Sp; &amp;sp; = &sp;
`,e+=`Image
`,e+=`default      <image 48x48.png URL="./../assets/icons/png/" w=48 h=48>
`,e+=`align left <image 48x48.png URL="./../assets/icons/png/" align=left w=48 h=48> align left
`,e+=`align right  <image 48x48.png URL="./../assets/icons/png/" align=right w=48 h=48> align right
`,e+=`align top    <image 48x48.png URL="./../assets/icons/png/" align=top w=48 h=48> align top 
`,e+=`align middle <image 48x48.png URL="./../assets/icons/png/" align=middle w=48 h=48> align middle
`,e+=`align bottom <image 48x48.png URL="./../assets/icons/png/" align=bottom w=48 h=48> align bottom
`,e+=`map          <send showmap><image 48x48.png URL="./../assets/icons/png/" ismap w=48 h=48></send>
`,e+="<STAT Hp version Test>",e+="<GAUGE Hp version Test>",e+="\x1B[0z",this.client.print(e,!0)},this.functions.testmxp2=()=>{let e="\x1B[6z";e+="<!-- Elements to support the Auto mapper -->",e+=`<!ELEMENT RName '<FONT COLOR=Red><B>' FLAG="RoomName">`,e+="<!ELEMENT RDesc FLAG='RoomDesc'>",e+="<!ELEMENT RExits '<FONT COLOR=Blue>' FLAG='RoomExit'>",e+="<!-- The next element is used to define a room exit link that sends ",e+="the exit direction to the MUD if the user clicks on it -->",e+="<!ELEMENT Ex '<SEND>'>",e+="<!ELEMENT Chat '<FONT COLOR=Gray>' OPEN>",e+="<!ELEMENT Gossip '<FONT COLOR=Cyan>' OPEN>",e+="<!-- in addition to standard HTML Color specifications, you can use ",e+="color attribute names such as blink -->",e+="<!ELEMENT ImmChan '<FONT COLOR=Red,Blink>'>",e+="<!ELEMENT Auction '<FONT COLOR=Purple>' OPEN>",e+="<!ELEMENT Group '<FONT COLOR=Blue>' OPEN>",e+="<!-- the next elements deal with the MUD prompt -->",e+='<!ELEMENT Prompt FLAG="Prompt">',e+='<!ELEMENT Hp FLAG="Set hp">',e+='<!ELEMENT MaxHp FLAG="Set maxhp">',e+='<!ELEMENT Mana FLAG="Set mana">',e+='<!ELEMENT MaxMana FLAG="Set maxmana">',e+="<!-- now the MUD text -->",e+=`<RName>The Main Temple</RName>
`,e+=`<RDesc>This is the main hall of the MUD where everyone starts.
`,e+=`Marble arches lead south into the town, and there is a <i>lovely</i>
`,e+=`<send "drink &text;">fountain</send> in the center of the temple,</RDesc>
`,e+=`<RExits>Exits: <Ex>N</Ex>, <Ex>S</Ex>, <Ex>E</Ex>, <Ex>W</Ex></RExits>

`,e+=`<Prompt>[<Hp>100</Hp>/<MaxHp>120</MaxHp>hp <Mana>50</Mana>/<MaxMana>55</MaxMana>mana]</Prompt>
<hr>`,e+="<!ELEMENT boldtext '<COLOR &col;><B>' ATT='col=red'>",e+=`<boldtext>This is bold red</boldtext>
`,e+=`<boldtext col=blue>This is bold blue text</boldtext>
`,e+=`<boldtext blue>This is also bold blue text</boldtext>
`,e+="\x1B[0z",this.client.print(e,!0)},this.functions.testmxpexpire=()=>{this.client.print(`	\x1B[6z<SEND "sample" PROMPT EXPIRE=prompt>Expire sample</SEND> <SEND "sample" PROMPT EXPIRE=prompt2>Expire sample2</SEND><EXPIRE prompt> <SEND "sample" PROMPT EXPIRE=prompt>Expire sample3</SEND>\x1B[0z
`,!0),this.client.print(`	\x1B[6z\x1B[36m<SEND "sample" PROMPT EXPIRE=prompt>Expire sample</SEND> <SEND "sample" PROMPT EXPIRE=prompt2>Expire sample2</SEND><EXPIRE prompt> <SEND "sample" PROMPT EXPIRE=prompt>Expire sample3</SEND>\x1B[0z\x1B[0m
`,!0),this.client.print(`	\x1B[6z\x1B[46;30m<SEND "sample" PROMPT EXPIRE=prompt>Expire sample</SEND> <SEND "sample" PROMPT EXPIRE=prompt2>Expire sample2</SEND><EXPIRE prompt> <SEND "sample" PROMPT EXPIRE=prompt>Expire sample3</SEND>\x1B[0z\x1B[0m
`,!0),this.client.print(`	\x1B[6z<SEND "sample" PROMPT EXPIRE=prompt>Expire \x1B[36msample\x1B[0m</SEND> <SEND "sample" PROMPT EXPIRE=prompt2>Expire \x1B[36msample2\x1B[0m</SEND><EXPIRE prompt> <SEND "sample" PROMPT EXPIRE=prompt>Expire \x1B[36msample3\x1B[0m</SEND>\x1B[0z
`,!0)},this.functions.testmxpcolors=()=>{let e=["IndianRed","LightCoral","Salmon","DarkSalmon","LightSalmon","Crimson","Red","FireBrick","DarkRed","Pink","LightPink","HotPink","DeepPink","MediumVioletRed","PaleVioletRed","LightSalmon","Coral","Tomato","OrangeRed","DarkOrange","Orange","Gold","Yellow","LightYellow","LemonChiffon","LightGoldenrodYellow","PapayaWhip","Moccasin","PeachPuff","PaleGoldenrod","Khaki","DarkKhaki","Lavender","Thistle","Plum","Violet","Orchid","Fuchsia","Magenta","MediumOrchid","MediumPurple","BlueViolet","DarkViolet","DarkOrchid","DarkMagenta","Purple","Indigo","SlateBlue","DarkSlateBlue","MediumSlateBlue","GreenYellow","Chartreuse","LawnGreen","Lime","LimeGreen","PaleGreen","LightGreen","MediumSpringGreen","SpringGreen","MediumSeaGreen","SeaGreen","ForestGreen","Green","DarkGreen","YellowGreen","OliveDrab","Olive","DarkOliveGreen","MediumAquamarine","DarkSeaGreen","LightSeaGreen","DarkCyan","Teal","Aqua","Cyan","LightCyan","PaleTurquoise","Aquamarine","Turquoise","MediumTurquoise","DarkTurquoise","CadetBlue","SteelBlue","LightSteelBlue","PowderBlue","LightBlue","SkyBlue","LightSkyBlue","DeepSkyBlue","DodgerBlue","CornflowerBlue","MediumSlateBlue","RoyalBlue","Blue","MediumBlue","DarkBlue","Navy","MidnightBlue","Cornsilk","BlanchedAlmond","Bisque","NavajoWhite","Wheat","BurlyWood","Tan","RosyBrown","SandyBrown","Goldenrod","DarkGoldenrod","Peru","Chocolate","SaddleBrown","Sienna","Brown","Maroon","White","Snow","Honeydew","MintCream","Azure","AliceBlue","GhostWhite","WhiteSmoke","Seashell","Beige","OldLace","FloralWhite","Ivory","AntiqueWhite","Linen","LavenderBlush","MistyRose","Gainsboro","LightGrey","Silver","DarkGray","Gray","DimGray","LightSlateGray","SlateGray","DarkSlateGray","Black"],i="\x1B[6z",n=e.length-1;for(let s=0;s<n;s++)i+=""+e[s]+": ",i+=Array(22-e[s].length).join(" "),i+="<C "+e[s]+">Fore</C> ",i+="<C black "+e[s]+">Back</C> ",i+="<h><C "+e[s]+">High</C></h> ",i+="<b><C "+e[s]+">Bold</C></b> ",i+="<C "+e[s]+">\x1B[1mAnsiBold\x1B[0m ",i+="\x1B[2mFaint\x1B[0m ",i+="\x1B[3mItalic\x1B[0m ",i+="\x1B[4mUnderline\x1B[0m ",i+="\x1B[5mFlash\x1B[0m ",i+="\x1B[7mInverse\x1B[0m ",i+="\x1B[8mConceal\x1B[0m ",i+="\x1B[9mStrikeout\x1B[0m ",i+="\x1B[21mDoubleUnderline\x1B[0m ",i+="\x1B[53mOverline\x1B[0m",i+=`</C>
`;i+="Black: ",i+=Array(17).join(" "),i+="<C Black silver>Fore</C> ",i+="<C silver Black>Back</C> ",i+="<h><C Black silver>High</C></h> ",i+="<b><C Black silver>Bold</C></b> ",i+="<C Black silver>\x1B[1mAnsiBold\x1B[0m ",i+="\x1B[2mFaint\x1B[0m ",i+="\x1B[3mItalic\x1B[0m ",i+="\x1B[4mUnderline\x1B[0m ",i+="\x1B[5mFlash\x1B[0m ",i+="\x1B[7mInverse\x1B[0m ",i+="\x1B[8mConceal\x1B[0m ",i+="\x1B[9mStrikeout\x1B[0m ",i+="\x1B[21mDoubleUnderline\x1B[0m ",i+="\x1B[53mOverline\x1B[0m",i+=`</C>
`,i+="\x1B[0z",this.client.print(i,!0)},this.functions.testmxpelements=()=>{let e="\x1B[6z";e+=`Custom Element
`,e+=`	<!ELEMENT help '<send href="help &text;">'>&lt;!ELEMENT help '&lt;send href="help &amp;text;"&gt;'&gt;
`,e+=`	&lt;help&gt;test&lt;/help&gt; = <help>test</help>
`,e+=`	<!ELEMENT redbu '<c red><b><u>'>&lt;!ELEMENT redbu '&lt;c red&gt;&lt;b&gt;&lt;u&gt;'&gt;
`,e+=`	&lt;redbu&gt;test&lt;/redbu&gt; = <redbu>test</redbu>
`,e+="\x1B[0z",this.client.print(e,!0)},this.functions.testmxpLines=()=>{let e="\x1B[6z";e+="<!ELEMENT Auction '<FONT COLOR=red>' TAG=20 OPEN>",e+=`\x1B[20zA nice shiny sword is being auctioned.
`,e+="\x1B[6z<Auction>Also, a gold ring is being auctioned.</Auction>",e+=`<!ELEMENT Auction TAG=20>
`,e+=`<!TAG 20 Fore=red>
`,e+=`\x1B[20zA nice shiny sword is being auctioned.
`,e+=`\x1B[6z<Auction>Also, a gold ring is being auctioned.</Auction>
`,e+=`\x1B[6z<!TAG 20 Fore=blue>
`,e+=`\x1B[20zA nice shiny sword is being auctioned.
`,e+=`\x1B[6z<Auction>Also, a gold ring is being auctioned.</Auction>
`,e+="\x1B[0z",this.client.print(e,!0)},this.functions.testmapper=()=>{this.client.emit("received-GMCP","Room.Info",{details:[],doors:{},prevroom:{num:0,dir:"",area:""},area:"Doc Build Samples Area",exits:{south:{num:87723359,dir:"south",area:"Doc Build Samples Area",isdoor:0},east:{num:-329701270,dir:"east",area:"Doc Build Samples Area",isdoor:0}},name:"Sample room 1",num:1968208336,indoors:0}),this.client.emit("received-GMCP","Room.Info",{details:[],doors:{},prevroom:{num:1968208336,dir:"east",area:"Doc Build Samples Area"},area:"Doc Build Samples Area",environment:"wood",exits:{south:{num:1916648905,dir:"south",area:"Doc Build Samples Area",isdoor:0},east:{num:-1688332036,dir:"east",area:"Doc Build Samples Area",isdoor:0},west:{num:1968208336,dir:"west",area:"Doc Build Samples Area",isdoor:0}},name:"Sample room 2",num:-329701270,indoors:0}),this.client.emit("received-GMCP","Room.Info",{details:[],doors:{},prevroom:{num:-329701270,dir:"east",area:"Doc Build Samples Area"},area:"Doc Build Samples Area",environment:"jungle",exits:{south:{num:-348853133,dir:"south",area:"Doc Build Samples Area",isdoor:0},west:{num:-329701270,dir:"west",area:"Doc Build Samples Area",isdoor:0}},name:"Sample room 3",num:-1688332036,indoors:0}),this.client.emit("received-GMCP","Room.Info",{details:[],doors:{},prevroom:{num:-1688332036,dir:"south",area:"Doc Build Samples Area"},area:"Doc Build Samples Area",environment:"grass",exits:{north:{num:-1688332036,dir:"north",area:"Doc Build Samples Area",isdoor:0},south:{num:2072768994,dir:"south",area:"Doc Build Samples Area",isdoor:0},west:{num:1916648905,dir:"west",area:"Doc Build Samples Area",isdoor:0}},name:"Sample room 6",num:-348853133,indoors:0}),this.client.emit("received-GMCP","Room.Info",{details:[],doors:{},prevroom:{num:-348853133,dir:"west",area:"Doc Build Samples Area"},area:"Doc Build Samples Area",environment:"desert",exits:{north:{num:-329701270,dir:"north",area:"Doc Build Samples Area",isdoor:0},south:{num:210551156,dir:"south",area:"Doc Build Samples Area",isdoor:0},east:{num:-348853133,dir:"east",area:"Doc Build Samples Area",isdoor:0},west:{num:87723359,dir:"west",area:"Doc Build Samples Area",isdoor:0}},name:"Sample room 5",num:1916648905,indoors:1}),this.client.emit("received-GMCP","Room.Info",{details:[],doors:{},prevroom:{num:1916648905,dir:"west",area:"Doc Build Samples Area"},area:"Doc Build Samples Area",environment:"tundra",exits:{north:{num:1968208336,dir:"north",area:"Doc Build Samples Area",isdoor:0},south:{num:-1674322715,dir:"south",area:"Doc Build Samples Area",isdoor:0},east:{num:87723359,dir:"east",area:"Doc Build Samples Area",isdoor:0}},name:"Sample room 4",num:87723359,indoors:0}),this.client.emit("received-GMCP","Room.Info",{details:[],doors:{},prevroom:{num:87723359,dir:"south",area:"Doc Build Samples Area"},area:"Doc Build Samples Area",environment:"water",exits:{north:{num:87723359,dir:"north",area:"Doc Build Samples Area",isdoor:0},east:{num:210551156,dir:"east",area:"Doc Build Samples Area",isdoor:0}},name:"Sample room 7",num:-1674322715,indoors:0}),this.client.emit("received-GMCP","Room.Info",{details:[],doors:{},prevroom:{num:-1674322715,dir:"east",area:"Doc Build Samples Area"},area:"Doc Build Samples Area",environment:"jungle",exits:{north:{num:1916648905,dir:"north",area:"Doc Build Samples Area",isdoor:0},east:{num:2072768994,dir:"east",area:"Doc Build Samples Area",isdoor:0},west:{num:-1674322715,dir:"west",area:"Doc Build Samples Area",isdoor:0}},name:"Sample room 8",num:210551156,indoors:0}),this.client.emit("received-GMCP","Room.Info",{details:[],doors:{},prevroom:{num:210551156,dir:"east",area:"Doc Build Samples Area"},area:"Doc Build Samples Area",exits:{north:{num:-348853133,dir:"north",area:"Doc Build Samples Area",isdoor:0},west:{num:210551156,dir:"west",area:"Doc Build Samples Area",isdoor:0}},name:"Sample room 9",num:2072768994,indoors:0})},this.functions.testfansi=()=>{let e="",i;for(e="",i=3;i<=6;i++)e+=String.fromCharCode(i);for(i=14;i<=26;i++)e+=String.fromCharCode(i);for(i=28;i<=31;i++)e+=String.fromCharCode(i);for(i=127;i<=254;i++)e+=String.fromCharCode(i);e+=`
`;let n=this.client.display.displayControlCodes;this.client.display.displayControlCodes=!0,this.client.display.emulateTerminal?(this.client.display.emulateTerminal=!1,this.client.print(e,!0),this.client.display.emulateTerminal=!0,this.client.print(e,!0)):(this.client.print(e,!0),this.client.display.emulateTerminal=!0,this.client.print(e,!0),this.client.display.emulateTerminal=!1),this.client.display.displayControlCodes=n},this.functions.testcontrolchars=()=>{let e,i="1:  ,";for(e=3;e<=9;e++)i+=`${e}: ${String.fromCharCode(e)},`;for(e=11;e<=27;e++)i+=`${e}: ${String.fromCharCode(e)},`;for(e=28;e<=31;e++)i+=`${e}: ${String.fromCharCode(e)},`;for(e=127;e<=254;e++)i+=`${e}: ${String.fromCharCode(e)},`;i+=`
`;let n=this.client.display.displayControlCodes;this.client.display.displayControlCodes=!0,this.client.print(i,!0),this.client.display.displayControlCodes=n},this.functions.testurldetect=()=>{let e=`\x1B[0mhttp://www.google.com
`;e+=`	http://www.google.com\x1B[44m
`,e+=`http://www.google.com
`,e+=`	try this http://www.google.com
`,e+=`http://www.google.com try this
`,e+=`	try this http://www.google.com try this
`,e+=`\x1B[36mhttp://www.google.com
`,e+=`	\x1B[0mhttp://www.google.com
`,e+=`http://www.google.com\x1B[44m
`,e+=`	http://www.google.com
`,e+=`try this http://www.google.com
`,e+=`	http://www.google.com try this
`,e+=`try this http://www.google.com try this
`,e+=`	\x1B[36mhttp://www.google.com
`,e+=`	https://localhost telnet://localhost
`,e+=`	news://test.edu/default.asp?t=1#1111 torrent://localhost/
`,e+=`	ftp://localhost gopher://localhost im://talk
`,e+=`	mailto:address@localhost irc://<host>[:<port>]/[<channel>[?<password>]]
`,e+=`awww... www.google.com awww.com
`,e+="www.google.com www.google.com\x1B[0m",this.client.print(e,!0)},this.functions.testxtermrgb=()=>{let e="",i,n,s,l=0;for(i=0;i<256;i+=16)for(n=0;n<256;n+=16)for(s=0;s<256;s+=16)e+="\x1B[48;2;"+i+";"+n+";"+s+"m  ",l%63===0&&(e+=`
`),l++;e+="\x1B[0m",this.client.print(e,!0)},this.functions.testsize=()=>{let e=this.client.display.WindowSize,i=e.width+"x"+e.height+" ";e.width-=i.length;for(let n=0;n<e.width;n++)i+="w";for(let n=1;n<e.height;n++)i+=`
`+n;this.client.print(i,!0)},this.functions.testspeed=()=>{let e=[],i=this.client.getOption("commandChar")+["testmxpcolors","testmxp","testcolors","testcolorsdetails","testxterm","testxtermrgb"].join(`
`+this.client.getOption("commandChar")),n=this.client.getOption("enableCommands");this.client.setOption("enableCommands",!0);let s=0,l=0,r=0,a;for(let o=0;o<10;o++){let f=new Date().getTime();this.client.sendCommand(i),a=new Date().getTime()-f,s+=a,a>l&&(l=a),(!r||a<r)&&(r=a),e.push(`${o} - ${a}`)}e.push(`Total - ${s}`),e.push(`Average - ${s/10}`),e.push(`Min - ${r}`),e.push(`Max - ${l}`),this.client.print(e.join(`
`)+`
`,!0),this.client.setOption("enableCommands",n)},this.functions.testperiod=()=>{if(window.periodID){clearInterval(window.periodID),delete window.period,delete window.periodID;return}window.period=0,window.periodID=setInterval(()=>{window.period%3===1?this.client.sendCommand("#testcolors"):window.period%3===2?this.client.sendCommand("#testxterm"):this.client.sendCommand("#testlist"),window.period++},2e3)},this.functions.testutf8=()=>{this.client.print(`Armenian
\u0531 \u0532 \u0533 \u0534 \u0535 \u0536 \u0537 \u0538 \u0539 \u053A \u053B \u053C \u053D \u053E \u053F \u0540 \u0541 \u0542 \u0543 \u0544 \u0545 \u0546 \u0547 \u0548 \u0549 \u054A \u054B \u054C \u054D \u054E \u054F \u0550 \u0551 \u0552 \u0553 \u0554 \u0555 \u0556 \u0559 \u055A \u055B \u055C \u055D \u055E \u055F \u0561 \u0562 \u0563 \u0564 \u0565 \u0566 \u0567 \u0568 \u0569 \u056A \u056B \u056C \u056D \u056E \u056F \u0570 \u0571 \u0572 \u0573 \u0574 \u0575 \u0576 \u0577 \u0578 \u0579 \u057A \u057B \u057C \u057D \u057E \u057F \u0580 \u0581 \u0582 \u0583 \u0584 \u0585 \u0586 \u0587 \u0589
Hebrew
\u0591 \u0592 \u0593 \u0594 \u0595 \u0596 \u0597 \u0598 \u0599 \u059A \u059B \u059C \u059D \u059E \u059F \u05A0 \u05A1 \u05A3 \u05A4 \u05A5 \u05A6 \u05A7 \u05A8 \u05A9 \u05AA \u05AB \u05AC \u05AD \u05AE \u05AF \u05B0 \u05B1 \u05B2 \u05B3 \u05B4 \u05B5 \u05B6 \u05B7 \u05B8 \u05B9 \u05BB \u05BC \u05BD \u05BE \u05BF \u05C0 \u05C1 \u05C2 \u05C3 \u05C4 \u05D0 \u05D1 \u05D2 \u05D3 \u05D4 \u05D5 \u05D6 \u05D7 \u05D8 \u05D9 \u05DA \u05DB \u05DC \u05DD \u05DE \u05DF \u05E0 \u05E1 \u05E2 \u05E3 \u05E4 \u05E5 \u05E6 \u05E7 \u05E8 \u05E9 \u05EA \u05F0 \u05F1 \u05F2 \u05F3 \u05F4
Arabic
\u060C \u061B \u061F \u0621 \u0622 \u0623 \u0624 \u0625 \u0626 \u0627 \u0628 \u0629 \u062A \u062B \u062C \u062D \u062E \u062F \u0630 \u0631 \u0632 \u0633 \u0634 \u0635 \u0636 \u0637 \u0638 \u0639 \u063A \u0640 \u0641 \u0642 \u0643 \u0644 \u0645 \u0646 \u0647 \u0648 \u0649 \u064A \u064B \u064C \u064D \u064E \u064F \u0650 \u0651 \u0652 \u0660 \u0661 \u0662 \u0663 \u0664 \u0665 \u0666 \u0667 \u0668 \u0669 \u066A \u066B \u066C \u066D \u0670 \u0671 \u0672 \u0673 \u0674 \u0675 \u0676 \u0677 \u0678 \u0679 \u067A \u067B \u067C \u067D \u067E \u067F \u0680 \u0681 \u0682 \u0683 \u0684 \u0685 \u0686 \u0687 \u0688 \u0689 \u068A \u068B \u068C \u068D \u068E \u068F \u0690 \u0691 \u0692 \u0693 \u0694 \u0695 \u0696 \u0697 \u0698 \u0699 \u069A \u069B \u069C \u069D \u069E \u069F \u06A0 \u06A1 \u06A2 \u06A3 \u06A4 \u06A5 \u06A6 \u06A7 \u06A8 \u06A9 \u06AA \u06AB \u06AC \u06AD \u06AE \u06AF \u06B0 \u06B1 ...
Devanagari
\u0901 \u0902 \u0903 \u0905 \u0906 \u0907 \u0908 \u0909 \u090A \u090B \u090C \u090D \u090E \u090F \u0910 \u0911 \u0912 \u0913 \u0914 \u0915 \u0916 \u0917 \u0918 \u0919 \u091A \u091B \u091C \u091D \u091E \u091F \u0920 \u0921 \u0922 \u0923 \u0924 \u0925 \u0926 \u0927 \u0928 \u0929 \u092A \u092B \u092C \u092D \u092E \u092F \u0930 \u0931 \u0932 \u0933 \u0934 \u0935 \u0936 \u0937 \u0938 \u0939 \u093C \u093D \u093E \u093F \u0940 \u0941 \u0942 \u0943 \u0944 \u0945 \u0946 \u0947 \u0948 \u0949 \u094A \u094B \u094C \u094D \u0950 \u0951 \u0952 \u0953 \u0954 \u0958 \u0959 \u095A \u095B \u095C \u095D \u095E \u095F \u0960 \u0961 \u0962 \u0963 \u0964 \u0965 \u0966 \u0967 \u0968 \u0969 \u096A \u096B \u096C \u096D \u096E \u096F \u0970
Armenian
\u0531 \u0532 \u0533 \u0534 \u0535 \u0536 \u0537 \u0538 \u0539 \u053A \u053B \u053C \u053D \u053E \u053F \x1B[33m\u0540 \u0541 \u0542 \u0543 \u0544 \u0545 \u0546 \u0547 \u0548 \u0549 \u054A \u054B \u054C \u054D \u054E \u054F \u0550 \u0551 \u0552 \x1B[34m\u0553 \u0554 \u0555 \u0556 \u0559 \u055A \u055B \u055C \u055D \u055E \u055F \u0561 \u0562 \u0563 \u0564 \u0565 \u0566 \u0567 \u0568 \u0569 \u056A \u056B \u056C \u056D \u056E \u056F \u0570\x1B[35m \u0571 \u0572 \u0573 \u0574 \u0575 \u0576 \u0577 \u0578 \u0579 \u057A \u057B \u057C \u057D \u057E \u057F \u0580 \u0581 \u0582 \u0583 \u0584 \u0585 \u0586 \u0587 \u0589\x1B[0m
Hebrew
\u0591 \u0592 \u0593 \u0594 \u0595 \u0596 \u0597 \u0598 \u0599 \u059A \u059B \u059C \u059D \u059E\x1B[33m \u059F \u05A0 \u05A1 \u05A3 \u05A4 \u05A5 \u05A6 \u05A7 \u05A8 \u05A9 \u05AA \u05AB \u05AC \u05AD \u05AE \u05AF \u05B0 \u05B1 \u05B2 \u05B3 \u05B4 \u05B5 \u05B6 \u05B7 \u05B8 \u05B9 \u05BB \u05BC \u05BD \u05BE \u05BF \u05C0 \u05C1 \u05C2 \u05C3 \u05C4 \u05D0 \u05D1 \u05D2 \u05D3 \u05D4 \u05D5 \u05D6 \u05D7 \u05D8 \u05D9 \u05DA \u05DB \u05DC\x1B[34m \u05DD \u05DE \u05DF \u05E0 \u05E1 \u05E2 \u05E3 \u05E4 \u05E5 \u05E6 \u05E7 \u05E8 \u05E9 \u05EA \u05F0 \u05F1 \u05F2 \u05F3 \u05F4\x1B[0m
\u0591 \u0592 \u0593 \u0594 \u0595 \u0596 \u0597 \u0598 \u0599 \u059A \u059B \u059C \u059D \u059E\x1B[33m \u059F \u05A0 \u05A1 \u05A3 \u05A4 \u05A5 \u05A6 \u05A7 \u05A8 \u05A9 \u05AA \u05AB \u05AC \u05AD \u05AE \u05AF \u05B0 \u05B1 \u05B2 \u05B3 \u05B4 \u05B5 \u05B6 \u05B7 \u05B8 \u05B9 \u05BB \u05BC \u05BD \u05BE \u05BF \u05C0 \u05C1 \u05C2 \u05C3 \u05C4 \u05D0 \u05D1 \u05D2 \u05D3 \u05D4 \u05D5 \u05D6 \u05D7 \u05D8 \u05D9 \u05DA \u05DB \u05DCa\x1B[34m \u05DD \u05DE \u05DF \u05E0 \u05E1 \u05E2 \u05E3 \u05E4 \u05E5 \u05E6 \u05E7 \u05E8 \u05E9 \u05EA \u05F0 \u05F1 \u05F2 \u05F3 \u05F4\x1B[0m
Arabic
\u060C \u061B \u061F \u0621 \u0622 \u0623 \u0624 \u0625 \u0626 \u0627 \u0628 \u0629 \u062A \u062B \u062C \u062D \u062E \u062F \u0630 \u0631 \u0632 \u0633 \u0634 \u0635 \u0636 \u0637 \u0638 \u0639\x1B[34m \u063A \u0640 \u0641 \u0642 \u0643 \u0644 \u0645 \u0646 \u0647 \u0648 \u0649 \u064A \u064B \u064C \u064D \u064E \u064F \u0650 \u0651 \u0652 \u0660 \u0661 \u0662 \u0663 \u0664 \u0665 \u0666 \u0667 \u0668 \u0669 \u066A \u066B \u066C \u066D \u0670 \u0671 \u0672 \u0673 \u0674 \u0675 \u0676 \u0677 \u0678 \u0679 \u067A \u067B \u067C \u067D \u067E \u067F \u0680 \u0681 \u0682 \u0683 \u0684 \u0685 \u0686 \u0687 \u0688 \u0689 \u068A \u068B \u068C \u068D \u068E \u068F \u0690 \u0691 \u0692 \u0693 \u0694 \u0695 \u0696 \u0697 \u0698 \u0699 \u069A \u069B \u069C \u069D \u069E \u069F \u06A0 \u06A1 \u06A2 \u06A3 \u06A4 \u06A5 \u06A6 \x1B[33m\u06A7 \u06A8 \u06A9 \u06AA \u06AB \u06AC \u06AD \u06AE \u06AF \u06B0 \u06B1 ...\x1B[0m
Devanagari
\u0901 \u0902 \u0903 \u0905 \u0906 \u0907 \u0908 \u0909 \u090A \u090B \u090C \u090D \u090E \u090F \u0910 \u0911 \u0912 \u0913 \u0914 \u0915 \u0916 \u0917 \u0918 \u0919 \u091A \u091B \u091C \u091D \u091E \u091F \u0920 \u0921 \u0922 \u0923 \u0924 \u0925 \u0926 \u0927 \u0928 \u0929 \u092A \x1B[33m\u092B \u092C \u092D \u092E \u092F \u0930 \u0931 \u0932 \u0933 \u0934 \u0935 \u0936 \u0937 \u0938 \u0939 \u093C \u093D \u093E \u093F \u0940 \u0941 \u0942 \u0943 \u0944 \u0945 \u0946 \u0947 \u0948 \u0949 \u094A \u094B \u094C \u094D \u0950 \u0951 \u0952 \u0953 \u0954 \u0958 \u0959 \u095A \u095B\x1B[34m \u095C \u095D \u095E \u095F \u0960 \u0961 \u0962 \u0963 \u0964 \u0965 \u0966 \u0967 \u0968 \u0969 \u096A \u096B \u096C \u096D \u096E \u096F \u0970\x1B[0m`,!0)},this.functions.testunicodeemoji=()=>{let e="";for(var i=[[128513,128591],[9986,10160],[128640,128704],[128512,128566],[128641,128709],[127757,128359]],n=0,s=0;s<i.length;s++){for(var l=i[s],r=l[0];r<l[1];r++)e+=String.fromCodePoint(r),n++,n==36&&(e+=`
`,n=0);e+="\x1B[4z<hr>",n=0}let a=`\x1B[4z<hr>\xA9\xAE\u203C\u2049#\u20E38\u20E39\u20E37\u20E30\u20E36\u20E35\u20E34\u20E33\u20E32\u20E31\u20E3\u2122\u2139\u2194\u2195\u2196\u2197\u2198\u2199\u21A9\u21AA\u231A\u231B\u23E9\u23EA\u23EB\u23EC\u23F0\u23F3\u25AA\u25AB\u25B6\u25C0\u25FB\u25FC\u25FD\u25FE\u2600\u2601\u260E\u2611\u2614\u2615
\u261D\u263A\u2648\u2649\u264A\u264B\u264C\u264D\u264E\u264F\u2650\u2651\u2652\u2653\u2660\u2663\u2665\u2666\u2668\u267B\u267F\u2693\u26A0\u26A1\u26AA\u26AB\u26BD\u26BE\u26C4\u26C5\u26CE\u26D4\u26EA\u26F2\u26F3\u26F5
\u26FA\u26FD\u2934\u2935\u2B05\u2B06\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299\u{1F004}\u{1F0CF}\u{1F300}\u{1F301}\u{1F302}\u{1F303}\u{1F304}\u{1F305}\u{1F306}\u{1F307}\u{1F308}\u{1F309}\u{1F30A}\u{1F30B}\u{1F30C}\u{1F30F}\u{1F311}\u{1F313}\u{1F314}\u{1F315}
\u{1F319}\u{1F31B}\u{1F31F}\u{1F320}\u{1F330}\u{1F331}\u{1F334}\u{1F335}\u{1F337}\u{1F338}\u{1F339}\u{1F33A}\u{1F33B}\u{1F33C}\u{1F33D}\u{1F33E}\u{1F33F}\u{1F340}\u{1F341}\u{1F342}\u{1F343}\u{1F344}\u{1F345}\u{1F346}\u{1F347}\u{1F348}\u{1F349}\u{1F34A}\u{1F34C}\u{1F34D}\u{1F34E}\u{1F34F}\u{1F351}
\u{1F352}\u{1F353}\u{1F354}\u{1F355}\u{1F356}\u{1F357}\u{1F358}\u{1F359}\u{1F35A}\u{1F35B}\u{1F35C}\u{1F35D}\u{1F35E}\u{1F35F}\u{1F360}\u{1F361}\u{1F362}\u{1F363}\u{1F364}\u{1F365}\u{1F366}\u{1F367}\u{1F368}\u{1F369}\u{1F36A}\u{1F36B}\u{1F36C}\u{1F36D}\u{1F36E}\u{1F36F}\u{1F370}\u{1F371}\u{1F372}
\u{1F373}\u{1F374}\u{1F375}\u{1F376}\u{1F377}\u{1F378}\u{1F379}\u{1F37A}\u{1F37B}\u{1F380}\u{1F381}\u{1F382}\u{1F383}\u{1F384}\u{1F385}\u{1F386}\u{1F387}\u{1F388}\u{1F389}\u{1F38A}\u{1F38B}\u{1F38C}\u{1F38D}\u{1F38E}\u{1F38F}\u{1F390}\u{1F391}\u{1F392}\u{1F393}\u{1F3A0}\u{1F3A1}\u{1F3A2}\u{1F3A3}\u{1F3A4}
\u{1F3A5}\u{1F3A6}\u{1F3A7}\u{1F3A8}\u{1F3A9}\u{1F3AA}\u{1F3AB}\u{1F3AC}\u{1F3AD}\u{1F3AE}\u{1F3AF}\u{1F3B0}\u{1F3B1}\u{1F3B2}\u{1F3B3}\u{1F3B4}\u{1F3B5}\u{1F3B6}\u{1F3B7}\u{1F3B8}\u{1F3B9}\u{1F3BA}\u{1F3BB}\u{1F3BC}\u{1F3BD}\u{1F3BE}\u{1F3BF}\u{1F3C0}\u{1F3C1}\u{1F3C2}\u{1F3C3}\u{1F3C4}
\u{1F3C6}\u{1F3C8}\u{1F3CA}\u{1F3E0}\u{1F3E1}\u{1F3E2}\u{1F3E3}\u{1F3E5}\u{1F3E6}\u{1F3E7}\u{1F3E8}\u{1F3E9}\u{1F3EA}\u{1F3EB}\u{1F3EC}\u{1F3ED}\u{1F3EE}\u{1F3EF}\u{1F3F0}\u{1F40C}\u{1F40D}\u{1F40E}\u{1F411}\u{1F412}\u{1F414}\u{1F417}\u{1F418}\u{1F419}\u{1F41A}\u{1F41B}\u{1F41C}\u{1F41D}
\u{1F41E}\u{1F41F}\u{1F420}\u{1F421}\u{1F422}\u{1F423}\u{1F424}\u{1F425}\u{1F426}\u{1F427}\u{1F428}\u{1F429}\u{1F42B}\u{1F42C}\u{1F42D}\u{1F42E}\u{1F42F}\u{1F430}\u{1F431}\u{1F432}\u{1F433}\u{1F434}\u{1F435}\u{1F436}\u{1F437}\u{1F438}\u{1F439}\u{1F43A}\u{1F43B}\u{1F43C}\u{1F43D}\u{1F43E}
\u{1F440}\u{1F442}\u{1F443}\u{1F444}\u{1F445}\u{1F446}\u{1F447}\u{1F448}\u{1F449}\u{1F44A}\u{1F44B}\u{1F44C}\u{1F44D}\u{1F44E}\u{1F44F}\u{1F450}\u{1F451}\u{1F452}\u{1F453}\u{1F454}\u{1F455}\u{1F456}\u{1F457}\u{1F458}\u{1F459}\u{1F45A}\u{1F45B}\u{1F45C}\u{1F45D}\u{1F45E}\u{1F45F}\u{1F460}\u{1F461}\u{1F462}
\u{1F463}\u{1F464}\u{1F466}\u{1F467}\u{1F468}\u{1F469}\u{1F46A}\u{1F46B}\u{1F46E}\u{1F46F}\u{1F470}\u{1F471}\u{1F472}\u{1F473}\u{1F474}\u{1F475}\u{1F476}\u{1F477}\u{1F478}\u{1F479}\u{1F47A}\u{1F47B}\u{1F47C}\u{1F47D}\u{1F47E}\u{1F47F}\u{1F480}\u{1F481}\u{1F482}\u{1F483}\u{1F484}\u{1F485}\u{1F486}
\u{1F487}\u{1F488}\u{1F489}\u{1F48A}\u{1F48B}\u{1F48C}\u{1F48D}\u{1F48E}\u{1F48F}\u{1F490}\u{1F491}\u{1F492}\u{1F493}\u{1F494}\u{1F495}\u{1F496}\u{1F497}\u{1F498}\u{1F499}\u{1F49A}\u{1F49B}\u{1F49C}\u{1F49D}\u{1F49E}\u{1F49F}\u{1F4A0}\u{1F4A1}\u{1F4A2}\u{1F4A3}\u{1F4A4}\u{1F4A5}\u{1F4A6}\u{1F4A7}
\u{1F4A8}\u{1F4A9}\u{1F4AA}\u{1F4AB}\u{1F4AC}\u{1F4AE}\u{1F4AF}\u{1F4B0}\u{1F4B1}\u{1F4B2}\u{1F4B3}\u{1F4B4}\u{1F4B5}\u{1F4B8}\u{1F4B9}\u{1F4BA}\u{1F4BB}\u{1F4BC}\u{1F4BD}\u{1F4BE}\u{1F4BF}\u{1F4C0}\u{1F4C1}\u{1F4C2}\u{1F4C3}\u{1F4C4}\u{1F4C5}\u{1F4C6}\u{1F4C7}\u{1F4C8}\u{1F4C9}\u{1F4CA}\u{1F4CB}
\u{1F4CC}\u{1F4CD}\u{1F4CE}\u{1F4CF}\u{1F4D0}\u{1F4D1}\u{1F4D2}\u{1F4D3}\u{1F4D4}\u{1F4D5}\u{1F4D6}\u{1F4D7}\u{1F4D8}\u{1F4D9}\u{1F4DA}\u{1F4DB}\u{1F4DC}\u{1F4DD}\u{1F4DE}\u{1F4DF}\u{1F4E0}\u{1F4E1}\u{1F4E2}\u{1F4E3}\u{1F4E4}\u{1F4E5}\u{1F4E6}\u{1F4E7}\u{1F4E8}\u{1F4E9}\u{1F4EA}\u{1F4EB}\u{1F4EE}\u{1F4F0}
\u{1F4F1}\u{1F4F2}\u{1F4F3}\u{1F4F4}\u{1F4F6}\u{1F4F7}\u{1F4F9}\u{1F4FA}\u{1F4FB}\u{1F4FC}\u{1F503}\u{1F50A}\u{1F50B}\u{1F50C}\u{1F50D}\u{1F50E}\u{1F50F}\u{1F510}\u{1F511}\u{1F512}\u{1F513}\u{1F514}\u{1F516}\u{1F517}\u{1F518}\u{1F519}\u{1F51A}\u{1F51B}\u{1F51C}\u{1F51D}\u{1F51E}\u{1F51F}\u{1F520}
\u{1F521}\u{1F522}\u{1F523}\u{1F524}\u{1F525}\u{1F526}\u{1F527}\u{1F528}\u{1F529}\u{1F52A}\u{1F52B}\u{1F52E}\u{1F52F}\u{1F530}\u{1F531}\u{1F532}\u{1F533}\u{1F534}\u{1F535}\u{1F536}\u{1F537}\u{1F538}\u{1F539}\u{1F53A}\u{1F53B}\u{1F53C}\u{1F53D}\u{1F550}\u{1F551}\u{1F552}\u{1F553}\u{1F554}\u{1F555}
\u{1F556}\u{1F557}\u{1F558}\u{1F559}\u{1F55A}\u{1F55B}\u{1F5FB}\u{1F5FC}\u{1F5FD}\u{1F5FE}\u{1F5FF}`;this.client.print(e,!0),this.client.print(a,!0)},this.functions.testlines=()=>{let e=this.client.display.maxLines,i="",n=this.client.display.model.getNextLineID;for(let s=0;s<e;s++)i+=`Line: ${s}, LineID: ${n+s}
`;this.client.print(i,!0)},this.functions.testscreen=()=>{let e="Window innerWidth: "+window.innerWidth;e+=`
Window innerHeight: `+window.innerHeight,e+=`
Document clientWidth: `+document.body.clientWidth,e+=`
Document clientHeight: `+document.body.clientHeight,e+=`
Display clientWidth: `+this.client.display.container.clientWidth,e+=`
Display clientHeight: `+this.client.display.container.clientHeight,e+=`
Screen orientation: `+screen?.orientation?.type,this.client.print(e,!0)}}remove(){this.client&&this.client.off("function",this._event)}initialize(){this.client&&this.client.on("function",this._event)}get menu(){return[]}get settings(){return[]}processFunction(t){let e;t&&(e=t.name.toLowerCase(),e.endsWith("()")&&(e=e.substring(0,e.length-2)),this.functions[e]&&(console.time(e),this.functions[e].apply(this,t||{}),console.timeEnd(e),t.handled=!0))}};var rt=class extends ie{constructor(t){super();this._enableDebug=!1;this._itemCache={triggers:null,aliases:null,macros:null,buttons:null,contexts:null,defaultContext:null,alarms:null,alarmPatterns:[]};this._variables={};this._options={};this.active=!0;this.connecting=!1;this.version=bi;this.connectTime=0;this.disconnectTime=0;this.lastSendTime=0;this.defaultTitle="oiMUD";this.errored=!1;if(window.client=this,window.oiMUD=this,this._plugins=[],t=Object.assign({display:"#display",commandInput:"#commandInput"},t||{}),(!("display"in t)||typeof t.display===void 0)&&(t.display="#display"),(!("commandInput"in t)||typeof t.commandInput===void 0)&&(t.commandInput="#commandInput"),this._display=new dt(t.display),this.display.on("click",i=>{this.getOption("CommandonClick")&&this._commandInput.focus()}),this.display.on("scroll-lock",i=>{this.scrollLock=i}),this.display.on("update-window",(i,n)=>{this.telnet.updateWindow(i,n)}),this.display.on("update-window",(i,n)=>{this.telnet.updateWindow(i,n)}),this.display.on("debug",i=>{this.debug(i)}),this.display.on("add-line",i=>{this.emit("add-line",i)}),this.display.on("add-line-done",i=>{this.emit("add-line-done",i)}),this.display.on("MXP-tag-reply",(i,n)=>{let s={tag:i,args:n,preventDefault:!1};if(this.emit("MXP-tag-reply",s),!s.preventDefault)switch(i){case"VERSION":this.display.MXPStyleVersion&&this.display.MXPStyleVersion.length?(this.debug(`MXP Tag REPLY: <VERSION MXP=1.0 STYLE=${this.display.MXPStyleVersion} CLIENT=jiMUD VERSION=${this.version} REGISTERED=no>`),this.send(`\x1B[1z<VERSION MXP=1.0 STYLE=${this.display.MXPStyleVersion} CLIENT=jiMUD VERSION=${this.version} REGISTERED=no>\r
`)):(this.debug(`MXP Tag REPLY: <VERSION MXP=1.0 CLIENT=jiMUD VERSION=${this.version} REGISTERED=no>`),this.send(`\x1B[1z<VERSION MXP=1.0 CLIENT=jiMUD VERSION=${this.version} REGISTERED=no>\r
`));break;case"SUPPORT":this.debug(`MXP Tag REPLY: <SUPPORTS ${n.join(" ")}>`),this.send(`\x1B[1z<SUPPORTS ${n.join(" ")}>\r
`);break;case"USER":this.emit("sendUsername",s);break;case"PASSWORD":this.emit("sendPassword",s);break}}),this.display.on("expire-links",i=>{this.emit("expire-links",i)}),this.display.on("parse-done",()=>{this.emit("parse-done")}),this.display.on("set-title",(i,n)=>{typeof i>"u"||i==null||i.length===0?this.emit("set-title",this.getOption("title").replace("$t",this.defaultTitle)||this.defaultTitle):n!==1&&this.emit("set-title",this.getOption("title").replace("$t",i)||"")}),this.display.on("music",i=>{this.emit("music",i)}),this.display.on("sound",i=>{this.emit("sound",i)}),this.display.on("bell",()=>{this.emit("bell")}),typeof t.commandInput=="string"){if(this._commandInput=document.querySelector(t.commandInput),!this._commandInput)throw new Error("Invalid selector for command input.")}else if(t.commandInput instanceof $)this._commandInput=t.commandInput[0];else if(t.commandInput instanceof HTMLElement)this._commandInput=t.commandInput;else throw new Error("Command input must be a selector, element or jquery object");this._telnet=new ht({protocol:t.protocol,scheme:t.scheme}),this._telnet.terminal="oiMUD",this._telnet.version=this.version,this._telnet.GMCPSupports.push("oMUD 1"),this._telnet.on("error",i=>{if(this.enableDebug&&this.debug(i),i){if(i.type==="close"&&i.code===1006)return;let n=[];i.type&&n.push(i.type),i.text&&n.push(i.text),i.message&&n.push(i.message),i.reason&&n.push(i.reason),i.code?this.error(i.code+" : "+n.join(", ")):this.error(n.join(", "))}else this.error("Unknown telnet error.");this.getOption("autoConnect")&&!this._telnet.connected&&setTimeout(()=>{this.connect()},client.getOption("autoConnectDelay")),this.emit("reconnect")}),this.telnet.on("connecting",()=>{this.connecting=!0,this.echo("Trying to connect to "+this.host+":"+this.port,-7,-8,!0,!0)}),this.telnet.on("connect",()=>{this.connecting=!1,this.echo("Connected...",-7,-8,!0,!0),this.connectTime=Date.now(),this.disconnectTime=0,this.lastSendTime=Date.now(),this.emit("connected"),this.raise("connected")}),this.telnet.on("debug",i=>{this.debug(i)}),this.telnet.on("receive-option",i=>{this.emit("received-option",i)}),this.telnet.on("close",()=>{this.connecting=!1,this.echo("Connection closed to "+this.host+":"+this.port,-7,-8,!0,!0),this.disconnectTime=Date.now(),this.emit("closed"),this.raise("disconnected"),this.connectTime=0,this.lastSendTime=0}),this.telnet.on("received-data",i=>{i={value:i},this.emit("received-data",i),!(i==null||typeof i>"u"||i.value==null||typeof i.value>"u")&&(this.printInternal(i.value,!1,!0),this.debug("Latency: "+this.telnet.latency+"ms"),this.debug("Latency: "+this.telnet.latency/1e3+"s"))}),this.telnet.on("received-MSDP",i=>{this.emit("received-MSDP",i)}),this.telnet.on("received-GMCP",i=>{let n=i.value,s,l=0,r=n.length,a;if(r===0)return;for(l=0;l<r&&(a=n.charAt(l),!(a===" "||a==="{"||a==="["));l++);s=n.substr(0,l).trim(),n=n.substr(l).trim(),this.debug("GMCP Module: "+s),this.debug("GMCP Data: "+n);let o;if(s.toLowerCase()==="client.gui"){o=n.split("/n"),n.length>=2?o={version:parseInt(o[0],10),url:o[1]}:n.length>0?o={version:parseInt(o[0],10),url:o[1]}:o={version:o,url:""},this.emit("received-GMCP",s,o);return}try{n.length>0&&(o=JSON.parse(n))}catch{this.error("Invalid GMCP");return}this.emit("received-GMCP",s,o)}),this.telnet.on("windowSize",()=>{this.UpdateWindow()});let e=Xt("host");e!==null&&e.length?this.host=e:t&&"host"in t?this.host=t.host:this.host="127.0.0.1",e=+Xt("port"),!isNaN(e)&&e>0?this.port=e:t&&"port"in t?this.port=t.port:this.port=23,this._input=new Et(this),this._input.on("scroll-lock",i=>{this.display.scrollLock=i,this.emit("scroll-lock",i)}),this._input.on("command-history-changed",i=>this.emit("command-history-changed",i)),this._input.on("item-added",(i,n,s)=>{this.emit("item-added",i,n,s)}),this._input.on("item-updated",(i,n,s,l)=>{this.emit("item-updated",i,n,s,l)}),this._input.on("item-removed",(i,n,s)=>{this.emit("item-removed",i,n,s)}),this.loadOptions(),this._commandInput.value="",this._commandInput.focus(),window.addEventListener("blur",()=>{this.active=!1,this.emit("blur"),this.raise("blur")}),window.addEventListener("focus",()=>{this.active=!0,this.emit("focus"),this.raise("focus")}),window.addEventListener("beforeunload",i=>{if(this.connected)return i&&(i.returnValue="Closing or reloading will disconnect you from the mud."),"Closing or reloading will disconnect you from the mud.";this.raise("closed")}),window.addEventListener("unload",()=>{this.connected&&this.close()}),this.addPlugin(new Rt(this)),this.addPlugin(new Ot(this)),this.getOption("autoConnect")&&setTimeout(()=>{this.connect()},client.getOption("autoConnectDelay")),this.emit("initialized")}get telnet(){return this._telnet}get variables(){return this._variables}get commandInput(){return this._commandInput}get display(){return this._display}get profiles(){return this._profiles}get plugins(){return this._plugins}get options(){return this._options}get input(){return this._input}set simpleAlarms(t){this.setOption("simpleAlarms",t)}get simpleAlarms(){return this.getOption("simpleAlarms")}set enableParsing(t){this.setOption("enableParsing",t),this._input.enableParsing=t}get enableParsing(){return this.getOption("enableParsing")}set enableTriggers(t){this.setOption("enableTriggers",t),this._input.enableTriggers=t,this.startAlarms()}get enableTriggers(){return this.getOption("enableTriggers")}get enableDebug(){return this._enableDebug}set enableDebug(t){this._enableDebug=t,this._telnet.enableDebug=t,this._display.enableDebug=t}get host(){return this._telnet.host}set host(t){this._telnet.host=t}get port(){return this._telnet.port}set port(t){this._telnet.port=t}get connected(){return this._telnet.connected}get activeProfile(){return this._profiles.active}get commandHistory(){return this._input.commandHistory}get indices(){return this._input.indices}get repeatnum(){return this._input.repeatnum}get aliases(){if(this._itemCache.aliases)return this._itemCache.aliases;let t=this.profiles.keys,e=[],i=0,n=t.length;if(n===0)return[];if(n===1)return!this.profiles.items[t[0]].enabled||!this.profiles.items[t[0]].enableAliases?this._itemCache.aliases=[]:this._itemCache.aliases=U(this.profiles.items[t[i]].aliases),this._itemCache.aliases;for(;i<n;i++)!this.profiles.items[t[i]].enabled||!this.profiles.items[t[i]].enableAliases||this.profiles.items[t[i]].aliases.length===0||e.push.apply(e,U(this.profiles.items[t[i]].aliases));return this._itemCache.aliases=e,this._itemCache.aliases}get macros(){if(this._itemCache.macros)return this._itemCache.macros;let t=this.profiles.keys,e=[],i=0,n=t.length;if(n===0)return[];if(n===1)return!this.profiles.items[t[0]].enabled||!this.profiles.items[t[0]].enableMacros?this._itemCache.macros=[]:this._itemCache.macros=U(this.profiles.items[t[i]].macros),this._itemCache.macros;for(;i<n;i++)!this.profiles.items[t[i]].enabled||!this.profiles.items[t[i]].enableMacros||this.profiles.items[t[i]].macros.length===0||e.push.apply(e,U(this.profiles.items[t[i]].macros));return this._itemCache.macros=e,this._itemCache.macros}get triggers(){if(this._itemCache.triggers)return this._itemCache.triggers;let t=this.profiles.keys,e=[],i=0,n=t.length;if(n===0)return[];if(n===1)return!this.profiles.items[t[0]].enabled||!this.profiles.items[t[0]].enableTriggers?this._itemCache.triggers=[]:this._itemCache.triggers=U(this.profiles.items[t[0]].triggers),this._itemCache.triggers;for(;i<n;i++)!this.profiles.items[t[i]].enabled||!this.profiles.items[t[i]].enableTriggers||this.profiles.items[t[i]].triggers.length===0||e.push.apply(e,U(this.profiles.items[t[i]].triggers));return this._itemCache.triggers=e,this._itemCache.triggers}removeTrigger(t){let e=this.profiles.keys,i=0,n=e.length,s=-1;if(n!==0){if(n===1){if(!this.profiles.items[e[0]].enabled||!this.profiles.items[e[0]].enableTriggers)return;s=this.profiles.items[e[i]].triggers.indexOf(t)}else for(;i<n&&s!==-1&&!(!(!this.profiles.items[e[i]].enabled||!this.profiles.items[e[i]].enableTriggers||this.profiles.items[e[i]].triggers.length===0)&&(s=this.profiles.items[e[i]].triggers.indexOf(t),s!==-1));i++);s!==-1&&(this.profiles.items[e[i]].triggers.splice(s,1),this._itemCache.triggers=null,(t.triggers.length||t.type===3)&&this._itemCache.alarms&&(s=this._itemCache.alarms.indexOf(t),s!==-1&&(this._itemCache.alarms.splice(s,1),this._itemCache.alarmPatterns.splice(s,1))),this.saveProfiles(),this.emit("item-removed","trigger",e[i],s))}}get alarms(){if(this._itemCache.alarms)return this._itemCache.alarms;let t=this.profiles.keys,e=[],i=0,n=t.length;if(n===0)return[];if(n===1)return!this.profiles.items[t[0]].enabled||!this.profiles.items[t[0]].enableTriggers?this._itemCache.alarms=[]:this._itemCache.alarms=$.grep(U(this.profiles.items[t[i]].triggers),s=>{if(s&&s.enabled&&s.triggers.length){if(s.type===3)return!0;for(let l=0,r=s.triggers.length;l<r;l++)if(s.triggers[l].enabled&&s.triggers[l].type===3)return!0;return!1}return s&&s.enabled&&s.type===3}),this._itemCache.alarms.reverse(),this._itemCache.alarms;for(;i<n;i++)!this.profiles.items[t[i]].enabled||!this.profiles.items[t[i]].enableTriggers||this.profiles.items[t[i]].triggers.length===0||e.push.apply(e,U(this.profiles.items[t[i]].triggers));return this._itemCache.alarms=$.grep(e,s=>{if(s&&s.enabled&&s.triggers.length){if(s.type===3)return!0;for(let l=0,r=s.triggers.length;l<r;l++)if(s.triggers[l].enabled&&s.triggers[l].type===3)return!0;return!1}return s&&s.enabled&&s.type===3}),this._itemCache.alarms.reverse(),this._itemCache.alarms}get buttons(){if(this._itemCache.buttons)return this._itemCache.buttons;let t=this.profiles.keys,e=[],i=0,n=t.length;if(n===0)return[];if(n===1)return!this.profiles.items[t[0]].enabled||!this.profiles.items[t[0]].enableButtons?this._itemCache.buttons=[]:this._itemCache.buttons=U(this.profiles.items[t[i]].buttons),this._itemCache.buttons;for(;i<n;i++)!this.profiles.items[t[i]].enabled||!this.profiles.items[t[i]].enableButtons||this.profiles.items[t[i]].buttons.length===0||e.push.apply(e,U(this.profiles.items[t[i]].buttons));return this._itemCache.buttons=e,this._itemCache.buttons}get contexts(){if(this._itemCache.contexts)return this._itemCache.contexts;let t=this.profiles.keys,e=[],i=0,n=t.length;if(n===0)return[];if(n===1)return!this.profiles.items[t[0]].enabled||!this.profiles.items[t[0]].enableContexts?this._itemCache.contexts=[]:this._itemCache.contexts=U(this.profiles.items[t[i]].contexts),this._itemCache.contexts;for(;i<n;i++)!this.profiles.items[t[i]].enabled||!this.profiles.items[t[i]].enableContexts||this.profiles.items[t[i]].contexts.length===0||e.push.apply(e,U(this.profiles.items[t[i]].contexts));return this._itemCache.contexts=e,this._itemCache.contexts}get defaultContext(){return this._itemCache.defaultContext!==null?this._itemCache.defaultContext:(this._itemCache.defaultContext=this.profiles.defaultContext,this._itemCache.defaultContext)}addPlugin(t){t&&(this.plugins.push(t),t.initialize())}removePlugin(t){if(!this.plugins.length)return;let e=this.plugins.indexOf(t);e!==-1&&(t.remove(),this.plugins.splice(e,1))}getVariable(t){return this.variables[t]}setVariable(t,e){this.variables[t]=e}setVariables(t){let e=Object.keys(t);if(e.length===0)return;let i=e.length,n;for(let s=0;s<i;s++)n=e[s],this.variables[n]=t[n]}hasVariable(t){return this.variables.hasOwnProperty(t)}removeVariable(t){this.variables.hasOwnProperty(t)&&delete this.variables[t]}setHistoryIndex(t){this._input.setHistoryIndex(t)}clearCommandHistory(){this._input.clearCommandHistory()}AddCommandToHistory(t){this._input.AddCommandToHistory(t)}loadProfiles(){return new Promise((t,e)=>{xt.load().then(i=>{this._profiles=i,this.profiles.contains("default")||(this.profiles.add(ye.Default),this.saveProfiles()),this.clearCache(),this.startAlarms(),this.emit("profiles-loaded"),t(this._profiles)})})}removeProfile(t){t&&(this.profiles.remove(t),this.clearCache(),this.startAlarms(),this.emit("profile-removed",t))}saveProfiles(){this._profiles.save(),this.clearCache(),this.emit("profiles-updated")}toggleProfile(t){this.profiles.toggle(t),this.saveProfiles(),this.clearCache(),this.startAlarms(),this.emit("profile-toggled",t,this.profiles[t].enabled)}startAlarms(){let t=this.alarms.length;(t===0||!this.getOption("enableTriggers"))&&this._alarm?(clearInterval(this._alarm),this._alarm=null):t&&!this._alarm&&(this._alarm=setInterval(e=>{e.process_alarms()},1e3,this))}setAlarmState(t,e){if(typeof t=="object"&&(t=this.alarms.indexOf(t)),t===-1||t>=this.alarms.length)return;let i=this._itemCache.alarmPatterns[t];if(!i){i={},this.alarms[t].type===3&&(i[0]=xe.parse(this.alarms[t]));for(let n=0,s=this.alarms[t].triggers.length;n<s;n++)this.alarms[t].triggers[n].enabled&&this.alarms[t].triggers[n].type===3&&(i[n]=xe.parse(this.alarms[t].triggers[n]));this._itemCache.alarmPatterns[t]=i}for(let n in i)i.hasOwnProperty(n)&&(e?(i[n].startTime+=Date.now()-i[n].suspended,i[n].prevTime+=Date.now()-i[n].suspended,i[n].tempTime&&(i[n].tempTime+=Date.now()-i[n].suspended),i[n].suspended=0):i[n].suspended=Date.now())}setAlarmTempTime(t,e){if(typeof t=="object"&&(t=this.alarms.indexOf(t)),t===-1||t>=this.alarms.length)return;let i=this._itemCache.alarmPatterns[t];if(!i){i={},this.alarms[t].type===3&&(i[0]=xe.parse(this.alarms[t]));for(let n=0,s=this.alarms[t].triggers.length;n<s;n++)this.alarms[t].triggers[n].enabled&&this.alarms[t].triggers[n].type===3&&(i[n]=xe.parse(this.alarms[t].triggers[n]));this._itemCache.alarmPatterns[t]=i}i[0]&&i[0].setTempTime(e)}restartAlarmState(t,e,i){if(e===i||(typeof t=="object"&&(t=this.alarms.indexOf(t)),t===-1||t>=this.alarms.length))return;let n=this._itemCache.alarmPatterns[t];if(!n){n={},this.alarms[t].type===3&&(n[0]=xe.parse(this.alarms[t]));for(let s=0,l=this.alarms[t].triggers.length;s<l;s++)this.alarms[t].triggers[s].enabled&&this.alarms[t].triggers[s].type===3&&(n[s]=xe.parse(this.alarms[t].triggers[s]));this._itemCache.alarmPatterns[t]=n}n[e]&&(n[e].restart=Date.now()),n[i]&&(n[i].restart=Date.now())}getRemainingAlarmTime(t){if(typeof t=="object"&&(t=this.alarms.indexOf(t)),t===-1||t>=this.alarms.length||!this.alarms[t].enabled)return 0;let e=this._itemCache.alarmPatterns[t];if(!e){e={},this.alarms[t].type===3&&(e[0]=xe.parse(this.alarms[t]));for(let i=0,n=this.alarms[t].triggers.length;i<n;i++)this.alarms[t].triggers[i].enabled&&this.alarms[t].triggers[i].type===3&&(e[i]=xe.parse(this.alarms[t].triggers[i]));this._itemCache.alarmPatterns[t]=e}if(e[0]){let i=e[0],n=Date.now(),s=new Date,l=n,r=l+9e7,a=1e3;if(i.seconds!==-1?a=1e3:i.minutes!==-1?a=6e4:i.hours!==-1&&(a=36e5),i.tempTime)return i.tempTime-n>0?i.tempTime-n:0;for(;l<r;){if(this.alarm_match(i,l,s))return l-n;l+=a,s.setTime(s.getTime()+a)}return-1}return 0}updateAlarms(){if(this._itemCache.alarmPatterns){let t=this._itemCache.alarmPatterns,e=this.alarms;this._itemCache.alarmPatterns=[],this._itemCache.alarms=null;let i=this.alarms.length,n=-1;for(let s=0;s<i;s++)n=e.indexOf(this.alarms[s]),n!==-1&&(this._itemCache.alarmPatterns[s]=t[n])}this.startAlarms()}process_alarms(){if(!this.getOption("enableTriggers"))return;let t=0,e=!1,i=this.alarms.length;if(i===0&&this._alarm){clearInterval(this._alarm),this._alarm=null;return}let n=this._itemCache.alarmPatterns,s=Date.now(),l=this.alarms,r=new Date;for(t=i-1;t>=0;t--){let a=l[t],o=a;if(!a.enabled)continue;if(a.state>a.triggers.length&&(a.state=0),a.state!==0&&a.triggers&&a.triggers.length){for(a=a.triggers[a.state-1];!a.enabled&&o.state!==0;){if(o.state++,o.state>o.triggers.length){o.state=0,a=a.triggers[o.state-1];break}o.state?a=a.triggers[o.state-1]:a=o,e=!0}if(e&&(this.getOption("saveTriggerStateChanges")&&this.saveProfiles(),this.emit("item-updated","trigger",o.profile.name,o.profile.triggers.indexOf(o))),!a.enabled)continue}if(a.type===131072||a.type===262144){let g=this._input.adjustLastLine(this.display.lines.length,!0),c=this.display.lines[g];t=this._input.TestTrigger(a,o,t,c,this.display.lines[g].raw||c,g===this.display.lines.length-1);continue}if(a.type!==3)continue;let f=n[t];if(!f){try{n[t]={},a.type===3&&(n[t][0]=xe.parse(a));for(let g=0,c=a.triggers.length;g<c;g++)a.triggers[g].type===3&&(n[t][g]=xe.parse(a.triggers[g]))}catch(g){throw n[t]=null,this.getOption("disableTriggerOnError")&&(a.enabled=!1,setTimeout(()=>{this.saveProfiles(),this.emit("item-updated","trigger",o.profile,o.profile.triggers.indexOf(o),o)})),g}if(f=n[t],!f)continue}f=f[a.state],f.restart&&(f.startTime=Date.now(),f.prevTime=f.startTime,f.tempTime&&(f.tempTime+=Date.now()-f.restart),f.restart=0);let p=!0;if(f.tempTime?(p=s>=f.tempTime,p&&(f.tempTime=0)):p=this.alarm_match(f,s,r),p&&!f.suspended){f.prevTime=s;let g=o.state;if(this._input.lastTriggered=f.pattern,this._input.ExecuteTrigger(a,[f.pattern],!1,-t,null,null,o),g!==o.state&&(f.restart=Date.now()),f.temp)if(o.triggers.length)if(g===0){let c=o.triggers.shift();c.state=g,c.priority=o.priority,c.name=o.name,c.profile=o.profile,c.state>c.triggers.length&&(c.state=0),c.triggers=o.triggers,l[t]=c,n[t]=null,this.saveProfiles();let S=o.profile.triggers.indexOf(o);o.profile.triggers[S]=c,this.emit("item-updated","trigger",o.profile.name,S,c)}else{o.triggers.splice(g-1,1),n[t].splice(g-1,1),o.state=g,o.state>o.triggers.length&&(o.state=0),this.saveProfiles();let c=o.profile.triggers.indexOf(o);this.emit("item-updated","trigger",o.profile.name,c,o)}else this._input.clearTriggerState(t),this.removeTrigger(o);t=-this._input.cleanUpTriggerState(-t)}}}alarm_match(t,e,i){if(!t||t.suspended)return!1;let n=!0,s,l,r,a,o,f,p;if(!moment||this.simpleAlarms){if(s=e-this.connectTime,s<1e3)return!1;l=Math.round(s/1e3),r=Math.floor(l/60),a=Math.floor(r/60),o=a,f=Math.floor(r%60),p=Math.floor(l%60)}else{if(t.start?s=moment.duration(e-this.connectTime):s=moment.duration(e-t.startTime),s.asMilliseconds()<1e3)return!1;l=Math.round(s.asMilliseconds()/1e3),r=Math.floor(l/60),a=Math.floor(r/60),o=s.hours(),f=s.minutes(),p=s.seconds()}return t.hoursWildCard?t.hours===0?n=n&&o===0:t.hours!==-1&&(n=n&&a!==0&&a%t.hours===0):t.hours!==-1&&(n=n&&t.hours===(t.start?o:i.getHours())),t.minutesWildcard?t.minutes===0?n=n&&f===0:t.minutes!==-1&&(n=n&&r!==0&&r%t.minutes===0):t.minutes!==-1&&(n=n&&t.minutes===(t.start?f:i.getMinutes())),t.secondsWildcard?t.seconds===0?n=n&&p===0:t.seconds!==-1&&(n=n&&l%t.seconds===0):t.seconds!==-1&&(n=n&&t.seconds===(t.start?p:i.getSeconds())),n}loadOptions(){this._options=new Le,this.enableDebug=this._options.enableDebug,this.display.maxLines=this._options.bufferSize,this.display.enableFlashing=this._options.flashing,this.display.enableMXP=this._options.enableMXP,this.display.showInvalidMXPTags=this._options["display.showInvalidMXPTags"],this.display.enableURLDetection=this._options.enableURLDetection,this.display.enableMSP=this._options.enableMSP,this.display.enableColors=this._options["display.enableColors"],this.display.enableBackgroundColors=this._options["display.enableBackgroundColors"],this.display.wordWrap=this._options["display.wordWrap"],this.display.wrapAt=this._options["display.wrapAt"],this.display.indent=this._options["display.indent"],this.display.showTimestamp=this._options["display.showTimestamp"],this.display.tabWidth=this._options["display.tabWidth"],this.display.timestampFormat=this._options["display.timestampFormat"];let t=this.getOption("colors");if(t&&t.length>0){let e,i=t.length;for(e=0;e<i;e++)!t[e]||t[e].length===0||this.display.SetColor(e,t[e])}this._telnet&&(this._telnet.options.MCCP=this._options.enableMCCP,this._telnet.options.MXP=this._options.enableMXP,this._telnet.UTF8=this._options.enableUTF8,this._telnet.options.ECHO=this._options.enableEcho,this._telnet.enableLatency=this._options.lagMeter,this._telnet.enablePing=this._options.enablePing),this._input.scrollLock=this._options.scrollLocked,this._input.enableParsing=this._options.enableParsing,this._input.enableTriggers=this._options.enableTriggers,this.display.scrollLock=this._options.scrollLocked,this.display.hideTrailingEmptyLine=this._options["display.hideTrailingEmptyLine"],this.display.displayControlCodes=this.getOption("display.displayControlCodes"),this.display.emulateTerminal=this.getOption("display.emulateTerminal"),this.display.emulateControlCodes=this.getOption("display.emulateControlCodes"),this._commandInput.wrap=this.getOption("commandWordWrap")?"on":"off",this.UpdateFonts&&this.UpdateFonts(),this.display.scrollDisplay(),this.loadProfiles(),this.emit("options-loaded")}setOption(t,e){t===-1||t==="-1"||(this._options[t]=e,Le.setValue(t,e),this.emit("option=changed",t,e))}getOption(t){return this._options&&t in this._options?this._options[t]:this._options[t]=Le.getValue(t)}UpdateFonts(){this.display&&(this.display.updateFont(this._options.font+", monospace",this._options.fontSize),this._commandInput.style.fontSize=this._options.cmdfontSize,this._commandInput.style.fontFamily=this._options.cmdfont+", monospace")}parse(t){this.parseInternal(t,!1,!1,!0)}parseInternal(t,e,i,n){this.display.append(t,e,i,n)}error(t){this.enableDebug&&this.debug(t);let e="";t==null||typeof t>"u"?t=new Error("Unknown"):typeof t=="string"&&t.length===0&&(t=new Error("Unknown")),t.stack&&this.getOption("showErrorsExtended")?e=t.stack:t instanceof Error||t instanceof TypeError?e=t.name+": "+t.message:t.message?e=t.message:e=""+t,e.match(/^.*Error: /g)||e.match(/^.*Error - /g)?this.echo(e,-11,-12,!0,!0):this.echo("Error: "+e,-11,-12,!0,!0),this.getOption("logErrors")&&(this.getOption("showErrorsExtended")?t.stack||(t=new Error(t||e),e=t.stack):(t.stack||(t=new Error(t||e)),e=t.stack),window.console.log(new Date().toLocaleString()),window.console.log(e),localforage.getItem("oiMUDErrorLog",function(i,n){localforage.setItem("oiMUDErrorLog",n=(n||"")+new Date().toLocaleString()+`
`+e+`
`)})),t==="Error: ECONNRESET - read ECONNRESET."&&this.telnet.connected&&this.close(),this.raise("error",e)}echo(t,e,i,n,s){t==null&&(t=""),n==null&&(n=!1),s==null&&(s=!1),e==null&&(e=-3),i==null&&(i=-4);let l="\x1B[0m"+this.display.CurrentAnsiCode()+`
`;t=""+t,t.endsWith(`
`)&&(t=t.substr(0,t.length-1)),this.telnet.prompt&&s?(this.print(`
\x1B[`+e+";"+i+"m"+t+l,n),this.telnet.prompt=!1):this.print("\x1B["+e+";"+i+"m"+t+l,n)}print(t,e){this.printInternal(t,e,!1,!0)}printInternal(t,e,i,n){t==null||typeof t>"u"||(e==null&&(e=!1),i==null&&(i=!1),e&&this.display.textLength>0&&!this.display.EndOfLine&&this.display.EndOfLineLength!==0&&!this.telnet.prompt&&!this.display.parseQueueEndOfLine&&(t=`
`+t),this.emit("print"),this.parseInternal(t,i,!1,n))}send(t,e){this.telnet.sendData(t),this.lastSendTime=Date.now(),e&&this.telnet.echo&&this.getOption("commandEcho")?this.echo(t):e&&this.echo(`
`)}sendRaw(t){this.telnet.sendData(t,!0),this.lastSendTime=Date.now()}sendGMCP(t){this.telnet.sendGMCP(t),this.lastSendTime=Date.now()}debug(t,e){let i={value:t};this.emit("debug",i),!(!this._enableDebug||i==null||typeof i>"u"||i.value==null||typeof i.value>"u"||i.value.length===0)&&window.console&&(e?window.console.log("%c"+t,e):window.console.log(i.value))}sendCommand(t,e,i){t==null&&(t=this._commandInput.value,this.telnet.echo?this._input.AddCommandToHistory(t):this._commandInput.value=""),t=""+t,t.endsWith(`
`)||(t=t+`
`);let n={value:t,handled:!1,comments:i};this.emit("parse-command",n),!(n==null||typeof n>"u")&&(n.handled||n.value==null||typeof n.value>"u"||(n.value.length>0&&this.send(n.value,!e),this.getOption("keepLastCommand")?this.getOption("selectLastCommand")&&hi(this._commandInput):this._commandInput.value=""))}sendBackground(t,e,i){t==null&&(t=this._commandInput.value,this.telnet.echo?this._input.AddCommandToHistory(t):this._commandInput.value=""),t=""+t,t.endsWith(`
`)||(t=t+`
`);let n={value:t,handled:!1,comments:i};this.emit("parse-command",n),!(n==null||typeof n>"u")&&(n.value==null||typeof n.value>"u"||!n.handled&&n.value.length>0&&this.send(n.value,!e))}get scrollLock(){return this._input.scrollLock}set scrollLock(t){this._input.scrollLock=t}toggleScrollLock(){this._input.toggleScrollLock()}UpdateWindow(){this.display.updateWindow()}close(){this.telnet.close()}connect(){this.errored=!1,this.emit("connecting"),this.display.ClearMXP(),this.display.ResetMXPLine(),this.telnet.connect(),this.emit("connect"),this._commandInput.focus()}receivedData(t){this.telnet.receivedData(t)}notify(t,e,i){this.enableDebug&&(this.emit("debug","notify title: "+t),this.emit("debug","notify msg: "+e)),this.emit("notify",t,e,i)}clear(){this.display.clear(),this.emit("cleared")}parseInline(t){return this._input.parseInline(t)}parseOutgoing(t,e,i,n){return this._input.parseOutgoing(t,e,i,n)}clearCache(){this._input.clearCaches(),this._itemCache={triggers:null,aliases:null,macros:null,buttons:null,contexts:null,defaultContext:null,alarms:null,alarmPatterns:[]}}beep(){this.emit("bell")}raise(t,e,i){if(!this.profiles){setTimeout(()=>{this.raise(t,e,i)},100);return}!i||i<1?this._input.triggerEvent(t,e):setTimeout(()=>{this._input.triggerEvent(t,e)},i)}show(){this.emit("show")}hide(){this.emit("hide")}toggle(){this.emit("toggle")}};window.Client=rt;window.Display=dt;function Ie(){let u=bootstrap.Offcanvas.getInstance(document.getElementById("clientMenu"));u&&u.hide()}function Qi(){bootstrap.Offcanvas.getOrCreateInstance(document.getElementById("clientMenu")).show()}function Si(){document.getElementById("btn-menu").addEventListener("click",Qi),client.on("connected",()=>{let n=document.getElementById("menu-connect"),s=document.querySelector("#menu-connect a span"),l=document.querySelector("#menu-connect svg")||document.querySelector("#menu-connect i");n.title="Disconnect",n.classList.add("active"),s.textContent="Disconnect",l.classList.add("fa-plug-circle-xmark"),l.classList.remove("fa-plug")}),client.on("closed",()=>{let n=document.getElementById("menu-connect"),s=document.querySelector("#menu-connect a span"),l=document.querySelector("#menu-connect svg")||document.querySelector("#menu-connect i");n.title="Connect",n.classList.remove("active"),s.textContent="Connect",l.classList.remove("fa-plug-circle-xmark"),l.classList.add("fa-plug")}),client.on("scroll-lock",vi),document.querySelector("#menu-connect a").addEventListener("click",n=>{client.connected?client.close():(client.connect(),Ie())}),document.querySelector("#menu-clear a").addEventListener("click",n=>{client.clear(),Ie()}),document.querySelector("#menu-lock a").addEventListener("click",n=>{client.toggleScrollLock(),Ie()}),document.querySelector("#menu-editor a").addEventListener("click",n=>{Ie(),document.getElementById("btn-adv-editor").click()}),document.querySelector("#menu-about a").addEventListener("click",n=>{Ae("about"),Ie()}),document.querySelector("#menu-settings a").addEventListener("click",n=>{Ae("settings"),Ie()}),document.querySelector("#menu-profiles a").addEventListener("click",n=>{Ae("profiles"),Ie()}),document.querySelector("#menu-fullscreen a").addEventListener("click",n=>{var s=window.document,l=s.documentElement,r=l.requestFullscreen||l.mozRequestFullScreen||l.webkitRequestFullScreen||l.msRequestFullscreen,a=s.exitFullscreen||s.mozCancelFullScreen||s.webkitExitFullscreen||s.msExitFullscreen;let o=document.getElementById("menu-fullscreen"),f=document.querySelector("#menu-fullscreen svg")||document.querySelector("#menu-fullscreen i"),p=document.querySelector("#menu-fullscreen a span");!s.fullscreenElement&&!s.mozFullScreenElement&&!s.webkitFullscreenElement&&!s.msFullscreenElement?(o.title="Exit fullscreen",p.textContent="Exit fullscreen",r.call(l),f.classList.add("fa-minimize"),f.classList.remove("fa-maximize")):(o.title="Enter fullscreen",p.textContent="Enter fullscreen",a.call(s),f.classList.add("fa-maximize"),f.classList.remove("fa-minimize")),Ie()}),document.querySelector("#menu-buttons a").addEventListener("click",n=>{xi();let s=document.querySelector("#menu-buttons");client.getOption("showButtons")?(s.title="Hide buttons",s.classList.add("active"),document.querySelector("#menu-buttons a span").textContent="Hide buttons"):(s.title="Show buttons",s.classList.remove("active"),document.querySelector("#menu-buttons a span").textContent="Show buttons"),Ie()}),vi();let u=client.plugins.length,h,t,e=document.querySelector("#clientMenu ul");for(let n=0;n<u;n++)if(client.plugins[n].settings&&client.plugins[n].settings.length)for(t=client.plugins[n].settings.length,h=0;h<t;h++){let s=client.plugins[n].settings[h],l,r="menu-"+(s.name||"").toLowerCase().replace(/ /g,"-");if(s.name==="-"?l='<li><hr class="dropdown-divider"></li>':typeof s.action=="string"?l=`<li id="menu-${r}" class="nav-item" title="${s.name||""}"><a class="nav-link" href="#${s.action}">${s.icon||""}${s.name||""}</i><span>${s.name||""}</span></a></li>`:l=`<li id="menu-${r}" class="nav-item" title="${s.name||""}"><a class="nav-link" href="javascript:void(0)">${s.icon||""}${s.name||""}<span>${s.name||""}</span></a></li>`,"position"in s){if(typeof s.position=="string"){if(e.querySelector(s.position)){e.querySelector(s.position).insertAdjacentHTML("afterend",l);continue}}else if(s.position>=0&&s.position<e.children.length){e.children[s.position].insertAdjacentHTML("afterend",l);continue}}e.insertAdjacentHTML("beforeend",l),s.name!=="-"&&typeof s.action=="function"&&document.querySelector(`#${r} a`).addEventListener("click",a=>{let o={client,preventDefault:!1};s.action(o),!o.preventDefault&&Ie()})}let i=document.querySelector("#menu-buttons");client.getOption("showButtons")?(i.title="Hide buttons",i.classList.add("active"),document.querySelector("#menu-buttons a span").textContent="Hide buttons"):(i.title="Show buttons",i.classList.remove("active"),document.querySelector("#menu-buttons a span").textContent="Show buttons")}function vi(){let u=document.getElementById("menu-lock"),h=document.querySelector("#menu-lock a span"),t=document.querySelector("#menu-lock svg")||document.querySelector("#menu-lock i");client.scrollLock?(u.title="Unlock display",u.classList.add("active"),h.textContent="Unlock display",t.classList.add("fa-unlock"),t.classList.remove("fa-lock")):(u.title="Lock display",u.classList.remove("active"),h.textContent="Lock display",t.classList.remove("fa-unlock"),t.classList.add("fa-lock"))}var mt=(l=>(l[l.None=0]="None",l[l.Ok=1]="Ok",l[l.Cancel=2]="Cancel",l[l.Yes=4]="Yes",l[l.No=8]="No",l[l.YesNo=12]="YesNo",l[l.Standard=3]="Standard",l))(mt||{});var ve=class extends ie{constructor(t){super();this._state={x:0,y:0,height:0,width:0,zIndex:100,maximized:!1,show:0};this._resize={x:0,y:0,height:0,width:0,type:0,minHeight:150,minWidth:300,borderHeight:1,borderWidth:1};this._dragPosition={x:0,y:0};this._windowResize=()=>{be(()=>{this.keepCentered||this._state.show===2&&!this.moveable?this.center():this.makeVisible(),this._footer.style.display!=="none"&&(this._body.style.bottom=this._footer.clientHeight+1+"px")},250,this._id+"dialogResize")};this.resizeDoDrag=t=>{let e;if((this._resize.type&1)===1&&(e=this._resize.width+t.clientX-this._resize.x,e>window.innerWidth&&(e=window.innerWidth),this._dialog.style.width=e+"px"),(this._resize.type&2)===2&&(e=this._resize.height+t.clientY-this._resize.y,e>window.innerWidth-16&&(e=window.innerHeight-16),this._dialog.style.height=e+"px"),(this._resize.type&8)===8){if(e=this._resize.height-t.clientY+this._resize.y-this._resize.borderHeight,e+this._resize.borderHeight>window.innerHeight&&(e=window.innerHeight),e+this._resize.borderHeight<=this._resize.minHeight){this._dialog.style.height=this._resize.minHeight+"px";return}this._dialog.style.height=e+"px",e=t.clientY,e>window.innerHeight&&(e=window.innerHeight),this._dialog.style.top=e+"px"}if((this._resize.type&4)===4){if(e=this._resize.width-t.clientX+this._resize.x-this._resize.borderWidth,e+this._resize.borderWidth>window.innerWidth&&(e=window.innerWidth),e+this._resize.borderWidth<=this._resize.minWidth){this._dialog.style.width=this._resize.minWidth+"px";return}this._dialog.style.width=e+"px",e=t.clientX,e>window.innerWidth&&(e=window.innerWidth),this._dialog.style.left=e+"px"}this._footer.style.display!=="none"&&(this._body.style.bottom=this._footer.clientHeight+1+"px")};this.resizeTouchDrag=t=>{if(!t.touches.length)return;let e;if((this._resize.type&1)===1&&(e=this._resize.width+t.touches[0].clientX-this._resize.x,e>window.innerWidth&&(e=window.innerWidth),this._dialog.style.width=e+"px"),(this._resize.type&2)===2&&(e=this._resize.height+t.touches[0].clientY-this._resize.y,e>window.innerWidth&&(e=window.innerHeight),this._dialog.style.height=e+"px"),(this._resize.type&8)===8){if(e=this._resize.height-t.touches[0].clientY+this._resize.y-this._resize.borderHeight,e+this._resize.borderHeight>window.innerHeight&&(e=window.innerHeight),e+this._resize.borderHeight<=this._resize.minHeight){this._dialog.style.height=this._resize.minHeight+"px";return}this._dialog.style.height=e+"px",e=t.touches[0].clientY,e>window.innerHeight&&(e=window.innerHeight),this._dialog.style.top=e+"px"}if((this._resize.type&4)===4){if(e=this._resize.width-t.touches[0].clientX+this._resize.x-this._resize.borderWidth,e+this._resize.borderWidth>window.innerWidth&&(e=window.innerWidth),e+this._resize.borderWidth<=this._resize.minWidth){this._dialog.style.width=this._resize.minWidth+"px";return}this._dialog.style.width=e+"px",e=t.touches[0].clientX,e>window.innerWidth&&(e=window.innerWidth),this._dialog.style.left=e+"px"}this._footer.style.display!=="none"&&(this._body.style.bottom=this._footer.clientHeight+1+"px")};this.resizeStopDrag=t=>{document.documentElement.removeEventListener("mousemove",this.resizeDoDrag),document.documentElement.removeEventListener("mouseup",this.resizeStopDrag),document.documentElement.removeEventListener("touchmove",this.resizeTouchDrag),document.documentElement.removeEventListener("touchend",this.resizeStopDrag);let e=document.defaultView.getComputedStyle(this._dialog);this._state.x=parseInt(e.left,10),this._state.width=parseInt(e.width,10),this._state.y=parseInt(e.top,10),this._state.height=parseInt(e.height,10),this._body.style.pointerEvents="",this.emit("resized",this._state)};this.dragMouseDown=t=>{this.maximized||(this._dragPosition.x=t.clientX,this._dragPosition.y=t.clientY,document.documentElement.addEventListener("mouseup",this.dragMouseUp),document.documentElement.addEventListener("mousemove",this.dragMouseMove),this._header.style.cursor="move")};this.dragTouchStart=t=>{this.maximized||(this._dragPosition.x=t.clientX,this._dragPosition.y=t.clientY,document.documentElement.addEventListener("touchend",this.dragMouseUp),document.documentElement.addEventListener("touchmove",this.dragTouchMove),this._header.style.cursor="move")};this.dragMouseMove=t=>{let e=this._dragPosition.x-t.clientX,i=this._dragPosition.y-t.clientY;this._dragPosition.x=t.clientX,this._dragPosition.y=t.clientY,this._state.x=this._dialog.offsetLeft-e,this._state.y=this._dialog.offsetTop-i,this._state.x>window.innerWidth-16&&(this._state.x=window.innerWidth-16),this._state.y>window.innerHeight-16&&(this._state.y=window.innerHeight-16);let n=this._size;this._state.x<16-n.width&&(this._state.x=16-n.width),this._state.y<16-n.height&&(this._state.y=16-n.height),this._dialog.style.left=this._state.x+"px",this._dialog.style.top=this._state.y+"px"};this.dragTouchMove=t=>{if(!t.touches.length)return;let e=this._dragPosition.x-t.touches[0].clientX,i=this._dragPosition.y-t.touches[0].clientY;this._dragPosition.x=t.touches[0].clientX,this._dragPosition.y=t.touches[0].clientY,this._state.x=this._dialog.offsetLeft-e,this._state.y=this._dialog.offsetTop-i,this._state.x>window.innerWidth-16&&(this._state.x=window.innerWidth-16),this._state.y>window.innerHeight-16&&(this._state.y=window.innerHeight-16);let n=this._size;this._state.x<16-n.width&&(this._state.x=16-n.width),this._state.y<16-n.height&&(this._state.y=16-n.height),this._dialog.style.left=this._state.x+"px",this._dialog.style.top=this._state.y+"px"};this.dragMouseUp=()=>{document.documentElement.removeEventListener("mouseup",this.dragMouseUp),document.documentElement.removeEventListener("mousemove",this.dragMouseMove),document.documentElement.removeEventListener("touchend",this.dragMouseUp),document.documentElement.removeEventListener("touchmove",this.dragTouchMove),this._header.style.cursor="";let t=document.defaultView.getComputedStyle(this._dialog);this._state.x=parseInt(t.left,10),this._state.width=parseInt(t.width,10),this._state.y=parseInt(t.top,10),this._state.height=parseInt(t.height,10),this.emit("moved",this._state)};this.keepCentered=!1;this.moveable=!0;this.resizable=!0;this._maximizable=!0;t&&"type"in t&&t.type==1?(this._dialog=document.createElement("div"),this._dialog.open=!1):this._dialog=document.createElement("dialog"),typeof this._dialog.showModal!="function"&&(this._dialog.showModal=()=>{this._dialog.open||(this._dialog.style.display="block",this._dialog.style.visibility="visible",this._dialog.open=!0,this._state.show=2,this._dialog.dataset.show=""+this._state.show,this._dialog._keydown||(this._dialog._keydown=o=>{o.key==="Escape"&&o.srcElement.tagName!=="TEXTAREA"&&o.srcElement.tagName!=="INPUT"&&o.srcElement.tagName!=="SELECT"&&this.close()}),this._dialog.backdrop_||(this._dialog.backdrop_=document.createElement("div"),this._dialog.backdrop_.className="backdrop",this._dialog.backdrop_MouseEvent=function(o){if(this.hasAttribute("tabindex"))this.focus();else{var f=document.createElement("div");this.insertBefore(f,this.firstChild),f.tabIndex=-1,f.focus(),this.removeChild(f)}var p=document.createEvent("MouseEvents");p.initMouseEvent(o.type,o.bubbles,o.cancelable,window,o.detail,o.screenX,o.screenY,o.clientX,o.clientY,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,o.button,o.relatedTarget),this.dispatchEvent(p),o.stopPropagation()},this._dialog.backdrop_.addEventListener("mouseup",this._dialog.backdrop_MouseEvent.bind(this._dialog)),this._dialog.backdrop_.addEventListener("mousedown",this._dialog.backdrop_MouseEvent.bind(this._dialog)),this._dialog.backdrop_.addEventListener("click",this._dialog.backdrop_MouseEvent.bind(this._dialog))),this._dialog.parentNode.insertBefore(this._dialog.backdrop_,this._dialog.nextSibling),window.document.addEventListener("keydown",this._dialog._keydown))}),typeof this._dialog.show!="function"&&(this._dialog.show=()=>{this._dialog.open||(this._dialog.style.display="block",this._dialog.style.visibility="visible",this._dialog.open=!0,this._state.show=1,this._dialog.dataset.show=""+this._state.show)}),typeof this._dialog.close!="function"&&(this._dialog.close=()=>{this._dialog.style.display="",this._dialog.style.visibility="",this._dialog.open=!1,this._state.show=0,this._dialog.dataset.show=""+this._state.show,window.removeEventListener("resize",this._windowResize),this.emit("closed")}),this._dialog.dialog=this,t&&"id"in t&&t.id&&t.id.length?this._id=t.id:(!this._id||!this._id.length)&&(this._id="dialog"+new Date().getTime()),this._dialog.id=this._id,this._dialog.style.zIndex="100",this._dialog.style.margin="0",this._dialog.classList.add("dialog"),(!t||!t.noAdaptive)&&this._dialog.classList.add("adaptive"),t&&"moveable"in t&&(this.moveable=t.moveable),t&&"resizable"in t&&(this.resizable=t.resizable),t&&"maximizable"in t&&(this._maximizable=t.maximizable),typeof t?.height=="number"?this._dialog.style.height=t.height+"px":t?.height&&t?.height.length>0?this._dialog.style.height=t.height:this._dialog.style.height="480px",typeof t?.minHeight=="number"?this._dialog.style.minHeight=t.minHeight+"px":t?.minHeight&&t?.minHeight.length>0?this._dialog.style.minHeight=t.minHeight:this._dialog.style.minHeight="150px",typeof t?.minWidth=="number"?this._dialog.style.minWidth=t.minWidth+"px":t?.minWidth&&t?.minWidth.length>0?this._dialog.style.minWidth=t.minWidth:this._dialog.style.minWidth="300px",typeof t?.width=="number"?this._dialog.style.width=t.width+"px":t?.width&&t?.width.length>0?this._dialog.style.width=t.width:this._dialog.style.width="640px",typeof t?.y=="number"?this._dialog.style.top=t.y+"px":t?.y&&t?.y.length>0?this._dialog.style.top=t.y:this._dialog.style.top="0",typeof t?.x=="number"?this._dialog.style.left=t.x+"px":t?.x&&t?.x.length>0?this._dialog.style.left=t.x:this._dialog.style.left="0";let e="";if(t&&(t.buttons&2)===2&&(e+=`<button id="${this._id}-cancel" type="button" class="btn-sm float-end btn btn-light" title="Cancel dialog">Cancel</button>`),t&&(t.buttons&1)===1&&(e+=`<button id="${this._id}-ok" type="button" class="btn-sm float-end btn btn-primary" title="Confirm dialog">Ok</button>`),t&&(t.buttons&8)===8&&(e+=`<button id="${this._id}-no" type="button" class="btn-sm float-end btn btn-light" title="No">No</button>`),t&&(t.buttons&4)===4&&(e+=`<button id="${this._id}-yes" type="button" class="btn-sm float-end btn btn-primary" title="Yes">Yes</button>`),this._dialog.innerHTML=`<div class="dialog-header">
        <button id="${this._id}-header-close" style="padding: 4px;" type="button" class="btn btn-close float-end btn-danger" data-dismiss="modal" title="Close window"></button>
        <button type="button" class="btn btn-light float-end maximize" id="${this._id}-max" title="Maximize window" style="padding: 0 4px;margin-top: -1px;"><i class="bi-arrows-fullscreen"></i></button>
        <div>${t?.title||""}</div>
    </div>
    <div class="dialog-body"></div>
    <div class="dialog-footer">${e}</div>`,this._dialog.querySelector(`#${this._id}-header-close`).addEventListener("click",()=>{this.close()}),this._dialog.querySelector(`#${this._id}-max`).addEventListener("click",()=>{this.maximized?this.restore():this.maximize()}),this._dialog.addEventListener("close",o=>{if(o.target!==this._dialog)return;let f={preventDefault:!1};if(this.emit("closing",f),f.preventDefault){o.preventDefault();return}document.body.removeChild(this._dialog),this._state.show=0,this._dialog.dataset.show=""+this._state.show,this._dialog.backdrop_&&this._dialog.parentNode.removeChild(this._dialog.backdrop_),this._dialog._keydown&&window.document.removeEventListener("keydown",this._dialog._keydown),window.removeEventListener("resize",this._windowResize),this.emit("closed",this._dialog.returnValue)}),this._dialog.addEventListener("cancel",o=>{if(o.target!==this._dialog)return;let f={preventDefault:!1};if(this.emit("canceling",f),f.preventDefault){o.preventDefault();return}if(document.activeElement&&(document.activeElement.tagName==="TEXTAREA"||document.activeElement.tagName==="iNPUT"||document.activeElement.tagName==="SELECT")){o.preventDefault();return}this._dialog.open=!1,document.body.removeChild(this._dialog),this._state.show=0,this._dialog.dataset.show=""+this._state.show,this._dialog.backdrop_&&this._dialog.parentNode.removeChild(this._dialog.backdrop_),this._dialog._keydown&&window.document.removeEventListener("keydown",this._dialog._keydown),window.removeEventListener("resize",this._windowResize),this._dialog.returnValue!=="ok"&&this.emit("canceled")}),document.body.appendChild(this._dialog),this._maximizable?this._dialog.querySelector(`#${this._id}-max`).style.display="":this._dialog.querySelector(`#${this._id}-max`).style.display="none",t&&(t.buttons&2)===2&&this._dialog.querySelector(`#${this._id}-cancel`).addEventListener("click",()=>{let o={preventDefault:!1,button:2};this.emit("button-click",o),!o.preventDefault&&(this._dialog.returnValue="cancel",this.close())}),t&&(t.buttons&8)===8&&this._dialog.querySelector(`#${this._id}-no`).addEventListener("click",()=>{let o={preventDefault:!1,button:8};this.emit("button-click",o),!o.preventDefault&&(this._dialog.returnValue="no",this.close())}),t&&(t.buttons&1)===1&&this._dialog.querySelector(`#${this._id}-ok`).addEventListener("click",()=>{let o={preventDefault:!1,button:1};this.emit("button-click",o),!o.preventDefault&&(this._dialog.returnValue="ok",this._dialog.close())}),t&&(t.buttons&4)===4&&this._dialog.querySelector(`#${this._id}-yes`).addEventListener("click",()=>{let o={preventDefault:!1,button:4};this.emit("button-click",o),!o.preventDefault&&(this._dialog.returnValue="yes",this._dialog.close())}),this._body=this._dialog.querySelector('[class="dialog-body"]'),this._title=this._dialog.querySelector('[class="dialog-header"] div'),this._footer=this._dialog.querySelector('[class="dialog-footer"]'),this._header=this._dialog.querySelector('[class="dialog-header"]'),this.resizable){this._dialog.classList.add("resizable");var i=document.createElement("div");i.className="resizer-right",this._dialog.appendChild(i),i.addEventListener("mousedown",o=>{this.initResize(o,1)},!1),i.addEventListener("touchstart",o=>{this.initResizeTouch(o,1)},{passive:!0});var n=document.createElement("div");n.className="resizer-bottom",this._dialog.appendChild(n),n.addEventListener("mousedown",o=>{this.initResize(o,2)},!1),n.addEventListener("touchstart",o=>{this.initResizeTouch(o,2)},{passive:!0});var s=document.createElement("div");s.className="resizer-se",this._dialog.appendChild(s),s.addEventListener("mousedown",o=>{this.initResize(o,3)},!1),s.addEventListener("touchstart",o=>{this.initResizeTouch(o,3)},{passive:!0}),s=document.createElement("div"),s.className="resizer-ne",this._dialog.appendChild(s),s.addEventListener("mousedown",o=>{this.initResize(o,9)},!1),s.addEventListener("touchstart",o=>{this.initResizeTouch(o,9)},{passive:!0}),s=document.createElement("div"),s.className="resizer-nw",this._dialog.appendChild(s),s.addEventListener("mousedown",o=>{this.initResize(o,12)},!1),s.addEventListener("touchstart",o=>{this.initResizeTouch(o,12)},{passive:!0}),s=document.createElement("div"),s.className="resizer-sw",this._dialog.appendChild(s),s.addEventListener("mousedown",o=>{this.initResize(o,6)},!1),s.addEventListener("touchstart",o=>{this.initResizeTouch(o,6)},{passive:!0});var l=document.createElement("div");l.className="resizer-left",this._dialog.appendChild(l),l.addEventListener("mousedown",o=>{this.initResize(o,4)},!1),l.addEventListener("touchstart",o=>{this.initResizeTouch(o,4)},{passive:!0});var r=document.createElement("div");r.className="resizer-top",this._dialog.appendChild(r),r.addEventListener("mousedown",o=>{this.initResize(o,8)},!1),r.addEventListener("touchstart",o=>{this.initResizeTouch(o,8)},{passive:!0})}this.moveable&&(this._dialog.addEventListener("mousedown",()=>{this.focus()}),this._header.addEventListener("mousedown",this.dragMouseDown),this._header.addEventListener("touchstart",this.dragTouchStart,{passive:!0}));let a=document.defaultView.getComputedStyle(this._dialog);this._state.x=this._resize.x=parseInt(a.left,10),this._state.width=this._resize.width=parseInt(a.width,10),this._state.y=this._resize.y=parseInt(a.top,10),this._state.height=this._resize.height=parseInt(a.height,10),t&&"noFooter"in t&&t.noFooter&&this.hideFooter(),t&&"maximized"in t&&t.maximized&&this.maximize(),t&&"showModal"in t&&t.showModal?this.showModal():t&&"show"in t&&t.show&&(t.show===2?this.showModal():this.show()),t&&"keepCentered"in t&&t.keepCentered&&(this.keepCentered=t.keepCentered),(this.keepCentered||t&&"center"in t&&t.center)&&this.center(),t&&"position"in t&&t.position>0&&this.position(t.position),this._windowResize(),this._resizeObserver=new ResizeObserver((o,f)=>{o.length!==0&&(!o[0].contentRect||o[0].contentRect.width===0||o[0].contentRect.height===0||(!this._resizeObserverCache||this._resizeObserverCache.height!==o[0].contentRect.height)&&(this._resizeObserverCache={width:o[0].contentRect.width,height:o[0].contentRect.height},this._footer.style.display!=="none"&&(this._body.style.bottom=this._footer.clientHeight+1+"px")))}),this._resizeObserver.observe(this._footer),this._observer=new MutationObserver(o=>{let f;for(f of o)f.type==="attributes"&&f.attributeName==="style"&&this._footer.style.display!=="none"&&(this._body.style.bottom=this._footer.clientHeight+1+"px")}),this._observer.observe(this._footer,{attributes:!0,attributeOldValue:!0,attributeFilter:["style"]})}get maximizable(){return this._maximizable}set maximizable(t){t!==this._maximizable&&(this._maximizable=t,this.maximizable?this._dialog.querySelector(`#${this._id}-max`).style.display="":this._dialog.querySelector(`#${this._id}-max`).style.display="none")}set maximized(t){this._state.maximized!==t&&(this._state.maximized=t)}get maximized(){return this._state.maximized}initResize(t,e){if(this.maximized)return;let i=document.defaultView.getComputedStyle(this._dialog);this._resize.x=t.clientX,this._resize.width=parseInt(i.width,10),this._resize.y=t.clientY,this._resize.height=parseInt(i.height,10),this._resize.type=e,this._resize.minHeight=parseInt(i.minHeight,10),this._resize.minWidth=parseInt(i.minWidth,10),this._resize.borderHeight=t.offsetY+parseInt(i.borderTopWidth),this._resize.borderWidth=t.offsetX+parseInt(i.borderLeftWidth),this._body.style.pointerEvents="none",document.documentElement.addEventListener("mousemove",this.resizeDoDrag,!1),document.documentElement.addEventListener("mouseup",this.resizeStopDrag,!1)}initResizeTouch(t,e){if(!t.touches.length||this.maximized)return;let i=document.defaultView.getComputedStyle(this._dialog);this._resize.x=t.touches[0].clientX,this._resize.width=parseInt(i.width,10),this._resize.y=t.touches[0].clientY,this._resize.height=parseInt(i.height,10),this._resize.type=e,this._resize.minHeight=parseInt(i.minHeight,10),this._resize.minWidth=parseInt(i.minWidth,10);var n=t.target.getBoundingClientRect(),s=t.targetTouches[0].clientX-n.x,l=t.targetTouches[0].clientY-n.y;this._resize.borderHeight=l+parseInt(i.borderTopWidth),this._resize.borderWidth=s+parseInt(i.borderLeftWidth),this._body.style.pointerEvents="none",document.documentElement.addEventListener("touchmove",this.resizeTouchDrag,!1),document.documentElement.addEventListener("touchend",this.resizeStopDrag,!1)}get id(){return this._id}set id(t){if(this._id!==t&&(this._id=t,this._dialog)){let e=this._dialog.id;this._dialog.id=this._id;let i=this._dialog.querySelector(`#${this._id}-cancel`);i&&(i.id=this._id+"-cancel"),i=this._dialog.querySelector(`#${this._id}-ok`),i&&(i.id=this._id+"-ok"),i=this._dialog.querySelector(`#${this._id}-max`),i&&(i.id=this._id+"-max"),i=this._dialog.querySelector(`#${this._id}-header-close`),i&&(i.id=this._id+"-header-close")}}get title(){return this._title.innerHTML}set title(t){this._title.innerHTML=t}showModal(){if(this._dialog.parentElement||document.body.appendChild(this._dialog),this.makeVisible(!0),this._dialog.open){this.focus();return}this._dialog.showModal(),this._state.show=2,this._dialog.dataset.show=""+this._state.show,window.addEventListener("resize",this._windowResize),this.emit("shown",!0),this.focus()}show(){if(this._dialog.parentElement||document.body.appendChild(this._dialog),this.makeVisible(!0),this._dialog.open){this.focus();return}this._dialog.show(),this._state.show=1,this._dialog.dataset.show=""+this._state.show,window.addEventListener("resize",this._windowResize),this.emit("shown",!1),this.focus()}get opened(){return this._dialog.open}close(){this._dialog.open&&(this._dialog.backdrop_&&this._dialog.parentNode.removeChild(this._dialog.backdrop_),this._dialog._keydown&&window.document.removeEventListener("keydown",this._dialog._keydown),this._dialog.close())}get header(){return this._header}get body(){return this._body}get footer(){return this._footer}get dialog(){return this._dialog}get left(){return this._dialog.style.left}set left(t){this._dialog.style.left=t}get top(){return this._dialog.style.top}set top(t){this._dialog.style.top=t}get width(){return this._dialog.style.width}set width(t){this._dialog.style.width=t}get height(){return this._dialog.style.height}set height(t){this._dialog.style.top=t}get windowState(){return this._state}_width(){let t=this.dialog.offsetWidth||this._dialog.clientWidth;if(!t){let e=document.defaultView.getComputedStyle(this._dialog);t=t||parseInt(e.width,10)}return t}_height(){let t=this.dialog.offsetHeight||this._dialog.clientHeight;if(!t){let e=document.defaultView.getComputedStyle(this._dialog);t=t||parseInt(e.height,10)}return t}get _size(){let t=this.dialog.offsetWidth||this._dialog.clientWidth,e=this.dialog.offsetHeight||this._dialog.clientHeight;if(!t||!e){let i=document.defaultView.getComputedStyle(this._dialog);t=t||parseInt(i.width,10),e=e||parseInt(i.height,10)}return{width:t,height:e}}center(){this.position(48)}position(t){if(t<1)return;let e=this._size;(t&4)===4?this._state.y=0:(t&8)===8?this._state.y=window.innerHeight-e.height:(t&16)===16&&(this._state.y=window.innerHeight/2-e.height/2),(t&1)===1?this._state.x=0:(t&2)===2?this._state.x=window.innerWidth-e.width:(t&32)===32&&(this._state.x=window.innerWidth/2-e.width/2),this._dialog.style.left=this._state.x+"px",this._dialog.style.top=this._state.y+"px",this._state.width=e.width,this._state.height=e.height,this.emit("moved",this._state)}maximize(){this.maximized||(this.maximized=!0,this._dialog.classList.add("maximized"),this._dialog.querySelector(`#${this._id}-max`).firstElementChild.classList.remove("bi-arrows-fullscreen"),this._dialog.querySelector(`#${this._id}-max`).firstElementChild.classList.add("bi-arrows-angle-contract"),this.emit("maximized"))}restore(){this.maximized&&(this.maximized=!1,this._dialog.classList.remove("maximized"),this._dialog.querySelector(`#${this._id}-max`).firstElementChild.classList.add("bi-arrows-fullscreen"),this._dialog.querySelector(`#${this._id}-max`).firstElementChild.classList.remove("bi-arrows-angle-contract"),this.emit("restored"))}getMaxZIndex(t){let e=document.getElementsByTagName("dialog"),i=0,n=e.length,s=parseInt(this._dialog.style.zIndex,10),l=[];for(;i<n;i++){if(!e[i].style.zIndex||!e[i].style.zIndex.length)continue;let r=parseInt(e[i].style.zIndex,10);r>s&&(s=r),l.push({z:r,idx:i,show:parseInt(e[i].dataset.show||"",10)||0})}if(this._state.zIndex=s,t||this._state.zIndex>1e3)for(this._state.zIndex=100,i=0,l.sort((r,a)=>r.show>a.show?1:r.z<a.z?-1:r.z>a.z?1:0);i<n;i++)e[l[i]].backdrop_&&(e[l[i]].backdrop_.style.zIndex=""+this._state.zIndex++),e[l[i].idx].style.zIndex=""+this._state.zIndex++}showFooter(){this._footer.style.display="",this._body.style.bottom=this._footer.clientHeight+1+"px"}hideFooter(){this._footer.style.display="none",this._body.style.bottom="0"}focus(){this._dialog.focus(),this.getMaxZIndex(),this._dialog.style.zIndex=""+ ++this._state.zIndex,this.emit("focus")}makeVisible(t,e){var i=this._dialog.getBoundingClientRect();t?(i.right>window.innerWidth&&(this._state.x=window.innerWidth-this._state.width-16,i.left<0&&(this._state.x=0),this._dialog.style.left=this._state.x+"px"),i.bottom>window.innerHeight&&(this._state.y=window.innerHeight-this._state.height-16,i.top<0&&(this._state.y=0),this._dialog.style.top=this._state.y+"px")):(i.left>window.innerWidth-16&&(this._state.x=window.innerWidth-16,this._dialog.style.left=this._state.x+"px"),i.top>window.innerHeight-16&&(this._state.y=window.innerHeight-16,this._dialog.style.top=this._state.y+"px")),e||this.emit("moved",this._state)}resetState(t){typeof t?.height=="number"?this._dialog.style.height=t.height+"px":t?.height&&t?.height.length>0?this._dialog.style.height=t.height:this._dialog.style.height="480px",typeof t?.minHeight=="number"?this._dialog.style.minHeight=t.minHeight+"px":t?.minHeight&&t?.minHeight.length>0?this._dialog.style.minHeight=t.minHeight:this._dialog.style.minHeight="150px",typeof t?.minWidth=="number"?this._dialog.style.minWidth=t.minWidth+"px":t?.minWidth&&t?.minWidth.length>0?this._dialog.style.minWidth=t.minWidth:this._dialog.style.minWidth="300px",typeof t?.width=="number"?this._dialog.style.width=t.width+"px":t?.width&&t?.width.length>0?this._dialog.style.width=t.width:this._dialog.style.width="640px",typeof t?.y=="number"?this._dialog.style.top=t.y+"px":t?.y&&t?.y.length>0?this._dialog.style.top=t.y:this._dialog.style.top="0",typeof t?.x=="number"?this._dialog.style.left=t.x+"px":t?.x&&t?.x.length>0?this._dialog.style.left=t.x:this._dialog.style.left="0";let e=document.defaultView.getComputedStyle(this._dialog);this._state.x=this._resize.x=parseInt(e.left,10),this._state.width=this._resize.width=parseInt(e.width,10),this._state.y=this._resize.y=parseInt(e.top,10),this._state.height=this._resize.height=parseInt(e.height,10),t&&"maximized"in t&&t.maximized?this.maximize():this.restore(),(this.keepCentered||t&&"center"in t&&t.center)&&this.center(),t&&"position"in t&&t.position>0&&this.position(t.position),this._windowResize()}setBody(t,e){this._body.innerHTML=t,e=e||{};let i=this._body.querySelectorAll("script");for(let n=0,s=i.length;n<s;n++)new Function("body","dialog",...Object.keys(e),i[n].textContent).apply(client,[this._body,this,...Object.values(e),this])}},lt=class extends ve{constructor(h,t,e){super(typeof h=="string"?{title:Dt(e||4)+h,width:300,height:150,keepCentered:!0,center:!0,resizable:!1,moveable:!1,maximizable:!1,buttons:1}:h),this.body.classList.add("d-flex","justify-content-center","talign-content-center","align-items-center"),t&&(this.body.innerHTML=`<div class="text-center" style="width: 64px;height:64px;font-size: 40px;">${Dt(e||4)}</div><div class="ms-3 align-self-center flex-fill">${t}</div></div>`)}},je=class extends ve{constructor(h,t,e,i){super(typeof h=="string"?{title:Dt(e||1)+h,width:300,height:150,keepCentered:!0,center:!0,resizable:!1,moveable:!1,maximizable:!1,buttons:i===void 0?12:i}:h),this.body.classList.add("d-flex","justify-content-center","align-content-center","align-items-center"),t&&(this.body.innerHTML=`<div class="text-center" style="width: 64px;height:64px;font-size: 40px;">${Dt(e||1)}</div><div class="ms-3 align-self-center flex-fill">${t}</div></div>`)}};function Dt(u){if(typeof u=="string")return u+" ";switch(u){case 3:return'<i class="fa-regular fa-circle-xmark"></i> ';case 4:return'<i class="fa-solid fa-circle-exclamation"></i> ';case 1:return'<i class="fa-regular fa-circle-question"></i> '}return'<i class="fa-solid fa-circle-info"></i> '}window.confirm_box=(u,h,t,e)=>new Promise((i,n)=>{let s=new je(u,h,t,e);s.showModal(),s.on("button-click",l=>i(l)),s.on("canceled",()=>n(null)),s.on("closed",l=>l==="Yes"?0:n(null))});window.alert_box=(u,h,t)=>{new lt(u,h,t).showModal()};window.Dialog=ve;var Mt=class extends ie{constructor(t,e){super();this._simple=!0;this._init=!1;this.colorNames={"No color":"Default",BLACK:"Black",RED:"Maroon",GREEN:"Green",ORANGE:"Olive",BLUE:"Navy",MAGENTA:"Purple",WHITE:"Silver",CYAN:"Teal","BOLD BLACK":"Grey","BOLD RED":"Red","BOLD GREEN":"Lime",YELLOW:"Yellow","BOLD YELLOW":"Yellow","BOLD BLUE":"Blue","BOLD MAGENTA":"Fuchsia","BOLD CYAN":"Aqua",BOLD:"White","BOLD WHITE":"White",RGB000:"Black",RGB001:"Navy Blue",RGB002:"Dark Blue",RGB003:"Blue",RGB004:"Blue",RGB005:"Blue",RGB010:"Dark Green",RGB011:"Deep Sky Blue",RGB012:"Deep Sky Blue",RGB013:"Deep Sky Blue",RGB014:"Cobalt/Dodger Blue",RGB015:"Dodger Blue",RGB020:"Green",RGB021:"Spring Green",RGB022:"Turquoise",RGB023:"Deep Sky Blue",RGB024:"Deep Sky Blue",RGB025:"Dodger Blue",RGB030:"Green",RGB031:"Spring Green",RGB032:"Dark Cyan",RGB033:"Light Sea Green",RGB034:"Deep Sky Blue",RGB035:"Deep Sky Blue",RGB040:"Green",RGB041:"Spring Green",RGB042:"Spring Green",RGB043:"Cyan",RGB044:"Dark Turquoise",RGB045:"Turquoise",RGB050:"Green",RGB051:"Spring Green",RGB052:"Spring Green",RGB053:"Medium Spring Green",RGB054:"Cyan",RGB055:"Cyan",RGB100:"Dark Red",RGB101:"Deep Pink",RGB102:"Purple",RGB103:"Purple",RGB104:"Purple",RGB105:"Blue Violet",RGB110:"Orange",RGB111:"Dark Grey",RGB112:"Medium Purple",RGB113:"Slate Blue",RGB114:"Slate Blue",RGB115:"Royal Blue",RGB120:"Chartreuse",RGB121:"Dark Sea Green",RGB122:"Pale Turquoise",RGB123:"Steel Blue",RGB124:"Steel Blue",RGB125:"Cornflower Blue",RGB130:"Chartreuse",RGB131:"Dark Sea Green",RGB132:"Cadet Blue",RGB133:"Cadet Blue",RGB134:"Sky Blue",RGB135:"Steel Blue",RGB140:"Chartreuse",RGB141:"Pale Green",RGB142:"Sea Green",RGB143:"Aquamarine",RGB144:"Medium Turquoise",RGB145:"Steel Blue",RGB150:"Chartreuse",RGB151:"Sea Green",RGB152:"Sea Green",RGB153:"Sea Green",RGB154:"Aquamarine",RGB155:"Dark Slate Gray",RGB200:"Dark Red",RGB201:"Deep Pink",RGB202:"Dark Magenta",RGB203:"Dark Magenta",RGB204:"Dark Violet",RGB205:"Purple",RGB210:"Orange",RGB211:"Light Pink",RGB212:"Plum",RGB213:"Medium Purple",RGB214:"Medium Purple",RGB215:"Slate Blue",RGB220:"Yellow",RGB221:"Wheat",RGB222:"Grey",RGB223:"Light Slate Grey",RGB224:"Medium Purple",RGB225:"Light Slate Blue",RGB230:"Yellow",RGB231:"Dark Olive Green",RGB232:"Dark Sea Green",RGB233:"Light Sky Blue",RGB234:"Light Sky Blue",RGB235:"Sky Blue",RGB240:"Chartreuse",RGB241:"Dark Olive Green",RGB242:"Pale Green",RGB243:"Dark Sea Green",RGB244:"Dark Slate Gray",RGB245:"Sky Blue",RGB250:"Chartreuse",RGB251:"Light Green",RGB252:"Light Green",RGB253:"Pale Green",RGB254:"Aquamarine",RGB255:"Dark Slate Gray",RGB300:"Red",RGB301:"Deep Pink",RGB302:"Medium Violet Red",RGB303:"Magenta",RGB304:"Dark Violet",RGB305:"Purple",RGB310:"Dark Orange",RGB311:"Indian Red",RGB312:"Hot Pink",RGB313:"Medium Orchid",RGB314:"Medium Orchid",RGB315:"Medium Purple",RGB320:"Dark Goldenrod",RGB321:"Light Salmon",RGB322:"Rosy Brown",RGB323:"Grey",RGB324:"Medium Purple",RGB325:"Medium Purple",RGB330:"Gold",RGB331:"Dark Khaki",RGB332:"Navajo White",RGB333:"Grey",RGB334:"Light Steel Blue",RGB335:"Light Steel Blue",RGB340:"Yellow",RGB341:"Dark Olive Green",RGB342:"Dark Sea Green",RGB343:"Dark Sea Green",RGB344:"Light Cyan",RGB345:"Light Sky Blue",RGB350:"Green Yellow",RGB351:"Dark Olive Green",RGB352:"Pale Green",RGB353:"Dark Sea Green",RGB354:"Dark Sea Green",RGB355:"Pale Turquoise",RGB400:"Crimson/Red",RGB401:"Deep Pink",RGB402:"Deep Pink",RGB403:"Magenta",RGB404:"Magenta",RGB405:"Magenta",RGB410:"Dark Orange",RGB411:"Indian Red",RGB412:"Hot Pink",RGB413:"Hot Pink",RGB414:"Orchid",RGB415:"Medium Orchid",RGB420:"Orange",RGB421:"Light Salmon/Bronze",RGB422:"Light Pink",RGB423:"Pink",RGB424:"Plum",RGB425:"Violet",RGB430:"Gold",RGB431:"Light Goldenrod",RGB432:"Tan",RGB433:"Misty Rose",RGB434:"Thistle",RGB435:"Plum",RGB440:"Yellow",RGB441:"Khaki",RGB442:"Light Goldenrod",RGB443:"Light Yellow",RGB444:"Grey",RGB445:"Light Steel Blue",RGB450:"Yellow",RGB451:"Dark Olive Green",RGB452:"Dark Olive Green",RGB453:"Dark Sea Green",RGB454:"Honeydew",RGB455:"Light Cyan",RGB500:"Red",RGB501:"Deep Pink",RGB502:"Deep Pink",RGB503:"Deep Pink",RGB504:"Magenta",RGB505:"Magenta",RGB510:"Orangered",RGB511:"Indian Red",RGB512:"Indian Red",RGB513:"Hot Pink",RGB514:"Hot Pink",RGB515:"Medium Orchid",RGB520:"Dark Orange",RGB521:"Salmon",RGB522:"Light Coral",RGB523:"Pale Violet Red",RGB524:"Orchid",RGB525:"Orchid",RGB530:"Orange",RGB531:"Sandy Brown",RGB532:"Light Salmon",RGB533:"Light Pink",RGB534:"Pink",RGB535:"Plum",RGB540:"Gold",RGB541:"Light Goldenrod",RGB542:"Light Goldenrod",RGB543:"Navajo White",RGB544:"Misty Rose",RGB545:"Thistle",RGB550:"Yellow",RGB551:"Light Goldenrod",RGB552:"Khaki",RGB553:"Wheat",RGB554:"Corn Silk",RGB555:"White",mono00:"Grey 3",mono01:"Grey 7",mono02:"Grey 11",mono03:"Grey 15",mono04:"Grey 19",mono05:"Grey 23",mono06:"Grey 27",mono07:"Grey 30",mono08:"Grey 35",mono09:"Grey 39",mono10:"Grey 32",mono11:"Grey 46",mono12:"Grey 50",mono13:"Grey 54",mono14:"Grey 58",mono15:"Grey 62",mono16:"Grey 66",mono17:"Grey 70",mono18:"Grey 74",mono19:"Grey 78",mono20:"Grey 82",mono21:"Grey 85",mono22:"Grey 89",mono23:"Grey 93"};this.colorList=[];if(!t)throw new Error("AdvEditor must be a selector, element or jquery object");if(typeof t=="string"){if(this._element=document.querySelector(t),!this._element)throw new Error("Invalid selector for AdvEditor.")}else if(t instanceof $)this._element=t[0];else if(t instanceof HTMLElement)this._element=t;else throw new Error("AdvEditor must be a selector, element or jquery object");this.simple=!e}get id(){return this._element?this._element.id:""}get element(){return this._element}get simple(){return this._simple}set simple(t){t!==this._simple&&(this._simple=t,this.tinymceExist&&(t?this.remove():this.initialize()))}clear(){this.isSimple?this._element.value="":tinymce.activeEditor.setContent("")}get value(){return this.isSimple?this._element.value:this.getFormattedText().replace(/(?:\r)/g,"")}set value(t){this.isSimple?this._element.value=t:tinymce.activeEditor.setContent(t)}insert(t){if(this.isSimple)Ge(this._element,t);else{t=ae(t),t=t.replace(/ /g,"&nbsp;"),t=t.replace(/\t/g,"&nbsp;&nbsp;&nbsp;"),t=t.replace(/(?:\r\n|\r|\n)/g,"<br/>");var e=this.getText();e===`
`?tinymce.activeEditor.undoManager.transact(()=>{tinymce.activeEditor.setContent(t)}):(e.endsWith(`
`)||(t="<br>"+t),tinymce.activeEditor.undoManager.transact(()=>{tinymce.activeEditor.dom.add(tinymce.activeEditor.getBody(),"span",{},t)}))}}get tinymceExist(){return typeof tinymce<"u"}get isSimple(){return this._simple||!this.tinymceExist}loadColors(){var t=ui(),e,i,n,s,l,r,a=[],o;this._ColorTable=[],this._colors={};var f=client.getOption("colors")||[];for(i=new X(f[0]||t[0]).toHex().substr(1).toUpperCase(),this._colors[i]="BLACK",this._ColorTable.push(i,"BLACK"),i=new X(f[1]||t[1]).toHex().substr(1).toUpperCase(),this._colors[i]="RED",this._ColorTable.push(i,"RED"),i=new X(f[2]||t[2]).toHex().substr(1).toUpperCase(),this._colors[i]="GREEN",this._ColorTable.push(i,"GREEN"),i=new X(f[3]||t[3]).toHex().substr(1).toUpperCase(),this._colors[i]="ORANGE",this._ColorTable.push(i,"ORANGE"),i=new X(f[4]||t[4]).toHex().substr(1).toUpperCase(),this._colors[i]="BLUE",this._ColorTable.push(i,"BLUE"),i=new X(f[5]||t[5]).toHex().substr(1).toUpperCase(),this._colors[i]="MAGENTA",this._ColorTable.push(i,"MAGENTA"),i=new X(f[6]||t[6]).toHex().substr(1).toUpperCase(),this._colors[i]="CYAN",this._ColorTable.push(i,"CYAN"),i=new X(f[7]||t[7]).toHex().substr(1).toUpperCase(),this._colors[i]="WHITE",this._ColorTable.push(i,"WHITE"),i=new X(f[8]||t[8]).toHex().substr(1).toUpperCase(),this._colors[i]="mono11",this._ColorTable.push(i,"BOLD BLACK"),a.push(i),i=new X(f[9]||t[9]).toHex().substr(1).toUpperCase(),this._colors[i]="BOLD%^%^RED",this._ColorTable.push(i,"BOLD RED"),a.push(i),i=new X(f[10]||t[10]).toHex().substr(1).toUpperCase(),this._colors[i]="BOLD%^%^GREEN",this._ColorTable.push(i,"BOLD GREEN"),a.push(i),i=new X(f[11]||t[11]).toHex().substr(1).toUpperCase(),this._colors[i]="BOLD%^%^YELLOW",this._ColorTable.push(i,"BOLD YELLOW"),a.push(i),i=new X(f[11]||t[11]).toHex().substr(1).toUpperCase(),this._colors[i]="YELLOW",this._ColorTable.push(i,"YELLOW"),a.push(i),i=new X(f[12]||t[12]).toHex().substr(1).toUpperCase(),this._colors[i]="BOLD%^%^BLUE",this._ColorTable.push(i,"BOLD BLUE"),a.push(i),i=new X(f[13]||t[13]).toHex().substr(1).toUpperCase(),this._colors[i]="BOLD%^%^MAGENTA",this._ColorTable.push(i,"BOLD MAGENTA"),a.push(i),i=new X(f[14]||t[14]).toHex().substr(1).toUpperCase(),this._colors[i]="BOLD%^%^CYAN",this._ColorTable.push(i,"BOLD CYAN"),a.push(i),i=new X(f[15]||t[15]).toHex().substr(1).toUpperCase(),this._colors[i]="BOLD%^%^WHITE",this._ColorTable.push(i,"BOLD WHITE"),n=0;n<6;n++)for(s=0;s<6;s++)for(l=0;l<6;l++)r=`RGB${n}${s}${l}`,i="",e=0,e=n*40+55,e<16&&(i+="0"),i+=e.toString(16),e=0,e=s*40+55,e<16&&(i+="0"),i+=e.toString(16),e=0,e=l*40+55,e<16&&(i+="0"),i+=e.toString(16),i=i.toUpperCase(),this._colors[i]||(this._colors[i]=r),this.colorList.push({color:r,hex:"#"+i,rgb:{r:n*40+55,g:s*40+55,b:l*40+55}});for(n=232;n<=255;n++)s=(n-232)*10+8,s<16?s="0"+s.toString(16).toUpperCase():s=s.toString(16).toUpperCase(),s=s+s+s,n<242?this._colors[s]||(this._colors[s]="mono0"+(n-232)):this._colors[s]||(this._colors[s]="mono"+(n-232));for(l=0,o=a.length;l<o;l++)this._colors["B"+a[l]]=this._colors[this.nearestHex("#"+a[l]).substr(1)].toUpperCase();this._colors.BFFFFFF="RGB555",tinymce.activeEditor.options.set("color_map",this._ColorTable)}initPlugins(){let t=this;tinymce.PluginManager.add("pinkfishtextcolor",function(e,i){let n="#000000",s=["000000","BLACK","800000","RED","008000","GREEN","808000","ORANGE","0000EE","BLUE","800080","MAGENTA","008080","CYAN","BBBBBB","WHITE","808080","BOLD BLACK","FF0000","BOLD RED","00FF00","BOLD GREEN","FFFF00","YELLOW","5C5CFF","BOLD BLUE","FF00FF","BOLD MAGENTA","00FFFF","BOLD CYAN","FFFFFF","BOLD WHITE"],l,r=C=>{let E=C;return{get:()=>E,set:x=>{E=x}}},a=r(n),o=r(n),f=(C,E)=>{let y;return C.dom.getParents(C.selection.getStart(),m=>{let x;(x=m.style[E==="forecolor"?"color":"background-color"])&&(y=y||x)}),y},p=(C,E,y)=>{C.undoManager.transact(()=>{C.focus(),C.formatter.apply(E,{value:y}),C.nodeChanged()})},g=(C,E)=>{C.undoManager.transact(()=>{C.focus(),C.formatter.remove(E,{value:null},null,!0),C.nodeChanged()})},c=C=>{C.addCommand("mceApplyPinkfishcolor",(E,y)=>{p(C,E,y)}),C.addCommand("mceRemovePinkfishcolor",E=>{g(C,E)}),C.addCommand("mceSetPinkfishcolor",(E,y)=>{l&&(P(l,E==="forecolor"?"pinkfishforecolor":E,y),(E==="forecolor"?a:o).set(y))})},S=C=>{let E="choiceitem",y={type:E,text:"Remove color",icon:"color-swatch-remove-color",value:"remove"};return C?[y,{type:E,text:"Custom color",icon:"color-picker",value:"custom"}]:[y]},v=(C,E,y,m)=>{y==="custom"?t.openColorDialog(E,""):y==="remove"?(m(""),C.execCommand("mceRemovePinkfishcolor",E)):(m(y),C.execCommand("mceApplyPinkfishcolor",E,y))},d=C=>{let E=[];for(let y=0;y<C.length;y+=2)E.push({text:C[y+1],value:"#"+C[y],type:"choiceitem"});return E},b=(C,E)=>d(s).concat(S(E)),L=(C,E)=>y=>{y(b(C,E))},P=(C,E,y)=>{let m=E==="pinkfishforecolor"?"tox-icon-text-color__color":"tox-icon-highlight-bg-color__color";C.setIconFill(m,y)},_=(C,E,y,m,x)=>{C.ui.registry.addSplitButton(E,{tooltip:m,presets:"color",icon:E==="pinkfishforecolor"?"text-color":"highlight-bg-color",select:W=>new X(f(C,y)||"").toHex().toLowerCase()===W.toLowerCase(),columns:5,fetch:L(s,!0),onAction:W=>{l=W,v(C,y,x.get(),()=>{})},onItemAction:(W,te)=>{l=W,v(C,y,te,ne=>{x.set(ne),C.fire("TextColorChange",{name:E,color:ne})})},onSetup:W=>{P(W,E,x.get());let te=ne=>{ne.name===E&&P(W,ne.name,ne.color)};return C.on("TextColorChange",te),()=>{C.off("TextColorChange",te)}}})},j=(C,E,y,m)=>{C.ui.registry.addNestedMenuItem(E,{text:m,icon:E==="pinkfishforecolor"?"text-color":"highlight-bg-color",getSubmenuItems:()=>[{type:"fancymenuitem",fancytype:"colorswatch",onAction:x=>{v(C,y,x.value,()=>{})}}]})};c(e),_(e,"pinkfishforecolor","forecolor","Text color",a),_(e,"pinkfishbackcolor","hilitecolor","Background color",o),j(e,"pinkfishforecolor","forecolor","Text color"),j(e,"pinkfishbackcolor","hilitecolor","Background color")}),tinymce.PluginManager.add("pinkfish",function(e){e.addCommand("mceApplyFormat",(s,l)=>{e.undoManager.transact(()=>{e.focus(),t.clearReverse($(".reverse",$(e.getDoc()).contents())),l?e.formatter.apply(s,{value:l}):e.formatter.apply(s),t.addReverse($(".reverse",$(e.getDoc()).contents())),e.nodeChanged()})}),e.addCommand("mceRemoveFormat",s=>{e.undoManager.transact(()=>{e.focus(),t.clearReverse($(".reverse",$(e.getDoc()).contents())),e.formatter.remove(s,{value:null},null,!0),t.addReverse($(".reverse",$(e.getDoc()).contents())),e.nodeChanged()})});function i(s,l){e.on("init",()=>{e.formatter.formatChanged(l,function(r){s.setActive(r)})})}function n(s){(!s||typeof s!="string")&&(s=this.settings.format),tinymce.activeEditor.undoManager.transact(()=>{$("#tinymce",tinymce.activeEditor.getDoc()).removeClass("animate"),this.clearReverse($(".reverse",$(e.getDoc()).contents())),e.execCommand("mceToggleFormat",!1,s),this.addReverse($(".reverse",$(e.getDoc()).contents())),$("#tinymce",tinymce.activeEditor.getDoc()).addClass("animate")})}e.ui.registry.addIcon("overline",'<i class="mce-i-overline"></i>'),e.ui.registry.addIcon("dblunderline",'<i class="mce-i-dblunderline"></i>'),e.ui.registry.addIcon("flash",'<i class="mce-i-flash"></i>'),e.ui.registry.addIcon("reverse",'<i class="mce-i-reverse"></i>'),e.ui.registry.addIcon("pasteformatted",'<i class="mce-i-pasteformatted"></i>'),e.ui.registry.addIcon("copyformatted",'<i class="mce-i-copyformatted"></i>'),e.ui.registry.addSplitButton("send",{icon:"send",tooltip:"Send to mud",onAction:()=>{client.sendCommand(t.getFormattedText().replace(/(?:\r)/g,"")),client.getOption("editorClearOnSend")&&tinymce.activeEditor.setContent(""),client.getOption("editorCloseOnSend")&&t.emit("close")},onItemAction:(s,l)=>{switch(l){case"formatted":client.sendCommand(t.getFormattedText().replace(/(?:\r)/g,"")),client.getOption("editorClearOnSend")&&tinymce.activeEditor.setContent(""),client.getOption("editorCloseOnSend")&&t.emit("close");break;case"text":client.sendCommand(t.getText().replace(/(?:\r)/g,"")),client.getOption("editorClearOnSend")&&tinymce.activeEditor.setContent(""),client.getOption("editorCloseOnSend")&&t.emit("close");break;case"formattednoecho":client.sendBackground(t.getFormattedText().replace(/(?:\r)/g,""),!0),client.getOption("editorClearOnSend")&&tinymce.activeEditor.setContent(""),client.getOption("editorCloseOnSend")&&t.emit("close");break;case"textnoecho":client.sendBackground(t.getText().replace(/(?:\r)/g,""),!0),client.getOption("editorClearOnSend")&&tinymce.activeEditor.setContent(""),client.getOption("editorCloseOnSend")&&t.emit("close");break;case"formattedverbatim":client.send(t.getFormattedText().replace(/(?:\r)/g,"")),client.getOption("editorClearOnSend")&&tinymce.activeEditor.setContent(""),client.getOption("editorCloseOnSend")&&t.emit("close");break;case"textverbatim":client.send(t.getText().replace(/(?:\r)/g,"")),client.getOption("editorClearOnSend")&&tinymce.activeEditor.setContent(""),client.getOption("editorCloseOnSend")&&t.emit("close");break;case"rawformatted":client.sendRaw(t.getFormattedText().replace(/(?:\r)/g,"")),client.getOption("editorClearOnSend")&&tinymce.activeEditor.setContent(""),client.getOption("editorCloseOnSend")&&t.emit("close");break;case"rawtext":client.sendRaw(t.getText().replace(/(?:\r)/g,"")),client.getOption("editorClearOnSend")&&tinymce.activeEditor.setContent(""),client.getOption("editorCloseOnSend")&&t.emit("close");break}},fetch:s=>{s([{text:"Formatted as commands",value:"formatted",type:"choiceitem"},{text:"Text as commands",value:"text",type:"choiceitem"},{text:"Formatted as commands (No echo)",value:"formattednoecho",type:"choiceitem"},{text:"Text as commands (No echo)",value:"textnoecho",type:"choiceitem"},{text:"Formatted verbatim (No echo)",value:"formattedverbatim",type:"choiceitem"},{text:"Text verbatim (No echo)",value:"textverbatim",type:"choiceitem"},{text:"Raw formatted (No echo)",value:"rawformatted",type:"choiceitem"},{text:"Raw text (No echo)",value:"rawtext",type:"choiceitem"}])}}),e.ui.registry.addButton("append",{icon:"browse",tooltip:"Append file...",onAction:()=>t.appendFile()}),e.ui.registry.addButton("clear",{icon:"remove",tooltip:"Clear",onAction:()=>t.clear()}),e.ui.registry.addButton("pasteformatted",{icon:"pasteformatted",tooltip:"Paste formatted",onAction:s=>{qt().then(l=>{t.insertFormatted(l||"")}).catch(l=>{client.enableDebug&&client.debug(l),l.message&&l.message==="Permission not granted!"?alert("Paste permission not granted."):alert("Paste not supported.")})}}),e.ui.registry.addButton("pasteastext",{icon:"paste-text",tooltip:"Paste as text",onAction:s=>{qt().then(l=>{tinymce.activeEditor.execCommand("mceInsertContent",!1,(l||"").replace(/(\r\n|\r|\n)/g,"<br/>").replaceAll("  ","&nbsp;&nbsp;"))}).catch(l=>{client.enableDebug&&client.debug(l),l.message&&l.message==="Permission not granted!"?alert("Paste permission not granted."):alert("Paste not supported.")})}}),e.ui.registry.addButton("copyformatted",{icon:"copyformatted",tooltip:"Copy formatted",onAction:s=>at(t.getFormattedSelection().replace(/(?:\r)/g,""))}),e.ui.registry.addToggleButton("overline",{icon:"overline",tooltip:"Overline",format:"overline",onAction:s=>n("overline"),onSetup:s=>i(s,"overline")}),e.ui.registry.addToggleButton("dblunderline",{icon:"dblunderline",tooltip:"Double Underline",format:"dblunderline",onAction:s=>n("dblunderline"),onSetup:s=>i(s,"dblunderline")}),e.ui.registry.addToggleButton("flash",{tooltip:"Flash",format:"flash",icon:"flash",onAction:s=>n("flash"),onSetup:s=>i(s,"flash")}),e.ui.registry.addToggleButton("reverse",{icon:"reverse",tooltip:"Reverse",format:"reverse",onAction:s=>n("reverse"),onSetup:s=>i(s,"reverse")}),e.ui.registry.addMenuItem("style",{text:"Style",menu:[{image:"overline",text:"Overline",format:"overline",onclick:n,onpostrender:i},{image:"dblunderline",text:"Double Underline",format:"dblunderline",onclick:n,onpostrender:i},{text:"Flash",format:"flash",image:"flash",onclick:n,onpostrender:i},{image:"reverse",text:"Reverse",format:"reverse",onclick:n,onpostrender:i}]}),e.ui.registry.addMenuItem("overline",{image:"overline",text:"Overline",format:"overline",onclick:n,onpostrender:i}),e.ui.registry.addMenuItem("dblunderline",{image:"dblunderline",text:"Double Underline",format:"dblunderline",onclick:n,onpostrender:i}),e.ui.registry.addMenuItem("flash",{text:"Flash",format:"flash",image:"flash",onclick:n,onpostrender:i}),e.ui.registry.addMenuItem("reverse",{image:"reverse",text:"Reverse",format:"reverse",onclick:n,onpostrender:i}),e.on("Change",()=>{t.addReverse($(".reverse",$(e.getDoc()).contents()))}),e.addShortcut("ctrl+s","Strikethrough",()=>{n("strikethrough")}),e.addShortcut("ctrl+o","Overline",()=>{n("overline")}),e.addShortcut("ctrl+d","Double Underline",()=>{n("dblunderline")}),e.addShortcut("ctrl+f","Flash",()=>{n("flash")}),e.addShortcut("ctrl+r","Reverse",()=>{n("reverse")})})}clearReverse(t,e){t.each(function(){if($(this).data("reverse")&&!(e&&$(this).hasClass("reverse"))){var i,n;e?(i=$(this).css("color"),n=$(this).css("background-color")):(n=$(this).parent().css("color"),i=$(this).parent().css("background-color")),i==="black"&&(i=""),n==="rgba(0, 0, 0, 0)"&&(n="black"),$(this).css("color",n),$(this).css("background-color",i),$(this).children().length&&this.clearReverse($(this).children(),!0)}})}addReverse(t,e){t.each(function(){if(!(e&&$(this).hasClass("reverse"))){var i,n;e?(i=$(this).css("color"),n=$(this).css("background-color")):(i=$(this).parent().css("color"),n=$(this).parent().css("background-color")),i==="rgba(0, 0, 0, 0)"&&(i="black"),n==="rgba(0, 0, 0, 0)"&&(n="black"),$(this).children().length&&(this.clearReverse($(this).children(),!0),this.addReverse($(this).children(),!0)),$(this).css("color",n),$(this).css("background-color",i),$(this).data("reverse",!0)}})}colorCell(t,e){var i='<td class="mce-grid-cell'+(t==="transparent"?" mce-colorbtn-trans":"")+'">';return i+='<div id="'+e+'"',i+=' data-mce-color="'+t+'"',i+=' role="option"',i+=' tabIndex="-1"',i+=' style="background-color: '+(t==="transparent"?t:"#"+t)+'"',this.colorNames[e]?i+=' title="'+e+", "+this.colorNames[e]+'">':i+=' title="'+e+'">',t==="transparent"&&(i+="&#215;"),i+="</div>",i+="</td>",i}openColorDialog(t,e){if(!this._colorDialog){this._colorDialog=new ve({noFooter:!0,title:'<i class="fas fa-palette"></i> Pick color',center:!0,resizable:!1,moveable:!1,maximizable:!1,width:380,height:340}),this._colorDialog.body.style.alignItems="center",this._colorDialog.body.style.display="flex";let s,l,r,a,o,f;var i='<table style="margin : auto !important;" class="mce-grid mce-grid-border mce-colorbutton-grid" role="list" cellspacing="0"><tbody><tr>';for(s=0,l=this._ColorTable.length;s<l;s+=2)i+=this.colorCell(this._ColorTable[s],this._ColorTable[s+1]),s/2%6===5&&(i+='<td class="mce-grid-cell"></td>');i+='<td class="mce-grid-cell"></td>',i+=this.colorCell("transparent","No color"),i+="</tr><tr><td></td></tr>";var n="";for(r=0;r<6;r++){for(a<3?i+="<tr>":n+="<tr>",a=0;a<6;a++){for(o=0;o<6;o++)f=`RGB${r}${a}${o}`,e="",s=0,s=r*40+55,s<16&&(e+="0"),e+=s.toString(16),s=0,s=a*40+55,s<16&&(e+="0"),e+=s.toString(16),s=0,s=o*40+55,s<16&&(e+="0"),e+=s.toString(16),e=e.toUpperCase(),a<3?i+=this.colorCell(e,f):n+=this.colorCell(e,f);a===2?i+="</tr>":a<3?i+='<td class="mce-grid-cell"></td>':a<5&&(n+='<td class="mce-grid-cell"></td>')}a<3?i+="</tr>":n+="</tr>"}for(i+=n,i+="<tr><td></td></tr><tr>",r=232;r<=255;r++)a=(r-232)*10+8,a<16?a="0"+a.toString(16).toUpperCase():a=a.toString(16).toUpperCase(),a=a+a+a,i+=this.colorCell(a,e),(r===237||r===249)&&(i+='<td class="mce-grid-cell"></td>'),r===243&&(i+="</tr><tr>");i+="</tr></tbody></table>",i+=`<style>
.mce-colorbtn-trans div {line-height: 14px;overflow: hidden;}
.mce-grid td.mce-grid-cell div{border:1px solid #c5c5c5;width:15px;height:15px;margin:0;cursor:pointer}.mce-grid td.mce-grid-cell div:focus{border-color:#91bbe9}.mce-grid td.mce-grid-cell div[disabled]{cursor:not-allowed}            
.mce-grid{border-spacing:2px;border-collapse:separate}.mce-grid a{display:block;border:1px solid transparent}.mce-grid a:hover,.mce-grid a:focus{border-color:#91bbe9}.mce-grid-border{margin:0 4px 0 4px}.mce-grid-border a{border-color:#c5c5c5;width:13px;height:13px}.mce-grid-border a:hover,.mce-grid-border a.mce-active{border-color:#91bbe9;background:#bdd6f2}            
            </style>`,this._colorDialog.body.innerHTML=i;let p=this._colorDialog.body.querySelectorAll("div");for(s=0,l=p.length;s<l;s++)p[s].addEventListener("click",g=>{e=g.currentTarget.dataset.mceColor,e==="transparent"?tinymce.activeEditor.execCommand("mceRemoveFormat",this._colorDialog.dialog.dataset.type):tinymce.activeEditor.execCommand("mceApplyFormat",this._colorDialog.dialog.dataset.type,"#"+e),tinymce.activeEditor.execCommand("mceSetTextcolor",this._colorDialog.dialog.dataset.type,"#"+e),this._colorDialog.close()})}this._colorDialog.dialog.dataset.type=t,this._colorDialog.showModal()}appendFile(){ue("Append file(s)",!0).then(t=>{for(var e=0,i=t.length;e<i;e++)pe(t[e]).then(n=>{this.insert(n)}).catch(client.error)}).catch(()=>{})}insertFormatted(t){this.isSimple?Ge(this._element,t):tinymce.activeEditor.execCommand("insertHTML",!1,jt(t).replace(/(\r\n|\r|\n)/g,"<br/>"))}setFormatted(t){this.isSimple?this._element.value=t:tinymce.activeEditor.getBody().innerHTML=jt(t).replace(/(\r\n|\r|\n)/g,"<br/>")}buildHTMLStack(t){for(var e,i,n,s,l=[],r,a=0,o=t.length;a<o;a++)if(i=$(t[a]),e=i.prop("tagName"),e==="EM"||e==="I"?e="ITALIC":(e==="STRONG"||e==="B")&&(e="BOLD"),!e)l.push('"'+i.text()+'"');else if(e==="SPAN"){if(r=[],t[a].className!="")for(e=t[a].className.toUpperCase().split(/\s+/g),s=e.length,n=0;n<s;n++)e[n]==="NOFLASH"?r.push("FLASH"):e[n].length>0&&r.push(e[n]);if(i.css("text-decoration")==="line-through"&&r.push("STRIKEOUT"),i.css("text-decoration")==="underline"&&r.push("UNDERLINE"),i.data("mce-style"))for(e=i.data("mce-style").toUpperCase().split(";"),s=e.length,n=0;n<s;n++)e[n].endsWith("INHERIT")||e[n].endsWith("BLACK")||(e[n]=e[n].trim(),e[n]=e[n].replace("BACKGROUND:","BACKGROUND-COLOR:"),e[n].length>0&&r.push(e[n]));else if(i.css("color")||i.css("background-color")||i.css("background"))for(e=[],i.css("color")&&e.push("COLOR: "+new X(i.css("color")).toHex().toUpperCase()),i.css("background-color")&&e.push("BACKGROUND-COLOR: "+new X(i.css("background-color")).toHex().toUpperCase()),i.css("background")&&e.push("BACKGROUND-COLOR: "+new X(i.css("background")).toHex().toUpperCase()),s=e.length,n=0;n<s;n++)e[n].length>0&&r.push(e[n].trim());for(s=r.length,n=0;n<s;n++)r[n].length&&l.push(r[n].trim());for(l=l.concat(this.buildHTMLStack(i.contents())),n=s-1;n>=0;n--)r[n].length&&l.push("/"+r[n].trim())}else e=="BR"&&i.data("mce-bogus")?l.push("RESET"):(l.push(e),l=l.concat(this.buildHTMLStack(i.contents())),l.push("/"+e));return l}getFormattedSelection(){for(var t=tinymce.activeEditor.dom.getParents(tinymce.activeEditor.selection.getNode()),e=0,i=t.length,n="<html>",s="</html>";e<i;e++){var l=t[e].tagName;if(l==="EM"||l==="I"||l==="STRONG"||l==="B")n+="<"+l+">",s="</"+l+">"+s;else if(l==="SPAN"){n+="<"+l,t[e].className!=""&&(n+=' class="'+t[e].className+'"');var r="";t[e].style.textDecoration!=""&&(r+="text-decoration:"+t[e].style.textDecoration+";"),t[e].style.color!=""&&(r+="color:"+t[e].style.color+";"),t[e].style.background!=""&&(r+="background:"+t[e].style.background+";"),t[e].style.backgroundColor!=""&&(r+="background-color:"+t[e].style.backgroundColor+";"),r.length>0&&(n+=' style="'+r+'"'),t[e].dataset&&t[e].dataset.mceStyle&&(n+=' data-mce-style="'+t[e].dataset.mceStyle+'"'),n+=" >",s="</"+l+">"+s}else if(l==="BODY"){n+="<"+l+">",s="</"+l+">"+s;break}}return this.formatHtml($(n+tinymce.activeEditor.selection.getContent({format:"raw"}).replace(/<\/div><div>/g,"<br>")+s))}getFormattedText(){return this.isSimple?this._element.value:this.formatHtml($("<html>"+this.getRaw()+"</html>"))}getText(){return this.isSimple?this._element.value:tinymce.activeEditor.getContent({format:"text"})}getHTML(){return this.isSimple?this._element.value:tinymce.activeEditor.getContent({format:"html"})}getRaw(){return this.isSimple?this._element.value:tinymce.activeEditor.getContent({format:"raw"})}formatHtml(t){var e=this.buildHTMLStack(t),i=[],n=[],s,l,r,a;for(l=e.length-1;l>=0&&(!e[l].startsWith('"')&&e[l]!="BR"&&e[l]!="RESET");l--)e.pop();for(e[0]==="DIV"&&e.shift(),l=0,r=e.length;l<r;l++)switch(e[l]){case"BOLD":case"ITALIC":case"UNDERLINE":case"STRIKEOUT":case"DBLUNDERLINE":case"OVERLINE":case"FLASH":case"REVERSE":n.push("%^"+e[l]+"%^"),i.push("%^"+e[l]+"%^");break;case"/DBLUNDERLINE":case"/OVERLINE":case"/FLASH":case"/REVERSE":case"/UNDERLINE":case"/BOLD":case"/ITALIC":case"/STRIKEOUT":n.pop(),this.cleanReset(i),i.push("%^RESET%^"),n.length>0&&i.push(n.join(""));break;case"SPAN":case"/SPAN":case"/BR":case"/DIV":break;case"DIV":case"BR":n.length>0&&i.length>0&&!i[i.length-1].endsWith("%^RESET%^")&&(this.cleanReset(i),i.push("%^RESET%^")),i.push(`
`),n.length>0&&i.push(n.join(""));break;case"RESET":n.length>0&&i.length>0&&!i[i.length-1].endsWith("%^RESET%^")&&(this.cleanReset(i),i.push("%^RESET%^")),n.length>0&&i.push(n.join(""));break;default:e[l].startsWith("COLOR: #")?(s=e[l].substr(8),this._colors[s]||(a=new X(s),s=this.nearestHex(a.toHex()).substr(1)),s=this._colors[s],(s==="BOLD BLACK"||s==="BOLD%^%^BLACK")&&(s="mono11"),n.push("%^"+s+"%^"),i.push("%^"+s+"%^")):e[l].startsWith("COLOR: ")?(s=new X(e[l].substr(7)).toHex().substr(1),this._colors[s]||(s=this.nearestHex("#"+s).substr(1)),s=this._colors[s],(s==="BOLD BLACK"||s==="BOLD%^%^BLACK")&&(s="mono11"),n.push("%^"+s+"%^"),i.push("%^"+s+"%^")):e[l].startsWith("/COLOR: ")?(n.pop(),this.cleanReset(i),i.push("%^RESET%^"),n.length>0&&i.push(n.join(""))):e[l].startsWith("BACKGROUND-COLOR: #")?(s=e[l].substr(19),this._colors[s]||(a=new X(s),s=this.nearestHex(a.toHex()).substr(1)),this._colors["B"+s]?s=this._colors["B"+s]:s=this._colors[s],s="%^B_"+s+"%^",n.push(s),i.push(s)):e[l].startsWith("BACKGROUND-COLOR: ")?(s=new X(e[l].substr(18)).toHex().substr(1),this._colors[s]||(s=this.nearestHex("#"+s).substr(1)),this._colors["B"+s]?s=this._colors["B"+s]:s=this._colors[s],s="%^B_"+s+"%^",n.push(s),i.push(s)):e[l].startsWith("/BACKGROUND-COLOR: ")?(n.pop(),this.cleanReset(i),i.push("%^RESET%^"),n.length>0&&i.push(n.join(""))):e[l].startsWith('"')&&i.push(e[l].substring(1,e[l].length-1));break}return i.join("")}cleanReset(t){let e=t.length-1;for(;e>=0;e--)if(t[e].startsWith("%^"))t.pop();else return t;return t}nearestHex(t){var e=this,i=function(s){var l=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;s=s.replace(l,function(f,p,g,c){return[p,p,g,g,c,c].join()});var r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?/i,a=r.exec(s),o=a?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null;return o},n=function(s){if(!s)throw new Error("The hex you provided is not formatted correctly. Please try in a format such as '#FFF' or '#DDFFDD'.");for(var l=Number.MAX_SAFE_INTEGER,r=null,a=0;a<e.colorList.length;a++){var o=e.colorList[a],f=Math.sqrt(Math.pow(s.r-o.rgb.r,2)+Math.pow(s.g-o.rgb.g,2)+Math.pow(s.b-o.rgb.b,2));f<l&&(l=f,r=o.hex)}return r};return n(i(t))}remove(){tinymce.remove(`#${this._element.id}`)}initialize(){this.isSimple||(this.initPlugins(),tinymce.init({license_key:"gpl",custom_colors:!1,selector:`textarea#${this._element.id}`,height:500,menubar:!1,browser_spellcheck:!0,resize:!0,statusbar:!1,nowrap:!0,force_br_newlines:!0,forced_root_block:"div",plugins:"pinkfish insertdatetime pinkfishtextcolor nonbreaking",color_picker_callback:(t,e,i)=>{this.openColorDialog(i,e||"")},color_picker_caption:"More&hellip;",textcolor_rows:"3",textcolor_cols:"8",toolbar:"send | append | undo redo | pinkfishforecolor pinkfishbackcolor | italic underline strikethrough overline dblunderline flash reverse | clear | copy copyformatted | insertdatetime",toolbar_mode:"sliding",content_css:"css/tinymce.content.min.css",formats:{bold:{inline:"strong",exact:!0,links:!0,remove_similar:!0},italic:{inline:"em",exact:!0,links:!0,remove_similar:!0},overline:{inline:"span",classes:"overline",links:!0,remove_similar:!0},dblunderline:{inline:"span",classes:"dblunderline",links:!0,remove_similar:!0},flash:{inline:"span",classes:"flash",links:!0,remove_similar:!0},reverse:{inline:"span",classes:"reverse",links:!0,remove_similar:!0},underline:{inline:"span",classes:"underline",links:!0,remove_similar:!0},strikethrough:{inline:"span",classes:"strikeout",links:!0,remove_similar:!0}},init_instance_callback:t=>{t.shortcuts.add("ctrl+shift+c","Copy formatted",()=>at(this.getFormattedSelection().replace(/(?:\r)/g,""))),t.on("PastePreProcess",e=>{client.getOption("enableDebug")&&client.debug("Advanced Before Editor PastePreProcess: "+e.content),this.clearReverse($(".reverse",$(t.getDoc()).contents())),e.content=e.content.replace(/<\/p>/g,"<br>"),e.content=e.content.replace(/<\/h[1-6]>/g,"<br>"),e.content=e.content.replace(/<\/li>/g,"<br>"),e.content=e.content.replace(/ background: #000000;/g,""),e.content=e.content.replace(/background: #000000;/g,""),e.content=e.content.replace(/ background-color: #000000;/g,""),e.content=e.content.replace(/background-color: #000000;/g,""),e.content=e.content.replace(/ color: #BBBBBB;/g,""),e.content=e.content.replace(/color: #BBBBBB;/g,"");for(var i=/<pre(.*?)>((.|\s)*)<\/pre>/mgi,n;(n=i.exec(e.content))!==null;)n.index===i.lastIndex&&i.lastIndex++,e.content=e.content.substring(0,n.index)+e.content.substring(n.index,i.lastIndex).replace(/(\r\n|\r|\n)/g,"<br/>").replaceAll("  ","&nbsp;&nbsp;")+e.content.substring(i.lastIndex);client.getOption("enableDebug")&&client.debug("Advanced After Editor PastePreProcess: "+e.content)}),t.on("PastePreProcess",()=>{this.addReverse($(".reverse",$(t.getDoc()).contents()))}),$(".mce-content-body",tinymce.activeEditor.getDoc()).css("font-size",client.getOption("cmdfontSize")),$(".mce-content-body",tinymce.activeEditor.getDoc()).css("font-family",client.getOption("cmdfont")+", monospace"),tinymce.activeEditor.formatter?tinymce.activeEditor.formatter.register("flash",{inline:"span",classes:client.getOption("flashing")?"flash":"noflash",links:!0,remove_similar:!0}):tinymce.activeEditor.settings.formats.flash={inline:"span",classes:client.getOption("flashing")?"flash":"noflash",links:!0,remove_similar:!0},this.loadColors(),this.setFormatted(this._element.value),t.on("click",e=>{this.emit("click",e)}),this.emit("editor-init"),this._init=!0},paste_data_images:!1,paste_webkit_styles:"color background background-color text-decoration",valid_elements:"strong/b,em/i,u,span[style|class],strike/s,br",valid_styles:{"*":"color,background,background-color,text-decoration,font-weight"},color_map:this._ColorTable}))}focus(){this.isSimple?this._element.focus():this._init&&tinymce.activeEditor&&tinymce.activeEditor.initialized&&tinymce.activeEditor.focus()}};var At=class u extends ve{constructor(){super({title:'<i class="fas fa-cogs"></i> Settings',keepCentered:!0,resizable:!1,moveable:!1,center:!0,maximizable:!1}),this.body.style.padding="10px",this.buildMenu();let h="";h+=`<button id="${this.id}-cancel" type="button" class="btn-sm float-end btn btn-light" title="Cancel dialog"><i class="bi bi-x-lg"></i><span class="icon-only"> Cancel</span></button>`,h+=`<button id="${this.id}-save" type="button" class="btn-sm float-end btn btn-primary" title="Confirm dialog"><i class="bi bi-save"></i><span class="icon-only"> Save</span></button>`,h+=`<button id="${this.id}-reset" type="button" class="btn-sm float-start btn btn-light" title="Reset settings"><i class="bi bi-arrow-clockwise"></i><span class="icon-only"> Reset</span></button>`,h+=`<button id="${this.id}-reset-all" type="button" class="btn-sm float-start btn btn-light" title="Reset All settings"><i class="bi bi-arrow-repeat"></i><span class="icon-only"> Reset All</span></button>`,h+='<div class="vr float-start" style="margin-right: 4px;height: 29px;"></div>',h+=`<button id="${this.id}-export" type="button" class="btn-sm float-start btn btn-light" title="Export settings"><i class="bi bi-box-arrow-up"></i><span class="icon-only"> Export</span></button>`,h+=`<button id="${this.id}-import" type="button" class="btn-sm float-start btn btn-light" title="Import settings"><i class="bi bi-box-arrow-in-down"></i><span class="icon-only"> Import</span></button>`,this.footer.innerHTML=h,this.footer.querySelector(`#${this.id}-cancel`).addEventListener("click",()=>{de(this._page),this.close()}),this.footer.querySelector(`#${this.id}-export`).addEventListener("click",()=>{var t=Te(this.settings);t.version=2,fileSaveAs.show(JSON.stringify(t),"oiMUD.settings.txt","text/plain")}),this.footer.querySelector(`#${this.id}-import`).addEventListener("click",()=>{ue("Import settings").then(t=>{pe(t[0]).then(e=>{try{var i=JSON.parse(e),n,s;if(i.version===1){for(n=0,s=H.length;n<s;n++)this.settings[H[n][0]]=i[H[n][0]];this.emit("import-rooms",i.rooms)}else if(i.version===2&&!i.profiles)for(n=0,s=H.length;n<s;n++)this.settings[H[n][0]]=i[H[n][0]];else setTimeout(function(){new lt("Invalid file","Unable to import file, not a valid settings file",4).showModal()},50);this.loadPageSettings()}catch(l){setTimeout(function(){new lt("Error importing","Error importing file.",3).showModal()},50),client.error(l)}}).catch(client.error)}).catch(()=>{})}),this.footer.querySelector(`#${this.id}-reset`).addEventListener("click",()=>{if(this._page==="settings-colors"){let t=new je("Reset colors","Reset colors?");t.on("button-click",e=>{if(e.button===4){var i,n=this.settings.colors=[];for(i=0;i<16;i++)this.setColor("color"+i,n[i]||this.getDefaultColor(i));for(i=256;i<280;i++)this.setColor("color"+i,n[i]||this.getDefaultColor(i));this.body.querySelector("#colorScheme").value=0}}),t.showModal()}else if(this._page&&this._page!=="settings"&&this._page.length){let t=this._page.split("-"),e=he(t[t.length-1].match(/([A-Z]|^[a-z])[a-z]+/g).join(" ")),i=new je(`Reset ${e} settings`,`Reset ${e} settings?`);i.on("button-click",n=>{if(n.button===4){let s=this.body.querySelectorAll("input,select,textarea");for(let l=0,r=s.length;l<r;l++)this.settings[s[l].id]=Le.defaultValue(s[l].id),s[l].type==="checkbox"?s[l].checked=this.settings[s[l].id]:s[l].value=this.settings[s[l].id]}}),i.showModal()}else{let t=new je("Reset all settings","Reset all settings?");t.on("button-click",e=>{e.button===4&&this.settings.reset()}),t.showModal()}}),this.footer.querySelector(`#${this.id}-reset-all`).addEventListener("click",()=>{let t=new je("Reset all settings","Reset all settings?");t.on("button-click",e=>{e.button===4&&this.settings.reset()}),t.showModal()}),this.footer.querySelector(`#${this.id}-save`).addEventListener("click",()=>{de(this._page);for(var t in this.settings)this.settings.hasOwnProperty(t)&&Le.setValue(t,this.settings[t]);client.clearCache(),client.loadOptions(),this.close()}),this.settings=new Le,this.on("closed",()=>{de(this._page)}),this.on("canceled",()=>{de(this._page)})}setBody(h,t){super.setBody(this.dialog.dataset.path==="settings"?u.menuTemplate:h,t),this._page=this.dialog.dataset.path;let e=this._page.split("-"),i="",n=e.length-1;e.length===1?i+='<li><i class="float-start fas fa-cogs" style="padding: 2px;margin-right: 2px;"></i></li>':i+='<li><a href="#'+e.slice(0,1).join("-")+'"><i class="float-start fas fa-cogs" style="padding: 2px;margin-right: 2px;"></i></a></li>';for(let s=0,l=e.length;s<l;s++){let r=he(e[s].match(/([A-Z]|^[a-z])[a-z]+/g).join(" "));s===n?i+='<li class="breadcrumb-item active">'+r+"</li>":i+='<li class="breadcrumb-item" aria-current="page"><a href="#'+e.slice(0,s+1).join("-")+'">'+r+"</a></li>"}this.title='<ol class="float-start breadcrumb">'+i+"</ol>",this._page==="settings"?(this._menu&&(this._menu.style.display="none"),this.body.style.left="",this.footer.querySelector(`#${this.id}-reset`)&&(this.footer.querySelector(`#${this.id}-reset`).style.display="none"),u.addPlugins(this.body.querySelector("div.contents"))):(this._menu&&(this._menu.style.display=""),this.footer.querySelector(`#${this.id}-reset`)&&(this.footer.querySelector(`#${this.id}-reset`).style.display=""),this.body.style.left="200px"),this.body.scrollTop=0,this.loadPageSettings()}buildMenu(){this.dialog.insertAdjacentHTML("beforeend",u.menuTemplate.replace(' style="top:0;position: absolute;left:0;bottom:49px;right:0;"',"")),this._menu=this.dialog.querySelector(".contents"),this._menu.classList.add("settings-menu"),u.addPlugins(this._menu),this._page==="settings"&&(this._menu.style.display="none"),this.body.style.left="200px"}loadPageSettings(){let h=this.body.querySelectorAll("input,select,textarea");if(this._page==="settings-colors"){var t,e=this.settings.colors||[];for(t=0;t<16;t++)this.setColor("color"+t,e[t]||this.getDefaultColor(t));for(t=256;t<280;t++)this.setColor("color"+t,e[t]||this.getDefaultColor(t));for(let i=0,n=h.length;i<n;i++)h[i].addEventListener("change",s=>{let l=s.currentTarget||s.target,r=l.value,a=parseInt(l.id.substring(5),10);var o=this.settings.colors||[];!o[a]||o[a].length===0?this.getDefaultColor(a)!==r&&(o[a]=r):this.getDefaultColor(a)!==r?delete o[a]:o[a]=r,this.settings.colors=o}),h[i].addEventListener("input",s=>{let l=s.currentTarget||s.target,r=l.value,a=parseInt(l.id.substring(5),10);!this.settings.colors[a]||this.settings.colors[a].length===0?this.getDefaultColor(a)!==r&&(this.settings.colors[a]=r):this.getDefaultColor(a)!==r?delete this.settings.colors[a]:this.settings.colors[a]=r})}else for(let i=0,n=h.length;i<n;i++)if(h[i].type==="radio")h[i].checked=""+this.settings[h[i].name]===h[i].value,h[i].addEventListener("change",s=>{let l=s.currentTarget||s.target;l.checked&&(this.settings[l.name]=this.convertType(l.value,typeof this.settings[l.name]))});else if(h[i].type==="checkbox"){if(h[i].dataset.enum==="true"){let s=h[i].name||h[i].id.substring(0,h[i].id.lastIndexOf("-")),l=+h[i].id.substring(h[i].id.lastIndexOf("-")+1);h[i].checked=(this.settings[s]&l)===l}else h[i].checked=this.settings[h[i].id];h[i].addEventListener("change",s=>{let l=s.currentTarget||s.target;if(l.dataset.enum==="true"){let r=l.name||l.id.substring(0,l.id.lastIndexOf("-")),a=this.body.querySelectorAll(`[name=${r}]`),o=0;for(let f=0,p=a.length;f<p;f++)a[f].checked&&(o|=+a[f].value);this.settings[r]=o}else this.settings[l.id]=l.checked||!1})}else h[i].value=this.settings[h[i].id],h[i].addEventListener("change",s=>{let l=s.currentTarget||s.target;this.setValue(l.id,l.value)}),h[i].addEventListener("input",s=>{let l=s.currentTarget||s.target;this.setValue(l.id,l.value)})}setColor(h,t){!t||typeof t>"u"||t.length===0?this.body.querySelector("#"+h).value="":this.body.querySelector("#"+h).value=this.colorHex(t)}colorHex(h){return h?(h=new X(h),h.ok?h.toHex():""):!1}getDefaultColor(h){return h===0?"rgb(0,0,0)":h===1?"rgb(128, 0, 0)":h===2?"rgb(0, 128, 0)":h===3?"rgb(128, 128, 0)":h===4?"rgb(0, 0, 128)":h===5?"rgb(128, 0, 128)":h===6?"rgb(0, 128, 128)":h===7?"rgb(192, 192, 192)":h===8?"rgb(128, 128, 128)":h===9?"rgb(255, 0, 0)":h===10?"rgb(0, 255, 0)":h===11?"rgb(255, 255, 0)":h===12?"rgb(0, 0, 255)":h===13?"rgb(255, 0, 255)":h===14?"rgb(0, 255, 255)":h===15?"rgb(255, 255, 255)":h===256?"rgb(0, 0, 0)":h===257?"rgb(118, 0, 0)":h===258?"rgb(0, 108, 0)":h===259?"rgb(145, 136, 0)":h===260?"rgb(0, 0, 108)":h===261?"rgb(108, 0, 108)":h===262?"rgb(0, 108, 108)":h===263?"rgb(160, 160, 160)":h===264?"rgb(0, 0, 0)":h===265?"rgb(128, 0, 0)":h===266?"rgb(0, 128, 0)":h===267?"rgb(128, 128, 0)":h===268?"rgb(0, 0, 128)":h===269?"rgb(128, 0, 128)":h===270?"rgb(0, 128, 128)":h===271?"rgb(192, 192, 192)":h===272?"rgb(0,0,0)":h===273?"rgb(0, 255, 255)":h===274?"rgb(0,0,0)":h===275?"rgb(255, 255, 0)":h===276?"rgb(0, 0, 0)":h===277?"rgb(192, 192, 192)":h===278?"rgb(128, 0, 0)":h===279?"rgb(192, 192, 192)":h===280?"rgb(255,255,255)":""}setValue(h,t){t=="false"&&(t=!1),t=="true"&&(t=!0),t=="null"&&(t=null),t=="undefined"&&(t=void 0),typeof t=="string"&&parseFloat(t).toString()==t&&(t=parseFloat(t)),this.settings[h]=this.convertType(t,typeof this.settings[h])}convertType(h,t){if(typeof h===t)return h;switch(t){case"number":return typeof h=="string"&&parseFloat(h).toString()==h?parseFloat(h):Number(h);case"boolean":return!!h;case"string":return""+h}return h}static addPlugins(h){let t=client.plugins.length,e,i;for(let n=0;n<t;n++)if(client.plugins[n].settings&&client.plugins[n].settings.length)for(i=client.plugins[n].settings.length,e=0;e<i;e++){let s=client.plugins[n].settings[e];if(typeof s.action!="string")continue;let l=`<a href="#${s.action}" class="list-group-item list-group-item-action">${s.icon||""}${s.name||""}</a>`;if("position"in s){if(typeof s.position=="string"){if(h.querySelector(s.position)){h.querySelector(s.position).insertAdjacentHTML("afterend",l);continue}}else if(s.position>=0&&s.position<h.children.length){h.children[s.position].insertAdjacentHTML("afterend",l);continue}}h.insertAdjacentHTML("beforeend",l)}}static get menuTemplate(){return'<div class="contents list-group list-group-flush" style="top:0;position: absolute;left:0;bottom:49px;right:0;"><a href="#settings-general" class="list-group-item list-group-item-action"><i class="fas fa-cogs"></i> General</a><a href="#settings-display" class="list-group-item list-group-item-action"><i class="fas fa-display"></i> Display</a><a href="#settings-colors" class="list-group-item list-group-item-action"><i class="fas fa-palette"></i> Colors</a><a href="#settings-commandLine" class="list-group-item list-group-item-action"><i class="fas fa-terminal"></i> Command line</a><a href="#settings-tabCompletion" class="list-group-item list-group-item-action"><i class="fa-solid fa-arrow-right-to-bracket"></i> Tab completion</a><a href="#settings-telnet" class="list-group-item list-group-item-action"><i class="fas fa-network-wired"></i> Telnet</a><a href="#settings-scripting" class="list-group-item list-group-item-action"><i class="fas fa-code"></i> Scripting</a><a href="#settings-specialCharacters" class="list-group-item list-group-item-action"><i class="fa-regular fa-file-code"></i> Special characters</a><a href="#settings-advanced" class="list-group-item list-group-item-action"><i class="fa-solid fa-sliders"></i> Advanced</a></div>'}};var $t=class extends ie{constructor(t){super();this.$panel1MinSize=200;this.$panel2MinSize=200;this.$splitterWidth=4;this.$splitterDistance=200;this.$dragging=!1;this.$collapsed=0;this.live=!0;t&&t.id&&(this.$id=t.id),t&&(this.$panel1=t.panel1,this.$panel2=t.panel2),t&&t.container?this.parent=t.container.container?t.container.container:t.container:t&&t.parent?this.parent=t.parent:this.parent=document.body,t?("anchor"in t?this.$anchor=t.anchor:this.$anchor=2,this.orientation=t.orientation||0):(this.$anchor=2,this.orientation=0)}hide(){this.$el.style.display="none"}show(){this.$el.style.display=""}get id(){return this.$id||this.parent.id}set id(t){t!==this.$id&&(this.$id=t,this.$el.id=this.id+"-splitter",this.$panel1.id=this.id+"-splitter-panel1",this.$panel2.id=this.id+"-splitter-panel2",this.$dragBar.id=this.id+"-splitter-drag-bar",this.$ghostBar&&(this.$ghostBar.id=this.id+"-ghost-bar"))}set parent(t){typeof t=="string"?t.startsWith("#")?this.$parent=document.getElementById(t.substr(1)):this.$parent=document.getElementById(t):t instanceof $?this.$parent=t[0]:t instanceof HTMLElement&&(this.$parent=t),this.$parent||(this.$parent=document.body),this.createControl()}get parent(){return this.$parent}get panel1(){return this.$panel1}get panel2(){return this.$panel2}get anchor(){return this.$anchor}set anchor(t){this.$anchor!==t&&(this.$anchor=2,this.updatePanels())}set SplitterDistance(t){this.$splitterDistance!==t&&(this.$splitterDistance=t,this.updatePanels(),this.emit("splitter-moved",t))}get SplitterDistance(){return this.$splitterDistance}set Panel1MinSize(t){this.$panel1MinSize!==t&&(this.$panel1MinSize=t,this.$orientation===0?this.$panel1.clientWidth<t&&(this.$splitterDistance=this.parent.clientWidth-this.$panel1MinSize):this.$panel1.clientHeight<t&&(this.$splitterDistance=this.parent.clientHeight-this.$panel1MinSize),this.updatePanels())}get Panel1MinSize(){return this.$panel1MinSize}set Panel2MinSize(t){this.$panel2MinSize!==t&&(this.$panel2MinSize=t,this.$orientation===0?this.$panel2.clientWidth<t&&(this.$splitterDistance=t):this.$panel2.clientHeight<t&&(this.$splitterDistance=t),this.updatePanels())}get Panel2MinSize(){return this.$panel2MinSize}get orientation(){return this.$orientation}set orientation(t){t!==this.$orientation&&(this.$orientation=t,this.updatePanels())}get panel1Collapsed(){return this.$collapsed===1}set panel1Collapsed(t){if(t){if(this.$collapsed===1)return;this.$collapsed=1,this.panel1.dataset.collapsed="true",this.panel2.dataset.collapsed="false",this.emit("collapsed",1),this.updatePanels()}else this.$collapsed===1&&(this.$collapsed=0,delete this.panel1.dataset.collapsed,delete this.panel2.dataset.collapsed,this.emit("collapsed",0),this.updatePanels())}get panel2Collapsed(){return this.$collapsed===2}set panel2Collapsed(t){if(t){if(this.$collapsed===2)return;this.$collapsed=2,this.panel1.dataset.collapsed="false",this.panel2.dataset.collapsed="true",this.emit("collapsed",2),this.updatePanels()}else this.$collapsed===2&&(this.$collapsed=0,delete this.panel1.dataset.collapsed,delete this.panel2.dataset.collapsed,this.emit("collapsed",0),this.updatePanels())}updatePanels(){this.$orientation===0?(this.$panel1.style.left="0",this.$panel1.style.top="0",this.$panel1.style.right="0",this.$panel2.style.left="0",this.$panel2.style.top="",this.$panel2.style.right="0",this.$panel2.style.bottom="0",this.$dragBar.style.left="0",this.$dragBar.style.right="0",this.$anchor===1?(this.$dragBar.style.bottom="",this.$dragBar.style.top=this.$splitterDistance+"px"):(this.$dragBar.style.top="",this.$dragBar.style.bottom=this.$splitterDistance-this.$splitterWidth+"px"),this.$dragBar.style.height=this.$splitterWidth+"px",this.$dragBar.style.cursor="ns-resize",this.$collapsed===1?(this.$panel1.style.display="none",this.$panel2.style.display="",this.$panel2.style.top="0",this.$panel2.style.height="",this.$dragBar.style.display="none"):this.$collapsed===2?(this.$panel1.style.display="",this.$panel1.style.bottom="0",this.$panel1.style.height="",this.$panel2.style.display="none",this.$dragBar.style.display="none"):this.$anchor===1?(this.$panel1.style.display="",this.$panel1.style.height=this.$splitterDistance-this.$splitterWidth+"px",this.$panel2.style.display="",this.$panel2.style.top=this.$splitterDistance-this.$splitterWidth+"px",this.$panel2.style.height="",this.$dragBar.style.display=""):(this.$panel1.style.display="",this.$panel1.style.bottom=this.$splitterDistance+"px",this.$panel2.style.display="",this.$panel2.style.height=this.$splitterDistance-this.$splitterWidth+"px",this.$dragBar.style.display=""),this.$el.classList.remove("vertical"),this.$el.classList.add("horizontal")):(this.$panel1.style.left="0",this.$panel1.style.top="0",this.$panel1.style.bottom="0",this.$panel1.classList.remove("horizontal"),this.$panel1.classList.add("vertical"),this.$panel2.style.left="",this.$panel2.style.top="0",this.$panel2.style.right="0",this.$panel2.style.bottom="0",this.$anchor===1?(this.$dragBar.style.right="",this.$dragBar.style.left=this.$splitterDistance-this.$splitterWidth+"px"):(this.$dragBar.style.left="",this.$dragBar.style.right=this.$splitterDistance-this.$splitterWidth+"px"),this.$dragBar.style.top="0",this.$dragBar.style.bottom="0",this.$dragBar.style.width=this.$splitterWidth+"px",this.$dragBar.style.cursor="ew-resize",this.$collapsed===1?(this.$panel1.style.display="none",this.$panel2.style.display="",this.$panel2.style.left="0",this.$panel2.style.width="",this.$dragBar.style.display="none"):this.$collapsed===2?(this.$panel1.style.display="",this.$panel1.style.right="0",this.$panel1.style.width="",this.$panel2.style.display="none",this.$dragBar.style.display="none"):this.$anchor===1?(this.$panel1.style.display="",this.$panel1.style.width=this.$splitterDistance-this.$splitterWidth+"px",this.$panel2.style.display="",this.$panel2.style.left=this.$splitterDistance-this.$splitterWidth+"px",this.$panel2.style.width="",this.$dragBar.style.display=""):(this.$panel1.style.display="",this.$panel1.style.right=this.$splitterDistance+"px",this.$panel2.style.display="",this.$panel2.style.width=this.$splitterDistance-this.$splitterWidth+"px",this.$dragBar.style.display=""),this.$el.classList.remove("horizontal"),this.$el.classList.add("vertical"))}createControl(){this.$el=document.createElement("div"),this.$el.id=this.id+"-splitter",this.$el.classList.add("splitter"),this.$panel1||(this.$panel1=document.createElement("div"),this.$panel1.id=this.id+"-splitter-panel1"),this.$panel1.classList.add("splitter-panel","splitter-panel-1"),this.$el.appendChild(this.$panel1),this.$panel2||(this.$panel2=document.createElement("div"),this.$panel2.id=this.id+"-splitter-panel2"),this.$panel2.classList.add("splitter-panel","splitter-panel-2"),this.$el.appendChild(this.$panel2),this.$dragBar=document.createElement("div"),this.$dragBar.id=this.id+"-splitter-drag-bar",this.$dragBar.classList.add("spitter-drag-bar"),this.$el.appendChild(this.$dragBar),this.$dragBar.tabIndex=1,this.$dragBar.addEventListener("mousedown",t=>{this.$dragBar.focus(),t.preventDefault(),this.$dragging=!0,this.$ghostBar=document.createElement("div"),this.$ghostBar.id=this.id+"-ghost-bar",this.$ghostBar.classList.add("splitter-ghost-bar");let e=this.$panel2.getBoundingClientRect();this.$anchor===1&&(e=this.$panel1.getBoundingClientRect()),this.$orientation===0?(this.$ghostBar.style.left="0",this.$anchor===1?this.$ghostBar.style.top=e.bottom-this.$elBounds.top+"px":this.$ghostBar.style.top=e.top-this.$elBounds.top-this.$splitterWidth+"px",this.$ghostBar.style.right="0",this.$ghostBar.style.bottom="",this.$ghostBar.style.width="",this.$ghostBar.style.height=this.$splitterWidth+"px",this.$ghostBar.style.cursor="ns-resize"):(this.$anchor===1?this.$ghostBar.style.left=e.right-this.$elBounds.left+"px":this.$ghostBar.style.left=e.left-this.$elBounds.left-this.$splitterWidth+"px",this.$ghostBar.style.top="0",this.$ghostBar.style.bottom="0",this.$ghostBar.style.right="",this.$ghostBar.style.height="",this.$ghostBar.style.width=this.$splitterWidth+"px",this.$ghostBar.style.cursor="ew-resize"),this.$ghostBar.move=i=>{let n;this.$orientation===0&&this.$anchor===1?(n=i.pageY-this.$elBounds.top,n<this.$panel1MinSize+this.$splitterWidth?this.$ghostBar.style.top=this.$panel1MinSize+"px":n>this.parent.clientHeight-this.$panel2MinSize-this.$splitterWidth?this.$ghostBar.style.top=this.parent.clientHeight-this.$panel2MinSize-this.$splitterWidth+"px":this.$ghostBar.style.top=n-2+"px",this.live&&(n<this.$panel1MinSize+this.$splitterWidth?this.SplitterDistance=this.$panel1MinSize+this.$splitterWidth:n>this.parent.clientHeight-this.$panel2MinSize-this.$splitterWidth?this.SplitterDistance=this.parent.clientHeight-this.$panel2MinSize:this.SplitterDistance=n-2+this.$splitterWidth)):this.$orientation===0?(n=i.pageY-this.$elBounds.top,n<this.$panel1MinSize?this.$ghostBar.style.top=this.$panel1MinSize+"px":n>this.parent.clientHeight-this.$panel2MinSize?this.$ghostBar.style.top=this.parent.clientHeight-this.$panel2MinSize+"px":this.$ghostBar.style.top=n-2+"px",this.live&&(n<this.$panel1MinSize?this.SplitterDistance=this.parent.clientHeight-this.$panel1MinSize:n>this.parent.clientHeight-this.$panel2MinSize?this.SplitterDistance=this.$panel2MinSize:this.SplitterDistance=this.parent.clientHeight-n+2)):this.$orientation===1&&this.$anchor===1?(n=i.pageX-this.$elBounds.left,n<this.$panel1MinSize+this.$splitterWidth?this.$ghostBar.style.left=this.$panel1MinSize+"px":n>=this.parent.clientWidth-this.$panel2MinSize-this.$splitterWidth?this.$ghostBar.style.left=this.parent.clientWidth-this.$panel2MinSize-this.$splitterWidth+"px":this.$ghostBar.style.left=n-2+"px",this.live&&(n<this.$panel1MinSize+this.$splitterWidth?this.SplitterDistance=this.$panel1MinSize+this.$splitterWidth:n>=this.parent.clientWidth-this.$panel2MinSize-this.$splitterWidth?this.SplitterDistance=this.parent.clientWidth-this.$panel2MinSize:this.SplitterDistance=n-2+this.$splitterWidth)):(n=i.pageX-this.$elBounds.left,n<this.$panel1MinSize?this.$ghostBar.style.left=this.$panel1MinSize+"px":n>this.parent.clientWidth-this.$panel2MinSize?this.$ghostBar.style.left=this.parent.clientWidth-this.$panel2MinSize+"px":this.$ghostBar.style.left=n-2+"px",this.live&&(n<this.$panel1MinSize?this.SplitterDistance=this.parent.clientWidth-this.$panel1MinSize:n>this.parent.clientWidth-this.$panel2MinSize?this.SplitterDistance=this.$panel2MinSize:this.SplitterDistance=this.parent.clientWidth-n+2)),this.emit("splitter-moving",n)},this.parent.appendChild(this.$ghostBar),document.addEventListener("mousemove",this.$ghostBar.move)}),this.$dragBar.addEventListener("dblclick",t=>{this.emit("dblclick",t)}),window.addEventListener("resize",()=>{this.resize()}),document.addEventListener("mouseup",t=>{if(!this.$dragging)return;t.preventDefault(),t.stopPropagation(),t.cancelBubble=!0;let e;this.$orientation===0?(e=t.pageY-this.$elBounds.top,this.$anchor===1?e<this.$panel1MinSize+this.$splitterWidth?this.SplitterDistance=this.$panel1MinSize+this.$splitterWidth:e>this.parent.clientHeight-this.$panel2MinSize-this.$splitterWidth?this.SplitterDistance=this.parent.clientHeight-this.$panel2MinSize:this.SplitterDistance=e-2+this.$splitterWidth:e<this.$panel1MinSize?this.SplitterDistance=this.parent.clientHeight-this.$panel1MinSize-2:e>this.parent.clientHeight-this.$panel2MinSize?this.SplitterDistance=this.$panel2MinSize:this.SplitterDistance=this.parent.clientHeight-e+2):(e=t.pageX-this.$elBounds.left,this.$anchor===1?e<this.$panel1MinSize+this.$splitterWidth?this.SplitterDistance=this.$panel1MinSize+this.$splitterWidth:e>this.parent.clientWidth-this.$panel2MinSize-this.$splitterWidth?this.SplitterDistance=this.parent.clientWidth-this.$panel2MinSize:this.SplitterDistance=e-2+this.$splitterWidth:e<this.$panel1MinSize?this.SplitterDistance=this.parent.clientWidth-this.$panel1MinSize-2:e>this.parent.clientWidth-this.$panel2MinSize?this.SplitterDistance=this.$panel2MinSize:this.SplitterDistance=this.parent.clientWidth-e+2),this.parent.removeChild(this.$ghostBar),document.removeEventListener("mousemove",this.$ghostBar.move),this.$ghostBar=null,this.$dragging=!1}),this.parent.appendChild(this.$el),setTimeout(()=>{this.$elBounds=this.$el.getBoundingClientRect()},10),this.$resizeObserver=new ResizeObserver((t,e)=>{t.length!==0&&(!t[0].contentRect||t[0].contentRect.width===0||t[0].contentRect.height===0||(!this.$resizeObserverCache||this.$resizeObserverCache.width!==t[0].contentRect.width||this.$resizeObserverCache.height!==t[0].contentRect.height)&&(this.$resizeObserverCache={width:t[0].contentRect.width,height:t[0].contentRect.height},this.resize()))}),this.$resizeObserver.observe(this.$el),this.$observer=new MutationObserver(t=>{let e;for(e of t)e.type==="attributes"&&e.attributeName==="style"&&e.oldValue==="display: none;"&&this.resize()}),this.$observer.observe(this.$el,{attributes:!0,attributeOldValue:!0,attributeFilter:["style"]})}resize(){this.$orientation===0&&this.$anchor===1?this.$panel2.clientHeight&&this.$panel2.clientHeight<this.$panel2MinSize&&this.$panel1.clientHeight>this.$panel1MinSize&&(this.SplitterDistance=this.parent.clientHeight-this.$panel2MinSize):this.$orientation===0?this.$panel1.clientHeight&&this.$panel1.clientHeight<this.$panel1MinSize&&this.$panel2.clientHeight>this.$panel2MinSize&&(this.SplitterDistance=this.$panel1MinSize):this.$orientation===1&&this.$anchor===1?this.$panel2.clientWidth&&this.$panel2.clientWidth<this.$panel2MinSize&&this.$panel1.clientWidth>this.$panel1MinSize&&(this.SplitterDistance=this.parent.clientWidth-this.$panel2MinSize):this.$panel1.clientWidth<this.$panel1MinSize&&this.$panel2.clientWidth>this.$panel2MinSize&&(this.SplitterDistance=this.$panel1MinSize),this.$elBounds=this.$el.getBoundingClientRect()}};var Nt=class extends ve{constructor(){super(Object.assign({},client.getOption("windows.profiles")||{center:!0},{title:'i class="fas fa-users"></i> Profiles',minWidth:410}));this._profilesChanged=!1;this._current={profile:null,profileName:"",item:null,parent:null,itemIdx:-1,collection:"",itemSubIdx:-1};this._canClose=!1;this._small=!1;this.on("resized",e=>{if(e.width<430){if(this._small)return;this.header.querySelector(".breadcrumb").classList.add("breadcrumb-sm"),this._small=!0}else this._small&&(this.header.querySelector(".breadcrumb").classList.remove("breadcrumb-sm"),this._small=!1);client.setOption("windows.profiles",e)}),client.on("profiles-loaded",()=>{this.profiles||(this.profiles=client.profiles.clone(),this.profiles.SortByPriority(),this._buildMenu())}),client.on("profiles-updated",()=>{}),client.on("initialized",()=>{this.profiles||(this.profiles=client.profiles.clone(),this.profiles.SortByPriority(),this._buildMenu())}),this.body.style.padding="10px",this._splitter=new $t({id:"profile",parent:this.body,orientation:1,anchor:1}),client.getOption("profiles.split")>=200&&(this._splitter.SplitterDistance=client.getOption("profiles.split")),this._splitter.on("splitter-moved",e=>{client.setOption("profiles.split",e)}),this._menu=this._splitter.panel1,this._menu.style.overflow="hidden",this._menu.style.overflowY="auto",this._contents=this._splitter.panel2,this._contents.style.overflow="auto",this._contents.style.padding="10px",this._contents.style.paddingLeft="14px",client.profiles&&(this.profiles=client.profiles.clone(),this.profiles.SortByPriority(),this._buildMenu());let t="";t+=`<button id="${this.id}-back" type="button" class="btn-sm float-start btn btn-light" title="Go back"><i class="bi bi-arrow-left"></i><span class="icon-only"> Back</span></button>`,t+='<button id="btn-profile-menu" class="btn-sm float-start btn btn-outline-secondary" type="button" aria-controls="profile-menu" title="Show menu" data-bs-toggle="dropdown" aria-expanded="false" style="margin-right: 4px;"><i class="fa-solid fa-bars"></i></button>',t+=`<ul id="${this.id}-dropdown-menu" class="dropdown-menu" style="overflow: auto;">`,t+=`<li id="${this.id}-add-profile"><a class="dropdown-item">Add profile</a></li>`,t+=`<li id="${this.id}-add-empty-profile"><a class="dropdown-item">Add empty profile</a></li>`,t+=`<li id="${this.id}-add-sep"><hr class="dropdown-divider"></li>`,t+=`<li id="${this.id}-add-alias"><a class="dropdown-item">Add alias</a></li>`,t+=`<li id="${this.id}-add-macro"><a class="dropdown-item">Add macro</a></li>`,t+=`<li id="${this.id}-add-trigger"><a class="dropdown-item">Add trigger</a></li>`,t+=`<li id="${this.id}-add-button"><a class="dropdown-item">Add button</a></li>`,t+=`<li id="${this.id}-add-sep2"><hr class="dropdown-divider"></li>`,t+=`<li id="${this.id}-add-default-buttons"><a class="dropdown-item">Add default buttons</a></li>`,t+=`<li id="${this.id}-add-default-macros"><a class="dropdown-item">Add default macros</a></li>`,t+='<li><hr class="dropdown-divider"></li>',t+=`<li id="${this.id}-export-current"><a class="dropdown-item">Export current profile</a></li>`,t+=`<li id="${this.id}-export"><a class="dropdown-item">Export profiles</a></li>`,t+=`<li id="${this.id}-import"><a class="dropdown-item">Import profiles</a></li>`,t+='<li><hr class="dropdown-divider"></li>',t+=`<li id="${this.id}-refresh"><a class="dropdown-item">Refresh</a></li>`,t+="</ul>",t+='<span id="profile-page-buttons"></span>',t+=`<button id="${this.id}-cancel" type="button" class="btn-sm float-end btn btn-light" title="Close dialog"><i class="bi bi-x-lg"></i><span class="icon-only"> Cancel</span></button>`,t+=`<button id="${this.id}-save" type="button" class="btn-sm float-end btn btn-primary" title="Save changes" disabled><i class="bi bi-save"></i><span class="icon-only"> Save</span></button>`,t+=`<button id="${this.id}-apply" type="button" class="btn-sm float-end btn btn-secondary" title="Apply changes" disabled><i class="bi bi-check-lg"></i><span class="icon-only"> Apply</span></button>`,this.footer.innerHTML=t,this.footer.classList.add("dropup"),$("#btn-profile-menu").on("shown.bs.dropdown",()=>{setTimeout(()=>{let e=this.footer.querySelector("#"+this.id+"-dropdown-menu"),i=e.getBoundingClientRect();i.y<10&&(e.style.height=i.height+i.y-10+"px"),i.bottom>document.body.clientHeight-10&&(e.style.height=document.body.clientHeight-i.y-10+"px")},0)}),$("#btn-profile-menu").on("hidden.bs.dropdown",()=>{let e=this.footer.querySelector("#"+this.id+"-dropdown-menu");e.style.height=""}),this.footer.querySelector(`#${this.id}-cancel`).addEventListener("click",()=>{de(this._page),this.close()}),this.footer.querySelector(`#${this.id}-back`).addEventListener("click",()=>{this._goBack()}),this.on("closed",()=>{client.setOption("windows.profiles",this.windowState),de(this._page)}),this.on("canceled",()=>{client.setOption("windows.profiles",this.windowState),de(this._page)}),this.on("moved",e=>{client.setOption("windows.profiles",e)}),this.on("maximized",()=>{client.setOption("windows.profiles",this.windowState)}),this.on("restored",()=>{client.setOption("windows.profiles",this.windowState)}),this.on("shown",()=>{client.setOption("windows.profiles",this.windowState)}),this.footer.querySelector(`#${this.id}-add-profile a`).addEventListener("click",()=>{this._createProfile(!0)}),this.footer.querySelector(`#${this.id}-add-empty-profile a`).addEventListener("click",()=>{this._createProfile(!1)}),this.footer.querySelector(`#${this.id}-add-alias a`).addEventListener("click",()=>{this._addItem("aliases")}),this.footer.querySelector(`#${this.id}-add-macro a`).addEventListener("click",()=>{this._addItem("macros")}),this.footer.querySelector(`#${this.id}-add-trigger a`).addEventListener("click",()=>{this._addItem("triggers")}),this.footer.querySelector(`#${this.id}-add-button a`).addEventListener("click",()=>{this._addItem("buttons")}),this.footer.querySelector(`#${this.id}-add-default-buttons a`).addEventListener("click",()=>{let e=ye.DefaultButtons,i=e.length;for(let n=0;n<i;n++)this._addItem("buttons",e[n])}),this.footer.querySelector(`#${this.id}-add-default-macros a`).addEventListener("click",()=>{let e=ye.DefaultMacros,i=e.length;for(let n=0;n<i;n++)this._addItem("macros",e[n])}),this.footer.querySelector(`#${this.id}-export-current a`).addEventListener("click",()=>{let e={version:2,profiles:{}};e.profiles[this._current.profileName]=this._current.profile.clone(2),fileSaveAs.show(JSON.stringify(e),`oiMUD.${this._current.profileName}.txt`,"text/plain")}),this.footer.querySelector(`#${this.id}-export a`).addEventListener("click",()=>{let e={version:2,profiles:this.profiles.clone(2)};fileSaveAs.show(JSON.stringify(e),"oiMUD.profiles.txt","text/plain")}),this.footer.querySelector(`#${this.id}-import a`).addEventListener("click",()=>{ue("Import profile(s)").then(e=>{pe(e[0]).then(i=>{try{var n=JSON.parse(i);if(n.version==2){if(n.profiles){for(var s=Object.keys(n.profiles),l,r,a=0,o=s.length;a<o;a++){for(l=s[a],r=0;this.profiles.contains(l);)r===0?l=s[a]+" Copy":l=s[a]+" Copy ("+r+")",r++;n.profiles[s[a]].name=l;let f=ye.load(n.profiles[s[a]]);this.profiles.add(f)}if(o===0)return;this.changed=!0,this._buildMenu(),this._expandPath(this._page)}}else setTimeout(function(){alert_box("Invalid file","Unable to import file, not a valid profile file",4)},50)}catch(f){setTimeout(function(){alert_box("Error importing","Error importing file.",3)},50),client.error(f)}}).catch(client.error)}).catch(()=>{})}),this.footer.querySelector(`#${this.id}-refresh a`).addEventListener("click",()=>{this._buildMenu(),this.setBody(this._page)}),this.footer.querySelector(`#${this.id}-save`).addEventListener("click",()=>{if(this._errorField){this._errorField.focus();return}this._save(),this.close()}),this.footer.querySelector(`#${this.id}-apply`).addEventListener("click",()=>{if(this._errorField){this._errorField.focus();return}this._save()})}set errorField(t){this._errorField=t}get errorField(){return this._errorField}get current(){return this._current}set changed(t){t!==this._profilesChanged&&(this._profilesChanged=t,this.footer.querySelector(`#${this.id}-save`).disabled=!t,this.footer.querySelector(`#${this.id}-apply`).disabled=!t)}get changed(){return this._profilesChanged}get contents(){return this._contents}_getItem(t,e,i,n,s){if(!t||t.length===0)return"";let l="";s=s||0;let r=s*20+16;return l+=`<li class="nav-item" title="${ae(ke(t[e]))}" id="${i+"-"+(t[e].useName?this.sanitizeID(t[e].name.toLowerCase()):e)}">`,t[e].items&&t[e].items.length?(l+=`<a style="padding-left: ${r}px" class="nav-link text-dark" href="#${n}/${encodeURIComponent(t[e].name.toLowerCase())}"><i class="align-middle float-start bi bi-chevron-right"></i> <input data-page="${n}/${encodeURIComponent(t[e].name.toLowerCase())}" type="checkbox" class="form-check-input" id="enabled-${i}-${this.sanitizeID(t[e].name.toLowerCase())}"${t[e].enabled?" checked":""}> ${ae(ke(t[e]))}</a>`,l+=this._getItems(t[e].items,i+"-"+this.sanitizeID(t[e].name.toLowerCase()),n+"/"+encodeURIComponent(t[e].name.toLowerCase()),s+1)):t[e].useName?l+=`<a style="padding-left: ${r}px" class="nav-link text-dark " href="#${n}/${encodeURIComponent(t[e].name.toLowerCase())}"><i class="align-middle float-start no-icon"></i> <input data-page="${n}/${encodeURIComponent(t[e].name.toLowerCase())}" type="checkbox" class="form-check-input" id="enabled-${i}-${this.sanitizeID(t[e].name.toLowerCase())}"${t[e].enabled?" checked":""}> ${ae(ke(t[e]))}</a>`:l+=`<a style="padding-left: ${r}px" class="nav-link text-dark" href="#${n}/${e}"><i class="align-middle float-start no-icon"></i><input type="checkbox" class="form-check-input" data-page="${n}/${e}" id="enabled-${i}-${e}"${t[e].enabled?" checked":""}> ${ae(ke(t[e]))}</a>`,l+="</li>",l}_getItems(t,e,i,n){if(!t||t.length===0)return"";let s="";for(let l=0,r=t.length;l<r;l++)s+=this._getItem(t,l,e,i,n);return'<ul class="dropdown-menu dropdown-inline">'+s+"</ul>"}_buildMenu(){let t="";for(let i=0,n=this.profiles.keys.length;i<n;i++)t+=this._profile(this.profiles.keys[i]);this._menu.innerHTML='<ul class="nav" id="profile-menu">'+t+"</ul>";let e=this._menu.querySelectorAll("a");for(let i=0,n=e.length;i<n;i++)this._profileEvents(e[i])}_profileEvents(t){let e=t.querySelectorAll(".bi-chevron-right"),i,n;for(i=0,n=e.length;i<n;i++)e[i].addEventListener("click",s=>{s.target.closest("li").querySelector(".dropdown-menu").classList.toggle("show"),s.target.classList.toggle("bi-chevron-right"),s.target.classList.toggle("bi-chevron-down"),s.preventDefault()});for(e=t.querySelectorAll("input"),i=0,n=e.length;i<n;i++)e[i].addEventListener("change",s=>{let l=s.target.dataset.page.split("/"),r=s.target.checked;switch(l.length){case 2:if(!r&&this.profiles.keys.filter(a=>this.profiles.enabled(a)).length===1){alert_box("Cannot disable","One profile must always be enabled."),s.target.checked=!0;return}this._menu.querySelector(`#enabled-${this.sanitizeID(l[1])}`).checked=r,this._menu.querySelector(`#enabled-${this.sanitizeID(l[1])}-switch`).checked=r,this._page===s.target.dataset.page&&(this._contents.querySelector("#enabled").checked=r),this.profiles.items[l[1]].enabled=r,this.changed=!0;break;case 3:this._menu.querySelector(`#enabled-${this.sanitizeID(l[1])}-${l[2]}`).checked=r,this._page===`profiles/${l[1]}`&&(this._contents.querySelector("#enable"+he(l[2])).checked=r),this.profiles.items[l[1]]["enable"+he(l[2])]=r,this.changed=!0;break;case 4:this._menu.querySelector(`#enabled-${this.sanitizeID(l[1])}-${l[2]}-${l[3]}`).checked=r,this._page===s.target.dataset.page?this._contents.querySelector("#enabled").checked=r:this._page===`profiles/${l[1]}/${l[2]}`&&(this._contents.querySelector("#check-"+l[3]).checked=r),this.profiles.items[l[1]][l[2]][+l[3]].enabled=r,this.changed=!0;break}s.stopPropagation(),s.cancelBubble=!0});for(e=t.querySelectorAll(".list-badge-button"),i=0,n=e.length;i<n;i++)e[i].addEventListener("click",s=>{this._deleteProfile(s.target.parentElement.dataset.profile),s.preventDefault()})}_profile(t){let e=`<li class="nav-item" data-profile="${t}" title="${he(t)}" id="${this.sanitizeID(t)}">`;return e+=`<a class="nav-link text-dark" href="#profiles/${encodeURIComponent(t)}">`,t!=="default"&&(e+=`<span class="list-badge-button badge text-bg-danger" data-profile="${t}"><i class="bi bi-trash"></i></span>`),e+='<i class="align-middle float-start bi bi-chevron-right"></i> ',e+=this._item(he(t),"enabled-"+t,this.profiles.items[t].enabled),e+="</a>",e+=this._getItems([{name:"Aliases",items:this.profiles.items[t].aliases,useName:!0,enabled:this.profiles.items[t].enableAliases},{name:"Macros",items:this.profiles.items[t].macros,useName:!0,enabled:this.profiles.items[t].enableMacros},{name:"Triggers",items:this.profiles.items[t].triggers,useName:!0,enabled:this.profiles.items[t].enableTriggers},{name:"Buttons",items:this.profiles.items[t].buttons,useName:!0,enabled:this.profiles.items[t].enableButtons}],this.sanitizeID(t),"profiles/"+encodeURIComponent(t),1),e+="</li>",e}_item(t,e,i){return`<span><input type="checkbox" data-page="profiles/${t.toLowerCase()}" class="form-check-input" id="${this.sanitizeID(e)}"${i?" checked":""}> ${t}</span><div class="form-check form-switch"><input type="checkbox" class="form-check-input" id="${e}-switch"${i?" checked":""}> ${t}</div>`}setBody(t,e){if(!this.profiles){setTimeout(()=>{this.setBody(t,e)},100);return}if(this._errorField){setTimeout(()=>this._errorField.focus(),100),window.location.hash=this._page;return}this._page=this.dialog.dataset.path,this._page==="profiles"?this.dialog.dataset.panel="left":this.dialog.dataset.panel="right";let i=this._page.split("/"),n="",s=i.length-1;if(i.length===1?n+='<li><i class="float-start fas fa-users" style="padding: 2px;margin-right: 2px;"></i></li>':n+='<li><a href="#'+i.slice(0,1).join("-")+'"><i class="float-start fas fa-users" style="padding: 2px;margin-right: 2px;"></i></a></li>',i.length<4)for(let o=0,f=i.length;o<f;o++){let p=he(i[o]);o===s?n+='<li class="breadcrumb-item active">'+p+"</li>":n+='<li class="breadcrumb-item" aria-current="page"><a href="#'+i.slice(0,o+1).join("/")+'">'+p+"</a></li>"}let l,r,a;if(this._expandPath(i),this.footer.querySelector("#profile-page-buttons").innerHTML="",this.footer.querySelector(`#${this.id}-export-current`).style.display="",this.title=`<ol class="breadcrumb${this._small?" breadcrumb-sm":""}" style="overflow: hidden;white-space: nowrap;text-overflow: ellipsis;flex-wrap: nowrap;">${n}</ol>`,this._contents.scrollTop=0,!!this._setCurrent(i))if(i.length<2?(this.footer.querySelector(`#${this.id}-export-current`).style.display="none",this.footer.querySelector(`#${this.id}-add-sep`).style.display="none",this.footer.querySelector(`#${this.id}-add-alias`).style.display="none",this.footer.querySelector(`#${this.id}-add-macro`).style.display="none",this.footer.querySelector(`#${this.id}-add-trigger`).style.display="none",this.footer.querySelector(`#${this.id}-add-button`).style.display="none",this.footer.querySelector(`#${this.id}-add-sep2`).style.display="none",this.footer.querySelector(`#${this.id}-add-default-buttons`).style.display="none",this.footer.querySelector(`#${this.id}-add-default-macros`).style.display="none",this._splitter.panel2Collapsed=!0,this.footer.querySelector(`#${this.id}-back`).style.display="none"):(this.footer.querySelector(`#${this.id}-add-sep`).style.display="",this.footer.querySelector(`#${this.id}-add-alias`).style.display="",this.footer.querySelector(`#${this.id}-add-macro`).style.display="",this.footer.querySelector(`#${this.id}-add-trigger`).style.display="",this.footer.querySelector(`#${this.id}-add-button`).style.display="",this.footer.querySelector(`#${this.id}-back`).style.display="",this.footer.querySelector(`#${this.id}-add-sep2`).style.display="",this.footer.querySelector(`#${this.id}-add-default-buttons`).style.display="",this.footer.querySelector(`#${this.id}-add-default-macros`).style.display="",this._splitter.panel2Collapsed=!1),i.length===2){if(this._contentPage!=="properties")this._loadPage("properties").then(o=>{this._contentPage="properties",this._setContents(o);let f=this._contents.querySelectorAll("input");this._contents.querySelector("#name").disabled=this._current.profileName==="default";for(let p=0,g=f.length;p<g;p++)f[p].type==="checkbox"?(f[p].checked=this._current.profile[f[p].id],f[p].addEventListener("change",c=>{let S=c.target.checked;if(c.target.id==="enabled"){if(!S&&this.profiles.keys.filter(v=>this.profiles.enabled(v)).length===1){alert_box("Cannot disable","One profile must always be enabled."),c.target.checked=!0;return}this._menu.querySelector(`#enabled-${this.sanitizeID(this._current.profileName)}`).checked=S,this._menu.querySelector(`#enabled-${this.sanitizeID(this._current.profileName)}-switch`).checked=S,this._page===c.target.dataset.page&&(this._contents.querySelector("#enabled").checked=S),this.profiles.items[this._current.profileName].enabled=S}else this._current.profile[c.target.id]=S,this._menu.querySelector(`#enabled-${this.sanitizeID(this._current.profileName)}-${c.target.id.substring(6).toLowerCase()}`).checked=S,this.changed=!0;this.changed=!0})):(f[p].value=this._current.profile[f[p].id],f[p].addEventListener("change",c=>{let S=c.currentTarget||c.target;S.id==="name"?be(()=>{let v=this._renameProfile(S.value);v===!0?(f[p].classList.remove("is-invalid"),this._errorField=null):(f[p].classList.add("is-invalid"),this._errorField=f[p],this._contents.querySelector("#name-feedback").textContent=v),this._sortProfiles()},200,"renameProfile"):(this._current.profile[S.id]=S.value,be(()=>this._sortProfiles(),200,"sortProfiles")),this.changed=!0}),f[p].addEventListener("input",c=>{let S=c.currentTarget||c.target;S.id==="name"?be(()=>{let v=this._renameProfile(S.value);v===!0?(f[p].classList.remove("is-invalid"),this._errorField=null):(f[p].classList.add("is-invalid"),this._errorField=f[p],this._contents.querySelector("#name-feedback").textContent=v),this._sortProfiles()},200,"renameProfile"):(this._current.profile[S.id]=S.value,be(()=>this._sortProfiles(),200,"sortProfiles")),this.changed=!0}))}).catch(()=>{});else{this._contents.querySelector("#name").disabled=this._current.profileName==="default";let o=this._contents.querySelectorAll("input");for(let f=0,p=o.length;f<p;f++)o[f].type==="checkbox"?o[f].checked=this._current.profile[o[f].id]:o[f].value=this._current.profile[o[f].id]}if(this._current.profileName!=="default"){let o=`<button id="${this.id}-remove" type="button" class="btn-sm btn btn-danger" title="Remove profile"><i class="bi bi-trash"></i></button>`;this.footer.querySelector("#profile-page-buttons").innerHTML=o,this.footer.querySelector(`#${this.id}-remove`).addEventListener("click",f=>{this._errorField&&(this._errorField=null),this._deleteProfile(this._current.profileName)})}}else if(i.length===3){let o="";if(this._current.item.length===0)a='<h1 id="empty" style="width: 100%;text-align:center">No '+this._current.collection+".</h1>",a+=`<button id="${this.id}-add-contents" type="button" class="btn-sm float-start btn btn-outline-secondary" title="Add ${this._getItemType()}"><i class="bi bi-plus-lg"></i> Add ${this._getItemType()}</button>`;else{for(a="",l=0,r=this._current.item.length;l<r;l++)a+=`<a data-profile ="${this._current.profileName}" id="item-${l}" data-index="${l}" href="#profiles/${encodeURIComponent(this._current.profileName)}/${this._current.collection}/${l}" class="list-group-item list-group-item-action">`,a+=`<span data-index="${l}" class="list-badge-button badge text-bg-danger"><i class="bi bi-trash"></i></span>`,a+='<div class="form-check-inline form-switch" style="margin: 0;">',a+=`<input type="checkbox" class="form-check-input" id="check-${l}" data-profile="${this._current.profileName}" data-index="${l}" data-field="enabled" data-items="${this._current.collection}"${this._current.item[l].enabled?' checked="checked"':""}>`,a+=`</div>${ae(ke(this._current.item[l]))}</a>`;o=`<button id="${this.id}-add-contents" type="button" class="btn-sm btn btn-outline-secondary" title="Add ${this._getItemType()}" style="margin-bottom: 5px;width:100%;"><i class="bi bi-plus-lg"></i> Add ${this._getItemType()}</button>`}let f=`<button id="${this.id}-add" type="button" class="btn-sm float-start btn btn-outline-secondary" title="Add ${this._getItemType()}"><i class="bi bi-plus-lg"></i></button>`;this.footer.querySelector("#profile-page-buttons").innerHTML=f,this._setContents(o+'<div class="list-group">'+a+"</div>");let p=this._contents.querySelectorAll(".list-badge-button");for(let g=0,c=p.length;g<c;g++)p[g].addEventListener("click",S=>{this._removeItem(+S.target.parentElement.dataset.index),S.stopPropagation(),S.cancelBubble=!0,S.preventDefault()});this._contentPage=null,this.footer.querySelector(`#${this.id}-add`).addEventListener("click",()=>{this._addItem()}),this._contents.querySelector(`#${this.id}-add-contents`)&&this._contents.querySelector(`#${this.id}-add-contents`).addEventListener("click",()=>{this._addItem()}),p=this._contents.querySelectorAll("input");for(let g=0,c=p.length;g<c;g++)p[g].addEventListener("change",S=>{let v=S.currentTarget||S.target,d=v.checked;this._menu.querySelector(`#enabled-${this.sanitizeID(this._current.profileName)}-${this._current.collection}-${v.dataset.index}`).checked=d,this._current.profile[this._current.collection][+v.dataset.index].enabled=d,this.changed=!0})}else if(i.length===4){let o=`<button id="${this.id}-remove" type="button" class="btn-sm btn btn-danger" title="Remove ${this._getItemType()}"><i class="bi bi-trash"></i></button>`;this.footer.querySelector("#profile-page-buttons").innerHTML=o,this.footer.querySelector(`#${this.id}-remove`).addEventListener("click",f=>{this._removeItem(this._current.itemIdx,0,!0),f.stopPropagation(),f.cancelBubble=!0,f.preventDefault()});for(let f=0,p=i.length;f<p;f++)f===s?n+='<li class="breadcrumb-item active">'+ae(ke(this._current.item))+"</li>":n+='<li class="breadcrumb-item" aria-current="page"><a href="#'+i.slice(0,f+1).join("/")+'">'+he(i[f])+"</a></li>";this.title=`<ol class="breadcrumb${this._small?" breadcrumb-sm":""}" style="overflow: hidden;white-space: nowrap;text-overflow: ellipsis;flex-wrap: nowrap;">${n}</ol>`,this._contentPage!==this._current.collection?(this._contentPage=this._current.collection,this._loadPage(this._current.collection).then(f=>{this._setContents(f),this._loadItem(!0)}).catch(()=>{})):this._loadItem()}else if(i.length===5){let o=`<button id="${this.id}-remove" type="button" class="btn-sm btn btn-danger" title="Remove ${this._getItemType()}"><i class="bi bi-trash"></i></button>`;this.footer.querySelector("#profile-page-buttons").innerHTML=o,this.footer.querySelector(`#${this.id}-remove`).addEventListener("click",p=>{this._removeItem(this._current.itemIdx,0,!0),p.stopPropagation(),p.cancelBubble=!0,p.preventDefault()});let f=i.length-1;for(let p=0,g=i.length;p<g;p++)p===f-1?n+='<li class="breadcrumb-item"><a href="#'+i.slice(0,p+1).join("/")+'">'+ae(ke(this._current.parent))+"</a></li>":p===f?n+='<li class="breadcrumb-item active">'+ae(ke(this._current.item))+"</li>":n+='<li class="breadcrumb-item" aria-current="page"><a href="#'+i.slice(0,p+1).join("/")+'">'+he(i[p])+"</a></li>";this.title=`<ol class="breadcrumb${this._small?" breadcrumb-sm":""}" style="overflow: hidden;white-space: nowrap;text-overflow: ellipsis;flex-wrap: nowrap;">${n}</ol>`,this._contentPage!==this._current.collection?(this._contentPage=this._current.collection,this._loadPage(this._current.collection).then(p=>this._setContents(p)).catch(()=>{this._loadItem(!0)})):this._loadItem()}else{let o=`<button id="btn-${this.id}-add-profile" type="button" class="btn-sm btn btn-outline-secondary" title="Add profile"><i class="bi bi-plus-lg"></i></button>`;this.footer.querySelector("#profile-page-buttons").innerHTML=o,this.footer.querySelector(`#btn-${this.id}-add-profile`).addEventListener("click",()=>{this._createProfile(!0)}),this._contentPage=null,this._setContents("")}}_setCurrent(t){if(!t)return!1;if(this._current.itemIdx=this._current.itemSubIdx=-1,this._current.parent=null,t.length>1){if(this._current.profileName=t[1],!this.profiles.contains(this._current.profileName))return this._setContents(`<h1 id="empty" style="width: 100%;text-align:center">Profile ${this._current.profileName} not found.</h1>`),this._contentPage=null,!1;this._current.profile=this.profiles.items[this._current.profileName]}if(t.length>2){if(this._current.collection=t[2],!this._current.profile[this._current.collection])return this._setContents(`<h1 id="empty" style="width: 100%;text-align:center">${he(this._current.collection)} not found in ${this._current.profileName}.</h1>`),this._contentPage=null,!1;this._current.item=this._current.profile[t[2]]}if(t.length>3){if(this._current.itemIdx=+t[3],this._current.itemIdx<0||this._current.itemIdx>=this._current.item.length){this._setContents(`<h1 id="empty" style="width: 100%;text-align:center">${he(this._getItemType())} not found.</h1>`),this._contentPage=null;return}this._current.item=this._current.profile[t[2]][this._current.itemIdx]}if(t.length>4){if(this._current.itemSubIdx=+t[4],!this._current.item.triggers){this._setContents('<h1 id="empty" style="width: 100%;text-align:center">Invalid trigger.</h1>'),this._contentPage=null;return}if(this._current.itemSubIdx<0||this._current.itemSubIdx>=this._current.item.triggers.length){this._setContents('<h1 id="empty" style="width: 100%;text-align:center">Trigger state not found.</h1>'),this._contentPage=null;return}this._current.parent=this._current.item,this._current.item=this._current.item.triggers[this._current.itemSubIdx]}return!0}_loadPage(t){return new Promise((e,i)=>{$.ajax({url:"dialogs/profiles-"+t+".htm",cache:!1,type:"GET"}).done(n=>{n=n.replace(/{profileURL}/g,encodeURIComponent(this._current.profileName)).replace(/{profile}/g,this._current.profileName),e(n)}).fail(function(){i("")})})}_setContents(t){this._contents.innerHTML=t;let e=this._contents.querySelectorAll("script"),i={client,item:this._current.item,FilterArrayByKeyValue:Fe,keyCharToCode:ai,keyCodeToChar:Ze,profile:this._current.profile,profileName:this._current.profileName,parent:this._current.parent,current:this._current,GetDisplay:ke,Trigger:we,debounce:be,updateHash:Qe,DialogButtons:mt};this.emit("content-changing");for(let n=0,s=e.length;n<s;n++)new Function("body","dialog",...Object.keys(i),"try { "+e[n].textContent+"}catch(e){client.error(e)}").apply(client,[this._contents,this,...Object.values(i),this]);this.emit("content-changed")}_loadItem(t){let e=this._contents.querySelectorAll("input,select,textarea");for(let i=0,n=e.length;i<n;i++)if(!(!(e[i].id in this._current.item)&&e[i].dataset.enum!=="true"))if(e[i].type==="checkbox"){if(e[i].dataset.enum==="true"){let s=e[i].name||e[i].id.substring(0,e[i].id.lastIndexOf("-")),l=+e[i].id.substring(e[i].id.lastIndexOf("-")+1);e[i].checked=(this._current.item[s]&l)===l}else e[i].checked=this._current.item[e[i].id];t&&e[i].addEventListener("change",s=>{let l=s.currentTarget||s.target;if(l.style.display!=="none"){if(l.dataset.enum==="true"){let r=l.name||l.id.substring(0,l.id.lastIndexOf("-")),a=this.body.querySelectorAll(`[name=${r}]`),o=0;for(let f=0,p=a.length;f<p;f++)a[f].checked&&(o|=+a[f].value);this._current.item[r]=o}else this._current.item[l.id]=l.checked||!1,l.id==="enabled"&&(this._menu.querySelector(`#enabled-${this.sanitizeID(this._current.profileName)}-${this._current.collection}-${this._current.itemIdx}`).checked=this._current.item[l.id]);this.changed=!0,this._updateItemMenu()}})}else{e[i].value=this._current.item[e[i].id],t&&(e[i].addEventListener("change",l=>{let r=l.currentTarget||l.target;r.style.display!=="none"&&(this.setValue(this._current.item,r.id,r.value),this.changed=!0,this._updateItemMenu())}),e[i].addEventListener("input",l=>{let r=l.currentTarget||l.target;r.style.display!=="none"&&(this.setValue(this._current.item,r.id,r.value),this.changed=!0,this._updateItemMenu())}));let s=this.changed;e[i].dispatchEvent(new Event("change")),this.changed=s}this.emit("item-loaded",this._current)}_updateItemMenu(t,e,i,n){e=e||this._current.profileName,i=i||this._current.collection,typeof n!="number"&&(n=this._current.itemIdx);let s=this._current.parent;t=t||this._current.item,be(()=>{let l=this.body.querySelector(`#${this.sanitizeID(e)}-${i}-${n}`);if(!l)return;let r;r=ke(s||t),l.title=r,l.firstChild.childNodes[2].textContent=" "+r;let a=this.header.querySelector("ol").children;a.length>4&&(a[4].children.length?a[4].children[0].textContent=r:a[4].textContent=r),a.length>5&&(a[5].textContent=ke(t))},200,"updateItemMenu")}_expandPath(t,e){Array.isArray(t)||(t=t.split("/"));let i,n,s,l=0;t[0]==="profiles"&&(l=1);let r=t.length-1;for(let a=l,o=t.length;a<o;a++)if(i=this.sanitizeID(t.slice(l,a+1).join("-")),n=document.getElementById(i),!!n)if(a===r)setTimeout(()=>{let f=this._menu.querySelectorAll(".active");for(let p=0,g=f.length;p<g;p++)f[p].classList.remove("active");pi(this._menu,n),n.classList.add("active"),e&&n.firstChild.click()},100);else{if(s=n.querySelector(".dropdown-menu"),!s||s.classList.contains("show"))continue;n=n.querySelector("i"),n&&(n.closest("li").querySelector(".dropdown-menu").classList.toggle("show"),n.classList.toggle("bi-chevron-right"),n.classList.toggle("bi-chevron-down"))}}_goBack(){if(this._errorField){this._errorField.focus();return}let t=this._page.split("/");t.length===5?Qe(t.slice(0,t.length-2).join("/"),this._page):Qe(t.slice(0,t.length-1).join("/"),this._page)}_createProfile(t){let e=this.profiles.length,i="NewProfile"+e;for(;this.profiles.contains(i);)e++,i="NewProfile"+e;let n=new ye(i,t);i=i.toLowerCase(),this.profiles.add(n),this.profiles.SortByPriority();let s=this._profile(i);e=this.profiles.keys.indexOf(i);let l=document.getElementById("profile-menu");(e===-1||e>=l.children.length)&&(e=l.children.length-1),e<0&&(e=0),l.children[e].insertAdjacentHTML("afterend",s),this._profileEvents(l.children[e+1]),this.changed=!0,Qe("profiles/"+i,this._page)}_deleteProfile(t){if(!t)return!1;confirm_box("Remove profile?",`Delete "${t}"?`).then(e=>{e.button===4&&(this.profiles.remove(t),this._menu.querySelector("#"+t).remove(),this._page.startsWith("profiles/"+t)&&Qe("profiles",this._page),this.changed=!0)})}_renameProfile(t,e){if(!t)return"Name can not be empty!";if(e=(e||this._current.profileName).toLowerCase(),t=t.toLowerCase(),t===e)return!0;if(this.profiles.contains(t))return"A profile named "+t+" already exists!";this.profiles.remove(e),this._current.profile.name=t,this._current.profileName=t,this.profiles.add(this._current.profile);let i=this.sanitizeID(e),n=this.sanitizeID(t),s;return s=this.body.querySelector(`#${i} a`),s.children[2].childNodes[1].textContent=" "+he(t),document.querySelector(`#${i} a`).children[3].childNodes[1].textContent=" "+he(t),s=this.body.querySelector(`#${i}`),s.id=n,s.title=t,this._replaceProfileName(this._menu.firstChild,e,t),this._replaceProfileName(this._contents,e,t),this.header.querySelector("ol").children[2].textContent=he(t),!0}_replaceProfileName(t,e,i){let n,s,l,r=this.sanitizeID(e),a=this.sanitizeID(i);for(n=t.querySelectorAll(`[id*="-${r}-"]`),s=0,l=n.length;s<l;s++)n[s].id=n[s].id.replace(`-${r}-`,`-${a}-`);for(n=t.querySelectorAll(`[id$="-${r}"]`),s=0,l=n.length;s<l;s++)n[s].id=n[s].id.replace(`-${r}`,`-${a}`);for(n=t.querySelectorAll(`[id^="${r}-"]`),s=0,l=n.length;s<l;s++)n[s].id=n[s].id.replace(`${r}-`,`${a}-`);for(n=t.querySelectorAll(`[data-profile="${r}"]`),s=0,l=n.length;s<l;s++)n[s].dataset.profile=a;let o=encodeURIComponent(e),f=encodeURIComponent(i);for(n=t.querySelectorAll(`[href*="/${o}/"]`),s=0,l=n.length;s<l;s++)n[s].href=n[s].getAttribute("href").replace(`/${o}/`,`/${f}/`);for(n=t.querySelectorAll(`[href$="/${o}"]`),s=0,l=n.length;s<l;s++)n[s].href=n[s].getAttribute("href").replace(`/${o}`,`/${f}`);for(n=t.querySelectorAll(`[href^="${o}/"]`),s=0,l=n.length;s<l;s++)n[s].href=n[s].getAttribute("href").replace(`${o}/`,`${f}/`);for(n=t.querySelectorAll(`[data-path*="/${o}/"]`),s=0,l=n.length;s<l;s++)n[s].dataset.path=n[s].dataset.path.replace(`/${o}`,`/${f}`);for(n=t.querySelectorAll(`[data-page*="/${o}/"]`),s=0,l=n.length;s<l;s++)n[s].dataset.page=n[s].dataset.page.replace(`/${o}/`,`/${f}/`);for(n=t.querySelectorAll(`[data-page$="/${o}"]`),s=0,l=n.length;s<l;s++)n[s].dataset.page=n[s].dataset.page.replace(`/${o}`,`/${f}`)}_sortProfiles(){this.profiles.SortByPriority();let t=this._menu.firstChild,e=Array.from(t.children);e.sort((i,n)=>{let s=this.profiles.items[i.dataset.profile].priority,l=this.profiles.items[n.dataset.profile].priority;return s>l?-1:s<l?1:i.dataset.profile==="default"?-1:n.dataset.profile==="default"||(s=i.dataset.profile,l=n.dataset.profile,s>l)?1:s<l?-1:0}),e.forEach(i=>t.appendChild(i))}_save(){return this.changed?this._errorField?(this._errorField.focus(),!1):(this.profiles.save().then(()=>{client.loadProfiles().then(()=>{})}),this.changed=!1,!0):!0}close(){this._canClose?super.close():this.confirmSave().then(t=>{t&&!this._save()||(this._canClose=!0,this.close())}).catch(()=>{this._canClose=!1})}reload(){this._setCurrent(this._page.split("/"))&&(this._loadItem(),this._updateItemMenu())}confirmSave(){return new Promise((t,e)=>{this._profilesChanged?confirm_box("Save changes?","Save changes to profiles?",null,14).then(i=>{i.button===4?t(!0):i.button===8?t(!1):e()}).catch(i=>{e()}):t(!0)})}sanitizeID(t){return t.toLowerCase().replace(/[^a-z0-9:.-]+/gi,"_")}_getItemType(t){if(t=t||this._current.collection,!!t)return t==="aliases"?"alias":t.substring(0,t.length-1)}_addItem(t,e){if(t||(t=this._current.collection),!t)return;var i=this._current.profile[t].length;let n;e||(t==="aliases"?e=new ze:t==="triggers"?e=new we:t==="buttons"?e=new re:t==="macros"?e=new Ve:t==="context"&&(e=new it)),this._current.profile[t].push(e);let s=this._menu.querySelector(`#${this.sanitizeID(this._current.profileName)}-${t}`);if(i===0){n=this._getItem([{name:he(t),items:this._current.profile[t],useName:!0,enabled:this._current.profile[t]}],0,this.sanitizeID(this._current.profileName),"profiles/"+encodeURIComponent(this._current.profileName),1);var l=document.createElement("div");l.innerHTML=n,s.replaceWith?s.replaceWith(l.firstChild):s.replaceChild?s.parentNode.replaceChild(l.firstChild,s):s.outerHTML=n,s=this._menu.querySelector(`#${this.sanitizeID(this._current.profileName)}-${t}`),this._profileEvents(s)}else n=this._getItem(this._current.profile[t],i,`${this.sanitizeID(this._current.profileName)}-${t}`,`profiles/${encodeURIComponent(this._current.profileName)}/${t}`,2),s=s.querySelector("ul"),s.insertAdjacentHTML("beforeend",n),s=this._menu.querySelector(`#${this.sanitizeID(this._current.profileName)}-${t}`),this._profileEvents(s.lastChild);Qe(`profiles/${encodeURIComponent(this._current.profileName)}/${t}/${i}`,this._page),this.changed=!0}_removeItem(t,e,i){e||(e=this._current.collection),e&&confirm_box("Remove profile?",`Delete ${this._getItemType()}?`).then(n=>{if(n.button===4){let s=`${this.sanitizeID(this._current.profileName)}-${e}`,l=this._current.profile[e];if(l.splice(t,1),this._menu.querySelector(`#${s}-${t}`).remove(),this._current.itemIdx===-1&&this.setBody(this._page),l.length===0)this._menu.querySelector(`#${s} i`).remove(),this._menu.querySelector(`#${s} a`).insertAdjacentHTML("afterbegin",'<i class="align-middle float-start no-icon"></i>');else{let r=this._menu.querySelector(`#${s} ul`),a=r.children.length,o=`#profiles/${encodeURIComponent(this._current.profileName)}/${e}/`;for(;t<a;t++){let f=r.children[t];f.id=`${s}-${t}`,f.firstChild.href=`${o}${t}`,f.firstChild.children[1].id=`enabled-${s}-${t}`}}this.changed=!0,i&&this._goBack()}})}setValue(t,e,i){i=="false"&&(i=!1),i=="true"&&(i=!0),i=="null"&&(i=null),i=="undefined"&&(i=void 0),typeof i=="string"&&parseFloat(i).toString()==i&&(i=parseFloat(i)),t[e]=this.convertType(i,typeof t[e])}convertType(t,e){if(typeof t===e)return t;switch(e){case"number":return typeof t=="string"&&parseFloat(t).toString()==t?parseFloat(t):Number(t);case"boolean":return!!t;case"string":return""+t}return t}};function ke(u){return u.displaytype===1?new Function("item","keyCodeToChar","MacroDisplay",u.display)(u,Ze,Ye):$.isFunction(u.display)?u.display(u):$.isFunction(u[u.display])?u[u.display](u):u[u.display]?u[u.display]:u.name}var K,V,Zt=-1,_i="",ki="",Ei="",ce;function Zi(){let u;Ke(0),Si(),["repeatnum","i"].forEach(h=>{Object.defineProperty(window,h,{get:function(){if(client)return client.repeatnum},configurable:!0})}),Object.defineProperty(window,"$selected",{get:function(){return client?client.display.selection:""},configurable:!0}),Object.defineProperty(window,"$copied",{get:function(){return""},configurable:!0}),Object.defineProperty(window,"$selword",{get:function(){return client?client.input.vStack.$selword||_i||(ce?client.display.getWordFromPosition(ce.pageX,ce.pageY):""):""},configurable:!0}),Object.defineProperty(window,"$selurl",{get:function(){if(!client)return"";let h=client.input.vStack.$selurl||ki||"";if(h)return h;if(!ce)return"";var t=ce.srcElement.parentNode;return t&&t.classList&&t.classList.contains("URLLink")?t.title:t&&t.classList&&t.classList.contains("MXPLink")&&t.dataset&&t.dataset.href&&t.dataset.href.length>0?t.dataset.href:""},configurable:!0}),Object.defineProperty(window,"$selline",{get:function(){if(!client)return"";let h=client.input.vStack.$selline||Ei||"";if(h)return h;if(!ce)return"";var t=client.display.getLineOffset(ce.pageX,ce.pageY);return t.y<0||t.y>=client.display.lines.length?"":client.display.getLineText(t.y,!0)},configurable:!0}),Object.defineProperty(window,"$selectedword",{get:function(){return client?client.input.vStack.$selectedword||_i||(ce?client.display.getWordFromPosition(ce.pageX,ce.pageY):""):""},configurable:!0}),Object.defineProperty(window,"$selectedurl",{get:function(){if(!client)return"";let h=client.input.vStack.$selectedurl||ki||"";if(h)return h;if(!ce)return"";var t=ce.srcElement.parentNode;return t&&t.classList&&t.classList.contains("URLLink")?t.title:t&&t.classList&&t.classList.contains("MXPLink")&&t.dataset&&t.dataset.href&&t.dataset.href.length>0?t.dataset.href:""},configurable:!0}),Object.defineProperty(window,"$selectedline",{get:function(){if(!client)return"";let h=client.input.vStack.$selectedline||Ei||"";if(h)return h;if(!ce)return"";var t=client.display.getLineOffset(ce.pageX,ce.pageY);return t.y<0||t.y>=client.display.lines.length?"":client.display.getLineText(t.y,!0)},configurable:!0}),Object.defineProperty(window,"$action",{get:function(){return client&&(client.input.vStack.$action||(client.input.lastTriggerExecuted?client.input.lastTriggerExecuted.value:""))||""},configurable:!0}),Object.defineProperty(window,"$trigger",{get:function(){return client&&(client.input.vStack.$trigger||client.input.lastTriggered)||""},configurable:!0}),Object.defineProperty(window,"$caption",{get:function(){return client&&client.input.vStack.$caption||""},configurable:!0}),client.input.on("history-navigate",()=>{(client.getOption("commandAutoSize")||client.getOption("commandScrollbars"))&&$e()}),client.on("options-loaded",()=>{if(client.commandInput.removeEventListener("input",$e),client.commandInput.removeEventListener("change",$e),Li(),Ii(),(client.getOption("commandAutoSize")||client.getOption("commandScrollbars"))&&$e(),V&&(V.resetState(client.getOption("windows.editor")||{center:!0}),K.simple!=client.getOption("simpleEditor"))){let h="";K.isSimple||(h=K.getFormattedText().replace(/(?:\r)/g,"")),K.simple=client.getOption("simpleEditor"),K.isSimple?(K.value=h,V.showFooter(),V.header.querySelector("#adv-editor-switch").title="Switch to advanced",setTimeout(()=>K.focus(),100)):(V.hideFooter(),V.header.querySelector("#adv-editor-switch").title="Switch to simple")}A.history&&A.history.resetState(client.getOption("windows.history")||{center:!0,width:400,height:275}),A.profiles&&A.profiles.resetState(client.getOption("windows.profiles")||{center:!0,width:400,height:275})}),client.on("set-title",h=>{window.document.title=h}),client.on("connected",()=>Ke(1)),client.on("closed",()=>Ke(0)),client.on("received-data",()=>{!client.active&&client.connected&&Ke(2)}),client.on("focus",()=>{client.connected?Ke(1):Ke(0)}),client.on("print",()=>{!client.active&&client.connected&&Ke(2)}),client.display.on("selection-done",h=>{client.getOption("AutoCopySelectedToClipboard")&&client.display.hasSelection&&(at(client.display.selection),client.display.clearSelection())}),client.on("profiles-loaded",()=>{ts()}),client.on("notify",(h,t,e)=>{if(!(!client.getOption("enableNotifications")||!("Notification"in window))){switch(e=e||{silent:!0},Object.prototype.hasOwnProperty.call(e,"silent")||(e.silent=!0),Zt){case 1:e.icon=e.icon||"images/connected.png";break;case 2:e.icon=e.icon||"images/active.png";break;default:e.icon=e.icon||"images/disconnected.png";break}if(t&&(e.body=t,e.body.length>127&&(e.body=e.body.substr(0,127)+"...")),Notification.permission==="granted"){var i=new window.Notification(h,e);i.onclick=()=>{client.emit("notify-clicked",h,t),client.raise("notify-clicked",[h,t])},i.onclose=()=>{client.emit("notify-closed",h,t),client.raise("notify-closed",[h,t])}}else Notification.permission!=="denied"&&Notification.requestPermission().then(n=>{if(n==="granted"){var s=new window.Notification(h,e);s.onclick=()=>{client.emit("notify-clicked",h,t),client.raise("notify-clicked",[h,t])},s.onclose=()=>{client.emit("notify-closed",h,t),client.raise("notify-closed",[h,t])}}})}}),document.getElementById("btn-adv-editor").addEventListener("click",h=>{if(!V){V=new ve(Object.assign({},client.getOption("windows.editor")||{center:!0},{title:'<i class="fas fa-edit"></i> Advanced editor',id:"adv-editor"})),V.on("resized",e=>{client.setOption("windows.editor",e)}),V.on("moved",e=>{client.setOption("windows.editor",e)}),V.on("maximized",()=>{client.setOption("windows.editor",V.windowState)}),V.on("restored",()=>{client.setOption("windows.editor",V.windowState)}),V.on("shown",()=>{client.setOption("windows.editor",V.windowState),K.initialize()}),V.on("closing",()=>{K.remove()}),V.on("closed",()=>{client.setOption("windows.editor",V.windowState),de("editor")}),V.on("canceling",()=>{K.remove()}),V.on("canceled",()=>{client.setOption("windows.editor",V.windowState),de("editor")}),V.on("focus",()=>K.focus());let t=document.createElement("textarea");t.classList.add("form-control","form-control-sm"),t.id="adv-editor-txt",V.body.appendChild(t),V.body.style.overflow="hidden",K||(K=new Mt(t,!client.getOption("simpleEditor"))),K.on("close",()=>{V.close()}),K.on("editor-init",()=>K.focus()),K.on("click",()=>V.focus()),V.dialog.editor=K,tinymce&&V.header.querySelector("#adv-editor-max").insertAdjacentHTML("afterend",'<button type="button" class="btn btn-light float-end" id="adv-editor-switch" title="Switch to advanced" style="padding: 0 4px;margin-top: -1px;"><i class="bi-shuffle"></i></button>'),V.footer.innerHTML=`<button id="btn-adv-editor-clear" type="button" class="btn-sm float-start btn btn-light" title="Clear editor"><i class="bi bi-journal-x"></i><span class="icon-only"> Clear</span></button>
                <button id="btn-adv-editor-append" type="button" class="btn-sm float-start btn btn-light" title="Append file..."><i class="bi bi-box-arrow-in-down"></i><span class="icon-only"> Append file...</span></button>
                <button id="btn-adv-editor-send" type="button" class="btn-sm float-end btn btn-primary" title="Send"><i class="bi bi-send-fill"></i><span class="icon-only"> Send</span></button>`,K.isSimple||(V.header.querySelector("#adv-editor-switch").title="Switch to simple"),V.header.querySelector("#adv-editor-switch").addEventListener("click",()=>{client.setOption("simpleEditor",!K.simple);let e="";K.isSimple||(e=K.getFormattedText().replace(/(?:\r)/g,"")),K.simple=!K.simple,K.isSimple?(K.value=e,V.showFooter(),V.header.querySelector("#adv-editor-switch").title="Switch to advanced",setTimeout(()=>K.focus(),100)):(V.hideFooter(),V.header.querySelector("#adv-editor-switch").title="Switch to simple")}),document.getElementById("btn-adv-editor-append").addEventListener("click",()=>{ue("Append file",!1).then(e=>{pe(e[0]).then(i=>{K.insert(i)}).catch(client.error)}).catch(()=>{})}),document.getElementById("btn-adv-editor-send").addEventListener("click",()=>{client.sendCommand(K.value()),client.getOption("editorClearOnSend")&&K.clear(),client.getOption("editorCloseOnSend")&&V.close()}),document.getElementById("btn-adv-editor-clear").addEventListener("click",()=>{K.clear(),K.focus()}),K.isSimple||V.hideFooter()}V.show(),K.isSimple&&K.focus()}),u=client.getOption("windows.editor"),u&&u.show&&document.getElementById("btn-adv-editor").click(),u=client.getOption("windows.history"),u&&u.show&&Ae("history"),u=client.getOption("windows.profiles"),u&&u.show&&Ae("profiles"),document.getElementById("btn-command-history").addEventListener("show.bs.dropdown",function(){document.body.appendChild(document.getElementById("command-history-menu"));let h="",t=document.getElementById("command-history-menu"),e=client.commandHistory;for(let n=0,s=e.length;n<s;n++)h+=`<li id="command-history-item-${n}"><a data-index="${n}" class="dropdown-item" href="javascript:void(0)">${e[n]}</a></li>`;e.length&&(h+='<li><hr class="dropdown-divider"></li>',h+='<li><a id="history-clear" class="dropdown-item" href="javascript:void(0)">Clear history</a></li>'),h+='<li><a id="history-show" class="dropdown-item" href="javascript:void(0)">Show history window...</a></li>',t.innerHTML=h,e.length&&t.querySelector("#history-clear").addEventListener("click",()=>{confirm_box("Clear history?","Clear all history").then(n=>{n.button===4&&client.clearCommandHistory()})}),t.querySelector("#history-show").addEventListener("click",()=>Ae("history"));let i=document.querySelectorAll('[id^="command-history-item"] a');for(let n=0,s=i.length;n<s;n++)i[n].addEventListener("click",l=>{var r=client.commandHistory[parseInt(l.currentTarget.dataset.index,10)];client.AddCommandToHistory(r),client.sendCommand(r,null,client.getOption("allowCommentsFromCommand"))})}),document.getElementById("btn-command-history").addEventListener("hidden.bs.dropdown",function(){document.getElementById("btn-command-history").parentElement.appendChild(document.getElementById("command-history-menu"))}),client.commandInput.removeEventListener("input",$e),client.commandInput.removeEventListener("change",$e),Li(),Ii(),(client.getOption("commandAutoSize")||client.getOption("commandScrollbars"))&&$e(),window.addEventListener("keydown",h=>{h.which===33?client.display.pageUp():h.which===34&&client.display.pageDown()}),window.addEventListener("error",h=>{let{message:t,filename:e,lineno:i,colno:n,error:s}=h;return client?(s?client.error(s):t.startsWith("Uncaught Error: ")?client.error(`${t.substr(16)}`):client.error(`${t}`),client.getOption("enableDebug")&&(client.error("Url: "+e),client.error("Line: "+i),client.error("Column: "+n),client.error(s))):(console.error("Message: "+t),console.error("Url: "+e),console.error("Line: "+i),console.error("Column: "+n),console.error(s)),!0}),window.addEventListener("mousemove",h=>{ce=h}),window.addEventListener("hashchange",Ci,!1),window.addEventListener("load",Ci),client.on("command-history-changed",h=>{Jt()}),Pi()}function de(u){if(!(!u||u.length===0)){u=u.trim(),u.startsWith("#")&&(u=u.substring(1));var h=decodeURI(window.location.hash.substring(1)).split(",").filter(t=>t.trim()!==u);window.location.hash=h.join(",")}}function Nr(u){if(!(!u||u.length===0)){u=u.trim(),u.startsWith("#")&&(u=u.substring(1));var h=decodeURI(window.location.hash.substring(1)).split(",").filter(t=>t.trim()!==u);h.push(u),window.location.hash=h.join(",")}}function Qe(u,h){Array.isArray(u)||(u=[u]),h=h||[],Array.isArray(h)||(h=[h]),h=h.concat(...u);var t=decodeURI(window.location.hash.substring(1)).split(",").filter(e=>!h.includes(e.trim()));t=t.concat(...u),window.location.hash=t.join(",")}function Ci(){if(!(!window.location.hash||window.location.hash.length<2)){var u=decodeURI(window.location.hash.substring(1)).split(",").map(h=>h.trim());for(let h=u.length-1;h>=0;h--)switch(u[h]){case"about":Ae("about");break;case"editor":document.getElementById("btn-adv-editor").click();break;default:(u[h]==="history"||u[h].startsWith("settings")||u[h].startsWith("profiles"))&&Ae(u[h]);break}}}var A={};function Ae(u){switch(u){case"about":return A.about||(A.about=new ve({title:'<i class="bi-info-circle"></i> About',noFooter:!0,resizable:!1,center:!0,maximizable:!1}),A.about.on("closed",()=>{delete A.about,de(u)}),A.about.on("canceled",()=>{delete A.about,de(u)})),Ti(A.about,u,1,!0).catch(h=>{client.error(h)}),A.about;case"history":if(!A.history){A.history=new ve(Object.assign({},client.getOption("windows.history")||{center:!0,width:400,height:275},{title:'<i class="bi bi-clock-history"></i> Command history',id:"command-history"})),A.history.on("closed",()=>{client.setOption("windows.history",A.history.windowState),delete A.history,de(u)}),A.history.on("canceled",()=>{client.setOption("windows.history",A.history.windowState),de("history"),delete A.history,de(u)}),A.history.on("resized",t=>{client.setOption("windows.history",t)}),A.history.on("moved",t=>{client.setOption("windows.history",t)}),A.history.on("maximized",()=>{client.setOption("windows.history",A.history.windowState)}),A.history.on("restored",()=>{client.setOption("windows.history",A.history.windowState)}),A.history.on("shown",()=>{client.setOption("windows.history",A.history.windowState)});let h="";h+=`<button id="${A.history.id}-clear" type="button" class="btn-sm float-end btn btn-danger" title="Clear history"><i class="bi bi-trash"></i><span class="icon-only"> Clear</span></button>`,h+=`<button id="${A.history.id}-send" type="button" class="btn-sm float-end btn btn-primary" title="Send"><i class="bi bi-send-fill"></i><span class="icon-only"> Send</span></button>`,h+=`<button id="${A.history.id}-refresh" type="button" class="btn-sm float-start btn btn-light" title="Refresh"><i class="bi bi-arrow-repeat"></i><span class="icon-only"> Refresh</span></button>`,A.history.footer.innerHTML=h,A.history.body.innerHTML='<select id="history-list" multiple="multiple" class="form-control"></select>',A.history.body.querySelector("#history-list").addEventListener("dblclick",t=>{let e=t.currentTarget.value;client.AddCommandToHistory(e),client.sendCommand(e,!1,client.getOption("allowCommentsFromCommand")),A.history.close()}),A.history.body.querySelector("#history-list").addEventListener("change",t=>{client.setHistoryIndex(t.currentTarget.selectedIndex),A.history.footer.querySelector(`#${A.history.id}-send`).style.display=history.length&&A.history.body.querySelector("#history-list").selectedIndex!==-1?"":"none"}),A.history.footer.querySelector(`#${A.history.id}-refresh`).addEventListener("click",()=>Jt()),A.history.footer.querySelector(`#${A.history.id}-send`).addEventListener("click",()=>{let t=A.history.body.querySelector("#history-list"),e=[];for(let i=0,n=t.options.length;i<n;i++)t.options[i].selected&&e.push(t.options[i].value);for(let i=0,n=e.length;i<n;i++)client.AddCommandToHistory(e[i]),client.sendCommand(e[i],!1,client.getOption("allowCommentsFromCommand"))}),A.history.footer.querySelector(`#${A.history.id}-clear`).addEventListener("click",()=>{confirm_box("Clear history?","Clear all history").then(t=>{t.button===4&&client.clearCommandHistory()})})}return Jt(),A.history.show(),A.history}if(u.startsWith("settings"))return A.settings||(A.settings=new At,A.settings.on("closed",()=>{delete A.settings}),A.settings.on("canceled",()=>{delete A.settings})),u==="settings"?(A.settings.dialog.dataset.path=u,A.settings.dialog.dataset.fullPath=u,A.settings.dialog.dataset.hash=window.location.hash,A.settings.setBody("",{client}),A.settings.showModal()):Ti(A.settings,u,2,!1).catch(h=>{client.error(h)}),A.settings;if(u.startsWith("profiles"))return A.profiles||(A.profiles=new Nt,A.profiles.on("closed",()=>{delete A.profiles}),A.profiles.on("canceled",()=>{delete A.profiles})),A.profiles.dialog.dataset.path=u,A.profiles.dialog.dataset.fullPath=u,A.profiles.dialog.dataset.hash=window.location.hash,A.profiles.setBody("",{client}),A.profiles.show(),A.profiles}function Ti(u,h,t,e){return new Promise((i,n)=>{var s=h.split("/");$.ajax({url:"dialogs/"+s[0]+".htm",cache:!1,type:"GET"}).done(function(l){u.dialog.dataset.path=s[0],u.dialog.dataset.fullPath=h,u.dialog.dataset.hash=window.location.hash,u.setBody(l,{client}),t==1?u.show():t===2&&u.showModal(),i(l)}).fail(function(l){e&&client.enableDebug?u.setBody(`<h1 style="width: 100%;text-align:center">Error loading ${h}</h1> ${l.statusText}`):e?u.setBody(`<h1 style="width: 100%;text-align:center">Error loading ${h}</h1>`):u.setBody(""),n(h+": "+s.statusText)})})}function Jt(){if(!A.history)return;let u=document.getElementById("history-list");u.innerHTML="";let h=client.commandHistory;for(var t=document.createDocumentFragment(),e=0,i=h.length;e<i;e++){var n=document.createElement("option");n.appendChild(document.createTextNode(h[e])),n.value=h[e],t.append(n)}u.appendChild(t),A.history.footer.querySelector(`#${A.history.id}-clear`).style.display=h.length?"":"none",A.history.footer.querySelector(`#${A.history.id}-send`).style.display=h.length&&u.selectedIndex!==-1?"":"none"}function $e(){be(()=>{Ji()},250,"resizeCommand")}async function Li(){(client.getOption("commandAutoSize")||client.getOption("commandScrollbars"))&&(client.commandInput.addEventListener("input",$e),client.commandInput.addEventListener("change",$e)),client.getOption("commandWordWrap")?(document.getElementById("commandMeasure").style.whiteSpace="pre-wrap",document.getElementById("commandMeasure").style.overflowWrap="anywhere"):(document.getElementById("commandMeasure").style.whiteSpace="",document.getElementById("commandMeasure").style.overflowWrap=""),client.getOption("commandScrollbars")?(document.getElementById("commandMeasure").style.overflow="auto",client.commandInput.style.overflow="auto"):(document.getElementById("commandMeasure").style.overflow="",client.commandInput.style.overflow="")}var ot={};function Ii(){let u=document.getElementById("commandMeasure");document.body.appendChild(u);let h=client.commandInput.parentElement,t=window.getComputedStyle(h);u.style.fontSize=client.commandInput.style.fontSize,u.style.fontFamily=client.commandInput.style.fontFamily,u.style.width=client.commandInput.offsetWidth+"px";let e=u.innerHTML;u.innerHTML="W";let i=client.getOption("commandMinLines"),n=u.offsetHeight;i=n*(i<1?1:i);let s=parseFloat(t.borderTopWidth)||0;s+=parseFloat(t.borderBottomWidth)||0,s+=parseFloat(t.paddingTop)||0,s+=parseFloat(t.paddingBottom)||0;let l=t.inset.split(" ");s+=(parseFloat(l[0])||0)*2,u.innerHTML=e,h.style.height=n+s+"px",client.commandInput.parentElement.style.height=n+"px",client.commandInput.closest("nav").style.height=n+6+"px",client.display.container.style.bottom=n+s+"px",ot={measure:u,cmd:h,cmdSize:t,height:n,padding:s,minHeight:i}}function Ji(){let u=ot.measure,h=ot.cmd;u.innerHTML=client.commandInput.value+`
`;let t=u.offsetHeight;t<ot.minHeight&&(t=ot.minHeight);let e=ot.padding;h.style.height=t+e+"px",client.commandInput.parentElement.style.height=t+"px",client.commandInput.closest("nav").style.height=t+6+"px",client.display.container.style.bottom=t+e+"px"}function Ke(u){if(Zt===u)return;Zt=u;let h="disconnected";switch(u){case 1:h="connected";break;case 2:h="active";break}document.getElementById("icon1").remove(),document.getElementById("icon2").remove(),document.getElementById("icon3").remove(),document.querySelector("head").insertAdjacentHTML("afterbegin",`<link id="icon1" rel="shortcut icon" href="images/${h}.ico" />
        <link id="icon2" rel="icon" href="images/${h}.ico" />
        <link id="icon3" rel="icon" type="image/x-icon" href="images/${h}.png" />`)}function xi(){client.setOption("showButtons",!client.getOption("showButtons")),Pi()}function es(u,h){var t="",e="",i=u.caption,n=0;if(i.substring(0,3)==="fa-"?(i=i.split(","),i.length>1?i='<i class="fas '+i[0]+' fa-fw" data-fa-transform="'+i[1]+'"></i>':i='<i class="fas '+i[0]+' fa-fw"></i>',n=26):i.substring(0,4)==="fas-"?(i=i.split(","),i.length>1?i='<i class="fas fa-'+i[0].substring(4)+' fa-fw" data-fa-transform="'+i[1]+'"></i>':i='<i class="fas fa-'+i[0].substring(4)+' fa-fw"></i>',n=26):i.substring(0,4)==="far-"?(i=i.split(","),i.length>1?i='<i class="far fa-'+i[0].substring(4)+' fa-fw" data-fa-transform="'+i[1]+'"></i>':i='<i class="far fa-'+i[0].substring(4)+' fa-fw"></i>',n=26):i.substring(0,4)==="fab-"?(i=i.split(","),i.length>1?i='<i class="fab fa-'+i[0].substring(4)+' fa-fw" data-fa-transform="'+i[1]+'"></i>':i='<i class="fab fa-'+i[0].substring(4)+' fa-fw"></i>',n=26):i.substring(0,7)==="http://"||i.substring(0,7)==="https://"?i='<img src="'+i+'" style="max-width: '+u.width+"px;max-height:"+u.height+'px"/>':(u.iconOnly||(i=u.caption),e=u.caption),u.icon&&u.icon.length){var s=u.icon;s.substring(0,3)==="fa-"?(s=s.split(","),s.length>1?s='<i class="fas '+s[0]+' fa-fw" data-fa-transform="'+s[1]+'"></i>':s='<i class="fas '+s[0]+' fa-fw"></i>',n=26):s.substring(0,4)==="fas-"?(s=s.split(","),s.length>1?s='<i class="fas fa-'+s[0].substring(4)+' fa-fw" data-fa-transform="'+s[1]+'"></i>':s='<i class="fas fa-'+s[0].substring(4)+' fa-fw"></i>',n=26):s.substring(0,4)==="far-"?(s=s.split(","),s.length>1?s='<i class="far fa-'+s[0].substring(4)+' fa-fw" data-fa-transform="'+s[1]+'"></i>':s='<i class="far fa-'+s[0].substring(4)+' fa-fw"></i>',n=26):s.substring(0,4)==="fab-"?(s=s.split(","),s.length>1?s='<i class="fab fa-'+s[0].substring(4)+' fa-fw" data-fa-transform="'+s[1]+'"></i>':s='<i class="fab fa-'+s[0].substring(4)+' fa-fw"></i>',n=26):u.icon.length&&(s='<img src="'+s+'" style="max-width: '+u.width+"px;max-height:"+u.height+'px"/>'),u.iconOnly?i=s:i=s+i}return t+="<button",t+=' data-index="'+h+'"',u.name&&u.name.length!==0&&(t+=' id="button-'+u.name+'"'),t+=' class="user-button" style="',u.left===-1&&u.right===-1&&u.top===-1&&u.bottom===-1?t+="position: static;margin-right:2px;margin-top:2px;":(u.left>=0&&(t+="left:"+(u.left||0)+"px;"),u.top>=0&&(t+="top:"+(u.top||0)+"px;"),u.bottom>=0&&(t+="bottom:"+(u.bottom||0)+"px;"),u.right>=0&&(t+="right:"+(u.right||0)+"px;"),u.right===-1&&u.left===-1&&(t+="right:0px;"),u.bottom===-1&&u.top===-1&&(t+="top:0px;")),u.width?t+="width: "+u.width+"px;":n===26&&(t+="min-width: 26px;"),u.height&&(t+="height: "+u.height+"px;"),t+='" title="'+e+'" draggable="true" data-index="'+h+'">'+i+"</button>",t}function Pi(){client.getOption("showButtons")?document.getElementById("buttons").style.visibility="visible":document.getElementById("buttons").style.visibility=""}function ts(){var u="",h=client.buttons,t,e;for(t=0,e=h.length;t<e;t++)h[t].enabled&&(u+=es(h[t],t));document.getElementById("buttons").innerHTML=u;let i=document.querySelectorAll("#buttons button");for(let n=0,s=i.length;n<s;n++)i[n].addEventListener("click",l=>{is(l.currentTarget,+l.currentTarget.dataset.index)}),ss(i[n])}function is(u,h){if(h<0)return!1;if(u.dataset.moving==="true"){delete u.dataset.moving;return}var t=client.buttons;if(h>=t.length)return!1;var e=t[h];if(!e.enabled)return!1;var i;switch(e.style){case 1:i=client.parseOutgoing(e.value);break;case 2:var n=new Function("try { "+e.value+"} catch (e) { if(this.options.showScriptErrors) this.error(e);}");i=n.apply(client);break;default:i=e.value;break}if(i===null||typeof i>"u")return!0;if(e.send){if(i.endsWith(`
`)||(i+=`
`),e.chain&&client.commandInput.value.endsWith(" "))return client.commandInput.value+=i,client.sendCommand(),!0;client.connected&&client.send(i),client.telnet.echo&&client.getOption("commandEcho")&&client.echo(i)}else e.append&&(client.commandInput.value+=i);return!0}function ss(u){var h=0,t=0,e;document.getElementById(u.id+"header")?document.getElementById(u.id+"header").onmousedown=i:(u.onmousedown=i,u.ontouchstart=l,u.onmouseleave=n);function i(o){if(o=o||window.event,o.buttons===1){o.preventDefault();var f=u.getBoundingClientRect();h=o.pageX-f.left,t=o.pageY-f.top,document.onmouseup=a,e=setTimeout(function(){document.onmousemove=s,e=null},500)}}function n(){e&&a()}function s(o){o=o||window.event,o.preventDefault(),u.style.position="absolute",u.style.top=o.pageY-t+"px",u.style.left=o.pageX-document.body.clientWidth-h+"px",u.dataset.moving="true"}function l(o){if(o=o||window.event,!!o.touches.length){var f=u.getBoundingClientRect();h=o.touches[0].pageX-f.left,t=o.touches[0].pageY-f.top,document.ontouchend=a,e=setTimeout(function(){document.ontouchmove=r,e=null},500)}}function r(o){o=o||window.event,o.preventDefault(),u.style.position="absolute",o.touches.length&&(u.style.top=o.touches[0].pageY-t+"px",u.style.left=o.touches[0].pageX-document.body.clientWidth-h+"px",u.dataset.moving="true")}function a(){var o=u.getBoundingClientRect(),f=parseInt(u.dataset.index,10);if(!(f<0)){var p=client.buttons;if(!(f>=p.length)){var g=p[f];g.enabled&&(g.left===-1&&g.right===-1&&g.top===-1&&g.bottom===-1?(g.top=o.top||-1,g.right=document.body.clientWidth-o.right||-1):(g.left>=0&&(g.left=document.body.clientWidth-o.left||-1),g.top>=0&&(g.top=o.top||-1),g.bottom>=0&&(g.bottom=o.bottom||-1),g.right>=0&&(g.right=document.body.clientWidth-o.right||-1),g.right===-1&&g.left===-1&&(g.right=document.body.clientWidth-o.right||-1),g.bottom===-1&&g.top===-1&&(g.top=o.top||-1)),document.onmouseup=null,document.onmousemove=null,document.ontouchend=null,document.ontouchmove=null,clearTimeout(e),client.saveProfiles())}}}}window.initializeInterface=Zi;})();
/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */
/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * @link   http://www.phpied.com/rgb-color-parser-in-javascript/
 * @license Use it if you like it
 */
//# sourceMappingURL=oiMUD.min.js.map
