(()=>{var $s=Object.create;var ss=Object.defineProperty;var Fs=Object.getOwnPropertyDescriptor;var Us=Object.getOwnPropertyNames;var Zs=Object.getPrototypeOf,Ys=Object.prototype.hasOwnProperty;var $t=(f=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(f,{get:(p,t)=>(typeof require<"u"?require:p)[t]}):f)(function(f){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+f+'" is not supported')});var Ti=(f,p)=>()=>(p||f((p={exports:{}}).exports,p),p.exports);var js=(f,p,t,e)=>{if(p&&typeof p=="object"||typeof p=="function")for(let s of Us(p))!Ys.call(f,s)&&s!==t&&ss(f,s,{get:()=>p[s],enumerable:!(e=Fs(p,s))||e.enumerable});return f};var Mi=(f,p,t)=>(t=f!=null?$s(Zs(f)):{},js(p||!f||!f.__esModule?ss(t,"default",{value:f,enumerable:!0}):t,f));var ds=Ti(us=>{(function(){"use strict";var f=void 0,p=!0,t=this;function e(N,G){var K=N.split("."),Y=t;!(K[0]in Y)&&Y.execScript&&Y.execScript("var "+K[0]);for(var P;K.length&&(P=K.shift());)!K.length&&G!==f?Y[P]=G:Y=Y[P]?Y[P]:Y[P]={}}var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u"&&typeof DataView<"u";function n(N){var G=N.length,K=0,Y=Number.POSITIVE_INFINITY,P,Z,H,oe,T,fe,X,U,J,le;for(U=0;U<G;++U)N[U]>K&&(K=N[U]),N[U]<Y&&(Y=N[U]);for(P=1<<K,Z=new(s?Uint32Array:Array)(P),H=1,oe=0,T=2;H<=K;){for(U=0;U<G;++U)if(N[U]===H){for(fe=0,X=oe,J=0;J<H;++J)fe=fe<<1|X&1,X>>=1;for(le=H<<16|U,J=fe;J<P;J+=T)Z[J]=le;++oe}++H,oe<<=1,T<<=1}return[Z,K,Y]}function r(N,G,K){this.u=[],this.i=K||32768,this.v=0,this.a=G===f?0:G,this.d=this.e=0,this.input=s?new Uint8Array(N):N,this.b=new(s?Uint8Array:Array)(this.i),this.c=0,this.t=this.l=!1,this.f=0,this.status=o}var o=0;r.prototype.j=function(N,G){var K=!1;for(N!==f&&(this.input=N),G!==f&&(this.a=G);!K;)switch(this.status){case o:case 1:var Y,P=f;if(this.status=1,q(this),0>(P=S(this,3)))Q(this),Y=-1;else{switch(P&1&&(this.l=p),P>>>=1,P){case 0:this.h=0;break;case 1:this.h=1;break;case 2:this.h=2;break;default:throw Error("unknown BTYPE: "+P)}this.status=2,Y=f}0>Y&&(K=p);break;case 2:case 3:switch(this.h){case 0:var Z,H=f,oe=f,T=this.input,fe=this.a;if(this.status=3,fe+4>=T.length)Z=-1;else{if(H=T[fe++]|T[fe++]<<8,oe=T[fe++]|T[fe++]<<8,H===~oe)throw Error("invalid uncompressed block header: length verify");this.d=this.e=0,this.a=fe,this.m=H,this.status=4,Z=f}0>Z&&(K=p);break;case 1:this.status=3,this.k=v,this.n=D,this.status=4;break;case 2:var X;e:{var U=f,J=f,le=f,Oe=new(s?Uint8Array:Array)(h.length),Ue=f;if(this.status=3,q(this),U=S(this,5)+257,J=S(this,5)+1,le=S(this,4)+4,0>U||0>J||0>le)Q(this),X=-1;else{try{for(var ze=f,We=f,gt=0,Je=f,pe=f,Qe=f,es=f,Qe=0;Qe<le;++Qe){if(0>(ze=S(this,3)))throw Error("not enough input");Oe[h[Qe]]=ze}for(Ue=n(Oe),pe=new(s?Uint8Array:Array)(U+J),Qe=0,es=U+J;Qe<es;){if(We=M(this,Ue),0>We)throw Error("not enough input");switch(We){case 16:if(0>(ze=S(this,2)))throw Error("not enough input");for(Je=3+ze;Je--;)pe[Qe++]=gt;break;case 17:if(0>(ze=S(this,3)))throw Error("not enough input");for(Je=3+ze;Je--;)pe[Qe++]=0;gt=0;break;case 18:if(0>(ze=S(this,7)))throw Error("not enough input");for(Je=11+ze;Je--;)pe[Qe++]=0;gt=0;break;default:gt=pe[Qe++]=We}}new(s?Uint8Array:Array)(U),new(s?Uint8Array:Array)(J),this.k=n(s?pe.subarray(0,U):pe.slice(0,U)),this.n=n(s?pe.subarray(U):pe.slice(U))}catch{Q(this),X=-1;break e}this.status=4,X=0}}0>X&&(K=p)}break;case 4:case 5:switch(this.h){case 0:var Li;e:{var ts=this.input,Qt=this.a,Ci=this.b,_t=this.c,Ii=this.m;for(this.status=5;Ii--;){if(_t===Ci.length&&(Ci=ne(this,{o:2})),Qt>=ts.length){this.a=Qt,this.c=_t,this.m=Ii+1,Li=-1;break e}Ci[_t++]=ts[Qt++]}0>Ii&&(this.status=6),this.a=Qt,this.c=_t,Li=0}0>Li&&(K=p);break;case 1:case 2:0>W(this)&&(K=p)}break;case 6:this.l?K=p:this.status=o}var A,rt=this.c,is;return A=this.t?s?new Uint8Array(this.b.subarray(this.f,rt)):this.b.slice(this.f,rt):s?this.b.subarray(this.f,rt):this.b.slice(this.f,rt),this.f=rt,rt>32768+this.i&&(this.c=this.f=32768,s?(is=this.b,this.b=new Uint8Array(this.i+32768),this.b.set(is.subarray(rt-32768,rt))):this.b=this.b.slice(rt-32768)),A};var a=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],h=s?new Uint16Array(a):a,c=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],g=s?new Uint16Array(c):c,m=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],b=s?new Uint8Array(m):m,u=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],E=s?new Uint16Array(u):u,w=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],L=s?new Uint8Array(w):w,k=new(s?Uint8Array:Array)(288),R,B;for(R=0,B=k.length;R<B;++R)k[R]=143>=R?8:255>=R?9:279>=R?7:8;var v=n(k),O=new(s?Uint8Array:Array)(30),C,I;for(C=0,I=O.length;C<I;++C)O[C]=5;var D=n(O);function S(N,G){for(var K=N.e,Y=N.d,P=N.input,Z=N.a,H;Y<G;){if(P.length<=Z)return-1;H=P[Z++],K|=H<<Y,Y+=8}return H=K&(1<<G)-1,N.e=K>>>G,N.d=Y-G,N.a=Z,H}function M(N,G){for(var K=N.e,Y=N.d,P=N.input,Z=N.a,H=G[0],oe=G[1],T,fe,X;Y<oe;){if(P.length<=Z)return-1;T=P[Z++],K|=T<<Y,Y+=8}if(fe=H[K&(1<<oe)-1],X=fe>>>16,X>Y)throw Error("invalid code length: "+X);return N.e=K>>X,N.d=Y-X,N.a=Z,fe&65535}function q(N){N.s=N.a,N.r=N.d,N.q=N.e}function Q(N){N.a=N.s,N.d=N.r,N.e=N.q}function W(N){var G=N.b,K=N.c,Y,P,Z,H,oe=N.k,T=N.n,fe=G.length,X;for(N.status=5;;){if(q(N),Y=M(N,oe),0>Y)return N.c=K,Q(N),-1;if(Y===256)break;if(256>Y)K===fe&&(G=ne(N),fe=G.length),G[K++]=Y;else{if(P=Y-257,H=g[P],0<b[P]){if(X=S(N,b[P]),0>X)return N.c=K,Q(N),-1;H+=X}if(Y=M(N,T),0>Y)return N.c=K,Q(N),-1;if(Z=E[Y],0<L[Y]){if(X=S(N,L[Y]),0>X)return N.c=K,Q(N),-1;Z+=X}for(K+H>=fe&&(G=ne(N),fe=G.length);H--;)G[K]=G[K++-Z];if(N.a===N.input.length)return N.c=K,-1}}for(;8<=N.d;)N.d-=8,N.a--;N.c=K,N.status=6}function ne(N,G){var K,Y=N.input.length/N.a+1|0,P,Z,H,oe=N.input,T=N.b;return G&&(typeof G.o=="number"&&(Y=G.o),typeof G.p=="number"&&(Y+=G.p)),2>Y?(P=(oe.length-N.a)/N.k[2],H=258*(P/2)|0,Z=H<T.length?T.length+H:T.length<<1):Z=T.length*Y,s?(K=new Uint8Array(Z),K.set(T)):K=T,N.b=K,N.b}function V(N){this.input=N===f?new(s?Uint8Array:Array):N,this.a=0,this.g=new r(this.input,this.a),this.b=this.g.b}V.prototype.j=function(N){var G;if(N!==f)if(s){var K=new Uint8Array(this.input.length+N.length);K.set(this.input,0),K.set(N,this.input.length),this.input=K}else this.input=this.input.concat(N);var Y;if(Y=this.method===f){var P,Z=this.a,H=this.input,oe=H[Z++],T=H[Z++];if(oe===f||T===f)P=-1;else{switch(oe&15){case 8:this.method=8;break;default:throw Error("unsupported compression method")}if(((oe<<8)+T)%31!==0)throw Error("invalid fcheck flag:"+((oe<<8)+T)%31);if(T&32)throw Error("fdict flag is not supported");this.a=Z,P=f}Y=0>P}return Y?new(s?Uint8Array:Array):(G=this.g.j(this.input,this.a),this.g.a!==0&&(this.input=s?this.input.subarray(this.g.a):this.input.slice(this.g.a),this.a=0),G)},e("Zlib.InflateStream",V),e("Zlib.InflateStream.prototype.decompress",V.prototype.j)}).call(us)});var ys=Ti((bs,pi)=>{(function(f,p){"use strict";typeof pi<"u"&&pi.exports?pi.exports=p():typeof define=="function"&&define.amd?define([],p):f.buzz=p()})(bs,function(){"use strict";var f=window.AudioContext||window.webkitAudioContext,p={defaults:{autoplay:!1,duration:5e3,formats:[],loop:!1,placeholder:"--",preload:"metadata",volume:80,webAudioApi:!1,document:window.document},types:{mp3:"audio/mpeg",ogg:"audio/ogg",wav:"audio/wav",aac:"audio/aac",m4a:"audio/x-m4a"},sounds:[],el:document.createElement("audio"),getAudioContext:function(){if(this.audioCtx===void 0)try{this.audioCtx=f?new f:null}catch{this.audioCtx=null}return this.audioCtx},sound:function(t,e){e=e||{};var s=e.document||p.defaults.document,n=0,r=[],o={},a=p.isSupported();this.load=function(){return a?(this.sound.load(),this):this},this.play=function(){return a?(this.sound.play(),this):this},this.togglePlay=function(){return a?(this.sound.paused?this.sound.play():this.sound.pause(),this):this},this.pause=function(){return a?(this.sound.pause(),this):this},this.isPaused=function(){return a?this.sound.paused:null},this.stop=function(){return a?(this.setTime(0),this.sound.pause(),this):this},this.isEnded=function(){return a?this.sound.ended:null},this.loop=function(){return a?(this.sound.loop="loop",this.bind("ended.buzzloop",function(){this.currentTime=0,this.play()}),this):this},this.unloop=function(){return a?(this.sound.removeAttribute("loop"),this.unbind("ended.buzzloop"),this):this},this.mute=function(){return a?(this.sound.muted=!0,this):this},this.unmute=function(){return a?(this.sound.muted=!1,this):this},this.toggleMute=function(){return a?(this.sound.muted=!this.sound.muted,this):this},this.isMuted=function(){return a?this.sound.muted:null},this.setVolume=function(E){return a?(E<0&&(E=0),E>100&&(E=100),this.volume=E,this.sound.volume=E/100,this):this},this.getVolume=function(){return a?this.volume:this},this.increaseVolume=function(E){return this.setVolume(this.volume+(E||1))},this.decreaseVolume=function(E){return this.setVolume(this.volume-(E||1))},this.setTime=function(E){if(!a)return this;var w=!0;return this.whenReady(function(){w===!0&&(w=!1,this.sound.currentTime=E)}),this},this.getTime=function(){if(!a)return null;var E=Math.round(this.sound.currentTime*100)/100;return isNaN(E)?p.defaults.placeholder:E},this.setPercent=function(E){return a?this.setTime(p.fromPercent(E,this.sound.duration)):this},this.getPercent=function(){if(!a)return null;var E=Math.round(p.toPercent(this.sound.currentTime,this.sound.duration));return isNaN(E)?p.defaults.placeholder:E},this.setSpeed=function(E){return a?(this.sound.playbackRate=E,this):this},this.getSpeed=function(){return a?this.sound.playbackRate:null},this.getDuration=function(){if(!a)return null;var E=Math.round(this.sound.duration*100)/100;return isNaN(E)?p.defaults.placeholder:E},this.getPlayed=function(){return a?h(this.sound.played):null},this.getBuffered=function(){return a?h(this.sound.buffered):null},this.getSeekable=function(){return a?h(this.sound.seekable):null},this.getErrorCode=function(){return a&&this.sound.error?this.sound.error.code:0},this.getErrorMessage=function(){if(!a)return null;switch(this.getErrorCode()){case 1:return"MEDIA_ERR_ABORTED";case 2:return"MEDIA_ERR_NETWORK";case 3:return"MEDIA_ERR_DECODE";case 4:return"MEDIA_ERR_SRC_NOT_SUPPORTED";default:return null}},this.getStateCode=function(){return a?this.sound.readyState:null},this.getStateMessage=function(){if(!a)return null;switch(this.getStateCode()){case 0:return"HAVE_NOTHING";case 1:return"HAVE_METADATA";case 2:return"HAVE_CURRENT_DATA";case 3:return"HAVE_FUTURE_DATA";case 4:return"HAVE_ENOUGH_DATA";default:return null}},this.getNetworkStateCode=function(){return a?this.sound.networkState:null},this.getNetworkStateMessage=function(){if(!a)return null;switch(this.getNetworkStateCode()){case 0:return"NETWORK_EMPTY";case 1:return"NETWORK_IDLE";case 2:return"NETWORK_LOADING";case 3:return"NETWORK_NO_SOURCE";default:return null}},this.set=function(E,w){return a?(this.sound[E]=w,this):this},this.get=function(E){return a?E?this.sound[E]:this.sound:null},this.bind=function(E,w){if(!a)return this;E=E.split(" ");for(var L=this,k=function(O){w.call(L,O)},R=0;R<E.length;R++){var B=E[R],v=B;B=v.split(".")[0],r.push({idx:v,func:k}),this.sound.addEventListener(B,k,!0)}return this},this.unbind=function(E){if(!a)return this;E=E.split(" ");for(var w=0;w<E.length;w++)for(var L=E[w],k=L.split(".")[0],R=0;R<r.length;R++){var B=r[R].idx.split(".");(r[R].idx===L||B[1]&&B[1]===L.replace(".",""))&&(this.sound.removeEventListener(k,r[R].func,!0),r.splice(R,1))}return this},this.bindOnce=function(E,w){if(!a)return this;var L=this;return o[n++]=!1,this.bind(E+"."+n,function(){o[n]||(o[n]=!0,w.call(L)),L.unbind(E+"."+n)}),this},this.trigger=function(E,w){if(!a)return this;E=E.split(" ");for(var L=0;L<E.length;L++)for(var k=E[L],R=0;R<r.length;R++){var B=r[R].idx.split(".");if(r[R].idx===k||B[0]&&B[0]===k.replace(".","")){var v=s.createEvent("HTMLEvents");v.initEvent(B[0],!1,!0),v.originalEvent=w,this.sound.dispatchEvent(v)}}return this},this.fadeTo=function(E,w,L){if(!a)return this;w instanceof Function?(L=w,w=p.defaults.duration):w=w||p.defaults.duration;var k=this.volume,R=w/Math.abs(k-E),B=this;this.play();function v(){setTimeout(function(){k<E&&B.volume<E?(B.setVolume(B.volume+=1),v()):k>E&&B.volume>E?(B.setVolume(B.volume-=1),v()):L instanceof Function&&L.apply(B)},R)}return this.whenReady(function(){v()}),this},this.fadeIn=function(E,w){return a?this.setVolume(0).fadeTo(100,E,w):this},this.fadeOut=function(E,w){return a?this.fadeTo(0,E,w):this},this.fadeWith=function(E,w){return a?(this.fadeOut(w,function(){this.stop()}),E.play().fadeIn(w),this):this},this.whenReady=function(E){if(!a)return null;var w=this;this.sound.readyState===0?this.bind("canplay.buzzwhenready",function(){E.call(w)}):E.call(w)},this.addSource=function(E){var w=this,L=s.createElement("source");return L.src=E,p.types[c(E)]&&(L.type=p.types[c(E)]),this.sound.appendChild(L),L.addEventListener("error",function(k){w.trigger("sourceerror",k)}),L};function h(E){for(var w=[],L=E.length-1,k=0;k<=L;k++)w.push({start:E.start(k),end:E.end(k)});return w}function c(E){return E.split(".").pop()}if(a&&t){for(var g in p.defaults)p.defaults.hasOwnProperty(g)&&e[g]===void 0&&(e[g]=p.defaults[g]);if(this.sound=s.createElement("audio"),e.webAudioApi){var m=p.getAudioContext();m&&(this.source=m.createMediaElementSource(this.sound),this.source.connect(m.destination))}if(t instanceof Array)for(var b in t)t.hasOwnProperty(b)&&this.addSource(t[b]);else if(e.formats.length)for(var u in e.formats)e.formats.hasOwnProperty(u)&&this.addSource(t+"."+e.formats[u]);else this.addSource(t);e.loop&&this.loop(),e.autoplay&&(this.sound.autoplay="autoplay"),e.preload===!0?this.sound.preload="auto":e.preload===!1?this.sound.preload="none":this.sound.preload=e.preload,this.setVolume(e.volume),p.sounds.push(this)}},group:function(t){t=s(t,arguments),this.getSounds=function(){return t},this.add=function(n){n=s(n,arguments);for(var r=0;r<n.length;r++)t.push(n[r])},this.remove=function(n){n=s(n,arguments);for(var r=0;r<n.length;r++)for(var o=0;o<t.length;o++)if(t[o]===n[r]){t.splice(o,1);break}},this.load=function(){return e("load"),this},this.play=function(){return e("play"),this},this.togglePlay=function(){return e("togglePlay"),this},this.pause=function(n){return e("pause",n),this},this.stop=function(){return e("stop"),this},this.mute=function(){return e("mute"),this},this.unmute=function(){return e("unmute"),this},this.toggleMute=function(){return e("toggleMute"),this},this.setVolume=function(n){return e("setVolume",n),this},this.increaseVolume=function(n){return e("increaseVolume",n),this},this.decreaseVolume=function(n){return e("decreaseVolume",n),this},this.loop=function(){return e("loop"),this},this.unloop=function(){return e("unloop"),this},this.setSpeed=function(n){return e("setSpeed",n),this},this.setTime=function(n){return e("setTime",n),this},this.set=function(n,r){return e("set",n,r),this},this.bind=function(n,r){return e("bind",n,r),this},this.unbind=function(n){return e("unbind",n),this},this.bindOnce=function(n,r){return e("bindOnce",n,r),this},this.trigger=function(n){return e("trigger",n),this},this.fade=function(n,r,o,a){return e("fade",n,r,o,a),this},this.fadeIn=function(n,r){return e("fadeIn",n,r),this},this.fadeOut=function(n,r){return e("fadeOut",n,r),this};function e(){for(var n=s(null,arguments),r=n.shift(),o=0;o<t.length;o++)t[o][r].apply(t[o],n)}function s(n,r){return n instanceof Array?n:Array.prototype.slice.call(r)}},all:function(){return new p.group(p.sounds)},isSupported:function(){return!!p.el.canPlayType},isOGGSupported:function(){return!!p.el.canPlayType&&p.el.canPlayType('audio/ogg; codecs="vorbis"')},isWAVSupported:function(){return!!p.el.canPlayType&&p.el.canPlayType('audio/wav; codecs="1"')},isMP3Supported:function(){return!!p.el.canPlayType&&p.el.canPlayType("audio/mpeg;")},isAACSupported:function(){return!!p.el.canPlayType&&(p.el.canPlayType("audio/x-m4a;")||p.el.canPlayType("audio/aac;"))},toTimer:function(t,e){var s,n,r;return s=Math.floor(t/3600),s=isNaN(s)?"--":s>=10?s:"0"+s,n=Math.floor(e?t/60%60:t/60),n=isNaN(n)?"--":n>=10?n:"0"+n,r=Math.floor(t%60),r=isNaN(r)?"--":r>=10?r:"0"+r,e?s+":"+n+":"+r:n+":"+r},fromTimer:function(t){var e=t.toString().split(":");return e&&e.length===3&&(t=parseInt(e[0],10)*3600+parseInt(e[1],10)*60+parseInt(e[2],10)),e&&e.length===2&&(t=parseInt(e[0],10)*60+parseInt(e[1],10)),t},toPercent:function(t,e,s){var n=Math.pow(10,s||0);return Math.round(t*100/e*n)/n},fromPercent:function(t,e,s){var n=Math.pow(10,s||0);return Math.round(e/100*t*n)/n}};return p})});var xs=Ti((ws,vs)=>{(function(f){if(typeof bootstrap=="function")bootstrap("pf",f);else if(typeof ws=="object")vs.exports=f();else if(typeof define=="function"&&define.amd)define(f);else if(typeof ses<"u"){if(!ses.ok())return;ses.makePF=f}else typeof window<"u"?window.PF=f():global.PF=f()})(function(){var f,p,t,e,s;return function(n,r,o){function a(g,m){if(!r[g]){if(!n[g]){var b=typeof $t=="function"&&$t;if(!m&&b)return b(g,!0);if(h)return h(g,!0);throw new Error("Cannot find module '"+g+"'")}var u=r[g]={exports:{}};n[g][0].call(u.exports,function(E){var w=n[g][1][E];return a(w||E)},u,u.exports)}return r[g].exports}for(var h=typeof $t=="function"&&$t,c=0;c<o.length;c++)a(o[c]);return a}({1:[function(n,r,o){r.exports=n("./lib/heap")},{"./lib/heap":2}],2:[function(n,r,o){(function(){var a,h,c,g,m,b,u,E,w,L,k,R,B,v,O;c=Math.floor,L=Math.min,h=function(C,I){return C<I?-1:C>I?1:0},w=function(C,I,D,S,M){var q;if(D==null&&(D=0),M==null&&(M=h),D<0)throw new Error("lo must be non-negative");for(S==null&&(S=C.length);D<S;)q=c((D+S)/2),M(I,C[q])<0?S=q:D=q+1;return[].splice.apply(C,[D,D-D].concat(I)),I},b=function(C,I,D){return D==null&&(D=h),C.push(I),v(C,0,C.length-1,D)},m=function(C,I){var D,S;return I==null&&(I=h),D=C.pop(),C.length?(S=C[0],C[0]=D,O(C,0,I)):S=D,S},E=function(C,I,D){var S;return D==null&&(D=h),S=C[0],C[0]=I,O(C,0,D),S},u=function(C,I,D){var S;return D==null&&(D=h),C.length&&D(C[0],I)<0&&(S=[C[0],I],I=S[0],C[0]=S[1],O(C,0,D)),I},g=function(C,I){var D,S,M,q,Q,W,ne,V;for(I==null&&(I=h),W=function(){V=[];for(var N=0,G=c(C.length/2);0<=G?N<G:N>G;0<=G?N++:N--)V.push(N);return V}.apply(this).reverse(),ne=[],S=0,q=W.length;S<q;S++)D=W[S],ne.push(O(C,D,I));return ne},B=function(C,I,D){var S;if(D==null&&(D=h),S=C.indexOf(I),S!==-1)return v(C,0,S,D),O(C,S,D)},k=function(C,I,D){var S,M,q,Q,W;if(D==null&&(D=h),M=C.slice(0,I),!M.length)return M;for(g(M,D),W=C.slice(I),q=0,Q=W.length;q<Q;q++)S=W[q],u(M,S,D);return M.sort(D).reverse()},R=function(C,I,D){var S,M,q,Q,W,ne,V,N,G,K;if(D==null&&(D=h),I*10<=C.length){if(Q=C.slice(0,I).sort(D),!Q.length)return Q;for(q=Q[Q.length-1],N=C.slice(I),W=0,V=N.length;W<V;W++)S=N[W],D(S,q)<0&&(w(Q,S,0,null,D),Q.pop(),q=Q[Q.length-1]);return Q}for(g(C,D),K=[],M=ne=0,G=L(I,C.length);0<=G?ne<G:ne>G;M=0<=G?++ne:--ne)K.push(m(C,D));return K},v=function(C,I,D,S){var M,q,Q;for(S==null&&(S=h),M=C[D];D>I;){if(Q=D-1>>1,q=C[Q],S(M,q)<0){C[D]=q,D=Q;continue}break}return C[D]=M},O=function(C,I,D){var S,M,q,Q,W;for(D==null&&(D=h),M=C.length,W=I,q=C[I],S=2*I+1;S<M;)Q=S+1,Q<M&&!(D(C[S],C[Q])<0)&&(S=Q),C[I]=C[S],I=S,S=2*I+1;return C[I]=q,v(C,W,I,D)},a=function(){C.push=b,C.pop=m,C.replace=E,C.pushpop=u,C.heapify=g,C.nlargest=k,C.nsmallest=R;function C(I){this.cmp=I??h,this.nodes=[]}return C.prototype.push=function(I){return b(this.nodes,I,this.cmp)},C.prototype.pop=function(){return m(this.nodes,this.cmp)},C.prototype.peek=function(){return this.nodes[0]},C.prototype.contains=function(I){return this.nodes.indexOf(I)!==-1},C.prototype.replace=function(I){return E(this.nodes,I,this.cmp)},C.prototype.pushpop=function(I){return u(this.nodes,I,this.cmp)},C.prototype.heapify=function(){return g(this.nodes,this.cmp)},C.prototype.updateItem=function(I){return B(this.nodes,I,this.cmp)},C.prototype.clear=function(){return this.nodes=[]},C.prototype.empty=function(){return this.nodes.length===0},C.prototype.size=function(){return this.nodes.length},C.prototype.clone=function(){var I;return I=new C,I.nodes=this.nodes.slice(0),I},C.prototype.toArray=function(){return this.nodes.slice(0)},C.prototype.insert=C.prototype.push,C.prototype.remove=C.prototype.pop,C.prototype.top=C.prototype.peek,C.prototype.front=C.prototype.peek,C.prototype.has=C.prototype.contains,C.prototype.copy=C.prototype.clone,C}(),typeof r<"u"&&r!==null&&r.exports?r.exports=a:window.Heap=a}).call(this)},{}],3:[function(n,r,o){r.exports={Heap:n("heap"),Node:n("./core/Node"),Grid:n("./core/Grid"),Util:n("./core/Util"),Heuristic:n("./core/Heuristic"),AStarFinder:n("./finders/AStarFinder"),BestFirstFinder:n("./finders/BestFirstFinder"),BreadthFirstFinder:n("./finders/BreadthFirstFinder"),DijkstraFinder:n("./finders/DijkstraFinder"),BiAStarFinder:n("./finders/BiAStarFinder"),BiBestFirstFinder:n("./finders/BiBestFirstFinder"),BiBreadthFirstFinder:n("./finders/BiBreadthFirstFinder"),BiDijkstraFinder:n("./finders/BiDijkstraFinder"),JumpPointFinder:n("./finders/JumpPointFinder"),IDAStarFinder:n("./finders/IDAStarFinder")}},{"./core/Grid":4,"./core/Heuristic":5,"./core/Node":6,"./core/Util":7,"./finders/AStarFinder":8,"./finders/BestFirstFinder":9,"./finders/BiAStarFinder":10,"./finders/BiBestFirstFinder":11,"./finders/BiBreadthFirstFinder":12,"./finders/BiDijkstraFinder":13,"./finders/BreadthFirstFinder":14,"./finders/DijkstraFinder":15,"./finders/IDAStarFinder":16,"./finders/JumpPointFinder":17,heap:1}],4:[function(n,r,o){var a=n("./Node");function h(c,g,m,b){this.width=c,this.height=g,this.depth=m,this.nodes=this.dh(c,g,m,b)}h.prototype.dh=function(c,g,m,b){var u,E,w,L=new Array(g),k;for(u=0;u<g;++u)for(L[u]=new Array(c),E=0;E<c;++E)for(L[u][E]=new Array(m),w=0;w<m;++w)L[u][E][w]=new a(E,u,w);if(b===void 0)return L;if(b.length!==g||b[0].length!==c)throw new Error("Matrix size does not fit");for(u=0;u<g;++u)for(E=0;E<c;++E)for(w=0;w<m;++w)L[u][E][w].walkable=b[u][E][w];return L},h.prototype.getNodeAt=function(c,g,m){return this.nodes[g][c][m]},h.prototype.isWalkableAt=function(c,g,m,b){return this.isInside(c,g,m)&&(this.nodes[g][c][m].walkable&b)==b},h.prototype.isInside=function(c,g,m){return c>=0&&c<this.width&&g>=0&&g<this.height&&m>=0&&m<this.depth},h.prototype.setWalkableAt=function(c,g,m,b){this.nodes[g][c][m].walkable=b},h.prototype.getNeighbors=function(c,g,m){var b=c.x,u=c.y,E=c.z,w=[],L=!1,k=!1,R=!1,B=!1,v=!1,O=!1,C=!1,I=!1,D=!1,S=!1,M=this.nodes;return this.isWalkableAt(b,u,E,128)&&this.isInside(b,u-1,E,8)&&(w.push(M[u-1][b][E]),L=!0),this.isWalkableAt(b,u,E,32)&&this.isInside(b+1,u,E,2)&&(w.push(M[u][b+1][E]),R=!0),this.isWalkableAt(b,u,E,8)&&this.isInside(b,u+1,E,128)&&(w.push(M[u+1][b][E]),v=!0),this.isWalkableAt(b,u,E,2)&&this.isInside(b-1,u,E,32)&&(w.push(M[u][b-1][E]),C=!0),this.isWalkableAt(b,u,E,512)&&this.isInside(b,u,E+1,256)&&(w.push(M[u][b][E+1]),D=!0),this.isWalkableAt(b,u,E,256)&&this.isInside(b,u,E-1,512)&&(w.push(M[u][b][E-1]),S=!0),g&&(m?(k=C&&L,B=L&&R,O=R&&v,I=v&&C):(k=C||L||!0,B=L||R||!0,O=R||v||!0,I=v||C||!0),k&&this.isWalkableAt(b,u,E,1)&&this.isInside(b-1,u-1,E,16)&&w.push(M[u-1][b-1][E]),B&&this.isWalkableAt(b,u,E,64)&&this.isInside(b+1,u-1,E,4)&&w.push(M[u-1][b+1][E]),O&&this.isWalkableAt(b,u,E,16)&&this.isInside(b+1,u+1,E,1)&&w.push(M[u+1][b+1][E]),I&&this.isWalkableAt(b,u,E,4)&&this.isInside(b-1,u+1,E,64)&&w.push(M[u+1][b-1][E])),w},h.prototype.clone=function(){var c,g,m=this.width,b=this.height,u=this.depth,E=this.nodes,w=new h(m,b,u),L=new Array(b),k;for(c=0;c<b;++c)for(L[c]=new Array(m),g=0;g<m;++g)for(L[c][g]=new Array(u),z=0;z<u;++z)L[c][g][z]=new a(g,c,z,E[c][g][z].walkable);return w.nodes=L,w},r.exports=h},{"./Node":6}],5:[function(n,r,o){r.exports={manhattan:function(a,h,c){return a+h+c},euclidean:function(a,h,c){return Math.sqrt(a*a+h*h+c*c)},chebyshev:function(a,h,c){return Math.max(a,h,c)}}},{}],6:[function(n,r,o){function a(h,c,g,m){this.x=h,this.y=c,this.walkable=m===void 0?!0:m,this.z=g}r.exports=a},{}],7:[function(n,r,o){function a(b){for(var u=[[b.x,b.y,b.z]];b.parent;)b=b.parent,u.push([b.x,b.y,b.z]);return u.reverse()}o.backtrace=a;function h(b,u){var E=a(b),w=a(u);return E.concat(w.reverse())}o.biBacktrace=h;function c(b){var u,E=0,w,L,k,R,B;for(u=1;u<b.length;++u)w=b[u-1],L=b[u],k=w[0]-L[0],R=w[1]-L[1],B=w[2]-L[2],E+=Math.sqrt(k*k+R*R+B*B);return E}o.pathLength=c;function g(b,u,E,w,L,k){let R=[];R.push([b,u,E]);let B=Math.abs(w-b),v=Math.abs(L-u),O=Math.abs(k-E),C,I,D;if(w>b?C=1:C=-1,L>u?I=1:I=-1,k>E?D=1:D=-1,B>=v&&B>=O){let S=2*v-B,M=2*O-B;for(;b!=w;)b+=C,S>=0&&(u+=I,S-=2*B),M>=0&&(E+=D,M-=2*B),S+=2*v,M+=2*O,R.push([b,u,E])}else if(v>=B&&v>=O){let S=2*B-v,M=2*O-v;for(;u!=L;)u+=I,S>=0&&(b+=C,S-=2*v),M>=0&&(E+=D,M-=2*v),S+=2*B,M+=2*O,R.push([b,u,E])}else{let S=2*v-O,M=2*B-O;for(;E!=k;)E+=D,S>=0&&(u+=I,S-=2*O),M>=0&&(b+=C,M-=2*O),S+=2*v,M+=2*B,R.push([b,u,E])}return R}o.getLine=g;function m(b,u){var E=u.length,w=u[0][0],L=u[0][1],k=u[0][2],R=u[E-1][0],B=u[E-1][1],v=u[E-1][2],O,C,I;for(ex,ey,ez,lx,ly,lz,newPath,i,j,coord,line,testCoord,blocked,O=w,C=L,I=k,lx=u[1][0],ly=u[1][1],lz=u[1][2],newPath=[[O,C,I]],i=2;i<E;++i){for(coord=u[i],ex=coord[0],ey=coord[1],ez=coord[2],line=g(O,C,I,ex,ey,ez),blocked=!1,j=1;j<line.length;++j)if(testCoord=line[j],!b.isWalkableAt(testCoord[0],testCoord[1])){blocked=!0,newPath.push([lx,ly]),O=lx,C=ly;break}blocked||(lx=ex,ly=ey)}return newPath.push([R,B]),newPath}o.smoothenPath=m},{}],8:[function(n,r,o){var a=n("heap"),h=n("../core/Util"),c=n("../core/Heuristic");function g(m){m=m||{},this.allowDiagonal=m.allowDiagonal,this.dontCrossCorners=m.dontCrossCorners,this.heuristic=m.heuristic||c.manhattan,this.weight=m.weight||1}g.prototype.findPath=function(m,b,u,E,w,L,k){if(!k.isInside(m,b,u)||!k.isInside(E,w,L))return[];var R=new a(function(P,Z){return P.f-Z.f}),B=k.getNodeAt(m,b,u),v=k.getNodeAt(E,w,L),O=this.heuristic,C=this.allowDiagonal,I=this.dontCrossCorners,D=this.weight,S=Math.abs,M=Math.SQRT2,q,Q,W,ne,V,N,G,K,Y;for(B.g=0,B.f=0,R.push(B),B.opened=!0;!R.empty();){if(q=R.pop(),q.closed=!0,q===v)return h.backtrace(v);for(Q=k.getNeighbors(q,C,I),ne=0,V=Q.length;ne<V;++ne)W=Q[ne],!W.closed&&(N=W.x,G=W.y,Y=W.z,K=q.g+(N-q.x===0||G-q.y===0||Y-q.z===0?1:M),(!W.opened||K<W.g)&&(W.g=K,W.h=W.h||D*O(S(N-E),S(G-w),S(Y-L)),W.f=W.g+W.h,W.parent=q,W.opened?R.updateItem(W):(R.push(W),W.opened=!0)))}return[]},r.exports=g},{"../core/Heuristic":5,"../core/Util":7,heap:1}],9:[function(n,r,o){var a=n("./AStarFinder");function h(c){a.call(this,c);var g=this.heuristic;this.heuristic=function(m,b,u){return g(m,b,u)*1e6}}h.prototype=new a,h.prototype.constructor=h,r.exports=h},{"./AStarFinder":8}],10:[function(n,r,o){var a=n("heap"),h=n("../core/Util"),c=n("../core/Heuristic");function g(m){m=m||{},this.allowDiagonal=m.allowDiagonal,this.dontCrossCorners=m.dontCrossCorners,this.heuristic=m.heuristic||c.manhattan,this.weight=m.weight||1}g.prototype.findPath=function(m,b,u,E,w,L,k){var R=function(T,fe){return T.f-fe.f},B=new a(R),v=new a(R),O=k.getNodeAt(m,b),C=k.getNodeAt(E,w),I=this.heuristic,D=this.allowDiagonal,S=this.dontCrossCorners,M=this.weight,q=Math.abs,Q=Math.SQRT2,W,ne,V,N,G,K,Y,P,Z,H=1,oe=2;for(O.g=0,O.f=0,B.push(O),O.opened=H,C.g=0,C.f=0,v.push(C),C.opened=oe;!B.empty()&&!v.empty();){for(W=B.pop(),W.closed=!0,ne=k.getNeighbors(W,D,S),N=0,G=ne.length;N<G;++N)if(V=ne[N],!V.closed){if(V.opened===oe)return h.biBacktrace(W,V);K=V.x,Y=V.y,Z=V.z,P=W.g+(K-W.x===0||Y-W.y===0||Z-W.z===0?1:Q),(!V.opened||P<V.g)&&(V.g=P,V.h=V.h||M*I(q(K-E),q(Y-w),q(Z-L)),V.f=V.g+V.h,V.parent=W,V.opened?B.updateItem(V):(B.push(V),V.opened=H))}for(W=v.pop(),W.closed=!0,ne=k.getNeighbors(W,D,S),N=0,G=ne.length;N<G;++N)if(V=ne[N],!V.closed){if(V.opened===H)return h.biBacktrace(V,W);K=V.x,Y=V.y,Z=V.z,P=W.g+(K-W.x===0||Y-W.y===0||Z-W.z===0?1:Q),(!V.opened||P<V.g)&&(V.g=P,V.h=V.h||M*I(q(K-m),q(Y-b),q(Z-u)),V.f=V.g+V.h,V.parent=W,V.opened?v.updateItem(V):(v.push(V),V.opened=oe))}}return[]},r.exports=g},{"../core/Heuristic":5,"../core/Util":7,heap:1}],11:[function(n,r,o){var a=n("./BiAStarFinder");function h(c){a.call(this,c);var g=this.heuristic;this.heuristic=function(m,b,u){return g(m,b,u)*1e6}}h.prototype=new a,h.prototype.constructor=h,r.exports=h},{"./BiAStarFinder":10}],12:[function(n,r,o){var a=n("../core/Util");function h(c){c=c||{},this.allowDiagonal=c.allowDiagonal,this.dontCrossCorners=c.dontCrossCorners}h.prototype.findPath=function(c,g,m,b,u,E,w){var L=w.getNodeAt(c,g,m),k=w.getNodeAt(b,u,E),R=[],B=[],v,O,C,I=this.allowDiagonal,D=this.dontCrossCorners,S=0,M=1,q,Q;for(R.push(L),L.opened=!0,L.by=S,B.push(k),k.opened=!0,k.by=M;R.length&&B.length;){for(C=R.shift(),C.closed=!0,v=w.getNeighbors(C,I,D),q=0,Q=v.length;q<Q;++q)if(O=v[q],!O.closed){if(O.opened){if(O.by===M)return a.biBacktrace(C,O);continue}R.push(O),O.parent=C,O.opened=!0,O.by=S}for(C=B.shift(),C.closed=!0,v=w.getNeighbors(C,I,D),q=0,Q=v.length;q<Q;++q)if(O=v[q],!O.closed){if(O.opened){if(O.by===S)return a.biBacktrace(O,C);continue}B.push(O),O.parent=C,O.opened=!0,O.by=M}}return[]},r.exports=h},{"../core/Util":7}],13:[function(n,r,o){var a=n("./BiAStarFinder");function h(c){a.call(this,c),this.heuristic=function(g,m,b){return 0}}h.prototype=new a,h.prototype.constructor=h,r.exports=h},{"./BiAStarFinder":10}],14:[function(n,r,o){var a=n("../core/Util");function h(c){c=c||{},this.allowDiagonal=c.allowDiagonal,this.dontCrossCorners=c.dontCrossCorners}h.prototype.findPath=function(c,g,m,b,u,E,w){var L=[],k=this.allowDiagonal,R=this.dontCrossCorners,B=w.getNodeAt(c,g,m),v=w.getNodeAt(b,u,E),O,C,I,D,S;for(L.push(B),B.opened=!0;L.length;){if(I=L.shift(),I.closed=!0,I===v)return a.backtrace(v);for(O=w.getNeighbors(I,k,R),D=0,S=O.length;D<S;++D)C=O[D],!(C.closed||C.opened)&&(L.push(C),C.opened=!0,C.parent=I)}return[]},r.exports=h},{"../core/Util":7}],15:[function(n,r,o){var a=n("./AStarFinder");function h(c){a.call(this,c),this.heuristic=function(g,m,b){return 0}}h.prototype=new a,h.prototype.constructor=h,r.exports=h},{"./AStarFinder":8}],16:[function(n,r,o){var a=n("../core/Util"),h=n("../core/Heuristic"),c=n("../core/Node");function g(m){m=m||{},this.allowDiagonal=m.allowDiagonal,this.dontCrossCorners=m.dontCrossCorners,this.heuristic=m.heuristic||h.manhattan,this.weight=m.weight||1,this.trackRecursion=m.trackRecursion||!1,this.timeLimit=m.timeLimit||1/0}g.prototype.findPath=function(m,b,u,E,w,L,k){var R=0,B=new Date().getTime(),v=function(W,ne){return this.heuristic(Math.abs(ne.x-W.x),Math.abs(ne.y-W.y),Math.abs(ne.z-W.z))}.bind(this),O=function(W,ne){return W.x===ne.x||W.y===ne.y||W.z===ne.z?1:Math.SQRT2},C=function(W,ne,V,N,G){if(R++,this.timeLimit>0&&new Date().getTime()-B>this.timeLimit*1e3)return 1/0;var K=ne+v(W,D)*this.weight;if(K>V)return K;if(W==D)return N[G]=[W.x,W.y,W.z],W;var Y,P,Z,H,oe=k.getNeighbors(W,this.allowDiagonal,this.dontCrossCorners);for(Z=0,Y=1/0;H=oe[Z];++Z){if(this.trackRecursion&&(H.retainCount=H.retainCount+1||1,H.tested!==!0&&(H.tested=!0)),P=C(H,ne+O(W,H),V,N,G+1),P instanceof c)return N[G]=[W.x,W.y,W.z],P;this.trackRecursion&&--H.retainCount===0&&(H.tested=!1),P<Y&&(Y=P)}return Y}.bind(this),I=k.getNodeAt(m,b,u),D=k.getNodeAt(E,w,L),S=v(I,D),M,q,Q;for(M=0;;++M){if(q=[],Q=C(I,0,S,q,0),Q===1/0)return[];if(Q instanceof c)return q;S=Q}return[]},r.exports=g},{"../core/Heuristic":5,"../core/Node":6,"../core/Util":7}],17:[function(n,r,o){var a=n("heap"),h=n("../core/Util"),c=n("../core/Heuristic");function g(m){m=m||{},this.heuristic=m.heuristic||c.manhattan,this.trackJumpRecursion=m.trackJumpRecursion||!1}g.prototype.findPath=function(m,b,u,E,w,L,k){var R=this.openList=new a(function(C,I){return C.f-I.f}),B=this.startNode=k.getNodeAt(m,b,u),v=this.endNode=k.getNodeAt(E,w,L),O;for(this.grid=k,B.g=0,B.f=0,R.push(B),B.opened=!0;!R.empty();){if(O=R.pop(),O.closed=!0,O===v)return h.backtrace(v);this.fh(O)}return[]},g.prototype.fh=function(m){var b=this.grid,u=this.heuristic,E=this.openList,w=this.endNode.x,L=this.endNode.y,k=this.endNode.z;for(neighbors,neighbor,jumpPoint,i,l,x=m.x,y=m.y,z=m.z,jx,jy,dx,dy,d,ng,jumpNode,dz,jz,abs=Math.abs,max=Math.max,neighbors=this.mh(m),i=0,l=neighbors.length;i<l;++i)if(neighbor=neighbors[i],jumpPoint=this.or(neighbor[0],neighbor[1],x,y,z),jumpPoint){if(jx=jumpPoint[0],jy=jumpPoint[1],jz=jumpPoint[2],jumpNode=b.getNodeAt(jx,jy,jz),jumpNode.closed)continue;d=c.euclidean(abs(jx-x),abs(jy-y),abs(jz-z)),ng=m.g+d,(!jumpNode.opened||ng<jumpNode.g)&&(jumpNode.g=ng,jumpNode.h=jumpNode.h||u(abs(jx-w),abs(jy-L),abs(jz-k)),jumpNode.f=jumpNode.g+jumpNode.h,jumpNode.parent=m,jumpNode.opened?E.updateItem(jumpNode):(E.push(jumpNode),jumpNode.opened=!0))}},g.prototype.or=function(m,b,u,E,w,L){var k=this.grid,R=m-E,B=b-w,v,O;if(dz=u-L,jz,!k.isWalkableAt(m,b,u))return null;if(this.trackJumpRecursion===!0&&(k.getNodeAt(m,b,u).tested=!0),k.getNodeAt(m,b,u)===this.endNode)return[m,b,u];if(R!==0&&B!==0){if(k.isWalkableAt(m-R,b+B,u)&&!k.isWalkableAt(m-R,b,u)||k.isWalkableAt(m+R,b-B,u)&&!k.isWalkableAt(m,b-B,u))return[m,b,u]}else if(R!==0){if(k.isWalkableAt(m+R,b+1,u)&&!k.isWalkableAt(m,b+1,u)||k.isWalkableAt(m+R,b-1,u)&&!k.isWalkableAt(m,b-1,u))return[m,b,u]}else if(k.isWalkableAt(m+1,b+B,u)&&!k.isWalkableAt(m+1,b,u)||k.isWalkableAt(m-1,b+B,u)&&!k.isWalkableAt(m-1,b,u))return[m,b,u];return dz!==0&&(jz=his.or(m,b,u+dz,m,b,u),jz)?[m,b,u]:R!==0&&B!==0&&(v=this.or(m+R,b,u,m,b,u),O=this.or(m,b+B,u,m,b,u),v||O)?[m,b,u]:k.isWalkableAt(m+R,b,u)||k.isWalkableAt(m,b+B,u)?this.or(m+R,b+B,u,m,b,u):null},g.prototype.mh=function(m){var b=m.parent,u=m.x,E=m.y,w=m.z,L=this.grid,k,R,B,v,O,C,I,D,S;if(neighbors=[],neighborNodes,neighborNode,i,l,b)k=b.x,R=b.y,I=b.z,O=(u-k)/Math.max(Math.abs(u-k),1),C=(E-R)/Math.max(Math.abs(E-R),1),S=(w-I)/Math.max(Math.abs(w-I),1),S!==0?L.isWalkableAt(u,E,w+S)&&(L.isWalkableAt(u,E,w+S)&&neighbors.push([u+O,E+C,w+S]),L.isWalkableAt(u,E,w+1)||neighbors.push([u+O,E+C,w+1]),L.isWalkableAt(u,E,w-1)||neighbors.push([u+O,E+C,w-1])):O!==0&&C!==0?(L.isWalkableAt(u,E+C,w)&&neighbors.push([u,E+C,w]),L.isWalkableAt(u+O,E,w)&&neighbors.push([u+O,E,w]),(L.isWalkableAt(u,E+C,w)||L.isWalkableAt(u+O,E,w))&&neighbors.push([u+O,E+C,w]),!L.isWalkableAt(u-O,E,w)&&L.isWalkableAt(u,E+C,w)&&neighbors.push([u-O,E+C,w]),!L.isWalkableAt(u,E-C,w)&&L.isWalkableAt(u+O,E,w)&&neighbors.push([u+O,E-C,w])):O===0?L.isWalkableAt(u,E+C,w)&&(L.isWalkableAt(u,E+C,w)&&neighbors.push([u,E+C,w]),L.isWalkableAt(u+1,E,w)||neighbors.push([u+1,E+C,w]),L.isWalkableAt(u-1,E,w)||neighbors.push([u-1,E+C,w])):L.isWalkableAt(u+O,E,w)&&(L.isWalkableAt(u+O,E,w)&&neighbors.push([u+O,E,w]),L.isWalkableAt(u,E+1,w)||neighbors.push([u+O,E+1,w]),L.isWalkableAt(u,E-1,w)||neighbors.push([u+O,E-1,w]));else for(neighborNodes=L.getNeighbors(m,!0),i=0,l=neighborNodes.length;i<l;++i)neighborNode=neighborNodes[i],neighbors.push([neighborNode.x,neighborNode.y,neighborNode.z]);return neighbors},r.exports=g},{"../core/Heuristic":5,"../core/Util":7,heap:1}]},{},[3])(3)})});var me=class{#e={};bind(p,t,e,s){(!Array.isArray(this.#e[p])||typeof this.#e[p]>"u")&&(this.#e[p]=[]),this.#e[p].push({listener:t,caller:e,once:s||!1})}on(p,t,e){this.bind(p,t,e)}once(p,t,e){this.bind(p,t,e,!0)}addEventListener(p,t,e){this.bind(p,t,e)}fire(p,t,e){if(!p||typeof p!="string")throw new Error("Event missing.");if(!Array.isArray(this.#e[p]))return;!t||t===null||typeof t>"u"?t=[]:Array.isArray(t)||(t=[t]),e=e||this;let s=this.#e[p],n=s.slice().reverse(),r=[];for(let o=n.length-1;o>=0;o--)s.indexOf(n[o])!==-1&&(n[o]&&n[o].once&&r.push(n[o]),n[o].listener.apply(n[o].caller||e,t));for(let o=r.length-1;o>=0;o--){let a=this.#e[p].indexOf(r[o]);a!==-1&&this.#e[p].splice(a,1)}}emit(p,...t){this.fire(p,t)}dispatchEvent(p,t,e){this.fire(p,t,e)}unbind(p,t){if(!p||!t||!Array.isArray(this.#e[p]))return;let e=this.#e[p];for(let s=e.length-1;s>=0;s--)if(e[s].listener===t){e.splice(s,1);break}}remove(p,t){this.unbind(p,t)}off(p,t){this.unbind(p,t)}removeListener(p,t){this.unbind(p,t)}removeAllListeners(p){if(!p){this.#e=[];return}Array.isArray(this.#e[p])&&delete this.#e[p]}removeListenersFromCaller(p,t){if(!t){Object.keys(this.#e).forEach(s=>{let n=this.#e[s];for(let r=n.length-1;r>=0;r--)if(n[r].caller===p){n.splice(r,1);break}});return}if(!Array.isArray(this.#e[t]))return;let e=this.#e[t];for(let s=0,n=e.length;s<n;s++)if(e[s].caller===p){e.splice(s,1);break}}listeners(p){return p?this.#e[p]||[]:this.#e}};Array.prototype.filter||(Array.prototype.filter=function(f){let p=this.length>>>0;if(typeof f!="function")throw new TypeError;let t=[],e=arguments[1];for(let s=0;s<p;s++)if(s in this){let n=this[s];f.call(e,n,s,this)&&t.push(n)}return t});function Xs(f,p){return f.priority>p.priority?-1:f.priority<p.priority?1:0}function qs(f,p){return f.priority>p.priority?-1:f.priority<p.priority?1:f.index<p.index?-1:f.index>p.index?1:0}function se(f){let p=f.map((t,e)=>({index:e,priority:t.priority}));return p.sort(qs),p.map(t=>f[t.index])}function bt(f,p,t){let e=[];if(!f||f.length===0)return e;let s=f.length;for(let n=0;n<s;n++)f[n].enabled&&f[n][p]===t&&e.push(f[n]);return e.length<=1?e:e.sort(Xs)}var Ft=document.createElement("div");function Pe(f,p){return!f||!f.length?"":(Ft.textContent=p?f.replace(/ /g,"\xA0"):f,f=Ft.innerHTML,f)}function Pi(f,p){return!f||!f.length?"":(Ft.innerHTML=f,f=p?Ft.textContent.replace(/\u00A0/g," "):Ft.textContent,f)}function ee(f){return f=f.replace(/^"(.+(?="$))?"$/,"$1"),f=f.replace(/^'(.+(?='$))?'$/,"$1"),f}function ls(f){let p=f.getBoundingClientRect(),t=document.documentElement;return{top:p.top+(window.scrollY||window.pageYOffset)-t.clientTop,left:p.left+(window.scrollX||window.pageXOffset)-t.clientLeft}}var lt=class{constructor(p){this.length=0;typeof p=="string"&&p.length>0?this.buffer=[p]:this.buffer=[],this.length=0}prepend(p){return this.buffer.unshift(p),this.length+=p.length,this}append(p){return this.buffer.push(p),this.length+=p.length,this}push(p){typeof p=="number"?this.appendCode(p):this.append(p)}appendCode(p){return this.buffer.push(String.fromCharCode(p)),this.length++,this}toString(){return this.buffer.join("")}clear(p){return this.buffer=[],this.length=0,p&&typeof p<"u"&&p.length&&(this.buffer.push(p),this.length=p.length),this}concat(p){this.buffer=this.buffer.concat(p)}};function ei(f,p){if(f.length>1)return!1;if(f==="-"||f==="_"||f==="."||f==="~"||f==="!"||f==="*"||f==="'"||f===";"||f===":"||f==="@"||f==="&"||f==="="||f==="+"||f==="$"||f===","||f==="/"||f==="\\"||f==="?"||f==="%"||f==="#"||f==="["||f==="]"||f==="("||f===")")return!p;let t=f.charCodeAt(0);return t>64&&t<91||t>96&&t<123||t>47&&t<58||t>=160&&t<=55295||t>=57344&&t<=64975||t>=65008&&t<=65533||t>=65536&&t<=131069||t>=131072&&t<=196605||t>=196608&&t<=262141||t>=262144&&t<=327677||t>=327680&&t<=393213||t>=393216&&t<=458749||t>=458752&&t<=524285||t>=524288&&t<=589821||t>=589824&&t<=655357||t>=655360&&t<=720893||t>=720896&&t<=786429||t>=786432&&t<=851965||t>=851968&&t<=917501||t>=921600&&t<=983037||t>=983040&&t<=1048573||t>=1048576&&t<=1114109}var Ut={3:"Cancel",6:"Help",8:"Backspace",9:"Tab",19:"Pause/Break",20:"Caps Lock",21:"Kana",22:"Eisu",23:"Junja",24:"Final",25:"Hanja",27:"Esc",28:"Convert",29:"Nonconvert",30:"Accept",31:"Modechange",32:"Space",33:"Page Up",34:"Page Down",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",41:"Select",42:"Print",43:"Execute",44:"Printscreen",45:"Insert",46:"Delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",58:"Colon",59:"Semicolon",60:"Less Than",61:"Equals2",62:"Greater Than",63:"Question Mark",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",93:"Context Menu",95:"Sleep",96:"Numpad 0",97:"Numpad 1",98:"Numpad 2",99:"Numpad 3",100:"Numpad 4",101:"Numpad 5",102:"Numpad 6",103:"Numpad 7",104:"Numpad 8",105:"Numpad 9",106:"Numpad *",107:"Numpad +",109:"Numpad -",110:"Numpad .",111:"Numpad /",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",124:"F13",125:"F14",126:"F15",127:"F16",128:"F17",129:"F18",130:"F19",131:"F20",132:"F21",133:"F22",134:"F23",135:"F24",144:"Num Lock",145:"Scroll Lock",146:"Win Oem Fj Jisho",147:"Win Oem Fj Masshou",148:"Win Oem Fj Touroku",149:"Win Oem Fj Loya",150:"Win Oem Fj Roya",160:"Circumflex",161:"Exclamation",162:"Double Quote",163:"Hash",164:"Dollar",165:"Percent",166:"Ampersand",167:"Underscore",168:"Open Paren",169:"Close Paren",170:"Asterisk",171:"Plus",172:"Pipe",173:"Hyphen Minus",174:"Open Curly Bracket",175:"Close Curly Bracket",176:"Tilde",181:"Volume Mute",182:"Volume Down",183:"Volume Up",186:";",187:"Equals",188:",",189:"Minus",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",227:"Win Ico Help",228:"Win Ico 00",230:"Win Ico Clear",233:"Win Oem Reset",234:"Win Oem Jump",235:"Win Oem Pa1",236:"Win Oem Pa2",237:"Win Oem Pa3",238:"Win Oem Wsctrl",239:"Win Oem Cusel",240:"Win Oem Attn",241:"Win Oem Finish",242:"Win Oem Copy",243:"Win Oem Auto",244:"Win Oem Enlw",245:"Win Oem Backtab",246:"Attn",247:"Crsel",248:"Exsel",249:"Ereof",250:"Play",251:"Zoom",253:"Pa1",254:"Win Oem Clear"},os={Cancel:3,Help:6,Backspace:8,Tab:9,"Pause/Break":19,"Caps Lock":20,Esc:27,Space:32,"Page Up":33,"Page Down":34,End:35,Home:36,Left:37,Up:38,Right:39,Down:40,Insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,"Numpad 0":96,"Numpad 1":97,"Numpad 2":98,"Numpad 3":99,"Numpad 4":100,"Numpad 5":101,"Numpad 6":102,"Numpad 7":103,"Numpad 8":104,"Numpad 9":105,"Numpad *":106,"Numpad +":107,"Numpad -":109,"Numpad .":110,"Numpad /":111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,"Num Lock":144,"Scroll Lock":145,";":186,",":188,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222,Kana:21,Eisu:22,Junja:23,Final:24,Hanja:25,Convert:28,Nonconvert:29,Accept:30,Modechange:31,Select:41,Print:42,Execute:43,Printscreen:44,Colon:58,Semicolon:59,"Less Than":60,Equals2:61,"Greater Than":62,"Question Mark":63,"Context Menu":93,Sleep:95,F13:124,F14:125,F15:126,F16:127,F17:128,F18:129,F19:130,F20:131,F21:132,F22:133,F23:134,F24:135,"Win Oem Fj Jisho":146,"Win Oem Fj Masshou":147,"Win Oem Fj Touroku":148,"Win Oem Fj Loya":149,"Win Oem Fj Roya":150,Circumflex:160,Exclamation:161,"Double Quote":162,Hash:163,Dollar:164,Percent:165,Ampersand:166,Underscore:167,"Open Paren":168,"Close Paren":169,Asterisk:170,Plus:171,Pipe:172,"Hyphen Minus":173,"Open Curly Bracket":174,"Close Curly Bracket":175,Tilde:176,"Volume Mute":181,"Volume Down":182,"Volume Up":183,Equals:187,Minus:189,"Win Ico Help":227,"Win Ico 00":228,"Win Ico Clear":230,"Win Oem Reset":233,"Win Oem Jump":234,"Win Oem Pa1":235,"Win Oem Pa2":236,"Win Oem Pa3":237,"Win Oem Wsctrl":238,"Win Oem Cusel":239,"Win Oem Attn":240,"Win Oem Finish":241,"Win Oem Copy":242,"Win Oem Auto":243,"Win Oem Enlw":244,"Win Oem Backtab":245,Attn:246,Crsel:247,Exsel:248,Ereof:249,Play:250,Zoom:251,Pa1:253,"Win Oem Clear":254};function _e(f,p){return JSON.parse(JSON.stringify(f,p))}function Bi(f){let p,t,e;if(!f||typeof f!="object"&&!Array.isArray(f))return f;p=Array.isArray(f)?[]:{};for(e in f)f.hasOwnProperty(e)&&(t=f[e],p[e]=t&&(typeof t=="object"||Array.isArray(t))?Bi(t):t);return p}function Di(f,p,t){if(f.setSelectionRange)f.focus(),f.setSelectionRange(p,t);else if(f.createTextRange){let e=f.createTextRange();e.collapse(!0),e.moveEnd("character",t),e.moveStart("character",p),e.select()}}function as(f){!f||f.value.length===0||(f.setSelectionRange?(f.focus(),f.setSelectionRange(0,f.value.length)):f.select())}CanvasRenderingContext2D.prototype.fillRoundedRect=function(f,p,t,e,s){this.beginPath(),this.moveTo(f+s,p),this.lineTo(f+t-s,p),this.quadraticCurveTo(f+t,p,f+t,p+s),this.lineTo(f+t,p+e-s),this.quadraticCurveTo(f+t,p+e,f+t-s,p+e),this.lineTo(f+s,p+e),this.quadraticCurveTo(f,p+e,f,p+e-s),this.lineTo(f,p+s),this.quadraticCurveTo(f,p,f+s,p),this.closePath(),this.fill()};CanvasRenderingContext2D.prototype.strokeRoundedRect=function(f,p,t,e,s){this.beginPath(),this.moveTo(f+s,p),this.lineTo(f+t-s,p),this.quadraticCurveTo(f+t,p,f+t,p+s),this.lineTo(f+t,p+e-s),this.quadraticCurveTo(f+t,p+e,f+t-s,p+e),this.lineTo(f+s,p+e),this.quadraticCurveTo(f,p+e,f,p+e-s),this.lineTo(f,p+s),this.quadraticCurveTo(f,p,f+s,p),this.closePath(),this.stroke()};Object.keys||(Object.keys=function(f){if(f!==Object(f))throw new TypeError("Object.keys called on a non-object");let p=[],t;for(t in f)Object.prototype.hasOwnProperty.call(f,t)&&p.push(t);return p});Object.toType||(Object.toType=function(f){return{}.toString.call(f).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()});typeof String.prototype.startsWith!="function"&&(String.prototype.startsWith=function(f){return this.slice(0,f.length)==f});typeof String.prototype.endsWith!="function"&&(String.prototype.endsWith=function(f){return this.slice(-f.length)==f});typeof String.prototype.splice!="function"&&(String.prototype.splice=function(f,p,t){return typeof t>"u"&&(t=0),this.slice(0,f)+p+this.slice(f+Math.abs(t))});typeof String.prototype.padStart!="function"&&(String.prototype.padStart=function(f){return typeof f=="number"&&(f=" ".repeat(f)),String(f+this).slice(-f.length)});typeof String.prototype.padEnd!="function"&&(String.prototype.padEnd=function(f){return typeof f=="number"?f<=this.length?this:(f=" ".repeat(f-this.length),this+f):f.length<=this.length?this:this+f.slice(-this.length)});String.prototype.replaceAll||(String.prototype.replaceAll=function(f,p){return Object.prototype.toString.call(f).toLowerCase()==="[object regexp]"?this.replace(f,p):this.replace(new RegExp(f,"g"),p)});typeof Uint8Array.prototype.charAt!="function"&&(Uint8Array.prototype.charAt=function(f){return String.fromCharCode(this[f])});typeof Uint8Array.prototype.charCodeAt!="function"&&(Uint8Array.prototype.charCodeAt=function(f){return this[f]});String.prototype.splitQuote=function(f,p,t,e){if(this.length===0)return[];if(!f||!f.length)return[this];p||(p=3),t||(t=3),e||(e="\\");let s=!1,n=!1,r=[],o=0,a=0,h,c="",g,m=f.length,b,u=this.length;for(;a<u;a++){if(h=this.charAt(a),h==='"'&&(p&2)===2)(t&2)===2?(a===0||c!==e)&&(s=!s):s=!s;else if(h==="'"&&(p&1)===1)(t&1)===1?(a===0||c!==e)&&(n=!n):n=!n;else if(!s&&!n){for(g=0;g<m;g++)if(b=f.charAt(g),h===b)if(a>o||a===0){r.push(this.substr(o,a-o)),o=a+1;break}else if(a===o){r.push(""),o=a+1;break}else a===u-1&&r.push("")}c=h}return a===u&&a===o&&f.indexOf(c)!==-1&&(r.push(""),o=a+1),a>o&&r.push(this.substr(o,a-o)),r};function Ni(f){let p,t=[];return p=Math.floor(f/(1e3*60*60*24)),f-=p*(1e3*60*60*24),p===1?t.push(p+" day"):p>0&&t.push(p+" days"),p=Math.floor(f/(1e3*60*60)),f-=p*(1e3*60*60),p===1?t.push(p+" hour"):p>0&&t.push(p+" hours"),p=Math.floor(f/(1e3*60)),f-=p*(1e3*60),p===1?t.push(p+" minute"):p>0&&t.push(p+" minutes"),p=Math.floor(f/1e3),f-=p*1e3,p===1?t.push(p+" second"):p>0&&t.push(p+" seconds"),t.length===0&&t.push("0 seconds"),t.join(", ")}function we(f,p){if(!f)return"";f=f.split(" ");let t,e,s,n=p?1:f.length;for(e=0;e<n;e++){let r=f[e].length;for(s=0;s<r;s++)if(t=f[e].charAt(s),t>="a"&&t<="z"||t>="A"&&t<="Z"){f[e]=f[e].substr(0,s)+t.toUpperCase()+f[e].substr(s+1).toLowerCase();break}}return f.join(" ")}function ti(f,p,t,e,s){if(typeof t>"u"&&(t=3),typeof e>"u"&&(e=0),typeof s>"u"&&(s="\\"),!f||f.length===0)return[];if(!p||p.length===0)return[f];p=p.split("");let n=!1,r=!1,o=[],a=0,h=0,c=f.length,g;for(;h<c;h++)if(g=f.charAt(h),g==='"'&&(t&2)===2)(e&2)===2&&h>0?h-1>0&&f.charAt(h-1)!==s&&(n=!n):n=!n;else if(g==="'"&&(t&1)===1)(e&1)===1&&h>0?h-1>0&&f.charAt(h-1)!==s&&(r=!r):r=!r;else if(!r&&!n){let m=p.length;for(let b=0;b<m;b++)if(g===p[b])if(h>a||h===0){o.push(f.substring(a,h)),a=h+1;break}else if(h===a){o.push(""),a=h+1;break}else h===c-1&&o.push("")}return h===c&&h===a&&p.indexOf(f.charAt(h-1))>-1&&(o.push(""),a=h+1),h>a&&o.push(f.substring(a,h)),o}function hs(f){if(!f)return 0;if(typeof f.selectionStart=="number")return f.selectionDirection=="backward"?f.selectionStart:f.selectionEnd;if(document.selection){f.focus();let p=document.selection.createRange();return p.moveStart("character",-f.value.length),p.text.length}return 0}var ge;function Ai(f){f=f||"",f=f.split("%^"),ge||Vs();let p=[],t=[],e=0,s=f.length,n=!1,r=!1,o=[];for(;e<s;e++)switch(f[e]){case"ITALIC":p.push("<em>"),t.push("</em>");break;case"UNDERLINE":o.push("underline");break;case"STRIKEOUT":o.push("strikeout");break;case"DBLUNDERLINE":o.push("dblunderline");break;case"OVERLINE":o.push("overline");break;case"FLASH":o.push("noflash");break;case"REVERSE":o.push("reverse");break;case"RESET":case"DEFAULT":let a=t.length;for(let h=0;h<a;h++)p.push(t[h]);t=[],o=[];break;case"BOLD":n=!0;break;case"":break;default:if(f[e].startsWith("B_")){f[e]=f[e].substr(2),n&&!r&&(p.push('<span style="border: inherit;text-decoration:inherit;color: #'+ge["BOLD%^%^WHITE"]+'">'),t.push("</span>")),p.push('<span style="border: inherit;text-decoration:inherit;background-color: #'+ge[f[e]]+'">'),t.push("</span>"),n=!1;continue}else if(ge[f[e]]){if(n&&!ge["BOLD%^%^"+f[e]])p.push('<span style="border: inherit;text-decoration:inherit;color: #'+ge["BOLD%^%^WHITE"]+'">'),t.push("</span>"),r=!0;else if(n){p.push('<span style="border: inherit;text-decoration:inherit;color: #'+ge["BOLD%^%^"+f[e]]+'">'),t.push("</span>"),r=!0;continue}p.push('<span style="border: inherit;text-decoration:inherit;color: #'+ge[f[e]]+'">'),t.push("</span>");continue}else n&&!r&&(p.push('<span style="border: inherit;text-decoration:inherit;color: #'+ge["BOLD%^%^WHITE"]+'">'),t.push("</span>"));o.length&&(p.push('<span class="'+o.join(" ")+'">'),t.push("</span>"),o=[]),p.push(f[e]),n=!1,r=!1;break}for(o.length&&(p.push('<span class="'+o.join(" ")+'">'),t.push("</span>")),e=0,s=t.length;e<s;e++)p.push(t[e]);return p.join("")}function Vs(){let f,p,t,e,s,n;for(ge={},ge.BLACK="000000",ge.RED="800000",ge.GREEN="008000",ge.ORANGE="808000",ge.BLUE="0000EE",ge.MAGENTA="800080",ge.CYAN="008080",ge.WHITE="BBBBBB",ge.mono11="808080",ge["BOLD%^%^RED"]="FF0000",ge["BOLD%^%^GREEN"]="00FF00",ge.YELLOW="FFFF00",ge["BOLD%^%^YELLOW"]="FFFF00",ge["BOLD%^%^BLUE"]="5C5CFF",ge["BOLD%^%^MAGENTA"]="FF00FF",ge["BOLD%^%^CYAN"]="00FFFF",ge["BOLD%^%^WHITE"]="FFFFFF",ge["BOLD%^%^BLACK"]="808080",t=0;t<6;t++)for(e=0;e<6;e++)for(s=0;s<6;s++)n=`RGB${t}${e}${s}`,p="",f=0,f=t*40+55,f<16&&(p+="0"),p+=f.toString(16),f=0,f=e*40+55,f<16&&(p+="0"),p+=f.toString(16),f=0,f=s*40+55,f<16&&(p+="0"),p+=f.toString(16),ge[n]||(ge[n]=p.toUpperCase());for(t=232;t<=255;t++)e=(t-232)*10+8,e<16?e="0"+e.toString(16).toUpperCase():e=e.toString(16).toUpperCase(),e=e+e+e,t<242?ge["mono0"+(t-232)]=e:ge["mono"+(t-232)]=e}function cs(){let f=[],p,t,e,s;for(p=0;p<6;p++)for(t=0;t<6;t++)for(e=0;e<6;e++)s=16+p*36+t*6+e,f[s]="rgb(",p>0?f[s]+=p*40+55:f[s]+="0",f[s]+=",",t>0?f[s]+=t*40+55:f[s]+="0",f[s]+=",",e>0?f[s]+=e*40+55:f[s]+="0",f[s]+=")";for(p=232;p<=255;p++)t=(p-232)*10+8,f[p]=["rgb(",t,",",t,",",t,")"].join("");return f[0]="rgb(0,0,0)",f[1]="rgb(128, 0, 0)",f[2]="rgb(0, 128, 0)",f[3]="rgb(128, 128, 0)",f[4]="rgb(0, 0, 238)",f[5]="rgb(128, 0, 128)",f[6]="rgb(0, 128, 128)",f[7]="rgb(187, 187, 187)",f[8]="rgb(128, 128, 128)",f[9]="rgb(255, 0, 0)",f[10]="rgb(0, 255, 0)",f[11]="rgb(255, 255, 0)",f[12]="rgb(92, 92, 255)",f[13]="rgb(255, 0, 255)",f[14]="rgb(0, 255, 255)",f[15]="rgb(255, 255, 255)",f[256]="rgb(0, 0, 0)",f[257]="rgb(118, 0, 0)",f[258]="rgb(0, 108, 0)",f[259]="rgb(145, 136, 0)",f[260]="rgb(0, 0, 167)",f[261]="rgb(108, 0, 108)",f[262]="rgb(0, 108, 108)",f[263]="rgb(161, 161, 161)",f[264]="rgb(0, 0, 0)",f[265]="rgb(128, 0, 0)",f[266]="rgb(0, 128, 0)",f[267]="rgb(128, 128, 0)",f[268]="rgb(0, 0, 238)",f[269]="rgb(128, 0, 128)",f[270]="rgb(0, 128, 128)",f[271]="rgb(187, 187, 187)",f[272]="rgb(0,0,0)",f[273]="rgb(0, 255, 255)",f[274]="rgb(0,0,0)",f[275]="rgb(255, 255, 0)",f[276]="rgb(0, 0, 0)",f[277]="rgb(229, 229, 229)",f[278]="rgb(205, 0, 0)",f[279]="rgb(229, 229, 229)",f[280]="rgb(255,255,255)",f}function Lt(f,p){return f&&(/^\d+c$/.test(f)?p?parseInt(f,10)*p+"px":f+"h":/^\d+$/.test(f)?parseInt(f,10)+"px":f)}function ot(f){return!f||f.length===0||!f.match(/^[a-zA-Z_$][a-zA-Z_$0-9]*$/g)?!1:["break","case","catch","continue","debugger","default","delete","do","else","finally","for","function","if","in","instanceof","new","return","switch","this","throw","try","typeof","var","void","while","with","class","const","enum","export","extends","import","super","implements","interface","let","package","private","protected","public","static","yield","null","true","false","NaN","Infinity","undefined","eval","arguments"].indexOf(f)===-1}function et(f,p){if(!f)return;let t=document.activeElement;if((!t||t!=f)&&f.focus(),!document.execCommand("insertText",!1,p)){var e=f.selectionStart,s=f.selectionEnd;f.value=f.value.substring(0,e)+p+f.value.substring(s,f.value.length),f.selectionStart=e,f.selectionEnd=e+p.length}t&&t!=f&&t.focus()}Array.isArray||(Array.isArray=function(f){return Object.prototype.toString.call(f)==="[object Array]"});var ns;function Ct(f){return window.TextDecoder!==void 0?(ns||(ns=new TextDecoder)).decode(new Uint8Array(f)):Ks(String.fromCharCode.apply(null,Array.prototype.slice.apply(new Uint8Array(f))))}function Ks(f){let p;try{return decodeURIComponent(escape(f))}catch(t){if(p=t,p instanceof URIError)return f;throw p}}function Js(f){let p,t,e,s,n,r;for(n=f.length,p=[],s=!1,e=r=0;0<=n?r<n:r>n;e=0<=n?++r:--r)if(t=String.prototype.charCodeAt.call(f,e),t>255){s=!0,p=null;break}else p.push(t);return s===!0?unescape(encodeURIComponent(f)):String.fromCharCode.apply(null,Array.prototype.slice.apply(p))}var rs;function at(f){let p,t,e,s,n,r;if(window.TextEncoder!==void 0)return(rs||(rs=new TextEncoder)).encode(f);for(p=Js(f),t=p.length,e=new ArrayBuffer(t),s=new Uint8Array(e),n=r=0;0<=t?r<t:r>t;n=0<=t?++r:--r)s[n]=String.prototype.charCodeAt.call(p,n);return s}function Gi(f){let p=document.createElement("textarea");return f&&(p.value=f,p.textContent=f),p.style.position="fixed",p.style.width="2em",p.style.height="2em",p.style.padding="0",p.style.border="none",p.style.outline="none",p.style.boxShadow="none",p.style.background="transparent",document.body.appendChild(p),p.focus(),p.select(),p}function Xe(f){return new Promise(function(p,t){try{if(typeof navigator<"u"&&typeof navigator.clipboard<"u"&&typeof navigator.permissions<"u"){let e=new Blob([f],{type:"text/plain"}),s=[new ClipboardItem({"text/plain":e})];navigator.permissions.query({name:"clipboard-write"}).then(function(n){n.state==="granted"||n.state==="prompt"?navigator.clipboard.write(s).then(p,t).catch(t):t(new Error("Permission not granted!"))})}else if(document.queryCommandSupported&&document.queryCommandSupported("copy")){let e=Gi(f);try{document.execCommand("copy"),document.body.removeChild(e),p(null)}catch(s){document.body.removeChild(e),t(s)}}else t(new Error("None of copying methods are supported by this browser!"))}catch(e){t(e)}})}function tt(){return new Promise(function(f,p){try{if(typeof navigator<"u"&&typeof navigator.clipboard<"u"&&typeof navigator.permissions<"u")navigator.permissions.query({name:"clipboard-read"}).then(function(t){t.state==="granted"||t.state==="prompt"?navigator.clipboard.readText().then(f,p).catch(p):p(new Error("Permission not granted!"))});else if(document.queryCommandSupported&&document.queryCommandSupported("paste")){let t=Gi();try{document.execCommand("paste",!1,null),f(t.value),document.body.removeChild(t)}catch(e){document.body.removeChild(t),p(e)}}else p(new Error("None of pasting methods are supported by this browser!"))}catch(t){p(t)}})}function ps(f,p){return new Promise(function(t,e){try{if(typeof navigator<"u"&&typeof navigator.clipboard<"u"&&typeof navigator.permissions<"u")navigator.permissions.query({name:"clipboard-read"}).then(function(s){s.state==="granted"||s.state==="prompt"?navigator.clipboard.read().then(n=>{n.length?(p&&!n[0].types.includes(f)&&(f=p),n[0].types.includes(f)?n[0].getType(f).then(r=>{t(r.text())}).catch(e):t("")):t("")}).catch(e):e(new Error("Permission not granted!"))});else if(document.queryCommandSupported&&document.queryCommandSupported("paste")){let s=Gi();try{document.execCommand("paste",!1,null),t(s.value),document.body.removeChild(s)}catch(n){document.body.removeChild(s),e(n)}}else e(new Error("None of pasting methods are supported by this browser!"))}catch(s){e(s)}})}function ht(){if(typeof navigator<"u"&&typeof navigator.clipboard<"u"&&typeof navigator.permissions<"u"||document.queryCommandSupported&&document.queryCommandSupported("paste"))return!0;let f=document.createElement("div");f.setAttribute("contenteditable","true"),document.body.appendChild(f),f.focus();let p=new ClipboardEvent("paste");f.dispatchEvent(p);let t=p.defaultPrevented;return document.body.removeChild(f),t}function Wi(f,p){if(!f)return null;p||(p=window.location.href),f=f.replace(/[[\]]/g,"\\$&");let t=new RegExp("[?&]"+f+"(=([^&#]*)|&|#|$)"),e=t.exec(p);return e?e[2]?decodeURIComponent(e[2].replace(/\+/g," ")):"":null}function Qs(){let f="download"in document.createElement("a"),p=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,t=window.URL||window.webkitURL||window.mozURL||window.msURL;navigator.saveBlob=navigator.saveBlob||navigator.msSaveBlob||navigator.mozSaveBlob||navigator.webkitSaveBlob,window.saveAs=window.saveAs||window.webkitSaveAs||window.mozSaveAs||window.msSaveAs;let e={"image/jpeg":!0,"image/png":!0,"image/gif":!0,"image/svg+xml":!0,"image/bmp":!0,"image/x-windows-bmp":!0,"image/webp":!0,"audio/wav":!0,"audio/mpeg":!0,"audio/webm":!0,"audio/ogg":!0,"video/mpeg":!0,"video/webm":!0,"video/ogg":!0,"text/plain":!0,"text/html":!0,"text/xml":!0,"application/xhtml+xml":!0,"application/json":!0};p&&(window.saveAs||navigator.saveBlob)?this.show=function(s,n,r){let o=new p;o.append(s);let a=o.getBlob(r||"application/octet-stream");n||(n="Download.bin"),window.saveAs?window.saveAs(a,n):navigator.saveBlob(a,n)}:p&&t?this.show=function(s,n,r){let o,a,h=new p;if(h.append(s),r||(r="application/octet-stream"),f){o=h.getBlob(r),a=t.createObjectURL(o);let c=document.createElement("a");c.setAttribute("href",a),c.setAttribute("download",n||"Download.bin");let g=document.createEvent("MouseEvents");g.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),c.dispatchEvent(g)}else e[r.split(";")[0]]===!0&&(r="application/octet-stream"),o=h.getBlob(r),a=t.createObjectURL(o),window.open(a,"_blank","");setTimeout(function(){t.revokeObjectURL(a)},250)}:Blob&&t?this.show=function(s,n,r){let o,a;if(r||(r="application/octet-stream"),o=new Blob([s],{type:r}),f){a=t.createObjectURL(o);let h=document.createElement("a");h.setAttribute("href",a),h.setAttribute("download",n||"Download.bin");let c=document.createEvent("MouseEvents");c.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),h.dispatchEvent(c)}else e[r.split(";")[0]]===!0&&(r="application/octet-stream"),a=t.createObjectURL(o),window.open(a,"_blank","");setTimeout(function(){t.revokeObjectURL(a)},250)}:/\bMSIE\b/.test(navigator.userAgent)||(this.show=function(s,n,r){r||(r="application/octet-stream"),e[r.split(";")[0]]===!0&&(r="application/octet-stream"),window.open("data:"+r+","+encodeURIComponent(s),"_blank","")})}window.fileSaveAs=new Qs;function _s(){let f,p;function t(e,s){let n=e.charCodeAt(p);if(!(n&128))f=n;else if((n&224)==192)f=(n&31)<<6|e.charCodeAt(p+1)&63,p+=1;else if((n&240)==224)f=(n&15)<<12|(e.charCodeAt(p+1)&63)<<6|e.charCodeAt(p+2)&63,p+=2;else if((n&248)==240)f=(n&7)<<18|(e.charCodeAt(p+1)&63)<<12|(e.charCodeAt(p+2)&63)<<6|e.charCodeAt(p+3)&63,p+=1;else return!1;return!0}this.decode=function(e){let s=new lt,n=e.length;for(p=0;p<n;p++)t(e,n)&&s.appendCode(f);return s.toString()},this.decode2=function(e){let s=new lt,n=e.length,r,o;for(r=0;r<n;r++){if(o=e.charCodeAt(r),o&128)if((o&224)==192)o=(o&31)<<6|e.charCodeAt(r+1)&63,r+=1;else if((o&240)==224)o=(o&15)<<12|(e.charCodeAt(r+1)&63)<<6|e.charCodeAt(r+2)&63,r+=2;else if((o&248)==240)o=(o&7)<<18|(e.charCodeAt(r+1)&63)<<12|(e.charCodeAt(r+2)&63)<<6|e.charCodeAt(r+3)&63,r+=1;else continue;s.appendCode(o)}return s.toString()}}window.UTF8=new _s;function ct(f){if(f===null||typeof f>"u")return f;let p,t,e=0;for(p=f.byteLength,t=new lt;e<p;e++)f[e]<32||f[e]>=127?t.append("<"+f[e]+">"):t.append(String.fromCharCode(f[e]));return t.toString()}function Zt(){let f=document.createElement("div");f.style.visibility="hidden",f.style.overflow="scroll",f.style.msOverflowStyle="scrollbar",document.body.appendChild(f);let p=document.createElement("div");f.appendChild(p);let t=f.offsetWidth-p.offsetWidth;return f.parentNode.removeChild(f),t}function Se(f,p,t){return new Promise((e,s)=>{let n=document.createElement("dialog");if(typeof n.showModal!="function"){s("Browser does not support dialogs.");return}n.id="openFileDialog",n.style.zIndex="2000",n.style.height="158px",n.style.width="350px",n.innerHTML=`<div class="dialog-header" style="font-weight: bold"><button type="button" class="btn btn-close float-end btn-danger" data-dismiss="modal" onclick="document.getElementById('openFileDialog').close();"></button><div>${f||"Open file..."}</div></div><div class="dialog-body"><div class="m-3"><input class="form-control" type="file" id="openFileDialog-files"${p?" multiple":""} required${t&&t.length?' accept="'+t+'"':""}></div></div><div class="dialog-footer"><button id="openFileDialog-cancel" style="float: right" type="button" class="btn btn-default" onclick="document.getElementById('openFileDialog').close();">Cancel</button><button id="openFileDialog-ok" style="float: right" type="button" class="btn btn-primary">Ok</button></div>`,document.body.appendChild(n),n.addEventListener("close",r=>{r.target===n&&(document.body.removeChild(n),n.returnValue!=="file-ok"&&s("closed"))}),n.addEventListener("cancel",r=>{r.target===n&&(document.body.removeChild(n),n.returnValue!=="file-ok"&&s("canceled"))}),document.getElementById("openFileDialog-ok").addEventListener("click",()=>{let r=document.getElementById("openFileDialog-files");if(!r.files||r.files.length===0){r.classList.add("is-invalid");return}r.classList.remove("is-invalid"),n.close(),n.returnValue="files-ok",e(r.files)}),n.showModal()})}function Ee(f,p){return new Promise((t,e)=>{f||e(new Error("Invalid file"));let s=new FileReader;s.onerror=e,s.onload=n=>{t(n.target.result)},s.readAsText(f),p&&(s.onprogress=p)})}var Ri={};function ve(f,p,t){t=t||"default",clearTimeout(Ri[t]),Ri[t]=setTimeout(()=>{f(),delete Ri[t]},p)}function pt(f,p){let t=p.getBoundingClientRect(),e=f.getBoundingClientRect();(t.top<e.top||t.bottom>e.bottom||t.left<e.left||t.right>e.right)&&p.scrollIntoView({behavior:"smooth",block:"nearest"})}function yt(f){return!!(window.matchMedia("(orientation: landscape) and (max-width: 641px)").matches||window.matchMedia("(orientation: landscape) and (max-height: 480px)").matches||window.matchMedia("(orientation: portrait) and (max-width: 480px)").matches||window.matchMedia(" (orientation: portrait) and (max-height: 641px)").matches||f&&/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Windows Phone/i.test(navigator.userAgent||navigator.vendor||window.opera))}function Oi(f,p){if(!f||!p||f.length!=p.length)return!1;for(var t=0,e=f.length;t<e;t++)if(Array.isArray(f[t])&&Array.isArray(p[t])){if(!Oi(f[t],p[t]))return!1}else if(f[t]instanceof Object&&p[t]instanceof Object){if(!ii(f[t],p[t]))return!1}else if(f[t]!==p[t])return!1;return!0}function ii(f,p){let t;if(f===p)return!0;if(f===null||p===null||Object.keys(f).length!==Object.keys(p).length)return!1;if(Array.isArray(f)||Array.isArray(p))return Oi(f,p);for(t in f){if(f.hasOwnProperty(t)!=p.hasOwnProperty(t))return!1;if(typeof f[t]!=typeof p[t])return!1}for(t in p){if(f.hasOwnProperty(t)!=p.hasOwnProperty(t))return!1;if(typeof f[t]!=typeof p[t])return!1;if(f.hasOwnProperty(t)){if(Array.isArray(f[t])&&Array.isArray(p[t])){if(!Oi(f[t],p[t]))return!1}else if(f[t]instanceof Object&&p[t]instanceof Object){if(!ii(f[t],p[t]))return!1}else if(f[t]!==p[t])return!1}}return!0}var fs=Mi(ds()),Yt=class extends me{constructor(t){super();this.Or=[];this.kl=!1;this.Ss=0;this.Br=0;this.Es=null;this.js=!1;this.yn=!0;this.Sl=!1;this.options={MCCP:!0,MXP:!0,NAWS:!0,MSDP:!0,GMCP:!0,MSSP:!1,ECHO:!0,TTYPE:!0,EOR:!0,NEWENVIRON:!1,ZMP:!1,ATCP:!1,CHARSET:!0};this.host="";this.port=23;this.prompt=!1;this.echo=!0;this.firstSent=!0;this.firstReceived=!0;this.server={NAWS:!1,MSDP:!1,GMCP:!1,MXP:!1,MCCP1:!1,MCCP2:!1,MSSP:!1,NEWENVIRON:!1,ZMP:!1,EOR:!1,ATCP:!1,CHARSET:!1};this.version="2.0";this.terminal="ansi";this.UTF8=!0;this.MSSP={};this.socket=null;this.latency=0;this.latencyAvg=null;this.enableLatency=!1;this.enablePing=!1;this.GMCPSupports=["Core 1"];this.enableDebug=!1;this.scheme="ws://";this.protocol="binary";t&&("host"in t&&(t.host&&t.host.length&&(this.host=t.host),delete t.host),"port"in t&&(this.port=t.port,delete t.port),"scheme"in t&&(t.scheme&&t.scheme.length&&(this.scheme=t.scheme),delete t.scheme),"protocol"in t&&(t.protocol&&t.protocol.length&&(this.protocol=t.protocol),delete t.protocol)),this.options=Object.assign(this.options,t||{})}get connected(){return!this.socket||typeof this.socket>"u"?!1:this.kl}reset(){this.Ss=0,this.firstSent=!0,this.firstReceived=!0,this.prompt=!1,this.echo=!0,this.server={NAWS:!1,MSDP:!1,GMCP:!1,MXP:!1,MCCP1:!1,MCCP2:!1,MSSP:!1,EOR:!1,NEWENVIRON:!1,ATCP:!1,CHARSET:!1,ZMP:!1},this.Or=[],this.Va(),this.kl=!1,this.yn=!1,this.enableDebug&&this.emit("debug","Reset")}connect(){this.Io(),this.reset(),this.emit("connecting"),this.socket=this.Ka(this.host,this.port),this.enableDebug&&this.emit("debug","Connecting to "+this.host+":"+this.port)}close(){this.yn||(this.Io(),this.reset(),this.emit("close"),this.yn=!0,this.enableDebug&&this.emit("debug","Closed"))}receivedData(t,e,s){this.enableLatency&&(this.Es!==null?(this.latency=new Date().getTime()-this.Es.getTime(),this.latencyAvg==null?this.latencyAvg=this.latency:this.latencyAvg=(this.latency+this.latencyAvg)/2,this.Es=null,this.js=!1,this.emit("latency-changed",this.latency,this.latencyAvg)):!this.js&&this.enablePing?this.js=!0:(this.Es=null,this.js=!1)),this.enableDebug&&this.emit("debug","PreProcess:"+t,1),t=this.processData(t,e,!1,s),this.enableDebug&&this.emit("debug","PostProcess:"+t,1),this.emit("received-data",t),this.enableLatency&&(this.Or.length>0?(this.enablePing&&(this.js=!0),this.Es=null):this.js&&this.enablePing?setTimeout(()=>{this.Es=new Date,this.sendGMCP("Core.Ping "+this.latencyAvg)}):this.js=!1)}sendTerminal(){if(this.enableDebug&&(this.Ss===0?this.emit("debug","REPLY: <IAC><SB><TERMINALTYPE><IS>"+this.terminal+"<IAC><SE>"):this.Ss===1?this.emit("debug","REPLY: <IAC><SB><TERMINALTYPE><IS>ANSI-256COLOR<IAC><SE>"):this.Ss>=2&&this.emit("debug","REPLY: <IAC><SB><TERMINALTYPE><IS>MTTS 9<IAC><SE>")),this.Ss===0){let t=new Uint8Array(6+this.terminal.length);t.set([255,250,24,0],0),t.set(at(this.terminal),4),t.set([255,240],4+this.terminal.length),this.sendData(t,!0)}else this.Ss===1?this.sendData([255,250,24,0,65,78,83,73,45,50,53,54,67,79,76,79,82,255,240],!0):this.Ss>=2&&this.sendData([255,250,24,0,77,84,84,83,32,57,255,240],!0)}sendData(t,e){if(!(t==null||typeof t>"u"||t.length===0)){if(this.connected)try{e||(this.prompt=!1,t=this.El(t),this.enableLatency&&(this.Es=new Date)),this.socket!==null&&(t instanceof Uint8Array?(this.enableDebug&&this.emit("debug","sendDataU8:"+ct(t)),this.socket.send(t)):Array.isArray(t)?(this.enableDebug&&this.emit("debug","sendDataBA"+ct(new Uint8Array(t))),this.socket.send(new Uint8Array(t))):(this.enableDebug&&this.emit("debug","sendDataR:"+ct(at(t))),this.socket.send(t)),e||(this.firstSent=!1))}catch(s){this.emit("error",s)}else this.enableLatency&&(this.Es=null);this.emit("data-sent",t,e)}}processData(t,e,s,n){let r,o="",a;if(t==null||(e||(t=this.Ja(t)),r=t.byteLength,r===0))return t;a=this.Or,a.length>0&&(this.enableDebug&&this.emit("debug","Split buffer length: "+a.length,1),o=new Uint8Array(r+a.length),n?(o.set(t,0),o.set(a,t.byteLength)):(o.set(a,0),o.set(t,a.length)),t=o,a=[],r=t.byteLength);let h=0,c=0,g=new lt,m=this.prompt,b=0,u=0,E="",w="",L,k=0,R,B=0;o="",this.prompt=!1;let v="";try{for(;B<r;B++)switch(k=t[B],h){case 0:if(k===255)this.enableDebug&&(v="TELOP: <IAC>"),a.push(k),h=1;else if(this.UTF8||this.options.CHARSET&&this.server.CHARSET){if((k&128)===128&&B>=r-4){let O=0;if((k&192)===192?O=1:(k&224)===224?O=2:(k&240)===240&&(O=3),B+O>=r){a.push(...t.slice(B)),this.enableDebug&&(this.emit("debug","Unicode split length: "+O,1),this.emit("debug","Split buffer length: "+a.length,1));break}}g.appendCode(k)}else g.appendCode(k);break;case 1:if(k===255)this.enableDebug&&(this.emit("debug",v+"<IAC>"),v=""),g.appendCode(k),a=[],h=0;else if((!this.options.EOR||!this.server.EOR)&&k===239)this.enableDebug&&(this.emit("debug",v+"<NOP>"),v=""),a=[],h=0;else if(k===241||k===130)this.enableDebug&&(this.emit("debug",v+"<NOP>"),v=""),a=[],h=0;else if(k===249||k===239)this.enableDebug&&(k===239?this.emit("debug",v+"<EOR>"):this.emit("debug",v+"<GA>"),v=""),B+1<r&&r-B>2?(g.push(`
`),this.prompt=!1):this.prompt=!0,a=[],h=0;else if(k===253||k===254||k===251||k===252){if(this.enableDebug)switch(k){case 253:v+="<DO>";break;case 254:v+="<DONT>";break;case 251:v+="<WILL>";break;case 252:v+="<WONT>";break}a.push(k),b=k,h=2}else k===250?(this.enableDebug&&(v+="<SB>"),a.push(k),h=3):(this.enableDebug&&(v+=this.Xt(k)),a=[],h=0);break;case 2:k===1?(this.enableDebug&&(this.emit("debug",v+"<ECHO>"),v=""),b===253?this.options.ECHO?(this.enableDebug&&this.emit("debug","REPLY: <IAC><WILL><ECHO>"),this.replyToOption(k,251,b),this.echo=!1):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><ECHO>"),this.echo=!0,this.replyToOption(k,254,b)):b===254?(this.enableDebug&&this.emit("debug","REPLY: <IAC><WONT><ECHO>"),this.replyToOption(k,252,b),this.echo=!0):b===251?this.options.ECHO?(this.enableDebug&&this.emit("debug","REPLY: <IAC><DO><ECHO>"),this.replyToOption(k,253,b),this.echo=!1):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><ECHO>"),this.echo=!0,this.replyToOption(k,254,b)):b===252&&(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><ECHO>"),this.echo=!0,this.replyToOption(k,254,b)),h=0,a=[]):k===24?(this.enableDebug&&(this.emit("debug",v+"<TERMINALTYPE>"),v=""),b===253?this.options.TTYPE?(this.enableDebug&&this.emit("debug","REPLY: <IAC><WILL><TERMINALTYPE>"),this.replyToOption(k,251,b)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><TERMINALTYPE>"),this.replyToOption(k,254,b)):b===254?(this.enableDebug&&this.emit("debug","REPLY: <IAC><WONT><TERMINALTYPE>"),this.replyToOption(k,252,b)):b===251?this.options.TTYPE?(this.enableDebug&&this.emit("debug","REPLY: <IAC><DO><TERMINALTYPE>"),this.replyToOption(k,253,b)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><TERMINALTYPE>"),this.replyToOption(k,254,b)):b===252&&(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><TERMINALTYPE>"),this.replyToOption(k,254,b)),h=0,a=[]):k===25?(this.enableDebug&&(this.emit("debug",v+"<ENDOFRECORD>"),v=""),b===253?(this.server.EOR=!0,this.options.EOR?(this.enableDebug&&this.emit("debug","REPLY: <IAC><WILL><ENDOFRECORD>"),this.replyToOption(k,251,b)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><ENDOFRECORD>"),this.replyToOption(k,254,b))):b===254?(this.enableDebug&&this.emit("debug","REPLY: <IAC><WONT><ENDOFRECORD>"),this.replyToOption(k,252,b)):b===251?(this.server.EOR=!0,this.options.EOR?(this.enableDebug&&this.emit("debug","REPLY: <IAC><DO><ENDOFRECORD>"),this.replyToOption(k,253,b)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><ENDOFRECORD>"),this.replyToOption(k,254,b))):b===252&&(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><ENDOFRECORD>"),this.replyToOption(k,254,b)),h=0,a=[]):k===31?(this.enableDebug&&(this.emit("debug",v+"<NAWS>"),v=""),b===253?(this.server.NAWS=!0,this.options.NAWS?(this.enableDebug&&this.emit("debug","REPLY: <IAC><WILL><NAWS>"),this.replyToOption(k,251,b)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><NAWS>"),this.replyToOption(k,254,b))):b===254?(this.server.NAWS=!1,this.enableDebug&&this.emit("debug","REPLY: <IAC><WONT><NAWS>"),this.replyToOption(k,252,b)):b===251?(this.server.NAWS=!0,this.options.NAWS?(this.enableDebug&&this.emit("debug","REPLY: <IAC><DO><NAWS>"),this.replyToOption(k,253,b)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><NAWS>"),this.replyToOption(k,254,b))):b===252&&(this.server.NAWS=!1,this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><NAWS>"),this.replyToOption(k,254,b)),this.emit("windowSize"),h=0,a=[]):k===36||k===39?(this.enableDebug&&(this.emit("debug",v+"<NEWENVIRON>"),v=""),b===253?(this.server.NEWENVIRON=!0,this.options.NEWENVIRON?(this.enableDebug&&this.emit("debug","REPLY: <IAC><WILL><NEWENVIRON>"),this.replyToOption(k,251,b)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><NEWENVIRON>"),this.replyToOption(k,254,b))):b===254?(this.enableDebug&&this.emit("debug","REPLY: <IAC><WONT><NEWENVIRON>"),this.replyToOption(k,252,b)):b===251?(this.server.NEWENVIRON=!0,this.options.NEWENVIRON?(this.enableDebug&&this.emit("debug","REPLY: <IAC><DO><NEWENVIRON>"),this.replyToOption(k,253,b)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><NEWENVIRON>"),this.replyToOption(k,254,b))):b===252&&(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><NEWENVIRON>"),this.replyToOption(k,254,b)),h=0,a=[]):k===69?(this.enableDebug&&(this.emit("debug",v+"<MSDP>"),v=""),b===253?(this.server.MSDP=!0,this.options.MSDP?(this.enableDebug&&this.emit("debug","REPLY: <IAC><WILL><MSDP>"),this.replyToOption(k,251,b)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><MSDP>"),this.replyToOption(k,254,b))):b===254?(this.server.MSDP=!1,this.enableDebug&&this.emit("debug","REPLY: <IAC><WONT><MSDP>"),this.replyToOption(k,252,b)):b===251?(this.server.MSDP=!0,this.options.MSDP?(this.enableDebug&&this.emit("debug","REPLY: <IAC><DO><MSDP>"),this.replyToOption(k,253,b)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><MSDP>"),this.replyToOption(k,254,b))):b===252&&(this.server.MSDP=!1,this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><MSDP>"),this.replyToOption(k,254,b)),h=0,a=[]):k===70?(this.enableDebug&&(this.emit("debug",v+"<MSSP>"),v=""),b===253?(this.server.MSSP=!0,this.options.MSSP?(this.enableDebug&&this.emit("debug","REPLY: <IAC><WILL><MSSP>"),this.replyToOption(k,251,b)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><MSSP>"),this.replyToOption(k,254,b))):b===254?(this.server.MSSP=!1,this.enableDebug&&this.emit("debug","REPLY: <IAC><WONT><MSSP>"),this.replyToOption(k,252,b)):b===251?(this.server.MSSP=!0,this.options.MSSP?(this.enableDebug&&this.emit("debug","REPLY: <IAC><DO><MSSP>"),this.replyToOption(k,253,b)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><MSSP>"),this.replyToOption(k,254,b))):b===252&&(this.server.MSSP=!1,this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><MSSP>"),this.replyToOption(k,254,b)),h=0,a=[]):k===85?(this.enableDebug&&(this.emit("debug",v+"<MCCP1>"),v=""),b===253?(this.server.MCCP1=!0,this.options.MCCP?(this.enableDebug&&this.emit("debug","REPLY: <IAC><WILL><MCCP1>"),this.replyToOption(k,251,b)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><MCCP1>"),this.replyToOption(k,254,b))):b===254?(this.server.MCCP1=!1,this.enableDebug&&this.emit("debug","REPLY: <IAC><WONT><MCCP1>"),this.replyToOption(k,252,b)):b===251?(this.server.MCCP1=!0,this.options.MCCP?(this.enableDebug&&this.emit("debug","REPLY: <IAC><DO><MCCP1>"),this.replyToOption(k,253,b)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><MCCP1>"),this.replyToOption(k,254,b))):b===252&&(this.server.MCCP1=!1,this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><MCCP1>"),this.replyToOption(k,254,b)),h=0,a=[]):k===86?(this.enableDebug&&(this.emit("debug",v+"<MCCP2>"),v=""),b===253?(this.server.MCCP2=!0,this.options.MCCP?(this.enableDebug&&this.emit("debug","REPLY: <IAC><WILL><MCCP2>"),this.replyToOption(k,251,b)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><MCCP2>"),this.replyToOption(k,254,b))):b===254?(this.server.MCCP2=!1,this.enableDebug&&this.emit("debug","REPLY: <IAC><WONT><MCCP2>"),this.replyToOption(k,252,b)):b===251?(this.server.MCCP2=!0,this.options.MCCP?(this.enableDebug&&this.emit("debug","REPLY: <IAC><DO><MCCP2>"),this.replyToOption(k,253,b)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><MCCP2>"),this.replyToOption(k,254,b))):b===252&&(this.server.MCCP2=!1,this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><MCCP2>"),this.replyToOption(k,254,b)),h=0,a=[]):k===91?(this.enableDebug&&(this.emit("debug",v+"<MXP>"),v=""),b===253?(this.server.MXP=!0,this.options.MXP?(this.enableDebug&&this.emit("debug","REPLY: <IAC><WILL><MXP>"),this.replyToOption(k,251,b)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><MXP>"),this.replyToOption(k,254,b))):b===254?(this.server.MXP=!1,this.enableDebug&&this.emit("debug","REPLY: <IAC><WONT><MXP>"),this.replyToOption(k,252,b)):b===251?(this.server.MXP=!0,this.options.MXP?(this.enableDebug&&this.emit("debug","REPLY: <IAC><DO><MXP>"),this.replyToOption(k,253,b)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><MXP>"),this.replyToOption(k,254,b))):b===252&&(this.server.MXP=!1,this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><MXP>"),this.replyToOption(k,254,b)),h=0,a=[]):k===130||k===241?(this.enableDebug&&(this.emit("debug",v+"<NOP>"),v=""),this.Pi(k,b,""),a=[],h=0):k===201?(this.enableDebug&&(this.emit("debug",v+"<GMCP>"),v=""),b===253?(this.server.GMCP=!0,this.options.GMCP?(this.enableDebug&&this.emit("debug","REPLY: <IAC><WILL><GMCP>"),this.replyToOption(k,251,b),this.Co()):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><GMCP>"),this.replyToOption(k,254,b))):b===254?(this.server.GMCP=!1,this.enableDebug&&this.emit("debug","REPLY: <IAC><WONT><GMCP>"),this.replyToOption(k,252,b)):b===251?(this.server.GMCP=!0,this.options.GMCP?(this.enableDebug&&this.emit("debug","REPLY: <IAC><DO><GMCP>"),this.replyToOption(k,253,b),this.Co()):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><GMCP>"),this.replyToOption(k,254,b))):b===252&&(this.server.GMCP=!1,this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><GMCP>"),this.replyToOption(k,254,b)),h=0,a=[]):k===42?(this.enableDebug&&(this.emit("debug",v+"<CHARSET>"),v=""),b===253?(this.server.CHARSET=!0,this.options.CHARSET?(this.enableDebug&&this.emit("debug","REPLY: <IAC><WILL><CHARSET>"),this.replyToOption(k,251,b)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><CHARSET>"),this.replyToOption(k,254,b))):b===254?(this.server.CHARSET=!1,this.enableDebug&&this.emit("debug","REPLY: <IAC><WONT><CHARSET>"),this.replyToOption(k,252,b)):b===251?(this.server.CHARSET=!0,this.options.CHARSET?(this.enableDebug&&this.emit("debug","REPLY: <IAC><DO><CHARSET>"),this.replyToOption(k,253,b)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><CHARSET>"),this.replyToOption(k,254,b))):b===252&&(this.server.CHARSET=!1,this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><CHARSET>"),this.replyToOption(k,254,b)),h=0,a=[]):(this.enableDebug&&(this.emit("debug",v+this.Xt(k)),v=""),b===251||b===252?(this.enableDebug&&this.emit("debug","REPLY: <IAC><DONT><"+k+">"),this.replyToOption(k,254,b)):(b===254||b===253)&&(this.enableDebug&&this.emit("debug","REPLY: <IAC><WONT><"+k+">"),this.replyToOption(k,252,b)),h=0,a=[]);break;case 3:u=k,k===24?(this.enableDebug&&(v+="<TERMINALTYPE>"),a.push(k),u=k,h=4):k===36||k===39?(this.enableDebug&&(v+="<NEWENVIRON>"),a.push(k),u=k,h=12,R=-1):k===69?(this.enableDebug&&(v+="<MSDP>"),a.push(k),u=k,h=4):k===70?(this.enableDebug&&(v+="<MSSP>"),a.push(k),u=k,h=8,L={}):k===85||k===86?(this.enableDebug&&(v+=k===85?"<MCCP1>":"<MCCP2>"),a.push(k),u=k,h=11):k===201?(this.enableDebug&&(v+="<GMCP>"),a.push(k),u=k,h=7):k===240?(this.enableDebug&&(this.emit("debug",v+"<SE>"),v=""),o=Ct(a.slice(1,a.length-4)),this.Pi(u,250,o),o=null,h=0,a=[]):k===42?(this.enableDebug&&(v+="<CHARSET>"),a.push(k),u=k,h=17,E=""):(this.enableDebug&&(v+=this.Xt(k)),a.push(k));break;case 4:u===24&&k===1?(this.enableDebug&&(v+="<SEND>"),a.push(k),b=1):k===240?(this.enableDebug&&(this.emit("debug",v+"<SE>"),v=""),u===24&&b===1&&(o=!1,this.Pi(u,250,""),o||(this.sendTerminal(),this.sendTerminal(),this.Ss++)),h=0,a=[]):u===69&&k===1?(this.enableDebug&&(v+="<MSDP_VAR>"),a.push(k),w="",h=5):(this.enableDebug&&(v+=this.Xt(k)),a.push(k));break;case 5:k===2?(this.enableDebug&&(v+="<MSDP_VAL>"),a.push(k),E="",h=6):(this.enableDebug&&(v+=this.Xt(k)),w+=String.fromCharCode(k),a.push(k));break;case 6:k===255?(this.enableDebug&&(v+="<IAC>"),a.push(k)):k===1?(this.enableDebug&&(v+="<MSDP_VAR>"),this.To(w,E),E="",w="",a.push(k),h=5):k===240?(this.enableDebug&&(this.emit("debug",v+"<SE>"),v=""),o=Ct(a.slice(1,a.length-4)),this.Pi(u,250,o),o=null,this.To(w,E),E="",w="",h=0,a=[]):(this.enableDebug&&(v+=this.Xt(k)),E+=String.fromCharCode(k),a.push(k));break;case 7:k===255?(this.enableDebug&&(v+="<IAC>"),a.push(k)):k===240?(this.enableDebug&&(this.emit("debug",v+"<SE>"),v=""),o=Ct(a.slice(1,a.length-4)),this.Pi(u,250,o),o=null,this.Mo(E),h=0,E="",a=[]):(this.enableDebug&&(v+=this.Xt(k)),E+=String.fromCharCode(k),a.push(k));break;case 8:k===255?(this.enableDebug&&(v+="<IAC>"),a.push(k)):k===240?(this.enableDebug&&(this.emit("debug",v+"<SE>"),this.emit("debug",this.MSSP),v=""),o=Ct(a.slice(1,a.length-4)),this.Pi(u,250,o),o=null,this.emit("receive-MSSP",L),E="",w="",L=0,h=0,a=[]):k===1?(this.enableDebug&&(v+="<MSSP_VAR>"),a.push(k),w="",h=9):(this.enableDebug&&(v+=this.Xt(k)),a.push(k));break;case 9:k===255?(this.enableDebug&&(v+="<IAC>"),a.push(k),h=8):k===1?(this.enableDebug&&(v+="<MSSP_VAR>"),a.push(k),w=""):k===2?(this.enableDebug&&(v+="<MSSP_VAL>"),a.push(k),this.MSSP[w]="",L[w]="",h=10):(this.enableDebug&&(v+=this.Xt(k)),w+=String.fromCharCode(k),a.push(k));break;case 10:k===255?(this.enableDebug&&(v+="<IAC>"),a.push(k),h=8):k===1?(this.enableDebug&&(v+="<MSSP_VAR>"),a.push(k),w="",h=9):k===2?(this.enableDebug&&(v+="<MSSP_VAL>"),a.push(k),this.MSSP[w]="",L[w]=""):(this.enableDebug&&(v+=this.Xt(k)),this.MSSP[w]+=String.fromCharCode(k),L[w]+=String.fromCharCode(k),a.push(k));break;case 11:k===255?(this.enableDebug&&(v+="<IAC>"),a.push(k)):k===240&&(this.enableDebug&&(this.emit("debug",v+"<SE>"),v=""),this.Pi(u,86,""),this.Qa(),h=0,a=[],B<r-1&&g.append(this.processData(t.subarray(B+1),e,!0)),B=r);break;case 12:k===255?(this.enableDebug&&(v+="<IAC>"),a.push(k)):k===240?(this.enableDebug&&(this.emit("debug",v+"<SE>"),v=""),o=Ct(a.slice(1,a.length-4)),this.Pi(u,250,o),o=null,this.Mo(E),h=0,E="",a=[]):k===0?(this.enableDebug&&(v+="<IS>"),a.push(k),h=13,b=k):k===1?(this.enableDebug&&(v+="<SEND>"),a.push(k),h=13,b=k):k===2?(this.enableDebug&&(v+="<SEND>"),a.push(k),h=13,b=k):(this.enableDebug&&(v+=this.Xt(k)),E+=String.fromCharCode(k),a.push(k));break;case 13:k===0?(this.enableDebug&&(v+="<VAR>"),a.push(k),h=14,b=k,w="",R===-1&&(R=0)):k===1?(this.enableDebug&&(v+="<VALUE>"),a.push(k),h=13,b=k,R===-1&&(R=1)):k===3?(this.enableDebug&&(v+="<USERVAR>"),a.push(k),h=13,b=k):k===255?(this.enableDebug&&(v+="<IAC>"),a.push(k)):k===240?(this.enableDebug&&(this.emit("debug",v+"<SE>"),v=""),o=Ct(a.slice(1,a.length-4)),o=this.Pi(u,250,o),this.emit("receive-NEWENVIRON",E),o||(this.enableDebug&&this.emit("debug","REPLY: <IAC><SB><NEWENVIRON><IS><IAC><SE>"),this.sendData(new Uint8Array([255,250]),!0),this.sendData(u,!0),this.sendData(new Uint8Array([0,255,240]),!0)),h=0,E="",a=[]):(this.enableDebug&&(v+=this.Xt(k)),E+=String.fromCharCode(k),a.push(k));break;case 14:k===2?(this.enableDebug&&(v+=this.Xt(k)),a.push(k),h=15,c=14):k===255||k<=3?(B--,h=13):(this.enableDebug&&(v+=this.Xt(k)),w+=String.fromCharCode(k),a.push(k));break;case 15:this.enableDebug&&(v+=this.Xt(k)),c===16?E+=String.fromCharCode(k):w+=String.fromCharCode(k),h=c,a.push(k);break;case 16:break;case 17:k===1?(this.enableDebug&&(v+="<REQUEST>"),a.push(k),h=18,E=""):k===255?(this.enableDebug&&(v+="<IAC>"),a.push(k)):k===240?(this.enableDebug&&(this.emit("debug",v+"<SE>"),v=""),o=this.Pi(u,250,E),this.emit("receive-CHARSET",E),o||(this.enableDebug&&this.emit("debug","REPLY: <IAC><SB><CHARSET><REJECTED><IAC><SE>"),this.sendData(new Uint8Array([255,250,42,3,255,240]),!0)),h=0,E="",a=[]):(this.enableDebug&&(v+=this.Xt(k)),E+=String.fromCharCode(k),a.push(k));break;case 18:k===255?(this.enableDebug&&(v+="<IAC>"),a.push(k)):k===240?(this.enableDebug&&(this.emit("debug",v+"<SE>"),v=""),o=this.Pi(u,250,E),this.emit("receive-CHARSET",E.slice(1)),o||(this.options.CHARSET&&E.slice(1).toLowerCase()==="utf-8"?(this.server.CHARSET=!0,this.enableDebug&&this.emit("debug","REPLY: <IAC><SB><ACCEPTED>UTF-8<IAC><SE>"),this.sendData(new Uint8Array([255,250,42,2]),!0),this.sendData("UTF-8",!0),this.sendData(new Uint8Array([255,240]),!0)):(this.enableDebug&&this.emit("debug","REPLY: <IAC><SB><CHARSET><REJECTED><IAC><SE>"),this.sendData(new Uint8Array([255,250,42,3,255,240]),!0))),h=0,E="",a=[]):(this.enableDebug&&(v+=this.Xt(k)),E+=String.fromCharCode(k),a.push(k));break}}catch(O){this.emit("error",O)}return this.enableDebug&&(v.length>0&&this.emit("debug",v),this.emit("debug","Post Split buffer length: "+a.length,1),this.emit("debug","PostSplit buffer  "+ct(new Uint8Array(a)),1)),m&&g.length>0?g.prepend(`
`):m&&(this.prompt=!0),g.length>0&&(this.firstReceived=!1),this.Or=a,s?g:this.UTF8||this.options.CHARSET&&this.server.CHARSET?UTF8.decode2(g.toString()):g.toString()}replyToOption(t,e,s,n){return typeof n>"u"&&(n=""),this.Pi(t,s,n)?!1:(this.sendData(new Uint8Array([255,e,t]),!0),!0)}updateWindow(t,e){if(!(e<1||t<1||!this.connected||!this.server.NAWS))try{let s,n,r,o,a=Math.floor;s=a(t/256),s>256&&(s=255),n=t%256,r=a(e/256),r>256&&(r=255),o=e%256,this.enableDebug&&this.emit("debug","REPLY: <IAC><SB><NAWS><"+s+"><"+n+"><"+r+"><"+o+"><IAC><SE>"),this.sendData(new Uint8Array([255,250,31,s,n,r,o,255,240]),!0)}catch(s){this.emit("error",{message:"UpdateWindow Error: "+s,err:s})}}sendGMCP(t){this.connected&&this.server.GMCP&&(this.enableDebug&&this.emit("debug","REPLY: <IAC><SB><GMCP>"+this.El(t).toString("binary")+"<IAC><SE>"),this.sendData(new Uint8Array([255,250,201]),!0),this.sendData(this.El(t),!0),this.sendData(new Uint8Array([255,240]),!0))}Co(){this.server.GMCP&&(this.enableDebug&&this.emit("debug",'REPLY: <IAC><SB><GMCP>Core.Hello { "client": "'+this.terminal+'", "version": "'+this.version+'" }<IAC><SE>'),this.sendData(new Uint8Array([255,250,201]),!0),this.sendData('Core.Hello { "client": "'+this.terminal+'", "version": "'+this.version+'" }',!0),this.sendData(new Uint8Array([255,240]),!0),this.sendData(new Uint8Array([255,250,201]),!0),this.GMCPSupports.length>0?(this.GMCPSupports.indexOf("Core 1")===-1&&this.GMCPSupports.unshift("Core 1"),this.enableDebug&&this.emit("debug","REPLY: <IAC><SB><GMCP>"+JSON.stringify(this.GMCPSupports)+"<IAC><SE>"),this.sendData("Core.Supports.Set "+JSON.stringify(this.GMCPSupports))):(this.enableDebug&&this.emit("debug",'REPLY: <IAC><SB><GMCP>Core.Supports.Set [ "Core 1" ]<IAC><SE>'),this.sendData('Core.Supports.Set [ "Core 1" ]',!0)),this.sendData(new Uint8Array([255,240]),!0))}Qa(){this.Sl=!0}Va(){this.Sl=!1,this.Br=0}Ja(t){return this.Sl?(this.Br||(this.Br=new fs.Zlib.InflateStream),this.enableDebug&&this.emit("debug","Pre decompress:"+ct(t),1),t=this.Br.decompress(t),this.enableDebug&&this.emit("debug","Post decompress:"+ct(t),1),new Uint8Array(t)):t}El(t){if(t==null||typeof t>"u")return t;let e,s,n=0,r,o;if(t instanceof Uint8Array){for(e=t.byteLength,s=new lt;n<e;n++)s.appendCode(t[n]),t[n]===255?s.appendCode(255):t[n]===13&&e===1?s.append(`\r
`):t[n]===10&&e===1&&s.append("\r\0");return s.toString()}for(e=t.length,s=new lt;n<e;n++)o=t.charAt(n),r=t.charCodeAt(n),s.append(o),r===255?s.append(o):r===13&&e===1?s.append(`\r
`):r===10&&e===1&&s.append("\r\0");return s.toString()}Ka(t,e){let s;try{let n=/^[a-z0-9]+:\/\//.test(t);return n&&e>0?s=new WebSocket(t+":"+e,this.protocol||"binary"):n?s=new WebSocket(t,this.protocol||"binary"):t&&e>0?s=new WebSocket((this.scheme||"ws://")+t+":"+e,this.protocol||"binary"):t&&(s=new WebSocket((this.scheme||"ws://")+t,this.protocol||"binary")),s.binaryType="arraybuffer",s.onclose=r=>{r.code===1006&&r.type==="close"&&!this.yn?this.close():r.code!==1e3&&!this.yn&&(this.emit("error",{message:"Closed due to transmission error",err:r}),this.close())},s.onopen=()=>{this.kl=!0,this.emit("connect")},s.onmessage=r=>{if(r.data instanceof ArrayBuffer){let o=new Uint8Array(r.data);this.enableDebug&&this.emit("debug","Data ArrayBuffer received:"+ct(o)),this.receivedData(o)}else if(r.data instanceof Blob){let o=new FileReader;o.onloadend=()=>{let a=new Uint8Array(o.result);this.receivedData(a),this.enableDebug&&this.emit("debug","Data Blob received:"+ct(o.result))},o.readAsArrayBuffer(r.data)}else this.enableDebug&&this.emit("debug","Data received:"+r.data),this.receivedData(r.data)},s.onerror=r=>{this.yn||this.emit("error",r)},s}catch(n){this.emit("error",n)}return null}Io(){if(!(!this.socket||this.socket==null)){try{this.socket.onopen=function(){},this.socket.onclose=function(){},this.socket.onmessage=function(){},this.socket.onerror=function(){},this.connected&&this.socket.close(),delete this.socket}catch(t){this.emit("error",t)}this.socket=null}}Pi(t,e,s){let n={telnet:this,option:t,verb:250,value:s,handled:!1};return this.emit("received-option",n),n.handled}To(t,e){let s={telnet:this,variable:t,value:e,handled:!1};return this.emit("received-MSDP",s),s.handled}Mo(t){let e={telnet:this,value:t,handled:!1};return this.emit("received-GMCP",e),e.handled}Xt(t){return t<32||t>=127?"<"+t+">":String.fromCharCode(t)}};window.telnet=new Yt;var Rt=(m=>(m[m.None=0]="None",m[m.Bold=1]="Bold",m[m.Faint=2]="Faint",m[m.Underline=4]="Underline",m[m.Italic=3]="Italic",m[m.Slow=5]="Slow",m[m.Rapid=6]="Rapid",m[m.Inverse=7]="Inverse",m[m.Hidden=8]="Hidden",m[m.Strikeout=9]="Strikeout",m[m.DoubleUnderline=21]="DoubleUnderline",m[m.Overline=53]="Overline",m))(Rt||{}),jt=(A=>(A[A.ErrorBackground=-12]="ErrorBackground",A[A.ErrorText=-11]="ErrorText",A[A.InfoBackground=-8]="InfoBackground",A[A.InfoText=-7]="InfoText",A[A.LocalEcho=-3]="LocalEcho",A[A.LocalEchoBack=-4]="LocalEchoBack",A[A.Reset=0]="Reset",A[A.Bold=1]="Bold",A[A.Faint=2]="Faint",A[A.Italic=3]="Italic",A[A.Underline=4]="Underline",A[A.Blink=5]="Blink",A[A.BlinkRapid=6]="BlinkRapid",A[A.Reverse=7]="Reverse",A[A.Hidden=8]="Hidden",A[A.StrikeThrough=9]="StrikeThrough",A[A.DoubleUnderline=21]="DoubleUnderline",A[A.BoldOff=22]="BoldOff",A[A.ItalicOff=23]="ItalicOff",A[A.UnderlineOff=24]="UnderlineOff",A[A.BlinkOff=25]="BlinkOff",A[A.BlinkRapidOff=26]="BlinkRapidOff",A[A.ReverseOff=27]="ReverseOff",A[A.Visible=28]="Visible",A[A.StrikeThroughOff=29]="StrikeThroughOff",A[A.Black=30]="Black",A[A.Red=31]="Red",A[A.Green=32]="Green",A[A.Yellow=33]="Yellow",A[A.Blue=34]="Blue",A[A.Magenta=35]="Magenta",A[A.Cyan=36]="Cyan",A[A.White=37]="White",A[A.DefaultFore=39]="DefaultFore",A[A.BlackBackground=40]="BlackBackground",A[A.RedBackground=41]="RedBackground",A[A.GreenBackground=42]="GreenBackground",A[A.YellowBackground=43]="YellowBackground",A[A.BlueBackground=44]="BlueBackground",A[A.MagentaBackground=45]="MagentaBackground",A[A.CyanBackground=46]="CyanBackground",A[A.WhiteBackground=47]="WhiteBackground",A[A.DefaultBack=49]="DefaultBack",A[A.Subscript=74]="Subscript",A[A.Superscript=73]="Superscript",A[A.SubSuperOff=75]="SubSuperOff",A[A.XBlack=90]="XBlack",A[A.XRed=91]="XRed",A[A.XGreen=92]="XGreen",A[A.XYellow=93]="XYellow",A[A.XBlue=94]="XBlue",A[A.XMagenta=95]="XMagenta",A[A.XCyan=96]="XCyan",A[A.XWhite=97]="XWhite",A[A.XBlackBackground=100]="XBlackBackground",A[A.XRedBackground=101]="XRedBackground",A[A.XGreenBackground=102]="XGreenBackground",A[A.XYellowBackground=103]="XYellowBackground",A[A.XBlueBackground=104]="XBlueBackground",A[A.XMagentaBackground=105]="XMagentaBackground",A[A.XCyanBackground=106]="XCyanBackground",A[A.XWhiteBackground=107]="XWhiteBackground",A))(jt||{});function xe(f,p){switch(f.toLowerCase()){case"black":return p?40:30;case"red":return p?41:31;case"green":return p?42:32;case"yellow":return p?43:33;case"blue":return p?44:34;case"magenta":return p?45:35;case"cyan":return p?46:36;case"white":return p?47:37;case"default":return p?49:39}return-1}function zi(f){let p=-1,t=-1,e=!1;switch(f-1024>=0&&(f-=1024),f-512>=0&&(f-=512),f-256>=0&&(f-=256),f-128>=0&&(f-=128,e=!0),f-112>=0&&(f-=112,t=47),f-96>=0&&(f-=96,t=43),f-80>=0&&(f-=80,t=45),f-64>=0&&(f-=64,t=41),f-48>=0&&(f-=48,t=46),f-32>=0&&(f-=32,t=42),f-16>=0&&(f-=16,t=44),f>=8&&(f-=8,e=!0),f){case 0:p=30;break;case 1:p=34;break;case 2:p=32;break;case 3:p=36;break;case 4:p=31;break;case 5:p=35;break;case 6:p=33;break;case 7:p=37;break}return e&&p===-1?p=370:e&&(p*=10),p===-1?`,${t}`:t===-1?p.toString():`${p},${t}`}function Ae(f){return!f||f.length===0?!1:["indianred","lightcoral","salmon","darksalmon","lightsalmon","crimson","red","firebrick","darkred","pink","lightpink","hotpink","deeppink","mediumvioletred","palevioletred","lightsalmon","coral","tomato","orangered","darkorange","orange","gold","yellow","lightyellow","lemonchiffon","lightgoldenrodyellow","papayawhip","moccasin","peachpuff","palegoldenrod","khaki","darkkhaki","lavender","thistle","plum","violet","orchid","fuchsia","magenta","mediumorchid","mediumpurple","blueviolet","darkviolet","darkorchid","darkmagenta","purple","indigo","slateblue","darkslateblue","mediumslateblue","greenyellow","chartreuse","lawngreen","lime","limegreen","palegreen","lightgreen","mediumspringgreen","springgreen","mediumseagreen","seagreen","forestgreen","green","darkgreen","yellowgreen","olivedrab","olive","darkolivegreen","mediumaquamarine","darkseagreen","lightseagreen","darkcyan","teal","aqua","cyan","lightcyan","paleturquoise","aquamarine","turquoise","mediumturquoise","darkturquoise","cadetblue","steelblue","lightsteelblue","powderblue","lightblue","skyblue","lightskyblue","deepskyblue","dodgerblue","cornflowerblue","mediumslateblue","royalblue","blue","mediumblue","darkblue","navy","midnightblue","cornsilk","blanchedalmond","bisque","navajowhite","wheat","burlywood","tan","rosybrown","sandybrown","goldenrod","darkgoldenrod","peru","chocolate","saddlebrown","sienna","brown","maroon","white","snow","honeydew","mintcream","azure","aliceblue","ghostwhite","whitesmoke","seashell","beige","oldlace","floralwhite","ivory","antiquewhite","linen","lavenderblush","mistyrose","gainsboro","lightgrey","silver","darkgray","gray","dimgray","lightslategray","slategray","darkslategray","black"].indexOf(f.toLowerCase())!=-1}function ut(f,p){switch(f){case"errortextbackground":case"errorbackground":return-12;case"errortext":return p?-12:-11;case"infobackground":return-8;case"infotext":return p?-8:-7;case"localecho":return p?-4:-3;case"localechoback":return-4;case"reset":return 0;case"bold":return 1;case"faint":return 2;case"italic":return 3;case"underline":return 4;case"blink":return 5;case"blinkrapid":return 6;case"reverse":return 7;case"hidden":return 8;case"strikethrough":return 9;case"doubleunderline":return 21;case"boldoff":return 22;case"italicoff":return 23;case"underlineoff":return 24;case"blinkoff":return 25;case"blinkrapidoff":return 26;case"reverseoff":return 27;case"visible":return 28;case"strikethroughoff":return 29;case"black":return p?40:30;case"red":return p?41:31;case"green":return p?42:32;case"yellow":return p?43:33;case"blue":return p?44:34;case"magenta":return p?45:35;case"cyan":return p?46:36;case"white":return p?47:37;case"default":case"defaultfore":return p?49:39;case"blackbackground":return 40;case"redbackground":return 41;case"greenbackground":return 42;case"yellowbackground":return 43;case"bluebackground":return 44;case"magentabackground":return 45;case"cyanbackground":return 46;case"whitebackground":return 47;case"defaultbackground":case"defaultback":return 49;case"overline":return 53;case"subscript":return 74;case"superscript":return 73;case"subsuperoff":return 75;case"xblack":return p?100:90;case"xred":return p?101:91;case"xgreen":return p?102:92;case"xyellow":return p?103:93;case"xblue":return p?104:94;case"xmagenta":return p?105:95;case"xcyan":return p?106:96;case"xwhite":return p?107:97;case"xblackbackground":return 100;case"xredbackground":return 101;case"xgreenbackground":return 102;case"xyellowbackground":return 103;case"xbluebackground":return 104;case"xmagentabackground":return 105;case"xcyanbackground":return 106;case"xwhitebackground":return 107}return-1}var Ot=class{constructor(p,t){this.width=p||0,this.height=t||0}};var te=[["bufferSize",0,2,500],["commandDelay",0,2,500],["commandDelayCount",0,2,5],["commandHistorySize",0,2,20],["fontSize",0,0,"1em",0],["cmdfontSize",0,0,"1em",0],["commandEcho",0,1,!0],["flashing",0,1,!1],["autoConnect",0,1,!0],["enableAliases",-1,1,!0],["enableTriggers",-1,1,!0],["enableMacros",-1,1,!0],["showScriptErrors",0,1,!1],["commandStacking",0,1,!0],["commandStackingChar",0,0,";",1],["htmlLog",0,1,!0],["keepLastCommand",0,1,!0],["enableMCCP",0,1,!0],["enableUTF8",0,1,!0],["font",0,5,"'Courier New', Courier, monospace",0],["cmdfont",0,5,"'Courier New', Courier, monospace",0],["aliases",-1,4],["macros",-1,4],["triggers",-1,4],["mapFollow","mapper.follow",1,!0],["mapEnabled","mapper.enabled",1,!0],["MapperSplitArea","mapper.split",1,!1],["MapperFillWalls","mapper.fill",1,!1],["MapperOpen","showMapper",1,!1],["fullScreen",-1,3,!1],["enableMXP",0,1,!0],["enableMSP",0,1,!0],["parseCommands",0,3,!0],["lagMeter",0,1,!0],["enablePing",0,1,!1],["enableEcho",0,1,!0],["enableSpeedpaths",0,1,!0],["speedpathsChar",0,0,"!",1],["parseSpeedpaths",0,1,!0],["profile",-1,0,"Default",1],["parseSingleQuotes",0,1,!1],["parseDoubleQuotes",0,1,!0],["logEnabled",0,1,!1],["logPrepend",0,1,!1],["logOffline",0,1,!1],["logUniqueOnConnect",0,1,!0],["enableURLDetection",0,1,!0],["colors",0,4],["notifyMSPPlay",0,1,!1],["CommandonClick",0,1,!0],["allowEval",0,1,!0],["allowEscape",0,1,!0],["AutoCopySelectedToClipboard",0,1,!1],["enableDebug",0,1,!1],["editorPersistent",0,1,!1],["askonclose",0,1,!0],["dev",0,1,!1],["chat.captureLines",0,1,!1],["chat.captureAllLines",0,1,!1],["chat.captureReviews",0,1,!1],["chat.captureTells",0,1,!1],["chat.captureTalk",0,1,!1],["chat.gag",0,1,!1],["chat.CaptureOnlyOpen",0,1,!1],["checkForUpdates",0,1,!1],["autoCreateCharacter",0,1,!1],["askonchildren",0,1,!0],["mapper.legend",0,1,!1],["mapper.room",0,1,!1],["mapper.importType",0,2,1],["mapper.vscroll",0,2,0],["mapper.hscroll",0,2,0],["mapper.scale",0,2,100],["mapper.alwaysOnTop",0,1,!1],["mapper.alwaysOnTopClient",0,1,!0],["mapper.memory",0,1,!1],["mapper.memorySavePeriod",0,2,9e5],["mapper.active.ID",0,0,null],["mapper.active.x",0,2,0],["mapper.active.y",0,2,0],["mapper.active.z",0,2,0],["mapper.active.area",0,0,null],["mapper.active.zone",0,2,0],["mapper.persistent",0,1,!0],["profiles.split",0,2,204],["profiles.askoncancel",0,1,!0],["profiles.triggersAdvanced",0,1,!1],["profiles.aliasesAdvanced",0,1,!1],["profiles.buttonsAdvanced",0,1,!1],["profiles.macrosAdvanced",0,1,!1],["profiles.contextsAdvanced",0,1,!1],["profiles.codeEditor",0,1,!0],["profiles.watchFiles",0,1,!0],["chat.alwaysOnTop",0,1,!1],["chat.alwaysOnTopClient",0,1,!0],["chat.log",0,1,!1],["chat.persistent",0,1,!1],["chat.zoom",0,2,1],["chat.font",0,5,"'Courier New', Courier, monospace"],["chat.fontSize",0,0,"1em"],["title",0,0,"$t"],["logGagged",0,1,!1],["logTimeFormat",0,0,"YYYYMMDD-HHmmss"],["autoConnectDelay",0,2,600],["autoLogin",0,1,!0],["onDisconnect",0,2,2],["enableKeepAlive",0,1,!1],["keepAliveDelay",0,2,0],["newlineShortcut",0,2,1],["logWhat",0,2,1],["logErrors",0,1,!0],["showErrorsExtended",0,1,!1],["reportCrashes",0,1,!1],["enableCommands",0,1,!0],["commandChar",0,0,"#",1],["escapeChar",0,0,"\\",1],["enableVerbatim",0,1,!0],["verbatimChar",0,0,"`"],["soundPath",0,0,""],["logPath",0,0,""],["theme",0,0,""],["gamepads",0,1,!1],["buttons.connect",0,1,!0],["buttons.characters",0,1,!0],["buttons.preferences",0,1,!0],["buttons.log",0,1,!0],["buttons.clear",0,1,!0],["buttons.lock",0,1,!0],["buttons.map",0,1,!0],["buttons.user",0,1,!0],["buttons.mail",0,1,!1],["buttons.compose",0,1,!1],["buttons.immortal",0,1,!0],["buttons.codeEditor",0,1,!1],["find.case",0,1,!1],["find.word",0,1,!1],["find.reverse",0,1,!1],["find.regex",0,1,!1],["find.selection",0,1,!1],["find.show",0,1,!1],["display.split",0,1,!1],["display.splitHeight",0,2,-1],["display.splitLive",0,1,!1],["display.roundedOverlays",0,1,!0],["backupLoad",0,2,30],["backupSave",0,2,30],["backupAllProfiles",0,1,!0],["scrollLocked",0,1,!1],["showStatus",0,1,!0],["showCharacterManager",0,1,!1],["showChat",0,1,!1],["showEditor",0,1,!1],["showArmor",0,1,!1],["showStatusWeather",0,1,!0],["showStatusLimbs",0,1,!0],["showStatusHealth",0,1,!0],["showStatusExperience",0,1,!0],["showStatusPartyHealth",0,1,!0],["showStatusCombatHealth",0,1,!0],["showButtonBar",0,1,!0],["allowNegativeNumberNeeded",0,1,!1],["spellchecking",0,1,!0],["hideOnMinimize",0,1,!1],["showTrayIcon",0,1,!1],["statusExperienceNeededProgressbar",0,1,!1],["trayClick",0,2,0],["trayDblClick",0,2,0],["pasteSpecialPrefix",0,0,""],["pasteSpecialPostfix",0,0,""],["pasteSpecialReplace",0,0,""],["pasteSpecialPrefixEnabled",0,1,!0],["pasteSpecialPostfixEnabled",0,1,!0],["pasteSpecialReplaceEnabled",0,1,!0],["display.showSplitButton",0,1,!0],["chat.split",0,1,!1],["chat.splitHeight",0,2,-1],["chat.splitLive",0,1,!1],["chat.roundedOverlays",0,1,!0],["chat.showSplitButton",0,1,!0],["chat.bufferSize",0,2,500],["chat.flashing",0,1,!1],["display.hideTrailingEmptyLine",0,1,!0],["display.enableColors",0,1,!0],["display.enableBackgroundColors",0,1,!0],["enableSound",0,1,!0],["allowHalfOpen",0,1,!0],["editorClearOnSend",0,1,!0],["editorCloseOnSend",0,1,!0],["askOnCloseAll",0,1,!0],["askonloadCharacter",0,1,!0],["mapper.roomWidth",0,2,200],["mapper.roomGroups",0,2,7],["mapper.showInTaskBar",0,1,!1],["profiles.enabled",0,4,[]],["profiles.sortOrder",0,2,12],["profiles.sortDirection",0,2,1],["profiles.showInTaskBar",0,1,!1],["profiles.profileSelected",0,0,"default"],["profiles.profileExpandSelected",0,1,!0],["chat.lines",0,4,[]],["chat.showInTaskBar",0,1,!1],["chat.showTimestamp",0,2,0],["chat.timestampFormat",0,0,"[[]MM-DD HH:mm:ss.SSS[]] "],["chat.tabWidth",0,2,8],["chat.displayControlCodes",0,1,!1],["chat.emulateTerminal",0,1,!1],["chat.emulateControlCodes",0,1,!0],["chat.wordWrap",0,1,!1],["chat.wrapAt",0,2,0],["chat.indent",0,2,4],["chat.scrollLocked",0,1,!1],["chat.find.case",0,1,!1],["chat.find.word",0,1,!1],["chat.find.reverse",0,1,!1],["chat.find.regex",0,1,!1],["chat.find.selection",0,1,!1],["chat.find.show",0,1,!1],["chat.find.highlight",0,1,!1],["chat.find.location",0,4,[5,20]],["codeEditor.showInTaskBar",0,1,!1],["codeEditor.persistent",0,1,!1],["codeEditor.alwaysOnTop",0,1,!1],["codeEditor.alwaysOnTopClient",0,1,!0],["autoTakeoverLogin",0,1,!1],["fixHiddenWindows",0,1,!0],["maxReconnectDelay",0,2,3600],["enableBackgroundThrottling",0,1,!0],["enableBackgroundThrottlingClients",0,1,!1],["showInTaskBar",0,1,!0],["showLagInTitle",0,1,!1],["mspMaxRetriesOnError",0,2,0],["logTimestamp",0,2,0],["logTimestampFormat",0,0,"[[]MM-DD HH:mm:ss.SSS[]] "],["disableTriggerOnError",0,1,!0],["prependTriggeredLine",0,1,!0],["enableParameters",0,1,!0],["parametersChar",0,0,"%",1],["enableNParameters",0,1,!0],["nParametersChar",0,0,"$",1],["enableParsing",0,1,!0],["externalWho",0,1,!0],["externalHelp",0,1,!0],["watchForProfilesChanges",0,1,!1],["onProfileChange",0,2,0],["onProfileDeleted",0,2,0],["enableDoubleParameterEscaping",0,1,!1],["ignoreEvalUndefined",0,1,!0],["enableInlineComments",0,1,!0],["enableBlockComments",0,1,!0],["inlineCommentString",0,0,"//"],["blockCommentString",0,0,"/*"],["allowCommentsFromCommand",0,1,!1],["saveTriggerStateChanges",0,1,!0],["groupProfileSaves",0,1,!1],["groupProfileSaveDelay",0,2,2e4],["returnNewlineOnEmptyValue",0,1,!1],["pathDelay",0,2,0],["pathDelayCount",0,2,1],["echoSpeedpaths",0,1,!1],["alwaysShowTabs",0,1,!1],["scriptEngineType",0,2,4],["initializeScriptEngineOnLoad",0,1,!1],["find.highlight",0,1,!1],["find.location",0,4,[5,20]],["display.showInvalidMXPTags",0,1,!1],["display.showTimestamp",0,2,0],["display.timestampFormat",0,0,"[[]MM-DD HH:mm:ss.SSS[]] "],["display.displayControlCodes",0,1,!1],["display.emulateTerminal",0,1,!1],["display.emulateControlCodes",0,1,!0],["display.wordWrap",0,1,!1],["display.tabWidth",0,2,8],["display.wrapAt",0,2,0],["display.indent",0,2,4],["statusWidth",0,2,-1],["showEditorInTaskBar",0,1,!0],["trayMenu",0,2,0],["lockLayout",0,1,!1],["loadLayout",0,0,""],["useSingleInstance",0,1,!0],["onSecondInstance",0,2,0],["characterManagerDblClick",0,2,0],["enableTabCompletion",1,!0],["ignoreCaseTabCompletion",0,1,!1],["tabCompletionBufferLimit",0,2,100],["enableNotifications",0,1,!0],["echo",0,2,0],["commandAutoSize",0,1,!1],["commandWordWrap",0,1,!1],["commandScrollbars",0,1,!1],["tabCompletionList",0,0,""],["tabCompletionLookupType",0,2,1],["tabCompletionReplaceCasing",0,2,0],["characterManagerAddButtonAction",0,2,0],["enableCrashReporting",0,1,!1],["characterManagerPanelWidth",0,2,0],["ignoreInputLeadingWhitespace",0,1,!1],["profiles.find.case",0,1,!1],["profiles.find.word",0,1,!1],["profiles.find.reverse",0,1,!1],["profiles.find.regex",0,1,!1],["profiles.find.selection",0,1,!1],["profiles.find.show",0,1,!1],["profiles.find.value",0,1,!1],["skipMore",0,1,!1],["skipMoreDelay",0,2,5e3],["commandMinLines",0,2,1],["backupReplaceCharacters",0,1,!0],["simpleAlarms",0,1,!1],["simpleEditor",0,1,!1],["selectLastCommand",0,1,!0],["statusMode",0,2,yt()?1:0],["logger.split",0,2,204],["showChatWindow",0,2,0],["chat.enableColors",0,2,!0],["chat.enableBackgroundColors",0,2,!0],["display.customSelection",0,1,!0],["chat.customSelection",0,1,!0],["pasteSpecialDisable",0,1,!0]],Hi=["bufferSize","commandDelay","commandDelayCount","commandHistorySize","fontSize","cmdfontSize","commandEcho","flashing","autoConnect","enableAliases","enableTriggers","enableMacros","showScriptErrors","commandStacking","commandStackingChar","htmlLog","keepLastCommand","enableMCCP","enableUTF8","font","cmdfont","mapper.follow","mapper.enabled","mapper.split","mapper.fill","showMapper","fullScreen","enableMXP","enableMSP","parseCommands","lagMeter","enablePing","enableEcho","enableSpeedpaths","speedpathsChar","parseSpeedpaths","profile","parseSingleQuotes","parseDoubleQuotes","logEnabled","logPrepend","logOffline","logUniqueOnConnect","enableURLDetection","notifyMSPPlay","CommandonClick","allowEval","allowEscape","AutoCopySelectedToClipboard","enableDebug","editorPersistent","askonclose","dev","chat.captureLines","chat.captureAllLines","chat.captureReviews","chat.captureTells","chat.captureTalk","chat.gag","chat.CaptureOnlyOpen","checkForUpdates","autoCreateCharacter","askonchildren","mapper.legend","mapper.room","mapper.importType","mapper.vscroll","mapper.hscroll","mapper.scale","mapper.alwaysOnTop","mapper.alwaysOnTopClient","mapper.memory","mapper.memorySavePeriod","mapper.active.ID","mapper.active.x","mapper.active.y","mapper.active.z","mapper.active.area","mapper.active.zone","mapper.persistent","profiles.split","profiles.askoncancel","profiles.triggersAdvanced","profiles.aliasesAdvanced","profiles.buttonsAdvanced","profiles.macrosAdvanced","profiles.contextsAdvanced","profiles.codeEditor","profiles.watchFiles","chat.alwaysOnTop","chat.alwaysOnTopClient","chat.log","chat.persistent","chat.zoom","chat.font","chat.fontSize","title","logGagged","logTimeFormat","autoConnectDelay","autoLogin","onDisconnect","enableKeepAlive","keepAliveDelay","newlineShortcut","logWhat","logErrors","showErrorsExtended","reportCrashes","enableCommands","commandChar","escapeChar","enableVerbatim","verbatimChar","soundPath","logPath","theme","gamepads","buttons.connect","buttons.characters","buttons.preferences","buttons.log","buttons.clear","buttons.lock","buttons.map","buttons.user","buttons.mail","buttons.compose","buttons.immortal","buttons.codeEditor","find.case","find.word","find.reverse","find.regex","find.selection","find.show","display.split","display.splitHeight","display.splitLive","display.roundedOverlays","backupLoad","backupSave","backupAllProfiles","backupReplaceCharacters","scrollLocked","showStatus","showCharacterManager","showChat","showEditor","showArmor","showStatusWeather","showStatusLimbs","showStatusHealth","showStatusExperience","showStatusPartyHealth","showStatusCombatHealth","showButtonBar","allowNegativeNumberNeeded","spellchecking","hideOnMinimize","showTrayIcon","statusExperienceNeededProgressbar","trayClick","trayDblClick","pasteSpecialPrefix","pasteSpecialPostfix","pasteSpecialReplace","pasteSpecialPrefixEnabled","pasteSpecialPostfixEnabled","pasteSpecialReplaceEnabled","display.showSplitButton","chat.split","chat.splitHeight","chat.splitLive","chat.roundedOverlays","chat.showSplitButton","chat.bufferSize","chat.flashing","display.hideTrailingEmptyLine","display.enableColors","display.enableBackgroundColors","enableSound","allowHalfOpen","editorClearOnSend","editorCloseOnSend","askOnCloseAll","askonloadCharacter","mapper.roomWidth","mapper.roomGroups","mapper.showInTaskBar","profiles.enabled","profiles.sortOrder","profiles.sortDirection","profiles.showInTaskBar","profiles.profileSelected","profiles.profileExpandSelected","chat.lines","chat.showInTaskBar","chat.showTimestamp","chat.timestampFormat","chat.tabWidth","chat.displayControlCodes","chat.emulateTerminal","chat.emulateControlCodes","chat.wordWrap","chat.wrapAt","chat.indent","chat.scrollLocked","chat.find.case","chat.find.word","chat.find.reverse","chat.find.regex","chat.find.selection","chat.find.show","chat.find.highlight","chat.find.location","codeEditor.showInTaskBar","codeEditor.persistent","codeEditor.alwaysOnTop","codeEditor.alwaysOnTopClient","autoTakeoverLogin","fixHiddenWindows","maxReconnectDelay","enableBackgroundThrottling","enableBackgroundThrottlingClients","showInTaskBar","showLagInTitle","mspMaxRetriesOnError","logTimestamp","logTimestampFormat","disableTriggerOnError","prependTriggeredLine","enableParameters","parametersChar","enableNParameters","nParametersChar","enableParsing","externalWho","externalHelp","watchForProfilesChanges","onProfileChange","onProfileDeleted","enableDoubleParameterEscaping","ignoreEvalUndefined","enableInlineComments","enableBlockComments","inlineCommentString","blockCommentString","allowCommentsFromCommand","saveTriggerStateChanges","groupProfileSaves","groupProfileSaveDelay","returnNewlineOnEmptyValue","pathDelay","pathDelayCount","echoSpeedpaths","alwaysShowTabs","scriptEngineType","initializeScriptEngineOnLoad","find.highlight","find.location","display.showInvalidMXPTags","display.showTimestamp","display.timestampFormat","display.displayControlCodes","display.emulateTerminal","display.emulateControlCodes","display.wordWrap","display.tabWidth","display.wrapAt","display.indent","statusWidth","showEditorInTaskBar","trayMenu","lockLayout","loadLayout","useSingleInstance","statusWidth","characterManagerDblClick","warnAdvancedSettings","showAdvancedSettings","enableTabCompletion","tabCompletionBufferLimit","ignoreCaseTabCompletion","enableNotifications","commandAutoSize","commandWordWrap","commandScrollbars","tabCompletionList","tabCompletionLookupType","tabCompletionReplaceCasing","characterManagerAddButtonAction","enableCrashReporting","characterManagerPanelWidth","ignoreInputLeadingWhitespace","profiles.find.case","profiles.find.word","profiles.find.reverse","profiles.find.regex","profiles.find.selection","profiles.find.show","profiles.find.value","skipMore","skipMoreDelay","commandMinLines","simpleAlarms","simpleEditor","selectLastCommand","statusMode","logger.split","showChatWindow","chat.enableColors","chat.enableBackgroundColors","display.customSelection","chat.customSelection","pasteSpecialDisable"],ue=class f{constructor(){for(let p=0,t=te.length;p<t;p++)te[p][2]!==4&&(this[te[p][0]]=f.getValue(te[p][0]),te[p][1]&&te[p][1].length&&(this[te[p][1]]=f.getValue(te[p][1])));this.colors=f.getValue("colors")}static{this.settingError=!1}static getValue(p,t){let e;if(f.settingError)return t===null||typeof t>"u"?f.defaultValue(p):t;try{if(e=$.jStorage.get(p),typeof e>"u"||e===null)return t===null||typeof t>"u"?f.defaultValue(p):t;switch(p){case"showChat":case"showStatus":case"showButtons":case"enableCommands":case"enableVerbatim":case"allowEscape":case"autoConnect":case"mapFollow":case"mapEnabled":case"flashing":case"commandEcho":case"enableAliases":case"enableTriggers":case"enableButtons":case"enableMacros":case"commandStacking":case"htmlLog":case"keepLastCommand":case"fullScreen":case"enableMXP":case"enableURLDetection":case"enableMCCP":case"enableUTF8":case"parseCommands":case"lagMeter":case"showScriptErrors":case"enablePing":case"enableEcho":case"enableSpeedpaths":case"parseSpeedpaths":case"mapper.enabled":case"MapperSplitArea":case"mapper.split":case"MapperFillWalls":case"mapper.fill":case"mapper.follow":case"MapperOpen":case"showMapper":case"parseSingleQuotes":case"parseDoubleQuotes":case"logEnabled":case"logOffline":case"logPrepend":case"logUniqueOnConnect":case"toolsPinned":case"notifyMSPPlay":case"CommandonClick":case"allowEval":case"disableTriggerOnError":case"prependTriggeredLine":case"chat.captureLines":case"chat.captureAllLines":case"chat.captureReviews":case"chat.captureTells":case"chat.captureTalk":case"chat.gag":case"chat.CaptureOnlyOpen":case"simpleAlarms":case"simpleEditor":case"selectLastCommand":case"showLagInTitle":case"display.split":case"chat.split":case"display.customSelection":case"chat.customSelection":return e==1;case"colors":case"chat.lines":return e===null||typeof e>"u"||e.length===0?[]:JSON.parse(e)}return e}catch(s){return f.settingError||(alert(`Unable to save to localStorage so reverting to default,

Error description: `+s.message),f.settingError=!0),t===null||typeof t>"u"?f.defaultValue(t):t}}static setValue(p,t){switch(p){case"colors":case"chat.lines":t===null||typeof t>"u"||t.length===0?$.jStorage.deleteKey(p):$.jStorage.set(p,JSON.stringify(t));break;default:typeof t=="boolean"?t?$.jStorage.set(p,1):$.jStorage.set(p,0):$.jStorage.set(p,t);break}}static clearValue(p){$.jStorage.deleteKey(p)}static defaultValue(p){switch(p){case"bufferSize":return 500;case"commandDelay":return 500;case"commandDelayCount":return 5;case"commandHistorySize":return 20;case"fontSize":return"1em";case"cmdfontSize":return"1em";case"commandEcho":return!0;case"flashing":return!1;case"autoConnect":return!0;case"enableAliases":return!0;case"enableTriggers":return!0;case"enableMacros":return!0;case"showScriptErrors":return!1;case"commandStacking":return!0;case"commandStackingChar":return";";case"htmlLog":return!0;case"keepLastCommand":return!0;case"enableMCCP":return!0;case"enableUTF8":return!0;case"font":return"'Courier New', Courier, monospace";case"cmdfont":return"'Courier New', Courier, monospace";case"mapFollow":case"mapper.follow":return!0;case"mapEnabled":case"mapper.enabled":return!0;case"MapperSplitArea":case"mapper.split":return!1;case"MapperFillWalls":case"mapper.fill":return!1;case"MapperOpen":case"showMapper":return!1;case"fullScreen":return!1;case"enableMXP":return!0;case"enableMSP":return!0;case"parseCommands":return!0;case"lagMeter":return!0;case"enablePing":return!1;case"enableEcho":return!0;case"enableSpeedpaths":return!0;case"speedpathsChar":return"!";case"parseSpeedpaths":return!0;case"profile":return"Default";case"parseSingleQuotes":return!1;case"parseDoubleQuotes":return!0;case"logEnabled":return!1;case"logPrepend":return!1;case"logOffline":return!1;case"logUniqueOnConnect":return!0;case"enableURLDetection":return!0;case"notifyMSPPlay":return!1;case"CommandonClick":return!0;case"allowEval":return!0;case"allowEscape":return!0;case"AutoCopySelectedToClipboard":return!1;case"enableDebug":return!1;case"editorPersistent":return!1;case"askonclose":return!0;case"dev":return!1;case"chat.captureLines":return!1;case"chat.captureAllLines":return!1;case"chat.captureReviews":return!1;case"chat.captureTells":return!1;case"chat.captureTalk":return!1;case"chat.gag":return!1;case"chat.CaptureOnlyOpen":return!1;case"checkForUpdates":return!1;case"autoCreateCharacter":return!1;case"askonchildren":return!0;case"mapper.legend":return!1;case"mapper.room":return!1;case"mapper.importType":return 1;case"mapper.vscroll":return 0;case"mapper.hscroll":return 0;case"mapper.scale":return 100;case"mapper.active":return{ID:null,x:0,y:0,z:0,area:null,zone:0};case"mapper.active.ID":return null;case"mapper.active.x":return 0;case"mapper.active.y":return 0;case"mapper.active.z":return 0;case"mapper.active.area":return null;case"mapper.active.zone":return 0;case"profiles.split":return 204;case"logger.split":return 204;case"profiles.askoncancel":return!0;case"profiles.triggersAdvanced":return!1;case"profiles.aliasesAdvanced":return!1;case"profiles.buttonsAdvanced":return!1;case"profiles.macrosAdvanced":return!1;case"profiles.contextsAdvanced":return!1;case"profiles.codeEditor":return!0;case"chat.log":return!1;case"chat.zoom":return 1;case"chat.font":return"'Courier New', Courier, monospace";case"chat.fontSize":return"1em";case"title":return"$t";case"logGagged":return!1;case"logTimeFormat":return"YYYYMMDD-HHmmss";case"autoConnectDelay":return 600;case"autoLogin":return!0;case"onDisconnect":return 2;case"enableKeepAlive":return!1;case"keepAliveDelay":return 0;case"newlineShortcut":return 1;case"logWhat":return 1;case"logErrors":return!0;case"showErrorsExtended":return!1;case"reportCrashes":return!1;case"enableCommands":return!0;case"commandChar":return"#";case"escapeChar":return"\\";case"enableVerbatim":return!0;case"verbatimChar":return"`";case"soundPath":return"";case"logPath":return"";case"theme":return"";case"gamepads":return!1;case"backupLoad":return 30;case"backupSave":return 30;case"backupAllProfiles":return!0;case"backupReplaceCharacters":return!0;case"scrollLocked":return!1;case"showStatus":return!0;case"showChat":return!1;case"showEditor":return!1;case"showArmor":return!1;case"showStatusWeather":return!0;case"showStatusLimbs":return!0;case"showStatusHealth":return!0;case"showStatusExperience":return!0;case"showStatusPartyHealth":return!0;case"showStatusCombatHealth":return!0;case"allowNegativeNumberNeeded":return!1;case"spellchecking":return!0;case"statusExperienceNeededProgressbar":return!1;case"pasteSpecialPrefix":return"";case"pasteSpecialPostfix":return"";case"pasteSpecialReplace":return"";case"pasteSpecialPrefixEnabled":return!0;case"pasteSpecialPostfixEnabled":return!0;case"pasteSpecialReplaceEnabled":return!0;case"pasteSpecialDisable":return!0;case"display.showSplitButton":return!0;case"chat.showSplitButton":return!0;case"chat.bufferSize":return 500;case"chat.flashing":return!1;case"display.hideTrailingEmptyLine":return!0;case"display.enableColors":return!0;case"display.enableBackgroundColors":return!0;case"enableSound":return!0;case"editorClearOnSend":return!0;case"editorCloseOnSend":return!0;case"askOnCloseAll":return!0;case"askonloadCharacter":return!0;case"mapper.roomWidth":return 200;case"mapper.roomGroups":return 7;case"mapper.showInTaskBar":return!1;case"profiles.enabled":return[];case"profiles.sortOrder":return 12;case"profiles.sortDirection":return 1;case"profiles.profileSelected":return"default";case"profiles.profileExpandSelected":return!0;case"chat.lines":return[];case"chat.showTimestamp":return 0;case"chat.timestampFormat":return"[[]MM-DD HH:mm:ss.SSS[]] ";case"chat.tabWidth":return 8;case"chat.displayControlCodes":return!1;case"chat.emulateTerminal":return!1;case"chat.emulateControlCodes":return!0;case"chat.wordWrap":return!1;case"chat.wrapAt":return 0;case"chat.indent":return 4;case"chat.enableColors":return!0;case"chat.enableBackgroundColors":return!0;case"autoTakeoverLogin":return!1;case"maxReconnectDelay":return 3600;case"showLagInTitle":return!1;case"mspMaxRetriesOnError":return 0;case"logTimestamp":return 0;case"logTimestampFormat":return"[[]MM-DD HH:mm:ss.SSS[]] ";case"disableTriggerOnError":return!0;case"prependTriggeredLine":return!0;case"enableParameters":return!0;case"parametersChar":return"%";case"enableNParameters":return!0;case"nParametersChar":return"$";case"enableParsing":return!0;case"onProfileChange":return 0;case"onProfileDeleted":return 0;case"enableDoubleParameterEscaping":return!1;case"ignoreEvalUndefined":return!0;case"enableInlineComments":return!0;case"enableBlockComments":return!0;case"inlineCommentString":return"//";case"blockCommentString":return"/*";case"allowCommentsFromCommand":return!1;case"saveTriggerStateChanges":return!0;case"groupProfileSaves":return!1;case"groupProfileSaveDelay":return 2e4;case"returnNewlineOnEmptyValue":return!1;case"pathDelay":return 0;case"pathDelayCount":return 1;case"echoSpeedpaths":return!1;case"scriptEngineType":return 4;case"initializeScriptEngineOnLoad":return!1;case"display.showInvalidMXPTags":return!1;case"display.showTimestamp":return 0;case"display.timestampFormat":return"[[]MM-DD HH:mm:ss.SSS[]] ";case"display.displayControlCodes":return!1;case"display.emulateTerminal":return!1;case"display.emulateControlCodes":return!0;case"display.wordWrap":return!1;case"display.tabWidth":return 8;case"display.wrapAt":return 0;case"display.indent":return 4;case"statusWidth":return-1;case"extensions":return{};case"warnAdvancedSettings":return!0;case"showAdvancedSettings":return!1;case"enableTabCompletion":return!0;case"ignoreCaseTabCompletion":return!1;case"tabCompletionBufferLimit":return 100;case"enableNotifications":return!0;case"echo":return 0;case"commandAutoSize":return!1;case"commandWordWrap":return!1;case"commandMinLines":return 1;case"tabCompletionLookupType":return 1;case"tabCompletionList":return"";case"tabCompletionReplaceCasing":return 0;case"ignoreInputLeadingWhitespace":return!1;case"skipMore":return!1;case"skipMoreDelay":return 5e3;case"simpleAlarms":return!1;case"simpleEditor":return!1;case"selectLastCommand":return!0;case"statusMode":yt();case"showChatWindow":return 0;case"display.split":return!1;case"display.splitLive":return!1;case"display.splitHeight":return-1;case"display.customSelection":return!0;case"chat.split":return!1;case"chat.splitLive":return!1;case"chat.return":return-1;case"chat.customSelection":return!0}return null}static exist(p){let t=$.jStorage.get(p);return typeof t<"u"&&t!==null}save(){for(let p in this)this.hasOwnProperty(p)&&f.setValue(p,this[p])}reset(){for(let p=0,t=te.length;p<t;p++)te[p][2]!==4&&(this[te[p][0]]=f.defaultValue(te[p][0]));this.colors=[]}};var Xt=(a=>(a[a.Regular=0]="Regular",a[a.CommandInputRegular=1]="CommandInputRegular",a[a.Event=2]="Event",a[a.Alarm=3]="Alarm",a[a.Pattern=8]="Pattern",a[a.CommandInputPattern=16]="CommandInputPattern",a[a.Expression=64]="Expression",a[a.LoopExpression=128]="LoopExpression",a))(Xt||{});var qt=(h=>(h[h.Skip=512]="Skip",h[h.Wait=1024]="Wait",h[h.LoopPattern=4096]="LoopPattern",h[h.LoopLines=8192]="LoopLines",h[h.Duration=16384]="Duration",h[h.WithinLines=32768]="WithinLines",h[h.Manual=65536]="Manual",h[h.ReParse=131072]="ReParse",h[h.ReParsePattern=262144]="ReParsePattern",h))(qt||{});function It(f){let p=[];if(f.gamepad>0)return p.push("Gamepad "+f.gamepad),f.key>0?p.push("Button "+f.key):f.gamepadAxes<0?p.push("Axis "+-f.gamepadAxes):f.gamepadAxes>0&&p.push("Axis "+f.gamepadAxes),p.length===1?"None":p.join("+");if(f.key===0)return f.name&&f.name.length>0?"None - "+f.name:"None";if((f.modifiers&4)===4&&p.push("Ctrl"),(f.modifiers&2)===2&&p.push("Alt"),(f.modifiers&8)===8&&p.push("Shift"),(f.modifiers&16)===16&&p.push("Meta"),Ut[f.key])p.push(Ut[f.key]);else return f.name&&f.name.length>0?"None - "+f.name:"None";return f.name&&f.name.length>0?p.join("+")+" - "+f.name:p.join("+")}var $e=class f{constructor(p,t){this.temp=!1;this.start=!1;this.seconds=-1;this.secondsWildcard=!0;this.hours=-1;this.hoursWildcard=!0;this.minutes=-1;this.minutesWildcard=!0;this.suspended=0;this.restart=0;typeof p=="string"&&(t=p,p=0),this.parent=p,this.pattern=t,this.startTime=Date.now(),this.prevTime=this.startTime}static parse(p,t,e){if(typeof p=="string"&&(t=p,p=0),!t||t.length===0)if(typeof p=="object")t=p.pattern;else throw new Error("Blank pattern");let s=new f(p,t);for(;t[0]==="-"||t[0]==="+";)t[0]==="-"?s.start=!0:t[0]==="+"&&(s.temp=!0),t=t.substr(1);if(t!=="*"){let n=t.split(":"),r;if(n.length===0)throw new Error("Invalid format: "+t);if(n.length===1)if(n[0]==="*")s.secondsWildcard=!0,s.seconds=-1;else{if(n[0][0]==="*"?(s.secondsWildcard=!0,n[0]=n[0].substr(1)):s.secondsWildcard=!1,r=parseInt(n[0],10),isNaN(r))throw new Error("Invalid Format: "+n[0]);if(r<0)throw new Error("Seconds must be greater than or equal to 0.");r>59&&(s.secondsWildcard=!0),s.seconds=r}else if(n.length===2){if(n[0]==="*")s.minutesWildcard=!0,s.minutes=-1;else{if(n[0][0]==="*"?(s.minutesWildcard=!0,n[0]=n[0].substr(1)):s.minutesWildcard=!1,r=parseInt(n[0],10),isNaN(r))throw new Error("Invalid Format: "+n[0]);if(r<0||r>59)throw new Error("Minutes can only be 0 to 59");s.minutes=r}if(n[1]==="*")s.secondsWildcard=!0,s.seconds=-1;else{if(n[1][0]==="*"?(s.secondsWildcard=!0,n[1]=n[1].substr(1)):s.secondsWildcard=!1,r=parseInt(n[1],10),isNaN(r))throw new Error("Invalid Format: "+n[1]);if(r<0||r>59)throw new Error("Seconds can only be 0 to 59");s.seconds=r}}else{if(n[0]==="*")s.hoursWildcard=!0,s.hours=-1;else{if(n[0][0]==="*"?(s.hoursWildcard=!0,n[0]=n[0].substr(1)):s.hoursWildcard=!1,r=parseInt(n[0],10),isNaN(r))throw new Error("Invalid Format: "+n[0]);if(r<0||r>23)throw new Error("Hours can only be 0 to 23");s.hours=r}if(n[1]==="*")s.minutesWildcard=!0,s.seconds=-1;else{if(n[1][0]==="*"?(s.minutesWildcard=!0,n[1]=n[1].substr(1)):s.minutesWildcard=!1,r=parseInt(n[1],10),isNaN(r))throw new Error("Invalid Format: "+n[1]);if(r<0||r>59)throw new Error("Minutes can only be 0 to 59");s.minutes=r}if(n[2]==="*")s.secondsWildcard=!0,s.seconds=-1;else{if(n[2][0]==="*"?(s.secondsWildcard=!0,n[2]=n[2].substr(2)):s.secondsWildcard=!1,r=parseInt(n[2],10),isNaN(r))throw new Error("Invalid Format: "+n[2]);if(r<0||r>59)throw new Error("Seconds can only be 0 to 59");s.seconds=r}}}return e&&(s.temp=!1),s}setTempTime(p){p?this.tempTime=Date.now()+p:this.tempTime=0}},wt=class f{constructor(p,t){this.name="";this.priority=0;this.display="name";this.displaytype=0;this.value="";this.style=1;this.group="";this.enabled=!0;this.notes="";if(typeof p=="object"){let e;for(e in p)p.hasOwnProperty(e)&&(this[e]=p[e])}this.profile=t}clone(){return new f(this)}equals(p){return p?ii(this,p):!1}},ke=class f extends wt{constructor(t,e){super(t);this.caption="";this.icon="";this.append=!1;this.send=!0;this.chain=!1;this.stretch=!1;this.parse=!1;this.top=-1;this.left=-1;this.right=-1;this.bottom=-1;this.width=64;this.height=64;this.iconOnly=!1;if(this.caption="NewButton",this.display="caption",typeof t=="object"){let s;for(s in t)t.hasOwnProperty(s)&&(this[s]=t[s])}this.profile=e}clone(){return new f(this)}},dt=class f extends wt{constructor(t,e){super();this.key=0;this.append=!1;this.send=!0;this.modifiers=0;this.chain=!1;this.gamepad=0;this.gamepadAxes=0;if(this.display="return MacroDisplay(item)",this.displaytype=1,typeof t=="object"){let s;for(s in t)t.hasOwnProperty(s)&&(this[s]=t[s])}this.profile=e}clone(){return new f(this)}},it=class f extends wt{constructor(t,e,s){super();this.pattern="NewAlias";this.regexp=!1;this.multi=!1;this.append=!0;this.params="";if(typeof t=="string"&&(this.pattern=t),e!=null&&(this.value=e),this.display="pattern",typeof t=="object"){let n;for(n in t)t.hasOwnProperty(n)&&(this[n]=t[n])}this.profile=s}clone(){return new f(this)}},Te=class f extends wt{constructor(t,e){super(t);this.pattern="NewTrigger";this.verbatim=!1;this.triggerNewline=!0;this.triggerPrompt=!1;this.type=0;this.temp=!1;this.caseSensitive=!1;this.raw=!1;this.state=0;this.params="";this.triggers=[];this.fired=!1;if(this.display="pattern",typeof t=="object"){let s;for(s in t)if(t.hasOwnProperty(s))if(s==="triggers"){this.triggers=[];let n=t.triggers.length;for(let r=0;r<n;r++)this.triggers.push(new f(t.triggers[r]))}else this[s]=t[s]}this.profile=e}clone(){return new f(this)}getState(t){return t===0?this:(t--,t>=this.triggers.length||t<0?null:this.triggers[t])}},vt=class f extends wt{constructor(t,e){super(t);this.caption="";this.icon="";this.append=!1;this.send=!0;this.chain=!1;this.parent="";this.items=[];this.parse=!1;if(this.caption="NewContext",this.display="caption",typeof t=="object"){let s;for(s in t)if(t.hasOwnProperty(s))if(s==="items"){let n=0,r=t[s].length;for(;n<r;n++)this.items.push(new f(t[s][n]))}else this[s]=t[s]}this.profile=e}clone(){return new f(this)}},si=class f extends wt{constructor(t,e){super(t);this.Ll="string";this.type=1;this.defaultValue="";this.useDefault=!1;this.params="";this.profile=e,this.useDefault&&this.setValue(this.defaultValue)}set setValue(t){switch(this.type){case 2:typeof t=="string"?(t=parseInt(t,10),isNaN(t)&&(t=0)):typeof t=="boolean"&&(t=t?1:0);break;case 7:typeof t=="string"?(t=parseFloat(t),isNaN(t)&&(t=0)):typeof t=="boolean"&&(t=t?1:0);break}this.value=t,this.Ll=typeof t}get getValue(){switch(this.type){case 1:if(typeof this.value!==this.Ll)switch(this.Ll){case"number":return Number(this.value);case"string":return this.value.toString();case"boolean":return!!this.value}return this.value;case 7:return parseFloat(this.value);case 2:return parseInt(this.value,10);case 6:if(typeof this.value=="string")try{return JSON.parse(this.value)}catch{return this.value}return this.value;case 5:return typeof this.value=="string"?ti(this.value,"|"):this.value}return this.value}clone(){return new f(this)}toString(){switch(this.type){case 6:return typeof this.value=="string"?this.value:JSON.stringify(this.value);case 5:return typeof this.value=="string"?this.value:'"'+this.value.join('"|"')+'"'}return this.value?.toString()}},Be=class f{constructor(p,t){this.name="";this.file="";this.priority=0;this.enabled=!0;this.aliases=[];this.triggers=[];this.macros=[];this.buttons=[];this.contexts=[];this.enableMacros=!0;this.enableTriggers=!0;this.enableAliases=!0;this.enableButtons=!0;this.enableContexts=!0;this.enableDefaultContext=!0;typeof p=="string"?(this.name=p,this.file=p.toLowerCase(),(t==null||t)&&(this.macros=f.DefaultMacros)):typeof p=="boolean"?p&&(this.macros=f.DefaultMacros):(t==null||t)&&(this.macros=f.DefaultMacros)}static get Default(){return new f("Default")}static get DefaultMacros(){let p=[{key:97,display:"return MacroDisplay(item)",displaytype:1,value:"sw",style:1,append:!1,send:!0,name:"SouthWest",group:"",enabled:!0,modifiers:0,chain:!0,priority:0,notes:""},{key:98,display:"return MacroDisplay(item)",displaytype:1,value:"s",style:1,append:!1,send:!0,name:"South",group:"",enabled:!0,modifiers:0,chain:!0,priority:0,notes:""},{key:99,display:"return MacroDisplay(item)",displaytype:1,value:"se",style:1,append:!1,send:!0,name:"SouthEast",group:"",enabled:!0,modifiers:0,chain:!0,priority:0,notes:""},{key:100,display:"return MacroDisplay(item)",displaytype:1,value:"w",style:1,append:!1,send:!0,name:"West",group:"",enabled:!0,modifiers:0,chain:!0,priority:0,notes:""},{key:101,display:"return MacroDisplay(item)",displaytype:1,value:"l",style:1,append:!1,send:!0,name:"Look",group:"",enabled:!0,modifiers:0,chain:!0,priority:0,notes:""},{key:102,display:"return MacroDisplay(item)",displaytype:1,value:"e",style:1,append:!1,send:!0,name:"East",group:"",enabled:!0,modifiers:0,chain:!0,priority:0,notes:""},{key:103,display:"return MacroDisplay(item)",displaytype:1,value:"nw",style:1,append:!1,send:!0,name:"NorthWest",group:"",enabled:!0,modifiers:0,chain:!0,priority:0,notes:""},{key:104,display:"return MacroDisplay(item)",displaytype:1,value:"n",style:1,append:!1,send:!0,name:"North",group:"",enabled:!0,modifiers:0,chain:!0,priority:0,notes:""},{key:105,display:"return MacroDisplay(item)",displaytype:1,value:"ne",style:1,append:!1,send:!0,name:"NorthEast",group:"",enabled:!0,modifiers:0,chain:!0,priority:0,notes:""}],t=[],e=p.length;for(let s=0;s<e;s++)t.push(new dt(p[s]));return t}static get DefaultButtons(){let p=[],t;return t=new ke,t.right=176,t.top=14,t.caption="fa-solid fa-angle-double-up",t.value="up",t.width=48,t.height=48,p.push(t),t=new ke,t.right=124,t.top=14,t.caption="fa-solid fa-caret-up,rotate--45",t.value="northwest",t.width=48,t.height=48,p.push(t),t=new ke,t.right=72,t.top=14,t.caption="fa-solid fa-caret-up",t.value="north",t.width=48,t.height=48,p.push(t),t=new ke,t.right=20,t.top=14,t.caption="fa-solid fa-caret-up,rotate-45",t.value="northeast",t.width=48,t.height=48,p.push(t),t=new ke,t.right=176,t.top=66,t.caption="fa-solid fa-crosshairs",t.value="kill ${selected}",t.width=48,t.height=48,p.push(t),t=new ke,t.right=124,t.top=66,t.caption="fa-solid fa-caret-left",t.value="west",t.width=48,t.height=48,p.push(t),t=new ke,t.right=72,t.top=66,t.caption="fa-solid fa-magnifying-glass",t.value="look ${selected}",t.width=48,t.height=48,p.push(t),t=new ke,t.right=20,t.top=66,t.caption="fa-solid fa-caret-right",t.value="east",t.width=48,t.height=48,p.push(t),t=new ke,t.right=176,t.top=118,t.caption="fa-solid fa-angle-double-down",t.value="down",t.width=48,t.height=48,p.push(t),t=new ke,t.right=124,t.top=118,t.caption="fa-solid fa-caret-down,rotate-45",t.value="southwest",t.width=48,t.height=48,p.push(t),t=new ke,t.right=72,t.top=118,t.caption="fa-solid fa-caret-down",t.value="south",t.width=48,t.height=48,p.push(t),t=new ke,t.right=20,t.top=118,t.caption="fa-solid fa-caret-down,rotate--45",t.value="southeast",t.width=48,t.height=48,p.push(t),p}static load(p){let t,e;if(typeof p=="object")e=p;else return new f;t=new f(!1);let s;for(s in e)e.hasOwnProperty(s)&&(s==="aliases"||s==="triggers"||s==="macros"||s==="buttons"||s==="contexts"||s==="variables"||(t[s]=e[s]));let n,r;if(e.aliases&&e.aliases.length>0)for(r=e.aliases.length,n=0;n<r;n++)t.aliases.push(new it(e.aliases[n],null,t));if(e.triggers&&e.triggers.length>0)for(r=e.triggers.length,n=0;n<r;n++)t.triggers.push(new Te(e.triggers[n],t));if(e.macros&&e.macros.length>0)for(r=e.macros.length,t.macros=[],n=0;n<r;n++)t.macros.push(new dt(e.macros[n],t));if(e.buttons&&e.buttons.length>0)for(r=e.buttons.length,n=0;n<r;n++)t.buttons.push(new ke(e.buttons[n],t));if(e.contexts&&e.contexts.length>0)for(r=e.contexts.length,n=0;n<r;n++)t.contexts.push(new vt(e.contexts[n],t));return t.file=t.name,t}clone(p){let t,e,s;if(p===2){if(t={name:this.name,priority:this.priority,enabled:this.enabled,aliases:[],triggers:[],macros:[],buttons:[],contexts:[],enableMacros:this.enableMacros,enableTriggers:this.enableTriggers,enableAliases:this.enableAliases,enableButtons:this.enableButtons,enableContexts:this.enableContexts,enableDefaultContext:this.enableDefaultContext},this.aliases.length>0)for(s=this.aliases.length,e=0;e<s;e++)t.aliases.push({pattern:this.aliases[e].pattern,value:this.aliases[e].value,priority:this.aliases[e].priority,regexp:this.aliases[e].regexp,style:this.aliases[e].style,multi:this.aliases[e].multi,append:this.aliases[e].append,name:this.aliases[e].name,group:this.aliases[e].group,enabled:this.aliases[e].enabled,params:this.aliases[e].params,display:this.aliases[e].display,notes:this.aliases[e].notes||""});if(this.triggers.length>0)for(s=this.triggers.length,e=0;e<s;e++){let o={pattern:this.triggers[e].pattern,value:this.triggers[e].value,priority:this.triggers[e].priority,verbatim:this.triggers[e].verbatim,style:this.triggers[e].style,name:this.triggers[e].name,group:this.triggers[e].group,enabled:this.triggers[e].enabled,display:this.triggers[e].display,triggernewline:this.triggers[e].triggerNewline,caseSensitive:this.triggers[e].caseSensitive,triggerprompt:this.triggers[e].triggerPrompt,raw:this.triggers[e].raw,type:this.triggers[e].type,notes:this.triggers[e].notes||"",state:this.triggers[e].state||0,params:this.triggers[e].params||"",triggers:[]};if(this.triggers[e].triggers&&this.triggers[e].triggers.length){let a=this.triggers[e].triggers.length;for(let h=0;h<a;h++)o.triggers.push({pattern:this.triggers[e].triggers[h].pattern,value:this.triggers[e].triggers[h].value,priority:this.triggers[e].triggers[h].priority,verbatim:this.triggers[e].triggers[h].verbatim,style:this.triggers[e].triggers[h].style,name:this.triggers[e].triggers[h].name,group:this.triggers[e].triggers[h].group,enabled:this.triggers[e].triggers[h].enabled,display:this.triggers[e].triggers[h].display,triggernewline:this.triggers[e].triggers[h].triggerNewline,caseSensitive:this.triggers[e].triggers[h].caseSensitive,triggerprompt:this.triggers[e].triggers[h].triggerPrompt,raw:this.triggers[e].triggers[h].raw,type:this.triggers[e].triggers[h].type,notes:this.triggers[e].triggers[h].notes||"",state:this.triggers[e].triggers[h].state||0,params:this.triggers[e].triggers[h].params||"",triggers:[]})}t.triggers.push(o)}if(this.macros.length>0)for(s=this.macros.length,e=0;e<s;e++)t.macros.push({key:this.macros[e].key,value:this.macros[e].value,style:this.macros[e].style,append:this.macros[e].append,send:this.macros[e].send,name:this.macros[e].name,group:this.macros[e].group,enabled:this.macros[e].enabled,display:'if(item.key === 0) return "None"; return keyCodeToChar[item.key]',displaytype:1,modifiers:this.macros[e].modifiers,chain:this.macros[e].chain,notes:this.macros[e].notes||""});if(this.buttons.length>0)for(s=this.buttons.length,e=0;e<s;e++)t.buttons.push(_e(this.buttons[e],(o,a)=>{if(o!=="profile")return a}));if(this.contexts.length>0)for(s=this.contexts.length,e=0;e<s;e++)t.contexts.push(_e(this.contexts[e],(o,a)=>{if(o!=="profile")return a}));return t}t=_e(this,(o,a)=>{if(o!=="profile")return a});let n=new f(!1),r;for(r in t)t.hasOwnProperty(r)&&(r==="aliases"||r==="triggers"||r==="macros"||r==="buttons"||r==="contexts"||r==="variables"||(n[r]=t[r]));if(t.aliases&&t.aliases.length>0)for(s=t.aliases.length,e=0;e<s;e++)n.aliases.push(new it(t.aliases[e],null,n));if(t.triggers&&t.triggers.length>0)for(s=t.triggers.length,e=0;e<s;e++)n.triggers.push(new Te(t.triggers[e],n));if(t.macros&&t.macros.length>0)for(s=t.macros.length,n.macros=[],e=0;e<s;e++)n.macros.push(new dt(t.macros[e],n));if(t.buttons&&t.buttons.length>0)for(s=t.buttons.length,e=0;e<s;e++)n.buttons.push(new ke(t.buttons[e],n));if(t.contexts&&t.contexts.length>0)for(s=t.contexts.length,e=0;e<s;e++)n.contexts.push(new vt(t.contexts[e],n));return n}find(p,t,e){let s;if(!p||p.length===0||!this[p]||this[p].length===0)return null;s=se(this[p]);let n=s.length;for(let r=0;r<n;r++)if(s[r][t]===e)return s[r];return null}findAny(p,t,e){let s;if(!p||p.length===0||!this[p]||this[p].length===0)return null;s=se(this[p]);let n=s.length;if(typeof t=="object"){for(let r=0;r<n;r++)for(let o in t)if(t.hasOwnProperty(o)&&s[r][o]===t[o])return s[r];return-1}for(let r=0;r<n;r++)if(s[r][t]===e)return s[r];return null}indexOfAny(p,t,e){let s;if(!p||p.length===0||!this[p]||this[p].length===0)return null;s=se(this[p]);let n=s.length;if(typeof t=="object"){for(let r=0;r<n;r++)for(let o in t)if(t.hasOwnProperty(o)&&s[r][o]===t[o])return this[p].indexOf(s[r]);return-1}for(let r=0;r<n;r++)if(s[r][t]===e)return this[p].indexOf(s[r]);return-1}indexOf(p,t,e){let s;if(!p||p.length===0||!this[p]||this[p].length===0)return null;s=se(this[p]);let n=s.length;if(typeof t=="object"){for(let r=0;r<n;r++){for(let o in t)t.hasOwnProperty(o)&&(s[r][o],t[o]);return this[p].indexOf(s[r])}return-1}for(let r=0;r<n;r++)if(s[r][t]===e)return this[p].indexOf(s[r]);return-1}},Bt=class f{constructor(p){this.items={};this.keys=[];this.add(p??Be.Default)}SortByPriority(){this.keys.sort((p,t)=>{let e=this.items[p].priority,s=this.items[t].priority;return e>s?-1:e<s?1:p==="default"?-1:t==="default"||(e=this.items[p].name,s=this.items[t].name,e>s)?1:e<s?-1:0})}enabled(p){return!p||this.keys.length===0?!1:typeof p=="string"?this.items[p.toLowerCase()]?this.items[p.toLowerCase()].enabled:!1:this.items[p.name.toLowerCase()]?this.items[p.name.toLowerCase()].enabled:!1}contains(p){return!p||this.keys.length===0?!1:typeof p=="string"?!!this.items[p.toLowerCase()]:!!this.items[p.name.toLowerCase()]}canDisable(p){if(!p||this.keys.length===0)return!1;let t;if(typeof p=="number"){if(p<0||p>=this.keys.length)return!1;t=this.keys[p]}else if(typeof p=="object")t=p.name.toLowerCase();else if(typeof p=="string")t=p.toLowerCase();else return!1;if(!this.items[t])return!1;if(!!this.items[t].enabled){let s=!1;for(let n in this.items)if(n!==t){this.items[n].enabled&&(s=!0);break}if(!s)return!1}return!0}toggle(p){if(!p||this.keys.length===0)return!1;let t;if(typeof p=="number"){if(p<0||p>=this.keys.length)return!1;t=this.keys[p]}else if(typeof p=="object")t=p.name.toLowerCase();else if(typeof p=="string")t=p.toLowerCase();else return!1;if(!this.items[t])return!1;let e=!this.items[t].enabled;if(!e){let s=!1;for(let n in this.items)if(n!==t){this.items[n].enabled&&(s=!0);break}if(!s)return!1}return this.items[t].enabled=e,!0}update(){this.keys=Object.keys(this.items),this.SortByPriority()}add(p,t){p&&(this.items[p.name.toLowerCase()]=p,t||this.update())}remove(p){if(!(!p||this.keys.length===0)){if(typeof p=="string")delete this.items[p.toLowerCase()];else if(typeof p=="number"){if(p<0||p>=this.keys.length)return;delete this.items[this.keys[p]]}else delete this.items[p.name.toLowerCase()];this.update()}}copy(p){return p?this.keys.length===0?null:typeof p=="string"?this.items[p.toLowerCase()]?this.items[p.toLowerCase()].clone():null:typeof p=="number"?p<0||p>=this.keys.length?null:this.items[this.keys[p]].clone():p.clone():_e(this.items)}clone(p){if(p===2){let e={};for(let s in this.items)e[this.items[s].name.toLowerCase()]=this.items[s].clone(2);return e}let t=new f;for(let e in this.items)t.items[this.items[e].name.toLowerCase()]=this.items[e].clone();return t.update(),t}static load(p){return new Promise((t,e)=>{let s=new f;localforage.getItem(p||"OoMUDProfiles").then(n=>{if(typeof n=="string"&&(n=JSON.parse(n)),!n)s.add(Be.Default);else{let r=Object.keys(n),o=0,a=r.length;for(;o<a;o++)s.add(Be.load(n[r[o]]))}t(s)}).catch(e)})}save(p){let t=JSON.parse(JSON.stringify(this.items,(e,s)=>{if(e!=="profile")return s}));return(!p||p==="OoMUDProfiles")&&(t.Default=t.default,delete t.default),localforage.setItem(p||"OoMUDProfiles",t)}get length(){return this.keys.length}count(){return this.keys.length}get active(){let p=this.keys;if(p.length===0)return this.add(Be.Default),this.items.default;if(p.length===1)return this.items[p[0]].enabled?this.items[p[0]]:this.items[p[0]].name==="Default"?(this.items[p[0]].enable=!0,this.items.default):(this.add(Be.Default),this.items.default);for(let t in p)if(this.items[p[t]].enabled)return this.items[p[t]];return this.items.default?(this.items.default.enabled=!0,this.items.default):(this.add(Be.Default),this.items.default)}get aliases(){let p=this.keys,t=[],e=0,s=p.length;if(s===0)return[];if(s===1)return!this.items[p[0]].enabled||!this.items[p[0]].enableAliases?[]:this.items[p[0]].aliases;for(;e<s;e++)!this.items[p[e]].enabled||!this.items[p[e]].enableAliases||this.items[p[e]].aliases.length===0||(t=t.concat(this.items[p[e]].aliases));return t}get triggers(){let p=this.keys,t=[],e=0,s=p.length;if(s===0)return[];if(s===1)return!this.items[p[0]].enabled||!this.items[p[0]].enableTriggers?[]:this.items[p[0]].triggers;for(;e<s;e++)!this.items[p[e]].enabled||!this.items[p[e]].enableTriggers||this.items[p[e]].triggers.length===0||(t=t.concat(this.items[p[e]].triggers));return t}get macros(){let p=this.keys,t=[],e=0,s=p.length;if(s===0)return[];if(s===1)return!this.items[p[0]].enabled||!this.items[p[0]].enableMacros?[]:this.items[p[0]].macros;for(;e<s;e++)!this.items[p[e]].enabled||!this.items[p[e]].enableMacros||this.items[p[e]].macros.length===0||(t=t.concat(this.items[p[e]].macros));return t}get buttons(){let p=this.keys,t=[],e=0,s=p.length;if(s===0)return[];if(s===1)return!this.items[p[0]].enabled||!this.items[p[0]].enableButtons?[]:this.items[p[0]].buttons;for(;e<s;e++)!this.items[p[e]].enabled||!this.items[p[e]].enableButtons||this.items[p[e]].buttons.length===0||(t=t.concat(this.items[p[e]].buttons));return t}get contexts(){let p=this.keys,t=[],e=0,s=p.length;if(s===0)return[];if(s===1)return!this.items[p[0]].enabled||!this.items[p[0]].enableContexts?[]:this.items[p[0]].contexts;for(;e<s;e++)!this.items[p[e]].enabled||!this.items[p[e]].enableContexts||this.items[p[e]].contexts.length===0||(t=t.concat(this.items[p[e]].contexts));return t}get defaultContext(){let p=this.keys,t=0,e=p.length;if(e===0)return!0;if(e===1)return this.items[p[0]].enabled?this.items[p[0]].enableDefaultContext:!0;for(;t<e;t++)if(this.items[p[t]].enabled&&!this.items[p[t]].enableDefaultContext)return!1;return!0}};function Pt(f,p){if(!f||!f.length)return"";let t;(C=>(C[C.None=0]="None",C[C.Ampersand=1]="Ampersand",C[C.Percent=2]="Percent",C[C.StringMatch=3]="StringMatch",C[C.SubPattern=4]="SubPattern",C[C.AmpersandPercent=5]="AmpersandPercent",C[C.AmpersandPattern=6]="AmpersandPattern",C[C.AmpersandRange=7]="AmpersandRange",C[C.PercentRegex=8]="PercentRegex",C[C.Escape=9]="Escape",C[C.Variable=10]="Variable"))(t||={});let e=0,s=[],n=0,r=f.length,o,a,h,c,g=0;for(n=0;n<r;n++)switch(o=f.charAt(n),a=f.charCodeAt(n),e){case 1:if(h.length===0&&(o==="*"||o==="?"||o==="^"||o==="$"))c=o;else if(h.length===0&&o==="%")e=5;else if(c.length===0&&o==="(")c=o,e=6;else if(c.length===0&&o==="[")c=o,e=7;else{if(o==="{")continue;if(o==="}"||!(a>=48&&a<=57||a>=65&&a<=90||a>=97&&a<=122||a===95||a===36)){if(!ot(h))throw new Error("Invalid variable name");!c.length&&/^\d+$/.exec(h)?s.push("{",h,"}"):c.length?s.push("(?<",h,">",Pt(c),")"):s.push("(?<",h,">.*)"),o!=="}"&&n--,e=0}else h+=o}break;case 5:c+="%"+o,e=1;break;case 6:c+=o,o===")"&&(e=1);break;case 7:c+=o,o==="]"&&(e=1);break;case 2:switch(o){case"d":s.push("\\d+"),e=0;break;case"n":s.push("[+-]?\\d+"),e=0;break;case"w":s.push("\\w"),e=0;break;case"a":s.push("[a-zA-Z0-9]*"),e=0;break;case"s":s.push("\\s*"),e=0;break;case"x":s.push("\\S*"),e=0;break;case"y":s.push("\\S*"),e=0;break;case"p":s.push(`[\\.\\?\\!\\:\\;\\-\\\u2014\\(\\)\\[\\]\\'\\"\\\\/\\,]{1}`),e=0;break;case"q":s.push(`[\\.\\?\\!\\:\\;\\-\\\u2014\\(\\)\\[\\]\\'\\"\\\\/\\,]{1}`),e=0;break;case"t":e=0;break;case"e":s.push("\x1B"),e=0;break;case"/":e=8,h="";break}break;case 8:if(o==="%"){if(!h.endsWith("/"))throw new Error("Invalid %/regex/% pattern");s.push(h.substr(0,h.length-1))}else h+=o;break;case 3:o==="^"&&h.length===0?c=!0:o==="}"?(c?s.push("[^",h,"]"):s.push(h),e=0):h+=o;break;case 4:o===":"?(s.push("(?<",h,">"),e=0):o===")"?(s.push("(",Pt(h),")"),e=0,g--):h+=o;break;case 9:s.push("\\",o),e=0;break;case 10:if(o==="{"&&h.length===0)continue;if(o==="}"||!(a>=48&&a<=57||a>=65&&a<=90||a>=97&&a<=122||a===95||a===36)){if(!ot(h))throw new Error("Invalid variable name");p&&(p.variables[h]instanceof si?s.push(p.variables[h].value||""):s.push(p.variables[h]||"")),o!=="}"&&n--,e=0}else h+=o;break;default:o==="*"?s.push(".*"):o==="?"?s.push("."):o==="~"?e=9:o==="@"?(e=10,h=""):o==="&"?(h="",c="",e=1):o==="%"?e=2:o==="{"?(e=3,h=""):o==="("?(e=4,h="",g++):(o===")"&&g--,s.push(o));break}switch(e){case 1:if(!ot(h))throw new Error("Invalid variable name");!c.length&&/^\d+$/.exec(h)?s.push("{",h,"}"):c.length?s.push("(?<",h,">",Pt(c),")"):s.push("(?<",h,">.*)");break;case 5:case 6:case 7:throw new Error("Invalid &VarName pattern");case 2:throw new Error("Invalid % pattern");case 8:throw new Error("Invalid %/regex/% pattern");case 3:throw new Error("Invalid string match pattern");case 4:throw new Error("Invalid (sub:pattern) pattern");case 9:throw new Error("Invalid escape pattern");case 10:if(!ot(h))throw new Error("Invalid variable name");p&&(p.variables[h]instanceof si?s.push(p.variables[h].getValue()||""):s.push(p.variables[h]||""));break}if(g)throw new Error("Invalid save matched pattern");return s.join("")}var Vt,xt,ni=["$selectedword","$selword","$selectedurl","$selurl","$selectedline","$selline","$selected","$character","$copied","$action","$trigger","$caption","$characterid"];function ri(f){return f.replace(/\w*\S*/g,p=>p.charAt(0).toUpperCase()+p.substr(1).toLowerCase())}function ms(){switch(~~(Math.random()*6)+1){case 1:case 4:return-1;case 3:case 2:return 1}return 0}var ft=class extends Error{constructor(p){super(`Invalid arguments '${p}'`)}},be=class extends Error{constructor(p,t){super(`Invalid argument '${p.toString()}' must be a number for ${t}`)}},ie=class extends Error{constructor(p){super(`Missing arguments for ${p}`)}},_=class extends Error{constructor(p){super(`Too many arguments for ${p}`)}},Le=class extends Error{constructor(){super("Invalid fore color")}},Ze=class extends Error{constructor(){super("Invalid back color")}},ce=class extends Error{constructor(p){super(`Invalid trigger ${p}`)}},Me=class extends Error{constructor(p){super(`Invalid temporary trigger ${p}`)}},De=class extends Error{constructor(p){super(`Profile not found: ${p}`)}},qe=class extends Error{constructor(p,t){super(`Trigger not found${p?`: ${p}`:""}${t?` in profile: ${t}`:""}`)}},li=class extends me{constructor(t){super();this.St=-1;this.mi=-1;this.Ot=null;this.Il=0;this.gi=null;this.Oe={};this.Un={};this.Xs={};this.Dt="";this.Ls=null;this.ls=!1;this.Vi=0;this.Zn=[];this.Lt=[];this.ft=[];this.Yn=[];this.qs={};this.Is=0;this.os=null;this.Cs=-1;this.Cl={};this._a=[];this.Ts=[];this.Tl=null;this.eh=!1;this._=null;this.enableParsing=!0;this.enableTriggers=!0;if(!t)throw new Error("Invalid client!");this._=t,this.be=this._.commandInput,this.ge=this._.display,Vt=()=>xt||(this.Ro(),xt),this.ct=[],document.addEventListener("keydown",e=>{!this.isLocked&&this.ProcessMacros(e.which,e.altKey,e.ctrlKey,e.shiftKey,e.metaKey)?(e.preventDefault(),e.stopPropagation()):e.key==="ScrollLock"&&this.toggleScrollLock()}),this._.on("parse-command",e=>{this.se("parseCommands")&&(e.value=this.parseOutgoing(e.value,null,null,null,null,!e.comments))}),this._.on("add-line",e=>{if(this.ExecuteTriggers(140,e.line,e.raw,e.fragment,!1,!0),this.Vi>0&&!e.fragment&&(e.gagged=!0,this.Vi--),!e.fragment)for(let s in this.Oe)this.Oe[s].lineCount&&this.Oe[s].lineCount--}),this._.on("options-loaded",()=>{!xt&&this.se("initializeScriptEngineOnLoad")&&this.Ro(),this.Ml()}),this.be.addEventListener("keyup",e=>{e.key!=="Escape"&&e.key!=="ArrowUp"&&e.key!=="ArrowDown"&&(this.St=this.ct.length)}),this.be.addEventListener("keydown",e=>{switch(e.key){case"Escape":if(e.ctrlKey||e.shiftKey||e.metaKey||e.altKey)return;this.be.blur(),this.be.value="",this.be.select(),this.St=this.ct.length,this.mi=-1,this.Ot=null,this.rs=null,this.emit("history-navigate",e);break;case"ArrowUp":if(e.ctrlKey||e.shiftKey||e.metaKey||e.altKey)return;this.St===this.ct.length&&this.be.value.length>0&&(this.AddCommandToHistory(this.be.value),this.be.value===this.ct[this.St-1]&&this.St--),this.St--,this.St<0&&(this.St=0),this.ct.length<0?(this.St=-1,this.be.value=""):this.ct.length>0&&this.St<this.ct.length&&this.St>=0&&(this.be.value=this.ct[this.St]),setTimeout(()=>this.be.select(),0),this.emit("history-navigate",e);break;case"ArrowDown":if(e.ctrlKey||e.shiftKey||e.metaKey||e.altKey)return;this.St===this.ct.length&&this.be.value.length>0&&this.AddCommandToHistory(this.be.value),this.St++,this.St>=this.ct.length||this.ct.length<1?(this.St=this.ct.length,this.be.value=""):this.ct.length>0&&this.St<this.ct.length&&this.St>=0&&(this.be.value=this.ct[this.St]),setTimeout(()=>this.be.select(),0),this.emit("history-navigate",e);break;case"Enter":switch(this.se("newlineShortcut")){case 1:if(e.ctrlKey&&!e.shiftKey&&!e.metaKey&&!e.altKey)return et(this.be,`
`),this.emit("history-navigate",e),this.be.blur(),this.be.focus(),!0;break;case 8:if(e.ctrlKey&&e.shiftKey&&!e.metaKey&&!e.altKey)return et(this.be,`
`),this.emit("history-navigate",e),this.be.blur(),this.be.focus(),!0;break;case 4:if((e.ctrlKey||e.shiftKey)&&!e.metaKey&&!e.altKey)return et(this.be,`
`),this.emit("history-navigate",e),this.be.blur(),this.be.focus(),!0;break;case 2:if(e.ctrlKey&&e.shiftKey&&!e.metaKey&&!e.altKey)return et(this.be,`
`),this.emit("history-navigate",e),this.be.blur(),this.be.focus(),!0;break}!e.ctrlKey&&!e.shiftKey&&!e.metaKey&&!e.altKey&&(this.mi=-1,this.Ot=null,this.rs=null,e.preventDefault(),this._.sendCommand(null,null,this.se("allowCommentsFromCommand")),this.emit("history-navigate",e)),e.preventDefault();break;case"Tab":if(!this.se("enableTabCompletion")||this.be.value.length===0||e.altKey||e.ctrlKey||e.metaKey)return;e.shiftKey?this.mi--:this.mi++;let s=this.be.selectionStart,n=this.be.selectionEnd;if(this.Ot===null){let o=hs(this.be),a=this.be.value.indexOf(" ",o);a===-1&&(a=this.be.value.indexOf(`
`,o));let h=this.be.value.lastIndexOf(" ",o-1);h===-1&&(h=this.be.value.indexOf(`
`,o-1)),a===-1&&(a=this.be.value.length),h===-1?h=0:h++,s=h,n=a,s===n&&n++;let c=this.be.value.substring(h,a);if(c.length===0)return;this.rs={start:h,end:a,find:c.length};let g=new RegExp(`^${c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}`,this.se("ignoreCaseTabCompletion")?"i":"");this.se("tabCompletionLookupType")===8?this.Ot=[...new Set(this.se("tabCompletionList").split(/\s+/).filter(m=>m.match(g)))]:(this.Ot=[].concat(...this.ge.lines.slice(this.ge.lines.length-this.se("tabCompletionBufferLimit")).map(m=>m.text.split(/\s+/))).filter(m=>m.match(g)).reverse(),this.se("tabCompletionLookupType")===1?this.Ot=[...new Set(this.se("tabCompletionList").split(/\s+/).filter(m=>m.match(g)).reverse())].concat(this.Ot):this.se("tabCompletionLookupType")===2&&(this.Ot=this.Ot.concat([...new Set(this.se("tabCompletionList").split(/\s+/).filter(m=>m.match(g)).reverse())])),this.Ot=[...new Set(this.Ot)])}else s-=this.rs.find;if(this.Ot.length===0)return;this.mi<0&&(this.mi=this.Ot.length-1),this.mi>=this.Ot.length&&(this.mi=0);let r=this.se("tabCompletionReplaceCasing");this.be.value=this.be.value.substring(0,s)+(r===1?this.Ot[this.mi].toLowerCase():r===2?this.Ot[this.mi].toUpperCase():this.Ot[this.mi])+this.be.value.substring(n,this.be.value.length),this.be.selectionStart=this.rs.start+this.rs.find,this.be.selectionEnd=this.rs.start+this.Ot[this.mi].length,e.preventDefault(),this.emit("history-navigate",e);break;case"Shift":case"Control":case"Meta":case"Alt":case"CapsLock":case"Fn":case"NumLock":case"ScrollLock":case"Super":case"PageDown":case"PageUp":case"End":case"Home":case"ArrowLeft":case"ArrowRight":case"ContextMenu":break;default:this.mi=-1,this.Ot=null,this.rs=null;break}}),this.be.addEventListener("mouseup",e=>{this.mi=-1,this.Ot=null,this.rs=null}),window.addEventListener("gamepadconnected",e=>{this.se("gamepads")&&(this.os||(this.os=[]),this.qs[e.gamepad.index]={pad:e.gamepad,axes:_e(e.gamepad.axes),state:{axes:[],buttons:[]},pState:{axes:[],buttons:[]}},this.Is++,this.jn())}),window.addEventListener("gamepaddisconnected",e=>{this.se("gamepads")&&(delete this.qs[e.gamepad.index],this.Is--)}),this.Ml()}getScope(){let t={};if(Object.assign(t,this._.variables),ni.forEach(e=>{t[e]=window[e],t[e.substr(1)]=window[e]}),this.ft.length===0||!this.stack.named&&!this.loops.length)return t;if(this.stack.named&&Object.assign(t,this.stack.named),this.loops.length){t.repeatnum=this.repeatnum;let e=this.loops.length;for(let s=0;s<e&&s<18;s++)t[String.fromCharCode(105+s)]=this.loops[s]}return t}setScope(t){if(t===this._.variables)return;let e=this.loops.length;for(let s in t)if(!(!Object.prototype.hasOwnProperty.call(t,s)||s==="i"||s==="repeatnum")&&!(ni.indexOf(s)!==-1||ni.indexOf("$"+s)!==-1)){switch(s){case"clientid":continue}s.length===1&&e&&s.charCodeAt(0)>=105&&s.charCodeAt(0)<105+e||this.stack.named&&Object.prototype.hasOwnProperty.call(this.stack.named,s)||(this._.variables[s]=t[s])}}evaluate(t){let e=this.getScope(),s=Vt().evaluate(t,e);return this.setScope(e),s}get stack(){return this.ft.length===0&&this.ft.push({args:0,named:0,used:0,append:!1}),this.ft[this.ft.length-1]}get repeatnum(){return this.loops.length===0?0:this.loops[this.loops.length-1]}get loops(){return this.ft.length===0||!this.stack.hasOwnProperty("loops")?this._a:this.stack.loops}get regex(){let t=this.ft.length;if(t===0)return null;for(;t>=0;)if(t--,this.ft[t].hasOwnProperty("regex"))return this.ft[t].regex;return null}get indices(){let t=this.ft.length;if(t===0)return[];for(;t>=0;)if(t--,this.ft[t].hasOwnProperty("indices"))return this.ft[t].indices;return[]}get vStack(){return this.Yn.length===0?{}:this.Yn[this.Yn.length-1]}vStackPush(t){this.Yn.push(t)}vStackPop(){this.Yn.pop()}get scrollLock(){return this.ls}set scrollLock(t){t!==this.ls&&(this.ls=t,this.emit("scroll-lock",this.scrollLock))}get lastTriggerExecuted(){return this.Ls}get lastTriggered(){return this.Dt}set lastTriggered(t){this.Dt=t}wn(t,e,s){let n=/(\d+)\s*?d(F|f|%|\d+)(\s*?[-|+|*|\/]?\s*?\d+)?/g.exec(t.toString());if(!n||n.length<3)if(n=/(\d+)\s*?d\s*?\/\s*?(100)(\s*?[-|+|*|\/]?\s*?\d+)?/g.exec(t.toString()),!n||n.length<3){if(t=t.compile().evaluate(e),n=/(\d+)\s*?d(F|f|%|\d+)(\s*?[-|+|*|\/]?\s*?\d+)?/g.exec(t.toString()),!n||n.length<3){if(n=/(\d+)\s*?d\s*?\/\s*?(100)(\s*?[-|+|*|\/]?\s*?\d+)?/g.exec(t.toString()),!n||n.length<3)throw new Error("Invalid dice for "+(s||"dice"));n[2]="%"}}else n[2]="%";return n}Ro(){xt=math;let t={esc:"\x1B",cr:`
`,lf:"\r",crlf:`\r
`,diceavg:(e,s,n)=>{let r,o,a,h,c,g;if(e.length===0)throw new ft("diceavg");if(e.length===1)r=this.wn(e[0],n,"diceavg"),o=parseInt(r[1]),a=r[2],r.length>3&&(h=r[3]);else if(e.length<4)o=e[0].compile().evaluate(n),a=e[1].toString().trim(),a!=="F"&&a!=="%"&&(a=e[1].compile().evaluate(n)),e.length>2&&(h=e[2].compile().evaluate(n));else throw new _("diceavg");return c=1,a==="F"||a==="f"?(c=-1,g=1):a==="%"?(g=1,c=0):g=parseInt(a),h?s.evaluate((c+g)/2*o+h,n):(c+g)/2*o},dicemin:(e,s,n)=>{let r,o,a,h,c;if(e.length===0)throw new ft("dicemin");if(e.length===1)r=r=this.wn(e[0],n,"dicemin"),o=parseInt(r[1]),a=r[2],r.length>3&&(h=r[3]);else if(e.length<4)o=e[0].compile().evaluate(n),a=e[1].toString().trim(),a!=="F"&&a!=="%"&&(a=e[1].compile().evaluate(n)),e.length>2&&(h=e[2].compile().evaluate(n));else throw new _("dicemin");return c=1,a==="F"||a==="f"?c=-1:a==="%"&&(c=0),h?s.evaluate(c*o+h,n):c*o},dicemax:(e,s,n)=>{let r,o,a,h,c;if(e.length===0)throw new ft("dicemax");if(e.length===1)r=this.wn(e[0],n,"dicemax"),o=parseInt(r[1]),a=r[2],r.length>3&&(h=r[3]);else if(e.length<4)o=e[0].compile().evaluate(n),a=e[1].toString().trim(),a!=="F"&&a!=="%"&&(a=e[1].compile().evaluate(n)),e.length>2&&(h=e[2].compile().evaluate(n));else throw new _("dicemax");return a==="F"||a==="f"||a==="%"?c=1:c=parseInt(a),h?s.evaluate(c*o+h,n):c*o},dicedev:(e,s,n)=>{let r,o,a,h,c;if(e.length===0)throw new ft("dicedev");if(e.length===1)r=this.wn(e[0],n,"dicedev"),o=parseInt(r[1]),a=r[2],r.length>3&&(h=r[3]);else if(e.length<4)o=e[0].compile().evaluate(n),a=e[1].toString().trim(),a!=="F"&&a!=="%"&&(a=e[1].compile().evaluate(n)),e.length>2&&(h=e[2].compile().evaluate(n));else throw new _("dicedev");return a==="F"||a==="f"?c=6:a==="%"?c=1:c=parseInt(a),h?s.evaluate(Math.sqrt((c*c-1)/12*o)+h,n):Math.sqrt((c*c-1)/12*o)},zdicedev:(e,s,n)=>{let r,o,a,h,c;if(e.length===0)throw new ft("zdicedev");if(e.length===1)r=this.wn(e[0],n,"zdicedev"),o=parseInt(r[1]),a=r[2],r.length>3&&(h=r[3]);else if(e.length<4)o=e[0].compile().evaluate(n),a=e[1].toString().trim(),a!=="F"&&a!=="%"&&(a=e[1].compile().evaluate(n)),e.length>2&&(h=e[2].compile().evaluate(n));else throw new _("zdicedev");return a==="F"||a==="f"?c=6:a==="%"?c=1:c=parseInt(a),c--,h?s.evaluate(Math.sqrt((c*c-1)/12*o)+h,n):Math.sqrt((c*c-1)/12*o)},dice:(e,s,n)=>{let r,o,a,h;if(e.length===1)r=this.wn(e[0],n,"dice"),o=parseInt(r[1]),a=r[2],r.length>3&&(h=r[3]);else if(e.length>1)o=e[0].compile().evaluate(n),a=e[1].toString().trim(),a!=="F"&&a!=="%"&&(a=e[1].compile().evaluate(n)),e.length>2&&(h=e[2].compile().evaluate(n));else throw new ft("dice");let c=0;for(let g=0;g<o;g++)a==="F"||a==="f"?c+=ms():a==="%"?c+=~~(Math.random()*100)+1:c+=~~(Math.random()*a)+1;return a==="%"&&(c/=100),h?s.evaluate(c+h,n):c},isdefined:(e,s,n)=>{if(e.length===1)return e[0]=this.stripQuotes(e[0].toString()),this._.variables.hasOwnProperty(e[0])||n.has(e[0])?1:0;throw new ft(" isdefined")},defined:(e,s,n)=>{let r;if(e.length===0)throw new ie("defined");if(e.length===1){e[0]=this.stripQuotes(e[0],!0);let o=this.ee.keys,a=0,h=o.length;if(h===0)return 0;for(;a<h;a++)if(r=se(this.ee.items[o[a]].aliases),r=r.find(c=>c.pattern===e[0]),r||(r=se(this.ee.items[o[a]].triggers),r=r.find(c=>c.pattern===e[0]||c.name===e[0]),r)||(r=se(this.ee.items[o[a]].macros),r=r.find(c=>It(c).toLowerCase()===e[0].toLowerCase()||c.name===e[0]),r)||(r=se(this.ee.items[o[a]].aliases),r=r.find(c=>c.caption===e[0]||c.name===e[0]),r))return 1;return this._.variables.hasOwnProperty(e[0])}else if(e.length===2){e[0]=this.stripQuotes(e[0].toString()),e[0]=this.stripQuotes(e[1].toString());let o=this.ee.keys,a=0,h=o.length;if(h===0)return 0;for(;a<h;a++)switch(e[1]){case"alias":return r=se(this.ee.items[o[a]].aliases),r=r.find(c=>c.pattern===e[0]),r?1:0;case"event":return r=se(this.ee.items[o[a]].triggers),r=r.find(c=>c.type===2&&(c.pattern===e[0]||c.name===e[0])),r?1:0;case"trigger":return r=se(this.ee.items[o[a]].triggers),r=r.find(c=>c.pattern===e[0]||c.name===e[0]),r?1:0;case"macro":return r=se(this.ee.items[o[a]].macros),r=r.find(c=>It(c).toLowerCase()===e[0].toLowerCase()||c.name===e[0]),r?1:0;case"button":return r=se(this.ee.items[o[a]].aliases),r=r.find(c=>c.caption===e[0]||c.name===e[0]),r?1:0}if(e[1]==="variable")return this._.variables.hasOwnProperty(e[0])||n.has(e[0])}else throw new _("defined");return 0},time:(e,s,n)=>{if(e.length>1)throw new _("time");return moment?e.length?moment().format(e[0].compile().evaluate(n)):moment().format():new Date().toISOString()},clip:(e,s,n)=>{if(e.length>1)throw new _("clip");if(e.length){this._.writeClipboard(e[0].compile().evaluate(n));return}return this._.readClipboard()},if:(e,s,n)=>{if(e.length<3)throw new ie("if");if(e.length!==3)throw new _("if");return e[0].compile().evaluate(n)?e[1].compile().evaluate(n):e[2].compile().evaluate(n)},len:(e,s,n)=>{if(e.length===0)throw new ie("len");if(e.length!==1)throw new _("len");return e[0].compile().evaluate(n).toString().length},stripansi:(e,s,n)=>{if(e.length===0)throw new ie("Missing arguments for len");if(e.length!==1)throw new _("len");let r=new RegExp("[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)|(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-nq-uy=><~]))","g");return e[0].compile().evaluate(n).toString().replace(r,"")},ansi:(e,s,n)=>{if(e.length===0)throw new ie("ansi");e=e.map(g=>ut(g.toString())===-1&&g.toString()!=="current"?g.compile().evaluate(n).toString():g.toString());let r=e.length,o=[],a={},h,c;for(h=0;h<r;h++)if(e[h].trim()==="current")o.push(e[h].trim());else{if(c=ut(e[h].trim()),c===-1)throw new Error("Invalid color or style for ansi");c>=0&&c<30?a[c]=1:o.push(e[h])}if(o.length>2)throw new Error("Too many colors for ansi");if(o.length>1&&(o[1]==="current"?o[1]="":o[1]=ut(o[1],!0)),o.length>0&&(a[1]&&o[0]==="white"||o[0]==="current"?o[0]="":o[0]=ut(o[0])),a=[...Object.keys(a),...o],!a.length)throw new Error("Invalid colors or styles for ansi");return a=a.filter(g=>g!==""),`\x1B[${a.join(";")}m`},color:(e,s,n)=>{if(e.length===0)throw new ie("color");e=e.map(a=>ut(a.toString())===-1&&a.toString()!=="current"?a.compile().evaluate(n).toString():a.toString());let r,o;if(e.length===1){if(e[0]==="bold")return"370";if(r=xe(e[0]),r===-1)throw new Le;return r.toString()}else if(e.length===2){if(e[0]==="bold")r=370;else{if(r=xe(e[0]),r===-1)throw new Le;if(e[1]==="bold")return(r*10).toString()}if(o=r.toString(),r=xe(e[1],!0),r===-1)throw new Ze;return o+","+r.toString()}else if(e.length===3){if(e[0]==="bold"&&(e.shift(),e.push("bold")),e[2]!=="bold")throw new Error("Only bold is supported as third argument for color");if(r=xe(e[0]),r===-1)throw new Le;if(o=(r*10).toString(),r=xe(e[1],!0),r===-1)throw new Ze;return o+","+r.toString()}throw new _("color")},zcolor:(e,s,n)=>{if(e.length===0)throw new ie("zcolor");if(e.length>1)throw new _("zcolor");return zi(parseInt(e[0].compile().evaluate(n),10))},case:(e,s,n)=>{if(e.length===0)throw new ie("case");let r=e[0].compile().evaluate(n);return r>0&&r<e.length?e[r].compile().evaluate(n):null},switch:(e,s,n)=>{if(e.length===0)throw new ie("switch");if(e.length%2===1)throw new Error("All expressions must have a value for switch");let r=e.length;for(let o=0;o<r;o+=2)if(e[o].compile().evaluate(n))return e[o+1].compile().evaluate(n);return null},ascii:(e,s,n)=>{if(e.length===0)throw new ie("ascii");if(e.length>1)throw new _("ascii");if(e[0].toString().trim().length===0)throw new Error("Invalid argument, empty string for ascii");return e[0].toString().trim().charCodeAt(0)},char:(e,s,n)=>{if(e.length===0)throw new ie("char");if(e.length>1)throw new _("char");let r=e[0].compile().evaluate(n);if(isNaN(r))throw new be(e[0],"char");return String.fromCharCode(r)},bitand:(e,s,n)=>{if(e.length===0)throw new ie("bitand");if(e.length!==2)throw new _("bitand");let r=e[0].compile().evaluate(n);if(isNaN(r))throw new be(e[0],"bitand");let o=e[1].compile().evaluate(n);if(isNaN(o))throw new be(e[1],"bitand");return r&o},bitnot:(e,s,n)=>{if(e.length===0)throw new ie("bitnot");if(e.length!==1)throw new _("bitnot");let r=e[0].compile().evaluate(n);if(isNaN(r))throw new be(e[0],"bitnot");return~r},bitor:(e,s,n)=>{if(e.length===0)throw new ie("bitor");if(e.length!==2)throw new _("bitor");let r=e[0].compile().evaluate(n);if(isNaN(r))throw new be(e[0],"bitor");let o=e[1].compile().evaluate(n);if(isNaN(o))throw new be(e[1],"bitor");return r|o},bitset:(e,s,n)=>{if(e.length===0)throw new ie("bitset");if(e.length>3)throw new _("bitset");let r=e[0].compile().evaluate(n);if(isNaN(r))throw new be(e[0],"bitset");let o=e[1].compile().evaluate(n);if(isNaN(o))throw new be(e[1],"bitset");o--;let a=1;if(e.length===3&&(a=e[2].compile().evaluate(n),isNaN(a)))throw new be(e[2],"bitset");return r&~(1<<o)|(a?1:0)<<o},bitshift:(e,s,n)=>{if(e.length===0)throw new ie("bitshift");if(e.length!==2)throw new _("bitshift");let r=e[0].compile().evaluate(n);if(isNaN(r))throw new be(e[0],"bitshift");let o=e[1].compile().evaluate(n);if(isNaN(o))throw new be(e[1],"bitshift");return o<0?r>>-o:r<<o},bittest:(e,s,n)=>{if(e.length===0)throw new ie("bittest");if(e.length!==2)throw new _("bittest");let r=e[0].compile().evaluate(n);if(isNaN(r))throw new be(e[0],"bittest");let o=e[1].compile().evaluate(n);if(isNaN(o))throw new be(e[1],"bittest");return o--,(r>>o)%2!=0?1:0},bitxor:(e,s,n)=>{if(e.length===0)throw new ie("bitxor");if(e.length!==2)throw new _("bitxor");let r=e[0].compile().evaluate(n);if(isNaN(r))throw new be(e[0],"bitxor");let o=e[1].compile().evaluate(n);if(isNaN(o))throw new be(e[1],"bitxor");return r^o},tonumber:(e,s,n)=>{if(e.length===0)throw new ie("number");if(e.length>1)throw new _("number");return e[0]=e[0].compile().evaluate(n).toString(),e[0].match(/^\s*?[-|+]?\d+\s*?$/)?parseInt(e[0],10):e[0].match(/^\s*?[-|+]?\d+\.\d+\s*?$/)?parseFloat(e[0]):e[0]==="true"?1:(e[0]==="false",0)},isfloat:(e,s,n)=>{if(e.length===0)throw new ie("isfloat");if(e.length>1)throw new _("isfloat");return e[0]=e[0].compile().evaluate(n).toString(),e[0].match(/^\s*?[-|+]?\d+\.\d+\s*?$/)?1:0},isnumber:(e,s,n)=>{if(e.length===0)throw new ie("isnumber");if(e.length>1)throw new _("isnumber");return e[0]=e[0].compile().evaluate(n).toString(),e[0].match(/^\s*?[-|+]?\d+\s*?$/)||e[0].match(/^\s*?[-|+]?\d+\.\d+\s*?$/)?1:0},tostring:(e,s,n)=>{if(e.length===0)throw new ie("string");if(e.length>1)throw new _("string");return e[0].compile().evaluate(n).toString()},float:(e,s,n)=>{if(e.length===0)throw new ie("float");if(e.length>1)throw new _("float");return e[0]=e[0].compile().evaluate(n).toString(),e[0].match(/^\s*?[-|+]?\d+\s*?$/)||e[0].match(/^\s*?[-|+]?\d+\.\d+\s*?$/)?parseFloat(e[0]):e[0]==="true"?1:(e[0]==="false",0)},trim:(e,s,n)=>{if(e.length!==1)throw new ie("trim");return e[0].compile().evaluate(n).toString().trim()},trimleft:(e,s,n)=>{if(e.length!==1)throw new ie("trimleft");return e[0].compile().evaluate(n).toString().trimLeft()},trimright:(e,s,n)=>{if(e.length!==1)throw new ie("trimright");return e[0].compile().evaluate(n).toString().trimRight()},pos:(e,s,n)=>{if(e.length<2)throw new ie("pos");if(e.length>2)throw new _("pos");return e[0]=e[0].compile().evaluate(n).toString(),e[1]=e[1].compile().evaluate(n).toString(),e[1].indexOf(e[0])+1},ipos:(e,s,n)=>{if(e.length<2)throw new ie("pos");if(e.length>2)throw new _("pos");return e[0]=e[0].compile().evaluate(n).toString().toLowerCase(),e[1]=e[1].compile().evaluate(n).toString().toLowerCase(),e[1].indexOf(e[0])+1},ends:(e,s,n)=>{if(e.length<2)throw new ie("ends");if(e.length>2)throw new _("ends");return e[0]=e[0].compile().evaluate(n).toString().toLowerCase(),e[1]=e[1].compile().evaluate(n).toString().toLowerCase(),e[0].endsWith(e[1])},begins:(e,s,n)=>{if(e.length<2)throw new ie("begins");if(e.length>2)throw new _("begins");return e[0]=e[0].compile().evaluate(n).toString().toLowerCase(),e[1]=e[1].compile().evaluate(n).toString().toLowerCase(),e[0].startsWith(e[1])},alarm:(e,s,n)=>{let r,o,a,h,c;switch(e.length){case 0:throw new ie("alarm");case 1:if(e[0]=e[0].compile().evaluate(n).toString(),r=this._.alarms,a=r.length,a===0)throw new Error("No alarms set.");for(o=0;o<a;o++)if(r[o].type===3&&(r[o].name===e[0]||r[o].pattern===e[0]))return r[o].suspended?0:this._.getRemainingAlarmTime(o);return;case 2:if(h=e[1].compile().evaluate(n),e[0]=e[0].compile().evaluate(n).toString(),r=this._.alarms,a=r.length,a===0)throw new Error("No alarms set.");if(o=0,typeof h=="string"){for(;o<a;o++)if(r[o].type===3&&(r[o].name===e[0]||r[o].pattern===e[0])){if(r[o].profile.name.toUpperCase()!==h.toUpperCase())continue;return r[o].suspended?0:this._.getRemainingAlarmTime(o)}throw new Error("Alarm not found in profile: "+h+".")}else{for(;o<a;o++)if(r[o].type===3&&(r[o].name===e[0]||r[o].pattern===e[0]))return r[o].suspended||this._.setAlarmTempTime(o,h),h;throw new Error("Alarm not found.")}case 3:if(h=e[1].compile().evaluate(n),e[0]=e[0].compile().evaluate(n).toString(),c=e[2].compile().evaluate(n).toString(),r=this._.alarms,a=r.length,a===0)throw new Error("No alarms set.");for(o=0;o<a;o++)if(r[o].type===3&&(r[o].name===e[0]||r[o].pattern===e[0])){if(r[o].profile.name.toUpperCase()!==c.toUpperCase())continue;return r[o].suspended||this._.setAlarmTempTime(o,h),h}throw Error("Could not set time, alarm not found in profile: "+e[2]+".")}throw new _("alarm")},state:(e,s,n)=>{let r;if(e.length===0)throw new ie("state");if(e.length>2)throw new _("state");if(e[0]=e[0].compile().evaluate(n).toString(),e.length===1){let o=this.ee.keys,a=0,h=o.length;if(h===0)return null;if(h===1){if(!this.ee.items[o[0]].enabled||!this.ee.items[o[0]].enableTriggers)throw Error("No enabled profiles found!");r=se(this.ee.items[o[a]].triggers),r=r.find(c=>c.name===e[0]||c.pattern===e[0])}else for(;a<h&&!(!(!this.ee.items[o[a]].enabled||!this.ee.items[o[a]].enableTriggers||this.ee.items[o[a]].triggers.length===0)&&(r=se(this.ee.items[o[a]].triggers),r=r.find(c=>c.name===e[0]||c.pattern===e[0]),r));a++);}else if(e.length===2){e[1]=e[1].compile().evaluate(n);let o;if(this.ee.contains(e[1]))o=this.ee.items[e[1].toLowerCase()];else throw new De(e[1]);r=se(o.triggers),r=r.find(a=>a.name===e[0]||a.pattern===e[0])}if(r)return r.triggers&&r.triggers.length?r.state:0;throw new Error("Trigger not found")},isnull:(e,s,n)=>{if(e.length===0)return null;if(e.length!==1)throw new _("null");return e[0].compile().evaluate(n)?1:0},escape:(e,s,n)=>{if(e.length===0)throw new ie("unescape");if(e.length!==1)throw new _("unescape");let r;if(e[0]=e[0].compile().evaluate(n).toString(),this.se("allowEscape")){let o=this.se("allowEscape")?this.se("escapeChar"):"";return r=o,o==="\\"&&(r+=o),this.se("parseDoubleQuotes")&&(r+='"'),this.se("parseSingleQuotes")&&(r+="'"),this.se("commandStacking")&&(r+=this.se("commandStackingChar")),this.se("enableSpeedpaths")&&(r+=this.se("speedpathsChar")),this.se("enableCommands")&&(r+=this.se("commandChar")),this.se("enableVerbatim")&&(r+=this.se("verbatimChar")),this.se("enableDoubleParameterEscaping")&&(r+=this.se("parametersChar")),this.se("enableNParameters")&&(r+=this.se("nParametersChar")),e.replace(new RegExp(`[${r}]`,"g"),o+"$&")}return e.replace(/[\\"']/g,"$&")},unescape:(e,s,n)=>{if(e.length===0)throw new ie("unescape");if(e.length!==1)throw new _("unescape");let r;if(e[0]=e[0].compile().evaluate(n).toString(),this.se("allowEscape")){let o=this.se("allowEscape")?this.se("escapeChar"):"";return r=o,o==="\\"&&(r+=o),this.se("parseDoubleQuotes")&&(r+='"'),this.se("parseSingleQuotes")&&(r+="'"),this.se("commandStacking")&&(r+=this.se("commandStackingChar")),this.se("enableSpeedpaths")&&(r+=this.se("speedpathsChar")),this.se("enableCommands")&&(r+=this.se("commandChar")),this.se("enableVerbatim")&&(r+=this.se("verbatimChar")),this.se("enableDoubleParameterEscaping")&&(r+=this.se("parametersChar")),this.se("enableNParameters")&&(r+=this.se("nParametersChar")),o==="\\"?e[0].replace(new RegExp(`\\\\[${r}]`,"g"),a=>a.substr(1)):e[0].replace(new RegExp(`${o}[${r}]`,"g"),a=>a.substr(1))}return e[0].replace(/\\[\\"']/g,o=>o.substr(1))},prompt:(e,s,n)=>{if(e.length>3)throw new _("prompt");return e.length===0?window.prompt():(e=e.map(r=>r.compile().evaluate(n).toString()),window.prompt(...e))}};for(let e in t)!t.hasOwnProperty(e)||typeof t[e]!="function"||(t[e].rawArgs=!0);xt.import(t,{})}resetExpressionEngine(){xt&&(xt=void 0)}async Ml(){if(!this._||!this._.options){setTimeout(this.Ml,5);return}if(this.qs=[],this.Is=0,this.os=null,!this.se("gamepads"))return;let t=navigator.getGamepads(),e=0,s=t.length;for(;e<s;e++)t[e]&&(this.qs[t[e].index]={pad:t[e],axes:_e(t[e].axes),state:{axes:[],buttons:[]},pState:{axes:[],buttons:[]}},this.Is++);this.jn()}jn(){if(this.Is===0||!this.se("gamepads"))return;let t=navigator.getGamepads(),e=0,s=t.length;for(!this.os&&s>0&&(this.os=[]);e<s;e++){let n=t[e];if(!n||!this.qs[n.index])continue;let r=this.qs[n.index].state,o=this.qs[n.index].axes,a=n.buttons.length,h,c;this.os[e]||(this.os[e]=bt(this._.macros,"gamepad",e+1)),c=this.os[e];let g=0,m=c.length;if(m===0)continue;for(h=0;h<a;h++){let E=n.buttons[h],w;if(typeof E=="object"?(w=E.pressed,E=E.value):w=E>=.5,r.buttons[h]){if(r.buttons[h].pressed!==w&&(r.buttons[h].pressed=w,!w)){for(;g<m;g++)if(c[g].enabled&&c[g].key===h+1&&this.ExecuteMacro(c[g])){(this.Is>0||t.length>0)&&requestAnimationFrame(()=>{this.jn()});return}}}else r.buttons[h]={pct:Math.round(E*100),pressed:w}}let b=n.axes.length,u=0;for(h=0;h<b;h++)if(r.axes[h]!==n.axes[h]&&n.axes[h]!==o[h]&&(r.axes[h]=n.axes[h]),r.axes[h]<-.75?u=-(h+1):r.axes[h]>.75&&(u=h+1),u!==0){for(;g<m;g++)if(c[g].enabled&&c[g].gamepadAxes===h+1&&this.ExecuteMacro(c[g])){(this.Is>0||t.length>0)&&requestAnimationFrame(()=>{this.jn()});return}}}(this.Is>0||t.length>0)&&requestAnimationFrame(()=>{this.jn()})}adjustLastLine(t,e){return!this.ge.lines||this.ge.lines.length===0?0:(e?t===this.ge.lines.length?(t--,this.ge.lines[t].text.length===0&&this.ge.lines[t].raw.length&&t--):t===this.ge.lines.length-1&&this.ge.lines[t].text.length===0&&this.ge.lines[t].raw.length&&t--:t===this.ge.lines.length?(t--,this.ge.lines[t].text.length===0&&t--):t===this.ge.lines.length-1&&this.ge.lines[t].text.length===0&&t--,t)}get isLocked(){return this.Il!==0}addLock(){this.Il++}removeLock(){this.Il--}AddCommandToHistory(t){(this.ct.length<1||this.ct[this.ct.length-1]!==t)&&t.length>0&&(this.ct.length>=this.se("commandHistorySize")&&this.ct.shift(),this.ct.push(t),this.emit("command-history-changed",this.ct))}clearCommandHistory(){this.ct=[],this.St=-1,this.emit("command-history-changed",this.ct)}setHistoryIndex(t){t<0||this.ct.length===0?this.St=-1:t>=this.ct.length?this.St=this.ct.length-1:this.St=t}get commandHistory(){return this.ct}executeScript(t){if(t==null)return t;let e=0,s=0,n,r=t.length,o="",a=[],h="",c,g=0,m=this.se("parseDoubleQuotes"),b=this.se("parseSingleQuotes"),u=this.se("commandChar");for(;s<r;s++)switch(n=t.charAt(s),e){case 1:n===" "?(e=2,c+=n):(o+=n,c+=n);break;case 2:n==="{"?(e=7,h+=n):n==="("?(e=8,h+=n):n===" "?(a.push(h),h=""):(n==='"'&&m?e=3:n==="'"&&b&&(e=4),h+=n),c+=n;break;case 3:n==='"'&&(e=2),h+=n,c+=n;break;case 4:n==="'"&&(e=2),h+=n,c+=n;break;case 7:h+=n,n==="}"?g===0?e=2:g--:n==="{"&&g++,c+=n;break;case 8:h+=n,n===")"?g===0?e=2:g--:n==="("&&g++,c+=n;break;default:if(s===0&&n===u)e=1,o="",a=[],h="",c=n;else return t;break}return o.length>0?(h.endsWith(`
`)&&(h=h.substring(0,h.length-1)),h.length>0&&a.push(h),this.executeFunction(o,a,c,u)):t}executeFunction(t,e,s,n){let r,o=!1,a,h,c,g,m=null,b=null,u,E,w;switch(t.toLowerCase()){case"unaction":case"untrigger":case"unt":if(this.de(s),m=null,b=null,e.length<1||e.length>2)throw new Error("Invalid syntax use \x1B[4m"+n+"unt\x1B[0;-11;-12mrigger {pattern|name} \x1B[3mprofile\x1B[0;-11;-12m");if(e[0].length===0)throw new Error("Invalid name or pattern");if(e[0].match(/^\{.*\}$/g)?e[0]=this.parseInline(e[0].substr(1,e[0].length-2)):e[0]=this.parseInline(this.stripQuotes(e[0])),e.length===2&&(m=this.stripQuotes(e[2]),m=this.parseInline(m)),!m||m.length===0){let v=this.ee.keys,O=0,C=v.length;if(C===0)return null;if(C===1){if(!this.ee.items[v[0]].enabled||!this.ee.items[v[0]].enableTriggers)throw Error("No enabled profiles found!");u=this.ee.items[v[O]].findAny("triggers",{name:e[0],pattern:e[0]})}else for(;O<C;O++)if(!(!this.ee.items[v[O]].enabled||!this.ee.items[v[O]].enableTriggers||this.ee.items[v[O]].triggers.length===0)&&(u=this.ee.items[v[O]].findAny("triggers",{name:e[0],pattern:e[0]}),u)){m=this.ee.items[v[O]];break}if(!u)throw new Error("Trigger '"+e[0]+"' not found in '"+m.name+"'!");this._.removeTrigger(u),this.Le("Trigger '"+e[0]+"' removed from '"+m.name+"'.",-7,-8,!0,!0)}else if(m=this.parseInline(m),this.ee.contains(m)){if(m=this.ee.items[m.toLowerCase()],u=m.findAny("triggers",{name:e[0],pattern:e[0]}),!u)throw new Error("Trigger '"+e[0]+"' not found in '"+m.name+"'!");this._.removeTrigger(u),this.Le("Trigger '"+e[0]+"' removed from '"+m.name+"'.",-7,-8,!0,!0)}else throw new De(m);return null;case"suspend":case"sus":switch(this.de(s),e.length){case 0:return g=this._.alarms,g.length===0?this.Le("No alarms defined.",-7,-8,!0,!0):(this._.setAlarmState(0,!1),this.Cs=0,this.Le("Last alarm suspended.",-7,-8,!0,!0)),null;case 1:a=this.parseInline(this.stripQuotes(e[0])),g=this._.alarms,h=g.length;for(let v=g.length-1;v>=0;v--)if(g[v].name===a||g[v].pattern===a){this._.setAlarmState(v,!1),this.Le("Alarm '"+a+"' suspended.",-7,-8,!0,!0),this.Cs=v;break}return null;default:throw new Error("Invalid syntax use \x1B[4m"+n+"sus\x1B[0;-11;-12mpend id \x1B[3mprofile\x1B[0;-11;-12m or \x1B[4m"+n+"sus\x1B[0;-11;-12mpend")}case"resume":case"resu":switch(this.de(s),e.length){case 0:return this.Cs===-1||(this._.setAlarmState(this.Cs,!0),this.Le("Last alarm suspended resumed.",-7,-8,!0,!0),this.Cs=-1),null;case 1:a=this.parseInline(this.stripQuotes(e[0])),g=this._.alarms,h=g.length;for(let v=h-1;v>=0;v--)if(g[v].name===a||g[v].pattern===a){this._.setAlarmState(v,!0),this.Le("Alarm '"+a+"' resumed.",-7,-8,!0,!0);break}return null;default:throw new Error("Invalid syntax use \x1B[4m"+n+"resu\x1B[0;-11;-12mme id \x1B[3mprofile\x1B[0;-11;-12m or \x1B[4m"+n+"resu\x1B[0;-11;-12mme")}case"action":case"ac":case"trigger":case"tr":if(this.de(s),u={profile:null,name:null,pattern:null,commands:null,options:{priority:0}},e.length<2||e.length>5)throw new Error("Invalid syntax use \x1B[4m"+n+"tr\x1B[0;-11;-12migger name {pattern} {commands} \x1B[3moptions profile\x1B[0;-11;-12m or \x1B[4m"+n+"tr\x1B[0;-11;-12migger {pattern} {commands} \x1B[3m{options} profile\x1B[0;-11;-12m");if(e[0].length===0)throw new ce("name or pattern");if(e[0].match(/^\{.*\}$/g))u.pattern=e.shift(),u.pattern=this.parseInline(u.pattern.substr(1,u.pattern.length-2));else{if(u.name=this.parseInline(this.stripQuotes(e.shift())),!u.name||u.name.length===0)throw new ce("name");e[0].match(/^\{.*\}$/g)&&(u.pattern=e.shift(),u.pattern=this.parseInline(u.pattern.substr(1,u.pattern.length-2)))}if(e.length!==0){if(e[0].match(/^\{[\s\S]*\}$/g)&&(u.commands=e.shift(),u.commands=u.commands.substr(1,u.commands.length-2)),e.length===1)if(e[0].match(/^\{[\s\S]*\}$/g)?e[0]=e[0].substr(1,e[0].length-2):e[0]=this.stripQuotes(e[0]),e[0].length!==0)this.parseInline(e[0]).split(",").forEach(v=>{switch(v.trim()){case"nocr":case"prompt":case"case":case"verbatim":case"disable":case"enable":case"cmd":case"temporary":case"temp":case"raw":case"pattern":case"regular":case"alarm":case"event":case"cmdpattern":case"loopexpression":u.options[v.trim()]=!0;break;default:if(v.trim().startsWith("param=")){if(g=v.trim().split("="),g.length!==2)throw new ce(`param option '${v.trim()}'`);u.options.params=g[1]}else if(v.trim().startsWith("type=")){if(g=v.trim().split("="),g.length!==2)throw new ce(`type option '${v.trim()}'`);if(!this.Ms(g[1],1))throw new ce("type");u.options.type=g[1]}else if(v.trim().startsWith("pri=")||v.trim().startsWith("priority=")){if(g=v.trim().split("="),g.length!==2)throw new ce(`priority option '${v.trim()}'`);if(c=parseInt(g[1],10),isNaN(c))throw new ce("priority value '"+g[1]+"' must be a number");u.options.priority=c}else throw new ce(`option '${v.trim()}'`)}});else throw new ce("options");else if(e.length===2){if(e[0].match(/^\{[\s\S]*\}$/g)&&(e[0]=e[0].substr(1,e[0].length-2)),e[0].length!==0)this.parseInline(e[0]).split(",").forEach(v=>{switch(v.trim()){case"nocr":case"prompt":case"case":case"verbatim":case"disable":case"enable":case"cmd":case"temporary":case"temp":case"raw":case"pattern":case"regular":case"alarm":case"event":case"cmdpattern":case"loopexpression":u.options[v.trim()]=!0;break;default:if(v.trim().startsWith("param=")){if(g=v.trim().split("="),g.length!==2)throw new ce(`param option '${v.trim()}'`);u.options.params=g[1]}else if(v.trim().startsWith("type=")){if(g=v.trim().split("="),g.length!==2)throw new ce(`type option '${v.trim()}'`);if(!this.Ms(g[1],1))throw new ce("type");u.options.type=g[1]}else if(v.trim().startsWith("pri=")||v.trim().startsWith("priority=")){if(g=v.trim().split("="),g.length!==2)throw new ce(`priority option '${v.trim()}'`);if(c=parseInt(g[1],10),isNaN(c))throw new ce("priority value '"+g[1]+"' must be a number");u.options.priority=c}else throw new ce(`option '${v.trim()}'`)}});else throw new ce("options");u.profile=this.stripQuotes(e[1]),u.profile.length!==0&&(u.profile=this.parseInline(u.profile))}}return this.createTrigger(u.pattern,u.commands,u.profile,u.options,u.name),null;case"event":case"ev":if(this.de(s),m=null,u={profile:null,name:null,pattern:null,commands:null,options:{priority:0}},e.length<2||e.length>4)throw new Error("Invalid syntax use \x1B[4m"+n+"ev\x1B[0;-11;-12ment name {commands} \x1B[3moptions profile\x1B[0;-11;-12m");if(e[0].length===0)throw new Error("Invalid event name");if(u.name=this.parseInline(this.stripQuotes(e.shift())),!u.name||u.name.length===0)throw new Error("Invalid event name");if(e.length===0)throw new Error("Missing commands or options");if(e[0].match(/^\{[\s\S]*\}$/g))u.commands=e.shift(),u.commands=u.commands.substr(1,u.commands.length-2);else throw new Error("Missing commands");if(e.length===1)if(e[0]=e[0].substr(1,e[0].length-2),e[0].length!==0)this.parseInline(e[0]).split(",").forEach(v=>{switch(v.trim()){case"nocr":case"prompt":case"case":case"verbatim":case"disable":case"temporary":case"temp":u.options[v.trim()]=!0;break;default:if(v.trim().startsWith("pri=")||v.trim().startsWith("priority=")){if(g=v.trim().split("="),g.length!==2)throw new Error(`Invalid event priority option '${v.trim()}'`);if(c=parseInt(g[1],10),isNaN(c))throw new Error("Invalid event priority value '"+g[1]+"' must be a number");u.options.priority=c}else throw new Error(`Invalid event option '${v.trim()}'`)}});else throw new Error("Invalid event options");else if(e.length===2){if(e[0].match(/^\{[\s\S]*\}$/g)&&(e[0]=e[0].substr(1,e[0].length-2)),e[0].length!==0)this.parseInline(e[0]).split(",").forEach(v=>{switch(v.trim()){case"nocr":case"prompt":case"case":case"verbatim":case"disable":case"temporary":case"temp":u.options[v.trim()]=!0;break;default:if(v.trim().startsWith("pri=")||v.trim().startsWith("priority=")){if(g=v.trim().split("="),g.length!==2)throw new Error(`Invalid event priority option '${v.trim()}'`);if(c=parseInt(g[1],10),isNaN(c))throw new Error("Invalid event priority value '"+g[1]+"' must be a number");u.options.priority=c}else throw new Error(`Invalid event option '${v.trim()}'`)}});else throw new Error("Invalid event options");u.profile=this.stripQuotes(e[1]),u.profile.length!==0&&(u.profile=this.parseInline(u.profile))}if(!u.profile||u.profile.length===0){let v=this.ee.keys,O=0,C=v.length;if(C===0)return null;if(C===1){if(!this.ee.items[v[0]].enabled||!this.ee.items[v[0]].enableTriggers)throw Error("No enabled profiles found!");m=this.ee.items[v[0]],g=se(this.ee.items[v[O]].triggers.filter(I=>I.type===2)),w=g.find(I=>I.name===u.name||I.pattern===u.name)}else{for(;O<C;O++)if(!(!this.ee.items[v[O]].enabled||!this.ee.items[v[O]].enableTriggers||this.ee.items[v[O]].triggers.length===0)&&(g=se(this.ee.items[v[O]].triggers.filter(I=>I.type===2)),w=g.find(I=>I.name===u.name||I.pattern===u.name),w)){m=this.ee.items[v[O]];break}m||(m=this._.activeProfile)}}else{if(this.ee.contains(u.profile))m=this.ee.items[u.profile.toLowerCase()];else throw new De(u.profile);w=g.find(v=>v.name===u.name||v.pattern===u.name)}return w?this.Le("Event '"+w.name+"' updated.",-7,-8,!0,!0):(w=new Te,w.name=u.name,m.triggers.push(w),this.Le("Event '"+w.name+"' added.",-7,-8,!0,!0),u.new=!0),w.pattern=u.name,u.commands!==null&&(w.value=u.commands),w.type=2,u.options.prompt&&(w.triggerPrompt=!0),u.options.nocr&&(w.triggerNewline=!1),u.options.case&&(w.caseSensitive=!0),u.options.raw&&(w.raw=!0),u.options.verbatim&&(w.verbatim=!0),u.options.disable?w.enabled=!1:u.options.enable&&(w.enabled=!0),(u.options.temporary||u.options.temp)&&(w.temp=!0),w.priority=u.options.priority,this._.saveProfiles(),this._.clearCache(),u.new?this.emit("item-added","trigger",m.name,m.triggers.length-1,w):this.emit("item-updated","trigger",m.name,m.triggers.indexOf(w),w),m=null,null;case"unevent":case"une":if(this.de(s),e.length===0)throw new Error("Invalid syntax use \x1B[4m"+n+"une\x1B[0;-11;-12mvent name or \x1B[4m"+n+"une\x1B[0;-11;-12mvent {name} \x1B[3mprofile\x1B[0;-11;-12m");return m=this.Nr(e,"Invalid syntax use \x1B[4m"+n+"une\x1B[0;-11;-12mvent name or \x1B[4m"+n+"une\x1B[0;-11;-12mvent {name} \x1B[3mprofile\x1B[0;-11;-12m"),r=m.results,m=m.profile,a=se(m.triggers.filter(v=>v.type===2)),r=this.stripQuotes(r),g=r,r=a.findIndex(v=>v.pattern===r||v.name===r),o=r!==-1,o?(this.Le("Event '"+(a[r].name||a[r].pattern)+"' removed.",-7,-8,!0,!0),this._.removeTrigger(a[r]),m=null):this.Le("Event '"+g+"' not found.",-7,-8,!0,!0),null;case"button":case"bu":if(this.de(s),e.length===1){if(r=this.parseInline(this.stripQuotes(e[0])),a=document.getElementById("user-buttons").children,/^\s*?\d+\s*?$/.exec(r)){if(r=parseInt(r,10),r<0||r>=a.length)throw new Error("Button index must be >= 0 and < "+a.length);a[r].click()}else if(a[r])a[r].click();else throw new Error(`Button '${r}' not found`);return null}if(m=null,u={profile:null,name:null,caption:null,commands:null,icon:null,options:{priority:0}},e.length<2||e.length>5)throw new Error("Invalid syntax use \x1B[4m"+n+"bu\x1B[0;-11;-12mtton name|index or \x1B[4m"+n+"bu\x1B[0;-11;-12mtton name \x1B[3mcaption\x1B[0;-11;-12m {commands} \x1B[3m{icon} options profile\x1B[0;-11;-12m or \x1B[4m"+n+"by\x1B[0;-11;-12mutton \x1B[3mcaption\x1B[0;-11;-12m {commands} \x1B[3m{icon} {options} profile\x1B[0;-11;-12m");if(e[0].length===0)throw new Error("Invalid button name, caption or commands");if(e[0].match(/^\{[\s\S]*\}$/g))u.commands=e.shift(),u.commands=u.commands.substr(1,u.commands.length-2);else{if(u.name=this.parseInline(this.stripQuotes(e.shift())),!u.name||u.name.length===0)throw new Error("Invalid button name or caption");if(e[0].match(/^\{[\s\S]*\}$/g))u.commands=e.shift(),u.commands=u.commands.substr(1,u.commands.length-2);else if(u.caption=this.stripQuotes(e.shift()),!e[0].match(/^\{[\s\S]*\}$/g))throw new Error("Missing commands")}if(e.length!==0){if(e[0].match(/^\{.*\}$/g)&&(u.icon=e.shift(),u.icon=u.icon.substr(1,u.icon.length-2)),e.length===1)if(e[0].match(/^\{[\s\S]*\}$/g)?e[0]=e[0].substr(1,e[0].length-2):e[0]=this.stripQuotes(e[0]),e[0].length!==0)this.parseInline(e[0]).split(",").forEach(v=>{switch(v.trim()){case"nosend":case"chain":case"append":case"stretch":case"disable":case"enable":u.options[v.trim()]=!0;break;default:if(v.trim().startsWith("pri=")||v.trim().startsWith("priority=")){if(g=v.trim().split("="),g.length!==2)throw new Error(`Invalid button priority option '${v.trim()}'`);if(c=parseInt(g[1],10),isNaN(c))throw new Error("Invalid button priority value '"+g[1]+"' must be a number");u.options.priority=c}else throw new Error(`Invalid button option '${v.trim()}'`)}});else throw new Error("Invalid button options");else if(e.length===2){if(e[0].match(/^\{[\s\S]*\}$/g)&&(e[0]=e[0].substr(1,e[0].length-2)),e[0].length!==0)this.parseInline(e[0]).split(",").forEach(v=>{switch(v.trim()){case"nosend":case"chain":case"append":case"stretch":case"disable":case"enable":u.options[v.trim()]=!0;break;default:if(v.trim().startsWith("pri=")||v.trim().startsWith("priority=")){if(g=v.trim().split("="),g.length!==2)throw new Error(`Invalid button priority option '${v.trim()}'`);if(c=parseInt(g[1],10),isNaN(c))throw new Error("Invalid button priority value '"+g[1]+"' must be a number");u.options.priority=c}else throw new Error(`Invalid button option '${v.trim()}'`)}});else throw new Error("Invalid button options");u.profile=this.stripQuotes(e[1]),u.profile.length!==0&&(u.profile=this.parseInline(u.profile))}}if(!u.profile||u.profile.length===0){let v=this.ee.keys,O=0,C=v.length;if(C===0)return null;if(C===1){if(!this.ee.items[v[0]].enabled||!this.ee.items[v[0]].enableTriggers)throw Error("No enabled profiles found!");m=this.ee.items[v[0]],u.name!==null?w=this.ee.items[v[O]].find("buttons","name",u.name):w=this.ee.items[v[O]].find("buttons","caption",u.caption)}else{for(;O<C;O++)if(!(!this.ee.items[v[O]].enabled||!this.ee.items[v[O]].enableTriggers||this.ee.items[v[O]].triggers.length===0)&&(u.name!==null?w=this.ee.items[v[O]].find("buttons","name",u.name):w=this.ee.items[v[O]].find("buttons","caption",u.caption),w)){m=this.ee.items[v[O]];break}m||(m=this._.activeProfile)}}else{if(this.ee.contains(u.profile))m=this.ee.items[u.profile.toLowerCase()];else throw new De(u.profile);u.name!==null?w=m.find("buttons","name",u.name):w=m.find("buttons","caption",u.caption)}return w?this.Le("Button '"+(w.name||w.caption||"")+"' updated.",-7,-8,!0,!0):(w=new ke,w.name=u.name||"",w.caption=u.caption||"",m.buttons.push(w),!u.name&&!u.caption?this.Le("Button added.",-7,-8,!0,!0):this.Le("Button '"+(w.name||w.caption||"")+"' added.",-7,-8,!0,!0),u.new=!0),u.caption!==null&&(w.caption=u.caption),u.commands!==null&&(w.value=u.commands),u.options.icon&&(w.icon=u.options.icon),u.options.nosend&&(w.send=!1),u.options.chain&&(w.chain=!0),u.options.append&&(w.append=!0),u.options.stretch&&(w.stretch=!0),u.options.disable?w.enabled=!1:u.options.enable&&(w.enabled=!0),w.priority=u.options.priority,this._.saveProfiles(),this._.clearCache(),u.new?this.emit("item-added","button",m.name,m.buttons.length-1,w):this.emit("item-updated","button",m.name,m.buttons.indexOf(w),w),m=null,null;case"unbutton":case"unb":if(this.de(s),e.length===0)throw new Error("Invalid syntax use \x1B[4m"+n+"unb\x1B[0;-11;-12mtton name or \x1B[4m"+n+"unb\x1B[0;-11;-12mtton {name} \x1B[3mprofile\x1B[0;-11;-12m");if(m=this.Nr(e,"Invalid syntax use \x1B[4m"+n+"unb\x1B[0;-11;-12mtton name or \x1B[4m"+n+"unb\x1B[0;-11;-12mtton {name} \x1B[3mprofile\x1B[0;-11;-12m"),r=m.results,m=m.profile,a=se(m.buttons),g=r,/^\s*?\d+\s*?$/.exec(r)){if(r=parseInt(r,10),r<0||r>=a.length)throw new Error("Button index must be >= 0 and < "+a.length);o=!0}else r=this.stripQuotes(r),r=a.findIndex(v=>v.name===r||v.caption===r),o=r!==-1;return o?(a[r].name.length===0&&a[r].caption.length===0?this.Le("Button '"+g+"' removed.",-7,-8,!0,!0):this.Le("Button '"+(a[r].name||a[r].caption)+"' removed.",-7,-8,!0,!0),w=a[r],r=m.buttons.indexOf(a[r]),m.buttons.splice(r,1),this._.saveProfiles(),this._.clearCache(),this.emit("item-removed","button",m.name,r,w),m=null):this.Le("Button '"+g+"' not found.",-7,-8,!0,!0),null;case"alarm":case"ala":if(this.de(s),m=null,b=null,r=!1,e.length<2||e.length>4)throw new Error("Invalid syntax use \x1B[4m"+n+"ala\x1B[0;-11;-12mrm name {timepattern} {commands} \x1B[3mprofile\x1B[0;-11;-12m, \x1B[4m"+n+"ala\x1B[0;-11;-12mrm name {timepattern} \x1B[3mprofile\x1B[0;-11;-12m, or \x1B[4m"+n+"ala\x1B[0;-11;-12mrm {timepattern} {commands} \x1B[3mprofile\x1B[0;-11;-12m");if(e[0].length===0)throw new Error("Invalid name or timepattern");if(e[0].match(/^\{.*\}$/g)){if(e.length>3)throw new Error("Invalid syntax use \x1B[4m"+n+"ala\x1B[0;-11;-12mrm {timepattern} {commands} profile");if(e[0]=e[0].substr(1,e[0].length-2),e[0]=this.parseInline(e[0]),e[1].match(/^\{[\s\S]*\}$/g)&&(e[1]=e[1].substr(1,e[1].length-2)),e.length===3&&(m=this.stripQuotes(e[2]),m=this.parseInline(m)),!m||m.length===0)m=this._.activeProfile;else if(this.ee.contains(m))m=this.ee.items[m.toLowerCase()];else throw new De(m);return w=new Te,w.pattern=e[0],w.value=e[1],w.type=3,m.triggers.push(w),this._.saveProfiles(),this._.clearCache(),this.Cs=-1,this._.updateAlarms(),this.Le("Alarm '"+w.pattern+"' added.",-7,-8,!0,!0),this.emit("item-added","trigger",m.name,m.triggers.length-1,w),m=null,null}if(b=this.stripQuotes(e[0]),!b||b.length===0)throw new Error("Invalid alarm name");b=this.parseInline(b);let k=e[1],R=null;if(k.match(/^\{.*\}$/g)&&(k=k.substr(1,k.length-2)),k=this.parseInline(k),e.length===3?e[2].match(/^\{[\s\S]*\}$/g)?R=e[2].substr(1,e[2].length-2):m=this.stripQuotes(e[2]):e.length===4&&(R=e[2],m=this.stripQuotes(e[3]),R.match(/^\{[\s\S]*\}$/g)&&(R=R.substr(1,R.length-2))),!m||m.length===0){let v=this.ee.keys,O=0,C=v.length;if(C===0)return null;if(C===1){if(!this.ee.items[v[0]].enabled||!this.ee.items[v[0]].enableTriggers)throw Error("No enabled profiles found!");if(m=this.ee.items[v[0]],w=m.find("triggers","name",b),!w&&!R)throw new Error("Alarm not found!");w?this.Le("Alarm '"+w.name+"' updated.",-7,-8,!0,!0):(w=new Te,w.name=b,m.triggers.push(w),this.Le("Alarm '"+w.name+"' added.",-7,-8,!0,!0),r=!0)}else{for(;O<C;O++)if(!(!this.ee.items[v[O]].enabled||!this.ee.items[v[O]].enableTriggers||this.ee.items[v[O]].triggers.length===0)&&(w=this.ee.items[v[O]].find("triggers","name",b),w)){m=this.ee.items[v[O]];break}if(!m&&!R)throw new Error("Alarm not found!");m||(m=this._.activeProfile),w?this.Le("Alarm '"+w.name+"' updated.",-7,-8,!0,!0):(w=new Te,r=!0,w.name=b,m.triggers.push(w),this.Le("Alarm '"+w.name+"' added.",-7,-8,!0,!0))}}else{if(m=this.parseInline(m),this.ee.contains(m))m=this.ee.items[m.toLowerCase()];else throw new De(m);if(w=m.find("triggers","name",b),!w&&!R)throw new Error("Alarm not found!");w?this.Le("Alarm '"+w.name+"' updated.",-7,-8,!0,!0):(w=new Te,w.name=b,m.triggers.push(w),r=!0,this.Le("Alarm '"+w.name+"' added.",-7,-8,!0,!0))}return w.pattern=k,w.type=3,R&&(w.value=R),this._.saveProfiles(),this._.clearCache(),r?this.emit("item-added","trigger",m.name,m.triggers.length-1,w):this.emit("item-updated","trigger",m.name,m.triggers.indexOf(w),w),m=null,this.Cs=-1,this._.updateAlarms(),null;case"ungag":case"ung":if(this.de(s),e.length>0)throw new Error("Invalid syntax use \x1B[4m"+n+"ung\x1B[0;-11;-12mag number or \x1B[4m"+n+"ung\x1B[0;-11;-12mag");return this.Zn.length&&(clearTimeout(this.Zn.pop()),this.Lt.pop()),this.Vi=0,null;case"gag":case"ga":if(this.de(s),e.length===0)return this.Lt.length&&this.Lt[this.Lt.length-1]==this.ge.lines.length&&(this.Vi=0,this.Lt.pop()),this.Lt.push(this.ge.lines.length),this.Zn.push(setTimeout(()=>{if(r=this.adjustLastLine(this.Lt.pop()),this.Lt.length){let v=this.Lt.length;for(;v>=0;)v--,this.Lt[v]>r&&this.Lt[v]--}this.ge.removeLine(r)},0)),this.Vi=0,null;if(e.length>1)throw new Error("Invalid syntax use \x1B[4m"+n+"ga\x1B[0;-11;-12mg number or \x1B[4m"+n+"ga\x1B[0;-11;-12mg");if(c=parseInt(e[0],10),isNaN(c))throw new Error("Invalid number '"+e[0]+"'");return this.Lt.length&&this.Lt[this.Lt.length-1]==this.ge.lines.length&&(this.Vi=0,this.Lt.pop()),this.Lt.push(this.ge.lines.length),c>=0?(this.Zn.push(setTimeout(()=>{if(r=this.adjustLastLine(this.Lt.pop()),this.Lt.length){let v=this.Lt.length;for(;v>=0;)v--,this.Lt[v]>r&&this.Lt[v]--}this.ge.removeLine(r),this.Vi=c},0)),this.Vi=0):(this.Zn.push(setTimeout(()=>{r=this.adjustLastLine(this.Lt.pop()),c*=-1,c>this.ge.lines.length&&(c=this.ge.lines.length),this.ge.removeLines(r-c,c),this.Vi=0},0)),this.Vi=0),null;case"wait":case"wa":if(this.de(s),e=e.filter(v=>v),e.length===0||e.length>1)throw new Error("Invalid syntax use \x1B[4m"+n+"wa\x1B[0;-11;-12mit number");if(c=parseInt(this.parseInline(e[0]),10),isNaN(c))throw new Error("Invalid number '"+c+"' for wait");if(c<1)throw new Error("Must be greater then zero for wait");return c;case"showclient":case"showcl":return this.de(s),this._.show(),null;case"hideclient":case"hidecl":return this.de(s),this._.hide(),null;case"toggleclient":case"togglecl":return this.de(s),this._.toggle(),null;case"raiseevent":case"raise":if(this.de(s),this.se("parseDoubleQuotes")&&e.forEach(v=>v.replace(/^\"(.*)\"$/g,(O,C,I)=>C.replace(/\\\"/g,'"'))),this.se("parseSingleQuotes")&&e.forEach(v=>v.replace(/^\'(.*)\'$/g,(O,C,I)=>C.replace(/\\\'/g,"'"))),e.length===0)throw new Error("Invalid syntax use "+n+"\x1B[4mraise\x1B[0;-11;-12mevent name or "+n+"\x1B[4mraise\x1B[0;-11;-12mevent name arguments");return e.length===1?this._.raise(e[0]):this._.raise(e[0],e.slice(1)),null;case"cl":case"close":if(this.de(s),this.se("parseDoubleQuotes")&&e.forEach(v=>v.replace(/^\"(.*)\"$/g,(O,C,I)=>C.replace(/\\\"/g,'"'))),this.se("parseSingleQuotes")&&e.forEach(v=>v.replace(/^\'(.*)\'$/g,(O,C,I)=>C.replace(/\\\'/g,"'"))),e.length>2)throw new Error("Invalid syntax use "+n+"\x1B[4mcl\x1B[0;-11;-12mose");return e.length===0?this._.closeWindow():this._.closeWindow(this.stripQuotes(this.parseInline(e[0]))),null;case"window":case"win":if(this.de(s),this.se("parseDoubleQuotes")&&e.forEach(v=>v.replace(/^\"(.*)\"$/g,(O,C,I)=>C.replace(/\\\"/g,'"'))),this.se("parseSingleQuotes")&&e.forEach(v=>v.replace(/^\'(.*)\'$/g,(O,C,I)=>C.replace(/\\\'/g,"'"))),e.length===0||e.length>3)throw new Error("Invalid syntax use "+n+"\x1B[4mwin\x1B[0;-11;-12mdow name \x1B[3mclose\x1B[0;-11;-12m or "+n+"\x1B[4mwin\x1B[0;-11;-12mdow new \x1B[3mcharacter\x1B[0;-11;-12m");return e.length===3?this._.emit("window",this.stripQuotes(this.parseInline(e[0])),this.stripQuotes(this.parseInline(e[1])),this.stripQuotes(this.parseInline(e.slice(2).join(" ")))):e.length===1?this._.emit("window",this.stripQuotes(this.parseInline(e[0]))):this._.emit("window",this.stripQuotes(this.parseInline(e[0])),this.stripQuotes(this.parseInline(e.slice(1).join(" ")))),null;case"raisedelayed":case"raisede":if(this.de(s),e.length<2)throw new Error("Invalid syntax use \x1B[4m"+n+"raisede\x1B[0;-11;-12mlayed milliseconds name or \x1B[4m"+n+"raisede\x1B[0;-11;-12mlayed milliseconds name arguments");if(c=parseInt(this.stripQuotes(this.parseInline(e[0])),10),isNaN(c))throw new Error("Invalid number '"+e[0]+"' for raisedelayed");if(c<1)throw new Error("Must be greater then zero for raisedelayed");return e.shift(),this.se("parseDoubleQuotes")&&e.forEach(v=>v.replace(/^\"(.*)\"$/g,(O,C,I)=>C.replace(/\\\"/g,'"'))),this.se("parseSingleQuotes")&&e.forEach(v=>v.replace(/^\'(.*)\'$/g,(O,C,I)=>C.replace(/\\\'/g,"'"))),e.length===1?this._.raise(e[0],0,c):this._.raise(e[0],e.slice(1),c),null;case"notify":case"not":if(this.de(s),e.length===0)throw new Error("Invalid syntax use \x1B[4m"+n+"not\x1B[0;-11;-12mify title \x1B[3mmessage icon\x1B[0;-11;-12m");if(e[0]=this.stripQuotes(e[0]),e[e.length-1].match(/^\{.*\}$/g)&&(u=e.pop(),r={icon:this.parseInline(u.substr(1,u.length-2))}),e.length===0)throw new Error("Invalid syntax use \x1B[4m"+n+"not\x1B[0;-11;-12mify title \x1B[3mmessage icon\x1B[0;-11;-12m");return e.length===1?this._.notify(this.parseInline(this.stripQuotes(e[0])),null,r):this._.notify(this.parseInline(this.stripQuotes(e[0])),this.parseInline(e.slice(1).join(" ")),r),null;case"idle":case"idletime":return this.de(s),this._.lastSendTime?this.Le("You have been idle: "+Ni(Date.now()-this._.lastSendTime),-7,-8,!0,!0):this.Le("Not connected",-7,-8,!0,!0),null;case"connect":case"connecttime":return this.de(s),this._.connectTime?this.Le("You have been connected: "+Ni(Date.now()-this._.connectTime),-7,-8,!0,!0):!moment&&this._.disconnectTime?this.Le("Disconnected since: "+new Date(this._.disconnectTime).toLocaleString(),-7,-8,!0,!0):this._.disconnectTime?this.Le("Disconnected since: "+new moment(this._.disconnectTime).format("MM/DD/YYYY hh:mm:ss A"),-7,-8,!0,!0):this.Le("Not connected",-7,-8,!0,!0),null;case"beep":case"be":return this.de(s),this._.beep(),null;case"version":case"ve":return this.de(s),this.Le(this._.telnet.terminal+" v"+this._.version,-7,-8,!0,!0),null;case"showprompt":case"showp":return this.de(s),e=this.parseInline(e.join(" ")),this._.telnet.receivedData(at(e),!0,!0),this._.telnet.prompt=!0,null;case"show":case"sh":return this.de(s),e=this.parseInline(e.join(" ")+`
`),this._.telnet.receivedData(at(e),!0,!0),null;case"sayprompt":case"sayp":case"echoprompt":case"echop":return this.de(s),e=this.parseInline(e.join(" ")),this._.print("\x1B[-7;-8m"+e+"\x1B[0m",!1),null;case"say":case"sa":case"echo":case"ec":return this.de(s),e=this.parseInline(e.join(" ")),this._.telnet.prompt?this._.print(`
\x1B[-7;-8m`+e+`\x1B[0m
`,!1):this._.print("\x1B[-7;-8m"+e+`\x1B[0m
`,!1),this._.telnet.prompt=!1,null;case"print":return this.de(s),c=this._.enableTriggers,this._.enableTriggers=!1,e=this.parseInline(e.join(" ")),this._.telnet.prompt?this._.print(`
\x1B[-7;-8m`+e+`\x1B[0m
`,!1):this._.print("\x1B[-7;-8m"+e+`\x1B[0m
`,!1),this._.telnet.prompt=!1,this._.enableTriggers=c,null;case"printprompt":case"printp":return this.de(s),c=this._.enableTriggers,this._.enableTriggers=!1,e=this.parseInline(e.join(" ")),this._.print("\x1B[-7;-8m"+e+"\x1B[0m",!1),this._.enableTriggers=c,null;case"alias":case"al":if(this.de(s),e.length===0)throw new Error("Invalid syntax use \x1B[4m"+n+"al\x1B[0;-11;-12mias name value or \x1B[4m"+n+"al\x1B[0;-11;-12mias name {value} \x1B[3mprofile\x1B[0;-11;-12m");if(e.length===1)throw new Error("Must supply an alias value");if(r=this.parseInline(this.stripQuotes(e.shift())),m=this.Nr(e,"Invalid syntax use \x1B[4m"+n+"al\x1B[0;-11;-12mias name value or \x1B[4m"+n+"al\x1B[0;-11;-12mias name {value} \x1B[3mprofile\x1B[0;-11;-12m"),e=m.results,m=m.profile,a=m.aliases,e=this.stripQuotes(e),/^\s*?\d+\s*?$/.exec(r)){if(r=parseInt(r,10),r<0||r>=a.length)throw new Error("Alias index must be >= 0 and < "+a.length);a[r].value=e,this.Le("Alias '"+a[r].pattern+"' updated.",-7,-8,!0,!0)}else{for(c=0,h=a.length;c<h;c++)if(a[c].pattern===r){a[c].value=e,this.Le("Alias '"+r+"' updated.",-7,-8,!0,!0),this.emit("item-updated","alias",m.name,c,g),o=!0;break}o||(g=new it(r,e),a.push(g),this.emit("item-added","alias",m.name,a.length-1,g),this.Le("Alias '"+r+"' added.",-7,-8,!0,!0))}return m.aliases=a,this._.saveProfiles(),this._.clearCache(),m=null,null;case"unalias":case"una":if(this.de(s),e.length===0)throw new Error("Invalid syntax use \x1B[4m"+n+"una\x1B[0;-11;-12mlias name or \x1B[4m"+n+"una\x1B[0;-11;-12mlias {name} \x1B[3mprofile\x1B[0;-11;-12m");if(m=this.Nr(e,"Invalid syntax use \x1B[4m"+n+"una\x1B[0;-11;-12mlias name or \x1B[4m"+n+"una\x1B[0;-11;-12mlias {name} \x1B[3mprofile\x1B[0;-11;-12m"),r=m.results,m=m.profile,a=m.aliases,r=this.stripQuotes(r),/^\s*?\d+\s*?$/.exec(r)){if(g=r,r=parseInt(r,10),r<0||r>=a.length)throw new Error("Alias index must be >= 0 and < "+a.length);o=!0}else g=r,r=a.findIndex(v=>v.pattern===r),o=r!==-1;return o?(this.Le("Alias '"+a[r].pattern+"' removed.",-7,-8,!0,!0),w=a[r],a.splice(r,1),m.aliases=a,this._.saveProfiles(),this._.clearCache(),this.emit("item-removed","alias",m.name,r,w),m=null):this.Le("Alias '"+g+"' not found.",-7,-8,!0,!0),null;case"setsetting":case"sets":if(this.de(s),e.length===0)throw new Error("Invalid syntax use \x1B[4m"+n+"sets\x1B[0;-11;-12metting name value");if(e.length===1)throw new Error("Must supply a setsetting value");if(r=this.stripQuotes(this.parseInline(e[0])),e=this.stripQuotes(this.parseInline(e.slice(1).join(" "))),/^\s*?\d+\s*?$/.exec(r)){if(g=r,r=parseInt(r,10),r<0||r>=te.length)throw new Error("Setting index must be >= 0 and < "+te.length);o=!0}else for(r=r.toLowerCase(),c=0,h=te.length;c<h;c++)if(te[c][0].toLowerCase()===r){r=c,o=!0;break}if(o)switch(te[r][2]){case 0:if(te[r][4]>0&&e.length>te[r][4])throw new Error("String can not be longer then "+te[r][4]+" characters");this._.setOption(te[r][1]||te[r][0],e),this.Le("Setting '"+te[r][0]+"' set to '"+e+"'.",-7,-8,!0,!0),this._.loadOptions();break;case 1:case 3:switch(e.toLowerCase()){case"true":case"1":case"yes":this._.setOption(te[r][1]||te[r][0],!0),this.Le("Setting '"+te[r][0]+"' set to true.",-7,-8,!0,!0),this._.loadOptions();break;case"no":case"false":case"0":this._.setOption(te[r][1]||te[r][0],!1),this.Le("Setting '"+te[r][0]+"' set to false.",-7,-8,!0,!0),this._.loadOptions();break;case"toggle":e=!this.se(te[r][1]||te[r][0]),this._.setOption(te[r][1]||te[r][0],e),this.Le("Setting '"+te[r][0]+"' set to "+e+".",-7,-8,!0,!0),this._.loadOptions();break;default:throw new Error("Invalid value, must be true or false")}break;case 2:if(c=parseInt(e,10),isNaN(c))throw new Error("Invalid number '"+e+"'");this._.setOption(te[r][1]||te[r][0],c),this.Le("Setting '"+te[r][0]+"' set to '"+c+"'.",-7,-8,!0,!0),this._.loadOptions();break;case 4:case 5:throw new Error("Unsupported setting '"+r+"'")}else throw new Error("Unknown setting '"+g+"'");return null;case"getsetting":case"gets":if(this.de(s),e.length===0)throw new Error("Invalid syntax use \x1B[4m"+n+"gets\x1B[0;-11;-12metting name");if(r=this.stripQuotes(this.parseInline(e.join(" "))),/^\s*?\d+\s*?$/.exec(r)){if(r=parseInt(r,10),r<0||r>=te.length)throw new Error("Setting index must be >= 0 and < "+te.length);o=!0}else{if(g=r,r=r.toLowerCase(),r!=="all"){for(c=0,h=te.length;c<h;c++)if(te[c][0].toLowerCase()===r){r=c,o=!0;break}}if(r==="all"){for(g=`Current settings:
`,c=0,h=te.length;c<h;c++)switch(te[c][2]){case 0:case 2:g+="    "+te[c][0]+": "+this.se(te[r][1]||te[r][0])+`
`;break;case 1:case 3:this.se(te[r][1]||te[r][0])?g+="    "+te[c][0]+`: true
`:g+="    "+te[c][0]+`: false
`;break}this.Le(g,-7,-8,!0,!0)}else if(o)switch(te[r][2]){case 0:case 2:this.Le("Setting '"+te[r][0]+"' is '"+this.se(te[r][1]||te[r][0])+"'",-7,-8,!0,!0);break;case 1:case 3:this.se(te[r][1]||te[r][0])?this.Le("Setting '"+te[r][0]+"' is true",-7,-8,!0,!0):this.Le("Setting '"+te[r][0]+"' is false",-7,-8,!0,!0);break}else throw new Error("Unknown setting '"+r+"'")}return null;case"profilelist":this.de(s),this.Le("\x1B[4mProfiles:\x1B[0m",-7,-8,!0,!0);let B=this.ee.keys;for(h=B.length,c=0;c<h;c++)this.ee.items[B[c]]&&this.ee.items[B[c]].enabled?this.Le("   "+this.ee.keys[c]+" is enabled",-7,-8,!0,!0):this.Le("   "+B[c]+" is disabled",-7,-8,!0,!0);return null;case"profile":case"pro":if(this.de(s),e.length===0)throw new Error("Invalid syntax use \x1B[4m"+n+"pro\x1B[0;-11;-12mfile name or \x1B[4m"+n+"pro\x1B[0;-11;-12mfile name enable/disable");if(e.length===1){if(e[0]=this.parseInline(e[0]),this._.toggleProfile(e[0]),this.ee.contains(e[0])){if(this.ee.length===1)throw new Error(e[0]+" can not be disabled as it is the only one enabled")}else throw new De(e[0]);this.ee.contains(e[0].toLowerCase())?this.ee.items[e[0].toLowerCase()].enabled?e=e[0]+" is enabled":e=e[0]+" is disabled":e="Profile not found"}else{if(e[0]=this.parseInline(e[0]).toLowerCase(),!this.ee.contains(e[0]))throw new De(e[0]);if(!e[1])throw new Error("Invalid syntax use \x1B[4m"+n+"pro\x1B[0;-11;-12mfile name or \x1B[4m"+n+"pro\x1B[0;-11;-12mfile name enable/disable");switch(e[1]=this.parseInline(e[1]),e[1].toLowerCase()){case"enable":case"on":case"yes":this.ee.items[e[0].toLowerCase()].enabled?e=e[0]+" is already enabled":(this._.toggleProfile(e[0]),this.ee.items[e[0].toLowerCase()].enabled!==-1?e=e[0]+" is enabled":e=e[0]+" remains disabled");break;case"disable":case"off":case"no":if(!this.ee.items[e[0].toLowerCase()].enabled)e=e[0]+" is already disabled";else{if(this.ee.length===1)throw new Error(e[0]+" can not be disabled as it is the only one enabled");this._.toggleProfile(e[0]),e=e[0]+" is disabled"}break;default:throw new Error("Invalid syntax use \x1B[4m"+n+"pro\x1B[0;-11;-12mfile name or \x1B[4m"+n+"pro\x1B[0;-11;-12mfile name enable/disable")}}return this._.telnet.prompt?this._.print(`
\x1B[-7;-8m`+e+`\x1B[0m
`,!1):this._.print("\x1B[-7;-8m"+e+`\x1B[0m
`,!1),this._.telnet.prompt=!1,null;case"color":case"co":if(this.de(s),e.length>1&&e.length<4)return u={profile:null,pattern:null,commands:null},u.pattern=e.shift(),u.pattern.match(/^\{.*\}$/g)?u.pattern=this.parseInline(u.pattern.substr(1,u.pattern.length-2)):u.pattern=this.parseInline(this.stripQuotes(u.pattern)),e.length===2?(u.commands=n+"COLOR "+this.parseInline(e[0]),u.profile=this.stripQuotes(e[1]),u.profile.length!==0&&(u.profile=this.parseInline(u.profile))):u.commands=n+"COLOR "+this.parseInline(e[0]),this.createTrigger(u.pattern,u.commands,u.profile),null;if(e.length!==1)throw new Error("Invalid syntax use \x1B[4m"+n+"co\x1B[0;-11;-12mlor color or \x1B[4m"+n+"co\x1B[0;-11;-12mlor {pattern} color \x1B[3mprofile\x1B[0;-11;-12m");if(e.length!==1)throw new Error("Invalid syntax use \x1B[4m"+n+"co\x1B[0;-11;-12mlor color or \x1B[4m"+n+"co\x1B[0;-11;-12mlor {pattern} color \x1B[3mprofile\x1B[0;-11;-12m");if(e[0]=this.parseInline(this.stripQuotes(e[0])),r=this.ge.lines.length,e[0].trim().match(/^[-|+]?\d+$/g))setTimeout(()=>{r=this.adjustLastLine(r),this.ge.colorSubStrByLine(r,parseInt(e[0],10))},0);else if(e[0].trim().match(/^[-|+]?\d+\s*?,\s*?[-|+]?\d+$/g))e[0]=e[0].split(","),setTimeout(()=>{r=this.adjustLastLine(r),this.ge.colorSubStrByLine(r,parseInt(e[0][0],10),parseInt(e[0][1],10))},0);else if(e=e[0].toLowerCase().split(","),e.length===1){if(e[0]==="bold"&&(c=370),e[0].trim().match(/^#(?:[a-f0-9]{3}|[a-f0-9]{6})\b$/g))c=e[0].trim();else if(e[0].trim().match(/^[-|+]?\d+$/g))c=parseInt(e[0].trim(),10);else if(c=xe(e[0]),c===-1)if(Ae(e[0]))c=e[0];else throw new Le;setTimeout(()=>{r=this.adjustLastLine(r),this.ge.colorSubStrByLine(r,c)},0)}else if(e.length===2){if(e[0]==="bold"&&e[1]==="bold")throw new Le;if(e[0]==="bold")c=370;else if(e[0]==="current")c=null;else if(e[0].trim().match(/^#(?:[a-f0-9]{3}|[a-f0-9]{6})\b$/g))c=e[0].trim();else if(e[0].trim().match(/^[-|+]?\d+$/g))c=parseInt(e[0].trim(),10);else if(c=xe(e[0]),c===-1)if(Ae(e[0]))c=e[0];else throw new Le;if(e[1]==="bold")setTimeout(()=>{r=this.adjustLastLine(r),c===370?this.ge.colorSubStrByLine(r,c):this.ge.colorSubStrByLine(r,c*10)},0);else{if(E=c,e[1].trim().match(/^#(?:[a-f0-9]{3}|[a-f0-9]{6})\b$/g))c=e[1].trim();else if(e[1].trim().match(/^[-|+]?\d+$/g))c=parseInt(e[1].trim(),10);else if(c=xe(e[1],!0),c===-1)if(Ae(e[1]))c=e[1];else throw new Ze;setTimeout(()=>{r=this.adjustLastLine(r),this.ge.colorSubStrByLine(r,E,c)},0)}}else if(e.length===3){if(e[0]==="bold"&&(e.shift(),e.push("bold")),e[0].trim()==="current")c=null;else if(e[0].trim().match(/^#(?:[a-f0-9]{3}|[a-f0-9]{6})\b$/g))c=e[0].trim();else if(e[0].trim().match(/^[-|+]?\d+$/g))c=parseInt(e[0].trim(),10);else if(c=xe(e[0]),c===-1)if(Ae(e[0]))c=e[0];else throw new Le;if(e[2]!=="bold")throw new Error("Only bold is supported as third argument");if(c?E=c*10:c=370,e[1].trim().match(/^#(?:[a-f0-9]{3}|[a-f0-9]{6})\b$/g))c=e[1].trim();else if(e[1].trim().match(/^[-|+]?\d+$/g))c=parseInt(e[1].trim(),10);else if(c=xe(e[1],!0),c===-1)if(Ae(e[1]))c=e[0];else throw new Ze;setTimeout(()=>{r=this.adjustLastLine(r),this.ge.colorSubStrByLine(r,E,c)},0)}return null;case"cw":if(this.de(s),w=this.stack.regex,e.length>1&&e.length<4)return u={profile:null,pattern:null,commands:null},u.pattern=e.shift(),u.pattern.match(/^\{.*\}$/g)?u.pattern=this.parseInline(u.pattern.substr(1,u.pattern.length-2)):u.pattern=this.parseInline(this.stripQuotes(u.pattern)),e.length===2?(u.commands=n+"CW "+this.parseInline(e[0]),u.profile=this.stripQuotes(e[1]),u.profile.length!==0&&(u.profile=this.parseInline(u.profile))):u.commands=n+"CW "+this.parseInline(e[0]),this.createTrigger(u.pattern,u.commands,u.profile),null;if(e.length!==1)throw new Error("Invalid syntax use "+n+"cw color or "+n+"cw {pattern} color \x1B[3mprofile\x1B[0;-11;-12m");if(!w)return null;if(e[0]=this.parseInline(this.stripQuotes(e[0])),r=this.ge.lines.length,e[0].trim().match(/^[-|+]?\d+$/g))setTimeout(()=>{if(r=this.adjustLastLine(r),w.length===1)this.ge.colorSubStrByLine(r,parseInt(e[0],10));else{w[1].lastIndex=0,g=w[0].matchAll(w[1]);for(let v of g)this.ge.colorSubStrByLine(r,parseInt(e[0],10),null,v.index,v[0].length)}},0);else if(e[0].trim().match(/^[-|+]?\d+,[-|+]?\d+$/g))e[0]=e[0].split(","),setTimeout(()=>{if(r=this.adjustLastLine(r),w.length===1)this.ge.colorSubStrByLine(r,parseInt(e[0][0],10),parseInt(e[0][1],10));else{w[1].lastIndex=0,g=w[0].matchAll(w[1]);for(let v of g)this.ge.colorSubStrByLine(r,parseInt(e[0],10),parseInt(e[0][1],10),v.index,v[0].length)}},0);else if(e=e[0].toLowerCase().split(","),e.length===1){if(e[0]==="bold"&&(c=370),e[0].trim().match(/^#(?:[a-f0-9]{3}|[a-f0-9]{6})\b$/g))c=e[0].trim();else if(e[0].trim().match(/^[-|+]?\d+$/g))c=parseInt(e[0].trim(),10);else if(c=xe(e[0]),c===-1)if(Ae(e[0]))c=e[0];else throw new Le;setTimeout(()=>{if(r=this.adjustLastLine(r),w.length===1)this.ge.colorSubStrByLine(r,c);else{w[1].lastIndex=0,g=w[0].matchAll(w[1]);for(let v of g)this.ge.colorSubStrByLine(r,c,null,v.index,v[0].length)}},0)}else if(e.length===2){if(e[0]==="bold"&&e[1]==="bold")throw new Le;if(e[0]==="bold")c=370;else if(e[0]==="current")c=null;else if(e[0].trim().match(/^#(?:[a-f0-9]{3}|[a-f0-9]{6})\b$/g))c=e[0].trim();else if(e[0].trim().match(/^[-|+]?\d+$/g))c=parseInt(e[0].trim(),10);else if(c=xe(e[0]),c===-1)if(Ae(e[0]))c=e[0];else throw new Le;if(e[1]==="bold")setTimeout(()=>{if(r=this.adjustLastLine(r),c!==370&&(c*=10),w.length===1)this.ge.colorSubStrByLine(r,c);else{w[1].lastIndex=0,g=w[0].matchAll(w[1]);for(let v of g)this.ge.colorSubStrByLine(r,c,null,v.index,v[0].length)}},0);else{if(E=c,e[1].trim().match(/^#(?:[a-f0-9]{3}|[a-f0-9]{6})\b$/g))c=e[1].trim();else if(e[1].trim().match(/^[-|+]?\d+$/g))c=parseInt(e[1].trim(),10);else if(c=xe(e[1],!0),c===-1)if(Ae(e[1]))c=e[1];else throw new Ze;setTimeout(()=>{if(r=this.adjustLastLine(r),w.length===1)this.ge.colorSubStrByLine(r,E,c);else{w[1].lastIndex=0,g=w[0].matchAll(w[1]);for(let v of g)this.ge.colorSubStrByLine(r,E,c,v.index,v[0].length)}},0)}}else if(e.length===3){if(e[0]==="bold"&&(e.shift(),e.push("bold")),e[0].trim()==="current")c=null;else if(e[0].trim().match(/^#(?:[a-f0-9]{3}|[a-f0-9]{6})\b$/g))c=e[0].trim();else if(e[0].trim().match(/^[-|+]?\d+$/g))c=parseInt(e[0].trim(),10);else if(c=xe(e[0]),c===-1)if(Ae(e[0]))c=e[0];else throw new Le;if(e[2]!=="bold")throw new Error("Only bold is supported as third argument");if(c?E=c*10:c=370,e[1].trim().match(/^#(?:[a-f0-9]{3}|[a-f0-9]{6})\b$/g))c=e[1].trim();else if(e[1].trim().match(/^[-|+]?\d+$/g))c=parseInt(e[1].trim(),10);else if(c=xe(e[1],!0),c===-1)if(Ae(e[1]))c=e[0];else throw new Ze;setTimeout(()=>{if(r=this.adjustLastLine(r),w.length===1)this.ge.colorSubStrByLine(r,E,c);else{w[1].lastIndex=0,g=w[0].matchAll(w[1]);for(let v of g)this.ge.colorSubStrByLine(r,E,c,v.index,v[0].length)}},0)}return null;case"pcol":if(this.de(s),e.length<1||e.length>5)throw new Error("Invalid syntax use "+n+"pcol color \x1B[3mXStart, XEnd, YStart, YEnd\x1B[0;-11;-12m");if(e.length>1){if(g=[].concat(...e.slice(1).map(v=>this.parseInline(this.stripQuotes(v)).split(" "))),g.length>4)throw new Error("Too many arguments use "+n+"pcol color \x1B[3mXStart, XEnd, YStart, YEnd\x1B[0;-11;-12m");if(u={xStart:0},g.length>0&&(u.xStart=parseInt(g[0],10)),g.length>1&&(u.xEnd=parseInt(g[1],10)),g.length>2&&(u.yStart=parseInt(g[2],10)),g.length>3&&(u.yEnd=parseInt(g[3],10)),u.hasOwnProperty("yEnd")&&u.yEnd>u.yStart)throw new Error("yEnd must be smaller or equal to yStart");if(u.hasOwnProperty("xEnd")&&u.xEnd<u.xStart)throw new Error("xEnd must be larger or equal to xStart")}else u={xStart:0};if(e[0]=this.parseInline(this.stripQuotes(e[0])),r=this.adjustLastLine(this.ge.lines.length),e[0].trim().match(/^[-|+]?\d+$/g))setTimeout(()=>{this.vn(r,parseInt(e[0],10),null,u)},0);else if(e[0].trim().match(/^[-|+]?\d+\s*?,\s*?[-|+]?\d+$/g))e[0]=e[0].split(","),setTimeout(()=>{this.vn(r,parseInt(e[0][0],10),parseInt(e[0][1],10),u)},0);else if(e=e[0].toLowerCase().split(","),e.length===1){if(e[0]==="bold"&&(c=370),e[0].trim().match(/^#(?:[a-f0-9]{3}|[a-f0-9]{6})\b$/g))c=e[0].trim();else if(e[0].trim().match(/^[-|+]?\d+$/g))c=parseInt(e[0].trim(),10);else if(c=xe(e[0]),c===-1)if(Ae(e[0]))c=e[0];else throw new Le;setTimeout(()=>{this.vn(r,c,null,u)},0)}else if(e.length===2){if(e[0]==="bold"&&e[1]==="bold")throw new Le;if(e[0]==="bold")c=370;else if(e[0]==="current")c=null;else if(e[0].trim().match(/^#(?:[a-f0-9]{3}|[a-f0-9]{6})\b$/g))c=e[0].trim();else if(e[0].trim().match(/^[-|+]?\d+$/g))c=parseInt(e[0].trim(),10);else if(c=xe(e[0]),c===-1)if(Ae(e[0]))c=e[0];else throw new Le;if(e[1]==="bold")setTimeout(()=>{this.vn(r,c===370?c:c*10,null,u)},0);else{if(E=c,e[1].trim().match(/^#(?:[a-f0-9]{3}|[a-f0-9]{6})\b$/g))c=e[1].trim();else if(e[1].trim().match(/^[-|+]?\d+$/g))c=parseInt(e[1].trim(),10);else if(c=xe(e[1],!0),c===-1)if(Ae(e[1]))c=e[1];else throw new Ze;setTimeout(()=>{this.vn(r,E,c,u)},0)}}else if(e.length===3){if(e[0]==="bold"&&(e.shift(),e.push("bold")),e[0].trim()==="current")c=null;else if(e[0].trim().match(/^#(?:[a-f0-9]{3}|[a-f0-9]{6})\b$/g))c=e[0].trim();else if(e[0].trim().match(/^[-|+]?\d+$/g))c=parseInt(e[0].trim(),10);else if(c=xe(e[0]),c===-1)if(Ae(e[0]))c=e[0];else throw new Le;if(e[2]!=="bold")throw new Error("Only bold is supported as third argument");if(c?E=c*10:c=370,e[1].trim().match(/^#(?:[a-f0-9]{3}|[a-f0-9]{6})\b$/g))c=e[1].trim();else if(e[1].trim().match(/^[-|+]?\d+$/g))c=parseInt(e[1].trim(),10);else if(c=xe(e[1],!0),c===-1)if(Ae(e[1]))c=e[0];else throw new Ze;setTimeout(()=>{this.vn(r,E,c,u)},0)}return null;case"highlight":case"hi":if(this.de(s),e.length>0&&e.length<2)return u={profile:null,pattern:null,commands:n+"HIGHLIGHT"},u.pattern=e.shift(),u.pattern.match(/^\{.*\}$/g)?u.pattern=this.parseInline(u.pattern.substr(1,u.pattern.length-2)):u.pattern=this.parseInline(this.stripQuotes(u.pattern)),e.length===1&&(u.profile=this.parseInline(this.stripQuotes(e[0]))),this.createTrigger(u.pattern,u.commands,u.profile),null;if(e.length)throw new Error("Too many arguments use \x1B[4m"+n+"hi\x1B[0;-11;-12mghlight \x1B[3mpattern profile\x1B[0;-11;-12m");return r=this.ge.lines.length,setTimeout(()=>{r=this.adjustLastLine(r),this.ge.highlightSubStrByLine(r)},0),null;case"break":case"br":if(this.de(s),e.length)throw new Error("Invalid syntax use \x1B[4m"+n+"br\x1B[0;-11;-12meak\x1B[0;-11;-12m");if(!this.loops.length)throw new Error("\x1B[4m"+n+"br\x1B[0;-11;-12meak\x1B[0;-11;-12m must be used in a loop.");return this.stack.break?this.stack.break++:this.stack.break=1,-1;case"continue":case"cont":if(this.de(s),e.length)throw new Error("Invalid syntax use \x1B[4m"+n+"cont\x1B[0;-11;-12minue\x1B[0;-11;-12m");if(!this.loops.length)throw new Error("\x1B[4m"+n+"cont\x1B[0;-11;-12minue\x1B[0;-11;-12m must be used in a loop.");return this.stack.continue=!0,-2;case"if":if(this.de(s),!e.length||e.length>3)throw new Error("Invalid syntax use "+n+"if {expression} {true-command} \x1B[3m{false-command}\x1B[0;-11;-12m");return e[0].match(/^\{[\s\S]*\}$/g)&&(e[0]=e[0].substr(1,e[0].length-2)),g=null,this.evaluate(this.parseInline(e[0]))?(e[1].match(/^\{[\s\S]*\}$/g)&&(e[1]=e[1].substr(1,e[1].length-2)),g=this.parseOutgoing(e[1])):e.length>2&&(e[2].match(/^\{[\s\S]*\}$/g)&&(e[2]=e[2].substr(1,e[2].length-2)),g=this.parseOutgoing(e[2])),g!=null&&g.length>0?g:null;case"case":case"ca":if(this.de(s),!e.length||e.length<2)throw new Error("Invalid syntax use \x1B[4m"+n+"ca\x1B[0;-11;-12mse\x1B[0;-11;-12m index {command 1} \x1B[3m{command n}\x1B[0;-11;-12m");return e[0].match(/^\{[\s\S]*\}$/g)&&(e[0]=e[0].substr(1,e[0].length-2)),r=this.evaluate(this.parseInline(e[0])),typeof r!="number"?null:r>0&&r<e.length&&(e[r].match(/^\{[\s\S]*\}$/g)&&(e[r]=e[r].substr(1,e[r].length-2)),g=this.parseOutgoing(e[r]),g!=null&&g.length>0)?g:null;case"switch":case"sw":if(this.de(s),!e.length||e.length<2)throw new Error("Invalid syntax use \x1B[4m"+n+"sw\x1B[0;-11;-12mitch\x1B[0;-11;-12m (expression) {command} \x1B[3m(expression) {command} ... {else_command}\x1B[0;-11;-12m");for(e.length%2===1?r=e.pop():r=null,h=e.length,c=0;c<h;c+=2)if(e[c].match(/^\{[\s\S]*\}$/g)&&(e[c]=e[c].substr(1,e[c].length-2)),this.evaluate(this.parseInline(e[c])))return e[c+1].match(/^\{[\s\S]*\}$/g)&&(e[c+1]=e[c+1].substr(1,e[c+1].length-2)),g=this.parseOutgoing(e[c+1]),g!=null&&g.length>0?g:null;return r&&(r.match(/^\{[\s\S]*\}$/g)&&(r=r.substr(1,r.length-2)),g=this.parseOutgoing(r),g!=null&&g.length>0)?g:null;case"loop":case"loo":if(this.de(s),e.length<2)throw new Error("Invalid syntax use \x1B[4m"+n+"loo\x1B[0;-11;-12mp\x1B[0;-11;-12m range {commands}");if(r=this.parseInline(e.shift()).split(","),e=e.join(" "),e.match(/^\{[\s\S]*\}$/g)&&(e=e.substr(1,e.length-2)),r.length===1){if(g=parseInt(r[0],10),isNaN(g))throw new Error("Invalid loop range '"+r[0]+"' must be a number");return this.xn(0,g,e)}if(g=parseInt(r[0],10),isNaN(g))throw new Error("Invalid loop min '"+r[0]+"' must be a number");if(c=parseInt(r[1],10),isNaN(c))throw new Error("Invalid loop max '"+r[1]+"' must be a number");return g>c?g++:g--,this.xn(g,c,e);case"repeat":case"rep":if(this.de(s),e.length<2)throw new Error("Invalid syntax use \x1B[4m"+n+"rep\x1B[0;-11;-12meat\x1B[0;-11;-12m expression {commands}");if(c=e.shift(),c.match(/^\{[\s\S]*\}$/g)&&(c=c.substr(1,c.length-2)),c=this.evaluate(this.parseInline(c)),typeof c!="number")throw new Error("Arguments must be a number");return e=e.join(" "),e.match(/^\{[\s\S]*\}$/g)&&(e=e.substr(1,e.length-2)),c<1?this.xn(-c+1,1,e):this.xn(0,c,e);case"until":if(this.de(s),e.length<2)throw new Error("Invalid syntax use "+n+"until expression {commands}");for(c=e.shift(),c.match(/^\{[\s\S]*\}$/g)&&(c=c.substr(1,c.length-2)),e=e.join(" "),e.match(/^\{[\s\S]*\}$/g)&&(e=e.substr(1,e.length-2)),g=[],this.loops.push(0);!this.evaluate(this.parseInline(c));){let v=this.parseOutgoing(e);if(v!=null&&v.length>0&&g.push(v),this.stack.continue){this.stack.continue=!1;continue}if(this.stack.break){this.stack.break--;break}}return this.loops.pop(),g.length>0?g.map(v=>v.trim()).join(`
`):null;case"while":case"wh":if(this.de(s),e.length<2)throw new Error("Invalid syntax use \x1B[4m"+n+"wh\x1B[0;-11;-12mile expression {commands}");for(c=e.shift(),c.match(/^\{[\s\S]*\}$/g)&&(c=c.substr(1,c.length-2)),e=e.join(" "),e.match(/^\{[\s\S]*\}$/g)&&(e=e.substr(1,e.length-2)),g=[],this.loops.push(0);this.evaluate(this.parseInline(c));){let v=this.parseOutgoing(e);if(v!=null&&v.length>0&&g.push(v),this.stack.continue){this.stack.continue=!1;continue}if(this.stack.break){this.stack.break--;break}}return this.loops.pop(),g.length>0?g.map(v=>v.trim()).join(`
`):null;case"forall":case"fo":if(this.de(s),e.length<2)throw new Error("Invalid syntax use \x1B[4m"+n+"fo\x1B[0;-11;-12mrall stringlist {commands}");for(c=e.shift(),c.match(/^\{[\s\S]*\}$/g)&&(c=c.substr(1,c.length-2)),e=e.join(" "),e.match(/^\{[\s\S]*\}$/g)&&(e=e.substr(1,e.length-2)),g=[],c=this.splitByQuotes(this.stripQuotes(this.parseInline(c)),"|"),h=c.length,r=0;r<h;r++){this.loops.push(c[r]);let v=this.parseOutgoing(e);if(v!=null&&v.length>0&&g.push(v),this.stack.continue){this.stack.continue=!1;continue}if(this.stack.break){this.stack.break--;break}this.loops.pop()}return g.length>0?g.map(v=>v.trim()).join(`
`):null;case"variable":case"var":case"va":if(this.de(s),e.length===0){for(c=Object.keys(this._.variables),h=c.length,g=[],r=0;r<h;r++)g.push(c[r]+" = "+this._.variables[c[r]]);return g.join(`
`)}if(c=e.shift(),c.match(/^\{.*\}$/g)&&(c=c.substr(1,c.length-2)),c=this.parseInline(c),!ot(c))throw new Error("Invalid variable name");return e.length===0?this._.variables[c]?.toString():(e=e.join(" "),e.match(/^\{[\s\S]*\}$/g)&&(e=e.substr(1,e.length-2)),e=this.parseInline(e),e.match(/^\s*?[-|+]?\d+\s*?$/)?this._.variables[c]=parseInt(e,10):e.match(/^\s*?[-|+]?\d+\.\d+\s*?$/)?this._.variables[c]=parseFloat(e):e==="true"?this._.variables[c]=!0:e==="false"?this._.variables[c]=!1:this._.variables[c]=this.stripQuotes(e),null);case"unvar":case"unv":if(this.de(s),e.length!==1)throw new Error("Invalid syntax use \x1B[4m"+n+"unv\x1B[0;-11;-12mar name ");return c=e.shift(),c.match(/^\{[\s\S]*\}$/g)&&(c=c.substr(1,c.length-2)),c=this.parseInline(c),delete this._.variables[c],null;case"add":case"ad":if(this.de(s),e.length<2)throw new Error("Invalid syntax use \x1B[4m"+n+"ad\x1B[0;-11;-12md name value");if(c=e.shift(),c.match(/^\{[\s\S]*\}$/g)&&(c=c.substr(1,c.length-2)),c=this.parseInline(c),this._.variables.hasOwnProperty(c)&&typeof this._.variables[c]!="number")throw new Error(c+" is not a number for add");if(e=e.join(" "),e.match(/^\{[\s\S]*\}$/g)&&(e=e.substr(1,e.length-2)),e=this.evaluate(this.parseInline(e)),typeof e!="number")throw new Error("Value is not a number for add");return this._.variables.hasOwnProperty(c)?this._.variables[c]+=e:this._.variables[c]=e,null;case"math":case"mat":if(this.de(s),e.length<2)throw new Error("Invalid syntax use \x1B[4m"+n+"mat\x1B[0;-11;-12mh name value");if(c=e.shift(),c.match(/^\{[\s\S]*\}$/g)&&(c=c.substr(1,c.length-2)),c=this.parseInline(c),e=e.join(" "),e.match(/^\{[\s\S]*\}$/g)&&(e=e.substr(1,e.length-2)),e=this.evaluate(this.parseInline(e)),typeof e!="number")throw new Error("Value is not a number for add");return this._.variables[c]=e,null;case"evaluate":case"eva":if(this.de(s),e.length===0)throw new Error("Invalid syntax use \x1B[4m"+n+"eva\x1B[0;-11;-12mluate expression");return e=this.evaluate(this.parseInline(e.join(" "))),this.se("ignoreEvalUndefined")&&typeof e>"u"?e="":e=""+e,this._.telnet.prompt?this._.print(`
`+e+`\x1B[0m
`,!1):this._.print(e+`\x1B[0m
`,!1),this._.telnet.prompt=!1,null;case"freeze":case"fr":if(this.de(s),e.length===0)this.scrollLock=!this.scrollLock,this.scrollLock?this.ge.scrollAtBottom&&this.ge.scrollUp():this.ge.scrollDisplay();else if(e.length===1)e[0]==="0"||e[0]==="false"?this.scrollLock&&(this.scrollLock=!1,this.ge.scrollDisplay()):this.scrollLock||(this.scrollLock=!0,this.ge.scrollAtBottom&&this.ge.scrollUp());else if(e.length>1)throw new Error("Invalid syntax use \x1B[4m"+n+"fr\x1B[0;-11;-12meeze \x1B[3mnumber\x1B[0;-11;-12m");return null;case"clr":if(this.de(s),e.length)throw new Error("Invalid syntax use "+n+"CLR");if(this.ge.lines.length===0)return null;for(c=this.ge.WindowSize.height+2,r=this.ge.lines.length;r--&&c&&!this.ge.lines[r].text.length;)c--;for(g=[];c--;)g.push(`
`);return this._.print(g.join(""),!0),null;case"fire":return this.de(s),e=this.parseInline(e.join(" ")+`
`),this.ExecuteTriggers(140,e,e,!1,!1),null;case"state":case"sta":switch(this.de(s),e=e.map(v=>!v||!v.length?v:v.match(/^\{.*\}$/g)?this.parseInline(v.substr(1,v.length-2)):this.parseInline(this.stripQuotes(v))),e.length){case 0:throw new Error("Invalid syntax use \x1B[4m"+n+"sta\x1B[0;-11;-12mte \x1B[3m name|pattern state profile\x1B[0;-11;-12m");case 1:if(e[0].match(/^\s*?[-|+]?\d+\s*?$/)){if(!this.Ls)throw new Error("No trigger has fired yet, unable to set state");w=this.Ls,r=w.state,w.state=parseInt(e[0],10)}else{let v=this.ee.keys,O=0,C=v.length;if(C===0)return null;if(C===1){if(!this.ee.items[v[0]].enabled||!this.ee.items[v[0]].enableTriggers)throw Error("No enabled profiles found!");w=se(this.ee.items[v[O]].triggers),w=w.find(I=>I.name===e[0]||I.pattern===e[0])}else for(;O<C&&!(!(!this.ee.items[v[O]].enabled||!this.ee.items[v[O]].enableTriggers||this.ee.items[v[O]].triggers.length===0)&&(w=se(this.ee.items[v[O]].triggers),w=w.find(I=>I.name===e[0]||I.pattern===e[0]),w));O++);if(!w)throw new qe(e[0]);r=w.state,w.state=0}break;case 2:if(e[0].match(/^\s*?[-|+]?\d+\s*?$/))throw new Error("Invalid argument to "+n+"state, first argument must be name|pattern");if(e[1].match(/^\s*?[-|+]?\d+\s*?$/)){let v=this.ee.keys,O=0,C=v.length;if(C===0)return null;if(C===1){if(!this.ee.items[v[0]].enabled||!this.ee.items[v[0]].enableTriggers)throw Error("No enabled profiles found!");w=se(this.ee.items[v[O]].triggers),w=w.find(I=>I.name===e[0]||I.pattern===e[0])}else for(;O<C&&!(!(!this.ee.items[v[O]].enabled||!this.ee.items[v[O]].enableTriggers||this.ee.items[v[O]].triggers.length===0)&&(w=se(this.ee.items[v[O]].triggers),w=w.find(I=>I.name===e[0]||I.pattern===e[0]),w));O++);if(!w)throw new qe(e[0]);r=w.state,w.state=parseInt(e[1],10)}else{if(m=e[1],this.ee.contains(m))m=this.ee.items[m.toLowerCase()];else throw new De(e[1]);if(w=se(m.triggers),w=w.find(v=>v.name===e[0]||v.pattern===e[0]),!w)throw new qe(e[0],m.name);r=w.state,w.state=0}break;case 3:if(e[0].match(/^\s*?[-|+]?\d+\s*?$/))throw new Error("Invalid argument to "+n+"state, first argument must be name|pattern");if(m=e[2],this.ee.contains(m))m=this.ee.items[m.toLowerCase()];else throw new De(e[2]);if(w=se(m.triggers),w=w.find(v=>v.name===e[0]||v.pattern===e[0]),!w)throw new qe(e[0]);r=w.state,w.state=parseInt(e[1],10);break;default:throw new Error("Invalid syntax use \x1B[4m"+n+"sta\x1B[0;-11;-12mte \x1B[3m name|pattern state profile\x1B[0;-11;-12m")}if(w.state<0||w.state>w.triggers.length)throw w.state=r,new Error("Trigger state must be greater than or equal to 0 or less than or equal to "+w.triggers.length);return c=w.fired,w.fired=!1,this.resetTriggerState(this.gi.indexOf(w),r,c),this._.restartAlarmState(w,r,w.state),this._.saveProfiles(),this._.emit("item-updated","trigger",w.profile.name,w.profile.triggers.indexOf(w),w),this.Le("Trigger state set to "+w.state+".",-7,-8,!0,!0),null;case"set":switch(this.de(s),e=e.map(v=>!v||!v.length?v:v.match(/^\{.*\}$/g)?this.parseInline(v.substr(1,v.length-2)):this.parseInline(this.stripQuotes(v))),r=0,c=!1,e.length){case 0:throw new Error("Invalid syntax use "+n+"set \x1B[3mname|pattern\x1B[0;-11;-12m state \x1B[3mvalue profile\x1B[0;-11;-12m");case 1:if(e[0].match(/^\s*?[-|+]?\d+\s*?$/)){if(!this.Ls)throw new Error("No trigger has fired yet, unable to set state");if(w=this.Ls,r=parseInt(e[0],10),r<0||r>w.triggers.length)throw new Error("Trigger state must be greater than or equal to 0 or less than or equal to "+w.triggers.length);r===0?(c=w.fired,w.fired=!0):(c=w.triggers[r-1].fired,w.triggers[r-1].fired=!0)}else throw new Error("Trigger state must be greater than or equal to 0 or less than or equal to "+w.triggers.length);break;case 2:if(e[0].match(/^\s*?[-|+]?\d+\s*?$/)){if(!this.Ls)throw new Error("No trigger has fired yet, unable to set state");if(w=this.Ls,r=parseInt(e[0],10),r<0||r>w.triggers.length)throw new Error("Trigger state must be greater than or equal to 0 or less than or equal to "+w.triggers.length);if(e[1]!=="0"&&e[1]!=="1"&&e[1]!=="true"&&e[1]!=="false")throw new Error("Value must be 0, 1, true, or false");r===0?(c=w.fired,w.fired=e[1]==="1"||e[1]==="true"):(c=w.triggers[r-1].fired,w.triggers[r-1].fired=e[1]==="1"||e[1]==="true")}else{let v=this.ee.keys,O=0,C=v.length;if(C===0)return null;if(C===1){if(!this.ee.items[v[0]].enabled||!this.ee.items[v[0]].enableTriggers)throw Error("No enabled profiles found!");w=se(this.ee.items[v[O]].triggers),w=w.find(I=>I.name===e[0]||I.pattern===e[0])}else for(;O<C&&!(!(!this.ee.items[v[O]].enabled||!this.ee.items[v[O]].enableTriggers||this.ee.items[v[O]].triggers.length===0)&&(w=se(this.ee.items[v[O]].triggers),w=w.find(I=>I.name===e[0]||I.pattern===e[0]),w));O++);if(!w)throw new qe(e[0]);if(r=parseInt(e[1],10),r<0||r>w.triggers.length)throw new Error("Trigger state must be greater than or equal to 0 or less than or equal to "+w.triggers.length);r===0?(c=w.fired,w.fired=!0):(c=w.triggers[r-1].fired,w.triggers[r-1].fired=!0)}break;case 3:if(e[2]==="0"&&e[2]!=="1"&&e[2]!=="true"&&e[21]!=="false"){if(m=e[2],this.ee.contains(m))m=this.ee.items[m.toLowerCase()];else throw new De(m);if(w=se(m.triggers),w=w.find(v=>v.name===e[0]||v.pattern===e[0]),!w)throw new qe(e[0],m.name);if(r=parseInt(e[1],10),r<0||r>w.triggers.length)throw new Error("Trigger state must be greater than or equal to 0 or less than or equal to "+w.triggers.length);r===0?(c=w.fired,w.fired=!0):(c=w.triggers[r-1].fired,w.triggers[r-1].fired=!0)}else{let v=this.ee.keys,O=0,C=v.length;if(C===0)return null;if(C===1){if(!this.ee.items[v[0]].enabled||!this.ee.items[v[0]].enableTriggers)throw Error("No enabled profiles found!");w=se(this.ee.items[v[O]].triggers),w=w.find(I=>I.name===e[0]||I.pattern===e[0])}else for(;O<C&&!(!(!this.ee.items[v[O]].enabled||!this.ee.items[v[O]].enableTriggers||this.ee.items[v[O]].triggers.length===0)&&(w=se(this.ee.items[v[O]].triggers),w=w.find(I=>I.name===e[0]||I.pattern===e[0]),w));O++);if(!w)throw new qe(e[0]);if(r=parseInt(e[1],10),r<0||r>w.triggers.length)throw new Error("Trigger state must be greater than or equal to 0 or less than or equal to "+w.triggers.length);r===0?(c=w.fired,w.fired=e[2]==="1"||e[2]==="true"):(c=w.triggers[r-1].fired,w.triggers[r-1].fired=e[2]==="1"||e[2]==="true")}break;case 4:if(m=e[2],this.ee.contains(m))m=this.ee.items[m.toLowerCase()];else throw new De(m);if(w=se(m.triggers),w=w.find(v=>v.name===e[0]||v.pattern===e[0]),!w)throw new qe(e[0],m.name);if(e[2]!=="0"&&e[2]!=="1"&&e[2]!=="true"&&e[2]!=="false")throw new Error("Value must be 0, 1, true, or false");r===0?(c=w.fired,w.fired=e[2]==="1"||e[2]==="true"):(c=w.triggers[r-1].fired,w.triggers[r-1].fired=e[2]==="1"||e[2]==="true");break;default:throw new Error("Invalid syntax use "+n+"set \x1B[3mname|pattern\x1B[0;-11;-12m state \x1B[3mvalue profile\x1B[0;-11;-12m")}return this._.saveProfiles(),this._.emit("item-updated","trigger",w.profile.name,w.profile.triggers.indexOf(w),w),this.resetTriggerState(this.gi.indexOf(w),r,c),r===0?this.Le("Trigger state 0 fired state set to "+w.fired+".",-7,-8,!0,!0):(this.Le("Trigger state "+r+" fired state set to "+w.triggers[r-1].fired+".",-7,-8,!0,!0),w.enabled&&w.triggers[r-1].enabled&&w.triggers[r-1].type===65536&&(this.Dt="",this.ExecuteTrigger(w,[],!1,this.gi.indexOf(w),0,0,w))),null;case"condition":case"cond":if(this.de(s),u={profile:null,name:null,pattern:null,commands:null,options:{priority:0}},e.length<2||e.length>5)throw new Error("Invalid syntax use \x1B[4m"+n+"cond\x1B[0;-11;-12mition name|pattern {pattern} {commands} \x1B[3moptions profile\x1B[0;-11;-12m or \x1B[4m"+n+"cond\x1B[0;-11;-12mition {pattern} {commands} \x1B[3m{options} profile\x1B[0;-11;-12m");if(e[0].length===0)throw new ce("name or pattern");if(e[0].match(/^\{.*\}$/g))u.pattern=e.shift(),u.pattern=this.parseInline(u.pattern.substr(1,u.pattern.length-2));else{if(u.name=this.parseInline(this.stripQuotes(e.shift())),!u.name||u.name.length===0)throw new ce("name");e[0].match(/^\{.*\}$/g)&&(u.pattern=e.shift(),u.pattern=this.parseInline(u.pattern.substr(1,u.pattern.length-2)))}if(e.length!==0){if(e[0].match(/^\{[\s\S]*\}$/g)&&(u.commands=e.shift(),u.commands=u.commands.substr(1,u.commands.length-2)),e.length===1)if(e[0].match(/^\{[\s\S]*\}$/g)?e[0]=e[0].substr(1,e[0].length-2):e[0]=this.stripQuotes(e[0]),e[0].length!==0)this.parseInline(e[0]).split(",").forEach(v=>{switch(v.trim()){case"nocr":case"prompt":case"case":case"verbatim":case"disable":case"enable":case"cmd":case"temporary":case"temp":case"raw":case"pattern":case"regular":case"alarm":case"event":case"cmdpattern":case"loopexpression":case"reparse":case"reparsepattern":case"manual":case"skip":case"looplines":case"looppattern":case"wait":case"duration":case"withinlines":u.options[v.trim()]=!0;break;default:if(v.trim().startsWith("param=")){if(g=v.trim().split("="),g.length!==2)throw new ce(`param option '${v.trim()}'`);u.options.params=g[1]}else if(v.trim().startsWith("type=")){if(g=v.trim().split("="),g.length!==2)throw new ce(`type option '${v.trim()}'`);if(!this.Ms(g[1]))throw new ce("type");u.options.type=g[1]}else if(v.trim().startsWith("pri=")||v.trim().startsWith("priority=")){if(g=v.trim().split("="),g.length!==2)throw new ce(`priority option '${v.trim()}'`);if(c=parseInt(g[1],10),isNaN(c))throw new ce("priority value '"+g[1]+"' must be a number");u.options.priority=c}else throw new ce(`option '${v.trim()}'`)}});else throw new ce("options");else if(e.length===2){if(e[0].match(/^\{[\s\S]*\}$/g)&&(e[0]=e[0].substr(1,e[0].length-2)),e[0].length!==0)this.parseInline(e[0]).split(",").forEach(v=>{switch(v.trim()){case"nocr":case"prompt":case"case":case"verbatim":case"disable":case"enable":case"cmd":case"temporary":case"temp":case"raw":case"pattern":case"regular":case"alarm":case"event":case"cmdpattern":case"loopexpression":case"reparse":case"reparsepattern":case"manual":case"skip":case"looplines":case"looppattern":case"wait":case"duration":case"withinlines":u.options[v.trim()]=!0;break;default:if(v.trim().startsWith("param=")){if(g=v.trim().split("="),g.length!==2)throw new ce(`param option '${v.trim()}'`);u.options.params=g[1]}else if(v.trim().startsWith("type=")){if(g=v.trim().split("="),g.length!==2)throw new ce(`type option '${v.trim()}'`);if(!this.Ms(g[1]))throw new ce("type");u.options.type=g[1]}else if(v.trim().startsWith("pri=")||v.trim().startsWith("priority=")){if(g=v.trim().split("="),g.length!==2)throw new ce(`priority option '${v.trim()}'`);if(c=parseInt(g[1],10),isNaN(c))throw new ce("priority value '"+g[1]+"' must be a number");u.options.priority=c}else throw new ce(`option '${v.trim()}'`)}});else throw new ce("options");u.profile=this.stripQuotes(e[1]),u.profile.length!==0&&(u.profile=this.parseInline(u.profile))}}return this.createTrigger(u.pattern,u.commands,u.profile,u.options,u.name,!0),null;case"cr":return this.de(s),this._.sendBackground(`
`),null;case"send":case"se":if(this.de(s),e.length===0)throw new Error("Invalid syntax use \x1B[4m"+n+"se\x1B[0;-11;-12mnd file \x1B[3mprefix suffix\x1B[0;-11;-12m or \x1B[4m"+n+"se\x1B[0;-11;-12mnd text");if(e=e.join(" "),e.length===0)throw new Error("Invalid syntax use \x1B[4m"+n+"se\x1B[0;-11;-12mnd file \x1B[3mprefix suffix\x1B[0;-11;-12m or \x1B[4m"+n+"se\x1B[0;-11;-12mnd text");return this._.sendBackground(this.stripQuotes(e),this.se("allowCommentsFromCommand")),null;case"sendfile":case"sendf":return((v,O)=>{Se().then(C=>{Ee(C[0]).then(I=>{this.de(O),E="",c="",v.length>1&&(E=this.stripQuotes(this.parseInline(v[0]))),v.length>2&&(c=this.stripQuotes(this.parseInline(v[1]))),a=I.split(/\r?\n/),a.forEach(D=>{this._.sendBackground(E+D+c,null,this.se("allowCommentsFromCommand"))})}).catch(I=>this._.error(I))}).catch(()=>{})})(e,s),null;case"sendfileraw":case"sendfiler":return((v,O)=>{Se().then(C=>{Ee(C[0]).then(I=>{this.de(O),E="",c="",v.length>1&&(E=this.stripQuotes(this.parseInline(v[0]))),v.length>2&&(c=this.stripQuotes(this.parseInline(v[1]))),a=I.split(/\r?\n/),a.forEach(D=>{this._.sendRaw(E+D+c)})}).catch(I=>this._.error(I))}).catch(()=>{})})(e,s),null;case"sendraw":if(this.de(s),e.length===0)throw new Error("Invalid syntax use "+n+"sendraw text or "+n+"sendraw file \x1B[3mprefix suffix\x1B[0;-11;-12m");if(e=e.join(" "),e.length===0)throw new Error("Invalid syntax use "+n+"sendraw text or "+n+"sendraw file \x1B[3mprefix suffix\x1B[0;-11;-12m");return e.endsWith(`
`)||(e=e+`
`),this._.sendRaw(e),null;case"sendprompt":case"sendp":if(this.de(s),e.length===0)throw new Error("Invalid syntax use \x1B[4m"+n+"sendp\x1B[0;-11;-12mrompt text");if(e=e.join(" "),e.length===0)throw new Error("Invalid syntax use \x1B[4m"+n+"sendp\x1B[0;-11;-12mrompt text");return this._.sendRaw(e),null;case"character":case"char":return this.de(s),this._.sendRaw(window.Xn||""),null;case"speak":if(this.de(s),e.length===0)throw new Error("Invalid syntax use "+n+"speak text");if(e=e.join(" "),e.length===0)throw new Error("Invalid syntax use "+n+"speak text");return e=this.stripQuotes(this.parseInline(e)),e.length!==0&&window.speechSynthesis.speak(new SpeechSynthesisUtterance(e)),null;case"speakstop":if(this.de(s),e.length!==0)throw new Error("Invalid syntax use "+n+"speakstop");return window.speechSynthesis.cancel(),null;case"speakpause":if(this.de(s),e.length!==0)throw new Error("Invalid syntax use "+n+"speakpause");return window.speechSynthesis.pause(),null;case"speakresume":if(this.de(s),e.length!==0)throw new Error("Invalid syntax use "+n+"speakresume");return window.speechSynthesis.resume(),null;case"comment":case"comm":return this.de(s),null;case"noop":case"no":return this.de(s),e.length&&this.parseInline(e.join(" ")),null;case"temp":if(this.de(s),u={profile:null,name:null,pattern:null,commands:null,options:{priority:0}},e.length<2||e.length>5)throw new Error("Invalid syntax use "+n+"temp name {pattern} {commands} \x1B[3moptions profile\x1B[0;-11;-12m or "+n+"temp {pattern} {commands} \x1B[3m{options} profile\x1B[0;-11;-12m");if(e[0].length===0)throw new Me("or pattern");if(e[0].match(/^\{.*\}$/g))u.pattern=e.shift(),u.pattern=this.parseInline(u.pattern.substr(1,u.pattern.length-2));else{if(u.name=this.parseInline(this.stripQuotes(e.shift())),!u.name||u.name.length===0)throw new Me("name");e[0].match(/^\{.*\}$/g)&&(u.pattern=e.shift(),u.pattern=this.parseInline(u.pattern.substr(1,u.pattern.length-2)))}if(e.length!==0){if(e[0].match(/^\{[\s\S]*\}$/g)&&(u.commands=e.shift(),u.commands=u.commands.substr(1,u.commands.length-2)),e.length===1)if(e[0].match(/^\{[\s\S]*\}$/g)?e[0]=e[0].substr(1,e[0].length-2):e[0]=this.stripQuotes(e[0]),e[0].length!==0)this.parseInline(e[0]).split(",").forEach(v=>{switch(v.trim()){case"nocr":case"prompt":case"case":case"verbatim":case"disable":case"enable":case"cmd":case"raw":case"pattern":case"regular":case"alarm":case"event":case"cmdpattern":case"loopexpression":u.options[v.trim()]=!0;break;default:if(v.trim().startsWith("param=")){if(g=v.trim().split("="),g.length!==2)throw new Me(`param option '${v.trim()}'`);u.options.params=g[1]}else if(v.trim().startsWith("type=")){if(g=v.trim().split("="),g.length!==2)throw new Me(`type option '${v.trim()}'`);if(!this.Ms(g[1],1))throw new Me("type");u.options.type=g[1]}else if(v.trim().startsWith("pri=")||v.trim().startsWith("priority=")){if(g=v.trim().split("="),g.length!==2)throw new Me(`priority option '${v.trim()}'`);if(c=parseInt(g[1],10),isNaN(c))throw new Me("priority value '"+g[1]+"' must be a number");u.options.priority=c}else throw new Me(`option '${v.trim()}'`)}});else throw new Me("options");else if(e.length===2){if(e[0].match(/^\{[\s\S]*\}$/g)&&(e[0]=e[0].substr(1,e[0].length-2)),e[0].length!==0)this.parseInline(e[0]).split(",").forEach(v=>{switch(v.trim()){case"nocr":case"prompt":case"case":case"verbatim":case"disable":case"enable":case"cmd":case"raw":case"pattern":case"regular":case"alarm":case"event":case"cmdpattern":case"loopexpression":u.options[v.trim()]=!0;break;default:if(v.trim().startsWith("param=")){if(g=v.trim().split("="),g.length!==2)throw new Me(`param option '${v.trim()}'`);u.options.params=g[1]}else if(v.trim().startsWith("type=")){if(g=v.trim().split("="),g.length!==2)throw new Me(`type option '${v.trim()}'`);if(!this.Ms(g[1],1))throw new Me("type");u.options.type=g[1]}else if(v.trim().startsWith("pri=")||v.trim().startsWith("priority=")){if(g=v.trim().split("="),g.length!==2)throw new Me(`priority option '${v.trim()}'`);if(c=parseInt(g[1],10),isNaN(c))throw new Me("priority value '"+g[1]+"' must be a number");u.options.priority=c}else throw new Me(`option '${v.trim()}'`)}});else throw new Me("options");u.profile=this.stripQuotes(e[1]),u.profile.length!==0&&(u.profile=this.parseInline(u.profile))}}return u.options.temporary=!0,this.createTrigger(u.pattern,u.commands,u.profile,u.options,u.name),null;case"wrap":case"wr":if(this.de(s),e=e.filter(v=>v),e.length>1)throw new Error("Invalid syntax use \x1B[4m"+n+"wr\x1B[0;-11;-12map or \x1B[4m"+n+"wr\x1B[0;-11;-12map number");if(e.length===0)this._.setOption("display.wordWrap",!this.se("display.wordWrap")),this.ge.wordWrap=this.se("display.wordWrap");else{if(c=parseInt(this.parseInline(e[0]),10),isNaN(c))throw new Error("Invalid number '"+c+"' for wrap");if(c<0)throw new Error("Must be greater then or equal to zero for wrap");this._.setOption("display.wordWrap",!0),this._.setOption("display.wordWrap",c),this.ge.wordWrap=!0,this.ge.wrapAt=c}return null;case"prompt":case"pr":if(this.de(s),e.length===0||e.length>4)throw new Error("Invalid syntax use \x1B[4m"+n+"pr\x1B[0;-11;-12mompt variable \x1B[3mmessage defaultValue mask\x1B[0;-11;-12m");if(c=e.shift(),c.match(/^\{.*\}$/g)&&(c=c.substr(1,c.length-2)),c=this.parseInline(c),!ot(c))throw new Error("Invalid variable name");return e=e.map(v=>this.parseInline(this.stripQuotes(v))),e.length===3&&e[2]&&e[2].toLowerCase()==="true"&&(e[2]=!0),e=window.prompt(...e),e?.match(/^\s*?[-|+]?\d+\s*?$/)?this._.variables[c]=parseInt(e,10):e?.match(/^\s*?[-|+]?\d+\.\d+\s*?$/)?this._.variables[c]=parseFloat(e):e==="true"?this._.variables[c]=!0:e==="false"?this._.variables[c]=!1:this._.variables[c]=e,null}if(t.match(/^[-|+]?\d+$/)){if(this.de(s),c=parseInt(t,10),e.length===0)throw new Error("Invalid syntax use "+n+"nnn commands");return e=e.join(" "),e.match(/^\{[\s\S]*\}$/g)&&(e=e.substr(1,e.length-2)),c<1?this.xn(-c+1,1,e):this.xn(0,c,e)}let L={name:t,args:e,raw:s,handled:!1,return:null};return this._.emit("function",L),L.handled?(this.de(s),L.return):L.raw.startsWith(n)?n+this.parseOutgoing(L.raw.substr(1),null,null,null,!0):this.parseOutgoing(L.raw+`
`,null,null,null,!0)}xn(t,e,s){let n=[],r;if(t>e)for(r=t-1;r>=e;r--){this.loops.push(r);try{let o=this.parseOutgoing(s);if(o!=null&&o.length>0&&n.push(o),this.stack.continue){this.stack.continue=!1;continue}if(this.stack.break){this.stack.break--;break}}catch(o){throw o}finally{this.loops.pop()}}else for(r=t;r<e;r++){this.loops.push(r+1);try{let o=this.parseOutgoing(s);if(o!=null&&o.length>0&&n.push(o),this.stack.continue){this.stack.continue=!1;continue}if(this.stack.break){this.stack.break--;break}}catch(o){throw o}finally{this.loops.pop()}}return n.length>0?n.map(o=>o.trim()).join(`
`):null}parseInline(t){return this.parseOutgoing(t,!1,null,!1,!0)}parseOutgoing(t,e,s,n,r,o){let a=t.length;if(!this.enableParsing||t==null||a===0)return t;let h="",c="",g,m=0,b=this._.aliases,u=this.se("commandStackingChar"),E=this.se("speedpathsChar"),w=this.se("enableSpeedpaths"),L=this.se("enableCommands"),k=this.se("commandChar"),R=this.se("allowEscape"),B=this.se("escapeChar"),v=this.se("verbatimChar"),O=this.se("enableVerbatim"),C=this.se("enableDoubleParameterEscaping"),I=this.se("parametersChar"),D=this.se("enableParameters"),S=this.se("nParametersChar"),M=this.se("enableNParameters"),q=this.se("allowEval"),Q=this.se("ignoreEvalUndefined"),W=this.se("enableInlineComments")&&!o,ne=this.se("enableBlockComments")&&!o,V=this.se("inlineCommentString").split(""),N=this.se("blockCommentString").split(""),G=this.se("ignoreInputLeadingWhitespace"),K="",Y=[],P="",Z=!0,H="",oe,T,fe,X=0,U,J,le=!0,Oe=!1,Ue=!1,ze=!1,We=0,gt=this.se("parseDoubleQuotes"),Je=this.se("parseSingleQuotes");for(e==null?e=b.length>0:e=e&&b.length>0,u.length===0?s=!1:s==null?s=this.se("commandStacking"):s=s&&this.se("commandStacking"),X=0;X<a;X++)switch(T=t.charAt(X),m){case 1:R&&T===B?m=27:(T==='"'&&gt&&(m=0),e&&Z?c+=T:h+=T),le=!1;break;case 27:m=1,T!=='"'&&T!==B?(X--,e&&Z?c+=B:h+=B):e&&Z?c+=T:h+=T;break;case 2:R&&T===B?m=27:(T==="'"&&Je&&(m=0),e&&Z?c+=T:h+=T),le=!1;break;case 28:m=2,T!=="'"&&T!==B?(X--,e&&Z?c+=B:h+=B):e&&Z?c+=T:h+=T;break;case 3:if(T==='"'&&gt)P+=T,m=4,le=!1;else if(T==="'"&&Je)P+=T,m=5,le=!1;else if(R&&T===B)m=17,le=!1;else if(X===a-1||T===`
`||s&&T===u){for(T===`
`||s&&T===u||(P+=T),P.length>0&&Y.push(this.parseInline(P)),fe=g.length,oe=0;oe<fe;oe++){if(h=this.ExecuteAlias(g[oe],Y),typeof h=="number")return h>=0&&this.executeWait(t.substr(X+1),h,e,s,n,r,o),H.length===0?null:H;if(h!==null&&(H+=h),h="",!oe.multi)break;if(this.stack.continue||this.stack.break)return H.length===0?null:H}c="",m=0,g=null,le=!0}else T===" "?(Y.push(this.parseInline(P)),P="",le=!1):(P+=T,le=!1);break;case 4:T==='"'&&(m=3),P+=T,le=!1;break;case 5:T==="'"&&(m=3),P+=T,le=!1;break;case 17:m=3,T===B||s&&T===u||O&&T===v||w&&T===E||L&&T===k||C&&T===I||M&&T===S?P+=T:W&&T==V[0]||ne&&T==N[0]?J=T:`"'{`.indexOf(T)!==-1?P+=T:P+=B+T;break;case 6:if(R&&T===B)m=18,le=!1;else if(T===`
`||s&&T===u){if(m=0,h=this.ProcessPath(h),h!==null&&(H+=h),h="",le=!0,this.stack.continue||this.stack.break)return H.length===0?null:H}else X===1&&T===E?(m=0,X--,le=!1):(h+=T,le=!1);break;case 18:m=6,T===B||s&&T===u||O&&T===v||w&&T===E||L&&T===k||C&&T===I||M&&T===S?h+=T:W&&T==V[0]||ne&&T==N[0]?J=T:`"'{`.indexOf(T)!==-1?h+=T:h+=B+T;break;case 7:if(T==="{")le=!1,h+=T,We++;else if(T==="}")le=!1,h+=T,We--;else if(We===0&&R&&T===B)m=19,le=!1;else if(We===0&&(T===`
`||s&&T===u)){if(m=0,h=this.executeScript(k+h),typeof h=="number")return h>=0&&this.executeWait(t.substr(X+1),h,e,s,n,r,o),H.length===0?null:H;if(h!==null&&(H+=K+h+`
`),this.stack.continue||this.stack.break)return H.length===0?null:H;h="",le=!0}else h+=T,le=!1;break;case 19:m=7,h+=B+T;break;case 8:if(T==="{"&&P.length===0){m=9;continue}switch(T){case I:P.length===0&&(e&&Z?c+=I:h+=I,m=0,C||X--);break;case"*":if(P.length===0){this.stack.args?(e&&Z?c+=this.stack.args.slice(1).join(" "):h+=this.stack.args.slice(1).join(" "),this.stack.used=this.stack.args.length):e&&Z?c+=I+"*":h+=I+"*",m=0;break}case"-":if(P.length===0){Oe=!0;break}else if(Ue&&P.length==1){Oe=!0;break}else ze=!0;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":if(!ze){P+=T;break}case"x":if(!ze&&P.length===0){Ue=!0;break}default:if(this.stack.args&&P.length>0)U=parseInt(P,10),Ue?Oe&&this.stack.args.indices&&U<this.stack.args.length?U=this.stack.indices.slice(U).map(pe=>pe?pe[0]+" "+pe[1]:"0 0").join(" "):this.stack.args.indices&&U<this.stack.args.length?U=this.stack.args.indices[U]?this.stack.args.indices[U][0]+" "+this.stack.args.indices[U][1]:"0 0":Oe?U=I+"x-"+U:U=I+"x"+U:(Oe&&U<this.stack.args.length?U=this.stack.args.slice(P).join(" "):U<this.stack.args.length?U=this.stack.args[U]:Oe?U=I+"-"+U:U=I+U,Oe?this.stack.used=this.stack.args.length:P>this.stack.used&&(this.stack.used=parseInt(P,10))),e&&Z?c+=U:h+=U,X--;else{if(P.length===0&&this.loops.length>0&&(U=T.charCodeAt(0)-105,U>=0&&U<18&&U<this.loops.length)){e&&Z?c+=this.loops[U]:h+=this.loops[U],m=0;break}e&&Z?(c+=I,Oe&&(c+="-"),Ue&&(c+="x")):(h+=I,Oe&&(h+="-"),Ue&&(h+="x")),X=X-P.length-1}m=0,P="";break}break;case 26:T.match(/[^a-zA-Z0-9_]/g)?(this.stack.named.hasOwnProperty(P)?e&&Z?c+=this.stack.named[P]:h+=this.stack.named[P]:e&&Z?c+=I+P:h+=I+P,X--,m=0,P=""):P+=T;break;case 9:T==="}"&&We===0?(P==="i"?J=this.loops[0]:P==="repeatnum"?J=this.repeatnum:this.stack.args&&P==="*"?(J=this.stack.args.slice(1).join(" "),this.stack.used=this.stack.args.length):this.stack.named&&this.stack.named.hasOwnProperty(P)?J=this.stack.named[P]:this.stack.args&&!isNaN(P)?(U=parseInt(P,10),U<0?-U>=this.stack.args.length?q?J=U:(J=I,X=X-U.length-2):(J=this.stack.args.slice(U).join(" "),this.stack.used=this.stack.args.length):U<this.stack.args.length?(J=this.stack.args[U],P>this.stack.used&&(this.stack.used=U)):q?J=U:(J=I,X=X-P.length-2)):this.stack.args&&this.stack.args.indices&&P.match(/^x[-|+]?\d+$/)?(U=parseInt(P.substring(1),10),U<0?-U>=this.stack.args.length?(J=I,X=X-U.length-2):J=this.stack.indices.slice(U).map(pe=>pe?pe[0]+" "+pe[1]:"0 0").join(" "):U<this.stack.args.length?J=this.stack.args.indices[U]?this.stack.args.indices[U][0]+" "+this.stack.args.indices[U][1]:"0 0":(J=I,X=X-P.length-2)):(U=this.parseVariable(P),U!=null?J=U:q?(J=this.evaluate(this.parseInline(P)),Q&&typeof J>"u"?J=null:J=""+J):(J=I,X=X-P.length-2)),J!=null&&e&&Z?c+=J:J!=null&&(h+=J),m=0,P=""):T==="{"?(We++,P+=T):(T==="}"&&We--,P+=T);break;case 11:T==="{"?m=12:T.match(/[^a-zA-Z_$]/g)?(m=0,X--,e&&Z?c+=S:h+=S):(P=T,m=14);break;case 14:T.match(/[^a-zA-Z0-9_]/g)?(this.stack.named&&this.stack.named.hasOwnProperty(P)?e&&Z?c+=this.stack.named[P]:h+=this.stack.named[P]:this._.variables.hasOwnProperty(P)?e&&Z?c+=this._.variables[P]:h+=this._.variables[P]:e&&Z?c+=S+P:h+=S+P,X--,m=0,P=""):P+=T;break;case 12:T==="}"&&We===0?(J=null,P==="i"?J=this.loops[0]:P==="repeatnum"?J=this.repeatnum:this.stack.args&&P==="*"?(J=this.stack.args.slice(1).join(" "),this.stack.used=this.stack.args.length):this.stack.named&&this.stack.named.hasOwnProperty(P)?J=this.stack.named[P]:this.stack.args&&!isNaN(P)?(U=parseInt(P,10),U<0?-U>=this.stack.args.length?q?J=U:(J=S,X=X-P.length-2):(J=this.stack.args.slice(U).join(" "),this.stack.used=this.stack.args.length):U<this.stack.args.length?(J=this.stack.args[U],U>this.stack.used&&(this.stack.used=U)):q?J=U:(J=S,X=X-P.length-2)):this.stack.args&&this.stack.args.indices&&P.match(/^x[-|+]?\d+$/)?(U=parseInt(P.substring(1),10),U<0?-U>=this.stack.args.length?(J=S,X=X-P.length-2):J=this.stack.indices.slice(U).map(pe=>pe?pe[0]+" "+pe[1]:"0 0").join(" "):U<this.stack.args.length?J=this.stack.args.indices[U]?this.stack.args.indices[U][0]+" "+this.stack.args.indices[U][1]:"0 0":(J=S,X=X-P.length-2)):(T=this.parseVariable(P),T!=null?J=T:q?(J=this.evaluate(this.parseInline(P)),Q&&typeof J>"u"?J=null:J=""+J):(J=S,X=X-P.length-2)),J!=null&&e&&Z?c+=J:J!=null&&(h+=J),m=0,P=""):T==="{"?(We++,P+=T):(T==="}"&&We--,P+=T);break;case 15:T===B||s&&T===u||O&&T===v||w&&T===E||L&&T===k||C&&T===I||M&&T===S||W&&T==V[0]||ne&&T==N[0]||`"'{`.indexOf(T)!==-1?J=T:J=B+T,e&&Z?c+=J:h+=J,m=0;break;case 16:T===`
`?(m=0,H+=h+T,h="",le=!0):(h+=T,le=!1);break;case 20:W&&T===V[1]?m=22:ne&&T===N[1]?m=24:(m=0,e&&Z?c+=V[0]:h+=V[0],X--);break;case 21:T===V[1]?m=22:(m=0,e&&Z?c+=V[0]:h+=V[0],X--);break;case 23:ne&&T===N[1]?m=25:(m=0,e&&Z?c+=N[0]:h+=N[0],X--);break;case 22:T===`
`&&(m=0,le?(c="",Z=!0,le=!0):X--);break;case 24:N.length===1?T===N[0]&&(m=0):T===N[1]&&(m=25);break;case 25:T===N[0]?m=0:m=24;break;default:if((W||ne)&&T===V[0]&&T===N[0]){W&&V.length===1?m=22:ne&&N.length===1?m=24:m=20;continue}else if(W&&T===V[0]){V.length===1?m=22:m=21;continue}else if(ne&&T===N[0]){N.length===1?m=24:m=23;continue}else if(R&&T===B){m=15,le=!1;continue}else if(D&&T===I)m=8,Oe=!1,Ue=!1,ze=!1,P="",le=!1;else if(M&&T===S)m=11,Oe=!1,Ue=!1,ze=!1,P="",le=!1;else if(!r&&L&&le&&T===k)m=7,le=!1,c.length?(K=c,c=""):(K=h||"",h="");else if(O&&le&&T===v)m=16,le=!1;else if(w&&le&&T===E)m=6,le=!1;else if(T==='"'&&gt)e&&Z?c+=T:h+=T,m=1,le=!1;else if(T==="'"&&Je)e&&Z?c+=T:h+=T,m=2,le=!1;else if(le&&G&&(T===" "||T==="	"||T==="\f"||T==="\r"||T==="\v"||T===" "||T==="\xA0"||T==="\u1680"||T==="\u2000-"||T==="\u200A"||T==="\u2028"||T==="\u2029"||T==="\u202F"||T==="\u205F"||T==="\u3000"||T==="\uFEFF"))e&&Z?c+=T:h+=T;else if(e&&Z&&T===" ")g=bt(b,"pattern",G?c.trimStart():c),g.length>0?(m=3,Y.length=0,P="",Y.push(G?c.trimStart():c)):(h+=c+" ",c="",g=null),Z=!1,le=!1;else if(T===`
`||s&&T===u){if(e&&Z&&c.length>0)if(g=bt(b,"pattern",G?c.trimStart():c),g.length>0){for(Y.push(G?c.trimStart():c),fe=g.length,oe=0;oe<fe;oe++){if(h=this.ExecuteAlias(g[oe],Y),typeof h=="number")return h>=0&&this.executeWait(t.substr(X+1),h,e,s,n,r,o),H.length===0?null:H;if(h!==null&&(H+=h),!oe.multi)break;if(this.stack.continue||this.stack.break)return H.length===0?null:H}h="",Y.length=0,P=""}else{if(h=this.ExecuteTriggers(17,c,c,!1,!0),typeof h=="number")return h>=0&&this.executeWait(t.substr(X+1),h,e,s,n,r,o),H.length===0?null:H;h!==null&&(H+=h+`
`),h="",g=null}else{if(h=this.ExecuteTriggers(17,h,h,!1,!0),typeof h=="number")return h>=0&&this.executeWait(t.substr(X+1),h,e,s,n,r,o),H.length===0?null:H;h!==null&&(H+=h+`
`),h=""}if(this.stack.continue||this.stack.break)return H.length===0?null:H;c="",Z=!0,le=!0}else e&&Z?(c+=T,le=!1):(h+=T,le=!1);break}if(m===15?h+=B:m===14&&P.length>0?this.stack.named&&this.stack.named[P]?h+=this.stack.named[P]:this._.variables.hasOwnProperty(P)?h+=this._.variables[P]:(P=this.parseInline(P),h+=S,P!=null&&(h+=P)):m===8&&P.length>0?this.stack.args?(P=parseInt(P,10),Ue&&this.stack.args.indices&&P<this.stack.args.length?h+=this.stack.args.indices[P]?this.stack.args.indices[P][0]+" "+this.stack.args.indices[P][1]:"0 0":(Oe&&P<this.stack.args.length?h+=this.stack.args.slice(P).join(" "):P<this.stack.args.length&&(h+=this.stack.args[P]),Oe?this.stack.used=this.stack.args.length:P>this.stack.used&&(this.stack.used=P))):(P=this.parseInline(P),h+=I,Oe&&(h+="-"),Ue&&(h+="x"),P!=null&&(h+=P)):m===9?(P=this.parseInline(P),h+=I+"{",P!=null&&(h+=P)):m===11&&P.length>0?this.stack.named?this.stack.named.hasOwnProperty(P)?h+=this.stack.named[P]:(P=this.parseInline(P),h+=S,P!=null&&(h+=P)):(P=this.parseInline(P),h+=S,P!=null&&(h+=P)):m===12?(P=this.parseInline(P),h+=`${S}{`,P!=null&&(h+=P)):m===6?(h=this.ProcessPath(h),h!==null&&(H+=h),h=""):m===20||m===21?(h+=V[0],X--):m===23&&(h+=N[0],X--),!r&&m===7){if(h=this.executeScript(k+h),typeof h=="number")return h>=0&&this.executeWait(t.substr(X+1),h,e,s,n,r,o),H.length===0?null:H;if(h!==null){if(n&&e&&this.stack.args&&this.stack.append&&this.stack.args.length-1>0&&this.stack.used+1<this.stack.args.length){let pe=!1;h.endsWith(`
`)&&(h=h.substring(0,h.length-1),pe=!0),h.endsWith(" ")||(h+=" "),this.stack.used<1?h+=this.stack.args.slice(1).join(" "):h+=this.stack.args.slice(this.stack.used+1).join(" "),this.stack.used=this.stack.args.length,pe&&(h+=`
`)}H+=K+h}else if(H.length===0)return null;if(this.stack.continue||this.stack.break)return H.length===0?null:H}else if(m===16){if(n&&e&&this.stack.args&&this.stack.append&&this.stack.args.length-1>0&&this.stack.used+1<this.stack.args.length){let pe=!1;h.endsWith(`
`)&&(h=h.substring(0,h.length-1),pe=!0),h.endsWith(" ")||(h+=" "),this.stack.used<1?h+=this.stack.args.slice(1).join(" "):h+=this.stack.args.slice(this.stack.used+1).join(" "),this.stack.used=this.stack.args.length,pe&&(h+=`
`)}H+=h}else if(c.length>0&&e&&Z){if(n&&e&&this.stack.args&&this.stack.append&&this.stack.args.length-1>0&&this.stack.used+1<this.stack.args.length){let pe=!1;h.endsWith(`
`)&&(h=h.substring(0,h.length-1),pe=!0),h.endsWith(" ")||(h+=" "),this.stack.used<1?h+=this.stack.args.slice(1).join(" "):h+=this.stack.args.slice(this.stack.used+1).join(" "),this.stack.used=this.stack.args.length,pe&&(h+=`
`)}if(h.length>0&&(c+=h),g=bt(b,"pattern",G?c.trimStart():c),g.length>0)for(Y.push(G?c.trimStart():c),fe=g.length,oe=0;oe<fe;oe++){if(h=this.ExecuteAlias(g[oe],Y),typeof h=="number")return h>=0&&this.executeWait(t.substr(X+1),h,e,s,n,r,o),H.length===0?null:H;if(h!==null)H+=h;else if(H.length===0)return null;if(this.stack.continue||this.stack.break)return H;if(!oe.multi)break}else{if(h=this.ExecuteTriggers(17,c,c,!1,!0),typeof h=="number")return h>=0&&this.executeWait(t.substr(X+1),h,e,s,n,r,o),H.length===0?null:H;if(h!==null)H+=h;else if(H.length===0)return null;if(this.stack.continue||this.stack.break)return H}g=null}else if(c.length>0){if(h.length>0&&(c+=h),h=this.ExecuteTriggers(17,c,c,!1,!0),typeof h=="number")return h>=0&&this.executeWait(t.substr(X+1),h,e,s,n,r,o),H.length===0?null:H;if(h!==null){if(n&&e&&this.stack.args&&this.stack.append&&this.stack.args.length-1>0&&this.stack.used+1<this.stack.args.length){let pe=!1;h.endsWith(`
`)&&(h=h.substring(0,h.length-1),pe=!0),h.endsWith(" ")||(h+=" "),this.stack.used<1?h+=this.stack.args.slice(1).join(" "):h+=this.stack.args.slice(this.stack.used+1).join(" "),this.stack.used=this.stack.args.length,pe&&(h+=`
`)}H+=h}else if(H.length===0)return null;if(this.stack.continue||this.stack.break)return H.length===0?null:H}else if(h.length>0){if(h=this.ExecuteTriggers(17,h,h,!1,!0),typeof h=="number")return h>=0&&this.executeWait(t.substr(X+1),h,e,s,n,r,o),H.length===0?null:H;if(h!==null){if(n&&e&&this.stack.args&&this.stack.append&&this.stack.args.length-1>0&&this.stack.used+1<this.stack.args.length){let pe=!1;h.endsWith(`
`)&&(h=h.substring(0,h.length-1),pe=!0),h.endsWith(" ")||(h+=" "),this.stack.used<1?h+=this.stack.args.slice(1).join(" "):h+=this.stack.args.slice(this.stack.used+1).join(" "),pe&&(h+=`
`)}H+=h}else if(H.length===0)return null;if(this.stack.continue||this.stack.break)return H.length===0?null:H}return Y.length=0,Y=null,P=null,c=null,H}parseVariable(t){let e;switch(t){case"esc":return"\x1B";case"cr":return`
`;case"lf":return"\r";case"crlf":return`\r
`;case"copied":return window.Rl;case"copied.lower":return window.Rl.toLowerCase();case"copied.upper":return window.Rl.toUpperCase();case"copied.proper":return ri(window.Rl);case"i":return this.loops[0];case"repeatnum":return this.vStack.$repeatnum||this.repeatnum;case"character":return window.Xn;case"character.lower":return window.Xn.toLowerCase();case"character.upper":return window.Xn.toUpperCase();case"character.proper":return ri(window.Xn);case"selected":case"selectedurl":case"selectedline":case"selectedword":case"selurl":case"selline":case"selword":case"action":case"trigger":return this.vStack["$"+t]||window["$"+t]||"";case"selected.lower":case"selectedurl.lower":case"selectedline.lower":case"selectedword.lower":case"selurl.lower":case"selline.lower":case"selword.lower":return(this.vStack["$"+t.substr(0,t.length-6)]||window["$"+t.substr(0,t.length-6)]||"").toLowerCase();case"selected.upper":case"selectedurl.upper":case"selectedline.upper":case"selectedword.upper":case"selurl.upper":case"selline.upper":case"selword.upper":return(this.vStack["$"+t.substr(0,t.length-6)]||window["$"+t.substr(0,t.length-6)]||"").toUpperCase();case"selected.proper":case"selectedurl.proper":case"selectedline.proper":case"selectedword.proper":case"selurl.proper":case"selline.proper":case"selword.proper":return ri(this.vStack["$"+t.substr(0,t.length-7)]||window["$"+t.substr(0,t.length-7)]);case"random":return Vt().randomInt(0,100)}if(ni.indexOf(t)!==-1)return this.vStack["$"+t]||window["$"+t]||"";if(this.loops.length&&t.length===1){let b=t.charCodeAt(0)-105;if(b>=0&&b<18&&b<this.loops.length)return this.loops[b]}let n=new RegExp("^([a-zA-Z]+)\\((.*)\\)$","g").exec(t);if(!n||!n.length){let b={raw:t,name:t,args:[],handled:!1,return:null};return this._.emit("variable",b),b.handled?b.return:null}let r,o,a,h,c,g=this.se("allowEscape")?this.se("escapeChar"):"";switch(n[1]){case"time":return moment?n[2]&&n[2].length>0?moment().format(this.stripQuotes(this.parseInline(n[2]))):moment().format():new Date().toISOString();case"clip":return n[2]&&n[2].length>0?(this._.writeClipboard(this.stripQuotes(this.parseInline(n[2]))),null):this._.readClipboard();case"lower":return this.stripQuotes(this.parseInline(n[2]).toLowerCase());case"upper":return this.stripQuotes(this.parseInline(n[2]).toUpperCase());case"proper":return ri(this.stripQuotes(this.parseInline(n[2])));case"eval":return a=this.evaluate(this.parseInline(n[2])),this.se("ignoreEvalUndefined")&&typeof a>"u"?null:""+a;case"dice":if(a=this.parseInline(n[2]).split(","),a.length===0)throw new Error("Invalid dice");if(a.length===1){if(n=/(\d+)\s*?d(F|f|%|\d+)(\s*?[-|+|*|\/]?\s*?\d+)?/g.exec(a[0]),!n||n.length<3)return null;e=parseInt(n[1]),r=n[2],n.length>3&&(o=n[3])}else if(a.length<4)e=parseInt(a[0]),r=a[1].trim(),a.length>2&&(o=a[2].trim());else throw new _("dice");r==="F"||r==="f"?r="F":r!=="%"&&(r=parseInt(r));let b=0;for(let w=0;w<e;w++)r==="F"||r==="f"?b+=ms():r==="%"?b+=~~(Math.random()*100)+1:b+=~~(Math.random()*r)+1;return r==="%"&&(b/=100),o?this.evaluate(b+o):""+b;case"diceavg":if(a=this.parseInline(n[2]).split(","),a.length===0)throw new Error("Invalid dice for diceavg");if(a.length===1){if(n=/(\d+)d(F|f|%|\d+)([-|+|*|/]?\d+)?/g.exec(a[0]),!n||n.length<3)return null;e=parseInt(n[1]),r=n[2],n.length>3&&(o=n[3])}else if(a.length<4)e=parseInt(a[0]),r=a[1].trim(),a.length>2&&(o=a[2].trim());else throw new _("diceavg");return h=1,r==="F"||r==="f"?(h=-1,c=1):r==="%"?(h=0,c=1):c=parseInt(r),o?this.evaluate((h+c)/2*e+o):""+(h+c)/2*e;case"dicemin":if(a=this.parseInline(n[2]).split(","),a.length===0)throw new Error("Invalid dice for dicemin");if(a.length===1){if(n=/(\d+)d(F|f|%|\d+)([-|+|*|/]?\d+)?/g.exec(a[0]),!n||n.length<3)return null;e=parseInt(n[1]),r=n[2],n.length>3&&(o=n[3])}else if(a.length<4)e=parseInt(a[0]),r=a[1].trim(),a.length>2&&(o=a[2]);else throw new _("dicemin");return h=1,r==="F"||r==="f"?h=-1:r==="%"&&(h=0),o?this.evaluate(h*e+o):""+h*e;case"dicemax":if(a=this.parseInline(n[2]).split(","),a.length===0)throw new Error("Invalid dice for dicemax");if(a.length===1){if(n=/(\d+)d(F|f|%|\d+)([-|+|*|/]?\d+)?/g.exec(a[0]),!n||n.length<3)return null;e=parseInt(n[1]),r=n[2],n.length>3&&(o=n[3])}else if(a.length<4)e=parseInt(a[0]),r=a[1].trim(),a.length>2&&(o=a[2].trim());else throw new _("dicemax");return r==="F"||r==="f"||r==="%"?c=1:c=parseInt(r),o?this.evaluate(c*e+o):""+c*e;case"zdicedev":case"dicedev":let u=n[1];if(a=this.parseInline(n[2]).split(","),a.length===0)throw new Error("Invalid dice for "+u);if(a.length===1){if(n=/(\d+)d(F|f|%|\d+)([-|+|*|/]?\d+)?/g.exec(a[0]),!n||n.length<3)return null;e=parseInt(n[1]),r=n[2],n.length>3&&(o=n[3])}else if(a.length<4)e=parseInt(a[0]),r=a[1].trim(),a.length>2&&(o=a[2].trim());else throw new _(""+u);return r==="F"||r==="f"?c=6:r==="%"?c=1:c=parseInt(r),u==="zdicedev"&&c--,o?this.evaluate(Math.sqrt((c*c-1)/12*e)+o):""+Math.sqrt((c*c-1)/12*e);case"color":if(a=this.parseInline(n[2]).split(","),a.length===0)throw new ie("color");if(a.length===1){if(a[0]==="bold")return"370";if(e=xe(a[0]),e===-1)throw new Le;return e.toString()}else if(a.length===2){if(a[0]==="bold")e=370;else{if(e=xe(a[0]),e===-1)throw new Le;if(a[1]==="bold")return(e*10).toString()}if(r=e.toString(),e=xe(a[1],!0),e===-1)throw new Ze;return r+","+e.toString()}else if(a.length===3){if(a[0]==="bold"&&(a.shift(),a.push("bold")),a[2]!=="bold")throw new Error("Only bold is supported as third argument for color");if(e=xe(a[0]),e===-1)throw new Le;if(r=(e*10).toString(),e=xe(a[1],!0),e===-1)throw new Ze;return r+","+e.toString()}throw new _("color");case"zcolor":if(a=this.parseInline(n[2]).split(","),a.length===0)throw new ie("zcolor");if(a.length>1)throw new _("zcolor");return zi(parseInt(a[0],10));case"ansi":if(a=this.parseInline(n[2]).split(","),a.length===0)throw new ie("ansi");for(e=a.length,o=[],h={},r=0;r<e;r++)if(a[r].trim()==="current")o.push(a[r].trim());else{if(c=ut(a[r].trim()),c===-1)throw new Error("Invalid color or style for ansi");c>=0&&c<30?h[c]=1:o.push(a[r])}if(o.length>2)throw new Error("Too many colors for ansi");if(o.length>1&&(o[1]==="current"?o[1]="":o[1]=ut(o[1],!0)),o.length>0&&(h[1]&&o[0]==="white"||o[0]==="current"?o[0]="":o[0]=ut(o[0])),h=[...Object.keys(h),...o],!h.length)throw new Error("Invalid colors or styles for ansi");return h=h.filter(w=>w!==""),`\x1B[${h.join(";")}m`;case"random":if(a=this.parseInline(n[2]).split(","),a.length===0)throw new Error("Invalid random");if(a.length===1)return Vt().randomInt(0,parseInt(a[0],10)+1);if(a.length===2)return Vt().randomInt(parseInt(a[0],10),parseInt(a[1],10)+1);throw new _("random");case"case":if(a=this.splitByQuotes(this.parseInline(n[2]),","),a.length===0)throw new ie("case");return e=this.evaluate(this.parseInline(a[0])),typeof e!="number"?"":e>0&&e<a.length?this.stripQuotes(a[e]):"";case"switch":if(a=this.splitByQuotes(this.parseInline(n[2]),","),a.length===0)throw new ie("switch");if(a.length%2===1)throw new Error("All expressions must have a value for switch");for(r=a.length,e=0;e<r;e+=2)if(this.evaluate(a[e]))return this.stripQuotes(a[e+1]);return"";case"if":if(a=this.splitByQuotes(this.parseInline(n[2]),","),a.length<3)throw new ie("if");if(a.length!==3)throw new _("if");return this.evaluate(a[0])?this.stripQuotes(a[1].trim()):this.stripQuotes(a[2].trim());case"ascii":if(a=this.parseInline(n[2]).split(","),a.length===0)throw new ie("ascii");if(a.length>1)throw new _("ascii");if(a[0].trim().length===0)throw new Error("Invalid argument, empty string for ascii");return a[0].trim().charCodeAt(0);case"char":if(a=this.parseInline(n[2]).split(","),a.length===0)throw new ie("char");if(a.length>1)throw new _("char");if(e=parseInt(a[0],10),isNaN(e))throw new be(a[0],"char");return String.fromCharCode(e);case"begins":if(a=this.splitByQuotes(this.parseInline(n[2]),","),a.length<2)throw new ie("begins");if(a.length>2)throw new _("begins");return this.stripQuotes(a[0]).startsWith(this.stripQuotes(a[1]));case"ends":if(a=this.splitByQuotes(this.parseInline(n[2]),","),a.length<2)throw new ie("ends");if(a.length>2)throw new _("ends");return this.stripQuotes(a[0]).endsWith(this.stripQuotes(a[1]));case"len":return this.stripQuotes(this.parseInline(n[2])).length;case"stripansi":let E=new RegExp("[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)|(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-nq-uy=><~]))","g");return this.stripQuotes(this.parseInline(n[2])).replace(E,"");case"pos":if(a=this.splitByQuotes(this.parseInline(n[2]),","),a.length<2)throw new ie("pos");if(a.length>2)throw new _("pos");return this.stripQuotes(a[1]).indexOf(this.stripQuotes(a[0]))+1;case"ipos":if(a=this.splitByQuotes(this.parseInline(n[2]),","),a.length<2)throw new ie("ipos");if(a.length>2)throw new _("ipos");return this.stripQuotes(a[1]).toLowerCase().indexOf(this.stripQuotes(a[0]).toLowerCase())+1;case"regex":if(a=this.splitByQuotes(n[2],","),a.length<2)throw new ie("regex");if(e=new RegExp(this.stripQuotes(a[1]),"gd"),e=e.exec(this.stripQuotes(this.parseInline(a[0]))),a.shift(),a.shift(),e==null||e.length===0)return 0;if(a.length){for(r=1;r<e.length&&a.length;r++)this._.variables[this.stripQuotes(this.parseInline(a[0]))]=e[r],a.shift();a.length&&(this._.variables[this.stripQuotes(this.parseInline(a[0]))]=e[0].length)}return e.indices[0]?e.indices[0][0]+1:1;case"trim":return this.stripQuotes(this.parseInline(n[2])).trim();case"trimleft":return this.stripQuotes(this.parseInline(n[2])).trimLeft();case"trimright":return this.stripQuotes(this.parseInline(n[2])).trimRight();case"bitand":if(a=this.parseInline(n[2]).split(","),a.length===0)throw new ie("bitand");if(a.length!==2)throw new _("bitand");if(e=parseInt(a[0],10),isNaN(e))throw new be(a[0],"bitand");if(r=parseInt(a[1],10),isNaN(r))throw new be(a[1],"bitand");return e&r;case"bitnot":if(a=this.parseInline(n[2]).split(","),a.length===0)throw new ie("bitnot");if(a.length!==1)throw new _("bitnot");if(e=parseInt(a[0],10),isNaN(e))throw new be(a[0],"bitnot");return~e;case"bitor":if(a=this.parseInline(n[2]).split(","),a.length===0)throw new ie("bitor");if(a.length!==2)throw new _("bitor");if(e=parseInt(a[0],10),isNaN(e))throw new be(a[0],"bitor");if(r=parseInt(a[1],10),isNaN(r))throw new be(a[1],"bitor");return e|r;case"bitset":if(a=this.parseInline(n[2]).split(","),a.length===0)throw new ie("bitset");if(a.length>3)throw new _("bitset");if(e=parseInt(a[0],10),isNaN(e))throw new be(a[0],"bitset");if(r=parseInt(a[1],10),isNaN(r))throw new be(a[1],"bitset");if(r--,o=1,a.length===3&&(o=parseInt(a[2],10),isNaN(o)))throw new be(a[2],"bitset");return e&~(1<<r)|(o?1:0)<<r;case"bitshift":if(a=this.parseInline(n[2]).split(","),a.length===0)throw new ie("bitshift");if(a.length!==2)throw new _("bitshift");if(e=parseInt(a[0],10),isNaN(e))throw new be(a[0],"bitshift");if(r=parseInt(a[1],10),isNaN(r))throw new be(a[1],"bitshift");return r<0?e>>-r:e<<r;case"bittest":if(a=this.parseInline(n[2]).split(","),a.length===0)throw new ie("bittest");if(a.length!==2)throw new _("bittest");if(e=parseInt(a[0],10),isNaN(e))throw new be(a[0],"bittest");if(r=parseInt(a[1],10),isNaN(r))throw new be(a[1],"bittest");return r--,(e>>r)%2!=0?1:0;case"bitxor":if(a=this.parseInline(n[2]).split(","),a.length===0)throw new ie("bitxor");if(a.length!==2)throw new _("bitxor");if(e=parseInt(a[0],10),isNaN(e))throw new be(a[0],"bitxor");if(r=parseInt(a[1],10),isNaN(r))throw new be(a[1],"bitxor");return e^r;case"number":if(a=this.splitByQuotes(this.parseInline(n[2]),","),a.length===0)throw new ie("number");if(a.length>1)throw new _("number");return a[0]=this.stripQuotes(a[0],!0),a[0].match(/^\s*?[-|+]?\d+\s*?$/)?parseInt(a[0],10):a[0].match(/^\s*?[-|+]?\d+\.\d+\s*?$/)?parseFloat(a[0]):a[0]==="true"?1:(a[0]==="false",0);case"isfloat":if(a=this.splitByQuotes(this.parseInline(n[2]),","),a.length===0)throw new ie("isfloat");if(a.length>1)throw new _("isfloat");return a[0].match(/^\s*?[-|+]?\d+\.\d+\s*?$/)?1:0;case"isnumber":if(a=this.splitByQuotes(this.parseInline(n[2]),","),a.length===0)throw new ie("isnumber");if(a.length>1)throw new _("isnumber");return a[0].match(/^\s*?[-|+]?\d+\s*?$/)||a[0].match(/^\s*?[-|+]?\d+\.\d+\s*?$/)?1:0;case"string":if(a=this.splitByQuotes(this.parseInline(n[2]),","),a.length===0)throw new ie("string");if(a.length>1)throw new _("string");return`"${this.stripQuotes(a[0]),!0}"`;case"float":if(a=this.splitByQuotes(this.parseInline(n[2]),","),a.length===0)throw new ie("float");if(a.length>1)throw new _("float");return a[0]=this.stripQuotes(a[0],!0),a[0].match(/^\s*?[-|+]?\d+\s*?$/)||a[0].match(/^\s*?[-|+]?\d+\.\d+\s*?$/)?parseFloat(a[0]):a[0]==="true"?1:(a[0]==="false",0);case"isdefined":if(a=this.splitByQuotes(this.parseInline(n[2]),","),a.length===0)throw new ie("isdefined");if(a.length>1)throw new _("isdefined");return a[0]=this.stripQuotes(a[0],!0),this._.variables.hasOwnProperty(a[0])?1:0;case"defined":if(a=this.splitByQuotes(this.parseInline(n[2]),","),a.length===0)throw new ie("defined");if(a.length===1){a[0]=this.stripQuotes(a[0],!0);let w=this.ee.keys,L=0,k=w.length;if(k===0)return 0;for(;L<k;L++)if(r=se(this.ee.items[w[L]].aliases),r=r.find(R=>R.pattern===a[0]),r||(r=se(this.ee.items[w[L]].triggers),r=r.find(R=>R.pattern===a[0]||R.name===a[0]),r)||(r=se(this.ee.items[w[L]].macros),r=r.find(R=>It(R).toLowerCase()===a[0].toLowerCase()||R.name===a[0]),r)||(r=se(this.ee.items[w[L]].aliases),r=r.find(R=>R.caption===a[0]||R.name===a[0]),r))return 1;return this._.variables.hasOwnProperty(a[0])}else if(a.length===2){a[0]=this.stripQuotes(a[0],!0),a[1]=this.stripQuotes(a[1],!0).toLowerCase();let w=this.ee.keys,L=0,k=w.length;if(k===0)return 0;for(;L<k;L++)switch(a[1]){case"alias":return r=se(this.ee.items[w[L]].aliases),r=r.find(R=>R.pattern===a[0]),r?1:0;case"event":return r=se(this.ee.items[w[L]].triggers),r=r.find(R=>R.type===2&&(R.pattern===a[0]||R.name===a[0])),r?1:0;case"trigger":return r=se(this.ee.items[w[L]].triggers),r=r.find(R=>R.pattern===a[0]||R.name===a[0]),r?1:0;case"macro":return r=se(this.ee.items[w[L]].macros),r=r.find(R=>It(R).toLowerCase()===a[0].toLowerCase()||R.name===a[0]),r?1:0;case"button":return r=se(this.ee.items[w[L]].aliases),r=r.find(R=>R.caption===a[0]||R.name===a[0]),r?1:0}if(a[1]==="variable")return this._.variables.hasOwnProperty(a[0])}else throw new _("defined");return 0;case"escape":return a=this.stripQuotes(this.parseInline(n[2])),this.se("allowEscape")?(e=g,g==="\\"&&(e+=g),this.se("parseDoubleQuotes")&&(e+='"'),this.se("parseSingleQuotes")&&(e+="'"),this.se("commandStacking")&&(e+=this.se("commandStackingChar")),this.se("enableSpeedpaths")&&(e+=this.se("speedpathsChar")),this.se("enableCommands")&&(e+=this.se("commandChar")),this.se("enableVerbatim")&&(e+=this.se("verbatimChar")),this.se("enableDoubleParameterEscaping")&&(e+=this.se("parametersChar")),this.se("enableNParameters")&&(e+=this.se("nParametersChar")),a.replace(new RegExp(`[${e}]`,"g"),g+"$&")):a.replace(/[\\"']/g,"$&");case"unescape":return a=this.stripQuotes(this.parseInline(n[2])),this.se("allowEscape")?(e=g,g==="\\"&&(e+=g),this.se("parseDoubleQuotes")&&(e+='"'),this.se("parseSingleQuotes")&&(e+="'"),this.se("commandStacking")&&(e+=this.se("commandStackingChar")),this.se("enableSpeedpaths")&&(e+=this.se("speedpathsChar")),this.se("enableCommands")&&(e+=this.se("commandChar")),this.se("enableVerbatim")&&(e+=this.se("verbatimChar")),this.se("enableDoubleParameterEscaping")&&(e+=this.se("parametersChar")),this.se("enableNParameters")&&(e+=this.se("nParametersChar")),g==="\\"?a.replace(new RegExp(`\\\\[${e}]`,"g"),w=>w.substr(1)):a.replace(new RegExp(`${g}[${e}]`,"g"),w=>w.substr(1))):a.replace(/\\[\\"']/g,w=>w.substr(1));case"alarm":if(a=this.splitByQuotes(this.parseInline(n[2]),","),a.length===0)throw new ie("alarm");if(a.length>3)throw new _("alarm");if(a[0]=this.stripQuotes(a[0]),r=this._.alarms,c=r.length,c===0)throw new Error("No alarms set.");if(e=0,a.length===1){for(;e<c;e++)if(r[e].type===3&&(r[e].name===a[0]||r[e].pattern===a[0]))return r[e].suspended?0:this._.getRemainingAlarmTime(e)}else if(a.length===2)if(o=parseInt(a[1],10),isNaN(o)){for(a[1]=this.stripQuotes(a[1].trim());e<c;e++)if(r[e].type===3&&(r[e].name===a[0]||r[e].pattern===a[0])){if(r[e].profile.name.toUpperCase()!==a[1].toUpperCase())continue;return r[e].suspended?0:this._.getRemainingAlarmTime(e)}throw Error("Alarm not found in profile: "+a[1]+".")}else{for(;e<c;e++)if(r[e].type===3&&(r[e].name===a[0]||r[e].pattern===a[0]))return r[e].suspended||this._.setAlarmTempTime(e,o),o;throw Error("Alarm not found.")}else if(a.length===3){if(o=parseInt(a[1],10),isNaN(o))throw new Error("Invalid time for alarm");for(a[2]=this.stripQuotes(a[2].trim());e<c;e++)if(r[e].type===3&&(r[e].name===a[0]||r[e].pattern===a[0])){if(r[e].profile.name.toUpperCase()!==a[2].toUpperCase())continue;return r[e].suspended||this._.setAlarmTempTime(e,o),o}throw Error("Could not set time, alarm not found in profile: "+a[2]+".")}return 0;case"state":if(a=this.splitByQuotes(this.parseInline(n[2]),","),a.length===0)throw new ie("state");if(a.length>2)throw new _("state");if(a[0]=this.stripQuotes(a[0]),o=null,a.length===1){let w=this.ee.keys,L=0,k=w.length;if(k===0)return null;if(k===1){if(!this.ee.items[w[0]].enabled||!this.ee.items[w[0]].enableTriggers)throw Error("No enabled profiles found!");r=se(this.ee.items[w[L]].triggers),r=r.find(R=>R.name===a[0]||R.pattern===a[0])}else for(;L<k&&!(!(!this.ee.items[w[L]].enabled||!this.ee.items[w[L]].enableTriggers||this.ee.items[w[L]].triggers.length===0)&&(r=se(this.ee.items[w[L]].triggers),r=r.find(R=>R.name===a[0]||R.pattern===a[0]),r));L++);}else if(a.length===2){if(a[1]=this.stripQuotes(a[1].trim()),this.ee.contains(a[1]))o=this.ee.items[a[1].toLowerCase()];else throw new De(a[1]);r=se(o.triggers),r=r.find(w=>w.name===a[0]||w.pattern===a[0])}if(r)return r.triggers&&r.triggers.length?r.state:0;throw new qe;case"isnull":if(a=this.splitByQuotes(this.parseInline(n[2]),","),a.length===0)return null;if(a.length!==1)throw new _("null");return this.evaluate(a[0])===null?1:0;case"prompt":if(a=this.splitByQuotes(this.parseInline(n[2]),","),a.length===0)return window.prompt()||"";if(a.length>3)throw new _("prompt");return a=a.map(w=>this.stripQuotes(w)),window.prompt(...a)||""}let m={raw:t,name:n[1],args:n[2]&&n[2].length?this.parseOutgoing(n[2]).split(","):[],handled:!1,return:null};return this._.emit("variable",m),m.handled?m.return:null}GetNamedArguments(t,e,s){if(t==="*")return e;if(s==null&&(s=!1),t==null||t.length===0)return s?e:[];let n=t.split(","),r=n.length,o=e.length;if(r===0)return s?e:[];let a;s?a=e.slice():a=[];for(let h=0;h<r;h++)n[h]=$.trim(n[h]),!(n[h].length<1)&&(n[h].startsWith("$")&&(n[h]=n[h].substring(1)),n[h].match(/^[a-zA-Z0-9_][a-zA-Z0-9_]+$/g)&&ot(n[h])&&(a[n[h]]||(a[n[h]]=h+1<o?e[h+1]:"")));return a}ExecuteAlias(t,e){if(!t.enabled)return;let s;if(t.value.length)switch(t.style){case 1:this.ft.push({loops:[],args:e,named:this.GetNamedArguments(t.params,e),append:t.append,used:0}),s=this.parseOutgoing(t.value,null,null,!0),this.ft.pop();break;case 2:(this.se("echo")&2)===2&&this.Le(t.value,-7,-8,!0,!0);let n=this.GetNamedArguments(t.params,e);n?s=Object.keys(n).map(o=>`let ${o} = this.input.stack.named["${o}"];`).join("")+`
`:s="";let r=new Function("try { "+s+t.value+`
} catch (e) { if(this.getOption('showScriptErrors')) this.error(e);}`);this.ft.push({loops:[],args:e,named:n,append:t.append,used:0});try{s=r.apply(this._,e)}catch(o){throw o}finally{this.ft.pop()}typeof s=="string"&&(s=this.parseOutgoing(s,null,null,!0));break;default:s=t.value;break}return s==null||s===void 0||(s=this.ExecuteTriggers(17,s,s,!1,!0),s==null||s===void 0)||(typeof s!="string"&&(s=s.toString()),s.length===0&&!this.se("returnNewlineOnEmptyValue"))?null:s.endsWith(`
`)?s:s+`
`}ProcessMacros(t,e,s,n,r){if(!t||t>9&&t<19||!this.ee)return!1;let o=this.Cl[t]||(this.Cl[t]=bt(this._.macros,"key",t)),a=0,h=o.length,c=0;for(e&&(c|=2),s&&(c|=4),n&&(c|=8),r&&(c|=16);a<h;a++)if(!(!o[a].enabled||c!==o[a].modifiers)&&this.ExecuteMacro(o[a]))return!0;return!1}ExecuteMacro(t){if(!t.enabled)return!1;let e;if(t.value.length)switch(t.style){case 1:this.ft.push({loops:[],args:0,named:0,used:0});try{e=this.parseOutgoing(t.value)}catch(n){throw n}finally{this.ft.pop()}break;case 2:(this.se("echo")&2)===2&&this.Le(t.value,-7,-8,!0,!0);let s=new Function("try { "+t.value+`
} catch (e) { if(this.getOption('showScriptErrors')) this.error(e);}`);this.ft.push({loops:[],args:0,named:0,used:0});try{e=s.apply(this._)}catch(n){throw n}finally{this.ft.pop()}break;default:e=t.value;break}return e==null||e===void 0?!0:(typeof e!="string"&&(e=e.toString()),e.length===0&&!this.se("returnNewlineOnEmptyValue")?null:(t.send?(e.endsWith(`
`)||(e+=`
`),t.chain&&this.be.value.endsWith(" ")?(this.be.value=this.be.value+e,this._.sendCommand(null,null,this.se("allowCommentsFromCommand"))):this._.send(e,!0)):t.append&&(this.be.value=this.be.value+e),!0))}ProcessPath(t,e){if(t.length===0)return"";let s=[],n=0,r="",o="",a=0,h,c,g,m,b=0,u=t.length;for(;a<u;a++)switch(h=t.charAt(a),c=t.charCodeAt(a),n){case 1:c>47&&c<58?o+=h:h==="\\"?n=2:(n=0,r=h);break;case 2:c>47&&c<58?r+=h:(r+="\\",a--),n=0;break;case 3:b===0&&h===")"?n=0:(h==="("?b++:h===")"&&b--,r+=h);break;case 4:b===0&&h==="}"?n=0:(h==="{"?b++:h==="}"&&b--,r+=h);break;default:if(c>47&&c<58){if(r.length>0){for(o.length===0?g=1:g=parseInt(o,10),m=0;m<g;m++)s.push(r);r=""}n=1,o=h}else h==="("?(n=3,b=0):h==="{"?(n=4,b=0):h==="\\"?n=2:r+=h;break}if(r.length>0)for(o.length===0?g=1:g=parseInt(o,10),m=0;m<g;m++)s.push(r);return e&&this.Ts.length?this.Ts[0]={id:t,current:s,previous:[]}:this.Ts.push({id:t,current:s,previous:[]}),this.ExecutePath(),null}ExecutePath(){if(this.Tl||!this.Ts.length||this.eh)return;let t=this.se("pathDelay");t<0&&(t=0),this.Tl=setTimeout(()=>{let e=this.se("parseSpeedpaths"),s=this.se("echoSpeedpaths"),n=this.se("pathDelayCount");n<1&&(n=1);let r=this.Ts[0];for(;n--;){let o=r.current.shift();if(r.previous.push(o),e?this._.sendBackground(o+`
`,!s):this._.send(o+`
`,!s),!r.current.length)break}r.current.length||this.Ts.shift(),this.Tl=null,!(this.Ts.length&&this.Ts[0].manual)&&this.ExecutePath()},t)}toggleScrollLock(){this.scrollLock=!this.scrollLock}th(t){return(t&512)==512||(t&1024)==1024||(t&4096)==4096||(t&8192)==8192||(t&16384)==16384||(t&32768)==32768||(t&65536)==65536||(t&131072)==131072||(t&262144)==262144}ih(t){return t===0?4:t===3?32:t}ExecuteTriggers(t,e,s,n,r,o){if(!this.enableTriggers||e==null)return e;r==null&&(r=!1),n==null&&(n=!1),s=s||e,this.buildTriggerCache();let a=0,h,c=!1,g,m=this.gi,b=m.length,u=this.Oe,E=this.Xs,w;for(;a<b;a++){let L=m[a],k=L;if(L.enabled){if((!k.triggers||!k.triggers.length||L.state>k.triggers.length)&&(k.state=0),L.state!==0&&k.triggers&&k.triggers.length){for(L=k.triggers[L.state-1];!L.enabled&&k.state!==0;){if(k.state++,k.state>k.triggers.length){k.state=0,L=k;break}k.state?L=k.triggers[k.state-1]:L=k,c=!0}if(c&&(this.se("saveTriggerStateChanges")&&this._.saveProfiles(),this._.emit("item-updated","trigger",k.profile.name,k.profile.triggers.indexOf(k),k)),!L.enabled)continue}if(w=this.ih(L.type),!(L.type!==void 0&&(t&w)!==w&&(!o||o&&!this.th(L.type)))&&L.type!==65536&&!(n&&!L.triggerPrompt)&&!(!n&&!L.triggerNewline&&L.triggerNewline!==void 0)){if(u[a]){if(u[a].type===1024){if(u[a].time>Date.now())continue;delete u[a]}else if(u[a].type===16384){if(u[a].time<Date.now()){delete u[a],this.Oi(L,k,a),u[a]?u[a].reParse=!0:u[a]={reParse:!0},a=this.cleanUpTriggerState(a);continue}}else if(u[a].type===512){if(u[a].lineCount>0)continue;delete u[a]}else if(u[a].type===8192){if(u[a].lineCount<1){this.Oi(L,k,a),u[a]?u[a].reParse=!0:u[a]={reParse:!0},a=this.cleanUpTriggerState(a);continue}}else if(u[a].type===32768&&u[a].lineCount<1){this.Oi(L,k,a),u[a]?u[a].reParse=!0:u[a]={reParse:!0},a=this.cleanUpTriggerState(a);continue}}try{if(L.type===128)if(this.evaluate(this.parseInline(L.pattern))){if(u[a]){if(u[a].loop!==-1&&u[a].lineCount<1)continue}else{let R=this.createTriggerState(L,!1,k);R&&(u[a]=R)}this.Dt=L.raw?s:e,g=this.ExecuteTrigger(L,[this.Dt],r,a,[this.Dt],0,k)}else{this.Oi(L,k,a);continue}else if(L.verbatim){if(!L.caseSensitive&&(L.raw?s:e).toLowerCase()!==L.pattern.toLowerCase()){!u[a]&&(L.type===131072||L.type===262144)&&(this.Oi(L,k,a),a=this.cleanUpTriggerState(a));continue}else if(L.caseSensitive&&(L.raw?s:e)!==L.pattern){!u[a]&&(L.type===131072||L.type===262144)&&(this.Oi(L,k,a),a=this.cleanUpTriggerState(a));continue}this.Dt=L.raw?s:e,g=this.ExecuteTrigger(L,[this.Dt],r,a,[this.Dt],0,k)}else{let R;L.type===8||L.type===16||L.type===262144?h=Pt(L.pattern,this._):h=L.pattern,L.caseSensitive?R=E["g"+h]||(E["g"+h]=new RegExp(h,"gd")):R=E["gi"+h]||(E["gi"+h]=new RegExp(h,"gid")),R.lastIndex=0;let B=R.exec(L.raw?s:e);if(!B||!B.length){!u[a]&&(L.type===131072||L.type===262144)&&(this.Oi(L,k,a),a=this.cleanUpTriggerState(a));continue}let v;this.Dt=L.raw?s:e,(L.raw?s:e)===B[0]||!this.se("prependTriggeredLine")?v=B:(v=[this.Dt,...B],v.indices=[[0,v[0].length],...B.indices]),B.groups&&Object.keys(B.groups).map(O=>this._.variables[O]=B.groups[O]),g=this.ExecuteTrigger(L,v,r,a,[this.Dt,R],B.groups,k)}if(u[a]&&u[a].reParse)!u[a].type||u[a].type===131072||u[a].type===262144?delete u[a]:delete u[a].reParse,a--;else if(r)return g}catch(R){this.se("disableTriggerOnError")&&(L.enabled=!1,setTimeout(()=>{this._.saveProfiles(),this.emit("item-updated","trigger",k.profile,k.profile.triggers.indexOf(k),k)})),this.se("showScriptErrors")?this._.error(R):this._.debug(R)}}}}return e}TestTrigger(t,e,s,n,r,o){let a;try{if(t.verbatim){if(!t.caseSensitive&&(t.raw?r:n).toLowerCase()!==t.pattern.toLowerCase())return this.Oe[s]||(this.Oi(t,e,s),s=this.cleanUpTriggerState(s)),s;if(t.caseSensitive&&(t.raw?r:n)!==t.pattern)return this.Oe[s]||(this.Oi(t,e,s),s=this.cleanUpTriggerState(s)),s;this.Dt=t.raw?r:n,this.ExecuteTrigger(t,[this.Dt],!1,s,[this.Dt],0,e)}else{let h;t.type===8||t.type===16||t.type===262144?a=Pt(t.pattern,this._):a=t.pattern,t.caseSensitive?h=this.Xs["g"+a]||(this.Xs["g"+a]=new RegExp(a,"gd")):h=this.Xs["gi"+a]||(this.Xs["gi"+a]=new RegExp(a,"gid")),h.lastIndex=0;let c=h.exec(t.raw?r:n);if(!c||!c.length)return!this.Oe[s]&&(t.type===131072||t.type===262144)&&(this.Oi(t,e,s),s=this.cleanUpTriggerState(s)),s;let g;this.Dt=t.raw?r:n,(t.raw?r:n)===c[0]||!this.se("prependTriggeredLine")?g=c:(g=[this.Dt,...c],g.indices=[[0,g[0].length],...c.indices]),c.groups&&Object.keys(c.groups).map(m=>this._.variables[m]=c.groups[m]),this.ExecuteTrigger(t,g,!1,s,[this.Dt,h],c.groups,e)}s=this.cleanUpTriggerState(s)}catch(h){this.se("disableTriggerOnError")&&(t.enabled=!1,setTimeout(()=>{this._.saveProfiles(),this.emit("item-updated","trigger",e.profile,e.profile.triggers.indexOf(e),e)})),this.se("showScriptErrors")?this._.error(h):this._.debug(h)}return s}ExecuteTrigger(t,e,s,n,r,o,a){if(s==null&&(s=!1),!t.enabled)return"";if(this.Oe[n]&&this.Oe[n].type===16384&&delete this.Oe[n],t.fired)return t.fired=!1,this.Oi(t,a,n),this.Oe[n]?this.Oe[n].reParse=!0:this.Oe[n]={reParse:!0},"";this.Ls=t;let h;if(t.temp)if(a.triggers.length)if(a.state===0){let c=a.triggers.shift();c.triggers=a.triggers,c.state=a.state,c.name=a.name,c.profile=a.profile,c.state>c.triggers.length&&(c.state=0),n>=0&&(this.gi[n]=c),this._.saveProfiles();let g=a.profile.triggers.indexOf(a);a.profile.triggers[g]=c,this._.emit("item-updated","trigger",a.profile.name,g,c)}else a.triggers.splice(a.state-1,1),a.state>a.triggers.length&&(a.state=0),this._.saveProfiles(),this._.emit("item-updated","trigger",a.profile.name,a.profile.triggers.indexOf(a),a);else n>=0&&this.gi.splice(n,1),this.Oe[n]&&this.clearTriggerState(n),this._.removeTrigger(a);else a.triggers.length&&this.Oi(t,a,n);if((this.se("echo")&8)===8&&this.Le("Trigger fired: "+t.pattern,-7,-8,!0,!0),t.value.length)switch(t.style){case 1:this.ft.push({loops:[],args:e,named:0,used:0,regex:r});try{h=this.parseOutgoing(t.value)}catch(c){throw c}finally{this.ft.pop()}break;case 2:if((this.se("echo")&2)===2&&this.Le(t.value,-7,-8,!0,!0),t.temp)h=new Function("try { "+t.value+`
} catch (e) { if(this.getOption('showScriptErrors')) this.error(e);}`),h=h.apply(this._,e);else{this.Un[n]||(o?h=Object.keys(o).map(c=>`let ${c} = this.variables["${c}"];`).join("")+`
`:h="",this.Un[n]=new Function("try { "+h+t.value+`
} catch (e) { if(this.getOption('showScriptErrors')) this.error(e);}`)),this.ft.push({loops:[],args:e,named:0,used:0,regex:r,indices:e.indices});try{h=this.Un[n].apply(this._,e)}catch(c){throw c}finally{this.ft.pop()}}typeof h=="string"&&(h=this.parseOutgoing(h));break;default:h=t.value;break}if(h==null||h===void 0)return null;if(s)return h;if(typeof h!="string"&&(h=h.toString()),h.length===0&&!this.se("returnNewlineOnEmptyValue"))return null;h.endsWith(`
`)||(h+=`
`),this._.connected&&this._.telnet.sendData(h),this._.telnet.echo&&this.se("commandEcho")&&setTimeout(()=>{this.Le(h)},1)}Oi(t,e,s){if(this.Oe[s]){if(this.Oe[s].type===4096){if(this.Oe[s].loop--,this.Oe[s].loop>0)return;this.clearTriggerState(s)}else if(this.Oe[s].type===8192){if(this.Oe[s].lineCount>0)return;this.clearTriggerState(s)}else if(this.Oe[s].type===32768)this.clearTriggerState(s);else if(this.Oe[s].type===128&&(this.Oe[s].loop===-1||this.Oe[s].lineCount>0))return}if(e.state++,e.state>e.triggers.length&&(e.state=0),this.se("saveTriggerStateChanges")&&this._.saveProfiles(),this._.emit("item-updated","trigger",e.profile.name,e.profile.triggers.indexOf(e),e),e.state!==0){let n=this.createTriggerState(e.triggers[e.state-1]);n&&(this.Oe[s]=n)}}createTriggerState(t,e,s){let n,r;switch(t.type){case 131072:case 262144:r={reParse:!0};break;case 16384:case 1024:n=t.params,n&&n.length?(n=parseInt(n,10),isNaN(n)&&(n=0)):n=0,r={time:Date.now()+n};break;case 32768:case 8192:case 512:n=t.params,n&&n.length?(n=parseInt(n,10),isNaN(n)&&(n=1)):n=1,r={lineCount:n+1};break;case 4096:n=t.params,n&&n.length?(n=parseInt(n,10),isNaN(n)&&(n=0)):n=0,r={loop:n};break;case 128:n=t.params,n&&n.length?(n=parseInt(n,10),isNaN(n)&&(n=1),s===t?r={lineCount:n-1}:r={lineCount:n}):r={loop:-1};break}return r&&(r.type=t.type),!r&&e?{reParse:!0}:(e&&(r.reparse=!0),r)}updateTriggerState(t,e){if(!this.Oe[e])return;let s;switch(this.Oe[e].type){case 1024:case 16384:s=t.params,s&&s.length?(s=parseInt(s,10),isNaN(s)&&(s=0)):s=0,this.Oe[e].time=Date.now()+s;break;case 32768:case 512:case 8192:s=t.params,s&&s.length?(s=parseInt(s,10),isNaN(s)&&(s=0)):s=0,this.Oe[e].lineCount=s;break;case 4096:s=t.params,s&&s.length?(s=parseInt(s,10),isNaN(s)&&(s=0)):s=0,this.Oe[e].loop=s;break;case 128:s=t.params,s&&s.length?(s=parseInt(s,10),isNaN(s)&&(s=1),this.Oe[e].lineCount=s+1):this.Oe[e].loop=-1;break}}getTriggerState(t){return this.Oe[t]}cleanUpTriggerState(t){return this.Oe[t]&&this.Oe[t].reParse&&(!this.Oe[t].type||this.Oe[t].type===131072||this.Oe[t].type===262144?delete this.Oe[t]:delete this.Oe[t].reParse,t<0?t++:t--),t}clearTriggerState(t){delete this.Oe[t]}setTriggerState(t,e){this.Oe[t]=e}clearTriggerCache(){this.gi=null,this.Oe={},this.Un={},this.Xs={}}resetTriggerState(t,e,s){if(t===-1||t<0||t>=this.gi.length)return;let n=this.gi[t],r=n,o=!1;if(r.state!==0&&(n=r.triggers[r.state-1]),e===r.state)this.Oe[t]?n.fired?this.clearTriggerState(t):this.updateTriggerState(n,t):n.fired||this.updateTriggerState(n,t);else if(this.Oe[t]&&(!this.Oe[t].type||this.Oe[t].type!==262144&&this.Oe[t].type!==131072)&&(o=this.Oe[t].reParse),this.clearTriggerState(t),n.fired)this.Oe[t]={reParse:!0};else{let a=this.createTriggerState(n,o);a&&(this.Oe[t]=a)}}buildTriggerCache(){this.gi==null&&(this.gi=this._.triggers.filter(t=>{if(t&&t.enabled&&t.triggers.length){if(t.type!==3)return!0;for(let e=0,s=t.triggers.length;e<s;e++)if(t.triggers[e].enabled&&t.triggers[e].type!==3)return!0;return!1}return t.enabled&&t.type!==3}))}clearCaches(){this.gi=null,this.Oe={},this.Un={},this.Xs={},this.os=null,this.Cs=-1,this.Cl={}}triggerEvent(t,e){if(!this.enableTriggers)return;this.buildTriggerCache();let s=0;e?Array.isArray(e)?e.unshift(t):e=[t,e]:e=[t];let n=this.gi.length;for(;s<n;s++){let r=this.gi[s],o=r,a=!1;if(r.enabled){if(r.state>o.triggers.length&&(r.state=0),r.state!==0&&o.triggers&&o.triggers.length){for(r=o.triggers[r.state-1];!r.enabled&&o.state!==0;){if(o.state++,o.state>o.triggers.length){o.state=0,r=o;break}o.state?r=o.triggers[o.state-1]:r=o,a=!0}if(a&&(this.se("saveTriggerStateChanges")&&this._.saveProfiles(),this._.emit("item-updated","trigger",o.profile.name,o.profile.triggers.indexOf(o),o)),!r.enabled)continue}if(r.type===131072||r.type===262144){let h=this.adjustLastLine(this.ge.lines.length,!0),c=this.ge.lines[h];s=this.TestTrigger(r,o,s,c,this.ge.lines[h].raw||c,h===this.ge.lines.length-1);continue}r.type===2&&(r.caseSensitive&&t!==r.pattern||!r.caseSensitive&&t.toLowerCase()!==r.pattern.toLowerCase()||(this.Dt=t,this.ExecuteTrigger(r,e,!1,s,0,0,o),s=this.cleanUpTriggerState(s)))}}}executeWait(t,e,s,n,r,o,a){if(!t||t.length===0)return;let h={loops:this.loops.splice(0),args:0,named:0,used:this.stack.used,append:this.stack.append};this.stack.args&&(h.args=this.stack.args.slice()),this.stack.named&&(h.named=this.stack.named.slice()),e<0&&(e=0),setTimeout(()=>{this.ft.push(h);let c=this.parseOutgoing(t,s,n,r,o,a);this.ft.pop(),!(c==null||typeof c>"u"||c.length===0)&&(c.endsWith(`
`)||(c=c+`
`),this._.send(c,!0))},e)}stripQuotes(t,e,s){return!t||t.length===0||((e||this.se("parseDoubleQuotes"))&&(t=t.replace(/^\"(.*)\"$/g,(n,r,o)=>r.replace(/\\\"/g,'"'))),(s||this.se("parseSingleQuotes"))&&(t=t.replace(/^\'(.*)\'$/g,(n,r,o)=>r.replace(/\\\'/g,"'")))),t}splitByQuotes(t,e,s,n){let r=0,o=0;return!t||t.length===0?[]:((s||this.se("parseDoubleQuotes"))&&(r|=2,o|=this.se("allowEscape")?2:0),(n||this.se("parseSingleQuotes"))&&(r|=1,o|=this.se("allowEscape")?1:0),ti(t,e,r,o,this.se("escapeChar")))}createTrigger(t,e,s,n,r,o){let a,h,c=!0,g=!1;if(!t&&!r)throw new Error(`Trigger '${r||""}' not found`);if(s){if(typeof s=="string"){if(this.ee.contains(s.toLowerCase()))s=this.ee.items[s.toLowerCase()];else throw new De(s);if(o)if(r)a=s.findAny("triggers",{name:r,pattern:r});else{if(!s.triggers.length)throw new Error("No triggers exist");a=s.triggers[s.triggers.length-1]}else r!==null?a=s.find("triggers","name",r):a=s.find("triggers","pattern",t)}}else{let m=this.ee.keys,b=0,u=m.length;if(u===0)return;if(u===1){if(!this.ee.items[m[0]].enabled||!this.ee.items[m[0]].enableTriggers)throw Error("No enabled profiles found!");if(s=this.ee.items[m[0]],o)if(r)a=this.ee.items[m[b]].findAny("triggers",{name:r,pattern:r});else{if(!this.ee.items[m[b]].triggers.length)throw new Error("No triggers exist");a=this.ee.items[m[b]].triggers[this.ee.items[m[b]].triggers.length-1]}else r!==null?a=this.ee.items[m[b]].find("triggers","name",r):a=this.ee.items[m[b]].find("triggers","pattern",t)}else{for(;b<u;b++)if(!(!this.ee.items[m[b]].enabled||!this.ee.items[m[b]].enableTriggers||this.ee.items[m[b]].triggers.length===0)){if(o)if(r)a=this.ee.items[m[b]].findAny("triggers",{name:r,pattern:r});else{if(!this.ee.items[m[b]].triggers.length)throw new Error("No triggers exist");a=this.ee.items[m[b]].triggers[this.ee.items[m[b]].triggers.length-1]}else r!==null?a=this.ee.items[m[b]].find("triggers","name",r):a=this.ee.items[m[b]].find("triggers","pattern",t);if(a){s=this.ee.items[m[b]];break}}s||(s=this._.activeProfile)}}if(o){if(!a)throw new Error(`Trigger '${r||""}' not found`);if(h=new Te,h.pattern=t,c=!1,t!==null&&(h.pattern=t),e!==null&&(h.value=e),n&&(n.cmd&&(h.type=1),n.pattern&&(h.type=8),n.regular&&(h.type=0),n.alarm&&(h.type=3),n.event&&(h.type=2),n.cmdpattern&&(h.type=16),n.loopexpression&&(h.type=128),n.reparse&&(h.type=131072),n.reparsepattern&&(h.type=262144),n.manual&&(h.type=65536),n.skip&&(h.type=512),n.looplines&&(h.type=8192),n.looppattern&&(h.type=4096),n.wait&&(h.type=1024),n.duration&&(h.type=16384),n.withinlines&&(h.type=32768),n.prompt&&(h.triggerPrompt=!0),n.nocr&&(h.triggerNewline=!1),n.case&&(h.caseSensitive=!0),n.raw&&(h.raw=!0),n.verbatim&&(h.verbatim=!0),n.disable?h.enabled=!1:n.enable&&(h.enabled=!0),(n.temporary||n.temp)&&(h.temp=!0),n.params&&(h.params=n.params),n.type))if(this.Ms(n.type))h.type=this.Po(n.type);else throw new ce("type");a.triggers.push(h),this.Le("Trigger sub state added.",-7,-8,!0,!0)}else{if(a)this.Le("Trigger updated.",-7,-8,!0,!0);else{if(!t)throw new Error(`Trigger '${r||""}' not found`);a=new Te,a.name=r||"",a.pattern=t,s.triggers.push(a),this.Le("Trigger added.",-7,-8,!0,!0),g=!0}if(t!==null&&(a.pattern=t),e!==null&&(a.value=e),n){if(n.cmd&&(a.type=1),n.pattern&&(a.type=8),n.regular&&(a.type=0),n.alarm&&(a.type=3),n.event&&(a.type=2),n.cmdpattern&&(a.type=16),n.loopexpression&&(a.type=128),n.prompt&&(a.triggerPrompt=!0),n.nocr&&(a.triggerNewline=!1),n.case&&(a.caseSensitive=!0),n.raw&&(a.raw=!0),n.verbatim&&(a.verbatim=!0),n.disable?a.enabled=!1:n.enable&&(a.enabled=!0),(n.temporary||n.temp)&&(a.temp=!0),n.params&&(a.params=n.params),n.type)if(this.Ms(n.type,1))a.type=this.Po(n.type);else throw new ce("type");a.priority=n.priority}else a.priority=0}this._.saveProfiles(),c&&this._.clearCache(),g?this.emit("item-added","trigger",s.name,a.triggers.length-1,a):this.emit("item-updated","trigger",s.name,s.triggers.indexOf(a),a),s=null}Ms(t,e){switch(e||(e=3),t.replace(/ /g,"").toUpperCase()){case"REGULAREXPRESSION":case"COMMANDINPUTREGULAREXPRESSION":return(e&1)===1;case"0":case"1":case"2":case"3":case"8":case"16":case"128":case"REGULAR":case"COMMANDINPUTREGULAR":case"EVENT":case"ALARM":case"COMMAND":case"COMMANDINPUTPATTERN":case"LOOPEXPRSSION":return(e&1)===1;case"SKIP":case"512":case"WAIT":case"1024":case"LOOPPATTERN":case"4096":case"LOOPLINES":case"8192":case"DURATION":case"16384":case"WITHINLINES":case"32768":case"MANUAL":case"65536":case"REPARSE":case"131072":case"REPARSEPATTERN":case"262144":return(e&2)===2}return!1}Po(t){switch(t.replace(/ /g,"").toUpperCase()){case"REGULAREXPRESSION":return 0;case"COMMANDINPUTREGULAREXPRESSION":return 1;case"0":case"1":case"2":case"3":case"8":case"16":case"128":return Xt[parseInt(t,10)];case"REGULAR":case"COMMANDINPUTREGULAR":case"EVENT":case"ALARM":case"COMMAND":case"COMMANDINPUTPATTERN":case"LOOPEXPRSSION":return Xt[t];case"512":case"1024":case"4096":case"8192":case"16384":case"32768":case"65536":case"131072":case"262144":return qt[parseInt(t,10)];case"SKIP":case"WAIT":case"LOOPPATTERN":case"LOOPLINES":case"DURATION":case"WITHINLINES":case"MANUAL":case"REPARSE":case"REPARSEPATTERN":return qt[t]}throw new ce("type")}vn(t,e,s,n){if(t=this.adjustLastLine(t),!n.hasOwnProperty("yStart"))this.ge.colorSubStringByLine(t,e,s,n.xStart,n.hasOwnProperty("xEnd")&&n.xEnd>=0?n.xEnd:null);else{let r=n.hasOwnProperty("xEnd")&&n.xEnd>=0?n.xEnd:null,o=n.xStart,a=t-n.yStart,h=t;for(n.hasOwnProperty("yEnd")&&(h=t-n.yEnd);a<=h;)this.ge.colorSubStringByLine(a,e,s,o,r),a++}}se(t){return this._.getOption(t)}get ee(){return this._.profiles}Le(t,e,s,n,r){this._.echo(t,e,s,n,r)}Nr(t,e){let s=null,n;if(t[0].match(/^\{.*\}$/g)||t[0].match(/^".*"$/g)||t[0].match(/^'.*'$/g)){if(t.length>2)throw new Error(e);if(t.length===2)if(s=this.parseInline(this.stripQuotes(t[1])).toLowerCase(),this.ee.contains(s))s=this.ee.items[s];else throw new De(s);else s=this._.activeProfile;t[0].match(/^".*"$/g)||t[0].match(/^'.*'$/g)?n=this.parseInline(this.stripQuotes(t[0])):n=this.parseInline(t[0].substr(1,t[0].length-2))}else n=this.parseInline(t.join(" ")),s=this._.activeProfile;return{profile:s,results:n}}de(t){(this.se("echo")&4)===4&&this.Le(t,-3,-4,!0,!0)}};function de(f){this.ok=!1,f.charAt(0)=="#"&&(f=f.substr(1,6)),f=f.replace(/ /g,""),f=f.toLowerCase();var p={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var t in p)f==t&&(f=p[t]);for(var e=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(c){return[parseInt(c[1],10),parseInt(c[2],10),parseInt(c[3],10)]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(c){return[parseInt(c[1],16),parseInt(c[2],16),parseInt(c[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(c){return[parseInt(c[1]+c[1],16),parseInt(c[2]+c[2],16),parseInt(c[3]+c[3],16)]}}],s=0,n=e.length;s<n;s++){var r=e[s].re,o=e[s].process,a=r.exec(f);if(a){var h=o(a);this.r=h[0],this.g=h[1],this.b=h[2],this.ok=!0}}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var c=this.r.toString(16),g=this.g.toString(16),m=this.b.toString(16);return c.length==1&&(c="0"+c),g.length==1&&(g="0"+g),m.length==1&&(m="0"+m),"#"+c+g+m}}var Ce=(T=>(T[T.None=0]="None",T[T.B=1]="B",T[T.BOLD=2]="BOLD",T[T.STRONG=3]="STRONG",T[T.I=4]="I",T[T.ITALIC=5]="ITALIC",T[T.EM=6]="EM",T[T.U=7]="U",T[T.UNDERLINE=8]="UNDERLINE",T[T.S=9]="S",T[T.STRIKEOUT=10]="STRIKEOUT",T[T.STRIKE=11]="STRIKE",T[T.C=12]="C",T[T.COLOR=13]="COLOR",T[T.H=14]="H",T[T.HIGH=15]="HIGH",T[T.FONT=16]="FONT",T[T.HR=17]="HR",T[T.NOBR=18]="NOBR",T[T.P=19]="P",T[T.BR=20]="BR",T[T.SBR=21]="SBR",T[T.A=22]="A",T[T.SEND=23]="SEND",T[T.EXPIRE=24]="EXPIRE",T[T.VERSION=25]="VERSION",T[T.SUPPORT=26]="SUPPORT",T[T.RESET=27]="RESET",T[T.H1=28]="H1",T[T.H2=29]="H2",T[T.H3=30]="H3",T[T.H4=31]="H4",T[T.H5=32]="H5",T[T.H6=33]="H6",T[T.V=34]="V",T[T.VAR=35]="VAR",T[T.USER=36]="USER",T[T.PASSWORD=37]="PASSWORD",T[T.Custom=38]="Custom",T[T.GAUGE=39]="GAUGE",T[T.STAT=40]="STAT",T))(Ce||{});var oi=class{constructor(){this.on=!1;this.lineType=0;this.locked=!1;this.paragraph=!1;this.noBreak=!1;this.expanded=!1;this.lineExpanded=!1;this.capture=0;this.captured=[];this.gagged=!1}},ai=class{constructor(p){this.name="";this.value="";this.description="";this.publish=!1;this.remote=!1;this.remote=p??!1}},$i=class{constructor(p){this.name="";this.definition="";this.closeDefinition="";this.attributes={};this.attributeIndexes=[];this.tag=-1;this.flag="";this.open=!1;this.empty=!1;this.remote=!1;this.gagged=!1;this.remote=p??!1}},hi=class{constructor(p,t,e,s){this.index=-1;this.window="";this.gag=!1;this.fore="";this.back="";this.enabled=!0;this.remote=!1;this.element="";this.definition="";this.closeDefinition="";p!=null&&(this.index=p),t!=null&&(this.fore=t),e!=null&&(this.back=e),s!=null&&(this.remote=s)}},Dt=class{constructor(p,t,e,s,n){this.tag=0;this.custom="";this.font=null;this.fontSize=null;this.style=0;this.fore="";this.back="";this.high=!1;this.obj=null;this.gagged=!1;this.open=!1;this.properties=null;p!=null&&(this.style=p),t!=null&&(this.fore=t),e!=null&&(this.back=e),this.high=s||!1,this.open=n||!1}},ci=class extends me{constructor(t){super();this.Ki=[];this.Dr=[["m","a","i","l","t","o"],["s","k","y","p","e"],["c","a","l","l","t","o"],["i","m"],["i","t","m","s"],["t","e","l"],["t","e","l","n","e","t"]];this.ke=null;this.At=37;this.Ft=40;this.ze=0;this.Me="";this.ne=new oi;this.Ze=[];this.He={};this.qt={};this.Ke=[];this.qn=0;this.displayControlCodes=!1;this.emulateControlCodes=!0;this.StyleVersion="";this.EndOfLine=!1;this.textLength=0;this.rawLength=0;this.enableMXP=!0;this.DefaultImgUrl="";this.enableDebug=!1;this.showInvalidMXPTags=!1;this.enableLinks=!0;this.enableMSP=!0;this.enableURLDetection=!0;this.window=new Ot(0,0);this.enableFlashing=!1;this.emulateTerminal=!1;this.enableBell=!0;this.display=null;this.tabWidth=8;this.busy=!1;t!=null&&(t.DefaultImageURL&&(this.DefaultImgUrl=t.DefaultImageURL),t.enableMXP!=null&&(this.enableMXP=t.enableMXP),t.enableDebug!=null&&(this.enableDebug=t.enableDebug),t.showInvalidMXPTags!=null&&(this.showInvalidMXPTags=t.showInvalidMXPTags),t.enableMSP!=null&&(this.enableMSP=t.enableMSP),t.enableURLDetection!=null&&(this.enableURLDetection=t.enableURLDetection),t.window!=null&&(this.window=t.window),t.enableFlashing!=null&&(this.enableFlashing=t.enableFlashing),t.emulateTerminal!=null&&(this.emulateTerminal=t.emulateTerminal),t.enableBell!=null&&(this.enableBell=t.enableBell),t.display!=null&&(this.display=t.display),t.enableLinks&&(this.enableLinks=t.enableLinks))}Oo(t){typeof t>"u"&&(t=this.Pl());let e,s,n=-1,r=-1;return t.fore.length>0?(this.ze&1)===1?e=this.IncreaseColor(t.fore,.5):(this.ze&2)===2?e=this.DecreaseColor(t.fore,.5):e=t.fore:typeof this.At=="string"?e="rgb("+this.At.replace(/;/g,",")+")":(e=this.At,(this.ze&1)===1?(e>999&&(e/=1e3),e>=0&&e<99&&(e*=10),n=e,e<=-16&&(e=this.IncreaseColor(this.GetColor(e),.5))):(this.ze&2)===2?(e>99&&e<999&&(e/=10),e>=0&&e<999&&(e*=100),n=e,e<=-16&&(e=this.DecreaseColor(this.GetColor(e),.15))):n=e),t.high&&(typeof e=="number"?e=this.IncreaseColor(this.GetColor(e),.25):e=this.IncreaseColor(e,.25)),t.back.length>0?s=t.back:typeof this.Ft=="string"?s="rgb("+this.Ft.replace(/;/g,",")+")":s=r=this.Ft,(this.ze&64)===64||(t.style&64)===64?{fore:s,back:e,foreCode:r,backCode:n}:{fore:e,back:s,foreCode:n,backCode:r}}Mt(t){let e=this.Pl(),s=this.Oo(e);return{formatType:0,offset:t,color:s.fore||0,background:s.back||0,size:e.fontSize||0,font:e.font||0,style:e.style|this.ze&-2,unicode:!1}}Bo(){this.At=37,this.Ft=40,this.ze=0}sh(t){let e=0,s=t.length,n,r;for(;e<s;e++)switch(n=+t[e]||0,n){case 0:this.Bo();break;case 1:this.ze|=1,this.ze&=-3;break;case 2:this.ze|=2,this.ze&=-2;break;case 3:this.ze|=4;break;case 4:this.ze|=8;break;case 5:this.ze|=16;break;case 6:this.ze|=32;break;case 7:this.ze|=64;break;case 8:this.ze|=128;break;case 9:this.ze|=256;break;case 21:this.ze|=512;break;case 22:this.ze&=-2,this.ze&=-3;break;case 23:this.ze&=-5;break;case 24:this.ze&=-9,this.ze&=-513;break;case 25:this.ze&=-17;break;case 26:this.ze&=-33;break;case 27:this.ze&=-65;break;case 28:this.ze&=-129;break;case 29:this.ze&=-257;break;case-11:case-7:case-3:case 30:case 31:case 32:case 33:case 34:case 35:case 36:case 37:this.At=n;break;case 38:if(e+2<s&&t[e+1]==="5")this.At=+t[e+2],isNaN(this.At)?this.At=37:(this.At+=16,this.At*=-1),e+=2;else if(e+4<s&&t[e+1]==="2"){if(n=+t[e+2]||0,n<0||n>255||(r=n+";",n=+t[e+3]||0,n<0||n>255)||(r+=n+";",n=+t[e+4]||0,n<0||n>255))continue;r+=n,this.At=r,e+=4}break;case 39:this.At=-1;break;case-12:case-8:case-4:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:this.Ft=n;break;case 48:if(e+2<s&&t[e+1]==="5")this.Ft=+t[e+2],isNaN(this.Ft)?this.Ft=40:(this.Ft+=16,this.Ft*=-1),e+=2;else if(e+4<s&&t[e+1]==="2"){if(n=+t[e+2]||0,n<0||n>255||(r=n+";",n=+t[e+3]||0,n<0||n>255)||(r+=n+";",n=+t[e+4]||0,n<0||n>255))continue;r+=n,this.Ft=r,e+=4}break;case 49:this.Ft=-2;break;case 53:this.ze|=1024;break;case 55:this.ze&=-1025;break;case 50:case 51:case 52:case 54:case 56:case 57:case 58:case 59:this.At=n-20,this.ze|=1;break;case 90:case 91:case 92:case 93:case 94:case 95:case 96:case 97:this.At=n;break;case 100:case 101:case 102:case 103:case 104:case 105:case 106:case 107:this.Ft=n;break}}Do(){let t=[],e,s,n,r;for(e=0;e<6;e++)for(s=0;s<6;s++)for(n=0;n<6;n++)r=16+e*36+s*6+n,t[r]="rgb(",e>0?t[r]+=e*40+55:t[r]+="0",t[r]+=",",s>0?t[r]+=s*40+55:t[r]+="0",t[r]+=",",n>0?t[r]+=n*40+55:t[r]+="0",t[r]+=")";for(e=232;e<=255;e++)s=(e-232)*10+8,t[e]=["rgb(",s,",",s,",",s,")"].join("");t[0]="rgb(0,0,0)",t[1]="rgb(128, 0, 0)",t[2]="rgb(0, 128, 0)",t[3]="rgb(128, 128, 0)",t[4]="rgb(0, 0, 238)",t[5]="rgb(128, 0, 128)",t[6]="rgb(0, 128, 128)",t[7]="rgb(187, 187, 187)",t[8]="rgb(128, 128, 128)",t[9]="rgb(255, 0, 0)",t[10]="rgb(0, 255, 0)",t[11]="rgb(255, 255, 0)",t[12]="rgb(92, 92, 255)",t[13]="rgb(255, 0, 255)",t[14]="rgb(0, 255, 255)",t[15]="rgb(255, 255, 255)",t[256]="rgb(0, 0, 0)",t[257]="rgb(118, 0, 0)",t[258]="rgb(0, 108, 0)",t[259]="rgb(145, 136, 0)",t[260]="rgb(0, 0, 167)",t[261]="rgb(108, 0, 108)",t[262]="rgb(0, 108, 108)",t[263]="rgb(161, 161, 161)",t[264]="rgb(0, 0, 0)",t[265]="rgb(128, 0, 0)",t[266]="rgb(0, 128, 0)",t[267]="rgb(128, 128, 0)",t[268]="rgb(0, 0, 238)",t[269]="rgb(128, 0, 128)",t[270]="rgb(0, 128, 128)",t[271]="rgb(187, 187, 187)",t[272]="rgb(0,0,0)",t[273]="rgb(0, 255, 255)",t[274]="rgb(0,0,0)",t[275]="rgb(255, 255, 0)",t[276]="rgb(0, 0, 0)",t[277]="rgb(229, 229, 229)",t[278]="rgb(205, 0, 0)",t[279]="rgb(229, 229, 229)",t[280]="rgb(255,255,255)",this.ke=t}GetColor(t){switch(this.ke==null&&this.Do(),t){case-12:return this.ke[279];case-11:return this.ke[278];case-10:return this.ke[280];case-8:return this.ke[272];case-7:return this.ke[273];case-4:return this.ke[274];case-3:return this.ke[275];case 49:case-2:return this.ke[276];case 39:case-1:return this.ke[277];case 0:case 30:return this.ke[0];case 1:case 31:return this.ke[1];case 2:case 32:return this.ke[2];case 3:case 33:return this.ke[3];case 4:case 34:return this.ke[4];case 5:case 35:return this.ke[5];case 6:case 36:return this.ke[6];case 7:case 37:return this.ke[7];case 40:return this.ke[264];case 41:return this.ke[265];case 42:return this.ke[266];case 43:return this.ke[267];case 44:return this.ke[268];case 45:return this.ke[269];case 46:return this.ke[270];case 47:return this.ke[271];case 8:case 90:case 100:case 300:case 400:return this.ke[8];case 9:case 91:case 101:case 310:case 410:return this.ke[9];case 10:case 92:case 102:case 320:case 420:return this.ke[10];case 11:case 93:case 103:case 330:case 430:return this.ke[11];case 12:case 94:case 104:case 340:case 440:return this.ke[12];case 13:case 95:case 105:case 350:case 450:return this.ke[13];case 14:case 96:case 106:case 360:case 460:return this.ke[14];case 15:case 97:case 107:case 370:case 470:return this.ke[15];case 4e3:case 3e3:return this.ke[256];case 4100:case 3100:return this.ke[257];case 4200:case 3200:return this.ke[258];case 4300:case 3300:return this.ke[259];case 4400:case 3400:return this.ke[260];case 4500:case 3500:return this.ke[261];case 4600:case 3600:return this.ke[262];case 4700:case 3700:return this.ke[263];default:return t<=-16&&(t+=16,t*=-1),t>=0&&t<281?this.ke[t]:this.ke[277]}}SetColor(t,e){this.ke==null&&this.Do(),!(t<0||t>=this.ke.length)&&(e=new de(e),e.ok&&(this.ke[t]=e.toRGB()))}Vs(t,e,s,n,r,o){let a={raw:e,line:t,fragment:s,gagged:n,formats:this.Vn(r,t.length,s),remote:o};this.emit("add-line",a),this.EndOfLine=!s}Vn(t,e,s){if(!t||t.length<2)return t;let n=t.length,r=[];for(let o=0;o<n;o++){let a=t[o],h;if(o<n-1){let c=t[o+1];if(a.offset===c.offset&&c.formatType===a.formatType||(h=c.offset,a.formatType===1&&h-a.offset===0&&c.formatType===2)||a.formatType===7&&h-a.offset===0&&c.formatType===8||a.formatType===3&&h-a.offset===0&&c.formatType===4)continue}else if(!s&&a.offset===e&&e!==0&&(a.formatType===0&&!a.hr||a.formatType===1||a.formatType===7||a.formatType===3))continue;r.push(a)}return r}Ut(t){return t==="text"?t:this.He[t]?(this.ne.expanded=!0,this.He[t].value):t}kn(t,e,s){e==null&&(e="");let n=new Dt;n.tag=0;let r=this.Ze.length-1;for(;r>=0&&(this.Ze[r].tag!==t&&this.Ze[r].custom!==e);r--){if(!this.Ze[r].open&&!s)continue;n=this.Ze.splice(r,1)[0]}return r>=0&&this.Ze.length>0?n=this.Ze.splice(r,1)[0]:this.Ze.length===0&&this.ResetMXP(),n}ti(){let t=this.Ze.length;for(;t--;)this.Ze[t].open&&this.Ze.splice(t,1);this.Ze.length===0&&this.ResetMXP()}Ji(){if(!this.ne.on)return[];let t=0,e=this.Ze.length,s=[];for(;t<e;t++)(this.Ze[t].tag===22||this.Ze[t].tag===23)&&s.push(Object.assign({},this.Ze[t].properties));return s}Rs(){if(!this.ne.on)return[];let t=this.Ze.length,e=[];for(;t--;)this.Ze[t].tag===22?e.push({formatType:4}):this.Ze[t].tag===23&&e.push({formatType:8});return e}Ks(t,e,s,n,r){let o,a,h,c,g,m,b=e.length,u,E,w,L="",k="",R="",B=!1;switch(t=t.toUpperCase(),this.enableDebug&&(this.emit("debug","MXP Tag: "+t),this.emit("debug","MXP Tag Args: "+e)),t){case"C":case"COLOR":if(o=this.Ei(),o.tag=Ce[t],o.open=!0,b>0)if(a=e[0].split("="),a.length>1){if(g=new de(ee(a[1])),!g.ok)return null;a[0].toUpperCase()==="BACK"?o.back=g.toRGB():o.fore=g.toRGB()}else g=new de(ee(a[0])),g.ok&&(o.fore=g.toRGB());if(b>1)if(a=e[1].split("="),a.length>1){if(g=new de(ee(a[1])),!g.ok)return null;a[0].toUpperCase()==="FORE"?o.fore=g.toRGB():o.back=g.toRGB()}else g=new de(ee(a[0])),g.ok&&(o.back=g.toRGB());return o.custom="",this.Ze.push(o),null;case"B":case"BOLD":case"STRONG":return o=this.Ei(),o.open=!0,o.tag=Ce[t],o.style|=1,o.custom="",this.Ze.push(o),null;case"FONT":for(o=this.Ei(),o.open=!0,o.tag=Ce[t],m=0;m<b;m++)if(a=e[m].split("="),a.length>1)switch(a[0].toUpperCase()){case"SIZE":this.Ao(a[1])?o.fontSize=a[1]+"pt":o.fontSize=a[1]||0;break;case"COLOR":for(c=a[1].split(","),g=new de(ee(c[0])),g.ok&&(o.fore=g.toRGB()),w=1,E=c.length;w<E;w++)switch(c[w].toLowerCase()){case"bold":o.style|=1;break;case"italic":o.style|=4;break;case"underline":o.style|=8;break;case"blink":o.style|=16;break;case"inverse":o.style|=64;break;case"hidden":o.style|=128;break;case"strikeout":o.style|=256;break;case"overline":o.style|=1024;break;case"doubleunderline":o.style|=512;break}break;case"BACK":g=new de(ee(a[1])),g.ok&&(o.back=g.toRGB());break;case"FACE":o.font=ee(a[1])||0;break;default:this.enableDebug&&this.emit("debug","Invalid Argument for "+t+": "+a[0]);break}else m===0?o.font=ee(e[m])||0:m===1?this.Ao(e[m])?o.fontSize=e[m]+"pt":o.fontSize=e[m]||0:m===2?(g=new de(ee(e[m])),g.ok&&(o.fore=g.toRGB())):m===3&&(g=new de(ee(e[m])),g.ok&&(o.back=g.toRGB()));return o.custom="",this.Ze.push(o),null;case"H":case"HIGH":return o=this.Ei(),o.open=!0,o.tag=Ce[t],o.high=!0,o.custom="",this.Ze.push(o),null;case"I":case"ITALIC":case"EM":return o=this.Ei(),o.open=!0,o.tag=Ce[t],o.style|=4,o.custom="",this.Ze.push(o),null;case"U":case"UNDERLINE":return o=this.Ei(),o.open=!0,o.tag=Ce[t],o.style|=8,o.custom="",this.Ze.push(o),null;case"S":case"STRIKEOUT":return o=this.Ei(),o.open=!0,o.tag=Ce[t],o.style|=256,o.custom="",this.Ze.push(o),null;case"/B":case"/BOLD":case"/STRONG":case"/H":case"/HIGH":case"/I":case"/ITALIC":case"/EM":case"/U":case"/UNDERLINE":case"/S":case"/STRIKEOUT":case"/C":case"/COLOR":case"/FONT":return this.kn(Ce[t.substring(1)]),null}if(this.ne.lineType===1||this.ne.lineType===6||this.ne.lineType===4)switch(t){case"IMAGE":for(u={formatType:5,name:"",url:this.DefaultImgUrl,t:"",h:"",w:"",hspace:"",vspace:"",align:"bottom",ismap:!1},m=0;m<b;m++)switch(a=e[m].split("="),a[0].toUpperCase()){case"FNAME":u.name=ee(a[1]);break;case"URL":u.url=ee(a[1]);break;case"TYPE":case"T":a[1].length>0&&(u.type=a[1]);break;case"HEIGHT":case"H":u.h=ee(a[1]);break;case"WIDTH":case"W":u.w=ee(a[1]);break;case"HSPACE":u.hspace=a[1];break;case"VSPACE":u.vspace=a[1];break;case"ALIGN":u.align=a[1].toLowerCase();break;case"ISMAP":u.ismap=!0;break;default:m===0?u.name=ee(e[m]):m===1?u.url=ee(e[m]):m===2&&e[m].length>0?u.type=e[m]:m===3?u.h=ee(e[m]):m===4?u.w=ee(e[m]):m===5?u.hspace=e[m]:m===6?u.vspace=e[m]:m===7&&(u.align=e[m].toLowerCase());break}return{format:u,text:null};case"!AT":case"!ATTLIST":if(e.length===0||(u=e[0],!this.qt[u]||this.He[u].remote!==u.remote&&!this.He[u].open))return null;for(this.qt[u].attributes={},this.qt[u].attributeIndexes=[],m=1;m<b;m++)c=e[m].split("="),c.length>1?this.qt[u].attributes[c[0].toLowerCase()]=c[1]:this.qt[u].attributes[c[0].toLowerCase()]="",this.qt[u].attributeIndexes.push(c[0].toLowerCase());break;case"!TAG":for(u=new hi,u.remote=s,m=0;m<b;m++)switch(a=e[m].split("="),a[0].toUpperCase()){case"WINDOWNAME":u.window=ee(a[1]);break;case"FORE":g=new de(ee(a[1])),g.ok&&(u.fore=g.toRGB());break;case"BACK":g=new de(ee(a[1])),g.ok&&(u.back=g.toRGB());break;case"GAG":u.gag=!0;break;case"ENABLE":u.enabled=!0;break;case"DISABLE":u.enabled=!1;break;default:m===0?(o=+e[m],isNaN(o)||(u.index=o)):m===1?u.window=ee(e[m]):m===2?(g=new de(ee(e[m])),g.ok&&(u.fore=g.toRGB())):m===3&&(g=new de(ee(e[m])),g.ok&&(u.back=g.toRGB()));break}u.fore.length>0&&u.back.length>0?u.definition=`<C "${u.fore}" "${u.back}">`:u.fore.length>0?u.definition=`<C "${u.fore}">`:u.back.length>0&&(u.definition=`<C BACK="${u.fore}">`),u.definition.length>0&&(u.closeDefinition="</C>"),this.Ke[u.index]?(u.remote||this.Ke[u.index].remote===u.remote)&&(this.Ke[u.index]=u):this.Ke[u.index]=u;break;case"!EL":case"!ELEMENT":for(u=new $i(s),m=0;m<b;m++){if(e[m].toUpperCase().startsWith("ATT=")){for(a=ee(e[m]).substring(4).split(" "),w=0,E=a.length;w<E;w++)c=ee(a[w]).split("="),c.length>1?u.attributes[c[0].toLowerCase()]=ee(c[1]):u.attributes[c[0].toLowerCase()]="",u.attributeIndexes.push(c[0].toLowerCase());continue}switch(a=e[m].split("="),a[0].toUpperCase()){case"TAG":o=+a[1],isNaN(o)||(u.tag=o);break;case"FLAG":u.flag=ee(a[1]);break;case"OPEN":u.open=!0;break;case"DELETE":return this.qt[u.name]&&(this.He[u.name].remote===u.remote||this.He[u.name].open)&&delete this.He[u.name],null;case"EMPTY":u.empty=!0;break;case"SECURE":u.open=!1;break;default:if(m===0)u.name=ee(e[m]).toUpperCase();else if(m===1)u.definition=ee(e[m]),u.closeDefinition=this.nh(u.definition),this.enableDebug&&this.emit("debug","MXP close definition: "+u.closeDefinition);else if(m===2)for(a=e[m].substring(4).split(" "),w=0,E=a.length;w<E;w++)c=a[w].split("="),c.length>1?u.attributes[c[0]]=c[1]:u.attributes[c[0]]="",u.attributeIndexes.push(c[0]);else m===3?(o=+e[m],isNaN(o)||(u.tag=o)):m===4&&(u.flag=ee(e[m]));break}}u.tag>19&&u.tag<100&&(o=new hi(u.tag),o.element=u.name,this.Ke[o.index]?(u.remote||this.Ke[o.index].remote===u.remote)&&(this.Ke[o.index]=o):this.Ke[o.index]=o),this.qt[u.name]?(this.qt[u.name].remote===u.remote||this.He[u.name].open)&&(this.qt[u.name]=u):this.qt[u.name]=u;break;case"!EN":case"!ENTITY":for(u=new ai(s),m=0;m<b;m++)switch(a=e[m].split("="),a[0].toUpperCase()){case"DESC":u.description=ee(a[1]);break;case"PRIVATE":u.publish=!1;break;case"PUBLISH":u.publish=!0;break;case"DELETE":return this.He[u.name]&&this.He[u.name].remote===u.remote&&delete this.He[u.name],null;case"ADD":if(this.He[u.name]&&this.He[u.name].remote===u.remote)return this.He[u.name].value?this.He[u.name].value+="|"+u.value:this.He[u.name].value=u.value,null;break;case"REMOVE":if(this.He[u.name]&&this.He[u.name].remote===u.remote&&this.He[u.name].value){for(c=this.He[u.name].value.split("|"),h=[],w=0,E=c.length;w<E;w++)c[w]!==u.value&&h.push(c[w]);this.He[u.name].value=h.join("|")}return null;default:m===0?u.name=ee(e[m]):m===1?u.value=ee(e[m]):m===2&&(u.description=ee(e[m]));break}this.He[u.name]?this.He[u.name].remote===u.remote&&(this.He[u.name]=u):this.He[u.name]=u;break;case"/V":case"/VAR":for(o=this.kn(Ce[t.substring(1)]),u=new ai(s),this.ne.captured.length>0?u.value=this.ne.captured.pop().join(""):u.value="",this.ne.capture--,this.enableDebug&&this.emit("debug","MXP captured: "+u.value),e=o.obj,b=e.length,m=0;m<b;m++)switch(a=e[m].split("="),a[0].toUpperCase()){case"DESC":u.description=ee(a[1]);break;case"PRIVATE":u.publish=!1;break;case"PUBLISH":u.publish=!0;break;case"DELETE":return this.He[u.name]&&this.He[u.name].remote===u.remote&&delete this.He[u.name],null;case"ADD":if(this.He[u.name]&&this.He[u.name].remote===u.remote)return this.He[u.name].value?this.He[u.name].value+="|"+u.value:this.He[u.name].value=u.value,null;break;case"REMOVE":if(this.He[u.name]&&this.He[u.name].remote===u.remote&&this.He[u.name].value){for(c=this.He[u.name].value.split("|"),h=[],w=0,E=c.length;w<E;w++)c[w]!==u.value&&h.push(c[w]);this.He[u.name].value=h.join("|")}return null;default:m===0?u.name=ee(e[m]):m===1&&(u.description=ee(e[m]));break}this.He[u.name]?this.He[u.name].remote===u.remote&&(this.He[u.name]=u):this.He[u.name]=u;break;case"V":case"VAR":return this.ne.captured.push([]),this.ne.capture++,o=this.Ei(),o.open=!1,o.tag=Ce[t],o.obj=e,o.custom="",this.Ze.push(o),null;case"GAUGE":for(u={value:0,max:1,caption:"",color:0},m=0;m<b;m++)if(a=e[m].split("="),a.length>1)switch(a[0].toUpperCase()){case"VALUE":o=parseFloat(this.Ut(a[1])),isNaN(o)&&(o=this.Ut(a[1])),u.value=o;break;case"MAX":o=parseFloat(this.Ut(a[1])),isNaN(o)&&(o=this.Ut(a[1])),u.max=o;break;case"CAPTION":a[1].length>0&&(u.caption=ee(a[1]));break;case"COLOR":g=new de(ee(a[1])),g.ok&&(u.color=g.toRGB());break}else m===0?(o=parseFloat(this.Ut(e[m])),isNaN(o)&&(o=this.Ut(e[m])),u.value=o):m===1?(o=parseFloat(this.Ut(e[m])),isNaN(o)&&(o=this.Ut(e[m])),u.max=o):m===2&&e[m].length>0?u.caption=ee(e[m]):m===3&&e[m].length>0&&(g=new de(ee(a[1])),g.ok&&(u.color=g.toRGB()));this.ne.expanded=!1,this.emit("gauge",u);break;case"STAT":for(u={value:0,max:1,caption:""},m=0;m<b;m++)if(a=e[m].split("="),a.length>1)switch(a[0].toUpperCase()){case"VALUE":o=parseFloat(this.Ut(a[1])),isNaN(o)&&(o=this.Ut(a[1])),u.value=o;break;case"MAX":o=parseFloat(this.Ut(a[1])),isNaN(o)&&(o=this.Ut(a[1])),u.max=o;break;case"CAPTION":a[1].length>0&&(u.caption=ee(a[1]));break}else m===0?(o=parseFloat(this.Ut(e[m])),isNaN(o)&&(o=this.Ut(e[m])),u.value=o):m===1?(o=parseFloat(this.Ut(e[m])),isNaN(o)&&(o=this.Ut(e[m])),u.max=o):m===2&&e[m].length>0&&(u.caption=ee(e[m]));this.ne.expanded=!1,this.emit("stat",u);break;case"MUSIC":for(u={off:!1,file:"",url:"",volume:100,repeat:1,priority:50,type:"",continue:!0},m=0;m<b;m++)if(a=e[m].split("="),a.length>1)switch(a[0].toUpperCase()){case"FNAME":u.file=ee(a[1]),u.file.toLowerCase()==="off"&&(u.off=!0,u.file="");break;case"V":o=+a[1],isNaN(o)&&(o=100),u.volume=o;break;case"L":o=+a[1],isNaN(o)&&(o=1),u.repeat=o;break;case"C":u.continue=a[1]!=="0";break;case"T":a[1].length>0&&(u.type=a[1]);break;case"U":u.url=ee(a[1]),!u.url.endsWith("/")&&u.url.length>0&&(u.url+="/");break}else m===0?(u.file=ee(e[m]),u.file.toLowerCase()==="off"&&(u.off=!0,u.file="")):m===1?(o=+e[m],isNaN(o)&&(o=100),u.volume=o):m===2?(o=+e[m],isNaN(o)&&(o=1),u.repeat=o):m===3?u.continue=e[m]!=="0":m===4?e[m].length>0&&(u.type=e[m]):m===5&&(u.url=ee(e[m]),!u.url.endsWith("/")&&u.url.length>0&&(u.url+="/"));this.emit("music",u);break;case"SOUND":for(u={off:!1,file:"",url:"",volume:100,repeat:1,priority:50,type:"",continue:!0},m=0;m<b;m++)if(a=e[m].split("="),a.length>1)switch(a[0].toUpperCase()){case"FNAME":u.file=ee(a[1]),u.file.toLowerCase()==="off"&&(u.off=!0,u.file="");break;case"V":o=+a[1],isNaN(o)&&(o=100),u.volume=o;break;case"L":o=+a[1],isNaN(o)&&(o=1),u.repeat=o;break;case"P":o=+a[1],isNaN(o)&&(o=1),u.priority=o;break;case"T":a[1].length>0&&(u.type=a[1]);break;case"U":u.url=ee(a[1]),!u.url.endsWith("/")&&u.url.length>0&&(u.url+="/");break}else m===0?(u.file=ee(e[m]),u.file.toLowerCase()==="off"&&(u.off=!0,u.file="")):m===1?(o=+e[m],isNaN(o)&&(o=100),u.volume=o):m===2?(o=+e[m],isNaN(o)&&(o=1),u.repeat=o):m===3?(o=+e[m],isNaN(o)&&(o=1),u.priority=o):m===4?e[m].length>0&&(u.type=e[m]):m===5&&(u.url=ee(e[m]),!u.url.endsWith("/")&&u.url.length>0&&(u.url+="/"));this.emit("sound",u);break;case"EXPIRE":this.emit("expire-links",e),this.rh(r,e?.[0]||"");break;case"VERSION":b>0?this.StyleVersion=e[0]:this.emit("MXP-tag-reply",t,[]);break;case"USER":case"PASSWORD":this.emit("MXP-tag-reply",t,e);break;case"SUPPORT":if(c=[],b>0)for(m=0;m<b;m++)if(a=ee(e[m]),a.indexOf(".")===-1)switch(a=a.toUpperCase(),a){case"IMAGE":case"HR":case"A":case"SEND":case"B":case"I":case"COLOR":case"C":case"EM":case"ITALIC":case"STRONG":case"BOLD":case"UNDERLINE":case"U":case"S":case"STRIKEOUT":case"STRIKE":case"H":case"HIGH":case"EXPIRE":case"VERSION":case"SUPPORT":case"NOBR":case"P":case"BR":case"SBR":case"SOUND":case"MUSIC":case"VAR":case"USER":case"PASSWORD":case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"RESET":case"GAUGE":case"STAT":c.push("+"+name);break;default:c.push("-"+name);break}else switch(a=e[m].split("."),a[0]=a[0].toUpperCase(),a[0]){case"IMAGE":a[1]!=="*"?c.push("+"+a[0]+"."+a[1]):(c.push("+image.fname"),c.push("+image.url"),c.push("+image.t"),c.push("+image.h"),c.push("+image.w"),c.push("+image.hspace"),c.push("+image.vspace"),c.push("+image.align"),c.push("+image.ismap"));break;case"SOUND":a[1]!=="*"?c.push("+"+a[0]+"."+a[1]):(c.push("+sound.v"),c.push("+sound.l"),c.push("+sound.p"),c.push("+sound.t"),c.push("+sound.u"));break;case"MUSIC":a[1]!=="*"?c.push("+"+a[0]+"."+a[1]):(c.push("+music.v"),c.push("+music.l"),c.push("+music.c"),c.push("+music.t"),c.push("+music.u"));break;case"A":a[1]!=="*"?c.push("+"+a[0]+"."+a[1]):(c.push("+a.href"),c.push("+a.hint"),c.push("+a.expire"));break;case"SEND":a[1]!=="*"?c.push("+"+a[0]+"."+a[1]):(c.push("+send.href"),c.push("+send.hint"),c.push("+send.prompt"),c.push("+send.expire"));break;case"COLOR":a[1]!=="*"?c.push("+"+a[0]+"."+a[1]):(c.push("+color.fore"),c.push("+color.back"));break;case"C":a[1]!=="*"?c.push("+"+a[0]+"."+a[1]):(c.push("+c.fore"),c.push("+c.back"));break;case"FONT":a[1]!=="*"?c.push("+"+a[0]+"."+a[1]):(c.push("-font.face"),c.push("-font.size"),c.push("+font.color"),c.push("+font.back"));break;case"EXPIRE":a[1]!=="*"?c.push("+"+a[0]+"."+a[1]):c.push("+expire.Name");break;case"GAUGE":a[1]!=="*"?c.push("+"+a[0]+"."+a[1]):(c.push("+gauge.max"),c.push("+gauge.caption"),c.push("+gauge.color"));break;case"STAT":a[1]!=="*"?c.push("+"+a[0]+"."+a[1]):(c.push("+stat.max"),c.push("+stat.caption"));break;default:a[1]!=="*"?c.push("-"+a[0]+"."+a[1]):c.push("-"+a[0]);break}else c=["+A","+SEND","+B","+I","+COLOR","+C","+EM","+ITALIC","+STRONG","+BOLD","+UNDERLINE","+U","+S","+STRIKEOUT","+H","+HIGH","-FONT","+EXPIRE","+VERSION","+SUPPORT","+NOBR","+P","+BR","+SBR","+VAR","+SOUND","+MUSIC","+USER","+PASSWORD","+RESET","+STRIKE","+H1","+H2","+H3","+H4","+H5","+H6","+IMAGE","+STAT","+GAUGE"];this.emit("MXP-tag-reply",t,c);break;case"A":for(o=this.Ei(),o.open=!1,o.tag=Ce[t],m=0;m<b;m++)if(a=e[m].split("="),a.length>1)switch(a[0].toUpperCase()){case"HREF":L=ee(a[1]);break;case"HINT":k=ee(a[1]);break;case"EXPIRE":R=ee(a[1]);break;default:this.enableDebug&&this.emit("debug","Invalid Argument for "+t+": "+a[0]);break}else m===0?L=ee(e[m]):m===1?k=ee(e[m]):m===2&&(R=ee(e[m]));return o.custom="",o.properties={formatType:3,href:L,hint:k,expire:R},this.Ze.push(o),k.length===0&&(k=L),{format:{formatType:3,href:L,hint:k,expire:R},text:null};case"SEND":for(o=this.Ei(),o.open=!1,o.tag=Ce[t],m=0;m<b;m++)if(a=e[m].split("="),a[0]==="PROMPT")B=!0;else if(a.length>1)switch(a[0].toUpperCase()){case"HREF":L=ee(a[1]);break;case"HINT":k=ee(a[1]);break;case"EXPIRE":R=ee(a[1]);break;case"PROMPT":B=!0;break;default:this.enableDebug&&this.emit("debug","Invalid Argument for "+t+": "+a[0]);break}else m===0?L=ee(e[m]):m===1?k=ee(e[m]):m===2?B=!0:m===3&&(R=ee(e[m]));o.custom="",this.Ze.push(o),L.length===0&&(L="&text;"),k.length===0&&(k=L);let v=L.split("|"),O;if(v.length>1){let D=k.split("|");D.length===v.length+1&&(k=D[0],D.shift(),O="['"+D.join("','")+"']"),L="['"+v.join("','")+"']"}else L="'"+L+"'";return o.properties={formatType:7,href:L,hint:k,expire:R,prompt:B,tt:O||""},{format:{formatType:7,href:L,hint:k,expire:R,prompt:B,tt:O||""},text:null};case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":return o=this.Ei(),o.open=!0,o.tag=Ce[t],o.style|=1,o.custom="",this.Ze.push(o),null;case"/A":return this.kn(Ce[t.substring(1)]),{format:{formatType:4},text:null};case"/SEND":return this.kn(Ce[t.substring(1)]),{format:{formatType:8},text:null};case"/H1":case"/H2":case"/H3":case"/H4":case"/H5":case"/H6":return this.kn(Ce[t.substring(1)]),null;case"NOBR":return this.ne.noBreak=!0,null;case"/P":return this.kn(Ce[t.substring(1)]),this.ne.paragraph=!1,null;case"P":return o=this.Ei(),o.open=!1,o.tag=Ce[t],o.custom="",this.Ze.push(o),this.ne.paragraph=!0,null;case"SBR":return{format:null,text:" \u200B"};case"RESET":return this.ResetMXP(),null;case"HR":let C=this.Pl(),I=this.Oo(C);return{format:{formatType:0,offset:0,color:I.fore,background:I.back,size:C.fontSize,font:C.font,style:C.style|this.ze&-2,hr:!0},text:null}}if(this.qt[t]){if(u=this.qt[t],!u.open&&this.ne.lineType!==1&&this.ne.lineType!==6&&this.ne.lineType!==4)return null;for(o=this.Ei(),o.open=u.open,o.tag=38,o.custom=u.name,a=u.definition,c={},w=0,E=u.attributeIndexes.length;w<E;w++)c[u.attributeIndexes[w]]=u.attributes[u.attributeIndexes[w]];for(m=0;m<b;m++)h=e[m].split("="),h[0]=h[0].toLowerCase(),u.attributes[h[0]]?c[h[0]]=h[1]:m<u.attributeIndexes.length&&(c[u.attributeIndexes[m]]=h[0]);for(h in c)c.hasOwnProperty(h)&&(a=a.replace("&"+h+";",c[h]));return u.empty||(this.ne.captured.push([]),this.ne.capture++),u.tag>19&&u.tag<100&&this.Ke[u.tag].enabled&&this.Ke[u.tag].definition.length>0&&(a=this.Ke[u.tag].definition+a,o.gagged=this.Ke[u.tag].gag),this.ne.gagged=o.gagged,this.ne.expanded=!0,{format:null,text:a}}else if(t.startsWith("/")&&this.qt[t.substring(1)]&&!this.qt[t.substring(1)].empty)return t=t.substring(1),u=this.qt[t],!u.open&&this.ne.lineType!==1&&this.ne.lineType!==6&&this.ne.lineType!==4||(!u.empty&&this.ne.capture>0&&(this.ne.captured.length>0&&(h=this.ne.captured.pop().join("")),this.ne.capture--),a=u.closeDefinition,u.flag.length>0&&(u.flag.length>4&&u.flag.toLowerCase().startsWith("set ")&&this.emit("set-variable",u.flag.substring(4),h),this.emit("MXP-flag",u.flag,h)),u.tag>19&&u.tag<100&&this.Ke[u.tag].enabled&&this.Ke[u.tag].closeDefinition.length>0&&(a+=this.Ke[u.tag].closeDefinition),this.ne.gagged=!u.gagged,u.empty)?null:(this.ne.expanded=!0,{format:null,text:a});if(this.showInvalidMXPTags){switch(t){case"IMAGE":case"!AT":case"!ATTLIST":case"!TAG":case"!EL":case"!ELEMENT":case"!EN":case"!ENTITY":case"/V":case"/VAR":case"V":case"VAR":case"GAUGE":case"STAT":case"MUSIC":case"SOUND":case"EXPIRE":case"VERSION":case"USER":case"PASSWORD":case"SUPPORT":case"A":case"SEND":case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"/A":case"/SEND":case"/H1":case"/H2":case"/H3":case"/H4":case"/H5":case"/H6":case"NOBR":case"/P":case"P":case"SBR":case"RESET":case"HR":return null}return{format:null,text:"<"+n+">"}}return null}rh(t,e){if(!t||t.length===0||e===null)return;let s=t.length;for(let n=0;n<s;n++){let r=t[n];if(!(r.formatType!==7&&r.formatType!==3)&&(e.length===0||r.expire===e)){let o,a=0,h=0,c=r.formatType;for(r.formatType===3?o=4:o=8,r.formatType=9;h<s;h++)if(t[h].formatType===o)if(a===0){t[h].formatType=10;break}else a--;else t[h]===c&&a++}}}nh(t){if(typeof t>"u"||t.length===0)return"";let e=0,s=t.length,n=[],r=[],o,a=0;for(;e<s;e++)switch(o=t.charAt(e),a){case 1:o===" "?(n.push(r.join("")),r=[],a=2):o===">"?(n.push(r.join("")),r=[],a=0):r.push(o);break;case 2:o===">"&&(a=0);break;default:o==="<"&&(a=1);break}return a===1&&n.push(r.join("")),n.length===0?"":"</"+n.reverse().join("></")+">"}Ei(){let t;return this.Ze.length===0&&this.Ze.push(new Dt(0,"","",!1)),t=this.Ze[this.Ze.length-1],this.Ke[this.ne.lineType]&&this.Ke[this.ne.lineType].enabled&&(t.gagged=this.Ke[this.ne.lineType].gag),Object.assign({},t)}Pl(){let t;return this.Ze.length===0&&this.Ze.push(new Dt(0,"","",!1)),t=this.Ze[this.Ze.length-1],this.Ke[this.ne.lineType]&&this.Ke[this.ne.lineType].enabled&&(t.gagged=this.Ke[this.ne.lineType].gag),t}DecreaseColor(t,e){let s=new de(t);return s.ok?(s.b-=Math.ceil(s.b*e),s.b<0&&(s.b=0),s.g-=Math.ceil(s.g*e),s.g<0&&(s.g=0),s.r-=Math.ceil(s.r*e),s.r<0&&(s.r=0),s.toRGB()):t}IncreaseColor(t,e){let s=new de(t);return s.ok?(s.b+=Math.ceil(s.b*e),s.b>255&&(s.b=255),s.g+=Math.ceil(s.g*e),s.g>255&&(s.g=255),s.r+=Math.ceil(s.r*e),s.r>255&&(s.r=255),s.toRGB()):t}nt(t){if(this.ne.capture<1)return;let e=this.ne.captured.length;for(let s=0;s<e;s++)this.ne.captured[s].push(t)}Go(t){if(this.ne.capture<1)return;let e=this.ne.captured.length;for(let s=0;s<e;s++)for(let n=0;n<t;n++)this.ne.captured[s].pop()}Ao(t){return/^\d+$/.test(t)}CurrentAnsiCode(){let t="\x1B[";return typeof this.At=="string"?t+="38;2;"+this.At:this.At<=-16?t+="38;5;"+(this.At*-1-16)+";":t+=this.At+";",typeof this.Ft=="string"?t+="48;2;"+this.Ft:this.Ft<=-16?t+="38;5;"+(this.Ft*-1-16)+";":t+=this.Ft+";",this.ze>0&&((this.ze&64)===64&&(t+="7;"),(this.ze&1)===1&&(t+="1;"),(this.ze&4)===4&&(t+="3;"),(this.ze&8)===8&&(t+="4;"),(this.ze&16)===16&&(t+="5;"),(this.ze&32)===32&&(t+="6;"),(this.ze&256)===256&&(t+="9;"),(this.ze&2)===2&&(t+="2;"),(this.ze&512)===512&&(t+="21;"),(this.ze&1024)===1024&&(t+="53;")),t+"m"}get parseQueueLength(){return this.Ki.length}get parseQueueEndOfLine(){return this.Ki.length?this.Ki[this.Ki.length-1][0].endsWith(`
`):!1}parse(t,e,s,n){if(t==null||t.length===0)return t;if(e==null&&(e=!1),this.Ki.length>0&&!s){this.Ki.push([t,e,n]);return}let r="",o=null,a=null,h=[],c=[],g=[],m=0,b=0,u=0,E,w=0,L,k,R,B,v,O=!1;this.busy=!0,this.Ki.unshift([t,e,n]);let C;if(this.Me.length>0&&(n?t=t+this.Me:t=this.Me+t,this.Me=""),!this.EndOfLine&&(this.textLength>0||this.rawLength>0)){let T=this.display.lines;T.length>0?(E=this.display.lines[T.length-1].text,B=this.display.lines[T.length-1].raw,c.push.apply(c,this.display.lines[T.length-1].formats),this.display.removeLine(T.length-1,!0),C=c[c.length-1],C.formatType===1&&(c.pop(),C=c[c.length-1]),C.width=0,C.height=0,C.marginWidth=0,C.marginHeight=0,u=C.offset,C.offset!==0?(h.push(E.substring(0,C.offset)),E=E.substring(C.offset),(this.ne.locked||this.ne.on)&&(w=E.length),t=E+t):((this.ne.locked||this.ne.on)&&(w=E.length),t=E+t),B.endsWith(E)?g.push(B.substr(0,B.length-E.length)):g.push(B)):c.push(C=this.Mt(u)),T=null}else c.push(C=this.Mt(u));let I=0,D=t.length,S,M,q=this.emulateControlCodes,Q=this.displayControlCodes,W=this.emulateTerminal,ne=this.enableURLDetection,V=this.enableMSP,N=this.tabWidth,G=0,K=0,Y=0,P=0,Z=null,H,oe=this.Dr.length;try{for(I=0;I<D;I++)switch(S=t.charAt(I),M=t.charCodeAt(I),I>=w&&g.push(S),this.rawLength++,m){case 2:if(S==="C"||S==="K"||S==="s"||S==="u"||S==="l"||S==="h"||S==="A"||S==="B"||S==="D"||S==="E"||S==="F"||S==="f"||S==="G"||S==="H"||S==="n"||S==="S"||S==="T"||S==="r")this.ti(),this.Me="",a=null,m=0;else if(S==="z"){L=a.split(";"),a=0;for(let T=L.length-1;T>=0;T--)if(L[T].length>0){a=L[0];break}switch(E=+a,isNaN(E)&&(E=0),this.ne.on=!0,this.ne.noBreak=!1,this.ne.paragraph=!1,this.ne.lineType===0&&this.ti(),E){case 2:this.ne.on=!1,this.ne.locked=!1,this.ne.lineType=2,this.ti();break;case 3:this.ResetMXP();break;case 4:if(this.ne.lineType=4,I+1>=D){this.Me+=S;break}t.charAt(I+1)!=="<"&&(this.ne.lineType=0,this.ne.on=!1),this.ne.locked=!1,this.ti();break;case 5:this.qn=0,this.ne.locked=!0,this.ne.lineType=5,this.ti();break;case 6:this.qn=1,this.ne.lineType=6,this.ne.locked=!0,this.ti();break;case 7:this.qn=2,this.ne.lineType=7,this.ne.locked=!0,this.ti();break;default:E<0||E>99?this.ti():(this.ne.lineType=E,this.ne.locked=!1,this.Ke[this.ne.lineType]&&this.Ke[this.ne.lineType].enabled&&(E="",this.Ke[this.ne.lineType].element.length>0&&(E+="<"+this.Ke[this.ne.lineType].element+">"),this.Ke[this.ne.lineType].definition.length>0&&(E+=this.Ke[this.ne.lineType].definition),E.length>0&&(t=t.splice(I+1,E),D=t.length)));break}this.Me="",a=null,m=0}else if(S==="J"){if(this.ti(),a.length>0&&+a==2){u=0,E=this.window.height,c.push(...this.Rs()),this.Vs(h.join(""),g.join(""),!1,!1,c,e),h=[],g=[],c=[...this.Ji(),C=this.Mt(u),...this.Rs()];for(let T=0;T<E;T++)this.Vs("",`
`,!1,!1,c,e),this.nt(`
`);this.textLength+=E,this.ne.noBreak=!1}c=[...this.Ji(),C=this.Mt(u)],this.Me="",a=null,m=0}else S==="m"?(this.sh(a.split(";")),c.push(C=this.Mt(u)),this.Me="",a=null,m=0):S===`
`||S==="\x1B"?(I--,g.pop(),this.rawLength--,m=0,this.Me="",this.ne.on&&S===`
`&&this.ti()):(this.Me+=S,a+=S);break;case 3:M===7?(this.Me="",this.emit("set-title",r,o??0),r="",o=null,m=0):S===";"&&o==null?(o=+r,isNaN(o)&&(o=0),r="",this.Me+=S):S==="\x1B"?this.Me.charAt(this.Me.length-1)===`
`&&(this.Me=""):(this.Me+=S,r+=S);break;case 1:S==="["?(this.Me+=S,a="",m=2):S==="]"?(this.Me+=S,r="",m=3):(S==="D"||S==="E"||S==="M"||S==="1"||S==="2"||S==="7"||S==="8"||S===">"||S==="="||S==="#")&&(Q&&(h.push("\u241B"),M<16?(h.push(String.fromCharCode(parseInt("240"+M.toString(16),16))),this.nt("&#x241B&#x240"+M.toString(16)+";")):(h.push(String.fromCharCode(parseInt("24"+M.toString(16),16))),this.nt("&#x241B&#x24"+M.toString(16)+";")),u+=2,this.textLength+=2,this.ne.noBreak=!1),m=0,this.Me="");break;case 4:if(L==="!--")I--,g.pop(),this.rawLength--,b=0,m=8,B="<!--",L="",v=[];else if(L.endsWith("<!--"))I--,g.pop(),this.rawLength--,b=m,m=8,B="<!--",L=L.substring(0,L.length-4),v=[];else if(S==='"')m=6,v[v.length-1]+=S,this.Me+=S;else if(S==="'")m=5,v[v.length-1]+=S,this.Me+=S;else if(S==="&")R="",b=m,m=7,this.Me="";else if(S===`
`||S==="\x1B")I--,g.pop(),this.rawLength--,m=0,this.Me="",this.ne.on&&S===`
`&&this.ti();else if(S===" ")m=9,v.push(""),this.Me+=S;else if(S===">"){if(k=L,L=L.toUpperCase(),L==="HR"&&(this.ne.lineType===1||this.ne.lineType===6||this.ne.lineType===4))u>0&&(u=0,this.nt(`
`),c.push(...this.Rs()),this.Vs(h.join(""),g.join(""),!1,!1,c,e),h=[],g=[],c=[...this.Ji(),C=this.Mt(u)]),L=this.Ks(L,[],e),L&&L.format&&(L.format.offset=u,c.push(L.format),c[0].hr=L.format.hr),c.push(...this.Rs()),this.Vs(h.join(""),g.join(""),!1,!1,c,e),this.textLength++,h=[],g=[],c=[...this.Ji(),C=this.Mt(u)];else if(L==="BR"&&(this.ne.lineType===1||this.ne.lineType===6||this.ne.lineType===4))this.nt(`
`),c.push(...this.Rs()),this.Vs(h.join(""),g.join(""),!1,!1,c,e),O=!1,u=0,h=[],g=[],c=[...this.Ji(),C=this.Mt(u)],this.textLength++;else if(L==="IMAGE"&&(this.ne.lineType===1||this.ne.lineType===6||this.ne.lineType===4))L=this.Ks(L,v,e),L&&L.format!==null&&(c.push(L.format),u+=L.length,this.textLength+=L.length),c.push(C=this.Mt(u));else{if(L=this.Ks(L,[],e,k,c),this.ne.expanded){L&&L.text!==null&&(t=t.splice(I+1,L.text)),D=t.length,this.ne.expanded=!1,m=0,L="",this.Me="";continue}L?(L.format&&(L.format.offset=u,c.push(L.format)),c.push(C=this.Mt(u)),L.text!==null&&L.text.length>0&&(h.push(L.text),u+=L.text.length,this.textLength+=L.text.length)):c.push(C=this.Mt(u))}m=0,this.Me=""}else S==="<"?(this.enableDebug&&this.emit("debug","Malformed MXP Tag: "+L),I--,g.pop(),this.rawLength--,h.push("<"+L),u+=L.length+1,this.textLength+=L.length+1,m=0,this.Me=""):(this.Me+=S,L+=S);break;case 5:S==="'"?(m=9,this.Me+=S,v[v.length-1]+=S):(this.Me+=S,v[v.length-1]+=S);break;case 6:S==='"'?(m=9,this.Me+=S,v[v.length-1]+=S):(this.Me+=S,v[v.length-1]+=S);break;case 9:if(S==="'")m=5,v[v.length-1]+=S,this.Me+=S;else if(S==='"')m=6,v[v.length-1]+=S,this.Me+=S;else if(S===`
`||S==="\x1B")I--,g.pop(),this.rawLength--,m=0,this.Me="",this.ne.on&&S===`
`&&this.ti();else if(S===" ")m=9,v.push(""),this.Me+=S;else if(S===">"){if(L.toUpperCase()==="IMAGE"&&(this.ne.lineType===1||this.ne.lineType===6||this.ne.lineType===4))L=this.Ks(L,v,e,L),L!==null&&L.format!==null&&(L.format.offset=u,c.push(L.format)),c.push(C=this.Mt(u));else{if(L=this.Ks(L,v,e,L,c),this.ne.expanded){L!==null&&(t=t.splice(I+1,L.text)),D=t.length,this.ne.expanded=!1,m=0,this.Me="";continue}L!==null?(L!==null&&L.format&&(L.format.offset=u,c.push(L.format)),c.push(C=this.Mt(u)),L.text!==null&&(h.push(L.text),u+=L.text.length,this.textLength+=L.text.length)):c.push(C=this.Mt(u))}m=0,this.Me=""}else this.Me+=S,v[v.length-1]+=S;break;case 7:if(S===`
`||S==="\x1B"){if(I--,g.pop(),this.rawLength--,this.enableDebug&&this.emit("debug","MXP Entity: "+R),b===4)L+="&"+R,m=b;else{if(R=this.Ut(R),this.ne.expanded){L!==null&&(t=t.splice(I+1,R)),D=t.length,this.ne.expanded=!1,m=0,this.Me="";continue}k=Pi("&"+R),h.push(k),this.nt("&"+R),u+=k.length,this.textLength+=k.length,this.ne.noBreak=!1,m=0,this.Me="",C.unicode=!0}this.ne.on&&S===`
`&&this.ti()}else if(S===";"){if(this.enableDebug&&this.emit("debug","MXP Entity: "+R),b!==4){if(R=this.Ut(R),this.ne.expanded){t=t.splice(I+1,R),D=t.length,this.ne.expanded=!1,m=b,this.Me="";continue}k=Pi("&"+R+";"),h.push(k),this.nt("&"),this.nt(R),this.nt(";"),u+=k.length,this.textLength+=k.length,this.ne.noBreak=!1,this.Me=""}else L+="&"+R+";";C.unicode=!0,m=b}else S==="&"?(this.enableDebug&&this.emit("debug","Malformed MXP Entity: "+R),b!==4?(h.push("&"+R),this.nt("&"),this.nt(R),u+=R.length+1,this.textLength+=R.length+1,this.ne.noBreak=!1,this.Me="",I--,g.pop(),this.rawLength--):L+="&"+R,C.unicode=!0,m=b):(this.Me+=S,R+=S);break;case 8:B.endsWith("-->")?(this.enableDebug&&this.emit("debug","MXP Comment: "+B),I--,g.pop(),this.rawLength--,m=b,m===0&&(this.Me=""),B=""):S===`
`||S==="\x1B"?(this.enableDebug&&this.emit("debug","MXP Comment: "+B),I--,g.pop(),this.rawLength--,m=b,B="",this.ne.on&&S===`
`&&this.ti()):B+=S;break;case 10:if(I>G+2)h.pop(),h.pop(),g.pop(),g.pop(),this.rawLength-=2,u-=2,this.textLength-=2,this.Go(2),I=G,m=0;else if(S==="/"){if(h.push(S),this.nt(S),u++,this.textLength++,I===G+2){for(m=11,G=h.length-4,P=h.length-1,K=c.length,Y-=2;G>0&&ei(h[G],!0);)G--,Y--;ei(h[G],!0)||(G++,Y++),Z=[],G>0&&h[G-1]==="("&&Z.push(")"),G>0&&h[G-1]==="["&&Z.push("]")}}else I>G+1?(h.pop(),g.pop(),this.rawLength--,u--,this.textLength--,this.Go(1),I=G,m=0):(I=G,m=0,g.pop(),this.rawLength--);break;case 11:ei(S,!1)?Z.length>1&&Z[Z.length-1]===S?(Z.pop(),h.push(S),this.nt(S),u++,this.textLength++,M>255&&(C.unicode=!0)):Z.length>0&&S==="("?(Z.push(")"),h.push(S),this.nt(S),u++,this.textLength++,M>255&&(C.unicode=!0)):Z.length>0&&S==="["?(Z.push("]"),h.push(S),this.nt(S),u++,this.textLength++,M>255&&(C.unicode=!0)):Z.length===1&&Z[Z.length-1]===S?(P!==h.length-1&&(B+=h.slice(G).join(""),this.enableDebug&&this.emit("debug","URL Found: "+B),c.splice(K,0,{formatType:1,href:B,offset:Y}),c.push({formatType:2,href:B,offset:u}),c.push(C=this.Mt(u))),m=0,I--,g.pop(),this.rawLength--):(M>255&&(C.unicode=!0),h.push(S),this.nt(S),u++,this.textLength++):(P!==h.length-1&&(B+=h.slice(G).join(""),this.enableDebug&&this.emit("debug","URL Found: "+B),c.splice(K,0,{formatType:1,offset:Y,href:B}),c.push({formatType:2,offset:u,href:B}),c.push(C=this.Mt(u))),m=0,I--,g.pop(),this.rawLength--);break;case 12:S===")"?(G=this.ne.lineType,this.ne.lineType=4,this.Ks("SOUND",v,e),this.ne.lineType=G,m=0,I+1<D&&t.charAt(I+1)===`
`?(I++,O=!1,h=[],c=[...this.Ji(),C=this.Mt(u)],this.ne.noBreak=!1,u=0):I+2<D&&t[I+1]==="\r"&&t[I+2]===`
`&&(I+=2,O=!1,h=[],c=[...this.Ji(),C=this.Mt(u)],this.ne.noBreak=!1,u=0)):S===" "?v.push(""):v[v.length-1]+=S;break;case 13:S===")"?(G=this.ne.lineType,this.ne.lineType=4,this.Ks("MUSIC",v,e),this.ne.lineType=G,m=0,I+1<D&&t.charAt(I+1)===`
`?(I++,O=!1,h=[],c=[...this.Ji(),C=this.Mt(u)],this.ne.noBreak=!1,u=0):I+2<D&&t[I+1]==="\r"&&t[I+2]===`
`&&(I+=2,O=!1,h=[],c=[...this.Ji(),C=this.Mt(u)],this.ne.noBreak=!1,u=0)):S===" "?v.push(""):v[v.length-1]+=S;break;default:if(q&&M===7)W?(S="\u2407",h.push(S),this.nt(S),u++,this.textLength++,this.ne.noBreak=!1):Q&&(h.push(S),this.nt("&#x2407;"),u++,this.textLength++,this.ne.noBreak=!1),this.emit("bell");else if(q&&S==="\b"){if(O=!1,u>0){if(h.length){for(;h[h.length-1].length===0;)h.pop();h[h.length-1].length===1?h.pop():h[h.length-1]=h[h.length-1].substring(0,h[h.length-1].length-1)}C.offset===u&&C.offset--,u--,this.textLength--}Q&&(S="\u25D8",h.push(S),this.nt(S),u++,this.textLength++),this.ne.noBreak=!1}else if(q&&S==="	"){let T=N-u%N;T>0&&(h.push(Array(T+1).join(" ")),this.nt(Array(T+1).join(" ")),u+=T,this.textLength+=T,this.ne.noBreak=!1)}else if(S===`
`){if(this.ne.noBreak||this.ne.paragraph)continue;if(this.ne.locked)c.push(...this.Rs()),this.ne.on&&this.ti();else{if(this.ne.lineType!==0&&this.emit("MXP-tag-end",this.ne.lineType,h.join(""),c),!this.ne.lineExpanded&&this.Ke[this.ne.lineType]&&this.Ke[this.ne.lineType].enabled&&(E="",this.Ke[this.ne.lineType].element.length>0&&(E+="</"+this.Ke[this.ne.lineType].element+">"),this.Ke[this.ne.lineType].closeDefinition.length>0&&(E+=this.Ke[this.ne.lineType].closeDefinition),E.length>0)){t=t.splice(I,E),D=t.length,I--,g.pop(),this.rawLength--,this.ne.lineExpanded=!0;continue}this.ne.lineExpanded=!1,c.push(...this.Rs()),this.ne.on&&this.ti(),this.ne.on=!1,this.Ke[this.ne.lineType]&&this.Ke[this.ne.lineType].enabled&&this.Ke[this.ne.lineType].gag&&(O=!0),this.ne.lineType=this.qn,this.ne.lineType!==2&&!this.enableMXP&&this.ResetMXP()}u=0,O||this.nt(`
`),this.Vs(h.join(""),g.join(""),!1,O,c,e),O=!1,h=[],g=[],c=[...this.Ji(),C=this.Mt(u)],this.textLength++,this.ne.noBreak=!1}else{if(q&&S==="\r")continue;if(q&&S==="\x1B")this.Me+=S,m=1;else if(M<32||M===127)if(W)M===1?S="\u263A":M===2?S="\u263B":M===3?S="\u2665":M===4?S="\u2666":M===5?S="\u2663":M===6?S="\u2660":M===7?S="\u2407":M===8?S="\u25D8":M===9?S="\u25CB":M===10?S="\u25D9":M===11?S="\u2642":M===12?S="\u2640":M===13?S="\u266A":M===14?S="\u266B":M===15?S="\u263C":M===16?S="\u25BA":M===17?S="\u25C4":M===18?S="\u2195":M===19?S="\u203C":M===20?S="\xB6":M===21?S="\xA7":M===22?S="\u25AC":M===23?S="\u21A8":M===24?S="\u2191":M===25?S="\u2193":M===26?S="\u2192":M===27?S="\u2190":M===28?S="\u221F":M===29?S="\u2194":M===30?S="\u25B2":M===31?S="\u25BC":M===127&&(S="\u2302"),h.push(S),this.nt(S),u++,this.textLength++,this.ne.noBreak=!1;else if(Q)M=9216+M,h.push(String.fromCharCode(M)),this.nt("&#"),this.nt(M.toString()),this.nt(";"),u++,this.textLength++,this.ne.noBreak=!1;else continue;else if(S===" "||this.ze>0&&(this.ze&128)===128)h.push(" "),this.nt(" "),u++,this.textLength++,this.ne.noBreak=!1;else if(S==="<"&&I>=w)this.enableMXP&&this.ne.on?(L="",v=[],this.Me+=S,m=4):(h.push("<"),this.nt("&lt;"),u++,this.textLength++);else if(S===">")h.push(">"),this.nt("&gt;"),u++,this.textLength++,this.ne.noBreak=!1;else if(S==="&"&&I>=w)this.enableMXP&&this.ne.on?(R="",this.Me+=S,b=m,m=7):(h.push(S),u++,this.textLength++,this.ne.noBreak=!1);else if(S==='"')h.push(S),this.nt("&quot;"),u++,this.textLength++,this.ne.noBreak=!1;else if(S==="'")h.push(S),this.nt("&apos;"),u++,this.textLength++,this.ne.noBreak=!1;else if(S===":"){if(h.push(S),this.nt(S),u++,this.textLength++,this.ne.noBreak=!1,ne){B="";let T,fe=!1;for(H=0;H<oe;H++){if(I-this.Dr[H].length<0)continue;T=!1;let X=this.Dr[H].length;for(let U=0;U<X;U++)if(t[I-(X-U)]!==this.Dr[H][U]){T=!0;break}if(!T&&(G=h.length,Y=u,K=c.length,!(G>1+X&&h[G-(2+X)].length===1&&/\S/.test(h[G-(2+X)])&&h[G-(2+X)]!=="("&&h[G-(2+X)]!=="[")&&(Z=[],G=h.length-(1+X),Y-=1+X,P=h.length-1,G>0&&h[G-1]==="("&&Z.push(")"),G>0&&h[G-1]==="["&&Z.push("]"),m=11,fe=!0,fe)))break}fe||(m=10,G=I,Y=u)}}else if(S==="."){if(h.push(S),this.nt(S),u++,this.textLength++,this.ne.noBreak=!1,ne&&I-3>=0&&(B="http://",(t[I-1]==="w"||I[G-1]==="W")&&(t[I-2]==="w"||I[G-2]==="W")&&(t[I-3]==="w"||I[G-3]==="W"))){if(G=h.length,Y=u,K=c.length,G>4&&h[G-5].length===1&&/\S/.test(h[G-5])&&h[G-5]!=="("&&h[G-5]!=="[")continue;Z=[],G=h.length-4,Y-=4,P=h.length-1,G>0&&h[G-1]==="("&&Z.push(")"),G>0&&h[G-1]==="["&&Z.push("]"),m=11}}else V&&u===0&&t.substring(I,I+8)==="!!MUSIC("?(v=[""],m=13,I+=7,this.ne.noBreak=!1):V&&u===0&&t.substring(I,I+8)==="!!SOUND("?(v=[""],m=12,I+=7,this.ne.noBreak=!1):(W&&M>127&&M<255?M===128?S="\xC7":M===129?S="\xFC":M===130?S="\xE9":M===131?S="\xE2":M===132?S="\xE4":M===133?S="\xE0":M===134?S="\xE5":M===135?S="\xE7":M===136?S="\xEA":M===137?S="\xEB":M===138?S="\xE8":M===139?S="\xEF":M===140?S="\xEE":M===141?S="\xEC":M===142?S="\xC4":M===143?S="\xC5":M===144?S="\xC9":M===145?S="\xE6":M===146?S="\xC6":M===147?S="\xF4":M===148?S="\xF6":M===149?S="\xF2":M===150?S="\xFB":M===151?S="\xF9":M===152?S="\xFF":M===153?S="\xD6":M===154?S="\xDC":M===155?S="\xA2":M===156?S="\xA3":M===157?S="\xA5":M===158?S="\u20A7":M===159?S="\u0192":M===160?S="\xE1":M===161?S="\xED":M===162?S="\xF3":M===163?S="\xFA":M===164?S="\xF1":M===165?S="\xD1":M===166?S="\xAA":M===167?S="\xBA":M===168?S="\xBF":M===169?S="\u2310":M===170?S="\xAC":M===171?S="\xBD":M===172?S="\xBC":M===173?S="\xA1":M===174?S="\xAB":M===175?S="\xBB":M===176?S="\u2591":M===177?S="\u2592":M===178?S="\u2593":M===179?S="\u2502":M===180?S="\u2524":M===181?S="\u2561":M===182?S="\u2562":M===183?S="\u2556":M===184?S="\u2555":M===185?S="\u2563":M===186?S="\u2551":M===187?S="\u2557":M===188?S="\u255D":M===189?S="\u255C":M===190?S="\u255B":M===191?S="\u2510":M===192?S="\u2514":M===193?S="\u2534":M===194?S="\u252C":M===195?S="\u251C":M===196?S="\u2500":M===197?S="\u253C":M===198?S="\u255E":M===199?S="\u255F":M===200?S="\u255A":M===201?S="\u2554":M===202?S="\u2569":M===203?S="\u2566":M===204?S="\u2560":M===205?S="\u2550":M===206?S="\u256C":M===207?S="\u2567":M===208?S="\u2568":M===209?S="\u2564":M===210?S="\u2565":M===211?S="\u2559":M===212?S="\u2558":M===213?S="\u2552":M===214?S="\u2553":M===215?S="\u256B":M===216?S="\u256A":M===217?S="\u2518":M===218?S="\u250C":M===219?S="\u2588":M===220?S="\u2584":M===221?S="\u258C":M===222?S="\u2590":M===223?S="\u2580":M===224?S="\u03B1":M===225?S="\u03B2":M===226?S="\u0393":M===227?S="\u03C0":M===228?S="\u03A3":M===229?S="\u03C3":M===230?S="\xB5":M===231?S="\u03C4":M===232?S="\u03A6":M===233?S="\u0398":M===234?S="\u03A9":M===235?S="\u03B4":M===236?S="\u221E":M===237?S="\u2205":M===238?S="\u2208":M===239?S="\u2229":M===240?S="\u2261":M===241?S="\xB1":M===242?S="\u2265":M===243?S="\u2264":M===244?S="\u2320":M===245?S="\u2321":M===246?S="\xF7":M===247?S="\u2248":M===248?S="\xB0":M===249?S="\u2219":M===250?S="\xB7":M===251?S="\u221A":M===252?S="\u207F":M===253?S="\xB2":M===254&&(S="\u25A0"):M>255&&(C.unicode=!0),h.push(S),this.nt(S),u++,this.textLength++,this.ne.noBreak=!1)}break}this.Me.length&&(this.rawLength-=this.Me.length,g.splice(g.length-this.Me.length,this.Me.length)),c.push(...this.Rs()),m===11&&c.splice(K,0,{formatType:1,offset:Y,href:B+=h.slice(G).join("")}),this.Vs(h.join(""),g.join(""),!0,!1,c,e)}catch(T){this.enableDebug&&this.emit("debug",T)}this.busy=!1,this.emit("parse-done"),this.Ki.shift(),this.Ki.length>0&&setTimeout(this.lh(),0)}lh(){let t=this.Ki.shift();return()=>{this.parse(t[0],t[1],!0,t[2])}}updateWindow(t,e){this.window={width:t,height:e}}Clear(){this.Bo(),this.textLength=0,this.Me=""}ClearMXP(){this.He={},this.ResetMXP(),this.qt={},this.ne=new oi}ResetMXP(){this.Ze=[],this.Ze.push(new Dt(0,"","",!1))}ResetMXPLine(){this.qn=0,this.ne.lineType=0}GetPublicEntity(t){return this.He[t]&&this.He[t].publish?this.He[t].value:t}};var st=class extends me{constructor(t,e){super();this.Ye=0;this.Sn=!1;this.Bl=0;this.bi=[0,0,0,0];this.Kn=!0;this.Ar=!0;this.Jn=!0;this.hs=500;this.En=!1;this.Ln=4;this.Nl=0;this.cs=0;this.splitLive=!1;this.Qn=!1;this.Js=[];this._n=[];this.Fi=0;this.Qs="[[]MM-DD HH:mm:ss.SSS[]] ";this._s=new Date().toISOString().length+1;this.yi=0;this.ls=!1;this.Re={start:null,end:null,timer:null};this.vt={down:null,up:null};this.zl=!0;if(!t)throw new Error("Container must be a selector, element, jquery object or display options");if(typeof t=="object"&&"container"in t&&(e=Object.assign(e||{},t),t=e.container,delete e.container),typeof t=="string"){if(this.Ie=document.querySelector(t),!this.Ie)throw new Error("Invalid selector for display.")}else if(t instanceof $)this.Ie=t[0];else if(t instanceof HTMLElement)this.Ie=t;else if(t.ownerDocument.defaultView&&t instanceof t.ownerDocument.defaultView.HTMLElement)this.Ie=t;else throw new Error("Container must be a selector, element or jquery object");this.ue=this.Ie.ownerDocument,this.ae=this.ue.defaultView,this.Ie.tabIndex=-1,this.Ie.classList.add("display"),this.Fl=s=>{this.customSelection&&s.preventDefault()},this.Ie.addEventListener("dragstart",this.Fl.bind(this)),this.Ie.display=this,this.$i=this.ue.createElement("style"),this.Ie.appendChild(this.$i),this.ai=this.ue.createElement("span"),this.ai.id=this.id+"-Character",this.ai.className="line",this.ai.innerHTML='<span style="border-bottom: 1px solid rgb(0, 0, 0);">W</span>',this.ai.style.visibility="hidden",this.Ie.appendChild(this.ai),this.ie=this.ue.createElement("div"),this.ie.className="view",this.ie.addEventListener("scroll",()=>{this.Qn=this.ie.clientHeight+this.ie.scrollTop>=this.ie.scrollHeight,this.De(128)}),this.ie.addEventListener("click",s=>{this.emit("click",s)}),this.ie.addEventListener("contextmenu",s=>{this.emit("contextmenu",s)}),this.ie.addEventListener("mousedown",s=>{this.Ie.focus(),this.emit("mousedown",s);let n=this.hi,r=n.width-this.ie.clientWidth,o=n.height-this.ie.clientHeight;if(s.button===0&&s.pageX<n.right-r&&s.pageY<n.bottom-o)this.customSelection&&(s.shiftKey?this.vt.down&&s.shiftKey?this.Qi(s):this.Zl(s):(this.clearSelection(),this.Zl(s))),this.yi=1,this.oe&&(this.oe.Gt.style.pointerEvents="none");else if(this.customSelection&&s.button===2&&this.vt.down){this.Re.start||this.Bs();let a=this.Cn(s),h=this.ue.createRange();h.setStart(this.Re.start.node,this.Re.start.offset),h.setEnd(this.Re.end.node,this.Re.end.offset),a.offsetNode&&h.intersectsNode(a.offsetNode)||a.startContainer&&h.intersectsNode(a.startContainer)?s.shiftKey?this.Qi(s):this.Bs():s.shiftKey?this.Qi(s):this.clearSelection()}}),this.ie.addEventListener("mousemove",s=>{this.as=s,this.yi&&(this.Qi(s),this.Gr())}),this.ie.addEventListener("mouseup",s=>{this.yi===2&&this.ie.click(),s.button===0&&this.tr(s),this.emit("mouseup",s)}),this.ie.addEventListener("mouseenter",s=>{this.yi&&(s.buttons&1)!==1?this.tr(s):this.Yl()}),this.ie.addEventListener("mouseleave",s=>{this.yi&&(this.as=s,this.customSelection&&this.ie.lastChild&&s.pageY>=this.hi.bottom-this.en&&(this.vt.up=this.Cn(s)||this.ue.createRange(),this.vt.up.setStart(this.ie.lastChild,this.ie.lastChild.childNodes.length),this.vt.up.setEnd(this.ie.lastChild,this.ie.lastChild.childNodes.length),this.Bs()),this.Gr())}),this.Ie.appendChild(this.ie),this.Bi=parseFloat(this.ae.getComputedStyle(this.ai).height),this.Li=parseFloat(this.ae.getComputedStyle(this.ai.firstElementChild).width),e?e.display=this:e={display:this},this.model=new Fi(e),this.Dl=s=>{this.Qn&&this.scrollDisplay(),ve(()=>{this.De(81)},250,this.id+"resize")},this.Wl=s=>{this.ae.getSelection().rangeCount&&this.ae.getSelection().getRangeAt(0)},this.Al=s=>{this.yi&&s.button===0&&(this.as=s,this.tr(s))},this.Gl=s=>{this.yi&&(this.as=s)},this.ae.addEventListener("resize",this.Dl.bind(this)),this.ae.addEventListener("mouseup",this.Al.bind(this)),this.ae.addEventListener("mousemove",this.Gl.bind(this)),this.ue.addEventListener("selectionchange",this.Wl.bind(this)),this.Ps=new ResizeObserver((s,n)=>{s.length!==0&&(!s[0].contentRect||s[0].contentRect.width===0||s[0].contentRect.height===0||(ve(()=>{(!this.Ii||this.Ii.width!==s[0].contentRect.width||this.Ii.height!==s[0].contentRect.height)&&(this.Qn&&this.scrollDisplay(),this.Ii={width:s[0].contentRect.width,height:s[0].contentRect.height},this.De(81))},250,this.id+"resize"),this.Uo(),this.emit("resize")))}),this.Ps.observe(this.Ie),this.Os=new MutationObserver(s=>{let n;for(n of s)n.type==="attributes"&&n.attributeName==="style"&&(this.Qn&&this.scrollDisplay(),this.De(81),this.emit("resize"))}),this.Os.observe(this.Ie,{attributes:!0,attributeOldValue:!0,attributeFilter:["style"]}),!moment||this.Fi!==2?this._s=new Date().toISOString().length+1:this._s=moment().format(this.Qs).length,this.updateFont(),this.hi=this.ie.getBoundingClientRect(),this.Hl=Zt(),this.$l=Zt(),this.splitHeight=-1}get en(){return this.ie.scrollWidth>this.ie.clientWidth?this.Hl:0}get er(){return this.$l}get customSelection(){return this.zl||this.oe}set customSelection(t){t!==this.zl&&(this.zl=t,!t&&this.Re.timer&&(this.ae.clearTimeout(this.Re.timer),this.Re.timer=null),t||this.oe?this.Ie.style.userSelect="none":this.Ie.style.userSelect="",this.In())}get scrollLock(){return this.ls}set scrollLock(t){this.ls!==t&&(this.ls=t,!this.ls&&this.oe&&this.oe.visible?this.scrollDisplay(!0):this.ls&&this.oe&&!this.oe.visible&&this.scrollUp())}get showTimestamp(){return this.Fi}set showTimestamp(t){t!==this.Fi&&(typeof t=="boolean"&&(this.Fi=t?2:0),this.Fi=t,!moment||this.Fi!==2?this._s=new Date().toISOString().length+1:this._s=moment().format(this.Qs).length,this.tn(),this.De(99))}get timestampFormat(){return this.Qs}set timestampFormat(t){this.Qs!==t&&(this.Qs=t,!moment||this.Fi!==2?this._s=new Date().toISOString().length+1:this._s=moment().format(this.Qs).length,this.De(115))}get wordWrap(){return this.En}set wordWrap(t){t!==this.En&&(this.En=t,this.tn(),this.De(65))}get wrapAt(){return this.cs}set wrapAt(t){t!==this.cs&&(this.cs=t,this.tn(),this.De(67))}get indent(){return this.Ln}set indent(t){t!==this.Ln&&(this.Ln=t,this.tn(),this.De(67))}get splitHeight(){return this.ps}set splitHeight(t){this.ps!==t&&(this.ps=t,this.hi.height-=this.en-this.bi[2],this.ps<=this.hi.top+150?this.ps=150:this.ps>this.hi.bottom-150&&(this.ps=this.hi.height-150),this.Ul())}get enableSplit(){return this.oe===null}set enableSplit(t){let e=this.id;!this.oe&&t?(this.oe={ie:document.createElement("div"),Gt:document.createElement("div"),visible:!1},this.oe.ie.id=e+"-split-view",this.oe.ie.classList.add("view","display-split-view"),this.oe.ie.style.right=this.er+"px",this.oe.Gt.id=e+"-split-bar",this.oe.Gt.classList.add("display-split-bar","user-select-none"),this.ie.insertAdjacentElement("afterend",this.oe.ie),this.Ie.insertAdjacentElement("afterbegin",this.oe.Gt),this.Ul(),this.oe.Gt.style.right=this.er+"px",this.oe.Gt.style.top=this.ie.clientHeight-this.oe.ie.clientHeight-this.en+"px",this.oe.Gt.addEventListener("mousedown",s=>{if(s.buttons!==1)return;s.preventDefault(),s.cancelBubble=!0,this.oe.ghostBar=document.createElement("div"),this.oe.ghostBar.id=e+"-split-ghost-bar",this.oe.ghostBar.classList.add("display-split-ghost-bar"),this.oe.ghostBar.style.top=this.oe.Gt.style.top,this.oe.ghostBar.style.display="block",this.oe.ghostBar.style.right=this.er+"px",this.Ie.appendChild(this.oe.ghostBar);let n=this.hi;n.height-=this.en-this.bi[2],this.oe.mouseMove=r=>{if(r.preventDefault(),r.cancelBubble=!0,r.stopPropagation(),r.pageY<n.top+150?this.oe.ghostBar.style.top="150px":r.pageY>n.bottom-150?this.oe.ghostBar.style.top=n.height-150+"px":this.oe.ghostBar.style.top=r.pageY-n.top+"px",this.splitLive){let o;r.pageY<n.top+150?o=150:r.pageY>n.bottom-150?o=n.height-150:o=r.pageY-n.top,this.oe.ie.style.top=o+"px",this.oe.Gt.style.top=this.ie.clientHeight-this.oe.ie.clientHeight+"px",this.oe.ie.scrollTop=this.oe.ie.scrollHeight,this.emit("split-move",o)}},this.Ie.addEventListener("mousemove",this.oe.mouseMove),this.Ie.addEventListener("mouseup",this.oe.moveDone)}),this.oe.moveDone=s=>{if(this.oe.ghostBar){let n=this.hi;n.height-=this.en-this.bi[2];let r;s.pageY<n.top+150?r=150:s.pageY>n.bottom-150?r=n.height-150:r=s.pageY-n.top,this.oe.ie.style.top=r+"px",this.oe.Gt.style.top=this.ie.clientHeight-this.oe.ie.clientHeight+"px",this.oe.ie.scrollTop=this.oe.ie.scrollHeight,this.ps=r,this.Ie.removeChild(this.oe.ghostBar),delete this.oe.ghostBar,this.emit("split-move-done",r)}this.Ie.removeEventListener("mousemove",this.oe.mouseMove),this.Ie.removeEventListener("mouseup",this.oe.moveDone),this.oe.mouseMove=null},this.oe.ie.addEventListener("mousedown",s=>{if(this.Ie.focus(),this.emit("mousedown",s),s.button===0)s.preventDefault(),this.yi=2,s.shiftKey&&this.vt.down?this.Qi(s):this.Zl(s),this.oe.Gt.style.pointerEvents="none";else if(s.button===2&&this.vt.down){this.Re.start||this.Bs();let n=this.Cn(s),r=this.ue.createRange();r.setStart(this.Re.start.node,this.Re.start.offset),r.setEnd(this.Re.end.node,this.Re.end.offset),n.offsetNode&&r.intersectsNode(n.offsetNode)||n.startContainer&&r.intersectsNode(n.startContainer)?s.shiftKey?this.Qi(s):this.Bs():s.shiftKey?this.Qi(s):this.clearSelection()}}),this.oe.ie.addEventListener("mousemove",s=>{this.yi&&(this.as=s,this.Qi(s),this.Gr())}),this.oe.ie.addEventListener("mouseleave",s=>{this.yi&&s.toElement!==this.oe.Gt&&s.target!==this.oe.Gt&&(s.pageX>=this.oe.hi.right||s.pageY>=this.hi.bottom-this.en)&&(this.as=s,this.customSelection&&(this.vt.up=this.Cn(s)||this.ue.createRange(),this.vt.up.setStart(this.oe.ie.lastChild,this.oe.ie.lastChild.childNodes.length),this.vt.up.setEnd(this.oe.ie.lastChild,this.oe.ie.lastChild.childNodes.length),this.Bs()))}),this.oe.ie.addEventListener("mouseenter",s=>{this.yi&&(s.buttons&1)!==1?this.tr(s):this.yi&&(this.as=s,this.Gr(),this.Qi(s))}),this.oe.ie.addEventListener("mouseup",s=>{this.emit("mouseup",s),s.button===0&&this.tr(s),s.button||this.ie.click()}),this.oe.ie.addEventListener("wheel",s=>{let n=s.deltaY||s.wheelDelta;this.ie.scrollTop+=n},{passive:!0}),this.Fo(),this.De(192)):this.oe&&!t&&(this.Ie.removeEventListener("mouseup",this.oe.moveDone),this.Ie.removeEventListener("mouseleave",this.oe.moveDone),this.Ie.removeChild(this.oe.ie),this.Ie.removeChild(this.oe.Gt),this.oe=null),this.customSelection?this.Ie.style.userSelect="none":this.Ie.style.userSelect=""}get linkFunction(){return this.Wo||"doLink"}set linkFunction(t){this.Wo=t}get mxpLinkFunction(){return this.zo||"doMXPLink"}set mxpLinkFunction(t){this.zo=t}get mxpSendFunction(){return this.Ho||"doMXPSend"}set mxpSendFunction(t){this.Ho=t}get mxpTooltipFunction(){return this.$o||"doMXPTooltip"}set mxpTooltipFunction(t){this.$o=t}get id(){return this.Ie?this.Ie.id:""}get container(){return this.Ie}get lines(){return this.me.lines}get model(){return this.me}set model(t){this.me!==t&&(this.me&&this.me.removeAllListeners(),this.me=t,this.me.on("debug",this.debug,this),this.me.on("bell",()=>{this.emit("bell")}),this.me.on("add-line",e=>{this.emit("add-line",e)}),this.me.on("add-line-done",e=>{this.emit("add-line-done",e)}),this.me.on("line-added",(e,s)=>{this.Js.push(this.getLineHTML(e.idx))}),this.me.on("expire-links",e=>{if(this._n.length)for(let s=0,n=this._n.length;s<n;s++)this.Wr(this._n[s]);this._n=[],this.emit("expire-links")}),this.me.on("parse-done",()=>{if(this.Js.length>=this.hs){let e=this.lines.length-this.hs;this.Js.slice(this.Js.length-this.hs),this.ie.innerHTML=this.Js.join(""),this.me.removeLines(0,e)}else this.ie.insertAdjacentHTML("beforeend",this.Js.join(""));this.Js=[],this.De(66),this.emit("parse-done")}),this.me.on("set-title",(e,s)=>{this.emit("set-title",e,s)}),this.me.on("music",e=>{this.emit("music",e)}),this.me.on("sound",e=>{this.emit("sound",e)}),this.me.on("MXP-tag-reply",(e,s)=>{this.emit("MXP-tag-reply",e,s)}),this.me.on("expire-link-line",e=>{this._n.push(e),this.De(66)}))}get maxLines(){return this.hs}set maxLines(t){t!==this.hs&&(this.hs=t,this.De(4))}get enableDebug(){return this.Sn}get enableColors(){return this.Kn}set enableColors(t){t!==this.Kn&&(this.Kn=t,this.tn())}get enableBackgroundColors(){return this.Ar}set enableBackgroundColors(t){t!==this.Ar&&(this.Ar=t,this.tn())}get hideTrailingEmptyLine(){return this.Jn}set hideTrailingEmptyLine(t){t!==this.Jn&&(this.Jn=t,this.De(2))}set enableDebug(t){this.Sn=t,this.me.enableDebug=t}get tabWidth(){return this.me.tabWidth}set tabWidth(t){this.me.tabWidth=t}get textLength(){return this.me.textLength}get EndOfLine(){return this.me.EndOfLine}get parseQueueLength(){return this.me.parseQueueLength}get parseQueueEndOfLine(){return this.me.parseQueueEndOfLine}get EndOfLineLength(){return this.lines.length===0?0:this.lines[this.lines.length-1].text.length}set enableFlashing(t){this.me.enableFlashing=t}get enableFlashing(){return this.me.enableFlashing}set enableMXP(t){this.me.enableMXP=t}get enableMXP(){return this.me.enableMXP}set showInvalidMXPTags(t){this.me.showInvalidMXPTags=t}get showInvalidMXPTags(){return this.me.showInvalidMXPTags}set enableBell(t){this.me.enableBell=t}get enableBell(){return this.me.enableBell}set enableURLDetection(t){this.me.enableURLDetection=t}get enableURLDetection(){return this.me.enableURLDetection}set enableMSP(t){this.me.enableMSP=t}get enableMSP(){return this.me.enableMSP}set displayControlCodes(t){this.me.displayControlCodes=t}get displayControlCodes(){return this.me.displayControlCodes}set emulateTerminal(t){this.me.emulateTerminal=t}get emulateTerminal(){return this.me.emulateTerminal}set emulateControlCodes(t){this.me.emulateControlCodes=t}get emulateControlCodes(){return this.me.emulateControlCodes}set MXPStyleVersion(t){this.me.MXPStyleVersion=t}get MXPStyleVersion(){return this.me.MXPStyleVersion}get WindowSize(){return new Ot(this.WindowWidth,this.WindowHeight)}get WindowWidth(){return Math.trunc(this.Bl/this.Li)}get WindowHeight(){return this.ie.scrollWidth>this.ie.clientWidth?Math.trunc((this.Ol-this.er-this.bi[0]-this.bi[2])/this.Bi):Math.trunc((this.Ol-this.bi[0]-this.bi[2])/this.Bi)}get html(){let t=this.lines.length,e=[];for(let s=0;s<t;s++)e.push(this.getLineHTML(s));return e.join("")}get text(){return this.me.text}get raw(){return this.me.raw}get scrollAtBottom(){return this.Qn}debug(t){this.emit("debug",t)}scrollDisplay(t){this.oe?(t||!this.scrollLock&&!this.oe.visible)&&(this.ie.scrollTop=this.ie.scrollHeight):this.scrollLock||(this.ie.scrollTop=this.ie.scrollHeight)}scrollTo(t,e){this.ie.scrollTo(t,e)}scrollToCharacter(t,e){this.ie.scrollTo(t*this.Bi,e*this.Li)}scrollBy(t,e){this.ie.scrollBy(t,e)}scrollUp(){this.ie.scrollBy(0,-this.Bi)}scrollDown(){this.ie.scrollBy(0,this.Bi)}pageUp(){this.ie.scrollBy(0,-this.ie.clientHeight)}pageDown(){this.ie.scrollBy(0,this.ie.clientHeight)}trimLines(){this.hs!==-1&&ve(()=>{if(this.lines.length>this.hs){let t=this.lines.length-this.hs,e=t;for(;e-- >0;)this.ie.removeChild(this.ie.firstChild);this.me.removeLines(0,t)}},100,this.id+"trimLines")}append(t,e,s,n){this.me.append(t,e||!1,s||!1,n||!1)}CurrentAnsiCode(){return this.me.CurrentAnsiCode()}removeLine(t,e){if(t<0||t>=this.lines.length)return;this.emit("line-removed",t,this.lines[t].text);let s=this.me.getLineID(t),n=this.ie.querySelector(`[data-id="${s}"]`);this.ie.removeChild(n),this.me.removeLine(t),this.De(64)}removeLines(t,e){t<0||t>=this.lines.length||(e<1&&(e=1),this.emit("lines-removed",t,this.lines.slice(t,t+e-1)),this.ie.replaceChildren(...[].slice.call(this.ie.children,0,t),...[].slice.call(this.ie.children,t+e)),this.me.removeLines(t,e),this.De(64))}oh(){this.ie.classList.remove("animate"),this.De(4),this.Jn&&this.lines.length&&this.lines[this.lines.length-1].text.length===0&&(this.ie.lastChild.style.display="none"),this.De(88),this.ie.classList.add("animate")}updateWindow(t,e){t===void 0&&(t=this.WindowWidth,e=this.WindowHeight),this.me.updateWindow(t,e),this.emit("update-window",t,e)}clear(){this.me.clear(),this.ie.innerHTML=""}dispose(){for(this.ue.body.removeChild(this.ai),this.ue.body.removeChild(this.$i);this.Ie.firstChild;)this.ie.removeChild(this.ie.firstChild);this.ae.removeEventListener("resize",this.Dl),this.ae.removeEventListener("mouseup",this.Al),this.ae.removeEventListener("mousemove",this.Gl),this.ue.removeEventListener("selectionchange",this.Wl),this.Ie.removeEventListener("dragstart",this.Fl)}ah(){this.Bl=this.ie.clientWidth-this.bi[1]-this.bi[3]-this.er-this.Nl,this.Fi!==0&&(this.Bl-=this._s*this.Li),this.Ol=this.ie.clientHeight,this.hi=this.ie.getBoundingClientRect(),this.Hl=Zt(),this.$l=Zt()}updateFont(t,e){!t||t.length===0?t='"Courier New", Courier, monospace':t+=", monospace",(!e||e.length===0)&&(e="1em"),(t!==this.Ie.style.fontFamily||e!==this.Ie.style.fontSize)&&(this.Ie.style.fontSize=e,this.Ie.style.fontFamily=t,this.ai.style.fontSize=e,this.ai.style.fontFamily=t,this.Bi=parseFloat(this.ae.getComputedStyle(this.ai).height),this.Li=parseFloat(this.ae.getComputedStyle(this.ai.firstElementChild).width),setTimeout(()=>{this.Bi=parseFloat(this.ae.getComputedStyle(this.ai).height),this.Li=parseFloat(this.ae.getComputedStyle(this.ai.firstElementChild).width)},250),this.tn(),this.De(25));let s=this.ae.getComputedStyle(this.ie),n=[parseInt(s.getPropertyValue("padding-top"))||0,parseInt(s.getPropertyValue("padding-right"))||0,parseInt(s.getPropertyValue("padding-bottom"))||0,parseInt(s.getPropertyValue("padding-left"))||0];(n[0]!==this.bi[0]||n[1]!==this.bi[1]||n[2]!==this.bi[2]||n[3]!==this.bi[3])&&(this.bi=n,this.De(1))}tn(){let t="";this.Kn||(t+="#"+this.id+" .view > span span {color: inherit !important;}"),(!this.Kn||!this.Ar)&&(t+="#"+this.id+" .background > span span {background-color: inherit !important;}"),this.En?t+="#"+this.id+" .view {white-space: break-spaces; }":this.cs>0&&(t+=`#${this.id} .view {white-space: break-spaces; } .line {width: ${this.cs*this.Li}px !important;max-width:  ${this.cs*this.Li}px;min-width:  ${this.cs*this.Li}px;display: block;}`),(this.En||this.cs>0)&&this.Ln>0&&(t+=`#${this.id} .view {  text-indent: ${this.Ln*this.Li}px hanging; }`),t+=`#${this.id} .line > span { min-height: ${this.Bi}}`,this.Fi!==0&&(t+="#"+this.id+" .timestamp { display: inline-block; }"),this.$i.innerHTML=t,(this.En||this.cs>0)&&this.Ln>0?this.Nl=parseFloat(this.ae.getComputedStyle(this.ie).paddingLeft)/2:this.Nl=0}getLineHTML(t,e,s,n){t===void 0||t>=this.lines.length?t=this.lines.length-1:t<0&&(t=0),(e===void 0||e<0)&&(e=0),(s===void 0||s===-1)&&(s=this.lines[t].text.length);let r=[],o=0,a="",h="",c=this.lines[t].text,g=this.lines[t].formats,m=g.length,b=!1,u=this.me.getLineID(t);this.Fi===2&&moment?r.push('<span class="timestamp" style="color:',this.me.GetColor(-7),";background:",this.me.GetColor(-8),';"',h,">",moment(this.lines[t].timestamp).format(this.Qs),"</span>"):this.Fi!==0&&r.push('<span class="timestamp" style="color:',this.me.GetColor(-7),";background:",this.me.GetColor(-8),';"',h,">",new Date(this.lines[t].timestamp).toISOString()," </span>");for(let E=0;E<m;E++){let w=g[E],L,k,R=[];if(E<m-1){if(L=g[E+1],w.offset===L.offset&&L.formatType===w.formatType)continue;k=L.offset}else k=c.length;if(o=w.offset,k>s&&(k=s),o<e&&(o=e),w.formatType===0){if(a=[],h=[],typeof w.background=="number"?a.push("background:",this.me.GetColor(w.background),";"):w.background&&a.push("background:",w.background,";"),typeof w.color=="number"?a.push("color:",this.me.GetColor(w.color),";"):w.color&&a.push("color:",w.color,";"),w.font&&a.push("font-family: ",w.font,";"),w.size&&a.push("font-size: ",w.size,";"),w.style!==0?((w.style&1)===1&&a.push("font-weight: bold;"),(w.style&4)===4&&a.push("font-style: italic;"),(w.style&1024)===1024&&R.push("overline "),((w.style&512)===512||(w.style&8)===8)&&R.push("underline "),(w.style&512)===512?a.push("border-bottom: 1px solid ",typeof w.color=="number"?this.me.GetColor(w.color):w.color,";"):a.push("border-bottom: 1px solid ",typeof w.background=="number"?this.me.GetColor(w.background):w.background,";"),((w.style&32)===32||(w.style&16)===16)&&(this.enableFlashing?h.push(" ansi-blink"):(w.style&512)!==512&&(w.style&8)!==8&&R.push("underline ")),(w.style&256)===256&&R.push("line-through "),R.length>0&&a.push("text-decoration:",R.join("").trim(),";")):a.push("border-bottom: 1px solid ",typeof w.background=="number"?this.me.GetColor(w.background):w.background,";"),o<e||k<e)continue;a=a.join("").trim(),h.length!==0?h=' class="'+h.join("").trim()+'"':h="",w.hr?r.push('<span style="',a,'min-width:100%;width:100%;"',h,'><div style="position:relative;top: 50%;transform: translateY(-50%);height:4px;width:100%; background-color:',typeof w.color=="number"?this.me.GetColor(w.color):w.color,'"></div></span>'):k-o!==0&&r.push('<span style="',a,'"',h,">",Pe(c.substring(o,k)),"</span>")}else if(w.formatType===1){if(o<e||k<e||(r.push('<a draggable="false" class="URLLink" href="javascript:void(0);" title="'),r.push(w.href.replace(/"/g,"&quot;")),r.push('" onclick="',this.linkFunction,"('",w.href.replace(/\\/g,"\\\\").replace(/"/g,"&quot;"),`');return false;">`),k-o===0))continue;r.push('<span style="',a,'"',h,">"),r.push(Pe(c.substring(o,k))),r.push("</span>")}else if(w.formatType===2||w.formatType===4||w.formatType===8){if(o<e||k<e)continue;r.push("</a>")}else if(w.formatType===3){if(o<e||k<e||(r.push('<a draggable="false" class="MXPLink" href="javascript:void(0);" title="'),r.push(w.href.replace(/"/g,"&quot;")),r.push('"'),w.expire&&w.expire.length&&r.push(` data-expire="${w.expire}"`),r.push(' onclick="',this.mxpLinkFunction,"(this, '",w.href.replace(/\\/g,"\\\\").replace(/"/g,"&quot;"),`');return false;">`),k-o===0))continue;r.push('<span style="',a,'"',h,">"),r.push(Pe(c.substring(o,k))),r.push("</span>")}else if(w.formatType===7){if(o<e||k<e||(r.push('<a draggable="false" class="MXPLink" href="javascript:void(0);" title="'),r.push(w.hint.replace(/"/g,"&quot;")),r.push('"'),w.expire&&w.expire.length&&r.push(` data-expire="${w.expire}"`),r.push(' onmouseover="',this.mxpTooltipFunction,'(this);"'),r.push(' onclick="',this.mxpSendFunction,"(event||window.event, this, ",w.href.replace(/\\/g,"\\\\").replace(/"/g,"&quot;"),", ",w.prompt?"1":"0",", ",w.tt.replace(/\\/g,"\\\\").replace(/"/g,"&quot;"),');return false;">'),k-o===0))continue;r.push('<span style="',a,'"',h,">"),r.push(Pe(c.substring(o,k))),r.push("</span>")}else if(w.formatType===9&&k-o!==0){if(o<e||k<e)continue;r.push('<span style="',a,'"',h,">"),r.push(Pe(c.substring(o,k))),r.push("</span>")}else if(w.formatType===5){if(o<e||k<e)continue;let B="";switch(r.push('<img src="'),w.url.length>0&&(r.push(w.url),B+=w.url,w.url.endsWith("/")||(r.push("/"),B+="/")),w.t.length>0&&(r.push(w.t),B+=w.t,w.t.endsWith("/")||(r.push("/"),B+="/")),B+=w.name,r.push(w.name,'"  style="'),w.w.length>0&&r.push("width:",Lt(w.w,this.Li),";"),w.h.length>0&&r.push("height:",Lt(w.h,this.Bi),";"),w.align.toLowerCase()){case"left":r.push("float:left;");break;case"right":r.push("float:right;"),b=!0;break;case"top":case"middle":case"bottom":r.push("vertical-align:",w.align,";");break}w.hspace.length>0&&w.vspace.length>0?(r.push("margin:"),r.push(Lt(w.vspace,this.Li)," "),r.push(Lt(w.hspace,this.Bi),";")):w.hspace.length>0?(r.push("margin:"),r.push("0px ",Lt(w.hspace,this.Bi),";")):w.vspace.length>0&&(r.push("margin:"),r.push(Lt(w.vspace,this.Li)," 0px;")),r.push('"'),w.ismap&&r.push(' ismap onclick="return false;"'),r.push(`src="${B}"/>`)}}return n?b&&s<this.lines[t].text.length?r.join(""):b?r.join("")+`<br>
`:s<this.lines[t].text.length?r.join(""):r.join("")+`<br>
`:b&&s<this.lines[t].text.length?`<span data-id="${u}" class="line" style="min-width:100%">${r.join("")}</span>`:b?`<span data-id="${u}" class="line" style="min-width:100%">${r.join("")}<br>
</span>`:s<this.lines[t].text.length?`<span data-id="${u}" class="line">${r.join("")}</span>`:`<span data-id="${u}" class="line">${r.join("")}<br>
</span>`}getLineText(t,e){return t<0||t>=this.lines.length||!this.lines[t]?"":this.lines[t].text}Wr(t){this.Zo(t,t)}Zo(t,e){if(!this.lines.length)return;(t===void 0||t<0)&&(t=0),(e===void 0||e===-1||e>=this.lines.length)&&(e=this.lines.length-1);let s=[],n=t;for(;n<=e;n++)s.push(this.getLineHTML(n));t===0&&e===this.lines.length-1?this.ie.innerHTML=s.join(""):(this.ie.replaceChildren(...[].slice.call(this.ie.children,0,t),...[].slice.call(this.ie.children,e+1)),t===0?this.ie.firstElementChild.insertAdjacentHTML("beforebegin",s.join("")):this.ie.children[t-1].insertAdjacentHTML("afterend",s.join("")))}De(t){t&&(this.Ye|=t,this.Ye!==0&&this.ae.requestAnimationFrame(()=>{this.Ye!==0&&((this.Ye&32)===32&&(this.Zo(),this.Ye&=-33),(this.Ye&1)===1&&(this.ah(),this.Ye&=-2),(this.Ye&2)===2&&(this.oh(),this.Ye&=-3),(this.Ye&4)===4&&(this.trimLines(),this.Ye&=-5),(this.Ye&8)===8&&(this.scrollDisplay(),this.Ye&=-9),(this.Ye&16)===16&&(this.updateWindow(),this.Ye&=-17),(this.Ye&64)===64&&(this.Uo(),this.Ye&=-65),(this.Ye&128)===128&&(this.Fo(),this.Ye&=-129),this.De(this.Ye))}))}colorSubStrByLine(t,e,s,n,r,o){this.colorSubStringByLine(t,e,s,n,(n||0)+(r||0),o)}colorSubStringByLine(t,e,s,n,r,o){this.me.colorSubStringByLine(t,e,s,n,r,o)&&this.Wr(t)}removeStyleSubStrByLine(t,e,s,n){this.removeStyleSubStringByLine(t,e,s,(s||0)+(n||0))}removeStyleSubStringByLine(t,e,s,n){this.me.removeStyleSubStringByLine(t,e,s,n)&&this.Wr(t)}highlightSubStrByLine(t,e,s){this.highlightStyleSubStringByLine(t,e,(e||0)+(s||0))}highlightStyleSubStringByLine(t,e,s,n){this.me.highlightStyleSubStringByLine(t,e,s,n)&&this.Wr(t)}SetColor(t,e){this.me.SetColor(t,e)}ClearMXP(){this.me.ClearMXP()}ResetMXPLine(){this.me.ResetMXPLine()}get hasSelection(){if(this.customSelection){if(this.Re.start)return!0}else{let t=this.ae.getSelection();if(t.rangeCount>0){let e=t.getRangeAt(0);return this.ie.contains(e.commonAncestorContainer)&&t.toString().length!==0}}return!1}get selection(){if(!this.customSelection){let e=this.ae.getSelection();if(e.rangeCount>0){let s=e.getRangeAt(0);if(this.ie.contains(s.startContainer)||this.ie.contains(s.endContainer))return e.toString()}}if(!this.hasSelection)return"";let t=this.ue.createRange();return this.oe&&this.oe.visible&&this.sn(this.ie,this.oe.ie),t.setStart(this.Re.start.node,this.Re.start.offset),t.setEnd(this.Re.end.node,this.Re.end.offset),this.oe&&this.oe.visible&&this.sn(this.oe.ie,this.ie),t.toString()}get selectionAsHTML(){if(!this.customSelection){let n=this.ae.getSelection();if(n.rangeCount>0){let r=n.getRangeAt(0);if(!this.ie.contains(r.startContainer)&&!this.ie.contains(r.endContainer))return"";let o=r.cloneContents(),a=this.ue.createElement("div");return a.appendChild(o),a.innerHTML}return""}if(!this.hasSelection)return"";let t=this.ue.createRange();this.oe&&this.oe.visible&&this.sn(this.ie,this.oe.ie),t.setStart(this.Re.start.node,this.Re.start.offset),t.setEnd(this.Re.end.node,this.Re.end.offset),this.oe&&this.oe.visible&&this.sn(this.oe.ie,this.ie);let e=t.cloneContents(),s=this.ue.createElement("div");return s.appendChild(e),s.innerHTML}selectAll(){let t;this.ae.getSelection&&(t=document.createRange(),t.setStart(this.ie.firstChild,0),t.setEnd(this.ie.lastChild,this.ie.lastChild.childNodes.length),this.ae.getSelection().removeAllRanges(),this.ae.getSelection().addRange(t)),this.customSelection&&(this.Re={start:{node:this.ie.firstChild,offset:0},end:{node:this.ie.lastChild,offset:this.ie.lastChild.childNodes.length},timer:null},this.oe&&this.oe.visible&&this.sn(this.oe.ie,this.ie),this.In()),this.emit("selection-changed",this.ae.getSelection())}clearSelection(){let t=this.ae.getSelection();if(t.rangeCount>0){let e=t.getRangeAt(0);(this.ie.contains(e.startContainer)||this.ie.contains(e.endContainer))&&t.removeAllRanges()}this.Re={start:null,end:null,timer:null},this.In(),this.emit("selection-changed",this.ae.getSelection())}getLineOffset(t,e){let s=this.ue.elementsFromPoint(t,e),n;for(let o=0,a=s.length;o<a&&this.ie!==s[o];o++)if(this.ie.contains(s[o])){n=s[o];break}if(!n||!this.ie.contains(n)&&this.ie!=n)return{x:-1,y:-1,lineID:-1};if(n.classList.contains("line"))return{x:0,y:this.model.getLineFromID(+n.dataset.id),lineID:+n.dataset.id};let r=n.closest(".line");return r?{x:0,y:this.model.getLineFromID(+r.dataset.id),lineID:+r.dataset.id}:{x:-1,y:-1,lineID:-1}}getWordFromPosition(t,e){let s=this.ue.elementsFromPoint(t,e),n;for(let r=0,o=s.length;r<o;r++){if(this.ie===s[r])return"";if(this.ie.contains(s[r])){n=s[r];break}}if(n&&n.textContent){let r=n.textContent,o=r.lastIndexOf(" ",t)+1,a=r.indexOf(" ",t);return a===-1&&(a=r.length),r.substring(o,a)}return""}Uo(){if(!this.oe||this.ie.clientHeight>=this.ie.scrollHeight)return;let t=this.lines.length,e=[];for(let s=t-this.WindowHeight;s<t;s++)e.push(this.getLineHTML(s));this.oe.ie.classList.remove("animate"),this.oe.ie.innerHTML=e.join(""),this.oe.ie.firstChild.style.width=this.ie.scrollWidth+"px",this.Jn&&this.lines.length&&this.lines[this.lines.length-1].text.length===0&&(this.oe.ie.lastChild.style.display="none"),this.Ul(),this.oe.ie.classList.add("animate"),this.oe.ie.scrollTop=this.oe.ie.scrollHeight,this.oe.Gt.style.top=this.ie.clientHeight-this.oe.ie.clientHeight+"px"}Ul(){this.oe&&(this.oe.ie.style.top=this.ps+"px",this.ie.scrollWidth>this.ie.clientWidth?this.oe.ie.style.bottom=this.en+"px":this.oe.ie.style.bottom="",this.oe.hi=this.oe.ie.getBoundingClientRect())}Fo(){this.oe&&(this.ie.clientHeight+this.ie.scrollTop>=this.ie.scrollHeight?this.oe.visible&&(this.oe.ie.style.visibility="hidden",this.oe.Gt.style.display="none",this.oe.visible=!1,this.sn(this.ie,this.oe.ie),this.emit("scroll-lock",!1)):(this.oe.ie.scrollTop=this.oe.ie.scrollHeight,this.oe.ie.scrollLeft=this.ie.scrollLeft,this.oe.visible||(this.oe.ie.style.visibility="visible",this.oe.Gt.style.display="block",this.oe.Gt.style.top=this.ie.clientHeight-this.oe.ie.clientHeight+"px",this.oe.visible=!0,this.oe.hi=this.oe.ie.getBoundingClientRect(),this.sn(this.oe.ie,this.ie),this.emit("scroll-lock",!0))))}sn(t,e){let s,n,r;this.vt.down&&(r=this.ir(this.vt.down),s=r.offset,n=this.Yo(t,e,r.node),n&&this.jo(n,t)&&(this.vt.down.setStart(n,s),this.vt.down.setEnd(n,s))),this.vt.up&&(r=this.ir(this.vt.up),s=r.offset,n=this.Yo(t,e,r.node),n&&this.jo(n,t)&&(this.vt.up.setStart(n,s),this.vt.up.setEnd(n,s))),this.Bs(),this.In()}Cn(t){var e,s=t.clientX,n=t.clientY;if(this.ue.body.createTextRange)e=this.ue.body.createTextRange(),e.moveToPoint(s,n);else if(typeof this.ue.createRange<"u"&&this.ue.createRange!==null)if(typeof t.rangeParent<"u"&&t.rangeParent!==null)console.log("rp"),console.log(t.rangeParent),e=document.createRange(),e.setStart(t.rangeParent,t.rangeOffset),e.collapse(!0);else if(this.ue.body.caretPositionFromPoint){var r=this.ue.body.caretPositionFromPoint(s,n);if(!r||!this.Ie.contains(r.offsetNode))return null;e=r.createRange(),e.setStart(r.offsetNode,r.offset),e.collapse(!0)}else if(this.ue.caretPositionFromPoint){var r=this.ue.caretPositionFromPoint(s,n);if(!r||!this.Ie.contains(r.offsetNode))return null;e=this.ue.createRange(),e.setStart(r.offsetNode,r.offset),e.collapse(!0)}else this.ue.caretRangeFromPoint&&(e=this.ue.caretRangeFromPoint(s,n));return e}Yo(t,e,s){let n=-1,r,o,a;if(!t.contains(s)){for(o=[{node:s,idx:-1}],r=s;r&&r.parentNode&&e.contains(r)&&e.contains(r.parentNode)&&(!r.classList||!r.classList.contains("line"));)o.push({node:r.parentNode,idx:Array.from(r.parentNode.childNodes).indexOf(r)}),r=r.parentNode;if(a=o.length-1,o[a].node&&o[a].node.dataset&&(n=o[a].node.dataset.id),r=t.querySelector(`[data-id="${n}"]`)){for(;a>0;a--)r=r.childNodes[o[a].idx];return r}}return null}jo(t,e){if(!t||!e||!e.contains(t))return!1;let s;if(t.nodeType===3){if(t.parentNode.style.display==="none")return!0;s=t.parentNode.getBoundingClientRect()}else{if(t.style.display==="none")return!0;s=t.getBoundingClientRect()}let n=e.getBoundingClientRect();return s.y>=n.y}In(){if("Highlight"in window){if(!this.Re.start||!this.customSelection){this.us&&(this.ds.delete(this.us),this.us=null),!this.customSelection&&this.ds&&(CSS.highlights.delete("oiMUD-selection"),this.ds=null);return}this.ds=this.ds||CSS.highlights.get("oiMUD-selection"),this.ds||(this.ds=new Highlight,CSS.highlights.set("oiMUD-selection",this.ds)),this.us||(this.us=this.ue.createRange(),this.ds.add(this.us)),this.us.setStart(this.Re.start.node,this.Re.start.offset),this.Re.end?this.us.setEnd(this.Re.end.node,this.Re.end.offset):this.us.setEnd(this.Re.start.node,this.Re.start.offset)}}tr(t){this.yi&&(this.Qi(t),this.emit("selection-done")),this.yi=0,this.oe&&(this.oe.Gt.style.pointerEvents=""),this.Yl()}Yl(){(this.customSelection||this.Re.timer)&&(clearInterval(this.Re.timer),this.Re.timer=null)}Gr(){if(!this.customSelection)return;var t=this.hi,e=this.as.clientX,s=this.as.clientY,n=this.ie.clientWidth,r=this.ie.clientHeight,o=20,a=t.top+o,h=t.left+o,c=t.top+(r-o),g=t.left+(n-o),m=e<h,b=e>g,u=s<a,E=s>c;if(!(m||b||u||E)){this.Yl();return}var w=Math.max(this.ie.scrollWidth,this.ie.offsetWidth,this.ie.clientWidth),L=Math.max(this.ie.scrollHeight,this.ie.offsetHeight,this.ie.clientHeight),k=w-n,R=L-r,B=this,v=this.Re,O=this.ie;(function I(){clearTimeout(v.timer),C()&&(v.timer=setTimeout(I,30))})();function C(){var I=O.scrollLeft,D=O.scrollTop,S=D>0,M=D<R,q=I>0,Q=I<k,W=I,ne=D,V=50;if(m&&q){var N=(h-e)/o;W=W-V*N}else if(b&&Q){var N=(e-g)/o;W=W+V*N}if(u&&S){var N=(a-s)/o;ne=ne-V*N}else if(E&&M){var N=(s-c)/o;ne=ne+V*N}return W=Math.max(0,Math.min(k,W)),ne=Math.max(0,Math.min(R,ne)),W!==I||ne!==D?(B.scrollTo(W,ne),!0):!1}}hh(t,e){var s=t.compareDocumentPosition(e);return!(s&4)}ir(t){return t.startContainer?{node:t.startContainer,offset:t.startOffset}:{node:t.offsetNode,offset:t.offset}}Zl(t){this.customSelection&&(this.vt.down=this.Cn(t),this.Re.start=this.ir(this.vt.down),this.Re.end=this.Re.start,this.In())}Bs(){if(!this.customSelection||!this.vt.down)return;let t=this.ir(this.vt.down),e=this.ir(this.vt.up);t.node===e.node?t.offset<e.offset?(this.Re.start=t,this.Re.end=e):(this.Re.start=e,this.Re.end=t):this.hh(t.node,e.node)?(this.Re.start=e,this.Re.end=t):(this.Re.start=t,this.Re.end=e),ve(()=>{let s;this.ue.activeElement===this.Ie&&(this.ae.getSelection().rangeCount===0?(s=this.ue.createRange(),s.setStart(this.Re.start.node,this.Re.start.offset),s.setEnd(this.Re.end.node,this.Re.end.offset),this.ae.getSelection().addRange(s)):(s=this.ae.getSelection().getRangeAt(0),s.setStart(this.Re.start.node,this.Re.start.offset),s.setEnd(this.Re.end.node,this.Re.end.offset)))},1,this.id+"set-selection"),this.emit("selection-changed"),this.In()}Qi(t){if(!this.customSelection)return;let e=this.Cn(t);e&&(this.vt.up=e),this.Bs()}},Fi=class extends me{constructor(t){super();this.sr=0;this.lines=[];this.nn=[];this.It={};this.Ui=[];this.Ce=new ci(t),this.Ce.on("debug",e=>{this.emit("debug",e)}),this.Ce.on("bell",()=>{this.emit("bell")}),this.Ce.on("add-line",e=>{this.addParserLine(e,!0)}),this.Ce.on("expire-links",e=>{let s,n,r;if(!e||e.length===0){for(n in this.Ui)this.Ui.hasOwnProperty(n)&&this.jl(this.Ui[n],+n);for(r in this.It)if(this.It.hasOwnProperty(r)){s=this.It[r];for(n in s)s.hasOwnProperty(n)&&this.jl(s[n],+n)}this.Ui=[],this.It={},this.emit("expire-links",e)}else if(this.It[e]){s=this.It[e];for(n in s)s.hasOwnProperty(n)&&this.jl(s[n],+n);delete this.It[e],this.emit("expire-links",e)}}),this.Ce.on("parse-done",()=>{this.emit("parse-done")}),this.Ce.on("set-title",(e,s)=>{this.emit("set-title",e,s)}),this.Ce.on("music",e=>{this.emit("music",e)}),this.Ce.on("sound",e=>{this.emit("sound",e)}),this.Ce.on("MXP-tag-reply",(e,s)=>{this.emit("MXP-tag-reply",e,s)})}get enableDebug(){return this.Ce.enableDebug}set enableDebug(t){this.Ce.enableDebug=t}get tabWidth(){return this.Ce.tabWidth}set tabWidth(t){this.Ce.tabWidth=t}get textLength(){return this.Ce.textLength}get EndOfLine(){return this.Ce.EndOfLine}get parseQueueLength(){return this.Ce.parseQueueLength}get parseQueueEndOfLine(){return this.Ce.parseQueueEndOfLine}set enableFlashing(t){this.Ce.enableFlashing=t}get enableFlashing(){return this.Ce.enableFlashing}set enableMXP(t){this.Ce.enableMXP=t}get enableMXP(){return this.Ce.enableMXP}set showInvalidMXPTags(t){this.Ce.showInvalidMXPTags=t}get showInvalidMXPTags(){return this.Ce.showInvalidMXPTags}set enableBell(t){this.Ce.enableBell=t}get enableBell(){return this.Ce.enableBell}set enableURLDetection(t){this.Ce.enableURLDetection=t}get enableURLDetection(){return this.Ce.enableURLDetection}set enableMSP(t){this.Ce.enableMSP=t}get enableMSP(){return this.Ce.enableMSP}set displayControlCodes(t){this.Ce.displayControlCodes=t}get displayControlCodes(){return this.Ce.displayControlCodes}set emulateTerminal(t){this.Ce.emulateTerminal=t}get emulateTerminal(){return this.Ce.emulateTerminal}set emulateControlCodes(t){this.Ce.emulateControlCodes=t}get emulateControlCodes(){return this.Ce.emulateControlCodes}set MXPStyleVersion(t){this.Ce.StyleVersion=t}get MXPStyleVersion(){return this.Ce.StyleVersion}addParserLine(t,e){if(t.timestamp=Date.now(),this.emit("add-line",t),t==null||typeof t>"u"||t.line==null||typeof t.line>"u"||(this.emit("add-line-done",t),t.gagged))return;let s={text:t.line===`
`||t.line.length===0?"":t.line,raw:t.raw,formats:t.formats,id:this.sr,timestamp:t.timestamp};this.lines.push(s),this.nn.push(this.sr),this.sr++,this.ch(this.lines.length-1),this.emit("line-added",t,e)}appendLines(t){for(let e=0,s=t.length;e<s;e++)this.addParserLine(t[e]);this.Ce.emit("parse-done")}jl(t,e){let s,n,r,o,a,h,c,g=0;for(n=0,o=t.length;n<o;n++)for(r=this.lines[e].formats.length,s=t[n],c=this.lines[e].formats[s],a=c.formatType,c.formatType===3?h=4:h=8,c.formatType=9,s++;s<r;s++)if(this.lines[e].formats[s]===h)if(g===0){this.lines[e].formats[s].formatType=10;break}else g--;else this.lines[e].formats[s]===a&&g++;this.emit("expire-link-line",e)}clear(){this.Ce.Clear(),this.lines=[],this.It={},this.Ui=[],this.nn=[],this.sr=0}IncreaseColor(t,e){return this.Ce.IncreaseColor(t,e)}GetColor(t){return this.Ce.GetColor(t)}append(t,e,s,n){this.Ce.parse(t,e||!1,s||!1,n||!1)}CurrentAnsiCode(){return this.Ce.CurrentAnsiCode()}updateWindow(t,e){this.Ce.updateWindow(t,e)}SetColor(t,e){this.Ce.SetColor(t,e)}ClearMXP(){this.Ce.ClearMXP()}ResetMXPLine(){this.Ce.ResetMXPLine()}get busy(){return this.Ce.busy}removeLine(t){this.lines.splice(t,1),this.nn.splice(t,1),this.Ui.splice(t,1)}removeLines(t,e){this.lines.splice(t,e),this.nn.splice(t,e),this.Ui.splice(t,e);for(let s in this.It)!this.It.hasOwnProperty(s)||this.It[s].length===0||t>=this.It[s].length||this.It[s].splice(t,e)}getLineID(t){return t<0||t>=this.nn.length?-1:this.nn[t]}get getNextLineID(){return this.sr}getLineFromID(t){return this.nn.indexOf(t)}ch(t){t===void 0&&(t=this.lines.length-1);let e=this.lines[t].formats;for(let r in this.It)this.It.hasOwnProperty(r)&&this.It[r][t]&&delete this.It[r][t];delete this.Ui[t];let s=e.length,n;for(;s--;)n=e[s],(n.formatType===7||n.formatType===3)&&(n.expire&&n.expire.length>0?(this.It[n.expire]||(this.It[n.expire]=[]),this.It[n.expire][t]||(this.It[n.expire][t]=[]),this.It[n.expire][t].push(s)):(this.Ui[t]||(this.Ui[t]=[]),this.Ui[t].push(s)))}colorSubStrByLine(t,e,s,n,r,o){return this.colorSubStringByLine(t,e,s,n,n+r,o)}colorSubStringByLine(t,e,s,n,r,o){if(t<0||t>=this.lines.length)return!1;let a=this.lines[t].text.length;if(n>=a||((!n||n<0)&&(n=0),(!r||r>a)&&(r=a),n===r))return!1;let h=this.lines[t].formats,c=h.length,g=!1;if(n===0&&r>=a){for(let m=0;m<c;m++){let b=h[m];b.formatType===0&&(g=!0,b.bStyle&&(b.bStyle=0,b.fStyle=0,b.fCls=0),b.color=e||b.color,b.background=s||b.background,b.style|=o||0)}g||h.unshift({formatType:0,offset:0,color:e||0,background:s||0,size:0,font:0,style:o||0,unicode:!1})}else{let m,b;for(let u=0;u<c;u++){let E=h[u];if(E.formatType===0){if(u<c-1){let w=u+1;if(m=h[w],E.offset===m.offset&&m.formatType===E.formatType)continue;for(;E.offset===m.offset&&m.formatType===E.formatType&&w<c-1;)m=h[++w];w===c&&E.offset===m.offset?b=a:b=m.offset}else b=a;n<E.offset||n>=b||(g=!0,E.bStyle&&(E.bStyle=0,E.fStyle=0,E.fCls=0),r<b&&(E.width=0,h.splice(u+1,0,{formatType:E.formatType,offset:r,color:E.color,background:E.background,size:E.size,font:E.font,style:E.style,unicode:E.unicode}),c++),n!=E.offset?(E.width=0,h.splice(u+1,0,{formatType:E.formatType,offset:n,color:e||E.color,background:s||E.background,size:E.size,font:E.font,style:E.style|(o||0),unicode:E.unicode}),c++):(E.color=e||E.color,E.background=s||E.background,E.style|=o||0),r>b&&(n=b))}}this.lines[t].formats=this.Vn(h,this.textLength)}return!0}removeStyleSubStrByLine(t,e,s,n){return this.removeStyleSubStringByLine(t,e,s,s+n)}removeStyleSubStringByLine(t,e,s,n){if(t<0||t>=this.lines.length)return!1;let r=this.lines[t].text.length;if(s>=r)return!1;(!s||s<0)&&(s=0),(!n||n>r)&&(n=r);let o=this.lines[t].formats,a=o.length,h=!1;if(s===0&&n>=r){for(let c=0;c<a;c++){let g=o[c];g.formatType===0&&(h=!0,g.bStyle&&(g.bStyle=0,g.fStyle=0,g.fCls=0),g.style&=~(e||0))}h||o.unshift({formatType:0,offset:0,color:0,background:0,size:0,font:0,style:0,unicode:!1})}else{let c,g;for(let m=0;m<a;m++){let b=o[m];if(b.formatType===0){if(m<a-1){let u=m+1;if(c=o[u],b.offset===c.offset&&c.formatType===b.formatType)continue;for(;b.offset===c.offset&&c.formatType===b.formatType&&u<a-1;)c=o[++u];u===a&&b.offset===c.offset?g=r:g=c.offset}else g=r;s<b.offset||s>=g||(h=!0,b.bStyle&&(b.bStyle=0,b.fStyle=0,b.fCls=0),n<g&&(b.width=0,o.splice(m+1,0,{formatType:b.formatType,offset:n,color:b.color,background:b.background,size:b.size,font:b.font,style:b.style,unicode:b.unicode}),a++),s!=b.offset?(b.width=0,o.splice(m+1,0,{formatType:b.formatType,offset:s,color:b.color,background:b.background,size:b.size,font:b.font,style:b.style&~(e||0),unicode:b.unicode}),a++):b.style&=~(e||0),n>g&&(s=g))}}this.lines[t].formats=this.Vn(o,this.textLength)}return!0}highlightSubStrByLine(t,e,s){return this.highlightStyleSubStringByLine(t,e,e+s)}highlightStyleSubStringByLine(t,e,s,n){if(t<0||t>=this.lines.length)return!1;let r=this.lines[t].text.length;if(e>=r)return!1;(!e||e<0)&&(e=0),(!s||s>r)&&(s=r);let o=this.lines[t].formats,a=o.length,h=!1;if(e===0&&s>=r){for(let c=0;c<a;c++){let g=o[c];g.formatType===0&&(h=!0,g.bStyle&&(g.bStyle=0,g.fStyle=0,g.fCls=0),n||(g.style&1)===1?typeof g.color=="number"?g.color=this.Ce.IncreaseColor(this.Ce.GetColor(g.color),.25):g.color=this.Ce.IncreaseColor(g.color,.25):g.style|=1)}h||o.unshift({formatType:0,offset:0,color:n?370:0,background:0,size:0,font:0,style:n?0:1,unicode:!1})}else{let c,g;for(let m=0;m<a;m++){let b=o[m];if(b.formatType===0){if(m<a-1){let u=m+1;if(c=o[u],b.offset===c.offset&&c.formatType===b.formatType)continue;for(;b.offset===c.offset&&c.formatType===b.formatType&&u<a-1;)c=o[++u];u===a&&b.offset===c.offset?g=r:g=c.offset}else g=r;e<b.offset||e>=g||(h=!0,b.bStyle&&(b.bStyle=0,b.fStyle=0,b.fCls=0),s<g&&(b.width=0,o.splice(m+1,0,{formatType:b.formatType,offset:s,color:b.color,background:b.background,size:b.size,font:b.font,style:b.style,unicode:b.unicode}),a++),e!=b.offset?(b.width=0,c={formatType:b.formatType,offset:e,color:b.color,background:b.background,size:b.size,font:b.font,style:b.style,unicode:b.unicode},n||(b.style&1)===1?typeof b.color=="number"?c.color=this.Ce.IncreaseColor(this.Ce.GetColor(b.color),.25):c.color=this.Ce.IncreaseColor(b.color,.25):c.style|=1,o.splice(m+1,0,c),a++):n||(b.style&1)===1?typeof b.color=="number"?b.color=this.Ce.IncreaseColor(this.Ce.GetColor(b.color),.25):b.color=this.Ce.IncreaseColor(b.color,.25):b.style|=1,s>g&&(e=g))}}this.lines[t].formats=this.Vn(o,this.textLength)}return!0}Vn(t,e){if(!t||t.length<2)return t;let s=t.length,n=[];for(let r=0;r<s;r++){let o=t[r],a;if(r<s-1){let h=t[r+1];if(o.offset===h.offset&&h.formatType===o.formatType||(a=h.offset,o.formatType===1&&a-o.offset===0&&h.formatType===2)||o.formatType===7&&a-o.offset===0&&h.formatType===8||o.formatType===3&&a-o.offset===0&&h.formatType===4)continue;if(o.formatType===h.formatType&&o.color===h.color&&o.background===h.background&&o.size===h.size&&o.font===h.font&&o.style===h.style&&o.unicode===h.unicode){h.offset=o.offset,h.width=0;continue}}else if(o.offset===e&&e!==0&&(o.formatType===0&&!o.hr||o.formatType===1||o.formatType===7||o.formatType===3))continue;n.push(o)}return n}get text(){return this.lines.map(t=>t.text).join(`
`)}get raw(){return this.lines.map(t=>t.raw).join("")}getText(t,e,s){return t<0||t>=this.lines.length?"":(e<0&&(e=0),typeof s>"u"||s>this.lines[t].text.length?this.lines[t].text.substring(e):this.lines[t].text.substring(e,s))}};var gs="1.0.0-beta";var kt=Mi(ys());var Re=class extends me{#e;get client(){return this.#e}set client(p){p!==this.#e&&(this.remove(),this.#e=p,this.initialize())}constructor(p){super(),this.#e=p}};var ui=class extends me{constructor(){super(...arguments);this.fs="";this.rn=1;this.nr=100;this.Xl=50;this.Ns=0;this.current=0;this.sound=null;this.playing=!1;this.url="";this.continue=!0;this.maxErrorRetries=0}set file(t){this.continue||this.close(),this.fs=t}get file(){return this.fs}set repeats(t){t>=-1?this.rn=t:this.rn=1,this.current=0}get repeats(){return this.rn}set volume(t){t>=0&&t<=100?this.nr=t:this.nr=1}get volume(){return this.nr}set priority(t){t>=0&&t<=100?this.Xl=t:this.Xl=50}get priority(){return this.Xl}play(){this.playing=!0,this.rn>0&&this.current<this.rn?(this.current++,this.close(),this.open().then(()=>{this.Ns=0,this.sound.setVolume(this.nr).play(),this.current<this.rn?this.sound.bind("ended abort",t=>{this.play()}):this.sound.bind("ended abort",t=>{this.playing=!1,this.emit("ended")}),this.sound.isEnded()&&(this.playing=!1)}).catch(t=>{this.Ns<this.maxErrorRetries?(this.current--,this.play(),this.Ns++):this.Ns=0})):this.rn===-1?(this.close(),this.open().then(()=>{this.Ns=0,this.sound.setVolume(this.nr).loop().play(),this.sound.isEnded()&&(this.playing=!1)}).catch(t=>{this.Ns<this.maxErrorRetries?(this.play(),this.Ns++):this.Ns=0})):this.playing=!1}async open(){return this.close(),new Promise((t,e)=>{this.sound=new kt.sound()(this.url+this.fs),this.sound.bind("loadeddata",s=>{this.emit("playing",{file:this.fs,sound:this.sound,state:this,duration:kt.toTimer(this.sound.getDuration())}),t(1)}),this.sound.bind("error",s=>{if(s&&s.currentTarget&&s.currentTarget.error)switch(s.currentTarget.error.code){case 1:this.emit("error",new Error(`MSP - Aborted: ${this.url}${this.fs}`));break;case 2:this.emit("error",new Error(`MSP - Network error: ${this.url}${this.fs}`));break;case 3:this.emit("error",new Error(`MSP - Could not decode: ${this.url}${this.fs}`));break;case 4:this.emit("error",new Error(`MSP - Source not supported: ${this.url}${this.fs}`));break}else s&&s.currentTarget&&s.currentTarget.networkState===3?this.emit("error",new Error(`MSP - Source not found or unable to play: ${this.url}${this.fs}`)):this.emit("error",new Error("MSP - Unknown error"));e()}),this.emit("opened")})}close(){this.sound?(this.stop(),delete this.sound,this.sound=null):this.playing&&(this.playing=!1),this.emit("closed")}stop(){this.sound&&this.sound.stop(),this.playing=!1,this.emit("stopped")}},di=class extends Re{constructor(t){super(t instanceof Ve?t:t?.client);this.ln=!0;this.ql=!0;this.rr=1;this.server=!1;this.enableDebug=!1;this.defaultSoundURL="";this.defaultMusicURL="";this.forcedDefaultMusicURL="http://"+window.location.hostname+"/sounds/";this.forcedDefaultSoundURL="http://"+window.location.hostname+"/sounds/";this.defaultSoundExt=".m4a";this.defaultMusicExt=".m4a";this.MusicState=new ui;this.SoundState=new ui;this.parseMode=0;t&&!(t instanceof Ve)&&("forcedDefaultMusicURL"in t&&(this.forcedDefaultMusicURL=t.forcedDefaultMusicURL),"forcedDefaultSoundURL"in t&&(this.forcedDefaultSoundURL=t.forcedDefaultSoundURL)),this.MusicState.on("playing",e=>{e.type=1,this.emit("playing",e)}),this.SoundState.on("playing",e=>{e.type=0,this.emit("playing",e)}),this.MusicState.on("error",e=>{this.emit("error",e)}),this.SoundState.on("error",e=>{this.emit("error",e)}),this.MusicState.maxErrorRetries=this.rr,this.SoundState.maxErrorRetries=this.rr}remove(){if(!this.client)return;this.client.removeListenersFromCaller(this);let t=this.client.telnet.GMCPSupports.indexOf("Client.Media 1");this.client.telnet.GMCPSupports.splice(t,1)}initialize(){this.client&&(this.client.telnet.GMCPSupports.push("Client.Media 1"),this.client.on("connecting",()=>this.reset(),this),this.client.on("close",()=>this.reset(),this),this.client.on("received-option",this.ph,this),this.client.on("received-GMCP",this.lr,this),this.client.on("music",this.music,this),this.client.on("sound",this.sound,this),this.client.on("options-loaded",this._i,this),this.client.on("option-loaded",this.uh,this),this.client.on("function",this.Vl,this),this.on("playing",t=>{this.client&&(this.debug("MSP "+(t.type?"Music":"Sound")+" Playing "+t.file+" for "+t.duration),this.debug(t),this.client.getOption("notifyMSPPlay")&&this.client.echo((t.type?"Music":"Sound")+" Playing "+t.file+" for "+t.duration,-7,-8,!0,!0))}),this.on("debug",t=>this.client.debug(t),this),this.on("error",t=>this.client.error(t),this),this._i())}get menu(){return[]}get settings(){return[]}_i(){this.enableDebug=this.client.getOption("enableDebug"),this.enabled=this.client.getOption("enableMSP"),this.enableSound=this.client.getOption("enableSound"),this.maxErrorRetries=this.client.getOption("mspMaxRetriesOnError")}uh(t,e){switch(t){case"enableMSP":this.enabled=this.client.getOption("enableMSP");break;case"mspMaxRetriesOnError":this.maxErrorRetries=this.client.getOption("mspMaxRetriesOnError");break;case"enableSound":case"enableDebug":this[t]=e;break}}get enabled(){return this.ln}set enabled(t){t!==this.ln&&(this.ln=t,this.MusicState?.close(),this.SoundState?.close())}get maxErrorRetries(){return this.rr}set maxErrorRetries(t){t!==this.rr&&(this.rr=t,this.MusicState&&(this.MusicState.maxErrorRetries=t),this.SoundState&&(this.SoundState.maxErrorRetries=t))}get enableSound(){return this.ql}set enableSound(t){t!==this.ql&&(this.ql=t,this.MusicState?.close(),this.SoundState?.close())}reset(){this.server=!1}music(t){if(!this.enabled&&!this.enableSound)return!1;if(!t.file||t.file.length===0){t.off&&t.url&&t.url.length>0?this.defaultMusicURL=t.url:t.off&&this.MusicState.stop();return}else if(t.off){this.MusicState.stop();return}this.MusicState.volume=t.volume,this.MusicState.repeats=t.repeat,this.MusicState.continue=t.continue;let e=this.MusicState.file;t.file.lastIndexOf(".")===-1?this.MusicState.file=t.file+this.defaultMusicExt:this.MusicState.file=t.file,t.url&&t.url.length>0?this.MusicState.url=t.url:this.forcedDefaultMusicURL&&this.forcedDefaultMusicURL.length>0?this.MusicState.url=this.forcedDefaultMusicURL:this.defaultMusicURL&&this.defaultMusicURL.length>0?this.MusicState.url=this.defaultMusicURL:this.MusicState.url="",this.MusicState.url.length>0&&!this.MusicState.url.endsWith("/")&&(this.MusicState.url+="/"),t.type&&t.type.length>0&&(this.MusicState.url+=t.type,this.MusicState.url.length>0&&!this.MusicState.url.endsWith("/")&&(this.MusicState.url+="/")),(e!==this.MusicState.file||!t.continue||!this.MusicState.playing)&&(this.enableSound?this.MusicState.play():this.emit("playing",{type:1,file:this.MusicState.file,sound:this.MusicState.sound,state:this.MusicState,duration:"--:--"}))}sound(t){if(!this.enabled&&!this.enableSound)return!1;if(!t.file||t.file.length===0){t.off&&t.url&&t.url.length>0?this.defaultSoundURL=t.url:t.off&&this.SoundState.stop();return}else if(t.off){this.SoundState.stop();return}if(this.SoundState.playing&&t.priority<this.SoundState.priority)return!1;this.SoundState.volume=t.volume,this.SoundState.repeats=t.repeat,this.SoundState.priority=t.priority,t.file.lastIndexOf(".")===-1?this.SoundState.file=t.file+this.defaultSoundExt:this.SoundState.file=t.file,t.url&&t.url.length>0?this.SoundState.url=t.url:this.forcedDefaultSoundURL&&this.forcedDefaultSoundURL.length>0?this.SoundState.url=this.forcedDefaultSoundURL:this.defaultSoundURL&&this.defaultSoundURL.length>0?this.SoundState.url=this.defaultSoundURL:this.SoundState.url="",this.SoundState.url.length>0&&!this.SoundState.url.endsWith("/")&&(this.SoundState.url+="/"),t.type&&t.type.length>0&&(this.SoundState.url+=t.type,this.SoundState.url.length>0&&!this.SoundState.url.endsWith("/")&&(this.SoundState.url+="/")),this.enableSound?this.SoundState.play():this.emit("playing",{type:0,file:this.SoundState.file,sound:this.SoundState.sound,state:this.SoundState,duration:"--:--"})}ph(t){t.option===90&&(this.debug("<MSP>"),t.verb===253?(this.server=!0,this.enabled?(this.debug("REPLY: <IAC><WILL><MSP>"),t.telnet.sendData([255,251,90],!0)):(this.debug("REPLY: <IAC><DONT><MSP>"),t.telnet.sendData([255,254,90],!0))):t.verb===254?(this.server=!1,this.debug("REPLY: <IAC><WONT><MSP>"),t.telnet.sendData([255,252,90],!0)):t.verb===251?(this.server=!0,this.enabled?(this.debug("REPLY: <IAC><DO><MSP>"),t.telnet.sendData([255,253,90],!0)):(this.debug("REPLY: <IAC><DONT><MSP>"),t.telnet.sendData([255,254,90],!0))):t.verb===252&&(this.server=!1,this.debug("REPLY: <IAC><DONT><MSP>"),t.telnet.sendData([255,254,90],!0)),t.handled=!0)}async lr(t,e){switch(t){case"Client.Media.Default":e.type==="sound"||!e.type?this.sound({off:!0,url:e.url}):e.type==="music"&&this.music({off:!0,url:e.url});break;case"Client.Media.Load":break;case"Client.Media.Play":let s={off:!1,file:e.name,url:"",volume:50,repeat:1,priority:50,type:"",continue:!0};e.hasOwnProperty("url")&&(s.url=e.url),e.hasOwnProperty("tag")&&(s.type=e.tag),e.hasOwnProperty("volume")&&(s.volume=e.volume),e.hasOwnProperty("loops")&&(s.repeat=e.loops),e.hasOwnProperty("priority")&&(s.priority=e.priority),e.type==="sound"||!e.type?this.sound(s):e.type==="music"&&(e.hasOwnProperty("continue")&&(e.continue==="false"||!e.continue)&&(s.continue=!1),this.music(s));break;case"Client.Media.Stop":e.type==="sound"||!e.type?this.sound({off:!0}):e.type==="music"&&this.music({off:!0});break}}debug(t){this.enableDebug&&this.emit("debug",t)}Vl(t){let e,s,n;if(t)switch(t.name.toLowerCase()){case"soundinfo":this.SoundState.playing?this.client.echo("Playing Sound - "+this.SoundState.file+" - "+kt.toTimer(this.SoundState.sound.getTime())+"/"+kt.toTimer(this.SoundState.sound.getDuration()),-7,-8,!0,!0):this.client.echo("No sound currently playing.",-7,-8,!0,!0),t.handled=!0;break;case"musicinfo":this.MusicState.playing?this.client.echo("Playing Music - "+this.MusicState.file+" -  "+kt.toTimer(this.MusicState.sound.getTime())+"/"+kt.toTimer(this.MusicState.sound.getDuration()),-7,-8,!0,!0):this.client.echo("No music currently playing.",-7,-8,!0,!0),t.handled=!0;break;case"playmusic":case"playm":e=this.client.input.parseOutgoing(t.args.join(" "),!1),s={off:!1,file:"",url:"",volume:100,repeat:1,priority:50,type:"",continue:!0},n=e.lastIndexOf("/"),n===-1?s.file=e:(s.file=e.substring(n+1),s.url=e.substring(0,n+1)),this.music(s),t.handled=!0;break;case"playsound":case"plays":e=this.client.input.parseOutgoing(t.args.join(" "),!1),s={off:!1,file:"",url:"",volume:100,repeat:1,priority:50,type:"",continue:!0},n=e.lastIndexOf("/"),n===-1?s.file=e:(s.file=e.substring(n+1),s.url=e.substring(0,n+1)),this.sound(s),t.handled=!0;break;case"stopmusic":case"stopm":this.MusicState.close(),t.handled=!0;break;case"stopsound":case"stops":this.SoundState.close(),t.handled=!0;break;case"stopallsound":case"stopa":this.MusicState.close(),this.SoundState.close(),t.handled=!0;break}}};var fi=class extends Re{constructor(t){super(t);this.functions={};this.Kl=e=>this.Vl(e),this.functions.testfile=e=>{if(e&&e.args&&e.args.length)throw new Error("Invalid syntax use "+this.client.getOption("commandChar")+"testfile");Se().then(s=>{console.time("testfile readFile"),Ee(s[0]).then(n=>{console.timeEnd("testfile readFile"),e&&e.raw&&(this.client.getOption("echo")&4)===4&&this.client.echo(e.raw,-3,-4,!0,!0);let r=this.client.getOption("enableCommands");this.client.setOption("enableCommands",!0);let o=new Date().getTime();console.time("testfile parse"),this.client.sendCommand(n,null,this.client.getOption("allowCommentsFromCommand")),console.timeEnd("testfile parse");let a=new Date().getTime();this.client.setOption("enableCommands",r),this.client.print(`Time: ${a-o}
`,!0)}).catch(n=>this.client.error(n))}).catch(()=>{})},this.functions.testfiler=e=>{if(e&&e.args&&e.args.length)throw new Error("Invalid syntax use "+this.client.getOption("commandChar")+"testfile");Se().then(s=>{console.time("testfile readFile"),Ee(s[0]).then(n=>{console.timeEnd("testfile readFile"),e&&e.raw&&(this.client.getOption("echo")&4)===4&&this.client.echo(e.raw,-3,-4,!0,!0);let r=this.client.getOption("enableCommands");this.client.setOption("enableCommands",!0);let o=new Date().getTime();console.time("testfiler parse"),this.client.telnet.receivedData(at(n),!0,!0),console.timeEnd("testfiler parse");let a=new Date().getTime();this.client.setOption("enableCommands",r),this.client.print(`Time: ${a-o}
`,!0)}).catch(n=>this.client.error(n))}).catch(()=>{})},this.functions.testspeedfile=e=>{if(e&&e.args&&e.args.length)throw new Error("Invalid syntax use "+this.client.getOption("commandChar")+"testspeedfile");Se().then(s=>{console.time("testspeedfile readFile"),Ee(s[0]).then(n=>{console.timeEnd("testspeedfile readFile"),e&&e.raw&&(this.client.getOption("echo")&4)===4&&this.client.echo(e.raw,-3,-4,!0,!0);let r=0,o=0,a=0,h=[],c;console.time("testspeedfile");for(let g=0;g<10;g++){let m=new Date().getTime();console.time(`testspeedfile parse ${g}`),this.client.sendCommand(n,null,this.client.getOption("allowCommentsFromCommand")),console.timeEnd(`testspeedfile parse ${g}`),c=new Date().getTime()-m,r+=c,c>o&&(o=c),(!a||c<a)&&(a=c),h.push(`${g} - ${c}`)}console.timeEnd("testspeedfile"),h.push(`Total - ${r}`),h.push(`Average - ${r/10}`),h.push(`Min - ${a}`),h.push(`Max - ${o}`),this.client.print(h.join(`
`)+`
`,!0)}).catch(n=>this.client.error(n))}).catch(()=>{})},this.functions.testspeedfiler=e=>{if(e&&e.args&&e.args.length)throw new Error("Invalid syntax use "+this.client.getOption("commandChar")+"testspeedfiler");Se().then(s=>{console.time("testspeedfile readFile"),Ee(s[0]).then(n=>{console.timeEnd("testspeedfile readFile"),e&&e.raw&&(this.client.getOption("echo")&4)===4&&this.client.echo(e.raw,-3,-4,!0,!0);let r=0,o=0,a=0,h=[],c;console.time("testspeedfile");for(let g=0;g<10;g++){let m=new Date().getTime();console.time(`testspeedfile parse ${g}`),this.client.telnet.receivedData(at(n),!0,!0),console.timeEnd(`testspeedfile parse ${g}`),c=new Date().getTime()-m,r+=c,c>o&&(o=c),(!a||c<a)&&(a=c),h.push(`${g} - ${c}`)}console.timeEnd("testspeedfile"),h.push(`Total - ${r}`),h.push(`Average - ${r/10}`),h.push(`Min - ${a}`),h.push(`Max - ${o}`),this.client.print(h.join(`
`)+`
`,!0)}).catch(n=>this.client.error(n))}).catch(()=>{})},this.functions.testlist=()=>{let e=`Test commands:
`,s;for(s in this.functions)this.functions.hasOwnProperty(s)&&(e+=`	${this.client.getOption("commandChar")+s}
`);this.client.print(e,!0)},this.functions.testcolors=()=>{let e,s=`Colors and Styles
-------------------------------------------------------------------------------------------
`;for(e=30;e<38;e++)s+="\x1B["+e+";0m"+e+"\x1B[0m ",s+="\x1B["+e+";1mBold\x1B[0m ",s+="\x1B["+e+";2mFaint\x1B[0m ",s+="\x1B["+e+";3mItalic\x1B[0m ",s+="\x1B["+e+";4mUnderline\x1B[0m ",s+="\x1B["+e+";5mFlash\x1B[0m ",s+="\x1B["+e+";7mInverse\x1B[0m ",s+="\x1B["+e+";8mConceal\x1B[0m ",s+="\x1B["+e+";9mStrikeout\x1B[0m ",s+="\x1B["+e+";21mDoubleUnderline\x1B[0m ",s+="\x1B["+e+";53mOverline\x1B[0m ",s+="\x1B["+e+";1;2;3;4;5;9;21;53mAll\x1B[0m",s+=`\x1B[0m
`;for(e=40;e<48;e++)s+="\x1B["+e+";0m"+e+"\x1B[0m ",s+="\x1B["+e+";1mBold\x1B[0m ",s+="\x1B["+e+";2mFaint\x1B[0m ",s+="\x1B["+e+";3mItalic\x1B[0m ",s+="\x1B["+e+";4mUnderline\x1B[0m ",s+="\x1B["+e+";5mFlash\x1B[0m ",s+="\x1B["+e+";7mInverse\x1B[0m ",s+="\x1B["+e+";8mConceal\x1B[0m ",s+="\x1B["+e+";9mStrikeout\x1B[0m ",s+="\x1B["+e+";21mDoubleUnderline\x1B[0m ",s+="\x1B["+e+";53mOverline\x1B[0m ",s+="\x1B["+e+";1;2;3;4;5;9;21;53mAll\x1B[0m",s+=`\x1B[0m
`;s+=`-------------------------------------------------------------------------------------------
`,this.client.print(s,!0)},this.functions.testcolorsdetails=()=>{let e="";this.client.telnet.prompt&&(e=`
`),e+=`Table for 16-color terminal escape sequences.
`,e+=`
`,e+=`Background        | Foreground colors
`,e+=`------------------------------------------------------------------------------------
`;for(let s=40;s<=47;s++){let n;for(n in Rt)if(typeof Rt[n]=="number"&&n!=="Rapid"){n==="None"?e+="\x1B[0m "+jt[s-10].toString().padEnd(16)+" | ":e+="\x1B[0m "+n.padEnd(16)+" | ";for(let r=30;r<=37;r++)n==="None"?e+="\x1B["+s+"m\x1B["+r+"m "+("["+r+"m").padEnd(7):e+="\x1B["+s+"m\x1B["+Rt[n]+";"+r+"m "+("["+Rt[n]+";"+r+"m").padEnd(7);e+=`\x1B[0m
`}e+=`------------------------------------------------------------------------------------
`}this.client.print(e,!0)},this.functions.testxterm=e=>{let s,n,r,o,a="";for(typeof e<"u"&&e.length>0&&(a+="Set Title: ",a+=e,a+="\x1B]0;",a+=e,a+=`\x07
`),a+=`System colors:
`,o=0;o<8;o++)a+="\x1B[48;5;"+o+"m  ";for(a+=`\x1B[0m
`,o=8;o<16;o++)a+="\x1B[48;5;"+o+"m  ";for(a+=`\x1B[0m

`,a+=`Color cube, 6x6x6:
`,n=0;n<6;n++){for(s=0;s<6;s++){for(r=0;r<6;r++)o=16+s*36+n*6+r,a+="\x1B[48;5;"+o+"m  ";a+="\x1B[0m "}a+=`
`}for(a+=`Grayscale ramp:
`,o=232;o<256;o++)a+="\x1B[48;5;"+o+"m  ";a+=`\x1B[0m
`,this.client.print(a,!0)},this.functions.testmxp=()=>{let e=`Text Formatting
`;e+="	\x1B[6z",e+=`<!--Test-->&lt;!--Test--&gt;
`,e+=`	<!--Test>-->&lt;!--Test&gt;--&gt;
`,e+=`	<STRONG>STRONG</STRONG>
`,e+=`	<BOLD>BOLD</BOLD>
`,e+=`	<B>B</B>
`,e+=`	<I>I</I>
`,e+=`	<ITALIC>ITALIC</ITALIC>
`,e+=`	<EM>EM</EM>
`,e+=`	<U>U</U>
`,e+=`	<UNDERLINE>UNDERLINE</UNDERLINE>
`,e+=`	<S>S</S>
`,e+=`	<STRIKEOUT>STRIKEOUT</STRIKEOUT>
`,e+=`	<H>H</H>
`,e+=`	<HIGH>HIGH</HIGH>
`,e+=`	<C RED>C RED</C>
`,e+=`	<COLOR #F00>COLOR #F00</COLOR>
`,e+=`	<C Maroon>C Maroon</C>
`,e+=`	<COLOR #800000>COLOR #800000</COLOR>
`,e+=`	<H><C Maroon>H C Maroon</C></H>
`,e+=`	<H><COLOR #800000>H COLOR #800000</COLOR></H>
`,e+=`	Run <send PROMPT>#testmxpcolors</send> for a detailed list.
`,e+=`	<FONT "Times New Roman">FONT "Times New Roman"</FONT>
`,e+=`	<FONT "Webdings">FONT "Webdings"</FONT>
`,e+=`	<FONT COLOR=Red,Blink>FONT COLOR=Red,Blink</FONT>
`,e+=`	<FONT "Times New Roman" 24 RED GREEN>FONT "Times New Roman" 24 RED GREEN</FONT>
`,e+=`Line Spacing
`,e+=`	NOBR<NOBR>
`,e+=` Continued<NOBR>
`,e+=` More
`,e+=`	<P>P
`,e+=`	1
`,e+=`	2
`,e+=`	3
`,e+=`	4</P>
`,e+=`	BR Line<BR>Break
`,e+=`	SBR Soft<SBR>Break
`,e+=`Links
`,e+=`	<A "http://shadowmud.com">Click here for ShadowMUD</A> 
`,e+=`	<send>test command</send>
`,e+=`	<send href="command2">test command2</send>
`,e+=`	<send "command1|command2|command3" hint="click to see menu|Item 1|Item 2|Item 3">this is a menu link</SEND>
`,e+=`	<SEND "sample" PROMPT EXPIRE=prompt>Prompt sample</SEND>
`,e+=`	<send PROMPT href="#testmxpexpire">&lt;EXPIRE&gt; - #testmxpexpire</send> 
`,e+=`Horizontal Rule
`,e+=`<hr>
`,e+=`<hr>Text After
`,e+=`Text Before<hr>
`,e+=`<c red blue><hr></c>
`,e+=`Text Before<hr>Text After
`,e+=`Custom Element
`,e+=`	<!ELEMENT help '<send href="help &text;">'>&lt;!ELEMENT help '&lt;send href="help &amp;text;"&gt;'&gt;
`,e+=`	&lt;help&gt;test&lt;/help&gt; = <help>test</help>
`,e+=`	<!ELEMENT redbu '<c red><b><u>'>&lt;!ELEMENT redbu '&lt;c red&gt;&lt;b&gt;&lt;u&gt;'&gt;
`,e+=`	&lt;redbu&gt;test&lt;/redbu&gt; = <redbu>test</redbu>
`,e+=`Entities
`,e+=`	&#243;&brvbar;&copy;&plusmn;&sup3;&para;&frac34;&infin;&Dagger;&dagger;&spades;&clubs;&hearts;&diams;
`,e+=`Custom Entity
`,e+='	<!ENTITY version "'+this.client.version+'">&lt;!ENTITY version "'+this.client.version+`"&gt;
`,e+=`	&amp;version; = &version;
`,e+=`	&lt;V Hp&gt;<V Hp>100</V>&lt;/V&gt; &amp;Hp; = &Hp; &amp;hp; = &hp;
`,e+=`	&lt;VAR Sp&gt;<VAR Sp>200</VAR>&lt;/VAR&gt; &amp;Sp; = &Sp; &amp;sp; = &sp;
`,e+=`Image
`,e+=`default      <image connected.png URL="./images/" w=48 h=48>
`,e+=`align left <image connected.png URL="./images/" align=left w=48 h=48> align left
`,e+=`align right  <image connected.png URL="./images/" align=right w=48 h=48> align right
`,e+=`align top    <image connected.png URL="./images/" align=top w=48 h=48> align top 
`,e+=`align middle <image connected.png URL="./images/" align=middle w=48 h=48> align middle
`,e+=`align bottom <image connected.png URL="./images/" align=bottom w=48 h=48> align bottom
`,e+=`map          <send showmap><image connected.png URL="./images/" ismap w=48 h=48></send>
`,e+="<STAT Hp version Test>",e+="<GAUGE Hp version Test>",e+="\x1B[0z",this.client.print(e,!0)},this.functions.testmxp2=()=>{let e="\x1B[6z";e+="<!-- Elements to support the Auto mapper -->",e+=`<!ELEMENT RName '<FONT COLOR=Red><B>' FLAG="RoomName">`,e+="<!ELEMENT RDesc FLAG='RoomDesc'>",e+="<!ELEMENT RExits '<FONT COLOR=Blue>' FLAG='RoomExit'>",e+="<!-- The next element is used to define a room exit link that sends ",e+="the exit direction to the MUD if the user clicks on it -->",e+="<!ELEMENT Ex '<SEND>'>",e+="<!ELEMENT Chat '<FONT COLOR=Gray>' OPEN>",e+="<!ELEMENT Gossip '<FONT COLOR=Cyan>' OPEN>",e+="<!-- in addition to standard HTML Color specifications, you can use ",e+="color attribute names such as blink -->",e+="<!ELEMENT ImmChan '<FONT COLOR=Red,Blink>'>",e+="<!ELEMENT Auction '<FONT COLOR=Purple>' OPEN>",e+="<!ELEMENT Group '<FONT COLOR=Blue>' OPEN>",e+="<!-- the next elements deal with the MUD prompt -->",e+='<!ELEMENT Prompt FLAG="Prompt">',e+='<!ELEMENT Hp FLAG="Set hp">',e+='<!ELEMENT MaxHp FLAG="Set maxhp">',e+='<!ELEMENT Mana FLAG="Set mana">',e+='<!ELEMENT MaxMana FLAG="Set maxmana">',e+="<!-- now the MUD text -->",e+=`<RName>The Main Temple</RName>
`,e+=`<RDesc>This is the main hall of the MUD where everyone starts.
`,e+=`Marble arches lead south into the town, and there is a <i>lovely</i>
`,e+=`<send "drink &text;">fountain</send> in the center of the temple,</RDesc>
`,e+=`<RExits>Exits: <Ex>N</Ex>, <Ex>S</Ex>, <Ex>E</Ex>, <Ex>W</Ex></RExits>

`,e+=`<Prompt>[<Hp>100</Hp>/<MaxHp>120</MaxHp>hp <Mana>50</Mana>/<MaxMana>55</MaxMana>mana]</Prompt>
<hr>`,e+="<!ELEMENT boldtext '<COLOR &col;><B>' ATT='col=red'>",e+=`<boldtext>This is bold red</boldtext>
`,e+=`<boldtext col=blue>This is bold blue text</boldtext>
`,e+=`<boldtext blue>This is also bold blue text</boldtext>
`,e+="\x1B[0z",this.client.print(e,!0)},this.functions.testmxpexpire=()=>{this.client.print(`	\x1B[6z<SEND "sample" PROMPT EXPIRE=prompt>Expire sample</SEND> <SEND "sample" PROMPT EXPIRE=prompt2>Expire sample2</SEND><EXPIRE prompt> <SEND "sample" PROMPT EXPIRE=prompt>Expire sample3</SEND>\x1B[0z
`,!0),this.client.print(`	\x1B[6z\x1B[36m<SEND "sample" PROMPT EXPIRE=prompt>Expire sample</SEND> <SEND "sample" PROMPT EXPIRE=prompt2>Expire sample2</SEND><EXPIRE prompt> <SEND "sample" PROMPT EXPIRE=prompt>Expire sample3</SEND>\x1B[0z\x1B[0m
`,!0),this.client.print(`	\x1B[6z\x1B[46;30m<SEND "sample" PROMPT EXPIRE=prompt>Expire sample</SEND> <SEND "sample" PROMPT EXPIRE=prompt2>Expire sample2</SEND><EXPIRE prompt> <SEND "sample" PROMPT EXPIRE=prompt>Expire sample3</SEND>\x1B[0z\x1B[0m
`,!0),this.client.print(`	\x1B[6z<SEND "sample" PROMPT EXPIRE=prompt>Expire \x1B[36msample\x1B[0m</SEND> <SEND "sample" PROMPT EXPIRE=prompt2>Expire \x1B[36msample2\x1B[0m</SEND><EXPIRE prompt> <SEND "sample" PROMPT EXPIRE=prompt>Expire \x1B[36msample3\x1B[0m</SEND>\x1B[0z
`,!0)},this.functions.testmxpcolors=()=>{let e=["IndianRed","LightCoral","Salmon","DarkSalmon","LightSalmon","Crimson","Red","FireBrick","DarkRed","Pink","LightPink","HotPink","DeepPink","MediumVioletRed","PaleVioletRed","LightSalmon","Coral","Tomato","OrangeRed","DarkOrange","Orange","Gold","Yellow","LightYellow","LemonChiffon","LightGoldenrodYellow","PapayaWhip","Moccasin","PeachPuff","PaleGoldenrod","Khaki","DarkKhaki","Lavender","Thistle","Plum","Violet","Orchid","Fuchsia","Magenta","MediumOrchid","MediumPurple","BlueViolet","DarkViolet","DarkOrchid","DarkMagenta","Purple","Indigo","SlateBlue","DarkSlateBlue","MediumSlateBlue","GreenYellow","Chartreuse","LawnGreen","Lime","LimeGreen","PaleGreen","LightGreen","MediumSpringGreen","SpringGreen","MediumSeaGreen","SeaGreen","ForestGreen","Green","DarkGreen","YellowGreen","OliveDrab","Olive","DarkOliveGreen","MediumAquamarine","DarkSeaGreen","LightSeaGreen","DarkCyan","Teal","Aqua","Cyan","LightCyan","PaleTurquoise","Aquamarine","Turquoise","MediumTurquoise","DarkTurquoise","CadetBlue","SteelBlue","LightSteelBlue","PowderBlue","LightBlue","SkyBlue","LightSkyBlue","DeepSkyBlue","DodgerBlue","CornflowerBlue","MediumSlateBlue","RoyalBlue","Blue","MediumBlue","DarkBlue","Navy","MidnightBlue","Cornsilk","BlanchedAlmond","Bisque","NavajoWhite","Wheat","BurlyWood","Tan","RosyBrown","SandyBrown","Goldenrod","DarkGoldenrod","Peru","Chocolate","SaddleBrown","Sienna","Brown","Maroon","White","Snow","Honeydew","MintCream","Azure","AliceBlue","GhostWhite","WhiteSmoke","Seashell","Beige","OldLace","FloralWhite","Ivory","AntiqueWhite","Linen","LavenderBlush","MistyRose","Gainsboro","LightGrey","Silver","DarkGray","Gray","DimGray","LightSlateGray","SlateGray","DarkSlateGray","Black"],s="\x1B[6z",n=e.length-1;for(let r=0;r<n;r++)s+=""+e[r]+": ",s+=Array(22-e[r].length).join(" "),s+="<C "+e[r]+">Fore</C> ",s+="<C black "+e[r]+">Back</C> ",s+="<h><C "+e[r]+">High</C></h> ",s+="<b><C "+e[r]+">Bold</C></b> ",s+="<C "+e[r]+">\x1B[1mAnsiBold\x1B[0m ",s+="\x1B[2mFaint\x1B[0m ",s+="\x1B[3mItalic\x1B[0m ",s+="\x1B[4mUnderline\x1B[0m ",s+="\x1B[5mFlash\x1B[0m ",s+="\x1B[7mInverse\x1B[0m ",s+="\x1B[8mConceal\x1B[0m ",s+="\x1B[9mStrikeout\x1B[0m ",s+="\x1B[21mDoubleUnderline\x1B[0m ",s+="\x1B[53mOverline\x1B[0m",s+=`</C>
`;s+="Black: ",s+=Array(17).join(" "),s+="<C Black silver>Fore</C> ",s+="<C silver Black>Back</C> ",s+="<h><C Black silver>High</C></h> ",s+="<b><C Black silver>Bold</C></b> ",s+="<C Black silver>\x1B[1mAnsiBold\x1B[0m ",s+="\x1B[2mFaint\x1B[0m ",s+="\x1B[3mItalic\x1B[0m ",s+="\x1B[4mUnderline\x1B[0m ",s+="\x1B[5mFlash\x1B[0m ",s+="\x1B[7mInverse\x1B[0m ",s+="\x1B[8mConceal\x1B[0m ",s+="\x1B[9mStrikeout\x1B[0m ",s+="\x1B[21mDoubleUnderline\x1B[0m ",s+="\x1B[53mOverline\x1B[0m",s+=`</C>
`,s+="\x1B[0z",this.client.print(s,!0)},this.functions.testmxpelements=()=>{let e="\x1B[6z";e+=`Custom Element
`,e+=`	<!ELEMENT help '<send href="help &text;">'>&lt;!ELEMENT help '&lt;send href="help &amp;text;"&gt;'&gt;
`,e+=`	&lt;help&gt;test&lt;/help&gt; = <help>test</help>
`,e+=`	<!ELEMENT redbu '<c red><b><u>'>&lt;!ELEMENT redbu '&lt;c red&gt;&lt;b&gt;&lt;u&gt;'&gt;
`,e+=`	&lt;redbu&gt;test&lt;/redbu&gt; = <redbu>test</redbu>
`,e+="\x1B[0z",this.client.print(e,!0)},this.functions.testmxplines=()=>{let e="\x1B[6z";e+="<!ELEMENT Auction '<FONT COLOR=red>' TAG=20 OPEN>",e+=`\x1B[20zA nice shiny sword is being auctioned.
`,e+="\x1B[6z<Auction>Also, a gold ring is being auctioned.</Auction>",e+=`<!ELEMENT Auction TAG=20>
`,e+=`<!TAG 20 Fore=red>
`,e+=`\x1B[20zA nice shiny sword is being auctioned.
`,e+=`\x1B[6z<Auction>Also, a gold ring is being auctioned.</Auction>
`,e+=`\x1B[6z<!TAG 20 Fore=blue>
`,e+=`\x1B[20zA nice shiny sword is being auctioned.
`,e+=`\x1B[6z<Auction>Also, a gold ring is being auctioned.</Auction>
`,e+="\x1B[0z",this.client.print(e,!0)},this.functions.testmapper=()=>{this.client.emit("received-GMCP","Room.Info",{details:[],doors:{},prevroom:{num:0,dir:"",area:""},area:"Doc Build Samples Area",exits:{south:{num:87723359,dir:"south",area:"Doc Build Samples Area",isdoor:0},east:{num:-329701270,dir:"east",area:"Doc Build Samples Area",isdoor:0}},name:"Sample room 1",num:1968208336,indoors:0}),this.client.emit("received-GMCP","Room.Info",{details:[],doors:{},prevroom:{num:1968208336,dir:"east",area:"Doc Build Samples Area"},area:"Doc Build Samples Area",environment:"wood",exits:{south:{num:1916648905,dir:"south",area:"Doc Build Samples Area",isdoor:0},east:{num:-1688332036,dir:"east",area:"Doc Build Samples Area",isdoor:0},west:{num:1968208336,dir:"west",area:"Doc Build Samples Area",isdoor:0}},name:"Sample room 2",num:-329701270,indoors:0}),this.client.emit("received-GMCP","Room.Info",{details:[],doors:{},prevroom:{num:-329701270,dir:"east",area:"Doc Build Samples Area"},area:"Doc Build Samples Area",environment:"jungle",exits:{south:{num:-348853133,dir:"south",area:"Doc Build Samples Area",isdoor:0},west:{num:-329701270,dir:"west",area:"Doc Build Samples Area",isdoor:0}},name:"Sample room 3",num:-1688332036,indoors:0}),this.client.emit("received-GMCP","Room.Info",{details:[],doors:{},prevroom:{num:-1688332036,dir:"south",area:"Doc Build Samples Area"},area:"Doc Build Samples Area",environment:"grass",exits:{north:{num:-1688332036,dir:"north",area:"Doc Build Samples Area",isdoor:0},south:{num:2072768994,dir:"south",area:"Doc Build Samples Area",isdoor:0},west:{num:1916648905,dir:"west",area:"Doc Build Samples Area",isdoor:0}},name:"Sample room 6",num:-348853133,indoors:0}),this.client.emit("received-GMCP","Room.Info",{details:[],doors:{},prevroom:{num:-348853133,dir:"west",area:"Doc Build Samples Area"},area:"Doc Build Samples Area",environment:"desert",exits:{north:{num:-329701270,dir:"north",area:"Doc Build Samples Area",isdoor:0},south:{num:210551156,dir:"south",area:"Doc Build Samples Area",isdoor:0},east:{num:-348853133,dir:"east",area:"Doc Build Samples Area",isdoor:0},west:{num:87723359,dir:"west",area:"Doc Build Samples Area",isdoor:0}},name:"Sample room 5",num:1916648905,indoors:1}),this.client.emit("received-GMCP","Room.Info",{details:[],doors:{},prevroom:{num:1916648905,dir:"west",area:"Doc Build Samples Area"},area:"Doc Build Samples Area",environment:"tundra",exits:{north:{num:1968208336,dir:"north",area:"Doc Build Samples Area",isdoor:0},south:{num:-1674322715,dir:"south",area:"Doc Build Samples Area",isdoor:0},east:{num:87723359,dir:"east",area:"Doc Build Samples Area",isdoor:0}},name:"Sample room 4",num:87723359,indoors:0}),this.client.emit("received-GMCP","Room.Info",{details:[],doors:{},prevroom:{num:87723359,dir:"south",area:"Doc Build Samples Area"},area:"Doc Build Samples Area",environment:"water",exits:{north:{num:87723359,dir:"north",area:"Doc Build Samples Area",isdoor:0},east:{num:210551156,dir:"east",area:"Doc Build Samples Area",isdoor:0}},name:"Sample room 7",num:-1674322715,indoors:0}),this.client.emit("received-GMCP","Room.Info",{details:[],doors:{},prevroom:{num:-1674322715,dir:"east",area:"Doc Build Samples Area"},area:"Doc Build Samples Area",environment:"jungle",exits:{north:{num:1916648905,dir:"north",area:"Doc Build Samples Area",isdoor:0},east:{num:2072768994,dir:"east",area:"Doc Build Samples Area",isdoor:0},west:{num:-1674322715,dir:"west",area:"Doc Build Samples Area",isdoor:0}},name:"Sample room 8",num:210551156,indoors:0}),this.client.emit("received-GMCP","Room.Info",{details:[],doors:{},prevroom:{num:210551156,dir:"east",area:"Doc Build Samples Area"},area:"Doc Build Samples Area",exits:{north:{num:-348853133,dir:"north",area:"Doc Build Samples Area",isdoor:0},west:{num:210551156,dir:"west",area:"Doc Build Samples Area",isdoor:0}},name:"Sample room 9",num:2072768994,indoors:0})},this.functions.teststatus=e=>{this.client.emit("received-GMCP","Char.Base",{name:"Tester",class:"fighter",subclass:"None",race:"human",level:1,gender:"male"}),this.client.emit("received-GMCP","Char.Vitals",{hp:75,hpmax:100,sp:50,spmax:100,mp:25,mpmax:100}),this.client.emit("received-GMCP","Char.Experience",{current:50,need:100,needPercent:50,earned:200,banked:300}),this.client.emit("received-GMCP","oMUD.limb",{head:10,torso:20,"left arm":30,"right arm":40,"left hand":50,"right hand":60,"left leg":70,"right leg":80,"right foot":90,"left foot":100,"left wing":90,"right wing":80,tail:70}),this.client.emit("received-GMCP","oMUD.ac",{head:0,torso:1,"left arm":2,"right arm":3,"left hand":3.5,"right hand":4,"left leg":4.5,"right leg":5,"right foot":5.5,"left foot":6,"left wing":6.5,"right wing":5,tail:4,overall:4}),this.client.emit("received-GMCP","oMUD.weapons",{"right hand":{name:"knife",type:"knife",subtype:"dagger",material:"iron",quality:"poor",dominant:1},"left hand":{name:"club",type:"blunt",subtype:"club",material:"wood",quality:"ordinary",dominant:0}}),e&&e.args&&e.args.indexOf("night")!==-1?this.client.emit("received-GMCP","oMUD.Environment",{tod:"night",moons:["waning","full","waxing"]}):this.client.emit("received-GMCP","oMUD.Environment",{tod:"day"}),this.client.emit("received-GMCP","oMUD.skill",{skill:"knife",percent:60}),this.client.emit("received-GMCP","oMUD.skill",{skill:"knife",amount:100,bonus:5,category:"weapon"}),this.client.emit("received-GMCP","oMUD.skill",{skill:"small sword",percent:100});let s=!1;this.client.emit("received-GMCP","oMUD.skill",{skill:"small sword",amount:1150,bonus:0,category:"weapon"}),e&&e.args&&e.args.length&&e.args.forEach(n=>{if(n.startsWith("party:")){s=!0;let r=parseInt(n.split(":")[1],10);for(let o=0;o<r;o++)this.client.emit("received-GMCP","oMUD.party",{action:"update",name:"Party "+(o+1),hp:50,race:"human",id:o})}}),s||(this.client.emit("received-GMCP","oMUD.party",{action:"update",name:"Elf",hp:50,race:"elf",id:1}),this.client.emit("received-GMCP","oMUD.party",{action:"update",name:"Dwarf",hp:100,race:"dwarf",id:2})),s=!1,e&&e.args&&e.args.length&&e.args.forEach(n=>{if(n.startsWith("monster:")){s=!0;let r=parseInt(n.split(":")[1],10);for(let o=0;o<r;o++)this.client.emit("received-GMCP","oMUD.combat",{action:"update",name:"Monster "+(o+1),hp:50,race:"orc",id:o,order:0})}}),s||(this.client.emit("received-GMCP","oMUD.combat",{action:"update",name:"Monster",hp:50,race:"orc",id:3,order:0}),this.client.emit("received-GMCP","oMUD.combat",{action:"update",name:"Monster 2",hp:100,race:"dragon",id:4,order:1}),this.client.emit("received-GMCP","oMUD.combat",{action:"update",name:"Monster with extra super long name to test",hp:100,race:"dragon",id:5,order:2}))},this.functions.testfansi=()=>{let e="",s;for(e="",s=3;s<=6;s++)e+=String.fromCharCode(s);for(s=14;s<=26;s++)e+=String.fromCharCode(s);for(s=28;s<=31;s++)e+=String.fromCharCode(s);for(s=127;s<=254;s++)e+=String.fromCharCode(s);e+=`
`;let n=this.client.display.displayControlCodes;this.client.display.displayControlCodes=!0,this.client.display.emulateTerminal?(this.client.display.emulateTerminal=!1,this.client.print(e,!0),this.client.display.emulateTerminal=!0,this.client.print(e,!0)):(this.client.print(e,!0),this.client.display.emulateTerminal=!0,this.client.print(e,!0),this.client.display.emulateTerminal=!1),this.client.display.displayControlCodes=n},this.functions.testcontrolchars=()=>{let e,s="1:  ,";for(e=3;e<=9;e++)s+=`${e}: ${String.fromCharCode(e)},`;for(e=11;e<=27;e++)s+=`${e}: ${String.fromCharCode(e)},`;for(e=28;e<=31;e++)s+=`${e}: ${String.fromCharCode(e)},`;for(e=127;e<=254;e++)s+=`${e}: ${String.fromCharCode(e)},`;s+=`
`;let n=this.client.display.displayControlCodes;this.client.display.displayControlCodes=!0,this.client.print(s,!0),this.client.display.displayControlCodes=n},this.functions.testurldetect=()=>{let e=`\x1B[0mhttp://www.google.com
`;e+=`	http://www.google.com\x1B[44m
`,e+=`http://www.google.com
`,e+=`	try this http://www.google.com
`,e+=`http://www.google.com try this
`,e+=`	try this http://www.google.com try this
`,e+=`\x1B[36mhttp://www.google.com
`,e+=`	\x1B[0mhttp://www.google.com
`,e+=`http://www.google.com\x1B[44m
`,e+=`	http://www.google.com
`,e+=`try this http://www.google.com
`,e+=`	http://www.google.com try this
`,e+=`try this http://www.google.com try this
`,e+=`	\x1B[36mhttp://www.google.com
`,e+=`	https://localhost telnet://localhost
`,e+=`	news://test.edu/default.asp?t=1#1111 torrent://localhost/
`,e+=`	ftp://localhost gopher://localhost im://talk
`,e+=`	mailto:address@localhost irc://<host>[:<port>]/[<channel>[?<password>]]
`,e+=`awww... www.google.com awww.com
`,e+="www.google.com www.google.com\x1B[0m",this.client.print(e,!0)},this.functions.testxtermrgb=()=>{let e="",s,n,r,o=0;for(s=0;s<256;s+=16)for(n=0;n<256;n+=16)for(r=0;r<256;r+=16)e+="\x1B[48;2;"+s+";"+n+";"+r+"m  ",o%63===0&&(e+=`
`),o++;e+="\x1B[0m",this.client.print(e,!0)},this.functions.testsize=()=>{let e=this.client.display.WindowSize,s=e.width+"x"+e.height+" ";e.width-=s.length;for(let n=0;n<e.width;n++)s+="w";for(let n=1;n<e.height;n++)s+=`
`+n;this.client.print(s,!0)},this.functions.testspeed=()=>{let e=[],s=this.client.getOption("commandChar")+["testmxpcolors","testmxp","testcolors","testcolorsdetails","testxterm","testxtermrgb"].join(`
`+this.client.getOption("commandChar")),n=this.client.getOption("enableCommands");this.client.setOption("enableCommands",!0);let r=0,o=0,a=0,h;for(let c=0;c<10;c++){let g=new Date().getTime();this.client.sendCommand(s),h=new Date().getTime()-g,r+=h,h>o&&(o=h),(!a||h<a)&&(a=h),e.push(`${c} - ${h}`)}e.push(`Total - ${r}`),e.push(`Average - ${r/10}`),e.push(`Min - ${a}`),e.push(`Max - ${o}`),this.client.print(e.join(`
`)+`
`,!0),this.client.setOption("enableCommands",n)},this.functions.testperiod=()=>{if(window.periodID){clearInterval(window.periodID),delete window.period,delete window.periodID;return}window.period=0,window.periodID=setInterval(()=>{window.period%3===1?this.client.sendCommand("#testcolors"):window.period%3===2?this.client.sendCommand("#testxterm"):this.client.sendCommand("#testlist"),window.period++},2e3)},this.functions.testutf8=()=>{this.client.print(`Armenian
\u0531 \u0532 \u0533 \u0534 \u0535 \u0536 \u0537 \u0538 \u0539 \u053A \u053B \u053C \u053D \u053E \u053F \u0540 \u0541 \u0542 \u0543 \u0544 \u0545 \u0546 \u0547 \u0548 \u0549 \u054A \u054B \u054C \u054D \u054E \u054F \u0550 \u0551 \u0552 \u0553 \u0554 \u0555 \u0556 \u0559 \u055A \u055B \u055C \u055D \u055E \u055F \u0561 \u0562 \u0563 \u0564 \u0565 \u0566 \u0567 \u0568 \u0569 \u056A \u056B \u056C \u056D \u056E \u056F \u0570 \u0571 \u0572 \u0573 \u0574 \u0575 \u0576 \u0577 \u0578 \u0579 \u057A \u057B \u057C \u057D \u057E \u057F \u0580 \u0581 \u0582 \u0583 \u0584 \u0585 \u0586 \u0587 \u0589
Hebrew
\u0591 \u0592 \u0593 \u0594 \u0595 \u0596 \u0597 \u0598 \u0599 \u059A \u059B \u059C \u059D \u059E \u059F \u05A0 \u05A1 \u05A3 \u05A4 \u05A5 \u05A6 \u05A7 \u05A8 \u05A9 \u05AA \u05AB \u05AC \u05AD \u05AE \u05AF \u05B0 \u05B1 \u05B2 \u05B3 \u05B4 \u05B5 \u05B6 \u05B7 \u05B8 \u05B9 \u05BB \u05BC \u05BD \u05BE \u05BF \u05C0 \u05C1 \u05C2 \u05C3 \u05C4 \u05D0 \u05D1 \u05D2 \u05D3 \u05D4 \u05D5 \u05D6 \u05D7 \u05D8 \u05D9 \u05DA \u05DB \u05DC \u05DD \u05DE \u05DF \u05E0 \u05E1 \u05E2 \u05E3 \u05E4 \u05E5 \u05E6 \u05E7 \u05E8 \u05E9 \u05EA \u05F0 \u05F1 \u05F2 \u05F3 \u05F4
Arabic
\u060C \u061B \u061F \u0621 \u0622 \u0623 \u0624 \u0625 \u0626 \u0627 \u0628 \u0629 \u062A \u062B \u062C \u062D \u062E \u062F \u0630 \u0631 \u0632 \u0633 \u0634 \u0635 \u0636 \u0637 \u0638 \u0639 \u063A \u0640 \u0641 \u0642 \u0643 \u0644 \u0645 \u0646 \u0647 \u0648 \u0649 \u064A \u064B \u064C \u064D \u064E \u064F \u0650 \u0651 \u0652 \u0660 \u0661 \u0662 \u0663 \u0664 \u0665 \u0666 \u0667 \u0668 \u0669 \u066A \u066B \u066C \u066D \u0670 \u0671 \u0672 \u0673 \u0674 \u0675 \u0676 \u0677 \u0678 \u0679 \u067A \u067B \u067C \u067D \u067E \u067F \u0680 \u0681 \u0682 \u0683 \u0684 \u0685 \u0686 \u0687 \u0688 \u0689 \u068A \u068B \u068C \u068D \u068E \u068F \u0690 \u0691 \u0692 \u0693 \u0694 \u0695 \u0696 \u0697 \u0698 \u0699 \u069A \u069B \u069C \u069D \u069E \u069F \u06A0 \u06A1 \u06A2 \u06A3 \u06A4 \u06A5 \u06A6 \u06A7 \u06A8 \u06A9 \u06AA \u06AB \u06AC \u06AD \u06AE \u06AF \u06B0 \u06B1 ...
Devanagari
\u0901 \u0902 \u0903 \u0905 \u0906 \u0907 \u0908 \u0909 \u090A \u090B \u090C \u090D \u090E \u090F \u0910 \u0911 \u0912 \u0913 \u0914 \u0915 \u0916 \u0917 \u0918 \u0919 \u091A \u091B \u091C \u091D \u091E \u091F \u0920 \u0921 \u0922 \u0923 \u0924 \u0925 \u0926 \u0927 \u0928 \u0929 \u092A \u092B \u092C \u092D \u092E \u092F \u0930 \u0931 \u0932 \u0933 \u0934 \u0935 \u0936 \u0937 \u0938 \u0939 \u093C \u093D \u093E \u093F \u0940 \u0941 \u0942 \u0943 \u0944 \u0945 \u0946 \u0947 \u0948 \u0949 \u094A \u094B \u094C \u094D \u0950 \u0951 \u0952 \u0953 \u0954 \u0958 \u0959 \u095A \u095B \u095C \u095D \u095E \u095F \u0960 \u0961 \u0962 \u0963 \u0964 \u0965 \u0966 \u0967 \u0968 \u0969 \u096A \u096B \u096C \u096D \u096E \u096F \u0970
Armenian
\u0531 \u0532 \u0533 \u0534 \u0535 \u0536 \u0537 \u0538 \u0539 \u053A \u053B \u053C \u053D \u053E \u053F \x1B[33m\u0540 \u0541 \u0542 \u0543 \u0544 \u0545 \u0546 \u0547 \u0548 \u0549 \u054A \u054B \u054C \u054D \u054E \u054F \u0550 \u0551 \u0552 \x1B[34m\u0553 \u0554 \u0555 \u0556 \u0559 \u055A \u055B \u055C \u055D \u055E \u055F \u0561 \u0562 \u0563 \u0564 \u0565 \u0566 \u0567 \u0568 \u0569 \u056A \u056B \u056C \u056D \u056E \u056F \u0570\x1B[35m \u0571 \u0572 \u0573 \u0574 \u0575 \u0576 \u0577 \u0578 \u0579 \u057A \u057B \u057C \u057D \u057E \u057F \u0580 \u0581 \u0582 \u0583 \u0584 \u0585 \u0586 \u0587 \u0589\x1B[0m
Hebrew
\u0591 \u0592 \u0593 \u0594 \u0595 \u0596 \u0597 \u0598 \u0599 \u059A \u059B \u059C \u059D \u059E\x1B[33m \u059F \u05A0 \u05A1 \u05A3 \u05A4 \u05A5 \u05A6 \u05A7 \u05A8 \u05A9 \u05AA \u05AB \u05AC \u05AD \u05AE \u05AF \u05B0 \u05B1 \u05B2 \u05B3 \u05B4 \u05B5 \u05B6 \u05B7 \u05B8 \u05B9 \u05BB \u05BC \u05BD \u05BE \u05BF \u05C0 \u05C1 \u05C2 \u05C3 \u05C4 \u05D0 \u05D1 \u05D2 \u05D3 \u05D4 \u05D5 \u05D6 \u05D7 \u05D8 \u05D9 \u05DA \u05DB \u05DC\x1B[34m \u05DD \u05DE \u05DF \u05E0 \u05E1 \u05E2 \u05E3 \u05E4 \u05E5 \u05E6 \u05E7 \u05E8 \u05E9 \u05EA \u05F0 \u05F1 \u05F2 \u05F3 \u05F4\x1B[0m
\u0591 \u0592 \u0593 \u0594 \u0595 \u0596 \u0597 \u0598 \u0599 \u059A \u059B \u059C \u059D \u059E\x1B[33m \u059F \u05A0 \u05A1 \u05A3 \u05A4 \u05A5 \u05A6 \u05A7 \u05A8 \u05A9 \u05AA \u05AB \u05AC \u05AD \u05AE \u05AF \u05B0 \u05B1 \u05B2 \u05B3 \u05B4 \u05B5 \u05B6 \u05B7 \u05B8 \u05B9 \u05BB \u05BC \u05BD \u05BE \u05BF \u05C0 \u05C1 \u05C2 \u05C3 \u05C4 \u05D0 \u05D1 \u05D2 \u05D3 \u05D4 \u05D5 \u05D6 \u05D7 \u05D8 \u05D9 \u05DA \u05DB \u05DCa\x1B[34m \u05DD \u05DE \u05DF \u05E0 \u05E1 \u05E2 \u05E3 \u05E4 \u05E5 \u05E6 \u05E7 \u05E8 \u05E9 \u05EA \u05F0 \u05F1 \u05F2 \u05F3 \u05F4\x1B[0m
Arabic
\u060C \u061B \u061F \u0621 \u0622 \u0623 \u0624 \u0625 \u0626 \u0627 \u0628 \u0629 \u062A \u062B \u062C \u062D \u062E \u062F \u0630 \u0631 \u0632 \u0633 \u0634 \u0635 \u0636 \u0637 \u0638 \u0639\x1B[34m \u063A \u0640 \u0641 \u0642 \u0643 \u0644 \u0645 \u0646 \u0647 \u0648 \u0649 \u064A \u064B \u064C \u064D \u064E \u064F \u0650 \u0651 \u0652 \u0660 \u0661 \u0662 \u0663 \u0664 \u0665 \u0666 \u0667 \u0668 \u0669 \u066A \u066B \u066C \u066D \u0670 \u0671 \u0672 \u0673 \u0674 \u0675 \u0676 \u0677 \u0678 \u0679 \u067A \u067B \u067C \u067D \u067E \u067F \u0680 \u0681 \u0682 \u0683 \u0684 \u0685 \u0686 \u0687 \u0688 \u0689 \u068A \u068B \u068C \u068D \u068E \u068F \u0690 \u0691 \u0692 \u0693 \u0694 \u0695 \u0696 \u0697 \u0698 \u0699 \u069A \u069B \u069C \u069D \u069E \u069F \u06A0 \u06A1 \u06A2 \u06A3 \u06A4 \u06A5 \u06A6 \x1B[33m\u06A7 \u06A8 \u06A9 \u06AA \u06AB \u06AC \u06AD \u06AE \u06AF \u06B0 \u06B1 ...\x1B[0m
Devanagari
\u0901 \u0902 \u0903 \u0905 \u0906 \u0907 \u0908 \u0909 \u090A \u090B \u090C \u090D \u090E \u090F \u0910 \u0911 \u0912 \u0913 \u0914 \u0915 \u0916 \u0917 \u0918 \u0919 \u091A \u091B \u091C \u091D \u091E \u091F \u0920 \u0921 \u0922 \u0923 \u0924 \u0925 \u0926 \u0927 \u0928 \u0929 \u092A \x1B[33m\u092B \u092C \u092D \u092E \u092F \u0930 \u0931 \u0932 \u0933 \u0934 \u0935 \u0936 \u0937 \u0938 \u0939 \u093C \u093D \u093E \u093F \u0940 \u0941 \u0942 \u0943 \u0944 \u0945 \u0946 \u0947 \u0948 \u0949 \u094A \u094B \u094C \u094D \u0950 \u0951 \u0952 \u0953 \u0954 \u0958 \u0959 \u095A \u095B\x1B[34m \u095C \u095D \u095E \u095F \u0960 \u0961 \u0962 \u0963 \u0964 \u0965 \u0966 \u0967 \u0968 \u0969 \u096A \u096B \u096C \u096D \u096E \u096F \u0970\x1B[0m`,!0)},this.functions.testunicodeemoji=()=>{let e="",s=[[128513,128591],[9986,10160],[128640,128704],[128512,128566],[128641,128709],[127757,128359]],n=0;for(let o=0;o<s.length;o++){let a=s[o];for(let h=a[0];h<a[1];h++)e+=String.fromCodePoint(h),n++,n==36&&(e+=`
`,n=0);e+="\x1B[4z<hr>",n=0}let r=`\x1B[4z<hr>\xA9\xAE\u203C\u2049#\u20E38\u20E39\u20E37\u20E30\u20E36\u20E35\u20E34\u20E33\u20E32\u20E31\u20E3\u2122\u2139\u2194\u2195\u2196\u2197\u2198\u2199\u21A9\u21AA\u231A\u231B\u23E9\u23EA\u23EB\u23EC\u23F0\u23F3\u25AA\u25AB\u25B6\u25C0\u25FB\u25FC\u25FD\u25FE\u2600\u2601\u260E\u2611\u2614\u2615
\u261D\u263A\u2648\u2649\u264A\u264B\u264C\u264D\u264E\u264F\u2650\u2651\u2652\u2653\u2660\u2663\u2665\u2666\u2668\u267B\u267F\u2693\u26A0\u26A1\u26AA\u26AB\u26BD\u26BE\u26C4\u26C5\u26CE\u26D4\u26EA\u26F2\u26F3\u26F5
\u26FA\u26FD\u2934\u2935\u2B05\u2B06\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299\u{1F004}\u{1F0CF}\u{1F300}\u{1F301}\u{1F302}\u{1F303}\u{1F304}\u{1F305}\u{1F306}\u{1F307}\u{1F308}\u{1F309}\u{1F30A}\u{1F30B}\u{1F30C}\u{1F30F}\u{1F311}\u{1F313}\u{1F314}\u{1F315}
\u{1F319}\u{1F31B}\u{1F31F}\u{1F320}\u{1F330}\u{1F331}\u{1F334}\u{1F335}\u{1F337}\u{1F338}\u{1F339}\u{1F33A}\u{1F33B}\u{1F33C}\u{1F33D}\u{1F33E}\u{1F33F}\u{1F340}\u{1F341}\u{1F342}\u{1F343}\u{1F344}\u{1F345}\u{1F346}\u{1F347}\u{1F348}\u{1F349}\u{1F34A}\u{1F34C}\u{1F34D}\u{1F34E}\u{1F34F}\u{1F351}
\u{1F352}\u{1F353}\u{1F354}\u{1F355}\u{1F356}\u{1F357}\u{1F358}\u{1F359}\u{1F35A}\u{1F35B}\u{1F35C}\u{1F35D}\u{1F35E}\u{1F35F}\u{1F360}\u{1F361}\u{1F362}\u{1F363}\u{1F364}\u{1F365}\u{1F366}\u{1F367}\u{1F368}\u{1F369}\u{1F36A}\u{1F36B}\u{1F36C}\u{1F36D}\u{1F36E}\u{1F36F}\u{1F370}\u{1F371}\u{1F372}
\u{1F373}\u{1F374}\u{1F375}\u{1F376}\u{1F377}\u{1F378}\u{1F379}\u{1F37A}\u{1F37B}\u{1F380}\u{1F381}\u{1F382}\u{1F383}\u{1F384}\u{1F385}\u{1F386}\u{1F387}\u{1F388}\u{1F389}\u{1F38A}\u{1F38B}\u{1F38C}\u{1F38D}\u{1F38E}\u{1F38F}\u{1F390}\u{1F391}\u{1F392}\u{1F393}\u{1F3A0}\u{1F3A1}\u{1F3A2}\u{1F3A3}\u{1F3A4}
\u{1F3A5}\u{1F3A6}\u{1F3A7}\u{1F3A8}\u{1F3A9}\u{1F3AA}\u{1F3AB}\u{1F3AC}\u{1F3AD}\u{1F3AE}\u{1F3AF}\u{1F3B0}\u{1F3B1}\u{1F3B2}\u{1F3B3}\u{1F3B4}\u{1F3B5}\u{1F3B6}\u{1F3B7}\u{1F3B8}\u{1F3B9}\u{1F3BA}\u{1F3BB}\u{1F3BC}\u{1F3BD}\u{1F3BE}\u{1F3BF}\u{1F3C0}\u{1F3C1}\u{1F3C2}\u{1F3C3}\u{1F3C4}
\u{1F3C6}\u{1F3C8}\u{1F3CA}\u{1F3E0}\u{1F3E1}\u{1F3E2}\u{1F3E3}\u{1F3E5}\u{1F3E6}\u{1F3E7}\u{1F3E8}\u{1F3E9}\u{1F3EA}\u{1F3EB}\u{1F3EC}\u{1F3ED}\u{1F3EE}\u{1F3EF}\u{1F3F0}\u{1F40C}\u{1F40D}\u{1F40E}\u{1F411}\u{1F412}\u{1F414}\u{1F417}\u{1F418}\u{1F419}\u{1F41A}\u{1F41B}\u{1F41C}\u{1F41D}
\u{1F41E}\u{1F41F}\u{1F420}\u{1F421}\u{1F422}\u{1F423}\u{1F424}\u{1F425}\u{1F426}\u{1F427}\u{1F428}\u{1F429}\u{1F42B}\u{1F42C}\u{1F42D}\u{1F42E}\u{1F42F}\u{1F430}\u{1F431}\u{1F432}\u{1F433}\u{1F434}\u{1F435}\u{1F436}\u{1F437}\u{1F438}\u{1F439}\u{1F43A}\u{1F43B}\u{1F43C}\u{1F43D}\u{1F43E}
\u{1F440}\u{1F442}\u{1F443}\u{1F444}\u{1F445}\u{1F446}\u{1F447}\u{1F448}\u{1F449}\u{1F44A}\u{1F44B}\u{1F44C}\u{1F44D}\u{1F44E}\u{1F44F}\u{1F450}\u{1F451}\u{1F452}\u{1F453}\u{1F454}\u{1F455}\u{1F456}\u{1F457}\u{1F458}\u{1F459}\u{1F45A}\u{1F45B}\u{1F45C}\u{1F45D}\u{1F45E}\u{1F45F}\u{1F460}\u{1F461}\u{1F462}
\u{1F463}\u{1F464}\u{1F466}\u{1F467}\u{1F468}\u{1F469}\u{1F46A}\u{1F46B}\u{1F46E}\u{1F46F}\u{1F470}\u{1F471}\u{1F472}\u{1F473}\u{1F474}\u{1F475}\u{1F476}\u{1F477}\u{1F478}\u{1F479}\u{1F47A}\u{1F47B}\u{1F47C}\u{1F47D}\u{1F47E}\u{1F47F}\u{1F480}\u{1F481}\u{1F482}\u{1F483}\u{1F484}\u{1F485}\u{1F486}
\u{1F487}\u{1F488}\u{1F489}\u{1F48A}\u{1F48B}\u{1F48C}\u{1F48D}\u{1F48E}\u{1F48F}\u{1F490}\u{1F491}\u{1F492}\u{1F493}\u{1F494}\u{1F495}\u{1F496}\u{1F497}\u{1F498}\u{1F499}\u{1F49A}\u{1F49B}\u{1F49C}\u{1F49D}\u{1F49E}\u{1F49F}\u{1F4A0}\u{1F4A1}\u{1F4A2}\u{1F4A3}\u{1F4A4}\u{1F4A5}\u{1F4A6}\u{1F4A7}
\u{1F4A8}\u{1F4A9}\u{1F4AA}\u{1F4AB}\u{1F4AC}\u{1F4AE}\u{1F4AF}\u{1F4B0}\u{1F4B1}\u{1F4B2}\u{1F4B3}\u{1F4B4}\u{1F4B5}\u{1F4B8}\u{1F4B9}\u{1F4BA}\u{1F4BB}\u{1F4BC}\u{1F4BD}\u{1F4BE}\u{1F4BF}\u{1F4C0}\u{1F4C1}\u{1F4C2}\u{1F4C3}\u{1F4C4}\u{1F4C5}\u{1F4C6}\u{1F4C7}\u{1F4C8}\u{1F4C9}\u{1F4CA}\u{1F4CB}
\u{1F4CC}\u{1F4CD}\u{1F4CE}\u{1F4CF}\u{1F4D0}\u{1F4D1}\u{1F4D2}\u{1F4D3}\u{1F4D4}\u{1F4D5}\u{1F4D6}\u{1F4D7}\u{1F4D8}\u{1F4D9}\u{1F4DA}\u{1F4DB}\u{1F4DC}\u{1F4DD}\u{1F4DE}\u{1F4DF}\u{1F4E0}\u{1F4E1}\u{1F4E2}\u{1F4E3}\u{1F4E4}\u{1F4E5}\u{1F4E6}\u{1F4E7}\u{1F4E8}\u{1F4E9}\u{1F4EA}\u{1F4EB}\u{1F4EE}\u{1F4F0}
\u{1F4F1}\u{1F4F2}\u{1F4F3}\u{1F4F4}\u{1F4F6}\u{1F4F7}\u{1F4F9}\u{1F4FA}\u{1F4FB}\u{1F4FC}\u{1F503}\u{1F50A}\u{1F50B}\u{1F50C}\u{1F50D}\u{1F50E}\u{1F50F}\u{1F510}\u{1F511}\u{1F512}\u{1F513}\u{1F514}\u{1F516}\u{1F517}\u{1F518}\u{1F519}\u{1F51A}\u{1F51B}\u{1F51C}\u{1F51D}\u{1F51E}\u{1F51F}\u{1F520}
\u{1F521}\u{1F522}\u{1F523}\u{1F524}\u{1F525}\u{1F526}\u{1F527}\u{1F528}\u{1F529}\u{1F52A}\u{1F52B}\u{1F52E}\u{1F52F}\u{1F530}\u{1F531}\u{1F532}\u{1F533}\u{1F534}\u{1F535}\u{1F536}\u{1F537}\u{1F538}\u{1F539}\u{1F53A}\u{1F53B}\u{1F53C}\u{1F53D}\u{1F550}\u{1F551}\u{1F552}\u{1F553}\u{1F554}\u{1F555}
\u{1F556}\u{1F557}\u{1F558}\u{1F559}\u{1F55A}\u{1F55B}\u{1F5FB}\u{1F5FC}\u{1F5FD}\u{1F5FE}\u{1F5FF}`;this.client.print(e,!0),this.client.print(r,!0)},this.functions.testlines=()=>{let e=this.client.display.maxLines,s="",n=this.client.display.model.getNextLineID;for(let r=0;r<e;r++)s+=`Line: ${r}, LineID: ${n+r}
`;this.client.print(s,!0)},this.functions.testscreen=()=>{let e="Window innerWidth: "+window.innerWidth;e+=`
Window innerHeight: `+window.innerHeight,e+=`
Document clientWidth: `+document.body.clientWidth,e+=`
Document clientHeight: `+document.body.clientHeight,e+=`
Display clientWidth: `+this.client.display.container.clientWidth,e+=`
Display clientHeight: `+this.client.display.container.clientHeight,e+=`
Screen orientation: `+screen?.orientation?.type,this.client.print(e,!0)}}remove(){this.client&&this.client.off("function",this.Kl)}initialize(){this.client&&this.client.on("function",this.Kl)}get menu(){return[]}get settings(){return[]}Vl(t){let e;t&&(e=t.name.toLowerCase(),e.endsWith("()")&&(e=e.substring(0,e.length-2)),this.functions[e]&&(console.time(e),this.functions[e].apply(this,[t||{}]),console.timeEnd(e),t.handled=!0))}};var At=Mi(xs());var ln={out:4096,enter:2048,unknown:1024,up:512,down:256,north:128,northeast:64,east:32,southeast:16,south:8,southwest:4,west:2,northwest:1,none:0},Ie=class f{constructor(p){this.num=null;this.x=0;this.y=0;this.z=0;this.area="";this.zone=0;this.details=0;this.exits={};if(p)for(let t in p)p.hasOwnProperty(t)&&(this[t]=p[t])}get exitsID(){return Object.keys(this.exits).map(p=>ln[p]).reduce((p,t)=>p|t,0)}clone(){return new f(Bi(this))}},Nt=class f extends me{constructor(){super();this.changed=!1;this.ot={},this.Ct=[],this.es=0,this.ii=[],this.Ds=[],this.te=new Ie}get current(){return this.te}set current(t){this.te=t,this.emit("current-changed",t)}get Rooms(){return this.ot}set Rooms(t){if(Array.isArray(t)){let e=t,s={};for(let n=0,r=e.length;n<r;n++)s[e[n].num]=e[n];this.ot=s}else this.ot=t||{};this.Jl(),this.ii.forEach(e=>{this.ot[e]=this.Ql(this.ot[e]),this.ot[e].zone>this.es&&(this.es=this.ot[e].zone),this.Ct.indexOf(this.ot[e].area)===-1&&this.Ct.push(this.ot[e].area)}),this.Ct.sort()}get Areas(){return this.Ct||this.gh(),this.Ct}get zone(){return this.es}set zone(t){this.es=t||0}get count(){return this.ii.length}static load(){return new Promise((t,e)=>{localforage.getItem("nMapperData").then(s=>{let n=new f;s&&s.Rooms&&(n.Rooms=s.Rooms),t(n)}).catch(e)})}save(){return this.changed=!1,localforage.setItem("nMapperData",{Rooms:this.ot,Areas:this.Areas,Keys:this.ii})}getRoom(t){let e=this.ii,s=Object.keys(t),n=s.length;e:for(let r=0,o=e.length;r<o;r++){let a=this.ot[e[r]];for(let h=0;h<n;h++)if(a[s[h]]!==t[s[h]])continue e;return a}return null}getRooms(t){let e=this.ii,s=Object.keys(t),n=s.length,r=[];e:for(let o=0,a=e.length;o<a;o++){let h=this.ot[e[o]];for(let c=0;c<n;c++)if(h[s[c]]!==t[s[c]])continue e;r.push(h)}return r}roomExists(t){let e=this.Ds,s=Object.keys(t),n=s.length;return e.findIndex(r=>{let o=this.ot[r];for(let a=0;a<n;a++)if(o[s[a]]!==t[s[a]])return!1;return!0})!==-1}removeRoom(t){if(typeof t=="string"&&(t=this.ot[t]),!!t&&this.Rooms[t.num]){let e=this.ii.indexOf(t.num);if(e!==-1&&this.ii.splice(e,1),e=this.Ds.indexOf(t.num),e!==-1&&this.Ds.splice(e,1),delete this.ot[t.num],this.changed=!0,this.emit("rooms-removed",[t]),!this.getRoom({area:t.area})){let s=this.Ct.indexOf(t.area);this.Ct.splice(s,1),this.emit("areas-removed",[t.area])}}}removeRooms(t){let e=this.ii,s=Object.keys(t),n=s.length,r=[],o,a={};e:for(let h=e.length-1;h>=0;h--){let c=this.ot[e[h]];for(let g=0;g<n;g++)if(c[s[g]]!==t[s[g]])continue e;r.push(c),o=this.ii.indexOf(c.num),o!==-1&&this.ii.splice(o,1),o=this.Ds.indexOf(c.num),o!==-1&&this.Ds.splice(o,1),a[c.area]=!0,delete this.ot[c.num]}if(r.length){this.changed=!0,this.emit("rooms-removed",r);for(let h in a)if(!this.getRoom({area:h})){let c=this.Ct.indexOf(h);this.Ct.splice(c,1)}this.emit("areas-removed",Object.keys(a))}}removeAllRooms(){let t=this.ii.map(s=>this.ot[s]),e=this.Ct;this.ot={},this.ii=[],this.Ds=[],this.Ct=[],this.es=0,this.current=new Ie,this.changed=!0,this.emit("rooms-removed",t),this.emit("areas-removed",e)}setRoom(t){if(t)return this.changed=!0,t=this.Ql(t),this.emit("before-room-changed",this.ot[t.num]),this.ot[t.num]=t,t.zone>this.es&&(this.es=t.zone),this.Jl(),this.addArea(t.area),this.emit("room-changed",this.ot[t.num]),this.ot[t.num]}addArea(t){if(!t)return 0;this.Ct.indexOf(t)===-1&&(this.Ct.push(t),this.Ct.sort(),this.emit("areas-added",[t]))}getFreeZone(t){return t||(t=0),t>this.zone?t:++this.zone}Ql(t){let e=""+(t.num||t.ID),s={area:t.Area||t.area||"",details:t.Details||t.details||0,name:t.Name||t.name||"",env:t.Env||t.env||t.environment||"",x:+t.X||+t.x||0,y:+t.Y||+t.y||0,z:+t.Z||+t.z||0,zone:+t.Zone||+t.zone||0,indoors:+t.Indoors||+t.indoors||0,background:t.Background||t.background||"",notes:t.Notes||t.notes||"",num:e?""+e:null,exits:t.exits||{}};if(s.exits){let n,r;for(n in s.exits)s.exits.hasOwnProperty(n)&&(r=s.exits[n].DestID||s.exits[n].num||null,s.exits[n]={num:r?""+r:null,isdoor:+s.exits[n].IsDoor||+s.exits[n].isdoor||null,isclosed:+s.exits[n].IsClosed||+s.exits[n].isclosed||null})}return new Ie(s)}Jl(){this.ii=Object.keys(this.ot).sort((t,e)=>{let s=this.ot[t],n=this.ot[e];return s.x>n.x?1:s.x<n.x?-1:s.y>n.y?1:s.y<n.y?-1:s.z>n.z?1:s.z<n.z?-1:s.zone>n.zone?1:s.zone<n.zone?-1:t.localeCompare(e)}),this.Ds=this.ii.slice().sort((t,e)=>{let s=this.ot[t],n=this.ot[e];return s.zone>n.zone?1:s.zone<n.zone?-1:t.localeCompare(e)})}gh(){this.Ct=[],this.ii.forEach(t=>{this.Ct.indexOf(this.ot[t].area)===-1&&this.Ct.push(this.ot[t].area)}),this.Ct.sort()}cancelImport(){this.zr=!0}async import(t,e){if(!t||t===null||typeof t>"u")return;this.zr=!1,Array.isArray(t)||(t=Object.values(t)),e===1&&this.removeAllRooms(),this.emit("import-progress",0);let s=t.length,n,r={};this.Ct.forEach(a=>r[a]=!0);let o=[];for(let a=0;a<s&&!this.zr;a++)this.emit("import-progress",Math.floor(a/s*100)),t[a]!==null&&(n=this.Ql(t[a]),this.ot[n.num]=n,n.zone>this.es&&(this.es=n.zone),r[n.area]=!0,o.push(n));this.emit("rooms-changed",o),this.Ct=Object.keys(r),this.Ct.sort(),this.emit("areas-added",Object.keys(r)),this.Jl(),this.changed=!0,this.zr?this.emit("import-canceled"):this.emit("import-complete")}};var Gt=class extends me{constructor(t,e){super();this.Wt={x:0,y:0,button:0,state:!1};this.Zi=!1;this.Mn=0;this.Rn=0;this.ts={};this.Ye=0;this.an=0;this.Hr=!1;this.pr=!1;this.Di=!1;this.Yi=!1;this.ln=!0;this._l=!0;this.commandDelay=500;this.commandDelayCount=5;this.je=1;this.Pn=!1;this.gs=[];this.ur=-1;this.bs=!0;if(!t)throw new Error("Container must be a selector, element, jquery object or Map options");if(typeof t=="object"&&"container"in t?(e=Object.assign(e||{},t),t=e.container,delete e.container):e||(e={}),typeof t=="string"){if(this.Ie=document.querySelector(t),!this.Ie)throw new Error("Invalid selector for display.")}else if(t instanceof $)this.Ie=t[0];else if(t instanceof HTMLElement)this.Ie=t;else if(t.ownerDocument.defaultView&&t instanceof t.ownerDocument.defaultView.HTMLElement)this.Ie=t;else throw new Error("Container must be a selector, element or jquery object");this.ue=this.Ie.ownerDocument,this.ae=this.ue.defaultView,this.Ps=new ResizeObserver((n,r)=>{n.length!==0&&(!n[0].contentRect||n[0].contentRect.width===0||n[0].contentRect.height===0||(!this.Ii||this.Ii.height!==n[0].contentRect.height||this.Ii.width!==n[0].contentRect.width)&&(this.Ii={width:n[0].contentRect.width,height:n[0].contentRect.height},this.Fr()))}),this.Ps.observe(this.Ie),this.Os=new MutationObserver(n=>{let r;for(r of n)r.type==="attributes"&&r.attributeName==="style"&&this.Fr()}),this.Os.observe(this.Ie,{attributes:!0,attributeOldValue:!0,attributeFilter:["style"]}),this.Te=this.ue.createElement("canvas"),this.Te.id=this.Ie.id+"-canvas",this.Te.classList.add("map-canvas"),this.Te.style.touchAction="none",this.Te.tabIndex=1,this.Fr(),this.Ie.appendChild(this.Te),this.Ie.insertAdjacentHTML("afterbegin",'<div class="MapperNavButton" title="Scroll northwest" style="top:4px;left:4px;background-position: 0px 0px;" data-x="-1" data-y="-1"></div><div class="MapperNavButton" title="Scroll north" style="top:4px;left:50%;background-position: -22px 0px;margin-left:-11px;" data-x="0" data-y="-1"></div><div class="MapperNavButton" title="Scroll northeast" style="top:4px;left:100%;background-position: -44px 0px;margin-left:-26px;" data-x="1" data-y="-1"></div><div class="MapperNavButton" title="Scroll west" style="top:50%;left:4px;background-position: 0px -22px;margin-top:-11px;" data-x="-1" data-y="0"></div><div class="MapperNavButton" title="Scroll east" style="top:50%;left:100%;background-position: -44px -22px;margin-top:-11px;margin-left:-26px;" data-x="1" data-y="0"></div><div class="MapperNavButton" title="Scroll southwest" style="bottom:4px;left:4px;background-position: 0px -44px;" data-x="-1" data-y="1"></div><div class="MapperNavButton" title="Scroll south" style="bottom:4px;left:50%;background-position: -22px -44px;margin-left:-11px;" data-x="0" data-y="1"></div><div class="MapperNavButton" title="Scroll southeast" style="bottom:4px;left:100%;background-position: -44px -44px;margin-left:-26px;" data-x="1" data-y="1"></div>'),this.Ie.querySelectorAll(".MapperNavButton").forEach(n=>{n.addEventListener("wheel",r=>{this.Pn=!0;let o=r.currentTarget||r.target;r.deltaY>=0?this.Ur(-parseInt(o.dataset.x,10),-parseInt(o.dataset.y,10)):this.Ur(parseInt(o.dataset.x,10),parseInt(o.dataset.y,10)),this.Pn=!1},{passive:!0}),n.addEventListener("mouseleave",()=>this.Pn=!1),n.addEventListener("mouseup",()=>this.Pn=!1),n.addEventListener("mousedown",r=>{this.Pn=!0;let o=r.currentTarget||r.target;this.Ur(parseInt(o.dataset.x,10),parseInt(o.dataset.y,10))})}),this.ms=this.Te.getContext("2d"),this.ms.mozImageSmoothingEnabled=!1,this.ms.webkitImageSmoothingEnabled=!1,this.ms.imageSmoothingEnabled=!1,this.Te.addEventListener("pointerdown",n=>{this.gs.push(n)}),this.Te.addEventListener("pointermove",n=>{let r=this.gs.findIndex(o=>o.pointerId===n.pointerId);if(this.gs[r]=n,this.gs.length===2){let o=Math.abs(this.gs[0].clientX-this.gs[1].clientX);this.ur>0&&(o>this.ur&&this.scale<300&&(this.scale+=1),o<this.ur&&this.scale>25&&(this.scale-=1)),this.ur=o}});let s=n=>{let r=this.gs.findIndex(o=>o.pointerId===n.pointerId);this.gs.splice(r,1),this.gs.length<2&&(this.ur=-1)};this.Te.addEventListener("pointerup",s),this.Te.addEventListener("pointercancel",s),this.Te.addEventListener("pointerout",s),this.Te.addEventListener("pointerleave",s),this.Te.addEventListener("touchstart",n=>{this.wt=this.pi(n),this.Ni=this.pi(n),this.Wt.state=!0,this.Zi=n.touches.length===1},{passive:!0}),this.Te.addEventListener("touchmove",n=>{if(this.Tn=this.wt,this.wt=this.pi(event),this.Zi){this.Wt.x+=this.Tn.x-this.wt.x,this.Wt.y+=this.Tn.y-this.wt.y;let r=Math.floor(this.Wt.x/32/this.je),o=Math.floor(this.Wt.y/32/this.je);(r>0||r<0||o<0||o>0)&&(this.Wt.x-=r*32*this.je,this.Wt.y-=o*32*this.je,this.scrollBy(r,o)),this.Te.style.cursor="move"}n.preventDefault()},{passive:!0}),this.Te.addEventListener("touchend",n=>{if(this.wt=this.pi(n),this.Ni||(this.Ni=this.pi(n)),this.wt.button===0&&Math.floor(this.wt.x/32/this.je)===Math.floor(this.Ni.x/32/this.je)&&Math.floor(this.wt.y/32/this.je)===Math.floor(this.Ni.y/32/this.je)){let r=this.wt.x,o=this.wt.y,a=this.findActiveRoomByCoords(r,o);(!this.selected||a&&a.num!==this.selected.num)&&(this.selected=a)}this.Wt.state=!1,this.Zi=!1,this.Te.style.cursor="default;"},{passive:!0}),this.Te.addEventListener("mousemove",n=>{if(this.Tn=this.wt,this.wt=this.pi(n),this.Zi){this.Wt.x+=this.Tn.x-this.wt.x,this.Wt.y+=this.Tn.y-this.wt.y;let r=Math.floor(this.Wt.x/32/this.je),o=Math.floor(this.Wt.y/32/this.je);(r>0||r<0||o<0||o>0)&&(this.Wt.x-=r*32*this.je,this.Wt.y-=o*32*this.je,this.scrollBy(r,o)),this.Te.style.cursor="move"}n.preventDefault()}),this.Te.addEventListener("mousedown",n=>{this.wt=this.pi(n),this.Ni=this.pi(n),this.Wt.state=!0,this.Zi=this.Ni.button===0}),this.Te.addEventListener("mouseup",n=>{if(this.wt=this.pi(n),this.Ni||(this.Ni=this.pi(n)),this.wt.button===0&&Math.floor(this.wt.x/32/this.je)===Math.floor(this.Ni.x/32/this.je)&&Math.floor(this.wt.y/32/this.je)===Math.floor(this.Ni.y/32/this.je)){let r=this.wt.x,o=this.wt.y,a=this.findActiveRoomByCoords(r,o);(!this.selected||a&&a.num!==this.selected.num)&&(this.selected=a)}this.Wt.state=!1,this.Zi=!1,this.Te.style.cursor="default;"}),this.Te.addEventListener("wheel",n=>{n.deltaY>=0?this.scale-=5:this.scale+=5},{passive:!0}),this.Te.addEventListener("mouseenter",n=>{this.wt=this.pi(n)}),this.Te.addEventListener("mouseleave",n=>{this.wt=this.pi(n),this.Zi&&(this.De(1),this.Zi=!1,$(this.Te).css("cursor","default"))}),this.Te.addEventListener("contextmenu",n=>{n.preventDefault();let r=this.pi(n);return this.emit("context-menu",this.findActiveRoomByCoords(r.x,r.y).clone()),!1}),this.Te.addEventListener("click",n=>{n.preventDefault(),this.Wt.state=!1,this.Zi=!1,$(this.Te).css("cursor","default")}),this.Te.addEventListener("dblclick",n=>{n.preventDefault(),this.wt=this.pi(n),this.Ni=this.pi(n),this.Wt.state=!0,this.Zi=!0,$(this.Te).css("cursor","move")}),this.Te.onselectstart=()=>!1,this.Te.addEventListener("focus",n=>{this.Xo(!0)}),this.Te.addEventListener("blur",n=>{this.Xo(!1)}),this.Te.addEventListener("keydown",n=>{if(this.Hr)switch(n.which){case 27:n.preventDefault(),this.Wt.state=!1,this.Zi=!1,$(this.Te).css("cursor","default");break;case 38:n.preventDefault(),this.scrollBy(0,-1);break;case 40:n.preventDefault(),this.scrollBy(0,1);break;case 37:n.preventDefault(),this.scrollBy(-1,0);break;case 39:n.preventDefault(),this.scrollBy(1,0);break;case 110:case 46:n.preventDefault(),this.emit("delete-selected");break;case 97:n.preventDefault(),this.scrollBy(-1,1);break;case 98:n.preventDefault(),this.scrollBy(0,1);break;case 99:n.preventDefault(),this.scrollBy(1,1);break;case 100:n.preventDefault(),this.scrollBy(-1,0);break;case 101:case 36:n.preventDefault(),this.focusCurrentRoom();break;case 102:n.preventDefault(),this.scrollBy(1,0);break;case 103:n.preventDefault(),this.scrollBy(-1,-1);break;case 104:n.preventDefault(),this.scrollBy(0,-1);break;case 105:n.preventDefault(),this.scrollBy(1,-1);break;case 107:n.preventDefault(),this.setLevel(this.active.z+1);break;case 109:n.preventDefault(),this.setLevel(this.active.z-1);break;case 111:n.preventDefault(),this.setZone(this.active.zone-1);break;case 106:n.preventDefault(),this.setZone(this.active.zone+1);break}}),this.reset(),this.map=e.map,this.refresh()}get showNavigation(){return this.bs}set showNavigation(t){t!==this.bs&&(this.bs=t,this.Ie.querySelectorAll(".MapperNavButton").forEach(e=>{e.style.display=this.bs?"":"none"}),this.Te.style.top=this.bs?"":"0",this.Te.style.left=this.bs?"":"0",this.Te.style.right=this.bs?"":"0",this.Te.style.bottom=this.bs?"":"0",this.Fr())}get selected(){return this.$r}set selected(t){this.emit("room-before-selected",this.$r?this.$r.clone():null),this.$r=t.clone(),this.emit("room-selected",t.clone()),this.De(1)}get container(){return this.Ie}set scale(t){t<25&&(t=25),t>300&&(t=300),this.je!==t&&(this.je=t/100,this.emit("setting-changed","scale",t),this.ci=0,this.De(1))}get scale(){return Math.round(this.je*100)}set enabled(t){this.ln!==t&&(this.ln=t,this.emit("setting-changed","enabled",t))}get enabled(){return this.ln}set follow(t){this._l!==t&&(this._l=t,this.emit("setting-changed","follow",t))}get follow(){return this._l}set showLegend(t){this.pr!==t&&(this.pr=t,this.ci=0,this.De(1),this.emit("setting-changed","legend",t))}get showLegend(){return this.pr}set splitArea(t){this.Di!==t&&(this.Di=t,this.ci=0,this.De(1),this.emit("setting-changed","split",t))}get splitArea(){return this.Di}set fillWalls(t){this.Yi!==t&&(this.Yi=t,this.ci=0,this.De(1),this.emit("setting-changed","fill",t))}get fillWalls(){return this.Yi}pi(t){let e=this.Te.getBoundingClientRect();return t.touches&&t.touches.length?{x:t.touches[0].clientX-e.left,y:t.touches[0].clientY-e.top,button:0,state:!1}:{x:t.clientX-e.left,y:t.clientY-e.top,button:t.button,state:!1}}scrollBy(t,e){this.Mn+=t,this.Rn+=e,this.De(1),this.emit("setting-changed","vscroll",this.Mn),this.emit("setting-changed","hscroll",this.Rn)}scrollTo(t,e){this.Mn=t,this.Rn=e,this.De(1),this.emit("setting-changed","vscroll",this.Mn),this.emit("setting-changed","hscroll",this.Rn)}findActiveRoomByCoords(t,e){let s=this.Mn-this.Te.width/32/2/this.je,n=this.Rn-this.Te.height/32/2/this.je,r=15.5*this.je,o=15.5*this.je;return this.Te.width%2!==0&&(r=15*this.je),this.Te.height%2!==0&&(o=15*this.je),s+=(t-r)/32/this.je,n+=(e-o)/32/this.je,s=Math.floor(s),n=Math.floor(n),this.Di?this.map.getRoom({x:s,y:n,z:this.active.z,zone:this.active.zone,area:this.active.area})||new Ie:this.map.getRoom({x:s,y:n,z:this.active.z,zone:this.active.zone})||new Ie}qo(t,e,s){return new Promise((n,r)=>{if(t||(t=this.Te),e||(e=this.ms),s||(s=!1),!t||!e||!this.he){r();return}let o=this.Mn-t.width/32/2/this.je,a=this.Rn-t.height/32/2/this.je,h=this.active.z||0,c=this.active.area||"",g=this.active.zone||0,m=15.5*this.je,b=15.5*this.je;t.width%2!==0&&(m=15*this.je),t.height%2!==0&&(b=15*this.je),e.font="8pt Arial";let u=new Date().getTime(),E=t.width/32/this.je+1,w=t.height/32/this.je+1,L=o-1,k=a-1,R=Object.values(this.he.Rooms).filter(v=>v.zone!==g||v.z!==h||this.Di&&v.area!==c?!1:0<=v.x-L&&v.x-L<=E&&0<=v.y-k&&v.y-k<=w||0<=v.x-L&&v.x-L<=E&&0<=v.y-k+1&&v.y-k+1<=w||0<=v.x-L+1&&v.x-L+1<=E&&0<=v.y-k+1&&v.y-k+1<=w||0<=v.x-L+1&&v.x-L+1<=E&&0<=v.y-k&&v.y-k<=w);this.emit("debug","Mapper: Draw - room query time: "+(new Date().getTime()-u));let B=new Date().getTime();s?(e.fillStyle="#eae4d6",e.fillRect(0,0,t.width,t.height)):e.clearRect(0,0,t.width,t.height),this.emit("debug","Mapper: Draw - room calculations time: "+(new Date().getTime()-u));for(let v=0,O=R.length;v<O;v++){let C=R[v];this.Vo(e,(C.x-o)*32*this.je+m,(C.y-a)*32*this.je+b,C,s,this.je)}this.emit("debug","Mapper: Draw - display time: "+(new Date().getTime()-B)),this.emit("debug","Mapper: Draw - final time: "+(new Date().getTime()-u)),this.Ko(e,1,-4,0),n(!0)})}reset(t){this.he&&(!t||t===1)&&(this.he.current=new Ie,this.emit("current-changed",this.he.current)),t||(this.active=new Ie,this.selected=new Ie)}refresh(){this.ci=0,this.De(1),this.emit("refresh")}focusCurrentRoom(){this.he&&this.he.current&&this.he.current.num&&(this.active=this.he.current,this.emit("active-room-changed",this.active.clone())),this.focusActiveRoom()}focusActiveRoom(){this.active&&this.scrollTo(this.active.x+1,this.active.y+1)}set active(t){this.ar=t&&t.clone?t.clone():t,this.emit("active-room-changed",this.ar)}get active(){return this.ar}get current(){return this.he.current}set current(t){this.emit("path-cleared"),(!t||!t.num)&&(t=this.selected),this.he.current=t.clone(),this.ts={},this.si=0,this.De(1)}setArea(t){if(this.active.area=t,this.he.current.num!==null&&this.he.current.area===this.active.area)this.active=this.he.current,this.focusActiveRoom(),this.emit("setting-changed","active",this.active);else{let e=this.he.getRoom({area:t});e&&(this.active=e,this.focusActiveRoom(),this.emit("setting-changed","active",this.active))}}setLevel(t){t!==this.active.z&&(this.active.z=t,this.De(1),this.emit("setting-changed","active",this.active))}setZone(t){t!==this.active.zone&&(this.active.zone=t,this.De(1),this.emit("setting-changed","active",this.active))}removeRoom(t){this.he.roomExists({num:t.num})&&(this.he.removeRoom(t),this.emit("remove-done",t),t.num===this.he.current.num?(this.he.current=new Ie,this.emit("current-changed",this.he.current),this.clearPath()):this.ts[t.num]&&this.clearPath(),t.num===this.active.num&&(this.active=new Ie),t.num===this.selected.num&&(this.selected=new Ie),this.refresh())}clearSelectedRoom(){let t={preventDefault:!1};this.emit("clear-selected",t),!t.preventDefault&&this.removeRoom(this.selected)}clearCurrentRoom(){let t={preventDefault:!1};this.emit("clear-current",t),!t.preventDefault&&this.removeRoom(this.he.current)}clearArea(){let t={preventDefault:!1};this.emit("clear-area",t),!t.preventDefault&&(this.he.removeRooms({area:this.active.area}),this.emit("clear-area-done",this.active.area),this.reset(),this.refresh())}clearAll(){let t={preventDefault:!1};this.emit("clear-all",t),!t.preventDefault&&(this.he.removeAllRooms(),this.emit("clear-done"),this.reset(),this.refresh(),this.focusActiveRoom())}set map(t){t!==this.he&&(this.he&&this.he.removeListenersFromCaller(this),this.he=t,t&&(t.on("current-changed",e=>{this.clearPath(),this.emit("current-changed",this.he.current),this.selected&&this.selected.num===e.num&&this.emit("room-selected",e.clone()),this.follow?this.focusCurrentRoom():this.active=e,this.refresh()},this),t.on("before-room-changed",e=>{e&&delete this.ci[(e.background?e.background:e.env)+","+e.indoors+","+e.exitsID+","+e.details]},this),t.on("room-changed",e=>{this.selected&&this.selected.num===e.num&&(this.selected=e),this.follow?this.focusCurrentRoom():this.active=this.current,this.refresh()},this),t.on("rooms-changed",e=>{if(this.selected&&this.selected.num){let s=e.findIndex(n=>n.num===this.selected.num);s!==-1&&(this.selected=e[s])}this.follow?this.focusCurrentRoom():this.active=this.current,this.refresh()},this),this.follow?(this.he.current.num&&(this.ar=this.map.current&&this.map.current.clone?this.map.current.clone():this.map.current),this.focusActiveRoom()):this.ar=this.map.current&&this.map.current.clone?this.map.current.clone():this.map.current),this.refresh())}get map(){return this.he}set rooms(t){this.he.Rooms=t}get rooms(){return this.he.Rooms}roomExists(t,e,s,n,r){return r?this.he.roomExists({x:t,y:e,z:s,zone:n||0,area:r}):this.he.roomExists({x:t,y:e,z:s,zone:n||0})}setRoom(t){this.he.setRoom(t)}Ko(t,e,s,n){this.pr&&(t.strokeStyle="black",n||(t.fillStyle="#eae4d6",t.fillRect(e+30,s+35,130,175)),t.fillStyle="black",t.strokeRect(e+30,s+35,130,175),t.font="italic bold 8pt Georgia",t.fillText("Dock",e+50,s+50),t.fillStyle="chocolate",t.beginPath(),t.arc(e+40,s+45,2,0,Math.PI*2),t.fill(),t.closePath(),t.fillStyle="black",t.fillText("Pier",e+50,s+65),t.fillStyle="gray",t.beginPath(),t.arc(e+40,s+60,2,0,Math.PI*2),t.fill(),t.closePath(),t.fillStyle="black",t.fillText("Water Source",e+50,s+80),t.fillStyle="aqua",t.beginPath(),t.arc(e+40,s+75,2,0,Math.PI*2),t.fill(),t.closePath(),t.fillStyle="black",t.fillText("Bank",e+50,s+95),t.font="8pt Arial",t.fillStyle="goldenrod",t.beginPath(),t.fillText("$",e+38,s+95),t.closePath(),t.font="italic bold 8pt Georgia",t.fillStyle="black",t.fillText("Shop",e+50,s+110),t.font="8pt Arial",t.fillStyle="purple",t.beginPath(),t.fillText("\u23CF",e+38,s+110),t.closePath(),t.font="italic bold 8pt Georgia",t.fillStyle="black",t.fillText("Hospital",e+50,s+125),t.font="8pt Arial",t.fillStyle="blue",t.beginPath(),t.fillText("\u2665",e+38,s+125),t.closePath(),t.font="italic bold 8pt Georgia",t.fillStyle="black",t.fillText("Bar & Restaurant",e+50,s+140),t.font="8pt Arial",t.fillStyle="green",t.beginPath(),t.fillText("\u2617",e+38,s+140),t.closePath(),t.font="italic bold 8pt Georgia",t.fillStyle="black",t.fillText("Bar",e+50,s+155),t.font="8pt Arial",t.fillStyle="green",t.beginPath(),t.fillText("\u266A",e+38,s+155),t.closePath(),t.font="italic bold 8pt Georgia",t.fillStyle="black",t.fillText("Restaurant",e+50,s+170),t.font="8pt Arial",t.fillStyle="green",t.beginPath(),t.fillText("\u2616",e+38,s+170),t.closePath(),t.font="italic bold 8pt Georgia",t.fillStyle="black",t.fillText("Train",e+50,s+185),t.font="8pt Arial",t.fillStyle="red",t.beginPath(),t.fillText("\u260D",e+38,s+185),t.closePath(),t.font="italic bold 8pt Georgia",t.fillStyle="black",t.fillText("Stable",e+50,s+200),t.font="8pt Arial",t.fillStyle="rgb(153, 102, 0)",t.beginPath(),t.fillText("\u2658",e+38,s+200),t.closePath())}Jo(t,e,s){if(s===3)return;let n=e-e*s;t.translate(e*s+n,e*s+n)}Vo(t,e,s,n,r,o){this.ci||(this.ci={}),o||(o=this.je);let a=(n.background?n.background:n.env)+","+n.indoors+","+n.exitsID+","+n.details;if(!this.ci[a]){this.ci[a]=this.ue.createElement("canvas"),this.ci[a].classList.add("map-canvas"),this.ci[a].height=32*o,this.ci[a].width=32*o;let h=this.ci[a].getContext("2d");this.Jo(h,.5,o),h.beginPath();let c=!1;if(n.background)h.fillStyle=n.background,c=!0;else if(n.env)switch(n.env){case"wood":h.fillStyle="#966F33",c=!0;break;case"jungle":h.fillStyle="#347C2C",c=!0;break;case"forest":h.fillStyle="#4E9258",c=!0;break;case"grass":case"grassland":case"plains":case"prairie":case"savannah":h.fillStyle="#4AA02C",c=!0;break;case"desert":case"dirt":case"dirtroad":case"beach":case"sand":case"sanddesert":h.fillStyle="#C2B280",c=!0;break;case"snow":h.fillStyle="#F0F8FF",c=!0;break;case"tundra":case"icesheet":h.fillStyle="#368BC1",c=!0;break;case"underwater":case"water":case"lake":case"river":h.fillStyle="#EBF4FA",c=!0;break;case"ocean":h.fillStyle="#C2DFFF",c=!0;break;case"bog":case"city":case"cliff":case"highmountain":case"hills":case"mountain":case"swamp":c=!1;break;case"farmland":c=!0,h.fillStyle="#A9DFBF";break;case"rockdesert":h.fillStyle="#6E2C00",c=!0;break;case"pavedroad":h.fillStyle="#D0D3D4",c=!0;break;case"cobble":case"rocky":case"stone":h.fillStyle="#D5DBDB",c=!0;break;default:c=!1;break}else c=!1;h.strokeStyle="black",h.lineWidth=.6*o,n.indoors?(c&&h.fillRect(8*o,8*o,16*o,16*o),h.strokeRect(8*o,8*o,16*o,16*o)):(h.arc(16*o,16*o,8*o,0,Math.PI*2,!1),c&&h.fill(),h.stroke()),h.closePath(),h.beginPath(),h.fillStyle="#cccccc",n.exits.north?(h.moveTo(16*o,0*o),h.lineTo(16*o,8*o)):this.Yi&&h.fillRect(9*o,0*o,14*o,4*o),n.exits.northwest?n.Indoors?(h.moveTo(0*o,0*o),h.lineTo(8*o,8*o)):(h.moveTo(0*o,0*o),h.lineTo(10*o,10*o)):this.Yi&&(h.fillRect(2*o,0*o,2*o,2*o),h.fillRect(0*o,2*o,4*o,2*o),n.exits.north||h.fillRect(4*o,0*o,5*o,4*o),n.exits.west||h.fillRect(0*o,4*o,4*o,5*o)),n.exits.northeast?n.Indoors?(h.moveTo(32*o,0*o),h.lineTo(24*o,8*o)):(h.moveTo(32*o,0*o),h.lineTo(22*o,10*o)):this.Yi&&(h.fillRect(28*o,0*o,2*o,2*o),h.fillRect(28*o,2*o,4*o,2*o),h.clearRect(30*o,0*o,2*o,2*o),n.exits.north||h.fillRect(23*o,0*o,5*o,4*o),n.exits.east||h.fillRect(28*o,4*o,4*o,5*o)),n.exits.east?(h.moveTo(24*o,16*o),h.lineTo(32*o,16*o)):this.Yi&&h.fillRect(28*o,9*o,4*o,14*o),n.exits.west?(h.moveTo(0*o,16*o),h.lineTo(8*o,16*o)):this.Yi&&h.fillRect(0*o,9*o,4*o,14*o),n.exits.south?(h.moveTo(16*o,24*o),h.lineTo(16*o,32*o)):this.Yi&&h.fillRect(9*o,28*o,14*o,4*o),n.exits.southeast?n.Indoors?(h.moveTo(32*o,32*o),h.lineTo(24*o,24*o)):(h.moveTo(32*o,32*o),h.lineTo(22*o,22*o)):this.Yi&&(h.fillRect(28*o,28*o,4*o,2*o),h.fillRect(28*o,30*o,2*o,2*o),n.exits.south||h.fillRect(23*o,28*o,5*o,4*o),n.exits.east||h.fillRect(28*o,23*o,4*o,5*o)),n.exits.southwest?n.Indoors?(h.moveTo(0*o,32*o),h.lineTo(8*o,24*o)):(h.moveTo(0*o,32*o),h.lineTo(10*o,22*o)):this.Yi&&(h.fillRect(0*o,28*o,4*o,2*o),h.fillRect(2*o,30*o,2*o,2*o),n.exits.south||h.fillRect(4*o,28*o,5*o,4*o),n.exits.west||h.fillRect(0*o,23*o,4*o,5*o)),h.closePath(),h.stroke(),h.fillStyle="black",h.strokeStyle="black",n.exits.up&&(h.beginPath(),h.moveTo(1*o,11*o),h.lineTo(7*o,11*o),h.lineTo(4*o,8*o),h.closePath(),h.fill()),n.exits.down&&(h.beginPath(),h.moveTo(1*o,21*o),h.lineTo(7*o,21*o),h.lineTo(4*o,24*o),h.closePath(),h.fill()),n.exits.out&&(h.beginPath(),h.moveTo(26*o,8*o),h.lineTo(29*o,11*o),h.lineTo(26*o,14*o),h.closePath(),h.fill()),n.exits.enter&&(h.beginPath(),h.moveTo(29*o,19*o),h.lineTo(26*o,22*o),h.lineTo(29*o,25*o),h.closePath(),h.fill()),(n.details&1)===1?(h.fillStyle="chocolate",h.beginPath(),h.arc(20*o,5*o,2*o,0,Math.PI*2),h.fill(),h.closePath()):(n.details&2)===2&&(h.fillStyle="gray",h.beginPath(),h.arc(12*o,5*o,2*o,0,Math.PI*2),h.fill(),h.closePath()),(n.details&128)===128&&(h.fillStyle="aqua",h.beginPath(),h.arc(12*o,5*o,2*o,0,Math.PI*2),h.fill(),h.closePath()),h.scale(o,o),(n.details&4)===4&&(h.fillStyle="goldenrod",h.beginPath(),h.fillText("$",9,17),h.closePath()),(n.details&8)===8&&(h.fillStyle="purple",h.beginPath(),h.fillText("\u23CF",15,17),h.closePath()),(n.details&16)===16&&(h.fillStyle="blue",h.beginPath(),h.fillText("\u2665",15,17),h.closePath()),(n.details&256)===256&&(h.fillStyle="red",h.beginPath(),h.fillText("\u260D",15,17),h.closePath()),(n.details&512)===512&&(h.fillStyle="rgb(153, 102, 0)",h.beginPath(),h.fillText("\u2658",7,17),h.closePath()),(n.details&64)===64&&(n.details&32)===32?(h.fillStyle="green",h.beginPath(),h.fillText("\u2617",15,17),h.closePath()):(n.details&32)===32?(h.fillStyle="green",h.beginPath(),h.fillText("\u266A",15,17),h.closePath()):(n.details&64)===64&&(h.fillStyle="green",h.beginPath(),h.fillText("\u2616",15,17),h.closePath()),h.setTransform(1,0,0,1,0,0),this.Jo(h,-.5,o)}t.drawImage(this.ci[a],e|0,s|0),this.Zr(t,e+12*o,s-2*o,8*o,3*o,n.exits.north),this.Zr(t,e+31*o,s+12*o,3*o,8*o,n.exits.east),this.Zr(t,e-1*o,s+12*o,3*o,8*o,n.exits.west),this.Zr(t,e+12*o,s+30*o,8*o,3*o,n.exits.south),this.Yr(t,e,s,5*o,5*o,n.exits.northwest),this.Yr(t,e+32*o,s,-5*o,5*o,n.exits.northeast),this.Yr(t,e+32*o,s+32*o,-5*o,-5*o,n.exits.southeast),this.Yr(t,e,s+32*o,5*o,-5*o,n.exits.southwest),!r&&this.selected.num===n.num&&(this.Hr?(t.fillStyle="rgba(135, 206, 250, 0.5)",t.strokeStyle="LightSkyBlue"):(t.fillStyle="rgba(142, 142, 142, 0.5)",t.strokeStyle="rgba(142, 142, 142, 0.5)"),t.fillRoundedRect(e,s,32*o,32*o,8*o),t.strokeRoundedRect(e,s,32*o,32*o,8*o)),this.ts[n.num]===2?this.jr(t,e,s,"green",o):this.ts[n.num]===3?this.jr(t,e,s,"blue",o):this.ts[n.num]&&this.jr(t,e,s,"yellow",o),!r&&n.num===this.he.current.num&&this.jr(t,e,s,"red",o)}jr(t,e,s,n,r){n||(n="yellow"),t.beginPath(),t.fillStyle=n,t.strokeStyle="black",t.arc(e+16*r,s+16*r,4*r,0,Math.PI*2),t.fill(),t.closePath()}Zr(t,e,s,n,r,o){!o||!o.isdoor||(t.beginPath(),t.clearRect(e,s,n,r),t.fillStyle="black",t.strokeStyle="black",o.isclosed?t.fillRect(e,s,n,r):t.strokeRect(e,s,n,r),t.closePath())}Yr(t,e,s,n,r,o){!o||!o.isdoor||(t.beginPath(),t.fillStyle="black",t.strokeStyle="black",t.moveTo(e,s),t.lineTo(e+n,s),t.lineTo(e,s+r),t.lineTo(e,s),o.isclosed?t.fill():t.stroke(),t.closePath())}getRoom(t){return this.he.Rooms[t]}getRooms(t){return t?this.he.getRooms(t):Object.values(this.he.Rooms)}showPath(t){if((!t||!t.num)&&(t=this.selected),this.he.current.num==null||t.num==null||this.Di&&this.he.current.area!==t.area||this.he.current.zone!==t.zone)return;let e;this.Di?e=this.getRooms({area:this.he.current.area,zone:this.he.current.zone}):e=this.getRooms({zone:this.he.current.zone});let s,n,r=[],o=null,a=0,h=0,c=0,g=0,m=0,b,u,E,w,L,k,R,B;for(n in e)if(e.hasOwnProperty(n)){if(s=e[n],o==null){o=s.x,c=s.x+1,a=s.y,g=s.y+1,h=s.z,m=s.z+1;continue}s.x<o?o=s.x:s.x>c&&(c=s.x),s.y<a?a=s.y:s.y>g&&(g=s.y),s.z<h?h=s.z:s.z>m&&(m=s.z)}for(n in e)e.hasOwnProperty(n)&&(s=e[n],s!=null&&(r[s.y-a]||(r[s.y-a]=[]),r[s.y-a][s.x-o]||(r[s.y-a][s.x-o]=[]),r[s.y-a][s.x-o][s.z-h]=s));c=Math.sqrt(Math.pow(c-o,2))+1,g=Math.sqrt(Math.pow(a-g,2))+1,m=Math.sqrt(Math.pow(h-m,2))+1;let v=[];for(w=0;w<g;w++)for(v[w]=[],E=0;E<c;E++)for(v[w][E]=[],L=0;L<m;L++)v[w][E][L]=0;for(n in e)e.hasOwnProperty(n)&&(s=e[n],E=s.x-o,w=s.y-a,L=s.z-h,s.exits.northwest&&(v[w][E][L]|=1),s.exits.north&&(v[w][E][L]|=128),s.exits.northeast&&(v[w][E][L]|=64),s.exits.west&&(v[w][E][L]|=2),s.exits.east&&(v[w][E][L]|=32),s.exits.southwest&&(v[w][E][L]|=4),s.exits.south&&(v[w][E][L]|=8),s.exits.southeast&&(v[w][E][L]|=16),s.exits.up&&(v[w][E][L]|=512),s.exits.down&&(v[w][E][L]|=256));let O=new At.Grid(c,g,m,v),C=new At.AStarFinder({allowDiagonal:!0,dontCrossCorners:!1});E=this.he.current.x-o,w=this.he.current.y-a,L=this.he.current.z-h,k=t.x-o,R=t.y-a,B=t.z-h;let I=C.findPath(E,w,L,k,R,B,O);for(u=I.length,this.ts={},this.si=[this.he.current,t],b=0;b<u;b++)E=Math.floor(I[b][0]),w=Math.floor(I[b][1]),L=Math.floor(I[b][2]),r[w]&&r[w][E]&&r[w][E][L]&&(r[w][E][L].num===this.he.current.num?this.ts[r[w][E][L].num]=2:r[w][E][L].num===t.num?this.ts[r[w][E][L].num]=3:this.ts[r[w][E][L].num]=1);this.emit("path-shown"),this.De(1)}clearPath(){this.emit("path-cleared"),this.ts={},this.si=0,this.De(1)}get hasMarked(){return this.si&&this.si.length!==0}get markedStart(){return this.si?this.si[0]:0}get markedEnd(){return this.si?this.si[1]:0}getMarkedPath(){return new Promise((t,e)=>{this.si?this.getPath(this.si[1],this.si[0]).then(t).catch(e):this.getPath().then(t).catch(e)})}getPath(t,e){return new Promise((s,n)=>{if((!t||!t.num)&&(t=this.selected),(!e||!e.num)&&(e=this.he.current),e.num==null||t.num==null){n("Invalid start or end room.");return}if(this.Di&&e.area!==t.area){n("Start and end rooms must be in same the area.");return}if(e.zone!==t.zone){n("Start and end rooms must be in the same zone.");return}let r;this.Di?r=this.getRooms({area:e.area,zone:e.zone}):r=this.getRooms({zone:e.zone});let o,a,h=null,c=0,g=0,m=0,b=0,u=0,E,w,L,k,R,B,v,O,C,I,D;for(a in r)if(r.hasOwnProperty(a)){if(o=r[a],h==null){h=o.x,m=o.x+1,c=o.y,b=o.y+1,g=o.z,u=o.z+1;continue}o.x<h?h=o.x:o.x>m&&(m=o.x),o.y<c?c=o.y:o.y>b&&(b=o.y),o.z<g?g=o.z:o.z>u&&(u=o.z)}m=Math.sqrt(Math.pow(m-h,2))+1,b=Math.sqrt(Math.pow(c-b,2))+1,u=Math.sqrt(Math.pow(g-u,2))+1;let S=[];for(k=0;k<b;k++)for(S[k]=[],L=0;L<m;L++)for(S[k][L]=[],R=0;R<u;R++)S[k][L][R]=0;for(a in r)r.hasOwnProperty(a)&&(o=r[a],L=o.x-h,k=o.y-c,R=o.z-g,o.exits.northwest&&(S[k][L][R]|=1),o.exits.north&&(S[k][L][R]|=128),o.exits.northeast&&(S[k][L][R]|=64),o.exits.west&&(S[k][L][R]|=2),o.exits.east&&(S[k][L][R]|=32),o.exits.southwest&&(S[k][L][R]|=4),o.exits.south&&(S[k][L][R]|=8),o.exits.southeast&&(S[k][L][R]|=16),o.exits.up&&(S[k][L][R]|=512),o.exits.down&&(S[k][L][R]|=256));let M=new At.Grid(m,b,u,S),q=new At.AStarFinder({allowDiagonal:!0,dontCrossCorners:!1});L=e.x-h,k=e.y-c,R=e.z-g,B=t.x-h,v=t.y-c,O=t.z-g;let Q=q.findPath(L,k,R,B,v,O,M);w=Q.length;let W=[];for(E=0;E<w-1;E++)L=Math.floor(Q[E][0]),k=Math.floor(Q[E][1]),R=Math.floor(Q[E][2]),C=Math.floor(Q[E+1][0]),I=Math.floor(Q[E+1][1]),D=Math.floor(Q[E+1][2]),R-1===D?W.push("down"):R+1===D?W.push("up"):L-1===C&&k-1===I?W.push("northwest"):L===C&&k-1===I?W.push("north"):L+1===C&&k-1===I?W.push("northeast"):L-1===C&&k+1===I?W.push("southwest"):L===C&&k+1===I?W.push("south"):L+1===C&&k+1===I?W.push("southeast"):L-1===C&&k===I?W.push("west"):W.push("east");s(W)})}walkPath(t,e){this.getPath(t,e).then(s=>{this.SendCommands(s)}).catch(()=>{})}walkMarkedPath(){let t=this.si?this.si[1]:0,e=this.si?this.si[0]:0;return new Promise((s,n)=>{this.getPath(t,e).then(r=>{this.SendCommands(r)}).catch(()=>{})})}SendCommands(t){let e,s=this.commandDelayCount;s<0&&(s=1),t.length>s&&(e=t.slice(s),t=t.slice(0,s),setTimeout(()=>{this.SendCommands(e)},this.commandDelay)),this.emit("send-commands",t.join(`
`)+`
`)}De(t){t&&(this.Ye|=t,!(this.Ye===0||this.an)&&(this.an=this.ae.requestAnimationFrame(()=>{(this.Ye&1)===1&&(this.qo().catch(()=>{}),this.Ye&=-2),this.an=0,this.De(this.Ye)})))}Xo(t){this.Hr!==t&&(this.Hr=t,this.De(1))}updateOptions(t){if(t)for(let e in t)Object.prototype.hasOwnProperty.call(t,e)&&e in this&&(this[e]=t[e])}Fr(){if(!this.ms||this.container.clientHeight===0||this.container.clientWidth===0)return;let t=this.ue.createElement("canvas");if(t.width=this.Te.width,t.height=this.Te.height,t.getContext("2d").drawImage(this.Te,0,0),this.bs)this.Te.width=this.container.clientWidth-60,this.Te.height=this.container.clientHeight-60;else{let s=this.ae.getComputedStyle(this.Te),n=parseFloat(s.borderLeftWidth),r=parseFloat(s.borderRightWidth),o=parseFloat(s.borderTopWidth),a=parseFloat(s.borderBottomWidth);this.Te.width=this.container.clientWidth-n-r,this.Te.height=this.container.clientHeight-o-a}this.ms.drawImage(t,0,0),this.De(1)}Ur(t,e){this.Pn&&(this.scrollBy(t,e),setTimeout(()=>{this.Ur(t,e)},100))}copyPath(t){t=t||client.getOption("commandStackingChar")||";",this.getPath().then(e=>{Xe(e.join(t||`
`)),this.emit("debug","Directions: "+e)}).catch(e=>this.emit("error",e))}copyMarkedPath(t){t=t||client.getOption("commandStackingChar")||";",this.getMarkedPath().then(e=>{Xe(e.join(t||`
`)),this.emit("debug","Directions: "+e)}).catch(e=>this.emit("error",e))}copySpeedpath(){this.getPath().then(t=>{let e=0,s="",n=[client.getOption("speedpathsChar")||"!"],r=t.length;for(let o=0;o<r;o++)s.length&&s!==t[o]&&(n.push(e),n.push(s),e=0),e++,s=t[o];n.push(e),n.push(s),Xe(n.join("")),this.emit("debug","Speedpath: "+n)}).catch(t=>this.emit("error",t))}copyMarkedSpeedpath(){this.getMarkedPath().then(t=>{let e=0,s="",n=[client.getOption("speedpathsChar")||"!"],r=t.length;for(let o=0;o<r;o++)s.length&&s!==t[o]&&(n.push(e),n.push(s),e=0),e++,s=t[o];n.push(e),n.push(s),Xe(n.join("")),this.emit("debug","Speedpath: "+n)}).catch(t=>this.emit("error",t))}exportImage(t){let e=this.getRooms({area:this.active.area,z:this.active.z,zone:this.active.zone}),s=null,n=0,r=0,o=0,a,h=e.length,c,g,m,b=this.active.area===null||!this.Di?"":this.active.area,u=t?this.je:1;for(a=0;a<h;a++)if(c=e[a],c!==null){if(s===null){s=c.x,r=c.x+1,n=c.y,o=c.y+1;continue}c.x<s?s=c.x:c.x>r&&(r=c.x),c.y<n?n=c.y:c.y>o&&(o=c.y)}this.ms.font="italic bold 16pt Georgia";let E=this.ms.measureText(b).width,w=Math.ceil(Math.sqrt(Math.pow(r-s,2))*32*u+60+32),L=Math.ceil(Math.sqrt(Math.pow(n-o,2))*32*u+60+32);w<E&&(w=E+60),this.pr&&(w+=155,L<200&&(L=200));let k=this.ue.createElement("canvas");k.id="mapper-export",k.style.height=L+"px",k.style.width=w+"px",k.width=w,k.height=L;let R;if(k&&k.getContext)R=k.getContext("2d");else{this.emit("error","Mapper image export: Error generating map!");return}for(R.strokeStyle="black",R.fillStyle="#eae4d6",R.fillRect(0,0,k.width,k.height),R.font="8pt Arial",a=0;a<h;a++)c=e[a],c!==null&&(g=(c.x-s)*32*u+30.5,m=(c.y-n)*32*u+30.5,this.Vo(R,g,m,c,!0,u));R.save(),R.strokeStyle="black",R.fillStyle="black",R.font="italic bold 16pt Georgia",E=w/2-E/2,R.fillText(b,E,20),R.translate(w-25,L-25),R.font="italic bold 12pt Georgia",R.fillText("N",3,-5),R.beginPath(),R.moveTo(10,0),R.lineTo(5,15),R.lineTo(10,20),R.lineTo(15,15),R.lineTo(10,0),R.closePath(),R.fill(),R.stroke(),R.restore(),this.Ko(R,w-185,-10,1),k.toBlob(B=>{let v=new FileReader;v.addEventListener("loadend",O=>{fileSaveAs.show(O.target.result,this.Di&&b.length?"OoMUD."+b+".png":"OoMUD.png","image/png")}),v.readAsArrayBuffer(B)})}exportCurrentImage(){let t=this.ue.createElement("canvas"),e=t.getContext("2d");t.width=this.Te.width,t.height=this.Te.height,this.qo(t,e,!0).then(()=>{t.toBlob(s=>{let n=new FileReader;n.addEventListener("loadend",r=>{fileSaveAs.show(r.target.result,"OoMUD.current.png","image/png")}),n.readAsArrayBuffer(s)})})}exportArea(){fileSaveAs.show(JSON.stringify(this.getRooms({area:this.active.area})),this.Di?"OoMUD."+this.active.area+".map.txt":"OoMUD.map.txt","text/plain")}exportAll(){fileSaveAs.show(JSON.stringify(this.map.Rooms),"OoMUD.map.txt","text/plain")}};var ks='<div class="mb-3"><label class="form-label" for="pasteSpecial-replace">Replace with</label><div class="input-group"><input id="pasteSpecial-replace" class="form-control"><div class="input-group-text"><input class="form-check-input" type="checkbox" id="pasteSpecial-replace-enable" checked="checked"></div></div></div><div class="mb-3"><label class="form-label" for="pasteSpecial-prefix">Prefix</label><div class="input-group"><input id="pasteSpecial-prefix" class="form-control"><div class="input-group-text"><input class="form-check-input" type="checkbox" id="pasteSpecial-prefix-enable" checked="checked"></div></div></div><div class="mb-3"><label class="form-label" for="pasteSpecial-postfix">Postfix</label><div class="input-group"><input id="pasteSpecial-postfix" class="form-control"><div class="input-group-text"><input class="form-check-input" type="checkbox" id="pasteSpecial-postfix-enable" checked="checked"></div></div></div>';var Tt=(o=>(o[o.None=0]="None",o[o.Ok=1]="Ok",o[o.Cancel=2]="Cancel",o[o.Yes=4]="Yes",o[o.No=8]="No",o[o.YesNo=12]="YesNo",o[o.Standard=3]="Standard",o))(Tt||{});var ye=class extends me{constructor(t){super();this.ce={x:0,y:0,height:0,width:0,zIndex:100,maximized:!1,show:0,persistent:!1};this.fe={x:0,y:0,height:0,width:0,type:0,minHeight:150,minWidth:300,borderHeight:1,borderWidth:1};this.Ai={x:0,y:0};this.cn=()=>{ve(()=>{this.keepCentered||this.ce.show===2&&!this.moveable?this.center():this.makeVisible(),this.Vt.style.display!=="none"&&(this.di.style.bottom=this.Vt.clientHeight+1+"px"),this.emit(this.id+"resizing")},250,this.Fe+"dialogResize")};this.Qo=t=>{let e;if((this.fe.type&1)===1&&(e=this.fe.width+t.clientX-this.fe.x,e>window.innerWidth&&(e=window.innerWidth),this.$.style.width=e+"px"),(this.fe.type&2)===2&&(e=this.fe.height+t.clientY-this.fe.y,e>window.innerWidth-16&&(e=window.innerHeight-16),this.$.style.height=e+"px"),(this.fe.type&8)===8){if(e=this.fe.height-t.clientY+this.fe.y-this.fe.borderHeight,e+this.fe.borderHeight>window.innerHeight&&(e=window.innerHeight),e+this.fe.borderHeight<=this.fe.minHeight){let s=this.$.getBoundingClientRect();this.$.style.top=s.bottom-this.fe.minHeight+"px",this.$.style.height=this.fe.minHeight+"px";return}this.$.style.height=e+"px",e=t.clientY,e>window.innerHeight&&(e=window.innerHeight),this.$.style.top=e+"px"}if((this.fe.type&4)===4){if(e=this.fe.width-t.clientX+this.fe.x-this.fe.borderWidth,e+this.fe.borderWidth>window.innerWidth&&(e=window.innerWidth),e+this.fe.borderWidth<=this.fe.minWidth){let s=this.$.getBoundingClientRect();this.$.style.left=s.right-this.fe.minWidth+"px",this.$.style.width=this.fe.minWidth+"px";return}this.$.style.width=e+"px",e=t.clientX,e>window.innerWidth&&(e=window.innerWidth),this.$.style.left=e+"px"}this.Vt.style.display!=="none"&&(this.di.style.bottom=this.Vt.clientHeight+1+"px"),this.emit("resizing")};this._o=t=>{if(!t.touches.length)return;let e;if((this.fe.type&1)===1&&(e=this.fe.width+t.touches[0].clientX-this.fe.x,e>window.innerWidth&&(e=window.innerWidth),this.$.style.width=e+"px"),(this.fe.type&2)===2&&(e=this.fe.height+t.touches[0].clientY-this.fe.y,e>window.innerWidth&&(e=window.innerHeight),this.$.style.height=e+"px"),(this.fe.type&8)===8){if(e=this.fe.height-t.touches[0].clientY+this.fe.y-this.fe.borderHeight,e+this.fe.borderHeight>window.innerHeight&&(e=window.innerHeight),e+this.fe.borderHeight<=this.fe.minHeight){let s=this.$.getBoundingClientRect();this.$.style.top=s.bottom-this.fe.minHeight+"px",this.$.style.height=this.fe.minHeight+"px";return}this.$.style.height=e+"px",e=t.touches[0].clientY,e>window.innerHeight&&(e=window.innerHeight),this.$.style.top=e+"px"}if((this.fe.type&4)===4){if(e=this.fe.width-t.touches[0].clientX+this.fe.x-this.fe.borderWidth,e+this.fe.borderWidth>window.innerWidth&&(e=window.innerWidth),e+this.fe.borderWidth<=this.fe.minWidth){let s=this.$.getBoundingClientRect();this.$.style.left=s.right-this.fe.minWidth+"px",this.$.style.width=this.fe.minWidth+"px";return}this.$.style.width=e+"px",e=t.touches[0].clientX,e>window.innerWidth&&(e=window.innerWidth),this.$.style.left=e+"px"}this.Vt.style.display!=="none"&&(this.di.style.bottom=this.Vt.clientHeight+1+"px"),this.emit("resizing")};this.Xr=t=>{this.ue.documentElement.removeEventListener("mousemove",this.Qo),this.ue.documentElement.removeEventListener("mouseup",this.Xr),this.ue.documentElement.removeEventListener("touchmove",this._o),this.ue.documentElement.removeEventListener("touchend",this.Xr);let e=this.ae.getComputedStyle(this.$);this.ce.x=parseInt(e.left,10),this.ce.width=parseInt(e.width,10),this.ce.y=parseInt(e.top,10),this.ce.height=parseInt(e.height,10),this.di.style.pointerEvents="",this.emit("resized",this.ce)};this.bh=t=>{if(this.maximized)return;let e=t.srcElement?t.srcElement.tagName:"";e&&(t.srcElement.parentElement&&t.srcElement.parentNode.tagName==="BUTTON"||e==="BUTTON"||e==="INPUT"||e==="SELECT"||e==="SELECT"||e==="TEXTAREA")||(this.Ai.x=t.clientX,this.Ai.y=t.clientY,this.ue.documentElement.addEventListener("mouseup",this.qr),this.ue.documentElement.addEventListener("mousemove",this.ea),this.hn.style.cursor="move")};this.yh=t=>{if(this.maximized)return;let e=t.srcElement?t.srcElement.tagName:"";e&&(t.srcElement.parentElement&&t.srcElement.parentNode.tagName==="BUTTON"||e==="BUTTON"||e==="INPUT"||e==="SELECT"||e==="SELECT"||e==="TEXTAREA")||(this.Ai.x=t.clientX,this.Ai.y=t.clientY,this.ue.documentElement.addEventListener("touchend",this.qr),this.ue.documentElement.addEventListener("touchmove",this.ta),this.hn.style.cursor="move")};this.ea=t=>{let e=this.Ai.x-t.clientX,s=this.Ai.y-t.clientY;this.Ai.x=t.clientX,this.Ai.y=t.clientY,this.ce.x=this.$.offsetLeft-e,this.ce.y=this.$.offsetTop-s,this.ce.x>window.innerWidth-16&&(this.ce.x=window.innerWidth-16),this.ce.y>window.innerHeight-16&&(this.ce.y=window.innerHeight-16);let n=this.io;this.ce.x<16-n.width&&(this.ce.x=16-n.width),this.ce.y<16-n.height&&(this.ce.y=16-n.height),this.$.style.left=this.ce.x+"px",this.$.style.top=this.ce.y+"px"};this.ta=t=>{if(!t.touches.length)return;let e=this.Ai.x-t.touches[0].clientX,s=this.Ai.y-t.touches[0].clientY;this.Ai.x=t.touches[0].clientX,this.Ai.y=t.touches[0].clientY,this.ce.x=this.$.offsetLeft-e,this.ce.y=this.$.offsetTop-s,this.ce.x>window.innerWidth-16&&(this.ce.x=window.innerWidth-16),this.ce.y>window.innerHeight-16&&(this.ce.y=window.innerHeight-16);let n=this.io;this.ce.x<16-n.width&&(this.ce.x=16-n.width),this.ce.y<16-n.height&&(this.ce.y=16-n.height),this.$.style.left=this.ce.x+"px",this.$.style.top=this.ce.y+"px"};this.qr=()=>{this.ue.documentElement.removeEventListener("mouseup",this.qr),this.ue.documentElement.removeEventListener("mousemove",this.ea),this.ue.documentElement.removeEventListener("touchend",this.qr),this.ue.documentElement.removeEventListener("touchmove",this.ta),this.hn.style.cursor="";let t=this.ae.getComputedStyle(this.$);this.ce.x=parseInt(t.left,10),this.ce.width=parseInt(t.width,10),this.ce.y=parseInt(t.top,10),this.ce.height=parseInt(t.height,10),this.emit("moved",this.ce)};this.keepCentered=!1;this.moveable=!0;this.resizable=!0;this.dr=!0;this.Vr=!0;this.ae=window,this.ue=t&&t.document||document,this.ae=this.ue.defaultView,t&&"type"in t&&t.type==1?(this.$=this.ue.createElement("div"),this.$.open=!1):this.$=this.ue.createElement("dialog"),typeof this.$.showModal!="function"&&(this.$.showModal=()=>{this.$.open||(this.$.style.display="block",this.$.style.visibility="visible",this.$.open=!0,this.ce.show=2,this.$.dataset.show=""+this.ce.show,this.$.As||(this.$.As=n=>{n.key==="Escape"&&n.srcElement.tagName!=="TEXTAREA"&&n.srcElement.tagName!=="INPUT"&&n.srcElement.tagName!=="SELECT"&&(this.$.returnValue="canceled",this.close())}),this.$.backdrop_||(this.$.backdrop_=this.ue.createElement("div"),this.$.backdrop_.className="backdrop",this.$.backdrop_MouseEvent=function(n){if(this.hasAttribute("tabindex"))this.focus();else{let o=this.ue.createElement("div");this.insertBefore(o,this.firstChild),o.tabIndex=-1,o.focus(),this.removeChild(o)}let r=this.ue.createEvent("MouseEvents");r.initMouseEvent(n.type,n.bubbles,n.cancelable,window,n.detail,n.screenX,n.screenY,n.clientX,n.clientY,n.ctrlKey,n.altKey,n.shiftKey,n.metaKey,n.button,n.relatedTarget),this.dispatchEvent(r),n.stopPropagation()},this.$.backdrop_.addEventListener("mouseup",this.$.backdrop_MouseEvent.bind(this.$)),this.$.backdrop_.addEventListener("mousedown",this.$.backdrop_MouseEvent.bind(this.$)),this.$.backdrop_.addEventListener("click",this.$.backdrop_MouseEvent.bind(this.$))),this.$.parentNode.insertBefore(this.$.backdrop_,this.$.nextSibling),this.ue.addEventListener("keydown",this.$.As))}),typeof this.$.show!="function"&&(this.$.show=()=>{this.$.open||(this.$.style.display="block",this.$.style.visibility="visible",this.$.open=!0,this.ce.show=1,this.$.dataset.show=""+this.ce.show)}),typeof this.$.close!="function"&&(this.$.close=()=>{this.$.style.display="",this.$.style.visibility="",this.$.open=!1,this.ce.show=0,this.$.dataset.show=""+this.ce.show,this.ae.removeEventListener("resize",this.cn),this.emit("closed")}),this.$.dialog=this,t&&"id"in t&&t.id&&t.id.length?this.Fe=t.id:(!this.Fe||!this.Fe.length)&&(this.Fe="dialog"+new Date().getTime()),this.$.id=this.Fe,this.$.style.zIndex="100",this.$.style.margin="0",this.$.classList.add("dialog"),(!t||!t.noAdaptive)&&this.$.classList.add("adaptive"),t&&"moveable"in t&&(this.moveable=t.moveable),t&&"resizable"in t&&(this.resizable=t.resizable),t&&"maximizable"in t&&(this.dr=t.maximizable),t&&"persistent"in t&&(this.ce.persistent=t.persistent),typeof t?.height=="number"?this.$.style.height=t.height+"px":t?.height&&t?.height.length>0?this.$.style.height=t.height:this.$.style.height="480px",typeof t?.minHeight=="number"?this.$.style.minHeight=t.minHeight+"px":t?.minHeight&&t?.minHeight.length>0?this.$.style.minHeight=t.minHeight:this.$.style.minHeight="150px",typeof t?.minWidth=="number"?this.$.style.minWidth=t.minWidth+"px":t?.minWidth&&t?.minWidth.length>0?this.$.style.minWidth=t.minWidth:this.$.style.minWidth="300px",typeof t?.width=="number"?this.$.style.width=t.width+"px":t?.width&&t?.width.length>0?this.$.style.width=t.width:this.$.style.width="640px",typeof t?.y=="number"?this.$.style.top=t.y+"px":t?.y&&t?.y.length>0?this.$.style.top=t.y:this.$.style.top="0",typeof t?.x=="number"?this.$.style.left=t.x+"px":t?.x&&t?.x.length>0?this.$.style.left=t.x:this.$.style.left="0";let e="";if(t&&(t.buttons&2)===2&&(e+=`<button id="${this.Fe}-cancel" type="button" class="btn-sm float-end btn btn-light" title="Cancel dialog">Cancel</button>`),t&&(t.buttons&1)===1&&(e+=`<button id="${this.Fe}-ok" type="button" class="btn-sm float-end btn btn-primary" title="Confirm dialog">Ok</button>`),t&&(t.buttons&8)===8&&(e+=`<button id="${this.Fe}-no" type="button" class="btn-sm float-end btn btn-light" title="No">No</button>`),t&&(t.buttons&4)===4&&(e+=`<button id="${this.Fe}-yes" type="button" class="btn-sm float-end btn btn-primary" title="Yes">Yes</button>`),this.$.innerHTML=`<div class="dialog-header"><button id="${this.Fe}-header-close" style="padding: 4px;" type="button" class="btn btn-close float-end btn-danger" data-dismiss="modal" title="Close window"></button><button type="button" class="btn btn-light float-end maximize" id="${this.Fe}-max" title="Maximize window" style="padding: 0 4px;margin-top: -1px;"><i class="bi-arrows-fullscreen"></i></button><div>${t?.title||""}</div></div><div class="dialog-body"></div><div class="dialog-footer">${e}</div>`,this.$.querySelector(`#${this.Fe}-header-close`).addEventListener("click",()=>{this.close()}),this.$.querySelector(`#${this.Fe}-max`).addEventListener("click",()=>{this.maximized?this.restore():this.maximize()}),this.$.addEventListener("close",n=>{if(n.target!==this.$)return;let r={preventDefault:!1};if(this.emit("closing",r),r.preventDefault){n.preventDefault();return}this.ce.persistent||this.ue.body.removeChild(this.$),this.ce.show=0,this.$.dataset.show=""+this.ce.show,this.$.backdrop_&&this.$.parentNode.removeChild(this.$.backdrop_),this.$.As&&this.ae.document.removeEventListener("keydown",this.$.As),this.ae.removeEventListener("resize",this.cn),this.emit("closed",this.$.returnValue)}),this.$.addEventListener("cancel",n=>{if(n.target!==this.$)return;let r={preventDefault:!1};if(this.emit("canceling",r),r.preventDefault){n.preventDefault();return}if(this.ue.activeElement&&(this.ue.activeElement.tagName==="TEXTAREA"||this.ue.activeElement.tagName==="iNPUT"||this.ue.activeElement.tagName==="SELECT")){n.preventDefault();return}this.$.open=!1,this.ce.persistent||this.ue.body.removeChild(this.$),this.ce.show=0,this.$.dataset.show=""+this.ce.show,this.$.backdrop_&&this.$.parentNode.removeChild(this.$.backdrop_),this.$.As&&this.ae.document.removeEventListener("keydown",this.$.As),this.ae.removeEventListener("resize",this.cn),this.$.returnValue!=="ok"&&this.emit("canceled")}),this.ue.body.appendChild(this.$),this.dr?this.$.querySelector(`#${this.Fe}-max`).style.display="":this.$.querySelector(`#${this.Fe}-max`).style.display="none",t&&"closeable"in t&&(this.closeable=t.closeable),t&&(t.buttons&2)===2&&this.$.querySelector(`#${this.Fe}-cancel`).addEventListener("click",()=>{let n={preventDefault:!1,button:2};this.emit("button-click",n),!n.preventDefault&&(this.$.returnValue="cancel",this.close())}),t&&(t.buttons&8)===8&&this.$.querySelector(`#${this.Fe}-no`).addEventListener("click",()=>{let n={preventDefault:!1,button:8};this.emit("button-click",n),!n.preventDefault&&(this.$.returnValue="no",this.close())}),t&&(t.buttons&1)===1&&this.$.querySelector(`#${this.Fe}-ok`).addEventListener("click",()=>{let n={preventDefault:!1,button:1};this.emit("button-click",n),!n.preventDefault&&(this.$.returnValue="ok",this.$.close())}),t&&(t.buttons&4)===4&&this.$.querySelector(`#${this.Fe}-yes`).addEventListener("click",()=>{let n={preventDefault:!1,button:4};this.emit("button-click",n),!n.preventDefault&&(this.$.returnValue="yes",this.$.close())}),this.di=this.$.querySelector('[class="dialog-body"]'),this.eo=this.$.querySelector('[class="dialog-header"] div'),this.Vt=this.$.querySelector('[class="dialog-footer"]'),this.hn=this.$.querySelector('[class="dialog-header"]'),this.resizable){this.$.classList.add("resizable");let n=this.ue.createElement("div");n.className="resizer-right",this.$.appendChild(n),n.addEventListener("mousedown",c=>{this.Gs(c,1)},!1),n.addEventListener("touchstart",c=>{this.Ws(c,1)},{passive:!0});let r=this.ue.createElement("div");r.className="resizer-bottom",this.$.appendChild(r),r.addEventListener("mousedown",c=>{this.Gs(c,2)},!1),r.addEventListener("touchstart",c=>{this.Ws(c,2)},{passive:!0});let o=this.ue.createElement("div");o.className="resizer-se",this.$.appendChild(o),o.addEventListener("mousedown",c=>{this.Gs(c,3)},!1),o.addEventListener("touchstart",c=>{this.Ws(c,3)},{passive:!0}),o=this.ue.createElement("div"),o.className="resizer-ne",this.$.appendChild(o),o.addEventListener("mousedown",c=>{this.Gs(c,9)},!1),o.addEventListener("touchstart",c=>{this.Ws(c,9)},{passive:!0}),o=this.ue.createElement("div"),o.className="resizer-nw",this.$.appendChild(o),o.addEventListener("mousedown",c=>{this.Gs(c,12)},!1),o.addEventListener("touchstart",c=>{this.Ws(c,12)},{passive:!0}),o=this.ue.createElement("div"),o.className="resizer-sw",this.$.appendChild(o),o.addEventListener("mousedown",c=>{this.Gs(c,6)},!1),o.addEventListener("touchstart",c=>{this.Ws(c,6)},{passive:!0});let a=this.ue.createElement("div");a.className="resizer-left",this.$.appendChild(a),a.addEventListener("mousedown",c=>{this.Gs(c,4)},!1),a.addEventListener("touchstart",c=>{this.Ws(c,4)},{passive:!0});let h=this.ue.createElement("div");h.className="resizer-top",this.$.appendChild(h),h.addEventListener("mousedown",c=>{this.Gs(c,8)},!1),h.addEventListener("touchstart",c=>{this.Ws(c,8)},{passive:!0})}this.moveable&&(this.$.addEventListener("mousedown",()=>{this.$.contains(document.activeElement)||this.focus()}),this.hn.addEventListener("mousedown",this.bh),this.hn.addEventListener("touchstart",this.yh,{passive:!0}));let s=this.ae.getComputedStyle(this.$);this.ce.x=this.fe.x=parseInt(s.left,10),this.ce.width=this.fe.width=parseInt(s.width,10),this.ce.y=this.fe.y=parseInt(s.top,10),this.ce.height=this.fe.height=parseInt(s.height,10),t&&"noFooter"in t&&t.noFooter&&this.hideFooter(),t&&"maximized"in t&&t.maximized&&this.maximize(),t&&"showModal"in t&&t.showModal?this.showModal():t&&"show"in t&&t.show&&(t.show===2?this.showModal():this.show()),t&&"keepCentered"in t&&t.keepCentered&&(this.keepCentered=t.keepCentered),(this.keepCentered||t&&"center"in t&&t.center)&&this.center(),t&&"position"in t&&t.position>0&&this.position(t.position),this.cn(),this.Ps=new ResizeObserver((n,r)=>{n.length!==0&&(!n[0].contentRect||n[0].contentRect.width===0||n[0].contentRect.height===0||(!this.Ii||this.Ii.height!==n[0].contentRect.height)&&(this.Ii={width:n[0].contentRect.width,height:n[0].contentRect.height},this.Vt.style.display!=="none"&&(this.di.style.bottom=this.Vt.clientHeight+1+"px")))}),this.Ps.observe(this.Vt),this.Os=new MutationObserver(n=>{let r;for(r of n)r.type==="attributes"&&r.attributeName==="style"&&this.Vt.style.display!=="none"&&(this.di.style.bottom=this.Vt.clientHeight+1+"px")}),this.Os.observe(this.Vt,{attributes:!0,attributeOldValue:!0,attributeFilter:["style"]})}get persistent(){return this.ce.persistent}set persistent(t){t!==this.ce.persistent&&(this.ce.persistent=t,t&&this.$&&!this.$.parentElement?this.ue.body.appendChild(this.$):!t&&this.$.parentElement&&this.ue.body.removeChild(this.$))}get maximizable(){return this.dr}set maximizable(t){t!==this.dr&&(this.dr=t,this.maximizable?this.$.querySelector(`#${this.Fe}-max`).style.display="":this.$.querySelector(`#${this.Fe}-max`).style.display="none")}get closeable(){return this.Vr}set closeable(t){t!==this.Vr&&(this.Vr=t,this.Vr?this.$.querySelector(`#${this.Fe}-header-close`).style.display="":this.$.querySelector(`#${this.Fe}-header-close`).style.display="none")}set maximized(t){this.ce.maximized!==t&&(this.ce.maximized=t)}get maximized(){return this.ce.maximized}Gs(t,e){if(this.maximized)return;let s=this.ae.getComputedStyle(this.$);this.fe.x=t.clientX,this.fe.width=parseInt(s.width,10),this.fe.y=t.clientY,this.fe.height=parseInt(s.height,10),this.fe.type=e,this.fe.minHeight=parseInt(s.minHeight,10),this.fe.minWidth=parseInt(s.minWidth,10),this.fe.borderHeight=parseInt(s.borderTopWidth),this.fe.borderWidth=parseInt(s.borderLeftWidth),this.di.style.pointerEvents="none",this.ue.documentElement.addEventListener("mousemove",this.Qo,!1),this.ue.documentElement.addEventListener("mouseup",this.Xr,!1)}Ws(t,e){if(!t.touches.length||this.maximized)return;let s=this.ae.getComputedStyle(this.$);this.fe.x=t.touches[0].clientX,this.fe.width=parseInt(s.width,10),this.fe.y=t.touches[0].clientY,this.fe.height=parseInt(s.height,10),this.fe.type=e,this.fe.minHeight=parseInt(s.minHeight,10),this.fe.minWidth=parseInt(s.minWidth,10),this.fe.borderHeight=parseInt(s.borderTopWidth),this.fe.borderWidth=parseInt(s.borderLeftWidth),this.di.style.pointerEvents="none",this.ue.documentElement.addEventListener("touchmove",this._o,!1),this.ue.documentElement.addEventListener("touchend",this.Xr,!1)}get id(){return this.Fe}set id(t){if(this.Fe!==t&&(this.Fe=t,this.$)){this.$.id=this.Fe;let e=this.$.querySelector(`#${this.Fe}-cancel`);e&&(e.id=this.Fe+"-cancel"),e=this.$.querySelector(`#${this.Fe}-ok`),e&&(e.id=this.Fe+"-ok"),e=this.$.querySelector(`#${this.Fe}-max`),e&&(e.id=this.Fe+"-max"),e=this.$.querySelector(`#${this.Fe}-header-close`),e&&(e.id=this.Fe+"-header-close")}}get title(){return this.eo.innerHTML}set title(t){this.eo.innerHTML=t}showModal(){if(this.$.parentElement||this.ue.body.appendChild(this.$),this.makeVisible(!0),this.$.returnValue="",this.$.open){this.focus();return}this.$.showModal(),this.ce.show=2,this.$.dataset.show=""+this.ce.show,this.ae.addEventListener("resize",this.cn),this.emit("shown",!0),this.focus()}show(){if(this.$.parentElement||this.ue.body.appendChild(this.$),this.makeVisible(!0),this.$.returnValue="",this.$.open){this.focus();return}this.$.show(),this.ce.show=1,this.$.dataset.show=""+this.ce.show,this.ae.addEventListener("resize",this.cn),this.emit("shown",!1),this.focus()}get opened(){return this.$.open}close(t){this.$.open&&(this.$.backdrop_&&this.$.parentNode.removeChild(this.$.backdrop_),this.$.As&&this.ue.removeEventListener("keydown",this.$.As),t&&(this.$.returnValue=t),this.$.close())}get header(){return this.hn}get body(){return this.di}get footer(){return this.Vt}get dialog(){return this.$}get left(){return this.$.style.left}set left(t){this.$.style.left=t}get top(){return this.$.style.top}set top(t){this.$.style.top=t}get width(){return this.$.style.width}set width(t){this.$.style.width=t}get height(){return this.$.style.height}set height(t){this.$.style.top=t}get windowState(){return this.ce}get io(){let t=this.$.offsetWidth||this.$.clientWidth,e=this.$.offsetHeight||this.$.clientHeight;if(!t||!e){let s=this.ae.getComputedStyle(this.$);t=t||parseInt(s.width,10),e=e||parseInt(s.height,10)}return{width:t,height:e}}center(){this.position(48)}position(t){if(t<1)return;let e=this.io;(t&4)===4?this.ce.y=0:(t&8)===8?this.ce.y=this.ae.innerHeight-e.height:(t&16)===16&&(this.ce.y=this.ae.innerHeight/2-e.height/2),(t&1)===1?this.ce.x=0:(t&2)===2?this.ce.x=this.ae.innerWidth-e.width:(t&32)===32&&(this.ce.x=this.ae.innerWidth/2-e.width/2),this.$.style.left=this.ce.x+"px",this.$.style.top=this.ce.y+"px",this.ce.width=e.width,this.ce.height=e.height,this.emit("moved",this.ce)}maximize(){this.maximized||(this.maximized=!0,this.$.classList.add("maximized"),this.$.querySelector(`#${this.Fe}-max`).firstElementChild.classList.remove("bi-arrows-fullscreen"),this.$.querySelector(`#${this.Fe}-max`).firstElementChild.classList.add("bi-arrows-angle-contract"),this.emit("maximized"))}restore(){this.maximized&&(this.maximized=!1,this.$.classList.remove("maximized"),this.$.querySelector(`#${this.Fe}-max`).firstElementChild.classList.add("bi-arrows-fullscreen"),this.$.querySelector(`#${this.Fe}-max`).firstElementChild.classList.remove("bi-arrows-angle-contract"),this.emit("restored"))}wh(t){let e=this.ue.getElementsByTagName("dialog"),s=0,n=e.length,r=parseInt(this.$.style.zIndex,10),o=[];for(;s<n;s++){if(!e[s].style.zIndex||!e[s].style.zIndex.length)continue;let a=parseInt(e[s].style.zIndex,10);a>r&&(r=a),o.push({z:a,idx:s,show:parseInt(e[s].dataset.show||"",10)||0})}if(this.ce.zIndex=r,t||this.ce.zIndex>1e3)for(this.ce.zIndex=100,s=0,o.sort((a,h)=>a.show>h.show?1:a.z<h.z?-1:a.z>h.z?1:0);s<n;s++)e[o[s]].backdrop_&&(e[o[s]].backdrop_.style.zIndex=""+this.ce.zIndex++),e[o[s].idx].style.zIndex=""+this.ce.zIndex++}showFooter(){this.Vt.style.display="",this.di.style.bottom=this.Vt.clientHeight+1+"px"}hideFooter(){this.Vt.style.display="none",this.di.style.bottom="0"}focus(){this.$.focus(),this.wh(),this.$.style.zIndex=""+ ++this.ce.zIndex,this.emit("focus")}makeVisible(t,e){let s=this.$.getBoundingClientRect();t?(s.right>this.ae.innerWidth&&(this.ce.x=this.ae.innerWidth-this.ce.width-16,s.left<0&&(this.ce.x=0),this.$.style.left=this.ce.x+"px"),s.bottom>this.ae.innerHeight&&(this.ce.y=this.ae.innerHeight-this.ce.height-16,s.top<0&&(this.ce.y=0),this.$.style.top=this.ce.y+"px")):(s.left>this.ae.innerWidth-16&&(this.ce.x=this.ae.innerWidth-16,this.$.style.left=this.ce.x+"px"),s.top>this.ae.innerHeight-16&&(this.ce.y=this.ae.innerHeight-16,this.$.style.top=this.ce.y+"px")),e||this.emit("moved",this.ce)}resetState(t){this.ce.persistent=t.persistent,typeof t?.height=="number"?this.$.style.height=t.height+"px":t?.height&&t?.height.length>0?this.$.style.height=t.height:this.$.style.height="480px",typeof t?.minHeight=="number"?this.$.style.minHeight=t.minHeight+"px":t?.minHeight&&t?.minHeight.length>0?this.$.style.minHeight=t.minHeight:this.$.style.minHeight="150px",typeof t?.minWidth=="number"?this.$.style.minWidth=t.minWidth+"px":t?.minWidth&&t?.minWidth.length>0?this.$.style.minWidth=t.minWidth:this.$.style.minWidth="300px",typeof t?.width=="number"?this.$.style.width=t.width+"px":t?.width&&t?.width.length>0?this.$.style.width=t.width:this.$.style.width="640px",typeof t?.y=="number"?this.$.style.top=t.y+"px":t?.y&&t?.y.length>0?this.$.style.top=t.y:this.$.style.top="0",typeof t?.x=="number"?this.$.style.left=t.x+"px":t?.x&&t?.x.length>0?this.$.style.left=t.x:this.$.style.left="0";let e=this.ae.getComputedStyle(this.$);this.ce.x=this.fe.x=parseInt(e.left,10),this.ce.width=this.fe.width=parseInt(e.width,10),this.ce.y=this.fe.y=parseInt(e.top,10),this.ce.height=this.fe.height=parseInt(e.height,10),this.ce.show||(this.ce.persistent&&this.$&&!this.$.parentElement?this.ue.body.appendChild(this.$):!this.ce.persistent&&this.$.parentElement&&this.ue.body.removeChild(this.$)),t&&"maximized"in t&&t.maximized?this.maximize():this.restore(),(this.keepCentered||t&&"center"in t&&t.center)&&this.center(),t&&"position"in t&&t.position>0&&this.position(t.position),this.cn()}setBody(t,e){this.di.innerHTML=t,e=e||{};let s=this.di.querySelectorAll("script");for(let n=0,r=s.length;n<r;n++)new Function("body","dialog",...Object.keys(e),s[n].textContent).apply(client,[this.di,this,...Object.values(e),this])}},Ui=class extends ye{constructor(p,t,e,s){super(typeof p=="string"?{title:Kt(e||4)+p,width:300,height:150,keepCentered:!0,center:!0,resizable:!1,moveable:!1,maximizable:!1,buttons:1,document:s?s.document:document}:p),this.body.classList.add("d-flex","justify-content-center","align-content-center","align-items-center"),t&&(this.body.innerHTML=`<div class="text-center" style="width: 64px;height:64px;font-size: 40px;">${Kt(e||4)}</div><div class="ms-3 align-self-center flex-fill">${t}</div></div>`)}},Zi=class extends ye{constructor(p,t,e,s,n){super(typeof p=="string"?{title:Kt(e||1)+p,width:300,height:150,keepCentered:!0,center:!0,resizable:!1,moveable:!1,maximizable:!1,buttons:s===void 0?12:s,document:n?n.document:document}:p),this.body.classList.add("d-flex","justify-content-center","align-content-center","align-items-center"),t&&(this.body.innerHTML=`<div class="text-center" style="width: 64px;height:64px;font-size: 40px;">${Kt(e||1)}</div><div class="ms-3 align-self-center flex-fill">${t}</div></div>`)}},Yi=class extends ye{constructor(p,t,e,s){super(typeof p=="string"?{title:Kt(e||1)+p,width:300,height:150,keepCentered:!0,center:!0,resizable:!1,moveable:!1,maximizable:!1,buttons:2,closeable:!1,document:s?s.document:document}:p),this.body.classList.add("text-center","justify-content-center","align-content-center","align-items-center"),this.body.innerHTML=`<div class="align-self-center flex-fill" id="progress-message" style="padding:0 5px">${t||""}</div></div><div class="progress" role="progressbar" aria-label="${p}" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="margin: 5px;"><div class="progress-bar" style="width: 0%"></div></div>`,this.fr=this.body.querySelector(".progress-bar")}set label(p){this.fr.innerHTML=p}get label(){return this.fr.innerHTML}set progress(p){p<0&&(p=0),p>100&&(p=100),this.fr.style.width=p+"%"}get progress(){return parseInt(this.fr.style.width,10)}get message(){return this.body.querySelector("#progress-message").textContent}set message(p){this.body.querySelector("#progress-message").textContent=p}};function Kt(f){if(typeof f=="string")return f+" ";switch(f){case 3:return'<i class="fa-regular fa-circle-xmark"></i> ';case 4:return'<i class="fa-solid fa-circle-exclamation"></i> ';case 1:return'<i class="fa-regular fa-circle-question"></i> '}return'<i class="fa-solid fa-circle-info"></i> '}window.confirm_box=(f,p,t,e,s)=>new Promise((n,r)=>{let o=new Zi(f,p,t,e,s);o.showModal(),o.on("button-click",a=>n(a)),o.on("canceled",()=>r(null)),o.on("closed",a=>a==="Yes"?0:r(null))});window.alert_box=(f,p,t,e)=>{new Ui(f,p,t,e).showModal()};window.progress_box=(f,p,t,e)=>new Yi(f,p,t,e);function Ss(f){return new Promise((p,t)=>{f=Object.assign({prefixEnabled:!0,postfixEnabled:!0,replaceEnabled:!0,prefix:"",postfix:"",replace:"",disable:!0,showDisable:!0},f||{});let e=new ye({title:'<i class="bi bi-clipboard-plus"></i> Paste special...',width:350,height:358,keepCentered:!0,center:!0,resizable:!1,moveable:!1,maximizable:!1,buttons:3});e.body.innerHTML=ks,e.body.style.padding="10px",e.body.style.overflow="hidden",e.body.querySelector("#pasteSpecial-prefix").disabled=!f.prefixEnabled,e.body.querySelector("#pasteSpecial-postfix").disabled=!f.postfixEnabled,e.body.querySelector("#pasteSpecial-prefix").value=f.prefix,e.body.querySelector("#pasteSpecial-postfix").value=f.postfix,e.body.querySelector("#pasteSpecial-prefix-enable").checked=f.prefixEnabled,e.body.querySelector("#pasteSpecial-postfix-enable").checked=f.postfixEnabled,e.body.querySelector("#pasteSpecial-replace").value=f.replace,e.body.querySelector("#pasteSpecial-replace").disabled=!f.replaceEnabled,e.body.querySelector("#pasteSpecial-replace-enable").checked=f.replaceEnabled;let s=e.body.querySelectorAll('input[type="checkbox"]');for(let r=0,o=s.length;r<o;r++)s[r].addEventListener("click",a=>{document.getElementById(a.target.id.slice(0,-7)).disabled=!a.target.checked});let n=r=>{if(r.which===13){var o;document.activeElement.id==="pasteSpecial-replace"?document.getElementById("pasteSpecial-prefix").disabled?document.getElementById("pasteSpecial-postfix").disabled||(o=document.getElementById("pasteSpecial-postfix")):o=document.getElementById("pasteSpecial-prefix"):document.activeElement.id==="pasteSpecial-prefix"&&!document.getElementById("pasteSpecial-postfix").disabled&&(o=document.getElementById("pasteSpecial-postfix")),o?o.focus():e.footer.querySelector(`#${e.id}-ok`).click(),r.preventDefault()}};document.addEventListener("keydown",n),f.showDisable&&e.footer.insertAdjacentHTML("afterbegin",'<div class="form-check float-start" style="margin-top: 3px;"><input type="checkbox" class="form-check-input" id="pasteSpecial-disable"><label class="form-check-label" for="pasteSpecial-disable">Disable</label></div>'),e.footer.insertAdjacentHTML("afterbegin",'<button id="btn-pasteSpecial-reset" class="btn-sm float-start btn btn-outline-secondary" type="button" title="Show menu" style="margin-right: 4px;">Reset</button>'),f.showDisable&&(e.footer.querySelector("#pasteSpecial-disable").checked=f.disable),e.footer.querySelector("#btn-pasteSpecial-reset").addEventListener("click",r=>{document.getElementById("pasteSpecial-replace").disabled=!1,document.getElementById("pasteSpecial-replace-enable").checked=!0,document.getElementById("pasteSpecial-replace").value="",document.getElementById("pasteSpecial-prefix").disabled=!1,document.getElementById("pasteSpecial-postfix").disabled=!1,document.getElementById("pasteSpecial-prefix").value="",document.getElementById("pasteSpecial-postfix").value="",document.getElementById("pasteSpecial-prefix-enable").checked=!0,document.getElementById("pasteSpecial-postfix-enable").checked=!0}),e.showModal(),e.body.querySelector("#pasteSpecial-replace").disabled?e.body.querySelector("#pasteSpecial-prefix").disabled?e.body.querySelector("#pasteSpecial-postfix").disabled?e.footer.querySelector(`#${e.id}-cancel`).focus():e.body.querySelector("#pasteSpecial-postfix").focus():e.body.querySelector("#pasteSpecial-prefix").focus():e.body.querySelector("#pasteSpecial-replace").focus(),e.on("button-click",r=>{f.prefix=document.getElementById("pasteSpecial-prefix").value,f.postfix=document.getElementById("pasteSpecial-postfix").value,f.prefixEnabled=document.getElementById("pasteSpecial-prefix-enable").checked,f.postfixEnabled=document.getElementById("pasteSpecial-postfix-enable").checked,f.replace=document.getElementById("pasteSpecial-replace").value,f.replaceEnabled=document.getElementById("pasteSpecial-replace-enable").checked,f.showDisable&&(f.disable=document.getElementById("pasteSpecial-disable").checked),r.options=f,document.addEventListener("keydown",n),p(r)}),e.on("canceled",()=>{t(null),document.removeEventListener("keydown",n)}),e.on("closed",r=>{document.removeEventListener("keydown",n),r!=="Yes"&&t(null)})})}window.Dialog=ye;function Ye(){let f=bootstrap.Offcanvas.getInstance(document.getElementById("clientMenu"));f&&f.hide()}function hn(){bootstrap.Offcanvas.getOrCreateInstance(document.getElementById("clientMenu")).show()}function Ls(){var f=document.getElementById("clientMenu");f.addEventListener("hidden.bs.offcanvas",function(){client.commandInput.focus()}),document.getElementById("btn-menu").addEventListener("click",hn),client.on("connected",()=>{let r=document.getElementById("menu-connect"),o=document.querySelector("#menu-connect a span"),a=document.querySelector("#menu-connect svg")||document.querySelector("#menu-connect i");r.title="Disconnect",r.classList.add("active"),o.textContent="Disconnect",a.classList.add("fa-plug-circle-xmark"),a.classList.remove("fa-plug")}),client.on("closed",()=>{let r=document.getElementById("menu-connect"),o=document.querySelector("#menu-connect a span"),a=document.querySelector("#menu-connect svg")||document.querySelector("#menu-connect i");r.title="Connect",r.classList.remove("active"),o.textContent="Connect",a.classList.remove("fa-plug-circle-xmark"),a.classList.add("fa-plug")}),client.on("scroll-lock",Es),document.querySelector("#menu-connect a").addEventListener("click",r=>{client.connected?client.close():(client.connect(),Ye())}),document.querySelector("#menu-clear a").addEventListener("click",r=>{client.clear(),Ye()}),document.querySelector("#menu-lock a").addEventListener("click",r=>{client.toggleScrollLock(),Ye()}),document.querySelector("#menu-editor a").addEventListener("click",r=>{Ye(),document.getElementById("btn-adv-editor").click()}),document.querySelector("#menu-about a").addEventListener("click",r=>{Ge("about"),Ye()}),document.querySelector("#menu-settings a").addEventListener("click",r=>{Ge("settings"),Ye()}),document.querySelector("#menu-profiles a").addEventListener("click",r=>{Ge("profiles"),Ye()}),document.querySelector("#menu-help a").addEventListener("click",r=>{Ge("help"),Ye()}),document.querySelector("#menu-fullscreen a").addEventListener("click",r=>{let o=window.document,a=o.documentElement,h=a.requestFullscreen||a.mozRequestFullScreen||a.webkitRequestFullScreen||a.msRequestFullscreen,c=o.exitFullscreen||o.mozCancelFullScreen||o.webkitExitFullscreen||o.msExitFullscreen,g=document.getElementById("menu-fullscreen"),m=document.querySelector("#menu-fullscreen svg")||document.querySelector("#menu-fullscreen i"),b=document.querySelector("#menu-fullscreen a span");!o.fullscreenElement&&!o.mozFullScreenElement&&!o.webkitFullscreenElement&&!o.msFullscreenElement?(g.title="Exit fullscreen",b.textContent="Exit fullscreen",h.call(a),m.classList.add("fa-minimize"),m.classList.remove("fa-maximize")):(g.title="Enter fullscreen",b.textContent="Enter fullscreen",c.call(o),m.classList.add("fa-maximize"),m.classList.remove("fa-minimize")),Ye()}),document.querySelector("#menu-buttons a").addEventListener("click",r=>{Cs();let o=document.querySelector("#menu-buttons");client.getOption("showButtons")?(o.title="Hide buttons",o.classList.add("active"),document.querySelector("#menu-buttons a span").textContent="Hide buttons"):(o.title="Show buttons",o.classList.remove("active"),document.querySelector("#menu-buttons a span").textContent="Show buttons"),Ye()}),document.querySelector("#menu-paste a").addEventListener("click",r=>{ht()?tt().then(ji):(document.querySelector("#menu-paste").classList.toggle("active"),client.commandInput.focus()),Ye()}),Es();let p=client.plugins.length,t,e,s=document.querySelector("#clientMenu ul");for(let r=0;r<p;r++)if(client.plugins[r].menu&&client.plugins[r].menu.length)for(e=client.plugins[r].menu.length,t=0;t<e;t++){let o=client.plugins[r].menu[t],a,h="menu-"+(o.id||o.name||t).trim().toLowerCase().replace(/ /g,"-");if(o.name==="-"?a=`<li id="${h}"${o.hidden?' style=" display:none;visibility:hiddem"':""}><hr class="dropdown-divider"></li>`:typeof o.action=="string"?a=`<li id="${h}"${o.hidden?' style=" display:none;visibility:hiddem"':""} class="nav-item${o.active?" active":""}" title="${o.name||""}"><a class="nav-link" href="#${o.action}">${o.icon||""}<span>${o.name||""}</span></a></li>`:a=`<li id="${h}"${o.hidden?' style=" display:none;visibility:hiddem"':""} class="nav-item${o.active?" active":""}" title="${o.name||""}"><a class="nav-link" href="javascript:void(0)">${o.icon||""}<span>${o.name||""}</span></a></li>`,!(o.exists&&s.querySelector(o.exists))){if("position"in o)if(typeof o.position=="string")s.querySelector(o.position)&&s.querySelector(o.position).insertAdjacentHTML("afterend",a);else if(o.position<0||o.position>=0){let c=o.position;c>=s.children.length?c=s.children.length-1:c<0&&(c=s.children.length+o.position),c<0&&(c=0),c<s.children.length&&s.children[c].insertAdjacentHTML("afterend",a)}else s.insertAdjacentHTML("beforeend",a);else s.insertAdjacentHTML("beforeend",a);o.name!=="-"&&typeof o.action=="function"&&document.querySelector(`#${h} a`)&&document.querySelector(`#${h} a`).addEventListener("click",c=>{let g={client,preventDefault:!1};o.action(g),!g.preventDefault&&Ye()})}}let n=document.querySelector("#menu-buttons");client.getOption("showButtons")?(n.title="Hide buttons",n.classList.add("active"),document.querySelector("#menu-buttons a span").textContent="Hide buttons"):(n.title="Show buttons",n.classList.remove("active"),document.querySelector("#menu-buttons a span").textContent="Show buttons")}function Es(){let f=document.getElementById("menu-lock"),p=document.querySelector("#menu-lock a span"),t=document.querySelector("#menu-lock svg")||document.querySelector("#menu-lock i");client.scrollLock?(f.title="Unlock display",f.classList.add("active"),p.textContent="Unlock display",t.classList.add("fa-unlock"),t.classList.remove("fa-lock")):(f.title="Lock display",f.classList.remove("active"),p.textContent="Lock display",t.classList.remove("fa-unlock"),t.classList.add("fa-lock"))}var Wt=class extends me{constructor(t,e,s){super();this.Kr=!0;this.ia=!1;this.sa={"No color":"Default",BLACK:"Black",RED:"Maroon",GREEN:"Green",ORANGE:"Olive",BLUE:"Navy",MAGENTA:"Purple",WHITE:"Silver",CYAN:"Teal","BOLD BLACK":"Grey","BOLD RED":"Red","BOLD GREEN":"Lime",YELLOW:"Yellow","BOLD YELLOW":"Yellow","BOLD BLUE":"Blue","BOLD MAGENTA":"Fuchsia","BOLD CYAN":"Aqua",BOLD:"White","BOLD WHITE":"White",RGB000:"Black",RGB001:"Navy Blue",RGB002:"Dark Blue",RGB003:"Blue",RGB004:"Blue",RGB005:"Blue",RGB010:"Dark Green",RGB011:"Deep Sky Blue",RGB012:"Deep Sky Blue",RGB013:"Deep Sky Blue",RGB014:"Cobalt/Dodger Blue",RGB015:"Dodger Blue",RGB020:"Green",RGB021:"Spring Green",RGB022:"Turquoise",RGB023:"Deep Sky Blue",RGB024:"Deep Sky Blue",RGB025:"Dodger Blue",RGB030:"Green",RGB031:"Spring Green",RGB032:"Dark Cyan",RGB033:"Light Sea Green",RGB034:"Deep Sky Blue",RGB035:"Deep Sky Blue",RGB040:"Green",RGB041:"Spring Green",RGB042:"Spring Green",RGB043:"Cyan",RGB044:"Dark Turquoise",RGB045:"Turquoise",RGB050:"Green",RGB051:"Spring Green",RGB052:"Spring Green",RGB053:"Medium Spring Green",RGB054:"Cyan",RGB055:"Cyan",RGB100:"Dark Red",RGB101:"Deep Pink",RGB102:"Purple",RGB103:"Purple",RGB104:"Purple",RGB105:"Blue Violet",RGB110:"Orange",RGB111:"Dark Grey",RGB112:"Medium Purple",RGB113:"Slate Blue",RGB114:"Slate Blue",RGB115:"Royal Blue",RGB120:"Chartreuse",RGB121:"Dark Sea Green",RGB122:"Pale Turquoise",RGB123:"Steel Blue",RGB124:"Steel Blue",RGB125:"Cornflower Blue",RGB130:"Chartreuse",RGB131:"Dark Sea Green",RGB132:"Cadet Blue",RGB133:"Cadet Blue",RGB134:"Sky Blue",RGB135:"Steel Blue",RGB140:"Chartreuse",RGB141:"Pale Green",RGB142:"Sea Green",RGB143:"Aquamarine",RGB144:"Medium Turquoise",RGB145:"Steel Blue",RGB150:"Chartreuse",RGB151:"Sea Green",RGB152:"Sea Green",RGB153:"Sea Green",RGB154:"Aquamarine",RGB155:"Dark Slate Gray",RGB200:"Dark Red",RGB201:"Deep Pink",RGB202:"Dark Magenta",RGB203:"Dark Magenta",RGB204:"Dark Violet",RGB205:"Purple",RGB210:"Orange",RGB211:"Light Pink",RGB212:"Plum",RGB213:"Medium Purple",RGB214:"Medium Purple",RGB215:"Slate Blue",RGB220:"Yellow",RGB221:"Wheat",RGB222:"Grey",RGB223:"Light Slate Grey",RGB224:"Medium Purple",RGB225:"Light Slate Blue",RGB230:"Yellow",RGB231:"Dark Olive Green",RGB232:"Dark Sea Green",RGB233:"Light Sky Blue",RGB234:"Light Sky Blue",RGB235:"Sky Blue",RGB240:"Chartreuse",RGB241:"Dark Olive Green",RGB242:"Pale Green",RGB243:"Dark Sea Green",RGB244:"Dark Slate Gray",RGB245:"Sky Blue",RGB250:"Chartreuse",RGB251:"Light Green",RGB252:"Light Green",RGB253:"Pale Green",RGB254:"Aquamarine",RGB255:"Dark Slate Gray",RGB300:"Red",RGB301:"Deep Pink",RGB302:"Medium Violet Red",RGB303:"Magenta",RGB304:"Dark Violet",RGB305:"Purple",RGB310:"Dark Orange",RGB311:"Indian Red",RGB312:"Hot Pink",RGB313:"Medium Orchid",RGB314:"Medium Orchid",RGB315:"Medium Purple",RGB320:"Dark Goldenrod",RGB321:"Light Salmon",RGB322:"Rosy Brown",RGB323:"Grey",RGB324:"Medium Purple",RGB325:"Medium Purple",RGB330:"Gold",RGB331:"Dark Khaki",RGB332:"Navajo White",RGB333:"Grey",RGB334:"Light Steel Blue",RGB335:"Light Steel Blue",RGB340:"Yellow",RGB341:"Dark Olive Green",RGB342:"Dark Sea Green",RGB343:"Dark Sea Green",RGB344:"Light Cyan",RGB345:"Light Sky Blue",RGB350:"Green Yellow",RGB351:"Dark Olive Green",RGB352:"Pale Green",RGB353:"Dark Sea Green",RGB354:"Dark Sea Green",RGB355:"Pale Turquoise",RGB400:"Crimson/Red",RGB401:"Deep Pink",RGB402:"Deep Pink",RGB403:"Magenta",RGB404:"Magenta",RGB405:"Magenta",RGB410:"Dark Orange",RGB411:"Indian Red",RGB412:"Hot Pink",RGB413:"Hot Pink",RGB414:"Orchid",RGB415:"Medium Orchid",RGB420:"Orange",RGB421:"Light Salmon/Bronze",RGB422:"Light Pink",RGB423:"Pink",RGB424:"Plum",RGB425:"Violet",RGB430:"Gold",RGB431:"Light Goldenrod",RGB432:"Tan",RGB433:"Misty Rose",RGB434:"Thistle",RGB435:"Plum",RGB440:"Yellow",RGB441:"Khaki",RGB442:"Light Goldenrod",RGB443:"Light Yellow",RGB444:"Grey",RGB445:"Light Steel Blue",RGB450:"Yellow",RGB451:"Dark Olive Green",RGB452:"Dark Olive Green",RGB453:"Dark Sea Green",RGB454:"Honeydew",RGB455:"Light Cyan",RGB500:"Red",RGB501:"Deep Pink",RGB502:"Deep Pink",RGB503:"Deep Pink",RGB504:"Magenta",RGB505:"Magenta",RGB510:"Orangered",RGB511:"Indian Red",RGB512:"Indian Red",RGB513:"Hot Pink",RGB514:"Hot Pink",RGB515:"Medium Orchid",RGB520:"Dark Orange",RGB521:"Salmon",RGB522:"Light Coral",RGB523:"Pale Violet Red",RGB524:"Orchid",RGB525:"Orchid",RGB530:"Orange",RGB531:"Sandy Brown",RGB532:"Light Salmon",RGB533:"Light Pink",RGB534:"Pink",RGB535:"Plum",RGB540:"Gold",RGB541:"Light Goldenrod",RGB542:"Light Goldenrod",RGB543:"Navajo White",RGB544:"Misty Rose",RGB545:"Thistle",RGB550:"Yellow",RGB551:"Light Goldenrod",RGB552:"Khaki",RGB553:"Wheat",RGB554:"Corn Silk",RGB555:"White",mono00:"Grey 3",mono01:"Grey 7",mono02:"Grey 11",mono03:"Grey 15",mono04:"Grey 19",mono05:"Grey 23",mono06:"Grey 27",mono07:"Grey 30",mono08:"Grey 35",mono09:"Grey 39",mono10:"Grey 32",mono11:"Grey 46",mono12:"Grey 50",mono13:"Grey 54",mono14:"Grey 58",mono15:"Grey 62",mono16:"Grey 66",mono17:"Grey 70",mono18:"Grey 74",mono19:"Grey 78",mono20:"Grey 82",mono21:"Grey 85",mono22:"Grey 89",mono23:"Grey 93"};this.so=[];if(this.options=s||{},!t)throw new Error("AdvEditor must be a selector, element or jquery object");if(typeof t=="string"){if(this.Pe=document.querySelector(t),!this.Pe)throw new Error("Invalid selector for AdvEditor.")}else if(t instanceof $)this.Pe=t[0];else if(t instanceof HTMLElement)this.Pe=t;else throw new Error("AdvEditor must be a selector, element or jquery object");this.simple=!e}get id(){return this.Pe?this.Pe.id:""}get element(){return this.Pe}get simple(){return this.Kr}set simple(t){t!==this.Kr&&(this.Kr=t,this.tinymceExist&&(t?this.remove():this.initialize()))}clear(){this.isSimple?this.Pe.value="":tinymce.get(this.Pe.id).setContent("")}get value(){return this.isSimple?this.Pe.value:this.getFormattedText().replace(/(?:\r)/g,"")}set value(t){this.isSimple?this.Pe.value=t:tinymce.get(this.Pe.id).setContent(t)}set readOnly(t){this.isSimple?this.Pe.disabled=t:t?tinymce.get(this.Pe.id).mode.set("readonly"):tinymce.get(this.Pe.id).mode.set("design")}get readOnly(){return this.isSimple?this.Pe.disabled:tinymce.get(this.Pe.id).mode.isReadOnly()}insert(t){if(this.isSimple)et(this.Pe,t);else{t=Pe(t),t=t.replace(/ /g,"&nbsp;"),t=t.replace(/\t/g,"&nbsp;&nbsp;&nbsp;"),t=t.replace(/(?:\r\n|\r|\n)/g,"<br/>");let e=this.getText();e===`
`?tinymce.get(this.Pe.id).undoManager.transact(()=>{tinymce.get(this.Pe.id).setContent(t)}):(e.endsWith(`
`)||(t="<br>"+t),tinymce.get(this.Pe.id).undoManager.transact(()=>{tinymce.get(this.Pe.id).dom.add(tinymce.get(this.Pe.id).getBody(),"span",{},t)}))}}get tinymceExist(){return typeof tinymce<"u"}get isSimple(){return this.Kr||!this.tinymceExist}vh(){let t=cs(),e,s,n,r,o,a,h=[],c;this.ke=[],this.ut={};let g=client.getOption("colors")||[],m=["BLACK","RED","GREEN","ORANGE","BLUE","MAGENTA","CYAN","WHITE"];for(e=0,c=m.length;e<c;e++)s=new de(g[e]||t[e]).toHex().substr(1).toUpperCase(),this.ut[s]=m[e],this.ke.push(s,m[e]);for(s=new de(g[8]||t[8]).toHex().substr(1).toUpperCase(),this.ut[s]="mono11",this.ke.push(s,"BOLD BLACK"),h.push(s),m[3]="YELLOW",e=1,c=m.length-1;e<c;e++)s=new de(g[e+8]||t[e+8]).toHex().substr(1).toUpperCase(),this.ut[s]="BOLD%^%^"+m[e],this.ke.push(s,"BOLD "+m[e]),h.push(s),e===3&&(s=new de(g[11]||t[11]).toHex().substr(1).toUpperCase(),this.ut[s]="YELLOW",this.ke.push(s,"YELLOW"),h.push(s));for(s=new de(g[15]||t[15]).toHex().substr(1).toUpperCase(),this.ut[s]="BOLD%^%^WHITE",this.ke.push(s,"BOLD WHITE"),n=0;n<6;n++)for(r=0;r<6;r++)for(o=0;o<6;o++)a=`RGB${n}${r}${o}`,s="",e=0,e=n*40+55,e<16&&(s+="0"),s+=e.toString(16),e=0,e=r*40+55,e<16&&(s+="0"),s+=e.toString(16),e=0,e=o*40+55,e<16&&(s+="0"),s+=e.toString(16),s=s.toUpperCase(),this.ut[s]||(this.ut[s]=a),this.so.push({color:a,hex:"#"+s,rgb:{r:n*40+55,g:r*40+55,b:o*40+55}});for(n=232;n<=255;n++)r=(n-232)*10+8,r<16?r="0"+r.toString(16).toUpperCase():r=r.toString(16).toUpperCase(),r=r+r+r,n<242?this.ut[r]||(this.ut[r]="mono0"+(n-232)):this.ut[r]||(this.ut[r]="mono"+(n-232));for(o=0,c=h.length;o<c;o++)this.ut["B"+h[o]]=this.ut[this.mr("#"+h[o]).substr(1)].toUpperCase();this.ut.BFFFFFF="RGB555",tinymce.get(this.Pe.id).options.set("color_map",this.ke)}xh(){let t=this;tinymce.PluginManager.add("pinkfishtextcolor",function(e,s){let n="#000000",r=["000000","BLACK","800000","RED","008000","GREEN","808000","ORANGE","0000EE","BLUE","800080","MAGENTA","008080","CYAN","BBBBBB","WHITE","808080","BOLD BLACK","FF0000","BOLD RED","00FF00","BOLD GREEN","FFFF00","YELLOW","5C5CFF","BOLD BLUE","FF00FF","BOLD MAGENTA","00FFFF","BOLD CYAN","FFFFFF","BOLD WHITE"],o,a=C=>{let I=C;return{get:()=>I,set:M=>{I=M}}},h=a(n),c=a(n),g=(C,I)=>{let D;return C.dom.getParents(C.selection.getStart(),S=>{let M;(M=S.style[I==="forecolor"?"color":"background-color"])&&(D=D||M)}),D},m=(C,I,D)=>{C.undoManager.transact(()=>{C.focus(),C.formatter.apply(I,{value:D}),C.nodeChanged()})},b=(C,I)=>{C.undoManager.transact(()=>{C.focus(),C.formatter.remove(I,{value:null},null,!0),C.nodeChanged()})},u=C=>{C.addCommand("mceApplyPinkfishcolor",(I,D)=>{m(C,I,D)}),C.addCommand("mceRemovePinkfishcolor",I=>{b(C,I)}),C.addCommand("mceSetPinkfishcolor",(I,D)=>{o&&(B(o,I==="forecolor"?"pinkfishforecolor":I,D),(I==="forecolor"?h:c).set(D))})},E=C=>{let I="choiceitem",D={type:I,text:"Remove color",icon:"color-swatch-remove-color",value:"remove"};return C?[D,{type:I,text:"Custom color",icon:"color-picker",value:"custom"}]:[D]},w=(C,I,D,S)=>{D==="custom"?t.na(I,""):D==="remove"?(S(""),C.execCommand("mceRemovePinkfishcolor",I)):(S(D),C.execCommand("mceApplyPinkfishcolor",I,D))},L=C=>{let I=[];for(let D=0;D<C.length;D+=2)I.push({text:C[D+1],value:"#"+C[D],type:"choiceitem"});return I},k=(C,I)=>L(r).concat(E(I)),R=(C,I)=>D=>{D(k(C,I))},B=(C,I,D)=>{let S=I==="pinkfishforecolor"?"tox-icon-text-color__color":"tox-icon-highlight-bg-color__color";C.setIconFill(S,D)},v=(C,I,D,S,M)=>{C.ui.registry.addSplitButton(I,{tooltip:S,presets:"color",icon:I==="pinkfishforecolor"?"text-color":"highlight-bg-color",select:q=>new de(g(C,D)||"").toHex().toLowerCase()===q.toLowerCase(),columns:5,fetch:R(r,!0),onAction:q=>{o=q,w(C,D,M.get(),()=>{})},onItemAction:(q,Q)=>{o=q,w(C,D,Q,W=>{M.set(W),C.fire("TextColorChange",{name:I,color:W})})},onSetup:q=>{B(q,I,M.get());let Q=W=>{W.name===I&&B(q,W.name,W.color)};return C.on("TextColorChange",Q),()=>{C.off("TextColorChange",Q)}}})},O=(C,I,D,S)=>{C.ui.registry.addNestedMenuItem(I,{text:S,icon:I==="pinkfishforecolor"?"text-color":"highlight-bg-color",getSubmenuItems:()=>[{type:"fancymenuitem",fancytype:"colorswatch",onAction:M=>{w(C,D,M.value,()=>{})}}]})};u(e),v(e,"pinkfishforecolor","forecolor","Text color",h),v(e,"pinkfishbackcolor","hilitecolor","Background color",c),O(e,"pinkfishforecolor","forecolor","Text color"),O(e,"pinkfishbackcolor","hilitecolor","Background color")}),tinymce.PluginManager.add("pinkfish",function(e){e.addCommand("mceApplyFormat",(r,o)=>{e.undoManager.transact(()=>{e.focus(),t.no($(".reverse",$(e.getDoc()).contents())),o?e.formatter.apply(r,{value:o}):e.formatter.apply(r),t.Jr($(".reverse",$(e.getDoc()).contents())),e.nodeChanged()})}),e.addCommand("mceRemoveFormat",r=>{e.undoManager.transact(()=>{e.focus(),t.no($(".reverse",$(e.getDoc()).contents())),e.formatter.remove(r,{value:null},null,!0),t.Jr($(".reverse",$(e.getDoc()).contents())),e.nodeChanged()})});function s(r,o){e.on("init",()=>{e.formatter.formatChanged(o,function(a){r.setActive(a)})})}function n(r){(!r||typeof r!="string")&&(r=this.settings.format),tinymce.get(t.id).undoManager.transact(()=>{$("#tinymce",tinymce.get(t.id).getDoc()).removeClass("animate"),this.clearReverse($(".reverse",$(e.getDoc()).contents())),e.execCommand("mceToggleFormat",!1,r),this.addReverse($(".reverse",$(e.getDoc()).contents())),$("#tinymce",tinymce.get(t.id).getDoc()).addClass("animate")})}e.ui.registry.addIcon("overline",'<i class="mce-i-overline"></i>'),e.ui.registry.addIcon("dblunderline",'<i class="mce-i-dblunderline"></i>'),e.ui.registry.addIcon("flash",'<i class="mce-i-flash"></i>'),e.ui.registry.addIcon("reverse",'<i class="mce-i-reverse"></i>'),ht()&&e.ui.registry.addIcon("pasteformatted",'<i class="mce-i-pasteformatted"></i>'),e.ui.registry.addIcon("copyformatted",'<i class="mce-i-copyformatted"></i>'),e.ui.registry.addSplitButton("send",{icon:"send",tooltip:t.options.sendTitle||"Send to mud",onAction:()=>{let r={preventDefault:!1,contents:t.getFormattedText().replace(/(?:\r)/g,"")};t.emit("send-action",r),!r.preventDefault&&(client.sendCommand(r.contents),client.getOption("editorClearOnSend")&&tinymce.get(t.id).setContent(""),client.getOption("editorCloseOnSend")&&t.emit("close"))},onItemAction:(r,o)=>{let a={preventDefault:!1,value:o};if(t.emit("send-item-action",a),!a.preventDefault){switch(o){case"formatted":client.sendCommand(t.getFormattedText().replace(/(?:\r)/g,""));break;case"text":client.sendCommand(t.getText().replace(/(?:\r)/g,""));break;case"formattednoecho":client.sendBackground(t.getFormattedText().replace(/(?:\r)/g,""),!0);break;case"textnoecho":client.sendBackground(t.getText().replace(/(?:\r)/g,""),!0);break;case"formattedverbatim":client.send(t.getFormattedText().replace(/(?:\r)/g,""));break;case"textverbatim":client.send(t.getText().replace(/(?:\r)/g,""));break;case"rawformatted":client.sendRaw(t.getFormattedText().replace(/(?:\r)/g,""));break;case"rawtext":client.sendRaw(t.getText().replace(/(?:\r)/g,""));break}client.getOption("editorClearOnSend")&&tinymce.get(t.id).setContent(""),client.getOption("editorCloseOnSend")&&t.emit("close")}},fetch:r=>{r(t.options.sendFetch||[{text:"Formatted as commands",value:"formatted",type:"choiceitem"},{text:"Text as commands",value:"text",type:"choiceitem"},{text:"Formatted as commands (No echo)",value:"formattednoecho",type:"choiceitem"},{text:"Text as commands (No echo)",value:"textnoecho",type:"choiceitem"},{text:"Formatted verbatim (No echo)",value:"formattedverbatim",type:"choiceitem"},{text:"Text verbatim (No echo)",value:"textverbatim",type:"choiceitem"},{text:"Raw formatted (No echo)",value:"rawformatted",type:"choiceitem"},{text:"Raw text (No echo)",value:"rawtext",type:"choiceitem"}])}}),e.ui.registry.addButton("append",{icon:"browse",tooltip:"Append file...",onAction:()=>t.kh()}),e.ui.registry.addButton("clear",{icon:"remove",tooltip:"Clear",onAction:()=>t.clear()}),ht()&&(e.ui.registry.addButton("pastecustom",{icon:"paste",tooltip:"Paste",onAction:r=>{ps("text/html","text/plain").then(o=>{t.insertFormatted(o||"")}).catch(o=>{client.enableDebug&&client.debug(o),o.message&&o.message==="Permission not granted!"?alert("Paste permission not granted."):alert("Paste not supported.")})}}),e.ui.registry.addButton("pasteformatted",{icon:"pasteformatted",tooltip:"Paste formatted",onAction:r=>{tt().then(o=>{t.insertFormatted(o||"")}).catch(o=>{client.enableDebug&&client.debug(o),o.message&&o.message==="Permission not granted!"?alert("Paste permission not granted."):alert("Paste not supported.")})}}),e.ui.registry.addButton("pasteastext",{icon:"paste-text",tooltip:"Paste as text",onAction:r=>{tt().then(o=>{tinymce.get(t.id).execCommand("mceInsertContent",!1,(o||"").replace(/(\r\n|\r|\n)/g,"<br/>").replaceAll("  ","&nbsp;&nbsp;"))}).catch(o=>{client.enableDebug&&client.debug(o),o.message&&o.message==="Permission not granted!"?alert("Paste permission not granted."):alert("Paste not supported.")})}})),e.ui.registry.addButton("copyformatted",{icon:"copyformatted",tooltip:"Copy formatted",onAction:r=>Xe(t.getFormattedSelection().replace(/(?:\r)/g,""))}),e.ui.registry.addToggleButton("overline",{icon:"overline",tooltip:"Overline",format:"overline",onAction:r=>n("overline"),onSetup:r=>s(r,"overline")}),e.ui.registry.addToggleButton("dblunderline",{icon:"dblunderline",tooltip:"Double Underline",format:"dblunderline",onAction:r=>n("dblunderline"),onSetup:r=>s(r,"dblunderline")}),e.ui.registry.addToggleButton("flash",{tooltip:"Flash",format:"flash",icon:"flash",onAction:r=>n("flash"),onSetup:r=>s(r,"flash")}),e.ui.registry.addToggleButton("reverse",{icon:"reverse",tooltip:"Reverse",format:"reverse",onAction:r=>n("reverse"),onSetup:r=>s(r,"reverse")}),e.ui.registry.addMenuItem("style",{text:"Style",menu:[{image:"overline",text:"Overline",format:"overline",onclick:n,onpostrender:s},{image:"dblunderline",text:"Double Underline",format:"dblunderline",onclick:n,onpostrender:s},{text:"Flash",format:"flash",image:"flash",onclick:n,onpostrender:s},{image:"reverse",text:"Reverse",format:"reverse",onclick:n,onpostrender:s}]}),e.ui.registry.addMenuItem("overline",{image:"overline",text:"Overline",format:"overline",onclick:n,onpostrender:s}),e.ui.registry.addMenuItem("dblunderline",{image:"dblunderline",text:"Double Underline",format:"dblunderline",onclick:n,onpostrender:s}),e.ui.registry.addMenuItem("flash",{text:"Flash",format:"flash",image:"flash",onclick:n,onpostrender:s}),e.ui.registry.addMenuItem("reverse",{image:"reverse",text:"Reverse",format:"reverse",onclick:n,onpostrender:s}),e.on("Change",()=>{t.Jr($(".reverse",$(e.getDoc()).contents()))}),e.addShortcut("ctrl+s","Strikethrough",()=>{n("strikethrough")}),e.addShortcut("ctrl+o","Overline",()=>{n("overline")}),e.addShortcut("ctrl+d","Double Underline",()=>{n("dblunderline")}),e.addShortcut("ctrl+f","Flash",()=>{n("flash")}),e.addShortcut("ctrl+r","Reverse",()=>{n("reverse")})})}no(t,e){t.each(function(){if(!$(this).data("reverse")||e&&$(this).hasClass("reverse"))return;let s,n;e?(s=$(this).css("color"),n=$(this).css("background-color")):(n=$(this).parent().css("color"),s=$(this).parent().css("background-color")),s==="black"&&(s=""),n==="rgba(0, 0, 0, 0)"&&(n="black"),$(this).css("color",n),$(this).css("background-color",s),$(this).children().length&&this.clearReverse($(this).children(),!0)})}Jr(t,e){t.each(function(){if(e&&$(this).hasClass("reverse"))return;let s,n;e?(s=$(this).css("color"),n=$(this).css("background-color")):(s=$(this).parent().css("color"),n=$(this).parent().css("background-color")),s==="rgba(0, 0, 0, 0)"&&(s="black"),n==="rgba(0, 0, 0, 0)"&&(n="black"),$(this).children().length&&(this.clearReverse($(this).children(),!0),this.addReverse($(this).children(),!0)),$(this).css("color",n),$(this).css("background-color",s),$(this).data("reverse",!0)})}gr(t,e){let s='<td class="mce-grid-cell'+(t==="transparent"?" mce-colorbtn-trans":"")+'">';return s+='<div id="'+e+'"',s+=' data-mce-color="'+t+'"',s+=' role="option"',s+=' tabIndex="-1"',s+=' style="background-color: '+(t==="transparent"?t:"#"+t)+'"',this.sa[e]?s+=' title="'+e+", "+this.sa[e]+'">':s+=' title="'+e+'">',t==="transparent"&&(s+="&#215;"),s+="</div>",s+="</td>",s}na(t,e){if(!this.Gi){this.Gi=new ye({noFooter:!0,title:'<i class="fas fa-palette"></i> Pick color',center:!0,resizable:!1,moveable:!1,maximizable:!1,width:380,height:340}),this.Gi.body.style.alignItems="center",this.Gi.body.style.display="flex";let s,n,r,o,a,h,c='<table style="border-spacing: 0;margin : auto !important;" class="mce-grid mce-grid-border mce-colorbutton-grid" role="list" cellspacing="0"><tbody><tr>';for(s=0,n=this.ke.length;s<n;s+=2)this.ke[s+1]!=="BOLD YELLOW"&&(c+=this.gr(this.ke[s],this.ke[s+1]),(s/2%6===5||this.ke[s+1]==="YELLOW")&&(c+='<td class="mce-grid-cell"></td>'));c+='<td class="mce-grid-cell"></td>',c+=this.gr("transparent","No color"),c+="</tr><tr><td></td></tr>";let g="";for(r=0;r<6;r++){for(o<3?c+="<tr>":g+="<tr>",o=0;o<6;o++){for(a=0;a<6;a++)h=`RGB${r}${o}${a}`,e="",s=0,s=r*40+55,s<16&&(e+="0"),e+=s.toString(16),s=0,s=o*40+55,s<16&&(e+="0"),e+=s.toString(16),s=0,s=a*40+55,s<16&&(e+="0"),e+=s.toString(16),e=e.toUpperCase(),o<3?c+=this.gr(e,h):g+=this.gr(e,h);o===2?c+="</tr>":o<3?c+='<td class="mce-grid-cell"></td>':o<5&&(g+='<td class="mce-grid-cell"></td>')}o<3?c+="</tr>":g+="</tr>"}for(c+=g,c+="<tr><td></td></tr><tr>",r=232;r<=255;r++)o=(r-232)*10+8,o<16?o="0"+o.toString(16).toUpperCase():o=o.toString(16).toUpperCase(),o=o+o+o,c+=this.gr(o,e),(r===237||r===249)&&(c+='<td class="mce-grid-cell"></td>'),r===243&&(c+="</tr><tr>");c+="</tr></tbody></table>",c+="<style>.mce-colorbtn-trans div {line-height: 14px;overflow: hidden;}.mce-grid td.mce-grid-cell div{border:1px solid #c5c5c5;width:15px;height:15px;margin:0;cursor:pointer}.mce-grid td.mce-grid-cell div:focus{border-color:#91bbe9}.mce-grid td.mce-grid-cell div[disabled]{cursor:not-allowed}.mce-grid{border-spacing:2px;border-collapse:separate}.mce-grid a{display:block;border:1px solid transparent}.mce-grid a:hover,.mce-grid a:focus{border-color:#91bbe9}.mce-grid-border{margin:0 4px 0 4px}.mce-grid-border a{border-color:#c5c5c5;width:13px;height:13px}.mce-grid-border a:hover,.mce-grid-border a.mce-active{border-color:#91bbe9;background:#bdd6f2}</style>",this.Gi.body.innerHTML=c;let m=this.Gi.body.querySelectorAll("div");for(s=0,n=m.length;s<n;s++)m[s].addEventListener("click",b=>{e=b.currentTarget.dataset.mceColor,e==="transparent"?tinymce.get(this.Pe.id).execCommand("mceRemoveFormat",this.Gi.dialog.dataset.type):tinymce.get(this.Pe.id).execCommand("mceApplyFormat",this.Gi.dialog.dataset.type,"#"+e),tinymce.get(this.Pe.id).execCommand("mceSetTextcolor",this.Gi.dialog.dataset.type,"#"+e),this.Gi.close()})}this.Gi.dialog.dataset.type=t,this.Gi.showModal()}kh(){Se("Append file(s)",!0).then(t=>{for(let e=0,s=t.length;e<s;e++)Ee(t[e]).then(n=>{this.insert(n)}).catch(n=>client.error(n))}).catch(()=>{})}insertFormatted(t){this.isSimple?et(this.Pe,t):tinymce.get(this.Pe.id).execCommand("insertHTML",!1,Ai(t).replace(/(\r\n|\r|\n)/g,"<br/>"))}setFormatted(t){this.isSimple?this.Pe.value=t:tinymce.get(this.Pe.id).getBody().innerHTML=Ai(t).replace(/(\r\n|\r|\n)/g,"<br/>")}ro(t){let e,s,n,r,o=[],a;for(let h=0,c=t.length;h<c;h++)if(s=$(t[h]),e=s.prop("tagName"),e==="EM"||e==="I"?e="ITALIC":(e==="STRONG"||e==="B")&&(e="BOLD"),!e)o.push('"'+s.text()+'"');else if(e==="SPAN"){if(a=[],t[h].className!="")for(e=t[h].className.toUpperCase().split(/\s+/g),r=e.length,n=0;n<r;n++)e[n]==="NOFLASH"?a.push("FLASH"):e[n].length>0&&a.push(e[n]);if(s.css("text-decoration")==="line-through"&&a.push("STRIKEOUT"),s.css("text-decoration")==="underline"&&a.push("UNDERLINE"),s.data("mce-style"))for(e=s.data("mce-style").toUpperCase().split(";"),r=e.length,n=0;n<r;n++)e[n].endsWith("INHERIT")||e[n].endsWith("BLACK")||(e[n]=e[n].trim(),e[n]=e[n].replace("BACKGROUND:","BACKGROUND-COLOR:"),e[n].length>0&&a.push(e[n]));else if(s.css("color")||s.css("background-color")||s.css("background"))for(e=[],s.css("color")&&e.push("COLOR: "+new de(s.css("color")).toHex().toUpperCase()),s.css("background-color")&&e.push("BACKGROUND-COLOR: "+new de(s.css("background-color")).toHex().toUpperCase()),s.css("background")&&e.push("BACKGROUND-COLOR: "+new de(s.css("background")).toHex().toUpperCase()),r=e.length,n=0;n<r;n++)e[n].length>0&&a.push(e[n].trim());for(r=a.length,n=0;n<r;n++)a[n].length&&o.push(a[n].trim());for(o=o.concat(this.ro(s.contents())),n=r-1;n>=0;n--)a[n].length&&o.push("/"+a[n].trim())}else e=="BR"&&s.data("mce-bogus")?o.push("RESET"):(o.push(e),o=o.concat(this.ro(s.contents())),o.push("/"+e));return o}getFormattedSelection(){let t=tinymce.get(this.Pe.id).dom.getParents(tinymce.get(this.Pe.id).selection.getNode()),e=0,s=t.length,n="<html>",r="</html>";for(;e<s;e++){let o=t[e].tagName;if(o==="EM"||o==="I"||o==="STRONG"||o==="B")n+="<"+o+">",r="</"+o+">"+r;else if(o==="SPAN"){n+="<"+o,t[e].className!=""&&(n+=' class="'+t[e].className+'"');let a="";t[e].style.textDecoration!=""&&(a+="text-decoration:"+t[e].style.textDecoration+";"),t[e].style.color!=""&&(a+="color:"+t[e].style.color+";"),t[e].style.background!=""&&(a+="background:"+t[e].style.background+";"),t[e].style.backgroundColor!=""&&(a+="background-color:"+t[e].style.backgroundColor+";"),a.length>0&&(n+=' style="'+a+'"'),t[e].dataset&&t[e].dataset.mceStyle&&(n+=' data-mce-style="'+t[e].dataset.mceStyle+'"'),n+=" >",r="</"+o+">"+r}else if(o==="BODY"){n+="<"+o+">",r="</"+o+">"+r;break}}return this.ra($(n+tinymce.get(this.Pe.id).selection.getContent({format:"raw"}).replace(/<\/div><div>/g,"<br>")+r))}getFormattedText(){return this.isSimple?this.Pe.value:this.ra($("<html>"+this.getRaw()+"</html>"))}getText(){return this.isSimple?this.Pe.value:tinymce.get(this.Pe.id).getContent({format:"text"})}getHTML(){return this.isSimple?this.Pe.value:tinymce.get(this.Pe.id).getContent({format:"html"})}getRaw(){return this.isSimple?this.Pe.value:tinymce.get(this.Pe.id).getContent({format:"raw"})}ra(t){let e=this.ro(t),s=[],n=[],r,o,a,h;for(o=e.length-1;o>=0&&(!e[o].startsWith('"')&&e[o]!="BR"&&e[o]!="RESET");o--)e.pop();for(e[0]==="DIV"&&e.shift(),o=0,a=e.length;o<a;o++)switch(e[o]){case"BOLD":case"ITALIC":case"UNDERLINE":case"STRIKEOUT":case"DBLUNDERLINE":case"OVERLINE":case"FLASH":case"REVERSE":n.push("%^"+e[o]+"%^"),s.push("%^"+e[o]+"%^");break;case"/DBLUNDERLINE":case"/OVERLINE":case"/FLASH":case"/REVERSE":case"/UNDERLINE":case"/BOLD":case"/ITALIC":case"/STRIKEOUT":n.pop(),this.br(s),s.push("%^RESET%^"),n.length>0&&s.push(n.join(""));break;case"SPAN":case"/SPAN":case"/BR":case"/DIV":break;case"DIV":case"BR":n.length>0&&s.length>0&&!s[s.length-1].endsWith("%^RESET%^")&&(this.br(s),s.push("%^RESET%^")),s.push(`
`),n.length>0&&s.push(n.join(""));break;case"RESET":n.length>0&&s.length>0&&!s[s.length-1].endsWith("%^RESET%^")&&(this.br(s),s.push("%^RESET%^")),n.length>0&&s.push(n.join(""));break;default:e[o].startsWith("COLOR: #")?(r=e[o].substr(8),this.ut[r]||(h=new de(r),r=this.mr(h.toHex()).substr(1)),r=this.ut[r],(r==="BOLD BLACK"||r==="BOLD%^%^BLACK")&&(r="mono11"),n.push("%^"+r+"%^"),s.push("%^"+r+"%^")):e[o].startsWith("COLOR: ")?(r=new de(e[o].substr(7)).toHex().substr(1),this.ut[r]||(r=this.mr("#"+r).substr(1)),r=this.ut[r],(r==="BOLD BLACK"||r==="BOLD%^%^BLACK")&&(r="mono11"),n.push("%^"+r+"%^"),s.push("%^"+r+"%^")):e[o].startsWith("/COLOR: ")?(n.pop(),this.br(s),s.push("%^RESET%^"),n.length>0&&s.push(n.join(""))):e[o].startsWith("BACKGROUND-COLOR: #")?(r=e[o].substr(19),this.ut[r]||(h=new de(r),r=this.mr(h.toHex()).substr(1)),this.ut["B"+r]?r=this.ut["B"+r]:r=this.ut[r],r="%^B_"+r+"%^",n.push(r),s.push(r)):e[o].startsWith("BACKGROUND-COLOR: ")?(r=new de(e[o].substr(18)).toHex().substr(1),this.ut[r]||(r=this.mr("#"+r).substr(1)),this.ut["B"+r]?r=this.ut["B"+r]:r=this.ut[r],r="%^B_"+r+"%^",n.push(r),s.push(r)):e[o].startsWith("/BACKGROUND-COLOR: ")?(n.pop(),this.br(s),s.push("%^RESET%^"),n.length>0&&s.push(n.join(""))):e[o].startsWith('"')&&s.push(e[o].substring(1,e[o].length-1));break}return s.join("")}br(t){let e=t.length-1;for(;e>=0;e--)if(t[e].startsWith("%^"))t.pop();else return t;return t}mr(t){let e=this;return function(r){if(!r)throw new Error("The hex you provided is not formatted correctly. Please try in a format such as '#FFF' or '#DDFFDD'.");let o=Number.MAX_SAFE_INTEGER,a=null;for(let h=0;h<e.so.length;h++){let c=e.so[h],g=Math.sqrt(Math.pow(r.r-c.rgb.r,2)+Math.pow(r.g-c.rgb.g,2)+Math.pow(r.b-c.rgb.b,2));g<o&&(o=g,a=c.hex)}return a}(function(r){let o=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;r=r.replace(o,function(g,m,b,u){return[m,m,b,b,u,u].join()});let h=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?/i.exec(r);return h?{r:parseInt(h[1],16),g:parseInt(h[2],16),b:parseInt(h[3],16)}:null}(t))}remove(){tinymce.remove(`#${this.Pe.id}`)}initialize(){this.isSimple||(this.xh(),tinymce.init({license_key:"gpl",custom_colors:!1,selector:`textarea#${this.Pe.id}`,height:500,menubar:!1,browser_spellcheck:!0,resize:!0,statusbar:!1,nowrap:!0,force_br_newlines:!0,forced_root_block:"div",plugins:"pinkfish insertdatetime pinkfishtextcolor nonbreaking",color_picker_callback:(t,e,s)=>{this.na(s,e||"")},color_picker_caption:"More&hellip;",textcolor_rows:"3",textcolor_cols:"8",toolbar:`send | append | undo redo ${ht()?"| pastecustom pasteastext pasteformatted ":""}| pinkfishforecolor pinkfishbackcolor | italic underline strikethrough overline dblunderline flash reverse | clear | copy copyformatted | insertdatetime`,toolbar_mode:"sliding",content_css:"css/tinymce.content.min.css",formats:{bold:{inline:"strong",exact:!0,links:!0,remove_similar:!0},italic:{inline:"em",exact:!0,links:!0,remove_similar:!0},overline:{inline:"span",classes:"overline",links:!0,remove_similar:!0},dblunderline:{inline:"span",classes:"dblunderline",links:!0,remove_similar:!0},flash:{inline:"span",classes:"flash",links:!0,remove_similar:!0},reverse:{inline:"span",classes:"reverse",links:!0,remove_similar:!0},underline:{inline:"span",classes:"underline",links:!0,remove_similar:!0},strikethrough:{inline:"span",classes:"strikeout",links:!0,remove_similar:!0}},init_instance_callback:t=>{t.shortcuts.add("ctrl+shift+c","Copy formatted",()=>Xe(this.getFormattedSelection().replace(/(?:\r)/g,""))),ht()&&(t.shortcuts.add("ctrl+shift+p","Paste formatted",()=>{tt().then(e=>{this.insertFormatted(e||"")}).catch(e=>{client.enableDebug&&client.debug(e),e.message&&e.message==="Permission not granted!"?alert("Paste permission not granted."):alert("Paste not supported.")})}),t.shortcuts.add("ctrl+alt+p","Paste as text",()=>{tt().then(e=>{tinymce.get(this.Pe.id).execCommand("mceInsertContent",!1,(e||"").replace(/(\r\n|\r|\n)/g,"<br/>").replaceAll("  ","&nbsp;&nbsp;"))}).catch(e=>{client.enableDebug&&client.debug(e),e.message&&e.message==="Permission not granted!"?alert("Paste permission not granted."):alert("Paste not supported.")})})),t.on("PastePreProcess",e=>{client.getOption("enableDebug")&&client.debug("Advanced Before Editor PastePreProcess: "+e.content),this.no($(".reverse",$(t.getDoc()).contents())),e.content=e.content.replace(/<\/p>/g,"<br>"),e.content=e.content.replace(/<\/h[1-6]>/g,"<br>"),e.content=e.content.replace(/<\/li>/g,"<br>"),e.content=e.content.replace(/ background: #000000;/g,""),e.content=e.content.replace(/background: #000000;/g,""),e.content=e.content.replace(/ background-color: #000000;/g,""),e.content=e.content.replace(/background-color: #000000;/g,""),e.content=e.content.replace(/ color: #BBBBBB;/g,""),e.content=e.content.replace(/color: #BBBBBB;/g,"");let s=/<pre(.*?)>((.|\s)*)<\/pre>/mgi,n;for(;(n=s.exec(e.content))!==null;)n.index===s.lastIndex&&s.lastIndex++,e.content=e.content.substring(0,n.index)+e.content.substring(n.index,s.lastIndex).replace(/(\r\n|\r|\n)/g,"<br/>").replaceAll("  ","&nbsp;&nbsp;")+e.content.substring(s.lastIndex);client.getOption("enableDebug")&&client.debug("Advanced After Editor PastePreProcess: "+e.content)}),t.on("PastePreProcess",()=>{this.Jr($(".reverse",$(t.getDoc()).contents()))}),$(".mce-content-body",tinymce.get(this.Pe.id).getDoc()).css("font-size",client.getOption("cmdfontSize")),$(".mce-content-body",tinymce.get(this.Pe.id).getDoc()).css("font-family",client.getOption("cmdfont")+", monospace"),tinymce.get(this.Pe.id).formatter?tinymce.get(this.Pe.id).formatter.register("flash",{inline:"span",classes:client.getOption("flashing")?"flash":"noflash",links:!0,remove_similar:!0}):tinymce.get(this.Pe.id).settings.formats.flash={inline:"span",classes:client.getOption("flashing")?"flash":"noflash",links:!0,remove_similar:!0},this.vh(),this.setFormatted(this.Pe.value),t.on("click",e=>{this.emit("click",e)}),this.emit("editor-init"),this.ia=!0},paste_data_images:!1,paste_webkit_styles:"color background background-color text-decoration",valid_elements:"strong/b,em/i,u,span[style|class],strike/s,br",valid_styles:{"*":"color,background,background-color,text-decoration,font-weight"},color_map:this.ke}))}focus(){this.isSimple?this.Pe.focus():this.ia&&tinymce.get(this.Pe.id)&&tinymce.get(this.Pe.id).initialized&&tinymce.get(this.Pe.id).focus()}};function Ke(f,p){let t="",e=f.length-1;p=Object.assign({sep:"-",formatter:s=>we(s.match(/([A-Z]|^[a-z]|[0-9])[a-z0-9]*/g).join(" ")),icon:'<i class="bi bi-question-circle"></i>'},p||{}),f.length===1?t+=`<li class="breadcrumb-icon">${p.icon}</li>`:t+=`<li class="breadcrumb-icon"><a href="#${f.slice(0,1).join("-")}">${p.icon}</a></li>`;for(let s=0,n=f.length;s<n;s++){let r=p.formatter(f[s],s,e);s===e?t+='<li class="breadcrumb-item active">'+r+"</li>":t+='<li class="breadcrumb-item" aria-current="page"><a href="#'+f.slice(0,s+1).join(p.sep)+'">'+r+"</a></li>"}return p.small?`<ol class="breadcrumb${this.Rt?" breadcrumb-sm":""}" style="overflow: hidden;white-space: nowrap;text-overflow: ellipsis;flex-wrap: nowrap;">${t}</ol>`:'<ol class="float-start breadcrumb">'+t+"</ol>"}var Xi='<div class="contents list-group list-group-flush" style="top:0;position:absolute;left:0;bottom:49px;right:0"><a href="#settings-general" class="list-group-item list-group-item-action"><i class="fas fa-cogs"></i> General</a> <a href="#settings-display" class="list-group-item list-group-item-action"><i class="fas fa-display"></i> Display</a> <a href="#settings-colors" class="list-group-item list-group-item-action"><i class="fas fa-palette"></i> Colors</a> <a href="#settings-commandLine" class="list-group-item list-group-item-action"><i class="fas fa-terminal"></i> Command line</a> <a href="#settings-tabCompletion" class="list-group-item list-group-item-action"><i class="fa-solid fa-arrow-right-to-bracket"></i> Tab completion</a> <a href="#settings-telnet" class="list-group-item list-group-item-action"><i class="fas fa-network-wired"></i> Telnet</a> <a href="#settings-scripting" class="list-group-item list-group-item-action"><i class="fas fa-code"></i> Scripting</a> <a href="#settings-specialCharacters" class="list-group-item list-group-item-action"><i class="fa-regular fa-file-code"></i> Special characters</a> <a href="#settings-advanced" class="list-group-item list-group-item-action"><i class="fa-solid fa-sliders"></i> Advanced</a></div>';var mi=class f extends ye{constructor(){super({title:'<i class="fas fa-cogs"></i> Settings',id:"settings-dialog",keepCentered:!0,resizable:!1,moveable:!1,center:!0,maximizable:!1}),this.body.style.padding="10px",this.ni();let p="";p+=`<button id="${this.id}-cancel" type="button" class="btn-sm float-end btn btn-light" title="Cancel dialog"><i class="bi bi-x-lg"></i><span class="icon-only"> Cancel</span></button>`,p+=`<button id="${this.id}-save" type="button" class="btn-sm float-end btn btn-primary" title="Confirm dialog"><i class="bi bi-save"></i><span class="icon-only"> Save</span></button>`,p+=`<button id="${this.id}-reset" type="button" class="btn-sm float-start btn btn-warning" title="Reset settings"><i class="bi bi-arrow-clockwise"></i><span class="icon-only"> Reset</span></button>`,p+=`<button id="${this.id}-reset-all" type="button" class="btn-sm float-start btn btn-warning" title="Reset All settings"><i class="bi bi-arrow-repeat"></i><span class="icon-only"> Reset All</span></button>`,p+='<div class="vr float-start" style="margin-right: 4px;height: 29px;"></div>',p+=`<button id="${this.id}-export" type="button" class="btn-sm float-start btn btn-light" title="Export settings"><i class="bi bi-box-arrow-up"></i><span class="icon-only"> Export</span></button>`,p+=`<button id="${this.id}-import" type="button" class="btn-sm float-start btn btn-light" title="Import settings"><i class="bi bi-box-arrow-in-down"></i><span class="icon-only"> Import</span></button>`,this.footer.innerHTML=p,this.footer.querySelector(`#${this.id}-cancel`).addEventListener("click",()=>{he(this.we),this.close()}),this.footer.querySelector(`#${this.id}-export`).addEventListener("click",()=>{let t=_e(this.settings);t.version=2,fileSaveAs.show(JSON.stringify(t),"oiMUD.settings.txt","text/plain")}),this.footer.querySelector(`#${this.id}-import`).addEventListener("click",()=>{Se("Import settings").then(t=>{Ee(t[0]).then(e=>{try{let s=JSON.parse(e),n,r;if(s.version===1){for(n=0,r=te.length;n<r;n++)this.settings[te[n][0]]=s[te[n][0]];this.emit("import-rooms",s.rooms)}else if(s.version===2&&!s.profiles)for(n=0,r=te.length;n<r;n++)this.settings[te[n][0]]=s[te[n][0]];else setTimeout(function(){alert_box("Invalid file","Unable to import file, not a valid settings file",4)},50);this.la()}catch(s){setTimeout(function(){alert_box("Error importing","Error importing file.",3)},50),client.error(s)}}).catch(e=>client.error(e))}).catch(()=>{})}),this.footer.querySelector(`#${this.id}-reset`).addEventListener("click",()=>{if(this.we==="settings-colors")confirm_box("Reset colors","Reset colors?").then(t=>{if(t.button===4){let e,s=this.settings.colors=[];for(e=0;e<16;e++)this.setColor("color"+e,s[e]||this.getDefaultColor(e));for(e=256;e<280;e++)this.setColor("color"+e,s[e]||this.getDefaultColor(e));this.body.querySelector("#colorScheme").value=0}});else if(this.we&&this.we!=="settings"&&this.we.length){let t=this.we.split("-"),e=we(t[t.length-1].match(/([A-Z]|^[a-z])[a-z]+/g).join(" "));confirm_box(`Reset ${e} settings`,`Reset ${e} settings?`).then(s=>{if(s.button===4){let n=this.body.querySelectorAll("input,select,textarea");for(let r=0,o=n.length;r<o;r++){let a=n[r].name||n[r].id;this.settings[a]=ue.defaultValue(a),n[r].type==="checkbox"||n[r].type==="radio"?n[r].checked=this.settings[a]:n[r].value=this.settings[a]}}})}else confirm_box("Reset all settings","Reset all settings?").then(t=>{t.button===4&&this.settings.reset()})}),this.footer.querySelector(`#${this.id}-reset-all`).addEventListener("click",()=>{confirm_box("Reset all settings","Reset all settings?").then(t=>{t.button===4&&this.settings.reset()})}),this.footer.querySelector(`#${this.id}-save`).addEventListener("click",()=>{he(this.we);for(let t in this.settings)this.settings.hasOwnProperty(t)&&ue.setValue(t,this.settings[t]);client.clearCache(),client.loadOptions(),this.close()}),this.settings=new ue,this.on("closed",()=>{he(this.we)}),this.on("canceled",()=>{he(this.we)})}setBody(p,t){super.setBody(this.dialog.dataset.path==="settings"?Xi:p,t),this.we=this.dialog.dataset.path;let e=this.we.split("-");if(this.title=Ke(e,{icon:'<i class="float-start fas fa-cogs" style="padding: 2px;margin-right: 2px;"></i>'}),this.pe){let s=this.pe.querySelectorAll("a.active");s.forEach(n=>n.classList.remove("active")),s=this.pe.querySelector(`a[href="#${this.we}"]`),s&&s.classList.add("active")}this.we==="settings"?(this.pe&&(this.pe.style.display="none"),this.body.style.left="",this.footer.querySelector(`#${this.id}-reset`)&&(this.footer.querySelector(`#${this.id}-reset`).style.display="none"),f.addPlugins(this.body.querySelector("div.contents"))):(this.pe&&(this.pe.style.display=""),this.footer.querySelector(`#${this.id}-reset`)&&(this.footer.querySelector(`#${this.id}-reset`).style.display=""),this.body.style.left="200px",pt(this.pe,this.pe.querySelector(`a[href="#${this.we}"]`))),this.body.scrollTop=0,this.la()}ni(){this.dialog.insertAdjacentHTML("beforeend",Xi.replace(' style="top:0;position:absolute;left:0;bottom:49px;right:0"',"")),this.pe=this.dialog.querySelector(".contents"),this.pe.classList.add("settings-menu"),f.addPlugins(this.pe),this.we==="settings"&&(this.pe.style.display="none"),this.body.style.left="200px"}la(){let p=this.body.querySelectorAll("input,select,textarea"),t;if(this.we==="settings-colors"){let e,s=this.settings.colors||[];for(e=0;e<16;e++)this.setColor("color"+e,s[e]||this.getDefaultColor(e));for(e=256;e<280;e++)this.setColor("color"+e,s[e]||this.getDefaultColor(e));for(let n=0,r=p.length;n<r;n++)p[n].addEventListener("change",o=>{let a=o.currentTarget||o.target,h=a.value,c=parseInt(a.id.substring(5),10),g=this.settings.colors||[];!g[c]||g[c].length===0?this.getDefaultColor(c)!==h&&(g[c]=h):this.getDefaultColor(c)!==h?delete g[c]:g[c]=h,this.settings.colors=g}),p[n].addEventListener("input",o=>{let a=o.currentTarget||o.target,h=a.value,c=parseInt(a.id.substring(5),10);!this.settings.colors[c]||this.settings.colors[c].length===0?this.getDefaultColor(c)!==h&&(this.settings.colors[c]=h):this.getDefaultColor(c)!==h?delete this.settings.colors[c]:this.settings.colors[c]=h})}else for(let e=0,s=p.length;e<s;e++){let n=p[e].dataset.default||"";if(p[e].dataset.parent&&!(p[e].dataset.parent in this.settings)&&(this.settings[p[e].dataset.parent]=ue.getValue(p[e].dataset.parent)),p[e].type==="radio"){!p[e].dataset.parent&&!(p[e].name in this.settings)&&(this.settings[p[e].name]=ue.getValue(p[e].name));let r;p[e].dataset.parent?this.settings[p[e].dataset.parent]&&this.settings[p[e].dataset.parent][p[e].dataset.field]!==null?r=""+this.settings[p[e].dataset.parent][p[e].dataset.field]:r=n:this.settings[p[e].name]===null?r=n:r=""+this.settings[p[e].name],p[e].checked=r===p[e].value,p[e].addEventListener("change",o=>{let a=o.currentTarget||o.target;a.checked&&(a.dataset.parent?(this.settings[a.dataset.parent]||(this.settings[a.dataset.parent]={}),this.settings[a.dataset.parent][a.dataset.field]=this.convertType(a.value,typeof this.settings[a.dataset.parent][a.dataset.field])):this.settings[a.name]=this.convertType(a.value,typeof this.settings[a.name]))})}else if(p[e].type==="checkbox"){let r;if(p[e].dataset.enum==="true"){r=p[e].name||p[e].id.substring(0,p[e].id.lastIndexOf("-")),r in this.settings||(this.settings[r]=ue.getValue(r));let o=+p[e].id.substring(p[e].id.lastIndexOf("-")+1);p[e].checked=(this.settings[r]&o)===o}else p[e].dataset.parent?this.settings[p[e].dataset.parent]&&p[e].dataset.field in this.settings[p[e].dataset.parent]?p[e].checked=this.settings[p[e].dataset.parent][p[e].dataset.field]:p[e].checked=n==="true":(r=p[e].name||p[e].id,r in this.settings||(this.settings[r]=ue.getValue(r)),this.settings[r]!==null?p[e].checked=this.settings[r]:p[e].checked=n==="true");p[e].addEventListener("change",o=>{let a=o.currentTarget||o.target,h;if(a.dataset.enum==="true"){h=a.name||a.id.substring(0,a.id.lastIndexOf("-"));let g=this.body.querySelectorAll(`[name="${h}"]`),m=0;for(let b=0,u=g.length;b<u;b++)g[b].checked&&(m|=+g[b].value);a.dataset.parent?(this.settings[a.dataset.parent]||(this.settings[a.dataset.parent]={}),this.settings[a.dataset.parent][a.dataset.field]=m):this.settings[h]=m}else a.dataset.parent?(this.settings[a.dataset.parent]||(this.settings[a.dataset.parent]={}),this.settings[a.dataset.parent][a.dataset.field]=a.checked||!1):(h=a.name||a.id,this.settings[h]=a.checked||!1);this.body.querySelectorAll(`[data-require="${h}"]`).forEach(g=>{g.disabled=!this.settings[h]})}),t=this.body.querySelectorAll(`[data-require="${r}"]`),t.forEach(o=>{o.disabled=!this.settings[r]})}else{let r;p[e].dataset.parent?this.settings[p[e].dataset.parent]&&p[e].dataset.field in this.settings[p[e].dataset.parent]?p[e].dataset.join&&p[e].dataset.join.length?p[e].value=(this.settings[p[e].dataset.parent][p[e].dataset.field]||[]).map(o=>o.trim()).join(p[e].dataset.join):p[e].value=this.settings[p[e].dataset.parent][p[e].dataset.field]:r=n:p[e].dataset.join&&p[e].dataset.join.length?(p[e].id in this.settings||(this.settings[p[e].id]=ue.getValue(p[e].id)),this.settings[p[e].id]!==null?r=(this.settings[p[e].id]||[]).map(o=>o.trim()).join(p[e].dataset.join):r=n):(p[e].id in this.settings||(this.settings[p[e].id]=ue.getValue(p[e].id)),this.settings[p[e].id]!==null?r=this.settings[p[e].id]:r=n),p[e].value=r,p[e].addEventListener("change",o=>{let a=o.currentTarget||o.target;if(a.dataset.parent){let h;a.dataset.join&&a.dataset.join.length?h=a.value.split(a.dataset.join).map(c=>c.trim()):h=a.value,this.settings[a.dataset.parent]||(this.settings[a.dataset.parent]={}),this.settings[a.dataset.parent][a.dataset.field]=this.getValue(h,this.settings[a.dataset.parent][a.dataset.field])}else a.dataset.join&&a.dataset.join.length?this.setValue(a.name||a.id,a.value.split(a.dataset.join).map(h=>h.trim())):this.setValue(a.name||a.id,a.value)}),p[e].addEventListener("input",o=>{let a=o.currentTarget||o.target;if(a.dataset.parent){let h;a.dataset.join&&a.dataset.join.length?h=a.value.split(a.dataset.join).map(c=>c.trim()):h=a.value,this.settings[a.dataset.parent]||(this.settings[a.dataset.parent]={}),this.settings[a.dataset.parent][a.dataset.field]=this.getValue(h,this.settings[a.dataset.parent][a.dataset.field])}else a.dataset.join&&a.dataset.join.length?this.setValue(a.name||a.id,a.value.split(a.dataset.join).map(h=>h.trim())):this.setValue(a.name||a.id,a.value)})}}}setColor(p,t){!t||typeof t>"u"||t.length===0?this.body.querySelector("#"+p).value="":this.body.querySelector("#"+p).value=this.colorHex(t)}colorHex(p){return p?(p=new de(p),p.ok?p.toHex():""):!1}getDefaultColor(p){return p===0?"rgb(0,0,0)":p===1?"rgb(128, 0, 0)":p===2?"rgb(0, 128, 0)":p===3?"rgb(128, 128, 0)":p===4?"rgb(0, 0, 128)":p===5?"rgb(128, 0, 128)":p===6?"rgb(0, 128, 128)":p===7?"rgb(192, 192, 192)":p===8?"rgb(128, 128, 128)":p===9?"rgb(255, 0, 0)":p===10?"rgb(0, 255, 0)":p===11?"rgb(255, 255, 0)":p===12?"rgb(0, 0, 255)":p===13?"rgb(255, 0, 255)":p===14?"rgb(0, 255, 255)":p===15?"rgb(255, 255, 255)":p===256?"rgb(0, 0, 0)":p===257?"rgb(118, 0, 0)":p===258?"rgb(0, 108, 0)":p===259?"rgb(145, 136, 0)":p===260?"rgb(0, 0, 108)":p===261?"rgb(108, 0, 108)":p===262?"rgb(0, 108, 108)":p===263?"rgb(160, 160, 160)":p===264?"rgb(0, 0, 0)":p===265?"rgb(128, 0, 0)":p===266?"rgb(0, 128, 0)":p===267?"rgb(128, 128, 0)":p===268?"rgb(0, 0, 128)":p===269?"rgb(128, 0, 128)":p===270?"rgb(0, 128, 128)":p===271?"rgb(192, 192, 192)":p===272?"rgb(0,0,0)":p===273?"rgb(0, 255, 255)":p===274?"rgb(0,0,0)":p===275?"rgb(255, 255, 0)":p===276?"rgb(0, 0, 0)":p===277?"rgb(192, 192, 192)":p===278?"rgb(128, 0, 0)":p===279?"rgb(192, 192, 192)":p===280?"rgb(255,255,255)":""}setValue(p,t){t=="false"?t=!1:t=="true"?t=!0:t=="null"?t=null:t=="undefined"?t=void 0:typeof t=="string"&&parseFloat(t).toString()==t&&(t=parseFloat(t)),this.settings[p]=this.convertType(t,typeof this.settings[p])}getValue(p,t){if(p=="false")return!1;if(p=="true")return!0;if(p=="null")return null;if(p!="undefined")return typeof p=="string"&&parseFloat(p).toString()==p?parseFloat(p):this.convertType(p,typeof t)}convertType(p,t){if(typeof p===t)return p;switch(t){case"number":return typeof p=="string"&&parseFloat(p).toString()==p?parseFloat(p):Number(p);case"boolean":return!!p;case"string":return""+p}return p}static addPlugins(p){let t=client.plugins.length,e=client.plugins,s,n;for(let r=0;r<t;r++)if(e[r].settings&&e[r].settings.length)for(n=e[r].settings.length,s=0;s<n;s++){let o=e[r].settings[s];if(typeof o.action!="string")continue;let a=`<a href="#${o.action}" class="list-group-item list-group-item-action">${o.icon||""}${o.name||""}</a>`;if("position"in o){if(typeof o.position=="string"){if(p.querySelector(o.position)){p.querySelector(o.position).insertAdjacentHTML("afterend",a);continue}}else if(o.position>=0&&o.position<p.children.length){p.children[o.position].insertAdjacentHTML("afterend",a);continue}}p.insertAdjacentHTML("beforeend",a)}}};var je=class extends me{constructor(t){super();this.et=200;this.rt=200;this.qe=4;this.zt=204;this.lo=!1;this.vi=0;this.live=!0;t&&t.id&&(this.Qr=t.id),t&&(this.$e=t.panel1,this.Ge=t.panel2),t&&t.container?this.parent=t.container.container?t.container.container:t.container:t&&t.parent?this.parent=t.parent:this.parent=document.body,t?("anchor"in t?this.Ht=t.anchor:this.Ht=2,this.orientation=t.orientation||0):(this.Ht=2,this.orientation=0)}hide(){this.Bt.style.display="none"}show(){this.Bt.style.display=""}get splitterWidth(){return this.qe}set splitterWidth(t){this.qe!==t&&(this.qe=t,this.is())}get id(){return this.Qr||this.parent.id}set id(t){t!==this.Qr&&(this.Qr=t,this.Bt.id=this.id+"-splitter",this.$e.id=this.id+"-splitter-panel1",this.Ge.id=this.id+"-splitter-panel2",this.it.id=this.id+"-splitter-drag-bar",this.Ve&&(this.Ve.id=this.id+"-splitter-ghost-bar"))}set parent(t){typeof t=="string"?t.startsWith("#")?this.ri=document.getElementById(t.substr(1)):this.ri=document.getElementById(t):t instanceof $?this.ri=t[0]:t instanceof HTMLElement&&(this.ri=t),this.ri||(this.ri=document.body),this.Sh()}get parent(){return this.ri}get panel1(){return this.$e}get panel2(){return this.Ge}get anchor(){return this.Ht}set anchor(t){this.Ht!==t&&(this.Ht=2,this.is())}set SplitterDistance(t){this.zt!==t&&(this.zt=t,this.is(),this.emit("splitter-moved",t))}get SplitterDistance(){return this.zt}set Panel1MinSize(t){this.et!==t&&(this.et=t,this.wi===0?this.$e.clientWidth<t&&(this.zt=this.parent.clientWidth-this.et):this.$e.clientHeight<t&&(this.zt=this.parent.clientHeight-this.et),this.is())}get Panel1MinSize(){return this.et}set Panel2MinSize(t){this.rt!==t&&(this.rt=t,this.wi===0?this.Ge.clientWidth<t&&(this.zt=t):this.Ge.clientHeight<t&&(this.zt=t),this.is())}get Panel2MinSize(){return this.rt}get orientation(){return this.wi}set orientation(t){t!==this.wi&&(this.wi=t,this.is(),this.resize())}get panel1Collapsed(){return this.vi===1}set panel1Collapsed(t){if(t){if(this.vi===1)return;this.vi=1,this.panel1.dataset.collapsed="true",this.panel2.dataset.collapsed="false",this.emit("collapsed",1),this.is()}else this.vi===1&&(this.vi=0,delete this.panel1.dataset.collapsed,delete this.panel2.dataset.collapsed,this.emit("collapsed",0),this.is())}get panel2Collapsed(){return this.vi===2}set panel2Collapsed(t){if(t){if(this.vi===2)return;this.vi=2,this.panel1.dataset.collapsed="false",this.panel2.dataset.collapsed="true",this.emit("collapsed",2),this.is()}else this.vi===2&&(this.vi=0,delete this.panel1.dataset.collapsed,delete this.panel2.dataset.collapsed,this.emit("collapsed",0),this.is())}is(){this.wi===0?(this.$e.style.left="0",this.$e.style.top="0",this.$e.style.right="0",this.$e.style.bottom="",this.Ge.style.left="0",this.Ge.style.top="",this.Ge.style.right="0",this.Ge.style.bottom="0",this.it.style.left="0",this.it.style.right="0",this.Ht===1?(this.it.style.bottom="",this.it.style.top=this.zt-this.qe+"px"):(this.it.style.top="",this.it.style.bottom=this.zt-this.qe+"px"),this.it.style.height=this.qe+"px",this.it.style.width="",this.it.style.cursor="ns-resize",this.$e.style.width="",this.Ge.style.width="",this.vi===1?(this.$e.style.display="none",this.Ge.style.display="",this.Ge.style.top="0",this.Ge.style.height="",this.it.style.display="none"):this.vi===2?(this.$e.style.display="",this.$e.style.bottom="0",this.$e.style.height="",this.Ge.style.display="none",this.it.style.display="none"):this.Ht===1?(this.$e.style.display="",this.$e.style.height=this.zt-this.qe+"px",this.Ge.style.display="",this.Ge.style.top=this.zt+"px",this.Ge.style.height="",this.it.style.display=""):(this.$e.style.display="",this.$e.style.bottom=this.zt+"px",this.Ge.style.display="",this.Ge.style.height=this.zt-this.qe+"px",this.it.style.display=""),this.Bt.classList.remove("vertical"),this.Bt.classList.add("horizontal")):(this.$e.style.left="0",this.$e.style.top="0",this.$e.style.right="",this.$e.style.bottom="0",this.$e.classList.remove("horizontal"),this.$e.classList.add("vertical"),this.Ge.style.left="",this.Ge.style.top="0",this.Ge.style.right="0",this.Ge.style.bottom="0",this.Ht===1?(this.it.style.right="",this.it.style.left=this.zt-this.qe+"px"):(this.it.style.left="",this.it.style.right=this.zt-this.qe+"px"),this.it.style.top="0",this.it.style.bottom="0",this.it.style.width=this.qe+"px",this.it.style.height="",this.it.style.cursor="ew-resize",this.$e.style.height="",this.Ge.style.height="",this.vi===1?(this.$e.style.display="none",this.Ge.style.display="",this.Ge.style.left="0",this.Ge.style.width="",this.it.style.display="none"):this.vi===2?(this.$e.style.display="",this.$e.style.right="0",this.$e.style.width="",this.Ge.style.display="none",this.it.style.display="none"):this.Ht===1?(this.$e.style.display="",this.$e.style.width=this.zt-this.qe+"px",this.Ge.style.display="",this.Ge.style.left=this.zt+"px",this.Ge.style.width="",this.it.style.display=""):(this.$e.style.display="",this.$e.style.right=this.zt+"px",this.Ge.style.display="",this.Ge.style.width=this.zt-this.qe+"px",this.it.style.display=""),this.Bt.classList.remove("horizontal"),this.Bt.classList.add("vertical"))}Sh(){this.Bt=document.createElement("div"),this.Bt.id=this.id+"-splitter",this.Bt.classList.add("splitter"),this.$e||(this.$e=document.createElement("div"),this.$e.id=this.id+"-splitter-panel1"),this.$e.classList.add("splitter-panel","splitter-panel-1"),this.Bt.appendChild(this.$e),this.Ge||(this.Ge=document.createElement("div"),this.Ge.id=this.id+"-splitter-panel2"),this.Ge.classList.add("splitter-panel","splitter-panel-2"),this.Bt.appendChild(this.Ge),this.it=document.createElement("div"),this.it.id=this.id+"-splitter-drag-bar",this.it.classList.add("spitter-drag-bar"),this.Bt.appendChild(this.it),this.it.tabIndex=1,this.it.addEventListener("mousedown",t=>{this.it.focus(),t.preventDefault(),this.$e.style.pointerEvents="none",this.Ge.style.pointerEvents="none",this.lo=!0,this.Ve=document.createElement("div"),this.Ve.id=this.id+"-splitter-ghost-bar",this.Ve.classList.add("splitter-ghost-bar");let e=this.Ge.getBoundingClientRect();this.Ht===1&&(e=this.$e.getBoundingClientRect()),this.wi===0?(this.Ve.style.left="0",this.Ht===1?this.Ve.style.top=e.bottom-this.Wi.top+"px":this.Ve.style.top=e.top-this.Wi.top-this.qe+"px",this.Ve.style.right="0",this.Ve.style.bottom="",this.Ve.style.width="",this.Ve.style.height=this.qe+"px",this.Ve.style.cursor="ns-resize"):(this.Ht===1?this.Ve.style.left=e.right-this.Wi.left+"px":this.Ve.style.left=e.left-this.Wi.left-this.qe+"px",this.Ve.style.top="0",this.Ve.style.bottom="0",this.Ve.style.right="",this.Ve.style.height="",this.Ve.style.width=this.qe+"px",this.Ve.style.cursor="ew-resize"),this.Ve.move=s=>{let n;this.wi===0&&this.Ht===1?(n=s.pageY-this.Wi.top,n<this.et+this.qe?this.Ve.style.top=this.et+"px":n>this.parent.clientHeight-this.rt-this.qe?this.Ve.style.top=this.parent.clientHeight-this.rt-this.qe+"px":this.Ve.style.top=n-2+"px",this.live&&(n<this.et+this.qe?this.SplitterDistance=this.et+this.qe:n>this.parent.clientHeight-this.rt-this.qe?this.SplitterDistance=this.parent.clientHeight-this.rt:this.SplitterDistance=n-2+this.qe)):this.wi===0?(n=s.pageY-this.Wi.top,n<this.et?this.Ve.style.top=this.et+"px":n>this.parent.clientHeight-this.rt?this.Ve.style.top=this.parent.clientHeight-this.rt+"px":this.Ve.style.top=n-2+"px",this.live&&(n<this.et?this.SplitterDistance=this.parent.clientHeight-this.et:n>this.parent.clientHeight-this.rt?this.SplitterDistance=this.rt:this.SplitterDistance=this.parent.clientHeight-n+2)):this.wi===1&&this.Ht===1?(n=s.pageX-this.Wi.left,n<this.et+this.qe?this.Ve.style.left=this.et+"px":n>=this.parent.clientWidth-this.rt-this.qe?this.Ve.style.left=this.parent.clientWidth-this.rt-this.qe+"px":this.Ve.style.left=n-2+"px",this.live&&(n<this.et+this.qe?this.SplitterDistance=this.et+this.qe:n>=this.parent.clientWidth-this.rt-this.qe?this.SplitterDistance=this.parent.clientWidth-this.rt:this.SplitterDistance=n-2+this.qe)):(n=s.pageX-this.Wi.left,n<this.et?this.Ve.style.left=this.et+"px":n>this.parent.clientWidth-this.rt?this.Ve.style.left=this.parent.clientWidth-this.rt+"px":this.Ve.style.left=n-2+"px",this.live&&(n<this.et?this.SplitterDistance=this.parent.clientWidth-this.et:n>this.parent.clientWidth-this.rt?this.SplitterDistance=this.rt:this.SplitterDistance=this.parent.clientWidth-n+2)),this.emit("splitter-moving",n)},this.Bt.appendChild(this.Ve),document.addEventListener("mousemove",this.Ve.move)}),this.it.addEventListener("dblclick",t=>{this.emit("dblclick",t)}),window.addEventListener("resize",()=>{this.resize()}),document.addEventListener("mouseup",t=>{if(!this.lo)return;t.preventDefault(),t.stopPropagation(),t.cancelBubble=!0;let e;this.wi===0?(e=t.pageY-this.Wi.top,this.Ht===1?e<this.et+this.qe?this.SplitterDistance=this.et+this.qe:e>this.parent.clientHeight-this.rt-this.qe?this.SplitterDistance=this.parent.clientHeight-this.rt:this.SplitterDistance=e-2+this.qe:e<this.et?this.SplitterDistance=this.parent.clientHeight-this.et-2:e>this.parent.clientHeight-this.rt?this.SplitterDistance=this.rt:this.SplitterDistance=this.parent.clientHeight-e+2):(e=t.pageX-this.Wi.left,this.Ht===1?e<this.et+this.qe?this.SplitterDistance=this.et+this.qe:e>this.parent.clientWidth-this.rt-this.qe?this.SplitterDistance=this.parent.clientWidth-this.rt:this.SplitterDistance=e-2+this.qe:e<this.et?this.SplitterDistance=this.parent.clientWidth-this.et-2:e>this.parent.clientWidth-this.rt?this.SplitterDistance=this.rt:this.SplitterDistance=this.parent.clientWidth-e+2),this.Bt.removeChild(this.Ve),document.removeEventListener("mousemove",this.Ve.move),this.Ve=null,this.lo=!1,this.$e.style.pointerEvents="",this.Ge.style.pointerEvents=""}),this.parent.appendChild(this.Bt),setTimeout(()=>{this.Wi=this.Bt.getBoundingClientRect()},10),this.oa=new ResizeObserver((t,e)=>{t.length!==0&&(!t[0].contentRect||t[0].contentRect.width===0||t[0].contentRect.height===0||(!this._r||this._r.width!==t[0].contentRect.width||this._r.height!==t[0].contentRect.height)&&(this._r={width:t[0].contentRect.width,height:t[0].contentRect.height},this.resize()))}),this.oa.observe(this.Bt),this.aa=new MutationObserver(t=>{let e;for(e of t)e.type==="attributes"&&e.attributeName==="style"&&e.oldValue==="display: none;"&&this.resize()}),this.aa.observe(this.Bt,{attributes:!0,attributeOldValue:!0,attributeFilter:["style"]})}resize(){this.wi===0&&this.Ht===1?this.Ge.clientHeight&&this.Ge.clientHeight<this.rt&&this.$e.clientHeight>this.et&&(this.SplitterDistance=this.parent.clientHeight-this.rt):this.wi===0?this.$e.clientHeight&&this.$e.clientHeight<this.et&&this.Ge.clientHeight>this.rt&&(this.SplitterDistance=this.et):this.wi===1&&this.Ht===1?this.Ge.clientWidth&&this.Ge.clientWidth<this.rt&&this.$e.clientWidth>this.et&&(this.SplitterDistance=this.parent.clientWidth-this.rt):this.$e.clientWidth<this.et&&this.Ge.clientWidth>this.rt&&(this.SplitterDistance=this.et),this.Wi=this.Bt.getBoundingClientRect()}};var gi=class extends me{constructor(p,t){super(),this.parent=t,this.manager=p,this.createControl(),this.oo=e=>{e.keyCode===27&&this.hide()},window.document.addEventListener("keyup",this.oo.bind(this)),this.Ue.on("keydown",e=>{e.keyCode===8&&(clearTimeout(this.zs),this.zs=setTimeout(()=>{this.find(!0)},this.ys?500:250))}),this.Ue.on("keypress",()=>{clearTimeout(this.zs),this.zs=setTimeout(()=>{this.find(!0)},this.ys?500:250)}),this.Ue.on("paste",e=>{clearTimeout(this.zs),this.zs=setTimeout(()=>{this.find(!0)},this.ys?500:250)}),this.Ue.on("cut",e=>{clearTimeout(this.zs),this.zs=setTimeout(()=>{this.find(!0)},this.ys?500:250)})}get id(){return this.parent?this.parent.id:""}set parent(p){typeof p=="string"?p.startsWith("#")?this.ri=document.getElementById(p.substr(1)):this.ri=document.getElementById(p):p instanceof $?this.ri=p[0]:p instanceof HTMLElement&&(this.ri=p),this.ri||(this.ri=document.body)}get parent(){return this.ri}get MatchCase(){return this.yr}set MatchCase(p){p!==this.yr&&(this.yr=p,this.yr?$("#"+this.id+"-find-case",this.Ue).addClass("active"):$("#"+this.id+"-find-case",this.Ue).removeClass("active"),this.find(!0),this.emit("case"))}get RegularExpression(){return this.ys}set RegularExpression(p){p!==this.ys&&(this.ys=p,this.ys?$("#"+this.id+"-find-regex",this.Ue).addClass("active"):$("#"+this.id+"-find-regex",this.Ue).removeClass("active"),this.find(!0),this.emit("regex"))}get MatchWord(){return this.wr}set MatchWord(p){p!==this.wr&&(this.wr=p,this.wr?$("#"+this.id+"-find-word",this.Ue).addClass("active"):$("#"+this.id+"-find-word",this.Ue).removeClass("active"),this.find(!0),this.emit("word"))}get Reverse(){return this.tl}set Reverse(p){p!==this.tl&&(this.tl=p,this.tl?($("#"+this.id+"-find-reverse",this.Ue).addClass("active"),$("#"+this.id+"-find-next",this.Ue).html('<i class="bi bi-arrow-up"></i>'),$("#"+this.id+"-find-prev",this.Ue).html('<i class="bi bi-arrow-down"></i>')):($("#"+this.id+"-find-reverse",this.Ue).removeClass("active"),$("#"+this.id+"-find-next",this.Ue).html('<i class="bi bi-arrow-down"></i>'),$("#"+this.id+"-find-prev",this.Ue).html('<i class="bi bi-arrow-up"></i>')),this.xi=this.Kt.length-this.xi-1,this.updateButtons(),this.updateCount(),this.find(!0),this.emit("reverse"))}get SearchValue(){return this.vr}set SearchValue(p){p!==this.vr&&(this.vr=p,this.vr?$("#"+this.id+"-find-value",this.Ue).addClass("active"):$("#"+this.id+"-find-value",this.Ue).removeClass("active"),this.find(!0),this.emit("value"))}createControl(){this.Ue=$('<div id="'+this.id+'-find" class="find"><div class="input-group flex-grow-1" style="width: auto;"><input placeholder="Find" class="form-control" /><button id="'+this.id+'-find-case" title="Match Case" class="find-case btn btn-outline-secondary">Aa</button><button id="'+this.id+'-find-word" title="Match Whole Word" class="find-word btn btn-outline-secondary">Aa|</button><button id="'+this.id+'-find-regex" title="Use Regular Expression" class="find-regex btn btn-outline-secondary">.*</button><button id="'+this.id+'-find-value" title="Search values" class="find-value btn btn-outline-secondary"><i class="bi bi-code"></i></button></div><div id="'+this.id+'-find-count" class="find-count flex-grow-1"></div><div class="btn-group me-1" role="group" aria-label="Find navigation"><button id="'+this.id+'-find-prev" title="Previous Match" disabled="disabled" class="find-prev btn btn-outline-secondary"><i class="bi bi-arrow-up"></i></button><button id="'+this.id+'-find-next" title="Next Match" disabled="disabled" class="find-next btn btn-outline-secondary"><i class="bi bi-arrow-down"></i></button><button id="'+this.id+'-find-selection" title="Find in selection" disabled="disabled" class="find-selection btn btn-outline-secondary"><i class="fa fa-align-left"></i></button><button id="'+this.id+'-find-reverse" title="Search Up" class="find-reverse btn btn-outline-secondary"><i class="bi bi-caret-up-fill"></i></button></div><button id="'+this.id+'-find-close" title="Close" class="find-close btn btn-secondary"><i class="bi bi-x-lg"></i></button></div>'),$("#"+this.id+"-find-close",this.Ue).on("click",()=>{this.hide()}),$("#"+this.id+"-find-prev",this.Ue).on("click",()=>{this.gotoPrevious()}),$("#"+this.id+"-find-next",this.Ue).on("click",()=>{this.gotoNext()}),$("#"+this.id+"-find-case",this.Ue).on("click",()=>{this.MatchCase=!this.MatchCase}),$("#"+this.id+"-find-word",this.Ue).on("click",()=>{this.MatchWord=!this.MatchWord}),$("#"+this.id+"-find-reverse",this.Ue).on("click",()=>{this.Reverse=!this.Reverse}),$("#"+this.id+"-find-regex",this.Ue).on("click",()=>{this.RegularExpression=!this.RegularExpression}),$("#"+this.id+"-find-value",this.Ue).on("click",()=>{this.SearchValue=!this.SearchValue}),this.ri.insertAdjacentElement("afterbegin",this.Ue[0])}show(p){this.Ue.css("display","flex"),p&&p.length&&$("input",this.Ue).val(p),$("input",this.Ue).focus().select(),this.find(),this.emit("shown")}get open(){return this.Ue.css("display")!=="none"}hide(){this.Ue.css("display","none"),$("input",this.Ue).val(""),this.clear(),this.emit("closed")}find(p){let t=$("input",this.Ue).val();if(this.clear(),t.length===0){this.updateCount(),this.emit("found-results",this.Kt);return}if(!this.manager.profiles.length){this.updateCount(),this.emit("found-results",this.Kt);return}let e;this.ys?e=t:e=t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");let s;this.wr&&(e="\\b"+e+"\\b"),this.yr?s=new RegExp(e,"g"):s=new RegExp(e,"gi");let n=[],r,o,a,h,c=Object.values(this.manager.profiles.items);for(let g=0,m=c.length;g<m;g++){let b=c[g];r=s.exec(b.name);let u="profiles/"+encodeURIComponent(b.name.toLowerCase());for(r&&n.push({key:u}),a=b.aliases.length,o=0;o<a;o++)h=b.aliases[o],(this.matchItem(s,h)||s.exec(h.pattern))&&n.push({key:u+"/aliases/"+o});for(a=b.macros.length,o=0;o<a;o++)h=b.macros[o],this.matchItem(s,h)&&n.push({key:u+"/macros/"+o});for(a=b.triggers.length,o=0;o<a;o++)if(h=b.triggers[o],this.matchItem(s,h)||s.exec(h.pattern))n.push({key:u+"/triggers/"+o});else if(h.triggers.length)for(let E=0,w=h.triggers.length;E<w;E++)(this.matchItem(s,h.triggers[E])||s.exec(h.triggers[E].pattern))&&n.push({key:`${u}/triggers/${o}/${E+1}`});for(a=b.buttons.length,o=0;o<a;o++)h=b.buttons[o],(this.matchItem(s,h)||s.exec(h.caption))&&n.push({key:u+"/buttons/"+o});for(a=b.contexts.length,o=0;o<a;o++)h=b.contexts[o],(this.matchItem(s,h)||s.exec(h.caption))&&n.push({key:u+"/contexts/"+o})}this.Kt.push.apply(this.Kt,n),this.Reverse&&this.Kt.reverse(),this.gotoResult(0,p),this.emit("found-results",this.Kt)}matchItem(p,t){return!!(p.exec(t.name)||p.exec(Fe(t))||this.vr&&p.exec(t.value))}gotoNext(){this.xi++,this.gotoResult(this.xi,!0)}gotoPrevious(){this.xi--,this.gotoResult(this.xi,!0)}gotoCurrent(){this.gotoResult(this.xi,!0)}gotoResult(p,t){if(this.manager.profiles.length){if(p<0&&(p=0),p>=this.Kt.length&&(p=this.Kt.length-1),this.xi=p,this.updateCount(),this.Kt.length>0){let e=this.Kt[p];this.manager.loadPage(e.key)}setTimeout(()=>{this.emit("moved",this.xi,p)},0),this.updateButtons()}}clear(){this.Kt=[],this.xi=0,this.updateButtons(),this.emit("reset")}updateButtons(){this.xi>=this.Kt.length-1?$("#"+this.id+"-find-next",this.Ue).prop("disabled",!0):$("#"+this.id+"-find-next",this.Ue).prop("disabled",!1),this.xi===0||this.Kt.length===0?$("#"+this.id+"-find-prev",this.Ue).prop("disabled",!0):$("#"+this.id+"-find-prev",this.Ue).prop("disabled",!1)}updateCount(){this.Kt.length===0?$("#"+this.id+"-find-count",this.Ue).html("<span class='find-no-results'>No Results</span>"):this.Kt.length>999?$("#"+this.id+"-find-count",this.Ue).html(this.xi+1+" of 999+"):$("#"+this.id+"-find-count",this.Ue).html(this.xi+1+" of "+this.Kt.length)}dispose(){this.Ue.remove(),window.document.removeEventListener("keyup",this.oo)}};var bi=class extends ye{constructor(){super(Object.assign({},client.getWindowState("profiles")||{center:!0},{id:"profiles",title:'<i class="fas fa-users"></i> Profiles',minWidth:550,minHeight:350}));this.il=!1;this.ws=!1;this.te={profile:null,profileName:"",item:null,parent:null,itemIdx:-1,collection:"",itemSubIdx:-1};this.ao=!1;this.Rt=!1;this._=client,this.on("resized",e=>{this.Jt(e.width),this._.setOption("windows.profiles",e)}),this.on("closed",()=>{this.persistent||(this.emit("content-changing"),this._.removeListenersFromCaller(this))}),this.on("canceled",()=>{this.persistent||(this.emit("content-changing"),this._.removeListenersFromCaller(this))}),this._.on("profiles-loaded",()=>{this.profiles||(this.profiles=this._.profiles.clone(),this.profiles.SortByPriority(),this.ni())},this),this._.on("profiles-updated",()=>{},this),this._.on("options-loaded",()=>{this.resetState(this._.getWindowState("profiles")||{center:!0})},this),this._.on("initialized",()=>{this.profiles||(this.profiles=this._.profiles.clone(),this.profiles.SortByPriority(),this.ni())},this),this._.on("item-added",(e,s,n,r)=>{this._.getOption("profiles.updateOnChange")?this.profiles.contains(s)&&this.ji(e+(e==="alias"?"es":"s"),r,this.profiles.items[s]):this.ws=!0},this),this._.on("item-removed",(e,s,n,r)=>{if(!this._.getOption("profiles.updateOnChange"))this.ws=!0;else if(this.profiles.contains(s)){let o=e+(e==="alias"?"es":"s"),a=this.profiles.items[s];if(n<0||n>=a[o].length||!a[o][n].equals(r))return;let h=`${this.Ee(s)}-${o}`,c=a[o];if(c.splice(n,1),this.pe.querySelector(`#${h}-${n}`).remove(),this.te.itemIdx===-1&&this.setBody(this.we),c.length===0)this.pe.querySelector(`#${h} i`).remove(),this.pe.querySelector(`#${h} a`).insertAdjacentHTML("afterbegin",'<i class="align-middle float-start no-icon"></i>'),this.pe.querySelector(`#${h} a`).dataset.lazy!=="true"&&(this.pe.querySelector(`#${h} .dropdown-menu`).innerHTML="");else{let g=this.pe.querySelector(`#${h} ul`),m=g.children.length,b=`#profiles/${encodeURIComponent(s)}/${o}/`;for(;n<m;n++){let u=g.children[n];u.id=`${h}-${n}`,u.firstChild.href=`${b}${n}`,u.firstChild.children[1].id=`enabled-${h}-${n}`}}this.changed=!0,h===this.ss&&this.On(!0)}},this),this._.on("item-updated",(e,s,n,r)=>{if(!this._.getOption("profiles.updateOnChange"))this.ws=!0;else if(this.profiles.contains(s)){let o=e+(e==="alias"?"es":"s"),a=this.profiles.items[s];if(n<0||n>=a[o].length)return;a[o][n]=r,this.pe.querySelector(`#enabled-${this.Ee(this.te.profileName)}-${this.te.collection}-${n}`)&&(this.pe.querySelector(`#enabled-${this.Ee(this.te.profileName)}-${this.te.collection}-${n}`).checked=r.enabled),this.te.profileName===s&&o===this.te.collection&&this.te.itemIdx===n&&this.loadPage(this.we)}},this),this.body.style.padding="10px",this.We=new je({id:"profile",parent:this.body,orientation:1,anchor:1}),this._.getOption("profiles.split")>=200&&(this.We.SplitterDistance=this._.getOption("profiles.split")),this.We.on("splitter-moved",e=>{this._.setOption("profiles.split",e)}),this.pe=this.We.panel1,this.pe.style.overflow="hidden",this.pe.style.overflowY="auto",this.Se=this.We.panel2,this.Se.style.overflow="auto",this.Se.style.padding="10px",this._.profiles&&(this.profiles=this._.profiles.clone(),this.profiles.SortByPriority(),this.ni());let t="";t+=`<button id="${this.id}-back" type="button" class="btn-sm float-start btn btn-light" title="Go back"><i class="bi bi-arrow-left"></i><span class="icon-only"> Back</span></button>`,t+='<button id="btn-profile-menu" class="btn-sm float-start btn btn-outline-secondary" type="button" aria-controls="profile-menu" title="Show menu" data-bs-toggle="dropdown" aria-expanded="false" style="margin-right: 4px;"><i class="fa-solid fa-bars"></i></button>',t+=`<ul id="${this.id}-dropdown-menu" class="dropdown-menu" style="overflow: auto;">`,t+=`<li id="${this.id}-add-profile"><a class="dropdown-item">Add profile</a></li>`,t+=`<li id="${this.id}-add-empty-profile"><a class="dropdown-item">Add empty profile</a></li>`,t+=`<li id="${this.id}-add-sep"><hr class="dropdown-divider"></li>`,t+=`<li id="${this.id}-add-alias"><a class="dropdown-item">Add alias</a></li>`,t+=`<li id="${this.id}-add-macro"><a class="dropdown-item">Add macro</a></li>`,t+=`<li id="${this.id}-add-trigger"><a class="dropdown-item">Add trigger</a></li>`,t+=`<li id="${this.id}-add-button"><a class="dropdown-item">Add button</a></li>`,t+=`<li id="${this.id}-add-sep2"><hr class="dropdown-divider"></li>`,t+=`<li id="${this.id}-add-default-buttons"><a class="dropdown-item">Add default buttons</a></li>`,t+=`<li id="${this.id}-add-default-macros"><a class="dropdown-item">Add default macros</a></li>`,t+='<li><hr class="dropdown-divider"></li>',t+=`<li id="${this.id}-export-current"><a class="dropdown-item">Export current profile</a></li>`,t+=`<li id="${this.id}-export"><a class="dropdown-item">Export profiles</a></li>`,t+=`<li id="${this.id}-import"><a class="dropdown-item">Import profiles</a></li>`,t+='<li><hr class="dropdown-divider"></li>',t+=`<li id="${this.id}-refresh"><a class="dropdown-item">Refresh</a></li>`,t+=`<li id="${this.id}-reload"><a class="dropdown-item">Reload</a></li>`,t+="</ul>",t+='<button id="btn-profile-edit-menu" class="btn-sm float-start btn btn-outline-secondary" type="button" aria-controls="edit-menu" title="Show edit menu" data-bs-toggle="dropdown" aria-expanded="false" style="margin-right: 4px;"><i class="bi bi-pencil-square"></i></button>',t+=`<ul id="${this.id}-edit-menu" class="dropdown-menu" style="overflow: auto;">`,t+=`<li id="${this.id}-find"><a class="dropdown-item">Find <span class="float-end" style="padding-left: 40px;">(Ctrl or Cmd)+F</span></a></li>`,t+=`<li id="${this.id}-find-div"><hr class="dropdown-divider"></li>`,t+=`<li id="${this.id}-cut"><a class="dropdown-item">Cut <span class="float-end" style="padding-left: 40px;">(Ctrl or Cmd)+X</span></a></li>`,t+=`<li id="${this.id}-copy"><a class="dropdown-item">Copy <span class="float-end" style="padding-left: 40px;">(Ctrl or Cmd)+C</span></a></li>`,t+=`<li id="${this.id}-paste"><a class="dropdown-item">Paste <span class="float-end" style="padding-left: 40px;">(Ctrl or Cmd)+V</span></a></li>`,t+="</ul>",t+='<span id="profile-page-buttons"></span>',t+=`<button id="${this.id}-cancel" type="button" class="btn-sm float-end btn btn-light" title="Close dialog"><i class="bi bi-x-lg"></i><span class="icon-only"> Cancel</span></button>`,t+=`<button id="${this.id}-save" type="button" class="btn-sm float-end btn btn-primary" title="Save changes" disabled><i class="bi bi-save"></i><span class="icon-only"> Save</span></button>`,t+=`<button id="${this.id}-apply" type="button" class="btn-sm float-end btn btn-secondary" title="Apply changes" disabled><i class="bi bi-check-lg"></i><span class="icon-only"> Apply</span></button>`,this.footer.id="profiles-footer",this.footer.innerHTML=t,this.footer.classList.add("dropup"),document.getElementById("btn-profile-menu").addEventListener("shown.bs.dropdown",()=>{setTimeout(()=>{let e=this.footer.querySelector("#"+this.id+"-dropdown-menu"),s=e.getBoundingClientRect();s.y<10&&(e.style.height=s.height+s.y-10+"px"),s.bottom>document.body.clientHeight-10&&(e.style.height=document.body.clientHeight-s.y-10+"px")},0)}),document.getElementById("btn-profile-menu").addEventListener("hidden.bs.dropdown",()=>{let e=this.footer.querySelector("#"+this.id+"-dropdown-menu");e.style.height=""}),this.footer.querySelector(`#${this.id}-cancel`).addEventListener("click",()=>{he(this.we),this.close()}),this.footer.querySelector(`#${this.id}-back`).addEventListener("click",()=>{this.Bn()}),this.footer.querySelector(`#${this.id}-cut`).addEventListener("click",()=>{this.sl()}),this.footer.querySelector(`#${this.id}-copy`).addEventListener("click",()=>{this.nl()}),this.footer.querySelector(`#${this.id}-paste`).addEventListener("click",()=>{this.ha()}),this.footer.querySelector(`#${this.id}-find`).addEventListener("click",()=>{this.Tt.show()}),this.on("closed",()=>{this._.setOption("windows.profiles",this.windowState),he(this.we)}),this.on("canceled",()=>{this._.setOption("windows.profiles",this.windowState),he(this.we)}),this.on("moved",e=>{this.Jt(this.dialog.offsetWidth||this.dialog.clientWidth),this._.setOption("windows.profiles",e)}),this.on("maximized",()=>{this._.setOption("windows.profiles",this.windowState)}),this.on("restored",()=>{this.Jt(this.dialog.offsetWidth||this.dialog.clientWidth),this._.setOption("windows.profiles",this.windowState)}),this.on("shown",()=>{this.Jt(this.dialog.offsetWidth||this.dialog.clientWidth),this._.setOption("windows.profiles",this.windowState)}),this.footer.querySelector(`#${this.id}-add-profile a`).addEventListener("click",()=>{this.ho(!0)}),this.footer.querySelector(`#${this.id}-add-empty-profile a`).addEventListener("click",()=>{this.ho(!1)}),this.footer.querySelector(`#${this.id}-add-alias a`).addEventListener("click",()=>{this.ji("aliases")}),this.footer.querySelector(`#${this.id}-add-macro a`).addEventListener("click",()=>{this.ji("macros")}),this.footer.querySelector(`#${this.id}-add-trigger a`).addEventListener("click",()=>{this.ji("triggers")}),this.footer.querySelector(`#${this.id}-add-button a`).addEventListener("click",()=>{this.ji("buttons")}),this.footer.querySelector(`#${this.id}-add-default-buttons a`).addEventListener("click",()=>{let e=Be.DefaultButtons,s=e.length;for(let n=0;n<s;n++)this.ji("buttons",e[n])}),this.footer.querySelector(`#${this.id}-add-default-macros a`).addEventListener("click",()=>{let e=Be.DefaultMacros,s=e.length;for(let n=0;n<s;n++)this.ji("macros",e[n])}),this.footer.querySelector(`#${this.id}-export-current a`).addEventListener("click",()=>{let e={version:2,profiles:{}};e.profiles[this.te.profileName]=this.te.profile.clone(2),fileSaveAs.show(JSON.stringify(e),`oiMUD.${this.te.profileName}.txt`,"text/plain")}),this.footer.querySelector(`#${this.id}-export a`).addEventListener("click",()=>{let e={version:2,profiles:this.profiles.clone(2)};fileSaveAs.show(JSON.stringify(e),"oiMUD.profiles.txt","text/plain")}),this.footer.querySelector(`#${this.id}-import a`).addEventListener("click",()=>{Se("Import profile(s)").then(e=>{Ee(e[0]).then(s=>{try{let n=JSON.parse(s);if(n.version==2){if(n.profiles){let r=Object.keys(n.profiles),o=0,a=r.length;for(;o<a;o++){n.profiles[r[o]].name=this.ca(r[o]);let h=Be.load(n.profiles[r[o]]);this.profiles.add(h)}if(a===0)return;this.changed=!0,this.ni(),this.expandPath(this.we)}}else setTimeout(function(){alert_box("Invalid file","Unable to import file, not a valid profile file",4)},50)}catch(n){setTimeout(function(){alert_box("Error importing","Error importing file.",3)},50),this._.error(n)}}).catch(s=>this._.error(s))}).catch(()=>{})}),this.footer.querySelector(`#${this.id}-refresh a`).addEventListener("click",()=>{this.ni(),this.setBody(this.we)}),this.footer.querySelector(`#${this.id}-reload a`).addEventListener("click",()=>{this.changed?confirm_box("Reload profiles?","Reload and lose changes?").then(e=>{e.button===4&&(this.profiles=this._.profiles.clone(),this.profiles.SortByPriority(),this.ni(),this.setBody(this.we))}):(this.profiles=this._.profiles.clone(),this.profiles.SortByPriority(),this.ni(),this.setBody(this.we))}),this.footer.querySelector(`#${this.id}-save`).addEventListener("click",()=>{if(this.Zt){this.Zt.focus();return}this.ws?confirm_box("Profiles changed","Profiles have been changed outside of manager, overwrite?",null,12).then(e=>{e.button===4&&(this.Hs(),this.close(),this.ws=!1)}):(this.Hs(),this.close())}),this.footer.querySelector(`#${this.id}-apply`).addEventListener("click",()=>{if(this.Zt){this.Zt.focus();return}this.ws?confirm_box("Profiles changed","Profiles have been changed outside of manager, overwrite?",null,12).then(e=>{e.button===4&&(this.Hs(),this.ws=!1)}):this.Hs()}),this.dialog.addEventListener("keydown",e=>{if(e.ctrlKey&&!e.shiftKey&&!e.altKey&&!e.metaKey){if(e.code==="KeyF"){let s=this.Tt.open;return this.Tt.show(),s?!0:(e.preventDefault(),e.returnValue=!1,!1)}if(document.activeElement&&(document.activeElement.nodeName==="TEXTAREA"||document.activeElement.isContentEditable||document.activeElement.nodeName==="INPUT"&&document.activeElement.type!=="checkbox"&&document.activeElement.type!=="radio"))return;if(e.code==="KeyC")return this.nl(),e.preventDefault(),e.returnValue=!1,!1;if(e.code==="KeyX")return this.sl(),e.preventDefault(),e.returnValue=!1,!1;if(e.code==="KeyV"&&this.Be)return this.ha(),e.preventDefault(),e.returnValue=!1,!1}}),this.Tt=new gi(this,this.footer),this.Tt.MatchCase=this._.getOption("profiles.find.case"),this.Tt.MatchWord=this._.getOption("profiles.find.word"),this.Tt.Reverse=this._.getOption("profiles.find.reverse"),this.Tt.RegularExpression=this._.getOption("profiles.find.regex"),this.Tt.SearchValue=this._.getOption("profiles.find.value"),this._.getOption("profiles.find.show")&&this.Tt.show(),this.Tt.on("word",()=>{this._.setOption("profiles.find.word",this.Tt.MatchWord)}),this.Tt.on("case",()=>{this._.setOption("profiles.find.case",this.Tt.MatchCase)}),this.Tt.on("reverse",()=>{this._.setOption("profiles.find.reverse",this.Tt.Reverse)}),this.Tt.on("regex",()=>{this._.setOption("profiles.find.regex",this.Tt.RegularExpression)}),this.Tt.on("value",()=>{this._.setOption("profiles.find.value",this.Tt.SearchValue)}),this.Tt.on("shown",()=>{this._.setOption("profiles.find.show",!0)}),this.Tt.on("closed",()=>{this._.setOption("profiles.find.show",!1)})}set errorField(t){this.Zt=t}get errorField(){return this.Zt}get current(){return this.te}set changed(t){t!==this.il&&(this.il=t,this.footer.querySelector(`#${this.id}-save`).disabled=!t,this.footer.querySelector(`#${this.id}-apply`).disabled=!t)}get changed(){return this.il}get contents(){return this.Se}co(t,e,s,n,r){if(!t||t.length===0)return"";let o="";r=r||0;let a=r*20+16,h=`${s+"-"+(t[e].useName?this.Ee(t[e].name.toLowerCase()):e)}`;return o+=`<li class="nav-item${this.ss===h?" cut-item":""}" title="${Pe(Fe(t[e]))}" id="${h}">`,t[e].items&&t[e].items.length?o+=`<a data-indent="${r}" data-id="${s+"-"+this.Ee(t[e].name.toLowerCase())}" data-lazy="true" style="padding-left: ${a}px" class="nav-link text-dark" href="#${n}/${encodeURIComponent(t[e].name.toLowerCase())}"><i class="align-middle float-start bi bi-chevron-right"></i> <input data-page="${n}/${encodeURIComponent(t[e].name.toLowerCase())}" type="checkbox" class="form-check-input" id="enabled-${s}-${this.Ee(t[e].name.toLowerCase())}"${t[e].enabled?" checked":""}> ${Pe(Fe(t[e]))}</a>`:t[e].useName?o+=`<a style="padding-left: ${a}px" class="nav-link text-dark " href="#${n}/${encodeURIComponent(t[e].name.toLowerCase())}"><i class="align-middle float-start no-icon"></i> <input data-page="${n}/${encodeURIComponent(t[e].name.toLowerCase())}" type="checkbox" class="form-check-input" id="enabled-${s}-${this.Ee(t[e].name.toLowerCase())}"${t[e].enabled?" checked":""}> ${Pe(Fe(t[e]))}</a>`:o+=`<a style="padding-left: ${a}px" class="nav-link text-dark" href="#${n}/${e}"><i class="align-middle float-start no-icon"></i><input type="checkbox" class="form-check-input" data-page="${n}/${e}" id="enabled-${s}-${e}"${t[e].enabled?" checked":""}> ${Pe(Fe(t[e]))}</a>`,o+="</li>",o}pa(t,e,s,n){if(!t||t.length===0)return"";let r="";for(let o=0,a=t.length;o<a;o++)r+=this.co(t,o,e,s,n);return'<ul class="dropdown-menu dropdown-inline">'+r+"</ul>"}ni(){let t="";for(let s=0,n=this.profiles.keys.length;s<n;s++)t+=this.po(this.profiles.keys[s]);this.pe.innerHTML='<ul class="nav" id="profile-menu">'+t+"</ul>";let e=this.pe.querySelectorAll("a");for(let s=0,n=e.length;s<n;s++)this.Nn(e[s])}ua(t){let e=t.getAttribute("href").split("/");if(t.dataset.type==="profile")t.insertAdjacentHTML("afterend",this.pa([{name:"Aliases",items:this.profiles.items[e[1]].aliases,useName:!0,enabled:this.profiles.items[e[1]].enableAliases},{name:"Macros",items:this.profiles.items[e[1]].macros,useName:!0,enabled:this.profiles.items[e[1]].enableMacros},{name:"Triggers",items:this.profiles.items[e[1]].triggers,useName:!0,enabled:this.profiles.items[e[1]].enableTriggers},{name:"Buttons",items:this.profiles.items[e[1]].buttons,useName:!0,enabled:this.profiles.items[e[1]].enableButtons}],this.Ee(e[1]),"profiles/"+encodeURIComponent(e[1]),1));else{let s=this.profiles.items[e[1]][e[2]];t.insertAdjacentHTML("afterend",this.pa(s,t.dataset.id,t.getAttribute("href").substring(1),+t.dataset.indent+1))}t.dataset.lazy="false",this.Nn(t.nextElementSibling)}Nn(t){let e=t.querySelectorAll(".bi-chevron-right"),s,n;for(s=0,n=e.length;s<n;s++)e[s].addEventListener("click",r=>{r.currentTarget.parentElement.dataset.lazy==="true"&&this.ua(r.currentTarget.parentElement),r.target.closest("li").querySelector(".dropdown-menu").classList.toggle("show"),r.target.classList.toggle("bi-chevron-right"),r.target.classList.toggle("bi-chevron-down"),r.preventDefault()});for(e=t.querySelectorAll("input"),s=0,n=e.length;s<n;s++)e[s].addEventListener("change",r=>{let o=r.target.dataset.page.split("/"),a=r.target.checked;switch(o.length){case 2:if(!a&&this.profiles.keys.filter(h=>this.profiles.enabled(h)).length===1){alert_box("Cannot disable","One profile must always be enabled."),r.target.checked=!0;return}this.pe.querySelector(`#enabled-${this.Ee(o[1])}`).checked=a,this.pe.querySelector(`#enabled-${this.Ee(o[1])}-switch`).checked=a,this.we===r.target.dataset.page&&(this.Se.querySelector("#enabled").checked=a),this.profiles.items[o[1]].enabled=a,this.changed=!0;break;case 3:this.pe.querySelector(`#enabled-${this.Ee(o[1])}-${o[2]}`).checked=a,this.we===`profiles/${o[1]}`&&(this.Se.querySelector("#enable"+we(o[2])).checked=a),this.profiles.items[o[1]]["enable"+we(o[2])]=a,this.changed=!0;break;case 4:this.pe.querySelector(`#enabled-${this.Ee(o[1])}-${o[2]}-${o[3]}`).checked=a,this.we===r.target.dataset.page?this.Se.querySelector("#enabled").checked=a:this.we===`profiles/${o[1]}/${o[2]}`&&(this.Se.querySelector("#check-"+o[3]).checked=a),this.profiles.items[o[1]][o[2]][+o[3]].enabled=a,this.changed=!0;break}r.stopPropagation(),r.cancelBubble=!0});for(e=t.querySelectorAll(".list-badge-button.text-bg-danger"),s=0,n=e.length;s<n;s++)e[s].addEventListener("click",r=>{this.da(r.target.parentElement.dataset.profile),r.preventDefault()});for(e=t.querySelectorAll(".list-badge-button.text-bg-light"),s=0,n=e.length;s<n;s++)e[s].addEventListener("click",r=>{this.nl({type:"profile",profileName:r.target.parentElement.dataset.profile}),r.preventDefault()});for(e=t.querySelectorAll(".list-badge-button.text-bg-warning"),s=0,n=e.length;s<n;s++)e[s].addEventListener("click",r=>{this.sl({type:"profile",profileName:r.target.parentElement.dataset.profile}),r.preventDefault()})}po(t){let e=`<li class="nav-item" data-profile="${t}" title="${we(t)}" id="${this.Ee(t)}">`;return e+=`<a data-lazy="true" data-type="profile" data-id="${this.Ee(t)}" class="nav-link text-dark" href="#profiles/${encodeURIComponent(t)}">`,t!=="default"&&(e+=`<span class="list-badge-button badge text-bg-danger" data-profile="${t}" title="Remove profile"><i class="bi bi-trash"></i></span>`),e+=`<span class="list-badge-button badge text-bg-light me-1" data-profile="${t}" title="Copy profile"><i class="bi bi-copy"></i></span>`,t!=="default"&&(e+=`<span class="list-badge-button badge text-bg-warning me-1" data-profile="${t}" title="Cut profile"><i class="bi bi-scissors"></i></span>`),e+='<i class="align-middle float-start bi bi-chevron-right"></i> ',e+=this.Eh(we(t),"enabled-"+t,this.profiles.items[t].enabled),e+="</a>",e+="</li>",e}Eh(t,e,s){return`<span><input type="checkbox" data-page="profiles/${t.toLowerCase()}" class="form-check-input" id="${this.Ee(e)}"${s?" checked":""}> ${t}</span><div class="form-check form-switch"><input type="checkbox" class="form-check-input" id="${e}-switch"${s?" checked":""}> ${t}</div>`}setBody(t,e){if(!this.profiles){setTimeout(()=>{this.setBody(t,e)},100);return}if(this.Zt){setTimeout(()=>this.Zt.focus(),100),window.location.hash=this.we;return}this.we=this.dialog.dataset.path,this.we==="profiles"?this.dialog.dataset.panel="left":this.dialog.dataset.panel="right";let s=this.we.split("/"),n,r,o;if(this.expandPath(s),this.footer.querySelector("#profile-page-buttons").innerHTML="",this.footer.querySelector(`#${this.id}-export-current`).style.display="",this.Se.scrollTop=0,!this.fa(s)){this.title=Ke(s,{small:this.Rt,sep:"/",icon:'<i class="fas fa-users" style="padding: 2px;margin-right: 2px;"></i>'}),s.length>2&&(this.We.panel2Collapsed=!1);return}if(s.length===4?this.title=Ke(s,{small:this.Rt,sep:"/",formatter:(a,h,c)=>h===c?Pe(Fe(this.te.item)):we(a),icon:'<i class="fas fa-users" style="padding: 2px;margin-right: 2px;"></i>'}):s.length===5?this.title=Ke(s,{small:this.Rt,sep:"/",formatter:(a,h,c)=>h===c?Pe(Fe(this.te.parent)):h===c-1?Pe(Fe(this.te.item)):we(a),icon:'<i class="fas fa-users" style="padding: 2px;margin-right: 2px;"></i>'}):this.title=Ke(s,{small:this.Rt,sep:"/",icon:'<i class="fas fa-users" style="padding: 2px;margin-right: 2px;"></i>'}),s.length<2?(this.footer.querySelector(`#${this.id}-export-current`).style.display="none",this.footer.querySelector(`#${this.id}-add-sep`).style.display="none",this.footer.querySelector(`#${this.id}-add-alias`).style.display="none",this.footer.querySelector(`#${this.id}-add-macro`).style.display="none",this.footer.querySelector(`#${this.id}-add-trigger`).style.display="none",this.footer.querySelector(`#${this.id}-add-button`).style.display="none",this.footer.querySelector(`#${this.id}-add-sep2`).style.display="none",this.footer.querySelector(`#${this.id}-add-default-buttons`).style.display="none",this.footer.querySelector(`#${this.id}-add-default-macros`).style.display="none",this.footer.querySelector(`#${this.id}-cut`).style.display="none",this.footer.querySelector(`#${this.id}-copy`).style.display="none",this.We.panel2Collapsed=!0,this.footer.querySelector(`#${this.id}-back`).style.display="none"):(this.footer.querySelector(`#${this.id}-add-sep`).style.display="",this.footer.querySelector(`#${this.id}-add-alias`).style.display="",this.footer.querySelector(`#${this.id}-add-macro`).style.display="",this.footer.querySelector(`#${this.id}-add-trigger`).style.display="",this.footer.querySelector(`#${this.id}-add-button`).style.display="",this.footer.querySelector(`#${this.id}-back`).style.display="",this.footer.querySelector(`#${this.id}-add-sep2`).style.display="",this.footer.querySelector(`#${this.id}-add-default-buttons`).style.display="",this.footer.querySelector(`#${this.id}-add-default-macros`).style.display="",this.footer.querySelector(`#${this.id}-cut`).style.display="",this.footer.querySelector(`#${this.id}-copy`).style.display="",this.We.panel2Collapsed=!1),this.xr(),s.length===2){if(this.Ci!=="properties")this.kr("properties").then(a=>{this.Ci="properties",this.Pt(a);let h=this.Se.querySelectorAll("input");this.Se.querySelector("#name").disabled=this.te.profileName==="default";for(let c=0,g=h.length;c<g;c++)h[c].type==="checkbox"?(h[c].checked=this.te.profile[h[c].id],h[c].addEventListener("change",m=>{let b=m.target.checked;if(m.target.id==="enabled"){if(!b&&this.profiles.keys.filter(u=>this.profiles.enabled(u)).length===1){alert_box("Cannot disable","One profile must always be enabled."),m.target.checked=!0;return}this.pe.querySelector(`#enabled-${this.Ee(this.te.profileName)}`).checked=b,this.pe.querySelector(`#enabled-${this.Ee(this.te.profileName)}-switch`).checked=b,this.we===m.target.dataset.page&&(this.Se.querySelector("#enabled").checked=b),this.profiles.items[this.te.profileName].enabled=b}else this.te.profile[m.target.id]=b,this.pe.querySelector(`#enabled-${this.Ee(this.te.profileName)}-${m.target.id.substring(6).toLowerCase()}`).checked=b,this.changed=!0;this.changed=!0})):(h[c].value=this.te.profile[h[c].id],h[c].addEventListener("change",m=>{let b=m.currentTarget||m.target;b.id==="name"?ve(()=>{let u=this.ma(b.value);u===!0?(h[c].classList.remove("is-invalid"),this.Zt=null):(h[c].classList.add("is-invalid"),this.Zt=h[c],this.Se.querySelector("#name-feedback").textContent=u),this.rl()},200,"renameProfile"):(this.te.profile[b.id]=b.value,ve(()=>this.rl(),200,"sortProfiles")),this.changed=!0}),h[c].addEventListener("input",m=>{let b=m.currentTarget||m.target;b.id==="name"?ve(()=>{let u=this.ma(b.value);u===!0?(h[c].classList.remove("is-invalid"),this.Zt=null):(h[c].classList.add("is-invalid"),this.Zt=h[c],this.Se.querySelector("#name-feedback").textContent=u),this.rl()},200,"renameProfile"):(this.te.profile[b.id]=b.value,ve(()=>this.rl(),200,"sortProfiles")),this.changed=!0}))}).catch(()=>{});else{this.Se.querySelector("#name").disabled=this.te.profileName==="default";let a=this.Se.querySelectorAll("input");for(let h=0,c=a.length;h<c;h++)a[h].type==="checkbox"?a[h].checked=this.te.profile[a[h].id]:a[h].value=this.te.profile[a[h].id]}if(this.te.profileName!=="default"){let a=`<button id="${this.id}-remove" type="button" class="btn-sm btn btn-danger" title="Remove profile"><i class="bi bi-trash"></i></button>`;this.footer.querySelector("#profile-page-buttons").innerHTML=a,this.footer.querySelector(`#${this.id}-remove`).addEventListener("click",h=>{this.Zt&&(this.Zt=null),this.da(this.te.profileName)})}this.footer.querySelector(`#${this.id}-cut`).style.display="none"}else if(s.length===3){let a="",h=`<button id="${this.id}-add" type="button" class="btn-sm float-start btn btn-outline-secondary" title="Add ${this.Yt()}"><i class="bi bi-plus-lg"></i></button>`;if(this.te.item.length===0)o='<h1 id="empty" style="width: 100%;text-align:center">No '+this.te.collection+".</h1>",o+=`<button id="${this.id}-add-contents" type="button" class="btn-sm float-start btn btn-outline-secondary" title="Add ${this.Yt()}"><i class="bi bi-plus-lg"></i> Add ${this.Yt()}</button>`,this.footer.querySelector(`#${this.id}-cut`).style.display="none",this.footer.querySelector(`#${this.id}-copy`).style.display="none",this.xr();else{for(o="",n=0,r=this.te.item.length;n<r;n++)o+=`<a data-profile ="${this.te.profileName}" id="item-${n}" data-index="${n}" href="#profiles/${encodeURIComponent(this.te.profileName)}/${this.te.collection}/${n}" class="list-group-item list-group-item-action">`,o+=`<span data-index="${n}" class="list-badge-button badge text-bg-danger"><i class="bi bi-trash" title="Remove ${this.Yt()}"></i></span>`,o+=`<span data-index="${n}" class="list-badge-button badge text-bg-light me-1" title="Copy ${this.Yt()}"><i class="bi bi-copy"></i></span>`,o+=`<span data-index="${n}" class="list-badge-button badge text-bg-warning me-1" title="Cut ${this.Yt()}"><i class="bi bi-scissors"></i></span>`,o+='<div class="form-check-inline form-switch" style="margin: 0;">',o+=`<input type="checkbox" class="form-check-input" id="check-${n}" data-profile="${this.te.profileName}" data-index="${n}" data-field="enabled" data-items="${this.te.collection}"${this.te.item[n].enabled?' checked="checked"':""}>`,o+=`</div>${Pe(Fe(this.te.item[n]))}</a>`;a=`<button id="${this.id}-add-contents" type="button" class="btn-sm btn btn-outline-secondary" title="Add ${this.Yt()}" style="margin-bottom: 5px;width:100%;"><i class="bi bi-plus-lg"></i> Add ${this.Yt()}</button>`,h=`<button id="${this.id}-remove-all" type="button" class="btn-sm float-start btn btn-danger" title="Remove all ${this.Yt()==="alias"?"aliases":this.Yt()+"s"}"><i class="bi bi-trash"></i></button>`+h}this.footer.querySelector("#profile-page-buttons").innerHTML=h,this.Pt(a+'<div class="list-group">'+o+"</div>");let c=this.Se.querySelectorAll(".list-badge-button.text-bg-danger");for(let g=0,m=c.length;g<m;g++)c[g].addEventListener("click",b=>{this.uo(+b.target.parentElement.dataset.index),b.stopPropagation(),b.cancelBubble=!0,b.preventDefault()});c=this.Se.querySelectorAll(".list-badge-button.text-bg-light,.list-badge-button.text-bg-warning");for(let g=0,m=c.length;g<m;g++)c[g].addEventListener("click",b=>{let u=+b.target.parentElement.dataset.index,E={type:this.Yt(),item:this.te.item[u],index:u,profile:this.te.profile,profileName:this.te.profileName,collection:this.te.collection};b.currentTarget.classList.contains("text-bg-warning")?this.sl(E):this.nl(E),b.stopPropagation(),b.cancelBubble=!0,b.preventDefault()});this.Ci=null,this.footer.querySelector(`#${this.id}-add`).addEventListener("click",()=>{this.ji()}),this.footer.querySelector(`#${this.id}-remove-all`)&&this.footer.querySelector(`#${this.id}-remove-all`).addEventListener("click",()=>{this.Lh()}),this.Se.querySelector(`#${this.id}-add-contents`)&&this.Se.querySelector(`#${this.id}-add-contents`).addEventListener("click",()=>{this.ji()}),c=this.Se.querySelectorAll("input");for(let g=0,m=c.length;g<m;g++)c[g].addEventListener("change",b=>{let u=b.currentTarget||b.target,E=u.checked;this.pe.querySelector(`#enabled-${this.Ee(this.te.profileName)}-${this.te.collection}-${u.dataset.index}`).checked=E,this.te.profile[this.te.collection][+u.dataset.index].enabled=E,this.changed=!0})}else if(s.length===4){let a=`<button id="${this.id}-remove" type="button" class="btn-sm btn btn-danger" title="Remove ${this.Yt()}"><i class="bi bi-trash"></i></button>`;this.footer.querySelector("#profile-page-buttons").innerHTML=a,this.footer.querySelector(`#${this.id}-remove`).addEventListener("click",h=>{this.uo(this.te.itemIdx,0,!0),h.stopPropagation(),h.cancelBubble=!0,h.preventDefault()}),this.Ci!==this.te.collection?(this.Ci=this.te.collection,this.kr(this.te.collection).then(h=>{this.Pt(h),this.Sr(!0)}).catch(()=>{})):this.Sr()}else if(s.length===5){let a=`<button id="${this.id}-remove" type="button" class="btn-sm btn btn-danger" title="Remove ${this.Yt()}"><i class="bi bi-trash"></i></button>`;this.footer.querySelector("#profile-page-buttons").innerHTML=a,this.footer.querySelector(`#${this.id}-remove`).addEventListener("click",h=>{this.uo(this.te.itemIdx,0,!0),h.stopPropagation(),h.cancelBubble=!0,h.preventDefault()}),this.Ci!==this.te.collection?(this.Ci=this.te.collection,this.kr(this.te.collection).then(h=>this.Pt(h)).catch(()=>{this.Sr(!0)})):this.Sr()}else{let a=`<button id="btn-${this.id}-add-profile" type="button" class="btn-sm btn btn-outline-secondary" title="Add profile"><i class="bi bi-plus-lg"></i></button>`;this.footer.querySelector("#profile-page-buttons").innerHTML=a,this.footer.querySelector(`#btn-${this.id}-add-profile`).addEventListener("click",()=>{this.ho(!0)}),this.Ci=null,this.Pt("")}}fa(t){if(!t)return!1;if(this.te.itemIdx=this.te.itemSubIdx=-1,this.te.parent=null,this.te.collection="",this.te.item=null,t.length>1){if(this.te.profileName=t[1],!this.profiles.contains(this.te.profileName))return this.Pt(`<h1 id="empty" style="width: 100%;text-align:center">Profile ${this.te.profileName} not found.</h1>`),this.Ci=null,!1;this.te.profile=this.profiles.items[this.te.profileName]}if(t.length>2){if(this.te.collection=t[2],!this.te.profile[this.te.collection])return this.Pt(`<h1 id="empty" style="width: 100%;text-align:center">${we(this.te.collection)} not found in ${this.te.profileName}.</h1>`),this.Ci=null,!1;this.te.item=this.te.profile[t[2]]}if(t.length>3){if(this.te.itemIdx=+t[3],isNaN(this.te.itemIdx)||this.te.itemIdx<0||this.te.itemIdx>=this.te.item.length)return this.Pt(`<h1 id="empty" style="width: 100%;text-align:center">${we(this.Yt())} not found.</h1>`),this.Ci=null,!1;this.te.item=this.te.profile[t[2]][this.te.itemIdx]}if(t.length>4){if(this.te.itemSubIdx=+t[4],!this.te.item.triggers){this.Pt('<h1 id="empty" style="width: 100%;text-align:center">Invalid trigger.</h1>'),this.Ci=null;return}if(this.te.itemSubIdx<0||this.te.itemSubIdx>=this.te.item.triggers.length){this.Pt('<h1 id="empty" style="width: 100%;text-align:center">Trigger state not found.</h1>'),this.Ci=null;return}this.te.parent=this.te.item,this.te.item=this.te.item.triggers[this.te.itemSubIdx]}return!0}kr(t){return new Promise((e,s)=>{$.ajax({url:"dialogs/profiles-"+t+".htm",cache:!1,type:"GET"}).done(n=>{n=n.replace(/{profileURL}/g,encodeURIComponent(this.te.profileName)).replace(/{profile}/g,this.te.profileName),e(n)}).fail(function(){s("")})})}Pt(t){this.Se.innerHTML=t;let e=this.Se.querySelectorAll("script"),s={client,item:this.te.item,FilterArrayByKeyValue:bt,keyCharToCode:os,profile:this.te.profile,profileName:this.te.profileName,parent:this.te.parent,current:this.te,GetDisplay:Fe,Trigger:Te,debounce:ve,updateHash:He,DialogButtons:Tt};this.emit("content-changing");for(let n=0,r=e.length;n<r;n++)new Function("body","dialog",...Object.keys(s),"try { "+e[n].textContent+"}catch(e){this._client.error(e)}").apply(client,[this.Se,this,...Object.values(s),this]);this.emit("content-changed")}Sr(t){let e=this.Se.querySelectorAll("input,select,textarea");for(let s=0,n=e.length;s<n;s++)if(!(!(e[s].id in this.te.item)&&e[s].dataset.enum!=="true"))if(e[s].type==="checkbox"){if(e[s].dataset.enum==="true"){let r=e[s].name||e[s].id.substring(0,e[s].id.lastIndexOf("-")),o=+e[s].id.substring(e[s].id.lastIndexOf("-")+1);e[s].checked=(this.te.item[r]&o)===o}else e[s].checked=this.te.item[e[s].id];t&&e[s].addEventListener("change",r=>{let o=r.currentTarget||r.target;if(o.style.display!=="none"){if(o.dataset.enum==="true"){let a=o.name||o.id.substring(0,o.id.lastIndexOf("-")),h=this.body.querySelectorAll(`[name=${a}]`),c=0;for(let g=0,m=h.length;g<m;g++)h[g].checked&&(c|=+h[g].value);this.te.item[a]=c}else this.te.item[o.id]=o.checked||!1,o.id==="enabled"&&(this.pe.querySelector(`#enabled-${this.Ee(this.te.profileName)}-${this.te.collection}-${this.te.itemIdx}`).checked=this.te.item[o.id]);this.changed=!0,this.ll()}})}else{e[s].value=this.te.item[e[s].id],t&&(e[s].addEventListener("change",o=>{let a=o.currentTarget||o.target;a.style.display==="none"&&!a.required||(this.setValue(this.te.item,a.id,a.value),this.changed=!0,this.ll())}),e[s].addEventListener("input",o=>{let a=o.currentTarget||o.target;a.style.display==="none"&&!a.required||(this.setValue(this.te.item,a.id,a.value),this.changed=!0,this.ll())}));let r=this.changed;e[s].dispatchEvent(new Event("change")),this.changed=r}this.emit("item-loaded",this.te)}ll(t,e,s,n){e=e||this.te.profileName,s=s||this.te.collection,typeof n!="number"&&(n=this.te.itemIdx);let r=this.te.parent;t=t||this.te.item,ve(()=>{let o=this.body.querySelector(`#${this.Ee(e)}-${s}-${n}`);if(!o)return;let a;a=Fe(r||t),o.title=a,o.firstChild.childNodes[2].textContent=" "+a;let h=this.header.querySelector("ol").children;h.length>4&&(h[4].children.length?h[4].children[0].textContent=a:h[4].textContent=a),h.length>5&&(h[5].textContent=Fe(t))},200,"updateItemMenu")}expandPath(t,e){Array.isArray(t)||(t=t.split("/"));let s,n,r,o=0;t[0]==="profiles"&&(o=1);let a=t.length-1;for(let h=o,c=t.length;h<c;h++)if(s=this.Ee(t.slice(o,h+1).join("-")),n=document.getElementById(s),!!n)if(h===a)setTimeout(()=>{let g=this.pe.querySelectorAll(".active");for(let m=0,b=g.length;m<b;m++)g[m].classList.remove("active");pt(this.pe,n),n.classList.add("active"),e&&n.firstChild.click()},100);else{if(r=n.querySelector(".dropdown-menu"),!r){if(r=n.querySelector('[data-lazy="true"]'),!r)return;this.ua(r),r=n.querySelector(".dropdown-menu")}if(!r||r.classList.contains("show"))continue;n=n.querySelector("i.bi-chevron-right")||n.querySelector("i.bi-chevron-down"),n&&(n.closest("li").querySelector(".dropdown-menu").classList.toggle("show"),n.classList.toggle("bi-chevron-right"),n.classList.toggle("bi-chevron-down"))}}Bn(){if(this.Zt){this.Zt.focus();return}let t=this.we.split("/");t.length===5?this.loadPage(t.slice(0,t.length-2).join("/")):this.loadPage(t.slice(0,t.length-1).join("/"))}ho(t){let e=this.profiles.length,s="NewProfile"+e;for(;this.profiles.contains(s);)e++,s="NewProfile"+e;let n=new Be(s,t);s=s.toLowerCase(),this.profiles.add(n),this.profiles.SortByPriority();let r=this.po(s);e=this.profiles.keys.indexOf(s);let o=document.getElementById("profile-menu");(e===-1||e>=o.children.length)&&(e=o.children.length-1),e<0&&(e=0),o.children[e].insertAdjacentHTML("afterend",r),this.Nn(o.children[e+1]),this.changed=!0,this.loadPage("profiles/"+s)}da(t){if(!t)return!1;confirm_box("Remove profile?",`Delete "${t}"?`).then(e=>{e.button===4&&(this.profiles.remove(t),this.pe.querySelector("#"+t).remove(),this.we.startsWith("profiles/"+t)&&this.loadPage("profiles"),this.changed=!0)})}ma(t,e){if(!t)return"Name can not be empty!";if(e=(e||this.te.profileName).toLowerCase(),t=t.toLowerCase(),t===e)return!0;if(this.profiles.contains(t))return"A profile named "+t+" already exists!";this.profiles.remove(e),this.te.profile.name=t,this.te.profileName=t,this.profiles.add(this.te.profile);let s=this.Ee(e),n=this.Ee(t),r;return r=this.body.querySelector(`#${s} a`),r.children[2].childNodes[1].textContent=" "+we(t),document.querySelector(`#${s} a`).children[3].childNodes[1].textContent=" "+we(t),r=this.body.querySelector(`#${s}`),r.id=n,r.title=t,this.ga(this.pe.firstChild,e,t),this.ga(this.Se,e,t),this.header.querySelector("ol").children[2].textContent=we(t),!0}ga(t,e,s){let n,r,o,a=this.Ee(e),h=this.Ee(s);for(n=t.querySelectorAll(`[id*="-${a}-"]`),r=0,o=n.length;r<o;r++)n[r].id=n[r].id.replace(`-${a}-`,`-${h}-`);for(n=t.querySelectorAll(`[id$="-${a}"]`),r=0,o=n.length;r<o;r++)n[r].id=n[r].id.replace(`-${a}`,`-${h}`);for(n=t.querySelectorAll(`[id^="${a}-"]`),r=0,o=n.length;r<o;r++)n[r].id=n[r].id.replace(`${a}-`,`${h}-`);for(n=t.querySelectorAll(`[data-profile="${a}"]`),r=0,o=n.length;r<o;r++)n[r].dataset.profile=h;let c=encodeURIComponent(e),g=encodeURIComponent(s);for(n=t.querySelectorAll(`[href*="/${c}/"]`),r=0,o=n.length;r<o;r++)n[r].href=n[r].getAttribute("href").replace(`/${c}/`,`/${g}/`);for(n=t.querySelectorAll(`[href$="/${c}"]`),r=0,o=n.length;r<o;r++)n[r].href=n[r].getAttribute("href").replace(`/${c}`,`/${g}`);for(n=t.querySelectorAll(`[href^="${c}/"]`),r=0,o=n.length;r<o;r++)n[r].href=n[r].getAttribute("href").replace(`${c}/`,`${g}/`);for(n=t.querySelectorAll(`[data-path*="/${c}/"]`),r=0,o=n.length;r<o;r++)n[r].dataset.path=n[r].dataset.path.replace(`/${c}`,`/${g}`);for(n=t.querySelectorAll(`[data-page*="/${c}/"]`),r=0,o=n.length;r<o;r++)n[r].dataset.page=n[r].dataset.page.replace(`/${c}/`,`/${g}/`);for(n=t.querySelectorAll(`[data-page$="/${c}"]`),r=0,o=n.length;r<o;r++)n[r].dataset.page=n[r].dataset.page.replace(`/${c}`,`/${g}`)}rl(){this.profiles.SortByPriority();let t=this.pe.firstChild,e=Array.from(t.children);e.sort((s,n)=>{let r=this.profiles.items[s.dataset.profile].priority,o=this.profiles.items[n.dataset.profile].priority;return r>o?-1:r<o?1:s.dataset.profile==="default"?-1:n.dataset.profile==="default"||(r=s.dataset.profile,o=n.dataset.profile,r>o)?1:r<o?-1:0}),e.forEach(s=>t.appendChild(s))}Hs(){return this.changed?this.Zt?(this.Zt.focus(),!1):(this.profiles.save().then(()=>{this._.loadProfiles().then(()=>{})}),this.changed=!1,!0):!0}close(){this.ao?super.close():this.ws?confirm_box("Profiles changed","Profiles have been changed outside of manager, overwrite?",null,12).then(t=>{t.button===4&&(this.ws=!1,this.close())}):this.Ih().then(t=>{t&&!this.Hs()||(this.ao=!0,this.close())}).catch(()=>{this.ao=!1})}reload(){this.fa(this.we.split("/"))&&(this.Sr(),this.ll())}Ih(){return new Promise((t,e)=>{this.il?confirm_box("Save changes?","Save changes to profiles?",null,14).then(s=>{s.button===4?t(!0):s.button===8?t(!1):e()}).catch(s=>{e()}):t(!0)})}Ee(t){return t.toLowerCase().replace(/[^a-z0-9:.-]+/gi,"_")}Yt(t){if(t=t||this.te.collection,!!t)return t==="aliases"?"alias":t.substring(0,t.length-1)}ji(t,e,s){if(t||(t=this.te.collection),!t)return;s||(s=this.te.profile);let n=s.name.toLowerCase(),r=s[t].length,o;e||(t==="aliases"?e=new it:t==="triggers"?e=new Te:t==="buttons"?e=new ke:t==="macros"?e=new dt:t==="context"&&(e=new vt)),s[t].push(e);let a=this.pe.querySelector(`#${this.Ee(n)}-${t}`);if(a)if(r===0){o=this.co([{name:we(t),items:s[t],useName:!0,enabled:s[t]}],0,this.Ee(n),"profiles/"+encodeURIComponent(n),1);let h=document.createElement("div");h.innerHTML=o,a.replaceWith?a.replaceWith(h.firstChild):a.replaceChild?a.parentNode.replaceChild(h.firstChild,a):a.outerHTML=o,a=this.pe.querySelector(`#${this.Ee(n)}-${t}`),this.Nn(a)}else o=this.co(s[t],r,`${this.Ee(n)}-${t}`,`profiles/${encodeURIComponent(n)}/${t}`,2),a.firstChild.dataset.lazy!=="true"&&(a=a.querySelector("ul"),a.insertAdjacentHTML("beforeend",o),a=this.pe.querySelector(`#${this.Ee(n)}-${t}`),this.Nn(a.lastChild));this.loadPage(`profiles/${encodeURIComponent(n)}/${t}/${r}`),this.changed=!0}uo(t,e,s,n){if(e||(e=this.te.collection),!e)return;n||(n=this.te.profile);let r=n.name.toLowerCase();confirm_box(`Remove ${this.Yt()}?`,`Delete ${this.Yt()}?`).then(o=>{if(o.button===4){let a=`${this.Ee(r)}-${e}`,h=n[e];if(h.splice(t,1),this.pe.querySelector(`#${a}-${t}`).remove(),this.te.itemIdx===-1&&this.setBody(this.we),h.length===0)this.pe.querySelector(`#${a} i`).remove(),this.pe.querySelector(`#${a} a`).insertAdjacentHTML("afterbegin",'<i class="align-middle float-start no-icon"></i>'),this.pe.querySelector(`#${a} a`).dataset.lazy!=="true"&&(this.pe.querySelector(`#${a} .dropdown-menu`).innerHTML="");else{let c=this.pe.querySelector(`#${a} ul`),g=c.children.length,m=`#profiles/${encodeURIComponent(r)}/${e}/`;for(;t<g;t++){let b=c.children[t];b.id=`${a}-${t}`,b.firstChild.href=`${m}${t}`,b.firstChild.children[1].id=`enabled-${a}-${t}`}}this.changed=!0,s&&this.Bn(),a===this.ss&&this.On(!0)}})}Lh(t,e,s){if(t||(t=this.te.collection),!t)return;s||(s=this.te.profile);let n=s.name.toLowerCase(),r=this.Yt();r+=r==="alias"?"es":"s",confirm_box(`Remove all ${r}?`,`Delete all ${r}?`).then(o=>{if(o.button===4){let a=`${this.Ee(n)}-${t}`;s[t]=[],this.setBody(this.we),this.pe.querySelector(`#${a} i`).remove(),this.pe.querySelector(`#${a} a`).insertAdjacentHTML("afterbegin",'<i class="align-middle float-start no-icon"></i>'),this.pe.querySelector(`#${a} a`).dataset.lazy!=="true"&&(this.pe.querySelector(`#${a} .dropdown-menu`).innerHTML=""),this.changed=!0,e&&this.Bn(),a===this.ss&&this.On(!0)}})}On(t){this.Be&&this.Be.action===0&&this.body.querySelectorAll(".cut-item").forEach(s=>s.classList.remove("cut-item")),t&&(this.Be=null,this.ss=null,this.xr())}nl(t){this.On(),this.Be=t||this.ba(),this.Be.action=1,this.xr()}sl(t){this.On(),this.Be=t||this.ba(),this.Be.action=0,this.xr(),this.Be.type.endsWith("s")&&!this.Be.collection?this.ss=`${this.Ee(this.Be.profileName)}-${this.Be.type}`:this.Be.type==="profile"?this.ss=`${this.Ee(this.Be.profileName)}`:this.ss=`${this.Ee(this.Be.profileName)}-${this.Be.type==="alias"?"aliase":this.Be.type}s-${this.Be.index}`,this.body.querySelector("#"+this.ss)&&this.body.querySelector("#"+this.ss).classList.add("cut-item")}ba(){let t={type:"profile",profileName:this.te.profileName};return this.te.itemIdx!=-1?(t.type=this.Yt(),t.item=this.te.itemSubIdx!==-1?this.te.parent:this.te.item,t.index=this.te.itemIdx,t.profile=this.te.profile,t.collection=this.te.collection):this.te.collection.length&&(t.type=this.te.collection,t.items=this.te.item,t.profile=this.te.profile),t}ha(){let t,e,s;if(this.Be&&!(this.Be.profileName===this.te.profileName&&this.Be.action===0)){if(this.Be.type.endsWith("s")&&!this.Be.collection){let n=this.Be.items;for(t=0,e=n.length;t<e;t++)s=n[t].clone(),s.profile=this.te.profile,this.ji(this.Be.type,s);if(this.Be.action===0){let r=`${this.Ee(this.Be.profileName)}-${this.Be.type}`;this.Be.profile[this.Be.type]=[],this.setBody(this.we),this.pe.querySelector(`#${r} i`).remove(),this.pe.querySelector(`#${r} a`).insertAdjacentHTML("afterbegin",'<i class="align-middle float-start no-icon"></i>'),this.pe.querySelector(`#${r} a`).dataset.lazy!=="true"&&(this.pe.querySelector(`#${r} .dropdown-menu`).innerHTML="")}}else if(this.Be.type==="profile"){if(this.profiles.contains(this.Be.profileName)){let n=this.profiles.items[this.Be.profileName].clone();n.name=this.ca(n.name);let r=n.name.toLowerCase();this.profiles.add(n),this.profiles.SortByPriority();let o=this.po(r);t=this.profiles.keys.indexOf(r);let a=document.getElementById("profile-menu");(t===-1||t>=a.children.length)&&(t=a.children.length-1),t<0&&(t=0),a.children[t].insertAdjacentHTML("afterend",o),this.Nn(a.children[t+1])}}else if(this.Be.action===1?s=this.Be.item.clone():s=this.Be.item,s.profile=this.te.profile,this.ji(this.Be.collection,s),this.Be.action===0){let n=`${this.Ee(this.Be.profileName)}-${this.Be.collection}`,r=this.Be.profile[this.Be.collection];if(r.splice(this.Be.index,1),this.pe.querySelector(`#${n}-${this.Be.index}`).remove(),this.setBody(this.we),r.length===0)this.pe.querySelector(`#${n} i`).remove(),this.pe.querySelector(`#${n} a`).insertAdjacentHTML("afterbegin",'<i class="align-middle float-start no-icon"></i>'),this.pe.querySelector(`#${n} a`).dataset.lazy!=="true"&&(this.pe.querySelector(`#${n} .dropdown-menu`).innerHTML="");else{let o=this.pe.querySelector(`#${n} ul`),a=o.children.length,h=`#profiles/${encodeURIComponent(this.Be.profileName)}/${this.Be.collection}/`,c=this.Be.index;for(;c<a;c++){let g=o.children[c];g.id=`${n}-${c}`,g.firstChild.href=`${h}${c}`,g.firstChild.children[1].id=`enabled-${n}-${c}`}}}this.changed=!0,this.Be.action===0&&this.On(!0)}}xr(){this.footer.querySelector(`#${this.id}-paste`).style.display=this.Be&&(this.Be.action===1||this.Be.profileName!==this.te.profileName||this.Be.type==="profile")?"":"none",this.footer.querySelector(`#${this.id}-find-div`).style.display=this.footer.querySelector(`#${this.id}-paste`).style.display==="none"&&this.footer.querySelector(`#${this.id}-cut`).style.display==="none"&&this.footer.querySelector(`#${this.id}-copy`).style.display==="none"?"none":""}setValue(t,e,s){s=="false"&&(s=!1),s=="true"&&(s=!0),s=="null"&&(s=null),s=="undefined"&&(s=void 0),typeof s=="string"&&parseFloat(s).toString()==s&&(s=parseFloat(s)),t[e]=this.convertType(s,typeof t[e])}convertType(t,e){if(typeof t===e)return t;switch(e){case"number":return typeof t=="string"&&parseFloat(t).toString()==t?parseFloat(t):Number(t);case"boolean":return!!t;case"string":return""+t}return t}Jt(t){if(!this.header.querySelector(".breadcrumb")){setTimeout(()=>{this.Jt(t)},10);return}if(t<430){if(this.Rt)return;this.header.querySelector(".breadcrumb").classList.add("breadcrumb-sm"),this.Rt=!0}else this.Rt&&(this.header.querySelector(".breadcrumb").classList.remove("breadcrumb-sm"),this.Rt=!1)}ca(t){let e=t,s=0;for(;this.profiles.contains(e);)s===0?e=t+" Copy":e=t+" Copy ("+s+")",s++;return e}loadPage(t){He(t,this.we)}};function Fe(f){return f?f.displaytype===1?new Function("item","keyCodeToChar","MacroDisplay",f.display)(f,Ut,It):$.isFunction(f.display)?f.display(f):$.isFunction(f[f.display])?f[f.display](f):f[f.display]?f[f.display]:f.name:""}var wi=class extends ye{constructor(){super(Object.assign({},client.getWindowState("help")||{center:!0},{title:'<ol class="float-start breadcrumb"><li class="breadcrumb-icon"><i class="bi bi-question-circle" style="margin-right: 2px;"></i></li><li class="breadcrumb-item active">Help</li></ol>',minWidth:410,noFooter:!0}));this.Rt=!1;this.Qt=[];this.te=0;this._=client,this.on("resized",e=>{this.Jt(e.width),ve(()=>{this.We.panel1.parentElement.style.top=t.offsetHeight+"px"},25,"help-resize"),this._.setOption("windows.help",e)}),this._.on("options-loaded",()=>{this.resetState(this._.getWindowState("help")||{center:!0})}),this.on("closed",()=>{this._.setOption("windows.help",this.windowState),this.Pt(""),he(this.we),delete this.xs,this.xs=null}),this.on("canceled",()=>{this._.setOption("windows.help",this.windowState),he(this.we),delete this.xs,this.xs=null}),this.on("moved",e=>{this.Jt(this.dialog.offsetWidth||this.dialog.clientWidth),this._.setOption("windows.help",e)}),this.on("maximized",()=>{this._.setOption("windows.help",this.windowState)}),this.on("restored",()=>{this.Jt(this.dialog.offsetWidth||this.dialog.clientWidth),this._.setOption("windows.help",this.windowState),this.We.panel1.parentElement.style.top=t.offsetHeight+"px"}),this.on("shown",()=>{this.Jt(this.dialog.offsetWidth||this.dialog.clientWidth),this._.setOption("windows.help",this.windowState),this.We.panel1.parentElement.style.top=t.offsetHeight+"px"}),this.body.style.padding="10px",this.We=new je({id:"help",parent:this.body,orientation:1,anchor:1}),this._.getOption("help.split")>=200&&(this.We.SplitterDistance=this._.getOption("help.split")),this.We.on("splitter-moved",e=>{this._.setOption("help.split",e)}),this.pe=this.We.panel1,this.pe.style.overflow="hidden",this.pe.style.overflowY="auto",this.Se=document.createElement("iframe"),this.Se.src="about:blank",this.Se.addEventListener("load",()=>{this.Se.contentWindow.document.body.onclick=()=>{this.focus(),vi()};let e=this.Se.contentWindow.document.createElement("script");e.addEventListener("load",()=>{this.xs=this.Se.contentWindow.markdownit({html:!0,typographer:!0});let s=this.xs.renderer.rules.link_open||function(n,r,o,a,h){return h.renderToken(n,r,o)};this.xs.renderer.rules.link_open=(n,r,o,a,h)=>{let c=n[r].attrGet("href");return c&&(c.startsWith("https:")||c.startsWith("http:")||c.startsWith("mailto:")?n[r].attrPush(["target","_blank"]):(n[r].attrs[n[r].attrIndex("href")][1]="#",n[r].attrPush(["onclick",`event.preventDefault();openLink('${c}', 1);return false;`]))),s(n,r,o,a,h)}}),e.setAttribute("src","https://cdn.jsdelivr.net/npm/markdown-it@14.1.0/dist/markdown-it.min.js"),e.setAttribute("type","text/javascript"),this.Se.contentWindow.document.querySelector("head").appendChild(e),e=this.Se.contentWindow.document.createElement("link"),e.setAttribute("href","https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"),e.setAttribute("rel","stylesheet"),this.Se.contentWindow.document.querySelector("head").appendChild(e),this.Se.contentWindow.document.openLink=(s,n)=>{this.fo=document.querySelector("#help-jump-menu option:checked"),s.startsWith("docs/")?s=s.substr(5):n&&(s=this.ol+s),s=s.split("#"),s=s[0].substr(0,s[0].length-3),He("help/"+s,this.we)},this.Se.contentWindow.document.body.style.margin="10px"}),this.Se.classList.add("full-page"),this.Se.style.backgroundColor="white",this.We.panel2.append(this.Se);let t=document.createElement("nav");t.id="help-toolbar",t.classList.add("navbar","bg-light","align-items-center"),t.innerHTML='<form class="container-fluid justify-content-start"><div class="btn-group me-2 mb-1" role="group" aria-label="History navigation"><button id="btn-help-back" type="button" class="btn btn-sm btn-outline-secondary" title="Back" disabled><i class="bi bi-arrow-left"></i></button><button id="btn-help-forward" type="button" class="btn btn-sm btn-outline-secondary" title="Forward" disabled><i class="bi bi-arrow-right"></i></button><button id="btn-help-history" type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false" disabled><span class="visually-hidden">Toggle Dropdown</span></button><ul class="dropdown-menu" id="help-history-menu"></ul></div><select id="help-jump-menu" class="form-select form-select-sm mb-1" title="Select help topic"></select></form>',this.body.appendChild(t),t.querySelector("#help-jump-menu").addEventListener("change",e=>{let s=t.querySelector("#help-jump-menu").value;!s||!s.length?s=this.fo?this.fo.value:"":this.mo("help/"+s),!s||!s.length?He("help",this.we):He("help/"+s,this.we)}),t.querySelector("#btn-help-back").addEventListener("click",()=>this.ya(-1)),t.querySelector("#btn-help-forward").addEventListener("click",()=>this.ya(1)),t.querySelector("#btn-help-history").addEventListener("show.bs.dropdown",()=>{let e="",s=document.getElementById("help-history-menu"),n=this.Qt;for(let o=0,a=n.length;o<a;o++)e+=`<li id="help-history-item-${o}"><a data-index="${o}" class="dropdown-item${o===this.te?" active":""}" href="#${n[o]}">${t.querySelector(`#help-jump-menu option[value="${n[o].substring(5)}"]`).textContent.trim()}</a></li>`;s.innerHTML=e;let r=document.querySelectorAll('[id^="help-history-item"] a');for(let o=0,a=r.length;o<a;o++)r[o].addEventListener("click",h=>{this.te=+h.currentTarget.dataset.index})}),t.querySelector("#btn-help-history").addEventListener("shown.bs.dropdown",()=>{setTimeout(()=>{let e=t.querySelector("#help-history-menu"),s=e.getBoundingClientRect();s.height>this.body.clientHeight-50&&s.height>150&&(this.body.clientHeight-50<150?e.style.height="150px":e.style.height=this.body.clientHeight-50+"px")},0)}),t.querySelector("#btn-help-history").addEventListener("hidden.bs.dropdown",function(){let e=t.querySelector("#help-history-menu");e.style.height=""}),this.We.panel1.parentElement.style.top=t.offsetHeight+"px",this.We.panel2Collapsed=location.hash.indexOf("help-")===-1,this.ni()}setBody(t,e){if(!this.vs){setTimeout(()=>{this.setBody(t,e)},10);return}if(this.we===this.dialog.dataset.path)return;this.we=this.dialog.dataset.path,this.we==="help"?this.dialog.dataset.panel="left":this.dialog.dataset.panel="right";let s=this.we.split("/");(!this.Qt.length||this.Qt[this.te]!==this.we)&&this.mo(this.we),this.Ch(s),this.body.querySelector("#help-jump-menu").value=s.slice(1).join("/"),this.title=Ke(s,{small:this.Rt,sep:"/",icon:'<i class="bi bi-question-circle" style="margin-right: 2px;"></i>',formatter:(n,r)=>{if(r===0)return we(n);let o=this.vs.findIndex(c=>c.id===s[1]);if(o===-1||!this.vs[o])return n;if(r===1||!this.vs[o].nodes)return this.vs[o].text;let a=s.slice(1,r+1).join("/"),h=this.vs[o].nodes.findIndex(c=>c.id===a);return h===-1?n:this.vs[o].nodes[h].text}}),this.We.panel2Collapsed=s.length<2,this.We.panel2Collapsed?(this.Pt(""),this.ol=""):(s.length<3?this.ol="":this.ol=s.slice(1,s.length-1).join("/")+"/",this.kr(s.slice(1).join("/")).then(n=>this.Pt(n)).catch(()=>this.Pt('<h1 id="empty" style="width: 100%;text-align:center">Help not found for: '+s[s.length-1]+".</h1>")))}Pt(t){if(!this.Se.contentWindow||!this.xs){setTimeout(()=>{this.Pt(t)},10);return}this.Se.contentWindow.document.body.innerHTML=this.xs.render(t),this.Se.contentWindow.scroll(0,0),this.emit("content-changed")}Ee(t){return t.toLowerCase().replace(/[^a-z0-9:.-]+/gi,"_")}Ch(t,e){Array.isArray(t)||(t=t.split("/"));let s,n,r,o=0;t[0]==="help"&&(o=1);let a=t.length-1;for(let h=o,c=t.length;h<c;h++)if(s=this.Ee(t.slice(o,h+1).join("/")),n=document.getElementById(s),!!n)if(h===a)setTimeout(()=>{let g=this.pe.querySelectorAll(".active");for(let m=0,b=g.length;m<b;m++)g[m].classList.remove("active");pt(this.pe,n),n.classList.add("active"),e&&n.firstChild.click()},100);else{if(r=n.querySelector(".dropdown-menu"),!r||r.classList.contains("show"))continue;n=n.querySelector("i"),n&&(n.closest("li").querySelector(".dropdown-menu").classList.toggle("show"),n.classList.toggle("bi-chevron-right"),n.classList.toggle("bi-chevron-down"))}}kr(t){return new Promise((e,s)=>{$.ajax({url:"docs/"+t+".md",cache:!1,type:"GET"}).done(e).fail(s)})}wa(t,e){let s="";e=e||0;let n=e*20+16;if(e++,s+=`<li class="nav-item" title="${t.text}" id="${this.Ee(t.id)}">`,t.nodes&&t.nodes.length){s+=`<a data-id="help/${t.id}" style="padding-left: ${n}px" class="nav-link text-dark" href="#help/${t.id}"><i class="align-middle float-start bi bi-chevron-right"></i> ${t.text}</a>`,s+='<ul class="dropdown-menu dropdown-inline">';for(let r=0,o=t.nodes.length;r<o;r++)s+=this.wa(t.nodes[r],e);s+="</ul>"}else s+=`<a data-id="help/${t.id}" style="padding-left: ${n}px" class="nav-link text-dark" href="#help/${t.id}"><i class="align-middle float-start no-icon"></i> ${t.text}</a>`;return s+="</li>",s}Th(t){let e=t.querySelectorAll(".bi-chevron-right"),s,n;for(s=0,n=e.length;s<n;s++)e[s].addEventListener("click",r=>{r.target.closest("li").querySelector(".dropdown-menu").classList.toggle("show"),r.target.classList.toggle("bi-chevron-right"),r.target.classList.toggle("bi-chevron-down"),r.preventDefault()})}ni(){this.vs||$.ajax({url:"docs/menu.json",cache:!1,type:"GET",dataType:"json"}).done(t=>{this.vs=t;let e="";for(let r=0,o=t.length;r<o;r++)e+=this.wa(t[r]);this.pe.innerHTML='<ul class="nav" id="help-menu">'+e+"</ul>";let s=this.pe.querySelectorAll("a");for(let r=0,o=s.length;r<o;r++)this.Th(s[r]),s[r].addEventListener("click",a=>{(!this.Qt.length||this.Qt[this.te]!==a.currentTarget.dataset.id)&&this.mo(a.currentTarget.dataset.id)});let n=['<option value="">Table of contents</option>'];for(let r=0;r<t.length;r++)if(n.push('<option value="',t[r].id,'">',t[r].text,"</option>"),t[r].nodes&&t[r].nodes.length)for(let o=0;o<t[r].nodes.length;o++)n.push('<option value="',t[r].nodes[o].id,'">&nbsp;&nbsp;&nbsp;&nbsp;',t[r].nodes[o].text,"</option>");this.body.querySelector("#help-jump-menu").innerHTML=n.join("")}).fail(t=>this._.error(t))}va(){this.te===0||this.Qt.length===0?this.body.querySelector("#btn-help-back").disabled=!0:this.body.querySelector("#btn-help-back").disabled=!1,this.te===this.Qt.length-1||this.Qt.length===0?this.body.querySelector("#btn-help-forward").disabled=!0:this.body.querySelector("#btn-help-forward").disabled=!1,this.body.querySelector("#btn-help-history").disabled=this.Qt.length<=1}ya(t){this.te+=t,this.te<0&&(this.te=0),this.te>=this.Qt.length&&(this.te=this.Qt.length),this.va(),this.body.querySelector("#help-jump-menu").value=this.Qt[this.te],He(this.Qt[this.te],this.we)}mo(t){this.Qt.length!==0&&(this.Qt.length=this.te+1),this.Qt.push(t),this.te=this.Qt.length-1,this.va()}Jt(t){if(!this.header.querySelector(".breadcrumb")){setTimeout(()=>{this.Jt(t)},10);return}if(t<430){if(this.Rt)return;this.header.querySelector(".breadcrumb").classList.add("breadcrumb-sm"),this.Rt=!0}else this.Rt&&(this.header.querySelector(".breadcrumb").classList.remove("breadcrumb-sm"),this.Rt=!1)}};var xi=class f extends me{constructor(t,e){super();this.pn=()=>{window.removeEventListener("click",this.pn),window.removeEventListener("mousedown",this.xa),window.removeEventListener("keydown",this.pn),this.pe&&this.pe.remove()};this.xa=t=>{this.pe.contains(t.srcElement)||this.pn()};this.Dn=t||[],this.Fe=e||new Date().getTime(),this.Mh()}Mh(){if(!this.pe){let e=`<ul id="${this.Fe}" class="dropdown-menu show">`;for(let s=0,n=this.Dn.length;s<n;s++)e+=`<li><a class="dropdown-item" data-index="${s}" href="#">${this.Dn[s].name}</a></li>`;e+="</ul>",document.body.insertAdjacentHTML("afterend",e),this.pe=document.getElementById(this.Fe)}let t=this.pe.querySelectorAll("li a");for(let e=0,s=t.length;e<s;e++)t[e].addEventListener("click",n=>{let r=+n.currentTarget.dataset.index;typeof this.Dn[r].action=="function"&&this.Dn[r].action(this.Dn[e],n),this.pn()})}close(){this.pn()}show(t,e){this.pe.style.left=t+"px",this.pe.style.top=e+"px",this.pe.style.display="block",this.pe.style.position="absolute",setTimeout(()=>{window.addEventListener("click",this.pn),window.addEventListener("mousedown",this.xa),window.addEventListener("keydown",this.pn)},100)}static popup(t,e,s){new f(t).show(e,s)}};var ae,re,Vi=-1,Ts="",Ms="",Rs="",Ne;function pn(f){confirm_box("Open?",`Open '${f}'?`).then(p=>{p.button===4&&(window.open(f),client.getOption("CommandonClick")&&client.commandInput.focus())})}function un(f,p){p.startsWith("OoMUD://")||p.startsWith("jiMUD://")||p.startsWith("client://")?Ns(0,f,p.substring(8)):confirm_box("Open?",`Open '${p}'?`).then(t=>{t.button===4&&(window.open(p),client.getOption("CommandonClick")&&client.commandInput.focus())})}function Ns(f,p,t,e,s){let n=p.querySelector("img[ismap]"),r="";if(n){let o=ls(n),a=Math.floor(f.clientX-o.left),h=Math.floor(f.clientY-o.top);r="?"+a+","+h}if(t.constructor===Array||t.__proto__.constructor===Array||Object.prototype.toString.call(t)==="[object Array]"){let o=[];for(let a=0,h=t.length;a<h;a++)t[a]=t[a].replace("&text;",p.textContent),a<s.length?o.push({name:s[a],action:c=>Ki(c.cmd,c.pmt),pmt:e,cmd:t[a]+r}):o.push({name:t[a],action:c=>Ki(c.cmd,c.pmt),pmt:e,cmd:t[a]+r});xi.popup(o,f.clientX,f.clientY)}else e?(t=t.replace("&text;",p.textContent)+r,client.commandInput.value=t,Di(client.commandInput,t.length,t.length)):client.send(t.replace("&text;",p.textContent)+r+`
`,!0);setTimeout(()=>{client.getOption("CommandonClick")&&client.commandInput.focus()},0)}function Ki(f,p){p?(client.commandInput.value=f,Di(client.commandInput,f.length,f.length)):client.send(f,!0),setTimeout(()=>{client.getOption("CommandonClick")&&client.commandInput.focus()},0)}function dn(f){f.title=f.title.replace("&text;",f.textContent)}window.doLink=pn;window.doMXPLink=un;window.doMXPSend=Ns;window.MXPMenuHandler=Ki;window.doMXPTooltip=dn;function fn(){let f;Mt(0),Ls(),window.readClipboard=()=>tt(),window.readClipboardHTML=()=>tt(),client.readClipboard=window.readClipboard,client.readClipboardHTML=window.readClipboardHTML,window.writeClipboard=(p,t)=>Xe(p),client.writeClipboard=window.writeClipboard,client.closeWindow=p=>{switch(p){case"editor":case"help":case"about":St(p);break;case"profiles":case"profiles-manager":case"profile-manager":case"manager":St("profiles");break;case"prefs":case"options":case"preferences":St("settings");break;case"history":case"command-history":St("history");break;default:client.emit("close-window",p);break}},["repeatnum","i"].forEach(p=>{Object.defineProperty(window,p,{get:function(){if(client)return client.repeatnum},configurable:!0})}),Object.defineProperty(window,"$selected",{get:function(){return client?client.display.selection:""},configurable:!0}),Object.defineProperty(window,"$copied",{get:function(){return""},configurable:!0}),Object.defineProperty(window,"$selword",{get:function(){return client?client.input.vStack.$selword||Ts||(Ne?client.display.getWordFromPosition(Ne.pageX,Ne.pageY):""):""},configurable:!0}),Object.defineProperty(window,"$selurl",{get:function(){if(!client)return"";let p=client.input.vStack.$selurl||Ms||"";if(p)return p;if(!Ne)return"";let t=Ne.srcElement.parentNode;return t&&t.classList&&t.classList.contains("URLLink")?t.title:t&&t.classList&&t.classList.contains("MXPLink")&&t.dataset&&t.dataset.href&&t.dataset.href.length>0?t.dataset.href:""},configurable:!0}),Object.defineProperty(window,"$selline",{get:function(){if(!client)return"";let p=client.input.vStack.$selline||Rs||"";if(p)return p;if(!Ne)return"";let t=client.display.getLineOffset(Ne.pageX,Ne.pageY);return t.y<0||t.y>=client.display.lines.length?"":client.display.getLineText(t.y,!0)},configurable:!0}),Object.defineProperty(window,"$selectedword",{get:function(){return client?client.input.vStack.$selectedword||Ts||(Ne?client.display.getWordFromPosition(Ne.pageX,Ne.pageY):""):""},configurable:!0}),Object.defineProperty(window,"$selectedurl",{get:function(){if(!client)return"";let p=client.input.vStack.$selectedurl||Ms||"";if(p)return p;if(!Ne)return"";let t=Ne.srcElement.parentNode;return t&&t.classList&&t.classList.contains("URLLink")?t.title:t&&t.classList&&t.classList.contains("MXPLink")&&t.dataset&&t.dataset.href&&t.dataset.href.length>0?t.dataset.href:""},configurable:!0}),Object.defineProperty(window,"$selectedline",{get:function(){if(!client)return"";let p=client.input.vStack.$selectedline||Rs||"";if(p)return p;if(!Ne)return"";let t=client.display.getLineOffset(Ne.pageX,Ne.pageY);return t.y<0||t.y>=client.display.lines.length?"":client.display.getLineText(t.y,!0)},configurable:!0}),Object.defineProperty(window,"$action",{get:function(){return client&&(client.input.vStack.$action||(client.input.lastTriggerExecuted?client.input.lastTriggerExecuted.value:""))||""},configurable:!0}),Object.defineProperty(window,"$trigger",{get:function(){return client&&(client.input.vStack.$trigger||client.input.lastTriggered)||""},configurable:!0}),Object.defineProperty(window,"$caption",{get:function(){return client&&client.input.vStack.$caption||""},configurable:!0}),client.input.on("history-navigate",()=>{(client.getOption("commandAutoSize")||client.getOption("commandScrollbars"))&&mt()}),client.on("options-loaded",()=>{if(client.commandInput.removeEventListener("input",mt),client.commandInput.removeEventListener("change",mt),Bs(),Ds(),(client.getOption("commandAutoSize")||client.getOption("commandScrollbars"))&&mt(),re&&(re.resetState(client.getWindowState("editor")||{center:!0}),re.persistent=client.getOption("editorPersistent"),ae.simple!=client.getOption("simpleEditor"))){let p="";ae.isSimple||(p=ae.getFormattedText().replace(/(?:\r)/g,"")),ae.simple=client.getOption("simpleEditor"),ae.isSimple?(ae.value=p,re.showFooter(),re.header.querySelector("#adv-editor-switch")&&(re.header.querySelector("#adv-editor-switch").title="Switch to advanced"),setTimeout(()=>ae.focus(),100)):(re.hideFooter(),re.header.querySelector("#adv-editor-switch")&&(re.header.querySelector("#adv-editor-switch").title="Switch to simple"))}F.history&&F.history.resetState(client.getWindowState("history")||{center:!0,width:400,height:275}),F.profiles&&F.profiles.resetState(client.getWindowState("profiles")||{center:!0,width:400,height:275}),F.help&&F.help.resetState(client.getWindowState("help")||{center:!0,width:400,height:275})}),client.on("set-title",p=>{!p||!p.length?p=client.defaultTitle:p.indexOf(client.defaultTitle)===-1&&(p+=" - "+client.defaultTitle),client.connecting?p="Connecting - "+p:client.connected?p="Connected - "+p:p="Disconnected - "+p,window.document.title=p}),client.on("connected",()=>Mt(1)),client.on("closed",()=>Mt(0)),client.on("received-data",()=>{!client.active&&client.connected&&Mt(2)}),client.on("focus",()=>{client.connected?Mt(1):Mt(0)}),client.on("print",()=>{!client.active&&client.connected&&Mt(2)}),client.display.on("selection-done",p=>{client.getOption("AutoCopySelectedToClipboard")&&client.display.hasSelection&&(Xe(client.display.selection),client.display.clearSelection())}),client.on("profiles-loaded",()=>{yn()}),client.on("notify",(p,t,e)=>{if(!(!client.getOption("enableNotifications")||!("Notification"in window))){switch(e=e||{silent:!0},Object.prototype.hasOwnProperty.call(e,"silent")||(e.silent=!0),Vi){case 1:e.icon=e.icon||"images/connected.png";break;case 2:e.icon=e.icon||"images/connectednonactive.png";break;default:e.icon=e.icon||"images/disconnected.png";break}if(t&&(e.body=t,e.body.length>127&&(e.body=e.body.substr(0,127)+"...")),Notification.permission==="granted"){let s=new window.Notification(p,e);s.onclick=()=>{client.emit("notify-clicked",p,t),client.raise("notify-clicked",[p,t])},s.onclose=()=>{client.emit("notify-closed",p,t),client.raise("notify-closed",[p,t])}}else Notification.permission!=="denied"?Notification.requestPermission().then(s=>{if(s==="granted"){let n=new window.Notification(p,e);n.onclick=()=>{client.emit("notify-clicked",p,t),client.raise("notify-clicked",[p,t])},n.onclose=()=>{client.emit("notify-closed",p,t),client.raise("notify-closed",[p,t])}}else client.echo("Notification permission denied.",-7,-8,!0,!0)}):client.echo("Notification permission denied.",-7,-8,!0,!0)}}),client.on("window",(p,t,e)=>{switch(p){case"editor":case"help":case"about":t==="close"?St(p):Ge(p);break;case"profiles":case"profiles-manager":case"profile-manager":case"manager":t==="close"?St("profiles"):Ge("profiles");break;case"prefs":case"options":case"preferences":t==="close"?St("settings"):Ge("settings");break;case"history":case"command-history":t==="close"?St("history"):Ge("history");break}}),document.getElementById("btn-adv-editor").addEventListener("click",p=>{Ge("editor")}),f=client.getWindowState("editor"),f&&f.show&&document.getElementById("btn-adv-editor").click(),f=client.getWindowState("history"),f&&f.show&&Ge("history"),f=client.getWindowState("profiles"),f&&f.show&&Ge("profiles"),f=client.getWindowState("help"),f&&f.show&&Ge("help"),document.getElementById("btn-command-history").addEventListener("show.bs.dropdown",function(){document.body.appendChild(document.getElementById("command-history-menu"));let p="",t=document.getElementById("command-history-menu"),e=client.commandHistory;for(let n=0,r=e.length;n<r;n++)p+=`<li id="command-history-item-${n}"><a data-index="${n}" class="dropdown-item" href="javascript:void(0)">${e[n]}</a></li>`;e.length&&(p+='<li><hr class="dropdown-divider"></li>',p+='<li><a id="history-clear" class="dropdown-item" href="javascript:void(0)">Clear history</a></li>'),p+='<li><a id="history-show" class="dropdown-item" href="javascript:void(0)">Show history window...</a></li>',t.innerHTML=p,e.length&&t.querySelector("#history-clear").addEventListener("click",()=>{confirm_box("Clear history?","Clear all history").then(n=>{n.button===4&&client.clearCommandHistory()})}),t.querySelector("#history-show").addEventListener("click",()=>Ge("history"));let s=document.querySelectorAll('[id^="command-history-item"] a');for(let n=0,r=s.length;n<r;n++)s[n].addEventListener("click",o=>{let a=client.commandHistory[parseInt(o.currentTarget.dataset.index,10)];client.AddCommandToHistory(a),client.sendCommand(a,null,client.getOption("allowCommentsFromCommand"))})}),document.getElementById("btn-command-history").addEventListener("hidden.bs.dropdown",function(){document.getElementById("btn-command-history").parentElement.appendChild(document.getElementById("command-history-menu"))}),client.commandInput.removeEventListener("input",mt),client.commandInput.removeEventListener("change",mt),Bs(),Ds(),(client.getOption("commandAutoSize")||client.getOption("commandScrollbars"))&&mt(),window.addEventListener("keydown",p=>{p.which===33?client.display.pageUp():p.which===34?client.display.pageDown():p.ctrlKey&&!p.shiftKey&&!p.metaKey&&p.altKey&&p.code==="KeyV"&&(client.commandInput.dataset.selectionStart=""+client.commandInput.selectionStart,client.commandInput.dataset.selectionEnd=""+client.commandInput.selectionEnd,p.preventDefault(),p.stopPropagation(),document.querySelector("#menu-paste a").click())}),window.addEventListener("error",p=>{let{message:t,filename:e,lineno:s,colno:n,error:r}=p;if(!t.includes("ResizeObserver loop completed with undelivered notifications"))return client?(r?client.error(r):t.startsWith("Uncaught Error: ")?client.error(`${t.substr(16)}`):client.error(`${t}`),client.getOption("enableDebug")&&(client.error("Url: "+e),client.error("Line: "+s),client.error("Column: "+n),client.error(r))):(console.error("Message: "+t),console.error("Url: "+e),console.error("Line: "+s),console.error("Column: "+n),console.error(r)),!0}),window.addEventListener("mousemove",p=>{Ne=p}),window.addEventListener("hashchange",Os,!1),window.addEventListener("load",Os),client.on("command-history-changed",p=>{Ji()}),As(),document.addEventListener("copy",p=>{let t=document.activeElement;if(t&&t.display&&t.display.hasSelection)p.preventDefault(),p.clipboardData.setData("text/plain",t.display.selection),p.clipboardData.setData("text/html",t.display.selectionAsHTML);else if(!window.getSelection().toString().length&&client.display.hasSelection){if((t.tagName==="TEXTAREA"||t.tagName==="INPUT")&&t.value.substring(t.selectionStart,t.selectionEnd).length)return;p.preventDefault(),p.clipboardData.setData("text/plain",client.display.selection),p.clipboardData.setData("text/html",client.display.selectionAsHTML)}}),client.commandInput.addEventListener("paste",async p=>{if(ht()||!document.querySelector("#menu-paste").classList.contains("active"))return client.commandInput.focus(),!0;try{p.preventDefault(),ji(p.clipboardData.getData("text/plain"),!0)}catch{}})}function he(f){if(!f||f.length===0)return;f=f.trim(),f.startsWith("#")&&(f=f.substring(1));let p=decodeURI(window.location.hash.substring(1)).split(",").filter(t=>t.trim()!==f);window.location.hash=p.join(",")}function Bo(f){if(!f||f.length===0)return;f=f.trim(),f.startsWith("#")&&(f=f.substring(1));let p=decodeURI(window.location.hash.substring(1)).split(",").filter(t=>t.trim()!==f);p.push(f),window.location.hash=p.join(",")}function He(f,p){Array.isArray(f)||(f=[f]),p=p||[],Array.isArray(p)||(p=[p]),p=p.concat(...f);let t=decodeURI(window.location.hash.substring(1)).split(",").filter(e=>e.length&&!p.includes(e.trim()));t=t.concat(...f),window.location.hash=t.join(",")}function mn(f){return!f||!f.length?!1:decodeURI(window.location.hash.substring(1)).split(",").map(p=>p.trim()).indexOf(f)!==-1}function Do(f){return!f||!f.length?!1:decodeURI(window.location.hash.substring(1)).split(",").map(p=>p.startsWith(f)).length!==0}function Os(){if(!window.location.hash||window.location.hash.length<2)return;let f=decodeURI(window.location.hash.substring(1)).split(",").map(p=>p.trim());for(let p=f.length-1;p>=0;p--)switch(f[p]){case"about":Ge("about");break;case"editor":document.getElementById("btn-adv-editor").click();break;default:f[p]==="history"||f[p].startsWith("settings")||f[p].startsWith("profiles")||f[p].startsWith("help")?Ge(f[p]):client.emit("window",f[p]);break}}var F={};function Ge(f){switch(f){case"about":return F.about||(F.about=new ye({title:'<i class="bi-info-circle"></i> About',width:350,height:400,noFooter:!0,resizable:!1,center:!0,maximizable:!1}),F.about.on("closed",()=>{F.about.removeAllListeners(),delete F.about,he(f)}),F.about.on("canceled",()=>{F.about.removeAllListeners(),delete F.about,he(f)})),Ps(F.about,f,1,!0).catch(p=>{client.error(p)}),F.about;case"history":if(!F.history){F.history=new ye(Object.assign({},client.getWindowState("history")||{center:!0,width:400,height:275},{title:'<i class="bi bi-clock-history"></i> Command history',id:"command-history"})),F.history.on("closed",()=>{client.setOption("windows.history",F.history.windowState),F.history.removeAllListeners(),delete F.history,he(f)}),F.history.on("canceled",()=>{client.setOption("windows.history",F.history.windowState),he("history"),F.history.removeAllListeners(),delete F.history,he(f)}),F.history.on("resized",t=>{client.setOption("windows.history",t)}),F.history.on("moved",t=>{client.setOption("windows.history",t)}),F.history.on("maximized",()=>{client.setOption("windows.history",F.history.windowState)}),F.history.on("restored",()=>{client.setOption("windows.history",F.history.windowState)}),F.history.on("shown",()=>{client.setOption("windows.history",F.history.windowState)});let p="";p+=`<button id="${F.history.id}-clear" type="button" class="btn-sm float-end btn btn-danger" title="Clear history"><i class="bi bi-trash"></i><span class="icon-only"> Clear</span></button>`,p+=`<button id="${F.history.id}-send" type="button" class="btn-sm float-end btn btn-primary" title="Send"><i class="bi bi-send-fill"></i><span class="icon-only"> Send</span></button>`,p+=`<button id="${F.history.id}-refresh" type="button" class="btn-sm float-start btn btn-light" title="Refresh"><i class="bi bi-arrow-repeat"></i><span class="icon-only"> Refresh</span></button>`,F.history.footer.innerHTML=p,F.history.body.innerHTML='<select id="history-list" multiple="multiple" class="form-select"></select>',F.history.body.querySelector("#history-list").addEventListener("dblclick",t=>{let e=t.currentTarget.value;client.AddCommandToHistory(e),client.sendCommand(e,!1,client.getOption("allowCommentsFromCommand")),F.history.close()}),F.history.body.querySelector("#history-list").addEventListener("change",t=>{client.setHistoryIndex(t.currentTarget.selectedIndex),F.history.footer.querySelector(`#${F.history.id}-send`).style.display=history.length&&F.history.body.querySelector("#history-list").selectedIndex!==-1?"":"none"}),F.history.footer.querySelector(`#${F.history.id}-refresh`).addEventListener("click",()=>Ji()),F.history.footer.querySelector(`#${F.history.id}-send`).addEventListener("click",()=>{let t=F.history.body.querySelector("#history-list"),e=[];for(let s=0,n=t.options.length;s<n;s++)t.options[s].selected&&e.push(t.options[s].value);for(let s=0,n=e.length;s<n;s++)client.AddCommandToHistory(e[s]),client.sendCommand(e[s],!1,client.getOption("allowCommentsFromCommand"))}),F.history.footer.querySelector(`#${F.history.id}-clear`).addEventListener("click",()=>{confirm_box("Clear history?","Clear all history").then(t=>{t.button===4&&client.clearCommandHistory()})})}return Ji(),F.history.show(),F.history;case"editor":if(!re){re=new ye(Object.assign({},client.getWindowState("editor")||{center:!0},{title:'<i class="fas fa-edit"></i> Advanced editor',id:"adv-editor",persistent:client.getOption("editorPersistent")})),re.on("resized",t=>{client.setOption("windows.editor",t)}),re.on("moved",t=>{client.setOption("windows.editor",t)}),re.on("maximized",()=>{client.setOption("windows.editor",re.windowState)}),re.on("restored",()=>{client.setOption("windows.editor",re.windowState)}),re.on("shown",()=>{client.setOption("windows.editor",re.windowState),ae.initialize()}),re.on("closing",()=>{client.getOption("editorPersistent")?ae.clear():ae.remove()}),re.on("closed",()=>{client.setOption("windows.editor",re.windowState),client.getOption("editorPersistent")||(re.dialog.editor.removeAllListeners(),delete re.dialog.editor,re.removeAllListeners(),ae.remove(),ae=null,re=null),he("editor")}),re.on("canceling",()=>{client.getOption("editorPersistent")?ae.clear():ae.remove()}),re.on("canceled",()=>{client.setOption("windows.editor",re.windowState),client.getOption("editorPersistent")||(re.dialog.editor.removeAllListeners(),delete re.dialog.editor,ae.removeAllListeners(),ae.remove(),ae=null,re=null),he("editor")}),re.on("focus",()=>ae.focus());let p=document.createElement("textarea");p.classList.add("form-control","form-control-sm"),p.id="adv-editor-txt",re.body.appendChild(p),re.body.style.overflow="hidden",ae||(ae=new Wt(p,!client.getOption("simpleEditor"))),ae.on("close",()=>{re.close()}),ae.on("editor-init",()=>ae.focus()),ae.on("click",()=>re.focus()),re.dialog.editor=ae,tinymce&&re.header.querySelector("#adv-editor-max").insertAdjacentHTML("afterend",'<button type="button" class="btn btn-light float-end" id="adv-editor-switch" title="Switch to advanced" style="padding: 0 4px;margin-top: -1px;"><i class="bi-shuffle"></i></button>'),re.footer.innerHTML='<button id="btn-adv-editor-clear" type="button" class="btn-sm float-start btn btn-light" title="Clear editor"><i class="bi bi-journal-x"></i><span class="icon-only"> Clear</span></button><button id="btn-adv-editor-append" type="button" class="btn-sm float-start btn btn-light" title="Append file..."><i class="bi bi-box-arrow-in-down"></i><span class="icon-only"> Append file...</span></button><button id="btn-adv-editor-send" type="button" class="btn-sm float-end btn btn-primary" title="Send"><i class="bi bi-send-fill"></i><span class="icon-only"> Send</span></button>',re.header.querySelector("#adv-editor-switch")&&(ae.isSimple||(re.header.querySelector("#adv-editor-switch").title="Switch to simple"),re.header.querySelector("#adv-editor-switch").addEventListener("click",()=>{client.setOption("simpleEditor",!ae.simple);let t="";ae.isSimple||(t=ae.getFormattedText().replace(/(?:\r)/g,"")),ae.simple=!ae.simple,ae.isSimple?(ae.value=t,re.showFooter(),re.header.querySelector("#adv-editor-switch").title="Switch to advanced",setTimeout(()=>ae.focus(),100)):(re.hideFooter(),re.header.querySelector("#adv-editor-switch").title="Switch to simple")})),document.getElementById("btn-adv-editor-append").addEventListener("click",()=>{Se("Append file",!1).then(t=>{Ee(t[0]).then(e=>{ae.insert(e)}).catch(e=>client.error(e))}).catch(()=>{})}),document.getElementById("btn-adv-editor-send").addEventListener("click",()=>{client.sendCommand(ae.value()),client.getOption("editorClearOnSend")&&ae.clear(),client.getOption("editorCloseOnSend")&&re.close()}),document.getElementById("btn-adv-editor-clear").addEventListener("click",()=>{ae.clear(),ae.focus()}),ae.isSimple||re.hideFooter()}return re.show(),ae.isSimple&&ae.focus(),re}if(f.startsWith("settings"))return F.settings||(F.settings=new mi,F.settings.on("closed",()=>{F.settings.removeAllListeners(),delete F.settings}),F.settings.on("canceled",()=>{F.settings.removeAllListeners(),delete F.settings})),f==="settings"?(F.settings.dialog.dataset.path=f,F.settings.dialog.dataset.fullPath=f,F.settings.dialog.dataset.hash=window.location.hash,F.settings.setBody("",{client}),F.settings.showModal()):Ps(F.settings,f,2,!1).catch(p=>{client.error(p)}),F.settings;if(f.startsWith("profiles"))return F.profiles||(F.profiles=new bi,F.profiles.on("closed",()=>{F.profiles.removeAllListeners(),delete F.profiles}),F.profiles.on("canceled",()=>{F.profiles.removeAllListeners(),delete F.profiles}),f==="profiles"&&(window.location.hash.length<2||mn("profiles"))&&(this.client.profiles&&this.client.profiles.contains(this.client.getOption("profiles.profileSelected"))?setTimeout(()=>{F.profiles.expandPath(this.client.getOption("profiles.profileSelected")+"/aliases"),He("profiles/"+this.client.getOption("profiles.profileSelected"),f)},100):this.client.profiles||this.client.once("profiles-loaded",()=>{this.client.profiles.contains(this.client.getOption("profiles.profileSelected"))&&(F.profiles.expandPath(this.client.getOption("profiles.profileSelected")+"/aliases"),He("profiles/"+this.client.getOption("profiles.profileSelected"),f))}))),F.profiles.dialog.dataset.path=f,F.profiles.dialog.dataset.fullPath=f,F.profiles.dialog.dataset.hash=window.location.hash,F.profiles.setBody("",{client}),F.profiles.show(),F.profiles;if(f.startsWith("help")){if(F.help||(F.help=new wi,F.help.on("closed",()=>{F.help.removeAllListeners(),delete F.help}),F.help.on("canceled",()=>{F.help.removeAllListeners(),delete F.help})),f!==window.location.hash.substring(1)){let p=decodeURI(window.location.hash.substring(1)).split(",").map(t=>t.trim());for(let t=0,e=p.length;t<e;t++)if(p[t].startsWith("help")){f=p[t];break}}return F.help.dialog.dataset.path=f,F.help.dialog.dataset.fullPath=f,F.help.dialog.dataset.hash=window.location.hash,F.help.setBody("",!0),F.help.show(),F.help}}function Ps(f,p,t,e){return new Promise((s,n)=>{let r=p.split("/");$.ajax({url:"dialogs/"+r[0]+".htm",cache:!1,type:"GET"}).done(function(o){f.dialog.dataset.path=r[0],f.dialog.dataset.fullPath=p,f.dialog.dataset.hash=window.location.hash,f.setBody(o,{client}),t==1?f.show():t===2&&f.showModal(),s(o)}).fail(function(o){e&&client.enableDebug?f.setBody(`<h1 style="width: 100%;text-align:center">Error loading ${p}</h1> ${o.statusText}`):e?f.setBody(`<h1 style="width: 100%;text-align:center">Error loading ${p}</h1>`):f.setBody(""),n(p+": "+r.statusText)})})}function St(f){F[f]?F[f].close():f==="editor"&&re&&re.close()}function Ji(){if(!F.history)return;let f=document.getElementById("history-list");f.innerHTML="";let p=client.commandHistory,t=document.createDocumentFragment();for(let e=0,s=p.length;e<s;e++){let n=document.createElement("option");n.appendChild(document.createTextNode(p[e])),n.value=p[e],t.append(n)}f.appendChild(t),F.history.footer.querySelector(`#${F.history.id}-clear`).style.display=p.length?"":"none",F.history.footer.querySelector(`#${F.history.id}-send`).style.display=p.length&&f.selectedIndex!==-1?"":"none"}function mt(){ve(()=>{gn()},250,"resizeCommand")}async function Bs(){(client.getOption("commandAutoSize")||client.getOption("commandScrollbars"))&&(client.commandInput.addEventListener("input",mt),client.commandInput.addEventListener("change",mt)),client.getOption("commandWordWrap")?(document.getElementById("commandMeasure").style.whiteSpace="pre-wrap",document.getElementById("commandMeasure").style.overflowWrap="anywhere"):(document.getElementById("commandMeasure").style.whiteSpace="",document.getElementById("commandMeasure").style.overflowWrap=""),client.getOption("commandScrollbars")?(document.getElementById("commandMeasure").style.overflow="auto",client.commandInput.style.overflow="auto"):(document.getElementById("commandMeasure").style.overflow="",client.commandInput.style.overflow="")}var zt={};function Ds(){let f=document.getElementById("commandMeasure");document.body.appendChild(f);let p=client.commandInput.parentElement,t=window.getComputedStyle(p);f.style.fontSize=client.commandInput.style.fontSize,f.style.fontFamily=client.commandInput.style.fontFamily,f.style.width=client.commandInput.offsetWidth+"px";let e=f.innerHTML;f.innerHTML="W";let s=client.getOption("commandMinLines"),n=f.offsetHeight;s=n*(s<1?1:s);let r=parseFloat(t.borderTopWidth)||0;r+=parseFloat(t.borderBottomWidth)||0,r+=parseFloat(t.paddingTop)||0,r+=parseFloat(t.paddingBottom)||0;let o=t.inset.split(" ");r+=(parseFloat(o[0])||0)*2,f.innerHTML=e,p.style.height=n+r+"px",client.commandInput.parentElement.style.height=n+"px",client.commandInput.closest("nav").style.height=n+"px",client.display.container.style.bottom=n+r+"px",zt={measure:f,cmd:p,cmdSize:t,height:n,padding:r,minHeight:s}}function gn(){let f=zt.measure,p=zt.cmd;f.innerHTML=client.commandInput.value+`
`;let t=f.offsetHeight;t<zt.minHeight&&(t=zt.minHeight);let e=zt.padding;p.style.height=t+e+"px",client.commandInput.parentElement.style.height=t+"px",client.commandInput.closest("nav").style.height=t+"px",client.display.container.style.bottom=t+e+"px"}function Mt(f){if(Vi===f)return;Vi=f;let p="disconnected";switch(f){case 1:p="connected";break;case 2:p="connectednonactive";break}document.getElementById("icon1").remove(),document.getElementById("icon2").remove(),document.getElementById("icon3").remove(),document.querySelector("head").insertAdjacentHTML("afterbegin",`<link id="icon1" rel="shortcut icon" href="images/${p}.ico" /><link id="icon2" rel="icon" href="images/${p}.ico" /><link id="icon3" rel="icon" type="image/x-icon" href="images/${p}.png" />`)}function Cs(){client.setOption("showButtons",!client.getOption("showButtons")),As()}function bn(f,p){let t="",e="",s=f.caption,n=0;if(s.substring(0,3)==="fa-"?(s=s.split(","),s.length>1?s='<i class="fas '+s[0]+' fa-fw" data-fa-transform="'+s[1]+'"></i>':s='<i class="fas '+s[0]+' fa-fw"></i>',n=26):s.substring(0,4)==="fas-"?(s=s.split(","),s.length>1?s='<i class="fas fa-'+s[0].substring(4)+' fa-fw" data-fa-transform="'+s[1]+'"></i>':s='<i class="fas fa-'+s[0].substring(4)+' fa-fw"></i>',n=26):s.substring(0,4)==="far-"?(s=s.split(","),s.length>1?s='<i class="far fa-'+s[0].substring(4)+' fa-fw" data-fa-transform="'+s[1]+'"></i>':s='<i class="far fa-'+s[0].substring(4)+' fa-fw"></i>',n=26):s.substring(0,4)==="fab-"?(s=s.split(","),s.length>1?s='<i class="fab fa-'+s[0].substring(4)+' fa-fw" data-fa-transform="'+s[1]+'"></i>':s='<i class="fab fa-'+s[0].substring(4)+' fa-fw"></i>',n=26):s.substring(0,4)==="fal-"?(s=s.split(","),s.length>1?s='<i class="fal fa-'+s[0].substring(4)+' fa-fw" data-fa-transform="'+s[1]+'"></i>':s='<i class="fal fa-'+s[0].substring(4)+' fa-fw"></i>',n=26):s.substring(0,4)==="fat-"?(s=s.split(","),s.length>1?s='<i class="fat fa-'+s[0].substring(4)+' fa-fw" data-fa-transform="'+s[1]+'"></i>':s='<i class="fat fa-'+s[0].substring(4)+' fa-fw"></i>',n=26):s.substring(0,3)==="bi-"?(s='<i class="bi '+s+'"></i>',n=26):s.substring(0,7)==="http://"||s.substring(0,7)==="https://"?s='<img src="'+s+'" style="max-width: '+f.width+"px;max-height:"+f.height+'px"/>':(f.iconOnly||(s=f.caption),e=f.caption),f.icon&&f.icon.length){let r=f.icon;r.substring(0,3)==="fa-"?(r=r.split(","),r.length>1?r='<i class="fas '+r[0]+' fa-fw" data-fa-transform="'+r[1]+'"></i>':r='<i class="fas '+r[0]+' fa-fw"></i>',n=26):r.substring(0,4)==="fas-"?(r=r.split(","),r.length>1?r='<i class="fas fa-'+r[0].substring(4)+' fa-fw" data-fa-transform="'+r[1]+'"></i>':r='<i class="fas fa-'+r[0].substring(4)+' fa-fw"></i>',n=26):r.substring(0,4)==="far-"?(r=r.split(","),r.length>1?r='<i class="far fa-'+r[0].substring(4)+' fa-fw" data-fa-transform="'+r[1]+'"></i>':r='<i class="far fa-'+r[0].substring(4)+' fa-fw"></i>',n=26):r.substring(0,4)==="fab-"?(r=r.split(","),r.length>1?r='<i class="fab fa-'+r[0].substring(4)+' fa-fw" data-fa-transform="'+r[1]+'"></i>':r='<i class="fab fa-'+r[0].substring(4)+' fa-fw"></i>',n=26):r.substring(0,4)==="fal-"?(r=r.split(","),r.length>1?r='<i class="fal fa-'+r[0].substring(4)+' fa-fw" data-fa-transform="'+r[1]+'"></i>':r='<i class="fal fa-'+r[0].substring(4)+' fa-fw"></i>',n=26):r.substring(0,4)==="falt-"?(r=r.split(","),r.length>1?r='<i class="fat fa-'+r[0].substring(4)+' fa-fw" data-fa-transform="'+r[1]+'"></i>':r='<i class="fat fa-'+r[0].substring(4)+' fa-fw"></i>',n=26):r.substring(0,3)==="bi-"?(r='<i class="bi '+r[0]+'"></i>',n=26):f.icon.length&&(r='<img src="'+r+'" style="max-width: '+f.width+"px;max-height:"+f.height+'px"/>'),f.iconOnly?s=r:s=r+s}return t+="<button",t+=' data-index="'+p+'"',f.name&&f.name.length!==0&&(t+=' id="button-'+f.name+'"'),t+=' class="user-button" style="',f.left===-1&&f.right===-1&&f.top===-1&&f.bottom===-1?t+="position: static;margin-right:2px;margin-top:2px;":(f.left>=0&&(t+="left:"+(f.left||0)+"px;"),f.top>=0&&(t+="top:"+(f.top||0)+"px;"),f.bottom>=0&&(t+="bottom:"+(f.bottom||0)+"px;"),f.right>=0&&(t+="right:"+(f.right||0)+"px;"),f.right===-1&&f.left===-1&&(t+="right:0px;"),f.bottom===-1&&f.top===-1&&(t+="top:0px;")),f.width?t+="width: "+f.width+"px;":n===26&&(t+="min-width: 26px;"),f.height&&(t+="height: "+f.height+"px;"),t+='" title="'+e+'" draggable="true" data-index="'+p+'">'+s+"</button>",t}function As(){client.getOption("showButtons")?document.getElementById("buttons").style.visibility="visible":document.getElementById("buttons").style.visibility=""}function yn(){let f="",p=client.buttons,t,e;for(t=0,e=p.length;t<e;t++)p[t].enabled&&(f+=bn(p[t],t));document.getElementById("buttons").innerHTML=f;let s=document.querySelectorAll("#buttons button");for(let n=0,r=s.length;n<r;n++)s[n].addEventListener("click",o=>{wn(o.currentTarget,+o.currentTarget.dataset.index)}),vn(s[n])}function wn(f,p){if(p<0)return!1;if(f.dataset.moving==="true"){delete f.dataset.moving;return}let t=client.buttons;if(p>=t.length)return!1;let e=t[p];if(!e.enabled)return!1;let s;switch(e.style){case 1:s=client.parseOutgoing(e.value);break;case 2:s=new Function("try { "+e.value+"} catch (e) { if(this.options.showScriptErrors) this.error(e);}").apply(client);break;default:s=e.value;break}if(s===null||typeof s>"u")return!0;if(e.send){if(s.endsWith(`
`)||(s+=`
`),e.chain&&client.commandInput.value.endsWith(" "))return client.commandInput.value+=s,client.sendCommand(),!0;client.connected&&client.send(s),client.telnet.echo&&client.getOption("commandEcho")&&client.echo(s)}else e.append&&(client.commandInput.value+=s);return!0}function vn(f){let p=0,t=0,e;document.getElementById(f.id+"header")?document.getElementById(f.id+"header").onmousedown=s:(f.onmousedown=s,f.ontouchstart=o,f.onmouseleave=n);function s(c){if(c=c||window.event,c.buttons!==1)return;c.preventDefault();let g=f.getBoundingClientRect();p=c.pageX-g.left,t=c.pageY-g.top,document.onmouseup=h,e=setTimeout(function(){document.onmousemove=r,e=null},500)}function n(){e&&h()}function r(c){c=c||window.event,c.preventDefault(),f.style.position="absolute",f.style.top=c.pageY-t+"px",f.style.left=c.pageX-document.body.clientWidth-p+"px",f.dataset.moving="true"}function o(c){if(c=c||window.event,!c.touches.length)return;let g=f.getBoundingClientRect();p=c.touches[0].pageX-g.left,t=c.touches[0].pageY-g.top,document.ontouchend=h,e=setTimeout(function(){document.ontouchmove=a,e=null},500)}function a(c){c=c||window.event,c.preventDefault(),f.style.position="absolute",c.touches.length&&(f.style.top=c.touches[0].pageY-t+"px",f.style.left=c.touches[0].pageX-document.body.clientWidth-p+"px",f.dataset.moving="true")}function h(){let c=f.getBoundingClientRect(),g=parseInt(f.dataset.index,10);if(g<0)return;let m=client.buttons;if(g>=m.length)return;let b=m[g];b.enabled&&(b.left===-1&&b.right===-1&&b.top===-1&&b.bottom===-1?(b.top=c.top||-1,b.right=document.body.clientWidth-c.right||-1):(b.left>=0&&(b.left=document.body.clientWidth-c.left||-1),b.top>=0&&(b.top=c.top||-1),b.bottom>=0&&(b.bottom=c.bottom||-1),b.right>=0&&(b.right=document.body.clientWidth-c.right||-1),b.right===-1&&b.left===-1&&(b.right=document.body.clientWidth-c.right||-1),b.bottom===-1&&b.top===-1&&(b.top=c.top||-1)),document.onmouseup=null,document.onmousemove=null,document.ontouchend=null,document.ontouchmove=null,clearTimeout(e),client.saveProfiles())}}function vi(){document.querySelectorAll(".dropdown-menu.show,.dropdown-toggle.show").forEach(f=>{f.classList.remove("show"),f.ariaExpanded==="true"&&(f.ariaExpanded="false")})}window.initializeInterface=fn;async function ji(f,p){let t=await Ss({prefixEnabled:client.getOption("pasteSpecialPrefixEnabled"),postfixEnabled:client.getOption("pasteSpecialPostfixEnabled"),replaceEnabled:client.getOption("pasteSpecialReplaceEnabled"),prefix:client.getOption("pasteSpecialPrefix"),postfix:client.getOption("pasteSpecialPostfix"),replace:client.getOption("pasteSpecialReplace"),disable:client.getOption("pasteSpecialDisable"),showDisable:p});if(t.button===1){client.setOption("pasteSpecialPrefixEnabled",t.options.prefixEnabled),client.setOption("pasteSpecialPostfixEnabled",t.options.postfixEnabled),client.setOption("pasteSpecialReplaceEnabled",t.options.replaceEnabled),client.setOption("pasteSpecialPrefix",t.options.prefix),client.setOption("pasteSpecialPostfix",t.options.postfix),client.setOption("pasteSpecialReplace",t.options.replace),client.setOption("pasteSpecialDisable",t.options.disable);var e=t.options.postfixEnabled?t.options.postfix:0,s=t.options.prefixEnabled?t.options.prefix:0,n=t.options.replaceEnabled?t.options.replace:0;n&&n.length&&(f=f.replace(/\n/g,n)),s&&s.length&&e&&e.length?f=s+f.replace(/\n/g,`${e}
${s}`)+e:s&&s.length?f=s+f.replace(/\n/g,`
${s}`):e&&e.length&&(f=f.replace(/\n/g,`${e}
`)+e),client.commandInput.dataset.selectionStart&&client.commandInput.dataset.selectionStart.length&&(client.commandInput.selectionStart=+client.commandInput.dataset.selectionStart,client.commandInput.selectionEnd=+client.commandInput.dataset.selectionEnd),et(client.commandInput,f),client.commandInput.dataset.selectionStart="",client.commandInput.dataset.selectionEnd="",t.options.disable&&document.querySelector("#menu-paste").classList.remove("active")}client.commandInput.focus()}var Gs='<div class="offcanvas offcanvas-start" data-bs-scroll="true" data-bs-backdrop="false" tabindex="-1" id="mapper-menu" aria-labelledby="mapper-menu-Label" style="position:absolute"><div class="offcanvas-body"><button type="button" class="btn btn-close text-reset btn-danger btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close" style="position:absolute;right:5px;top:5px"></button><ul class="navbar-nav justify-content-end flex-grow-1"><li id="mapper-enable" class="nav-item" title="Enable"><a class="nav-link" href="javascript:void(0)"><i class="bi bi-map"></i>&nbsp;<span>Enabled</span></a></li><li id="mapper-legend" class="nav-item" title="Show legend"><a class="nav-link" href="javascript:void(0)"><i class="fa fa-map-marker"></i>&nbsp;<span>Show legend</span></a></li><li id="mapper-room" class="nav-item" title="Show room properties"><a class="nav-link" href="javascript:void(0)"><i class="fa fa-list-alt"></i>&nbsp;<span>Show room properties</span></a></li><li><hr class="dropdown-divider"></li><li id="mapper-refresh" class="nav-item" title="Refresh"><a class="nav-link" href="javascript:void(0)"><i class="fa fa-refresh"></i>&nbsp;<span>Refresh</span></a></li><li><hr class="dropdown-divider"></li><li id="mapper-split" class="nav-item" title="Split areas"><a class="nav-link" href="javascript:void(0)"><i class="fa fa-object-ungroup"></i>&nbsp;<span>Split areas</span></a></li><li id="mapper-fill" class="nav-item" title="Display walls"><a class="nav-link" href="javascript:void(0)"><i class="fa fa-building"></i>&nbsp;<span>Display walls</span></a></li><li><hr class="dropdown-divider"></li><li id="mapper-remove" class="nav-item"><a class="nav-link" href="javascript:void(0)" role="button" data-bs-target="#remove-submenu" data-bs-toggle="collapse" aria-expanded="false" aria-controls="remove-submenu"><i class="fa fa-eraser"></i>&nbsp;<span>Remove</span></a><ul class="navbar-nav justify-content-end flex-grow-1 collapse" id="remove-submenu"><li class="nav-item" id="mapper-remove-selected"><a class="nav-link disabled" href="javascript:void(0)">Remove selected room</a></li><li class="nav-item" id="mapper-remove-current"><a class="nav-link disabled" href="javascript:void(0)">Remove current room</a></li><li><hr class="dropdown-divider"></li><li id="mapper-remove-current-area" class="nav-item"><a class="nav-link" href="javascript:void(0)">Remove current area</a></li><li id="mapper-remove-all" class="nav-item"><a class="nav-link" href="javascript:void(0)">Remove all</a></li></ul></li><li id="mapper-export" class="nav-item"><a class="nav-link" href="javascript:void(0)" role="button" data-bs-target="#export-submenu" data-bs-toggle="collapse" aria-expanded="false" aria-controls="export-submenu"><i class="fa fa-exchange"></i>&nbsp;<span>Export/Import</span></a><ul class="navbar-nav justify-content-end flex-grow-1 collapse" id="export-submenu"><li id="mapper-export-image" class="nav-item"><a class="nav-link" href="javascript:void(0)">Export as image</a></li><li id="mapper-export-scaled-image" class="nav-item"><a class="nav-link" href="javascript:void(0)">Export as scaled image</a></li><li id="mapper-export-current-image" class="nav-item"><a class="nav-link" href="javascript:void(0)">Export current view as image</a></li><li><hr class="dropdown-divider"></li><li id="mapper-export-current-area" class="nav-item"><a class="nav-link" href="javascript:void(0)">Export current area</a></li><li id="mapper-export-all" class="nav-item"><a class="nav-link" href="javascript:void(0)">Export all</a></li><li><hr class="dropdown-divider"></li><li id="mapper-import-merge" class="nav-item"><a class="nav-link" href="javascript:void(0)">Import and merge</a></li><li id="mapper-import-replace" class="nav-item"><a class="nav-link" href="javascript:void(0)">Import and replace</a></li></ul></li><li><hr class="dropdown-divider"></li><li id="mapper-export" class="nav-item"><a class="nav-link" href="javascript:void(0)" role="button" data-bs-target="#actions-submenu" data-bs-toggle="collapse" aria-expanded="false" aria-controls="actions-submenu"><i class="fa-solid fa-shoe-prints"></i>&nbsp;<span>Actions</span></a><ul class="navbar-nav justify-content-end flex-grow-1 collapse" id="actions-submenu"><li id="mapper-follow" class="nav-item"><a class="nav-link" href="javascript:void(0)">Follow</a></li><li><hr class="dropdown-divider"></li><li id="mapper-focus" class="nav-item"><a class="nav-link" href="javascript:void(0)">Focus on current room</a></li><li id="mapper-set-current" class="nav-item"><a class="nav-link disabled" href="javascript:void(0)">Set selected as current</a></li><li><hr class="dropdown-divider"></li><li id="mapper-highlight-path" class="nav-item"><a class="nav-link disabled" href="javascript:void(0)">Highlight path</a></li><li id="mapper-clear-path" class="nav-item"><a class="nav-link disabled" href="javascript:void(0)">Clear path</a></li><li><hr class="dropdown-divider"></li><li id="mapper-walk-path" class="nav-item"><a class="nav-link disabled" href="javascript:void(0)">Walk path</a></li><li id="mapper-walk-highlighted-path" class="nav-item"><a class="nav-link disabled" href="javascript:void(0)">Walk highlighted path</a></li><li><hr class="dropdown-divider"></li><li id="mapper-copy-path" class="nav-item"><a class="nav-link disabled" href="javascript:void(0)">Copy path</a></li><li id="mapper-copy-stacked" class="nav-item"><a class="nav-link disabled" href="javascript:void(0)">Copy as stacked</a></li><li id="mapper-copy-speedpath" class="nav-item"><a class="nav-link disabled" href="javascript:void(0)">Copy as speedpath</a></li><li id="mapper-copy-highlighted-path" class="nav-item"><a class="nav-link disabled" href="javascript:void(0)">Copy highlighted path</a></li><li id="mapper-copy-highlighted-stacked" class="nav-item"><a class="nav-link disabled" href="javascript:void(0)">Copy highlighted as stacked</a></li><li id="mapper-copy-highlighted-speedpath" class="nav-item"><a class="nav-link disabled" href="javascript:void(0)">Copy highlighted as speedpath</a></li></ul></li><li><hr class="dropdown-divider"></li><li id="mapper-about" class="nav-item" title="About map"><a class="nav-link" href="javascript:void(0)"><i class="bi-info-circle"></i>&nbsp;<span>About</span></a></li></ul></div></div>';var Ws='<div class="dialog-header"><button id="mapper-room-close" style="padding:4px" type="button" class="btn btn-close float-end btn-danger" data-dismiss="modal" title="Hide properties"></button><div><i class="fa fa-list-alt"></i>&nbsp;Room properties</div></div><div class="accordion" id="mapper-room-accordion"><div class="accordion-item"><h2 class="accordion-header"><button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#mapper-room-general" aria-expanded="true" aria-controls="General">General</button></h2><div id="mapper-room-general" class="accordion-collapse collapse show" data-bs-parent="#mapper-room-accordion"><div class="accordion-body" style="padding:5px"><div class="mb-3"><label for="mapper-room-name">Name</label><input type="text" class="form-control" id="mapper-room-name" placeholder=""></div><div class="mb-3"><label for="mapper-room-background">Background</label><input type="text" class="form-control" id="mapper-room-background" placeholder=""></div></div></div></div><div class="accordion-item"><h2 class="accordion-header"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#mapper-room-location" aria-expanded="true" aria-controls="mapper-room-location">Location</button></h2><div id="mapper-room-location" class="accordion-collapse collapse" data-bs-parent="#mapper-room-accordion"><div class="accordion-body" style="padding:5px"><div class="mb-3"><label for="mapper-room-area" class="form-label">Area</label><select id="mapper-room-area" class="form-select"></select></div><div class="mb-3"><label for="mapper-room-x" class="form-label">X</label><input type="number" class="form-control" id="mapper-room-x"></div><div class="mb-3"><label for="mapper-room-y" class="form-label">Y</label><input type="number" class="form-control" id="mapper-room-y"></div><div class="mb-3"><label for="mapper-room-z" class="form-label">Z</label><input type="number" class="form-control" id="mapper-room-z"></div><div class="mb-3"><label for="mapper-room-zone" class="form-label">Zone</label><input type="number" class="form-control" id="mapper-room-zone"></div></div></div></div><div class="accordion-item"><h2 class="accordion-header"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#mapper-room-details" aria-expanded="true" aria-controls="mapper-room-details">Details</button></h2><div id="mapper-room-details" class="accordion-collapse collapse" data-bs-parent="#mapper-room-accordion"><div class="accordion-body" style="padding:5px"><div class="form-check form-switch"><input type="checkbox" class="form-check-input" id="mapper-room-indoors"><label class="form-check-label" for="mapper-room-indoors">Indoors</label></div><div class="mb-3"><label for="font" class="form-label">Terrain</label><div class="input-group"><input id="mapper-room-env" type="text" class="form-control" aria-label="Room terrain"><button type="button" class="btn btn-outline-secondary dropdown-toggle dropdown-toggle-split" style="border:var(--bs-border-width) solid var(--bs-border-color)" data-bs-toggle="dropdown" aria-expanded="false"><span class="visually-hidden">Toggle Dropdown</span></button><ul id="mapper-room-terrains" class="dropdown-menu dropdown-menu-end" style="height:200px;overflow:auto"><li><a class="dropdown-item" href="javascript:void(0)">beach</a></li><li><a class="dropdown-item" href="javascript:void(0)">bog</a></li><li><a class="dropdown-item" href="javascript:void(0)">city</a></li><li><a class="dropdown-item" href="javascript:void(0)">cliff</a></li><li><a class="dropdown-item" href="javascript:void(0)">cobble</a></li><li><a class="dropdown-item" href="javascript:void(0)">desert</a></li><li><a class="dropdown-item" href="javascript:void(0)">dirt</a></li><li><a class="dropdown-item" href="javascript:void(0)">dirtroad</a></li><li><a class="dropdown-item" href="javascript:void(0)">farmland</a></li><li><a class="dropdown-item" href="javascript:void(0)">forest</a></li><li><a class="dropdown-item" href="javascript:void(0)">grass</a></li><li><a class="dropdown-item" href="javascript:void(0)">grassland</a></li><li><a class="dropdown-item" href="javascript:void(0)">highmountain</a></li><li><a class="dropdown-item" href="javascript:void(0)">hills</a></li><li><a class="dropdown-item" href="javascript:void(0)">icesheet</a></li><li><a class="dropdown-item" href="javascript:void(0)">jungle</a></li><li><a class="dropdown-item" href="javascript:void(0)">lake</a></li><li><a class="dropdown-item" href="javascript:void(0)">mountain</a></li><li><a class="dropdown-item" href="javascript:void(0)">ocean</a></li><li><a class="dropdown-item" href="javascript:void(0)">pavedroad</a></li><li><a class="dropdown-item" href="javascript:void(0)">plains</a></li><li><a class="dropdown-item" href="javascript:void(0)">prairie</a></li><li><a class="dropdown-item" href="javascript:void(0)">river</a></li><li><a class="dropdown-item" href="javascript:void(0)">rockdesert</a></li><li><a class="dropdown-item" href="javascript:void(0)">rocky</a></li><li><a class="dropdown-item" href="javascript:void(0)">sand</a></li><li><a class="dropdown-item" href="javascript:void(0)">sanddesert</a></li><li><a class="dropdown-item" href="javascript:void(0)">savannah</a></li><li><a class="dropdown-item" href="javascript:void(0)">stone</a></li><li><a class="dropdown-item" href="javascript:void(0)">swamp</a></li><li><a class="dropdown-item" href="javascript:void(0)">tundra</a></li><li><a class="dropdown-item" href="javascript:void(0)">underwater</a></li><li><a class="dropdown-item" href="javascript:void(0)">water</a></li></ul></div></div><div><label for="font" class="form-label">Details</label></div><div class="form-check"><input class="form-check-input" type="checkbox" value="1" id="mapper-room-details-1" name="details" data-enum="true"><label class="form-check-label" for="mapper-room-details-1">Dock</label></div><div class="form-check"><input class="form-check-input" type="checkbox" value="2" id="mapper-room-details-2" name="details" data-enum="true"><label class="form-check-label" for="mapper-room-details-2">Pier</label></div><div class="form-check"><input class="form-check-input" type="checkbox" value="4" id="mapper-room-details-4" name="details" data-enum="true"><label class="form-check-label" for="mapper-room-details-4">Bank</label></div><div class="form-check"><input class="form-check-input" type="checkbox" value="8" id="mapper-room-details-8" name="details" data-enum="true"><label class="form-check-label" for="mapper-room-details-8">Shop</label></div><div class="form-check"><input class="form-check-input" type="checkbox" value="16" id="mapper-room-details-16" name="details" data-enum="true"><label class="form-check-label" for="mapper-room-details-16">Hospital</label></div><div class="form-check"><input class="form-check-input" type="checkbox" value="32" id="mapper-room-details-32" name="details" data-enum="true"><label class="form-check-label" for="mapper-room-details-32">Bar</label></div><div class="form-check"><input class="form-check-input" type="checkbox" value="64" id="mapper-room-details-64" name="details" data-enum="true"><label class="form-check-label" for="mapper-room-details-64">Restaurant</label></div><div class="form-check"><input class="form-check-input" type="checkbox" value="128" id="mapper-room-details-128" name="details" data-enum="true"><label class="form-check-label" for="mapper-room-details-128">WaterSource</label></div><div class="form-check"><input class="form-check-input" type="checkbox" value="256" id="mapper-room-details-256" name="details" data-enum="true"><label class="form-check-label" for="mapper-room-details-256">Trainer</label></div><div class="form-check"><input class="form-check-input" type="checkbox" value="512" id="mapper-room-details-512" name="details" data-enum="true"><label class="form-check-label" for="mapper-room-details-512">Stable</label></div></div></div></div><div class="accordion-item"><h2 class="accordion-header"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#mapper-room-notes" aria-expanded="true" aria-controls="mapper-room-notes">Notes</button></h2><div id="mapper-room-notes" class="accordion-collapse collapse" data-bs-parent="#mapper-room-accordion"><div class="accordion-body" style="padding:5px"><textarea class="form-control" rows="10" style="width:100%" id="mapper-room-notes"></textarea></div></div></div></div>';var nt=class extends Re{constructor(p){super(p instanceof Ve?p:p?.client),p&&p instanceof Ve,Nt.load().then(t=>{this.map=t,this.client.sendGMCP("Room.Info")}).catch(t=>this.client.error(t))}remove(){if(!this.client)return;this.client.removeListenersFromCaller(this);let p=this.client.telnet.GMCPSupports.indexOf("Room 1");this.client.telnet.GMCPSupports.splice(p,1)}initialize(){if(!this.client)return;this.client.telnet.GMCPSupports.push("Room 1"),this.client.on("received-GMCP",this.lr,this),this.client.on("window",(t,e,s)=>{t==="mapper"&&(e==="close"?this.$&&this.$.close():this.show())}),this.client.on("close-window",t=>{t==="mapper"&&this.$&&this.$.close()}),this.client.on("options-loaded",()=>{this.le&&(this.le.commandDelay=client.getOption("commandDelay"),this.le.commandDelayCount=client.getOption("commandDelayCount"),this.le.enabled=this.client.getOption("mapper.enabled"),this.le.enabled?this.$.body.querySelector("#mapper-enable").classList.add("active"):this.$.body.querySelector("#mapper-enable").classList.remove("active"),this.le.showLegend=this.client.getOption("mapper.legend"),this.le.showLegend?this.$.body.querySelector("#mapper-legend").classList.add("active"):this.$.body.querySelector("#mapper-legend").classList.remove("active"),this.le.follow=this.client.getOption("mapper.follow"),this.le.follow?this.$.body.querySelector("#mapper-follow").classList.add("active"):this.$.body.querySelector("#mapper-follow").classList.remove("active"),this.le.splitArea=this.client.getOption("mapper.split"),this.le.splitArea?this.$.body.querySelector("#mapper-split").classList.add("active"):this.$.body.querySelector("#mapper-split").classList.remove("active"),this.le.fillWalls=this.client.getOption("mapper.fill"),this.le.fillWalls?this.$.body.querySelector("#mapper-fill").classList.add("active"):this.$.body.querySelector("#mapper-fill").classList.remove("active"),this.le.follow&&this.le.focusCurrentRoom()),this.$&&this.$.resetState(Object.assign({persistent:!0},client.getWindowState("mapper")||{center:!0}));let t=client.getWindowState("mapper");(t&&t.show||this.client.getOption("showMapper"))&&this.show()}),this.on("debug",t=>this.client.debug(t),this),this.on("error",t=>this.client.error(t),this);let p=client.getWindowState("mapper");(p&&p.show||this.client.getOption("showMapper"))&&this.show()}get menu(){return[{name:"-",position:5,exists:"#menu-plugins",id:"plugins"},{name:" Show mapper",action:p=>{this.show()},icon:'<i class="bi bi-map"></i>',position:6}]}get settings(){return[{name:" Mapper",action:"settings-mapper",icon:'<i class="bi bi-map"></i>',position:7}]}get map(){return this.he}set map(p){this.he=p,this.le&&(this.le.map=p),this.emit("map-loaded")}async lr(p,t){if(this.client.getOption("mapper.enabled"))switch(p){case"Room.Info":this.ka(t);break;case"Room.WrongDir":break}}ka(p){if(!this.he){setTimeout(()=>{this.ka(p)},10);return}try{let t=this.he.getRoom({num:""+p.num});if(t)this.Er(t,p);else{if(t=new Ie,t.zone=this.he.current.zone,this.he.current.num!==null){switch(p.prevroom.dir){case"west":t.x--;break;case"east":t.x++;break;case"north":t.y--;break;case"south":t.y++;break;case"northeast":t.y--,t.x++;break;case"northwest":t.y--,t.x--;break;case"southeast":t.y++,t.x++;break;case"southwest":t.y++,t.x--;break;case"up":t.z++;break;case"down":t.z--;break;case"out":t.zone=this.he.current.zone-1;break;default:t.zone=this.he.current.zone+1;break}t.x+=this.he.current.x,t.y+=this.he.current.y,t.z+=this.he.current.z}p.area===this.he.current.area?this.he.roomExists({x:t.x,y:t.y,z:t.z,zone:this.he.current.zone,area:this.he.current.area})||p.prevroom.zone?(t.zone=this.he.getFreeZone(this.he.current.zone),this.Er(t,p)):this.Er(t,p):this.he.roomExists({x:t.x,y:t.y,z:t.z,zone:this.he.current.zone})||p.prevroom.zone?(t.zone=this.he.getFreeZone(this.he.current.zone),this.Er(t,p)):this.Er(t,p)}this.he.save().catch(e=>this.client.error(e))}catch(t){this.emit("error",t)}}Er(p,t){p.num=t.num,p.area=t.area,p.name=t.name,p.env=t.environment,p.indoors=t.indoors;let e;for(e in t.exits)p.exits[e]=t.exits[e];if(p.details=0,typeof t.details=="number")p.details=t.details;else for(let s=0;s<t.details.length;s++)switch(t.details[s]){case"dock":p.details|=1;break;case"pier":p.details|=2;break;case"bank":p.details|=4;break;case"shop":p.details|=8;break;case"hospital":p.details|=16;break;case"bar":p.details|=32;break;case"restaurant":p.details|=64;break;case"watersource":p.details|=128;break;case"trainer":case"training":case"advance":p.details|=256;break;case"stable":p.details|=512;break}p=this.he.setRoom(p),this.he.current=p.clone(),this.emit("current-changed",this.he.current)}debug(p){this.emit("debug",p)}refresh(){this.le&&this.le.refresh()}Rh(){if(this.$)return;this.$=new ye(Object.assign({persistent:!0},client.getWindowState("mapper")||{center:!0},{title:'<i class="bi bi-map"></i><select id="mapper-area" class="form-select form-select-sm me-2 mb-1" title="Select Area"></select>',id:"win-mapper",noFooter:!0,minHeight:350})),this.$.on("resized",o=>{this.client.setOption("windows.mapper",o),ve(()=>{this._t.panel1.parentElement.style.top=p.offsetHeight+"px"},25,"mapper-resize")}),this.$.on("moved",o=>{this.client.setOption("windows.mapper",o)}),this.$.on("maximized",()=>{this.client.setOption("windows.mapper",this.$.windowState),ve(()=>{this._t.panel1.parentElement.style.top=p.offsetHeight+"px"},25,"mapper-resize")}),this.$.on("restored",()=>{this.client.setOption("windows.mapper",this.$.windowState),ve(()=>{this._t.panel1.parentElement.style.top=p.offsetHeight+"px"},25,"mapper-resize")}),this.$.on("shown",()=>{this.client.setOption("windows.mapper",this.$.windowState),this.client.setOption("showMapper",this.$.windowState.show!==0),this._t.panel1.parentElement.style.top=p.offsetHeight+"px"}),this.$.on("closing",()=>{}),this.$.on("closed",()=>{this.client.setOption("windows.mapper",this.$.windowState),this.client.setOption("showMapper",this.$.windowState.show!==0),this.$&&!this.$.persistent&&(this.he&&this.he.removeListenersFromCaller(this.$),this.le.map=null,delete this.le,this.le=null,delete this.$,this.$=null),he("mapper")}),this.$.on("canceling",()=>{}),this.$.on("canceled",()=>{this.client.setOption("windows.mapper",this.$.windowState),this.client.setOption("showMapper",this.$.windowState.show!==0),this.$&&!this.$.persistent&&(this.he&&this.he.removeListenersFromCaller(this.$),this.le.map=null,delete this.le,this.le=null,delete this.$,this.$=null),he("mapper")}),this.$.on("resizing",()=>{this._t.panel1.parentElement.style.top=p.offsetHeight+"px"});let p=document.createElement("nav");p.id="mapper-toolbar",p.classList.add("navbar","bg-light","align-items-center"),p.innerHTML='<form class="container-fluid justify-content-start"><button id="btn-mapper-menu" class="me-2 mb-1 btn-sm btn btn-outline-secondary" type="button" aria-controls="mapper-menu" title="Show menu" aria-expanded="false" data-bs-toggle="offcanvas" data-bs-target="#mapper-menu" aria-controls="mapper-menu"><i class="fa-solid fa-bars"></i></button><button id="btn-mapper-focus" type="button" class="btn btn-sm btn-outline-secondary me-2 mb-1" title="Focus on current room"><i class="fa fa-crosshairs"></i></button><div class="btn-group me-2 mb-1"><label for="mapper-level" class="mt-1 me-1">Level: </label><input id="mapper-level" class="form-control form-control-sm" type="number" title="Map Level"></div><div class="btn-group me-2 mb-1"><label for="mapper-zone" class="mt-1 me-1">Zone: </label><input id="mapper-zone" class="form-control form-control-sm" type="number" title="Map Zone"></div><div class="btn-group me-2 mb-1"><label for="mapper-zoom" class="me-1">Zoom: </label><input id="mapper-zoom" class="form-range" type="range" min="25" max="300" step="5"><label id="mapper-zoom-display">100%</label></div></form>',this.$.body.appendChild(p),this.$.body.insertAdjacentHTML("afterbegin",Gs),this.$.body.querySelector("#mapper-enable a").addEventListener("click",()=>{this.le.enabled=!this.le.enabled,this.le.enabled?this.$.body.querySelector("#mapper-enable").classList.add("active"):this.$.body.querySelector("#mapper-enable").classList.remove("active"),this.at()}),this.$.body.querySelector("#mapper-legend a").addEventListener("click",()=>{this.le.showLegend=!this.le.showLegend,this.le.showLegend?this.$.body.querySelector("#mapper-legend").classList.add("active"):this.$.body.querySelector("#mapper-legend").classList.remove("active"),this.at()}),this.$.body.querySelector("#mapper-room a").addEventListener("click",()=>{this._t.panel2Collapsed=!this._t.panel2Collapsed,this._t.panel2Collapsed?(this.$.dialog.dataset.panel="left",this.$.body.querySelector("#mapper-room").classList.remove("active"),this.$.body.querySelector("#mapper-room").title="Show room properties",this.$.body.querySelector("#mapper-room a span").textContent="Show room properties"):(this.$.dialog.dataset.panel="right",this.$.body.querySelector("#mapper-room").classList.add("active"),this.$.body.querySelector("#mapper-room").title="Hide room properties",this.$.body.querySelector("#mapper-room a span").textContent="Hide room properties"),this._t.panel1.parentElement.style.top=p.offsetHeight+"px",this.client.setOption("mapper.room",!this._t.panel2Collapsed),this.at()}),this.$.body.querySelector("#mapper-refresh a").addEventListener("click",()=>{this.le.refresh(),this.at()}),this.$.body.querySelector("#mapper-split a").addEventListener("click",()=>{this.le.splitArea=!this.le.splitArea,this.le.splitArea?this.$.body.querySelector("#mapper-split").classList.add("active"):this.$.body.querySelector("#mapper-split").classList.remove("active"),this.at()}),this.$.body.querySelector("#mapper-fill a").addEventListener("click",()=>{this.le.fillWalls=!this.le.fillWalls,this.le.fillWalls?this.$.body.querySelector("#mapper-fill").classList.add("active"):this.$.body.querySelector("#mapper-fill").classList.remove("active"),this.at()}),this.$.body.querySelector("#mapper-follow a").addEventListener("click",()=>{this.le.follow=!this.le.follow,this.le.follow?this.$.body.querySelector("#mapper-follow").classList.add("active"):this.$.body.querySelector("#mapper-follow").classList.remove("active"),this.at()}),this.$.body.querySelector("#mapper-focus a").addEventListener("click",()=>{this.le.focusCurrentRoom(),this.at()}),this.$.body.querySelector("#mapper-set-current a").addEventListener("click",()=>{this.le.current=this.le.selected,this.at()}),this.$.body.querySelector("#btn-mapper-focus").addEventListener("click",()=>{this.le.focusCurrentRoom(),this.at()}),this.$.body.querySelector("#mapper-highlight-path a").addEventListener("click",()=>{this.le.focusCurrentRoom(),this.le.showPath(),this.at()}),this.$.body.querySelector("#mapper-clear-path a").addEventListener("click",()=>{this.le.clearPath(),this.at()}),this.$.body.querySelector("#mapper-walk-path a").addEventListener("click",()=>{this.le.walkPath(),this.at()}),this.$.body.querySelector("#mapper-walk-highlighted-path a").addEventListener("click",()=>{this.le.walkMarkedPath(),this.at()}),this.$.body.querySelector("#mapper-copy-path a").addEventListener("click",()=>{this.le.copyPath(`
`),this.at()}),this.$.body.querySelector("#mapper-copy-stacked a").addEventListener("click",()=>{this.le.copyPath(this.client.getOption("commandStackingChar")),this.at()}),this.$.body.querySelector("#mapper-copy-speedpath a").addEventListener("click",()=>{this.le.copySpeedpath(),this.at()}),this.$.body.querySelector("#mapper-copy-highlighted-path a").addEventListener("click",()=>{this.le.copyMarkedPath(`
`),this.at()}),this.$.body.querySelector("#mapper-copy-highlighted-stacked a").addEventListener("click",()=>{this.le.copyMarkedPath(this.client.getOption("commandStackingChar")),this.at()}),this.$.body.querySelector("#mapper-remove-selected a").addEventListener("click",()=>{confirm_box("Remove selected room?","Are you sure you want to remove selected room?").then(o=>{o.button===4&&this.le.clearSelectedRoom()}),this.at()}),this.$.body.querySelector("#mapper-remove-current a").addEventListener("click",()=>{confirm_box("Remove current room?","Are you sure you want to remove current room?").then(o=>{o.button===4&&this.le.clearCurrentRoom()}),this.at()}),this.$.body.querySelector("#mapper-remove-current-area a").addEventListener("click",()=>{confirm_box("Remove current area?","Are you sure you want to remove all rooms from current area?").then(o=>{o.button===4&&this.le.clearArea()}),this.at()}),this.$.body.querySelector("#mapper-remove-all a").addEventListener("click",()=>{confirm_box("Remove all rooms and areas?","Are you sure you want to remove all rooms?").then(o=>{o.button===4&&this.le.clearAll()}),this.at()}),this.$.body.querySelector("#mapper-export-image a").addEventListener("click",()=>{this.le.exportImage(),this.at()}),this.$.body.querySelector("#mapper-export-scaled-image a").addEventListener("click",()=>{this.le.exportImage(!0),this.at()}),this.$.body.querySelector("#mapper-export-current-image a").addEventListener("click",()=>{this.le.exportCurrentImage(),this.at()}),this.$.body.querySelector("#mapper-export-current-area a").addEventListener("click",()=>{this.le.exportArea(),this.at()}),this.$.body.querySelector("#mapper-export-all a").addEventListener("click",()=>{this.le.exportAll(),this.at()}),this.$.body.querySelector("#mapper-import-merge a").addEventListener("click",()=>{Se("Import map and merge",!1).then(o=>{Ee(o[0]).then(a=>{this.import(a,0)}).catch(a=>client.error(a))}).catch(()=>{}),this.at()}),this.$.body.querySelector("#mapper-import-replace a").addEventListener("click",()=>{confirm_box("Import and Replace?","Are you sure you want to remove all rooms and replace them?").then(o=>{o.button===4&&Se("Import map and replace",!1).then(a=>{Ee(a[0]).then(h=>{this.import(h,1)}).catch(h=>client.error(h))}).catch(()=>{})}),this.at()}),this.$.body.querySelector("#mapper-copy-highlighted-speedpath a").addEventListener("click",()=>{this.le.copyMarkedSpeedpath(),this.at()}),this.$.body.querySelector("#mapper-about a").addEventListener("click",()=>{alert_box({title:'<i class="fa-solid fa-circle-info"></i> Map information',width:300,height:200,keepCentered:!0,center:!0,resizable:!1,moveable:!1,maximizable:!1,buttons:1},`Areas: ${this.he.Areas.length}<br>Rooms: ${this.he.count}<br>Highest zone: ${this.he.zone}`,2),this.at()}),this.le=new Gt(document.createElement("div"),{map:this.he}),this.le.on("error",o=>this.client.error(o),this),this.le.on("remove-selected",()=>{confirm_box("Remove selected room?","Are you sure you want to remove selected room?").then(o=>{o.button===4&&this.le.clearSelectedRoom()})}),this.le.on("active-room-changed",o=>{let a=this.$.header.querySelector("#mapper-area");!o.area||o.area.length===0?a.options.length&&(a.value=a.options[0].value):(a.querySelectorAll(`option[value="${o.area.replace(/"/g,"&quot;")}"]`).length||(a.insertAdjacentHTML("beforeend",`<option value="${o.area.replace(/"/g,"&quot;")}">${o.area}</option>`),this.$.body.querySelector("#mapper-room-area").insertAdjacentHTML("beforeend",`<option value="${o.area.replace(/"/g,"&quot;")}">${o.area}</option>`)),a.value=o.area),this.$.body.querySelector("#mapper-level").value=o.z,this.$.body.querySelector("#mapper-zone").value=o.zone,o=o.clone(),o.ID=o.num,delete o.num,this.client.setOption("mapper.active",o)}),this.le.on("setting-changed",(o,a)=>{o==="active"?(this.$.header.querySelector("#mapper-area").value=a.area,this.$.body.querySelector("#mapper-level").value=a.z,this.$.body.querySelector("#mapper-zone").value=a.zone):o==="scale"&&(this.$.body.querySelector("#mapper-zoom").value=a,this.$.body.querySelector("#mapper-zoom-display").textContent=a+"%"),this.client.setOption(`mapper.${o}`,a)}),this.$.header.querySelector("#mapper-area").addEventListener("change",o=>{this.le.setArea(o.currentTarget.value)}),this.$.body.querySelector("#mapper-level").addEventListener("change",o=>{this.le.setLevel(parseInt(o.currentTarget.value,10))}),this.$.body.querySelector("#mapper-zone").addEventListener("change",o=>{this.le.setZone(parseInt(o.currentTarget.value,10))}),this._t=new je({id:"mapper",parent:this.$.body,orientation:1}),this._t.on("splitter-moved",o=>{this.client.setOption("mapper.roomWidth",o)}),this._t.panel2Collapsed=!0,this.client.getOption("mapper.room")&&this.$.body.querySelector("#mapper-room a").click(),this._t.SplitterDistance=client.getOption("mapper.roomWidth"),this._t.panel2.innerHTML=Ws,this.$.body.querySelector("#mapper-room-close").addEventListener("click",()=>{this.$.body.querySelector("#mapper-room a").click()}),this.$.body.querySelector("#mapper-room-accordion").querySelectorAll("input,textarea,select,.accordion-body button").forEach(o=>{o.disabled=!0,o.tagName!=="BUTTON"&&(o.type==="checkbox"?o.addEventListener("change",a=>{if(this.le.selected===null||this.le.selected.num===null)return;let h=a.currentTarget||a.target,c=o.name||o.id.substring(12);if(h.dataset.enum==="true"){let g=h.name||h.id.substring(0,h.id.lastIndexOf("-")),m=this.$.body.querySelector("#mapper-room-accordion").querySelectorAll(`[name=${g}]`),b=0;for(let u=0,E=m.length;u<E;u++)m[u].checked&&(b|=+m[u].value);this.le.selected[g]=b}else this.le.selected[c]=h.checked;this.he.setRoom(this.le.selected),this.he.save().catch(g=>this.client.error(g))}):(o.addEventListener("change",a=>{if(this.le.selected===null||this.le.selected.num===null)return;let h=o.name||o.id.substring(12);ve(()=>{let c=a.currentTarget||a.target;this.le.selected[h]=c.value,this.he.setRoom(this.le.selected),this.he.save().catch(g=>this.client.error(g))},100,h)}),o.addEventListener("input",a=>{if(this.le.selected===null||this.le.selected.num===null)return;let h=o.name||o.id.substring(12);ve(()=>{let c=a.currentTarget||a.target;this.le.selected[h]=c.value,this.he.setRoom(this.le.selected)},100,h)})))}),this.le.on("room-selected",o=>{this.$.body.querySelector("#mapper-room-accordion").querySelectorAll("input,textarea,select,.accordion-body button").forEach(c=>{if(o===null||o.num===null){if(c.disabled=!0,c.tagName==="BUTTON")return;c.type==="checkbox"?c.checked=!1:c.value=""}else{if(c.disabled=!1,c.tagName==="BUTTON")return;let g=c.name||c.id.substring(12);if(c.type==="checkbox")if(c.dataset.enum==="true"){let m=+c.value;c.checked=(o[g]&m)===m}else c.checked=o[g];else c.value=o[g]}});let a=o,h=this.he.current;this.dt("#mapper-remove-selected a",a===null||a.num===null),this.dt("#mapper-set-current a",a===null||a.num===null),this.dt("#mapper-highlight-path a",a===null||a.num===null||!h||h.num===null||a.num===h.num),this.dt("#mapper-walk-path a",a===null||a.num===null||!h||h.num===null||a.num===h.num),this.dt("#mapper-copy-path a",a===null||a.num===null||!h||h.num===null||a.num===h.num),this.dt("#mapper-copy-stacked a",a===null||a.num===null||!h||h.num===null||a.num===h.num),this.dt("#mapper-copy-speedpath a",a===null||a.num===null||!h||h.num===null||a.num===h.num)}),this.le.on("current-changed",o=>{let a=this.le.selected,h=o;this.dt("#mapper-remove-current a",h===null||h.num===null),this.dt("#mapper-remove-selected a",a===null||a.num===null),this.dt("#mapper-set-current a",a===null||a.num===null),this.dt("#mapper-highlight-path a",a===null||a.num===null||!h||h.num===null||a.num===h.num),this.dt("#mapper-walk-path a",a===null||a.num===null||!h||h.num===null||a.num===h.num),this.dt("#mapper-copy-path a",a===null||a.num===null||!h||h.num===null||a.num===h.num),this.dt("#mapper-copy-stacked a",a===null||a.num===null||!h||h.num===null||a.num===h.num),this.dt("#mapper-copy-speedpath a",a===null||a.num===null||!h||h.num===null||a.num===h.num)}),this.le.on("path-shown",()=>{this.dt("#mapper-highlight-path a",!1),this.dt("#mapper-walk-path a",!1),this.dt("#mapper-walk-highlighted-path a",!1),this.dt("#mapper-clear-path a",!1),this.dt("#mapper-copy-highlighted-path a",!1),this.dt("#mapper-copy-highlighted-stacked a",!1),this.dt("#mapper-copy-highlighted-speedpath a",!1)}),this.le.on("path-cleared",()=>{this.dt("#mapper-clear-path a",!0),this.dt("#mapper-walk-highlighted-path a",!0),this.dt("#mapper-copy-highlighted-path a",!0),this.dt("#mapper-copy-highlighted-stacked a",!0),this.dt("#mapper-copy-highlighted-speedpath a",!0)});let t=this.$.body.querySelector("#mapper-room-env"),e=this.$.body.querySelectorAll("#mapper-room-terrains .active"),s,n;for(s=0,n=e.length;s<n;s++)e[s].classList.remove("active");for(e=this.$.body.querySelectorAll("#mapper-room-terrains .dropdown-item"),s=0,n=e.length;s<n;s++)e[s].addEventListener("click",function(){t.value=this.textContent,t.dispatchEvent(new Event("change"))});t.nextElementSibling.addEventListener("show.bs.dropdown",o=>{let a=this.$.body.querySelectorAll("#mapper-room-terrains .dropdown-item");for(s=0,n=a.length;s<n;s++)a[s].classList.remove("active"),t.value===a[s].textContent&&a[s].classList.add("active")}),this._t.panel1.append(this.le.container),this.le.container.classList.add("map"),this.le.active=new Ie(client.getOption("mapper.active")),this.le.active.num=this.le.active.num||this.le.active.ID,this.le.commandDelay=client.getOption("commandDelay"),this.le.commandDelayCount=client.getOption("commandDelayCount"),this.le.on("debug",o=>{this.client.debug(o)}),this.$.body.querySelector("#mapper-level").value=""+this.le.active.z,this.$.body.querySelector("#mapper-zone").value=""+this.le.active.zone,this.$.body.querySelector("#mapper-zoom").addEventListener("input",o=>{this.le.scale=+o.currentTarget.value});let r=()=>{let o=this.he.Areas.length,a=this.$.header.querySelector("#mapper-area"),h="";for(let c=0;c<o;c++)h+=`<option value="${this.he.Areas[c].replace(/"/g,"&quot;")}">${this.he.Areas[c]}</option>`;a.innerHTML=h,this.$.body.querySelector("#mapper-room-area").innerHTML=h,this.le.active.area&&this.he.Areas.indexOf(this.le.active.area)!==-1?a.value=this.le.active.area:o>0&&(this.le.active.area=this.map.Areas[0],this.le.emit("setting-changed","active",this.le.active.area),a.value=this.le.active.area),this.le.refresh(),this.le.enabled=this.client.getOption("mapper.enabled"),this.le.enabled&&this.$.body.querySelector("#mapper-enable").classList.add("active"),this.le.showLegend=this.client.getOption("mapper.legend"),this.le.showLegend&&this.$.body.querySelector("#mapper-legend").classList.add("active"),this.le.follow=this.client.getOption("mapper.follow"),this.le.follow&&this.$.body.querySelector("#mapper-follow").classList.add("active"),this.le.splitArea=this.client.getOption("mapper.split"),this.le.splitArea&&this.$.body.querySelector("#mapper-split").classList.add("active"),this.le.fillWalls=this.client.getOption("mapper.fill"),this.le.fillWalls&&this.$.body.querySelector("#mapper-fill").classList.add("active"),this.le.follow&&this.le.focusCurrentRoom(),this.le.scale=this.client.getOption("mapper.scale"),this.he.on("rooms-removed",c=>{this.he.save()},this.$),this.he.on("areas-removed",c=>{let g=this.$.header.querySelector("#mapper-area"),m=this.$.body.querySelector("#mapper-room-area");if(this.he.Areas.length===0)g.innerHTML="",m.innerHTML="";else{for(let b=g.length-1;b>=0;b--)c.indexOf(g.options[b].value)!==-1&&g.remove(b);for(let b=m.length-1;b>=0;b--)c.indexOf(m.options[b].value)!==-1&&m.remove(b)}},this.$),this.he.on("areas-added",c=>{let g="",m=this.he.Areas.length;for(let b=0;b<m;b++)g+=`<option value="${this.he.Areas[b].replace(/"/g,"&quot;")}">${this.he.Areas[b]}</option>`;this.$.header.querySelector("#mapper-area").innerHTML=g,this.$.body.querySelector("#mapper-room-area").innerHTML=g,this.le.active.area&&this.he.Areas.indexOf(this.le.active.area)!==-1?this.$.header.querySelector("#mapper-area").value=this.le.active.area:m>0&&(this.le.active.area=this.map.Areas[0],this.le.emit("setting-changed","active",this.le.active.area),this.$.header.querySelector("#mapper-area").value=this.le.active.area)},this.$),this.he.on("import-progress",c=>{this.mt&&(this.mt.progress=c)},this.$),this.he.on("import-complete",()=>{client.sendGMCP("Room.Info"),this.mt&&this.mt.close(),this.mt=null,this.le.refresh(),this.he.save()},this.$),this.he.on("import-canceled",()=>{client.sendGMCP("Room.Info"),this.mt&&this.mt.close(),this.mt=null,this.le.refresh(),this.he.save()},this.$),this.client.sendGMCP("Room.Info")};this.on("map-loaded",()=>{r()}),this.he&&r(),this._t.panel1.parentElement.style.top=p.offsetHeight+"px"}show(){this.Rh(),this.$.show()}dt(p,t){t?this.$.body.querySelector(p).classList.add("disabled"):this.$.body.querySelector(p).classList.remove("disabled")}import(p,t){if(this.mt)throw new Error("Import already in progress");typeof p=="string"&&(p=JSON.parse(p)),this.mt=progress_box("Importing map"),this.mt.on("canceled",()=>{this.map.cancelImport()}),this.mt.on("closed",e=>{e==="canceled"&&this.map.cancelImport()}),this.mt.on("shown",()=>{this.map.import(p,t)}),this.mt.showModal()}at(){let p=bootstrap.Offcanvas.getInstance(document.getElementById("mapper-menu"));p&&p.hide()}};var zs='<div id="status-drag-bar"></div><div id="status" class="d-flex flex-column"><button id="status-close" style="padding:4px" type="button" class="button button-sm btn-close" title="Hide status"></button><div id="character-name" class="status-panel">&nbsp;</div><div id="environment" class="status-panel day"><div id="environmentleft"><div class="overlay"></div></div><div id="environmentcenter"><div class="overlay"></div></div><div id="environmentright"><div class="overlay"></div></div><div id="environmentweather"></div></div><div id="body" class="status-panel"><div id="limbs"><button id="health" class="button button-sm active" title="Show limb health"><i class="fa fa-heart"></i></button><button id="armor" class="button button-sm" title="Show limb armor protection"><svg width="11" height="17" viewBox="0 0 10 17" preserveAspectRatio="xMidYMid"><path fill="currentColor" d="M5 0c0 0 1 0 1 0 1 0 2 1 3 1 1 1 1 2 1 3 0 2 0 5 0 8 -1 1-2 3-3 3 0-2 0-4 0-6 1-1 2-1 2-1C9 7 9 6 9 6 8 6 7 7 6 7 6 7 5 8 5 8 5 8 4 7 4 7 3 7 2 6 1 6 1 6 1 7 1 8c1 0 2 1 2 1 0 2 0 4 0 6 -1-1-2-1-3-2 0 0-1-1-1-1 0-1 0-1 0-2 0-1 0-1 0-2 0-1 0-3 0-4 0-1 1-2 2-2C3 1 4 0 5 0z"/></svg></button><svg id="fullbody" class="health-full" xmlns="http://www.w3.org/2000/svg" width="128" height="200" viewBox="-0.9 -0.8 179 297"><path id="rightwing" d="M140.5 0.1c7-0.8 8 6.4 7.7 11.8 -0.4 9.2-0.3 18.2 1.1 25.8 0.6 3.1 2 6 2 8.3 0.1 7.6-6.1 11.4-10 14.6 1.9 0.5 4.5 0.3 6 1.1 0.6 1.8 0.3 4.7 0 6.6 1.9 0.5 4.7 0.1 6 1.1 0.4 2.2-0.7 2.4-0.6 4 0.3 3 4.2 4.2 4.3 6.6 0.1 1.8-1.1 2.3-2 4 0.6 1.1 2.2 1.2 2.3 2.9 -2.3 2.3-4.2 4.2-1.4 6.9 5.8 5.6 20.4 8.8 21.8 18.6 -3.5 3.1-7.3-0.6-10-2.6 -3-2.2-5.1-5.5-7.7-7.7 -3.3-2.8-9.4-7.3-12.3-2 -0.3 1.6 0.9 1.8 0.6 3.4 -6-0.7-7.7 3-9.7 6.3 -4.9-0.5-6.6-5.4-12.3-4 -1.1-1-1.8-0.7-3.4-0.3 -0.3-1.5-1.6-2-3.2-2.3 -1.5-7.4-6.6-11.2-11.5-15.2 -1.3 5.8-4.9 9.5-11.8 9.8 -5.8-7.5-8.3-23-5.4-35.6 2-1.4 4.5-2.4 8-2.3C103.8 35.9 114.5 3 140.5 0.1zM138.2 6.1c3.6 0.1 5.2 2.3 4.6 6.6C146.3 8.9 141.8 0.5 138.2 6.1zM129.9 7.2c-7 3.1-12.1 10.6-15.5 18.4 1.6 0.2 2.8-2.6 4.6-4 1.4-1.1 3.6-1.8 4.9-3.2C126.7 15.3 126.6 9.9 129.9 7.2zM139.1 9.8c-6.4 4-8.6 12.1-11.5 19.5C133.3 26 139.7 19.4 139.1 9.8zM140.5 20.4c3.4-0.7 4 4.1 2.3 6C146.7 26.3 144.7 15.9 140.5 20.4zM124.7 20.7c-2.7 4.4-7.3 6.9-10.9 10.6 -7.8 8.1-10.7 20.2-13.2 32.7 4.9-6.8 9.9-13.3 15.8-19.8 1.8-2 4.7-4 5.7-6C124.6 33.4 123.5 27.4 124.7 20.7zM140.5 24.1c-1.2 0-2.6-0.1-3.4 0.3 -2.1 4-5.7 6.6-10 8.3 -0.2 1.1-0.6 2.1-0.9 3.2C132.1 33.1 138.4 30.8 140.5 24.1zM145.9 32.7c-0.9 1.9-1.6 4-2.6 5.7C146.1 38.4 146.3 35.1 145.9 32.7zM119.8 44.2c5.5 0.4 9.9-2.7 15.5-3.2 1.5-3 5.2-3.8 6.3-7.2C131.7 33.5 125.4 39.2 119.8 44.2zM144.2 42.8c0.6 2.8-1.6 4.8-3.7 5.7C144.8 50.7 149.8 43.7 144.2 42.8zM111.5 53.7c5.5-2.1 11.4-3.7 18.1-4.6 1.4-2.5 4.9-2.9 6.9-4.9C125.6 43.5 116.3 48.3 111.5 53.7zM108.7 57.7c4.6 0.6 10.2 0.3 14.3 1.4 2.4-1.8 4.6-3.8 7.5-5.2C122.4 52.3 113.7 54.5 108.7 57.7zM138.2 54.8c-3.6 0.5-4.2 3.8-8 4C133.9 59.7 138 58.4 138.2 54.8zM103.8 63.7c2.7-1.8 11.9 1.9 12-3.2C110.9 60 105.3 60 103.8 63.7zM119 61.7c0.7 1.4-0.4 2.9 0 3.7 2.4 0 3.7-1.1 3.4-3.7C121.8 61.3 119.6 61.3 119 61.7zM126.4 65.1c4.1-0.3 11.1 1.8 14.6-0.6C138.9 59.6 128.5 62.6 126.4 65.1zM130.7 67.7c3.4 3.1 8 5 14.6 4.9C143.7 69 137.3 66.5 130.7 67.7zM110.1 71.7c4.6 4.2 17.8 5.3 23.2 1.1 -3.3-2.2-6.9-4-12-3.2C118.1 70.3 114.1 72.8 110.1 71.7zM108.4 74.3c-0.5 0.2 0 0.5 0 0.9 9.8 7 20.8 12.9 34.7 15.8 -3.7-4.5-6.7-9.5-11.5-12.9C122.6 78.9 114.6 77.2 108.4 74.3zM135.6 76c2.6 2.5 9 2.6 13.8 2C147.2 74.3 140.9 76.5 135.6 76zM109.8 78.3c-0.4 0.1 0 0.3 0 0.6 3.9 3.2 8.4 5.5 12 8.9 3.6 3.3 7.2 6.8 8.9 12 1.5 0.5 2.8 1.2 3.7 2.3 0-6.3-5.4-10.3-9.7-13.8C120 84.6 114.9 81.2 109.8 78.3zM136.2 79.2c1.7 2.9 7.1 4.5 12.3 4.9 0.1-1-0.1-1.6-0.3-2.3C144.9 80.2 139 81.2 136.2 79.2zM152.5 81.2c-0.6 0.2-0.9 0.6-1.4 0.9 -0.1 1.2 0.4 1.9 0.9 2.6C152.5 83.8 152.3 82.3 152.5 81.2zM110.1 81.5c-0.8 0.6 0.1 1.8 0 2.6 4.4 2.6 7.6 6.4 8.9 12 0.5 0 1 0 1.4 0 0.8 2 2.3 3.5 3.4 5.2 1.7-0.2 2-1.9 4.3-1.4C125.3 90.5 116.8 86.9 110.1 81.5zM141.9 85.2c0.5 2.1 3 4.6 6 5.2 0.1-1.3 0-2.5-0.6-3.2C144.9 87.2 143.2 86.4 141.9 85.2zM149.7 86.7c0.1 1.6 0.9 2.5 1.4 3.7 0.8-0.6 1-1.8 1.4-2.9C151.4 87.4 151.1 86.4 149.7 86.7zM127.6 88.1c2.8 2.9 5.3 6.2 10 7.2C135.1 92.1 132.6 88.8 127.6 88.1zM140.5 93.2c0.5 1 0 3 2 2.6 0.3-0.3 0.3-1 0.3-1.7C142 93.9 141.6 93.2 140.5 93.2zM144.2 98.7c1.1-1.2 3.1-3 3.4-4C146 94.4 144.1 96.2 144.2 98.7zM136.8 98.1c-0.7 0.6 0.1 1.1 0 2 0.8 0.2 0.7-0.4 1.4-0.3C138.2 98.8 137.6 98.3 136.8 98.1zM140.5 101.6c-0.9-0.5-2.3 0.9-2.3 2.3C139 103.2 139.3 101.9 140.5 101.6z"/><path id="leftwing" d="M78.9 60c3.6-0.1 6 0.9 8 2.3 2.9 12.6 0.4 28-5.4 35.6 -6.9-0.3-10.4-3.9-11.8-9.7 -4.9 4-10 7.8-11.5 15.2 -1.5 0.3-2.9 0.8-3.2 2.3 -1.6-0.4-2.3-0.7-3.4 0.3 -5.8-1.3-7.5 3.5-12.3 4 -2.1-3.3-3.7-7-9.7-6.3 -0.3-1.6 0.9-1.8 0.6-3.4 -3-5.3-9-0.8-12.3 2 -2.6 2.3-4.7 5.5-7.7 7.7 -2.7 2-6.5 5.7-10 2.6 1.4-9.8 16-13 21.8-18.6 2.8-2.7 0.9-4.6-1.4-6.9 0.1-1.6 1.7-1.7 2.3-2.9 -0.9-1.8-2.1-2.2-2-4 0.1-2.4 4-3.6 4.3-6.6 0.2-1.6-0.9-1.8-0.6-4 1.3-1.1 4.1-0.6 6-1.1 -0.3-1.9-0.6-4.8 0-6.6 1.5-0.9 4.1-0.6 6-1.1 -3.9-3.2-10.2-7.1-10-14.6 0-2.3 1.4-5.2 2-8.3 1.5-7.6 1.6-16.6 1.1-25.8C29.3 6.5 30.3-0.7 37.3 0.1 63.3 3 74 35.9 78.9 60zM35 12.7c-0.6-4.3 1-6.5 4.6-6.6C36 0.5 31.5 8.9 35 12.7zM53.9 18.4c1.3 1.4 3.5 2 4.9 3.2 1.8 1.5 3 4.2 4.6 4C60 17.9 54.9 10.3 47.9 7.2 51.2 9.9 51 15.3 53.9 18.4zM50.2 29.3c-2.9-7.4-5.1-15.5-11.5-19.5C38.1 19.4 44.5 26 50.2 29.3zM35 26.4c-1.7-1.9-1.2-6.7 2.3-6C33 15.9 31.1 26.3 35 26.4zM55.6 38.2c1 2 3.9 4 5.7 6 5.9 6.4 10.9 12.9 15.8 19.8 -2.5-12.5-5.4-24.6-13.2-32.7 -3.6-3.7-8.2-6.2-10.9-10.6C54.3 27.4 53.2 33.4 55.6 38.2zM51.6 35.9c-0.3-1.1-0.6-2-0.9-3.2 -4.4-1.7-8-4.3-10-8.3 -0.9-0.4-2.2-0.3-3.4-0.3C39.3 30.8 45.7 33.1 51.6 35.9zM34.4 38.5c-1-1.8-1.7-3.9-2.6-5.7C31.4 35.1 31.7 38.4 34.4 38.5zM36.1 33.9c1.1 3.4 4.8 4.2 6.3 7.2 5.6 0.4 10 3.6 15.5 3.2C52.4 39.2 46.1 33.5 36.1 33.9zM37.3 48.5c-2.1-1-4.3-2.9-3.7-5.7C27.9 43.7 33 50.7 37.3 48.5zM41.3 44.2c2 1.9 5.4 2.4 6.9 4.9 6.7 0.9 12.6 2.5 18.1 4.6C61.5 48.3 52.2 43.5 41.3 44.2zM47.3 54c2.9 1.3 5.1 3.3 7.5 5.2 4.1-1.1 9.7-0.8 14.3-1.4C64.1 54.5 55.3 52.3 47.3 54zM47.6 58.8c-3.8-0.2-4.5-3.6-8-4C39.8 58.4 43.9 59.7 47.6 58.8zM61.9 60.6c0.2 5.1 9.3 1.3 12 3.2C72.5 60 66.9 60 61.9 60.6zM55.3 61.7c-0.2 2.6 1 3.8 3.4 3.7 0.4-0.8-0.7-2.3 0-3.7C58.1 61.3 56 61.3 55.3 61.7zM36.7 64.6c3.5 2.4 10.5 0.3 14.6 0.6C49.3 62.6 38.9 59.6 36.7 64.6zM32.4 72.6c6.6 0.1 11.2-1.8 14.6-4.9C40.5 66.5 34 69 32.4 72.6zM56.5 69.7c-5.2-0.8-8.7 0.9-12 3.2 5.5 4.1 18.7 3 23.2-1.1C63.7 72.8 59.7 70.3 56.5 69.7zM46.2 78.1c-4.7 3.4-7.8 8.4-11.5 12.9 13.9-2.9 24.9-8.8 34.7-15.8 0-0.3 0.5-0.6 0-0.9C63.2 77.2 55.2 78.9 46.2 78.1zM28.4 78.1c4.8 0.6 11.2 0.5 13.8-2C36.9 76.5 30.5 74.3 28.4 78.1zM53 88.4c-4.3 3.4-9.8 7.4-9.7 13.8 0.9-1.1 2.2-1.8 3.7-2.3 1.7-5.2 5.3-8.7 8.9-12 3.7-3.4 8.1-5.7 12-8.9 0-0.3 0.4-0.4 0-0.6C62.9 81.2 57.8 84.6 53 88.4zM29.5 81.8c-0.2 0.7-0.4 1.3-0.3 2.3 5.2-0.3 10.6-2 12.3-4.9C38.7 81.2 32.8 80.2 29.5 81.8zM25.8 84.6c0.5-0.7 0.9-1.4 0.9-2.6 -0.5-0.3-0.8-0.7-1.4-0.9C25.5 82.3 25.3 83.8 25.8 84.6zM49.6 99.8c2.3-0.4 2.6 1.3 4.3 1.4 1.2-1.7 2.6-3.1 3.4-5.2 0.5 0 1 0 1.4 0 1.3-5.7 4.5-9.5 8.9-12 -0.1-0.8 0.8-2 0-2.6C60.9 86.9 52.4 90.5 49.6 99.8zM30.4 87.2c-0.6 0.7-0.7 1.8-0.6 3.2 3-0.5 5.6-3 6-5.2C34.5 86.4 32.8 87.2 30.4 87.2zM25.2 87.5c0.4 1 0.6 2.2 1.4 2.9 0.5-1.2 1.3-2.1 1.4-3.7C26.6 86.4 26.4 87.4 25.2 87.5zM40.1 95.3c4.7-1 7.2-4.2 10-7.2C45.1 88.8 42.7 92.1 40.1 95.3zM35 94.1c0 0.7 0 1.4 0.3 1.7 2 0.4 1.5-1.6 2-2.6C36.2 93.2 35.8 93.9 35 94.1zM30.1 94.7c0.3 1 2.3 2.9 3.4 4C33.7 96.2 31.8 94.4 30.1 94.7zM39.6 99.8c0.7-0.1 0.6 0.5 1.4 0.3 -0.1-0.9 0.7-1.4 0-2C40.1 98.3 39.5 98.8 39.6 99.8zM39.6 103.9c0.1-1.4-1.4-2.8-2.3-2.3C38.5 101.9 38.7 103.2 39.6 103.9z"/><path id="tail" d="M146 229.8c1.8-3.3 1.5-7.5 4.3-10.1 -2-5.3 0.6-12.5-1.2-17.8 -5.6-7.1-8.8-15.2-18.3-20.7 -6.5-1.7-14.5-9.2-22.2-9.3 -4.7-2.4-5.9-6.3-10.4-8.7 0.8-0.8 1-1.7 0.9-2.6l-13.4-3.7c-0.9 3.9 0.5 6.9-0.2 10.8 4.4 4.3 5.6 10.4 11.7 13.6 3.1 1.6 6.9-0.4 9 3.6 8.4 4.5 18.5 0.8 23.2 10 0 0 0 0 0-0.1 5.3 3.7 6.6 9 9.4 13.7 0.2 3 0.4 6.7 0.6 8.9 0.5 4.1 0 2.9-1.8 6.8 -1 2.2-0.4 2.5-1 5 -4.8 0.9-6.5 6-10.2 8.7 -3.1 2.3-7.5 2.5-9.9 5.6 6.5 0.9 11.8-1.1 17.8-1.2 1.6-4.2 4.7-3.2 6.4-4.9 1.1-1.1 1-3.4 1.9-4.6C143.8 231.2 145.4 231 146 229.8z"/><path id="head" d="M97.5 43.8c0.5-1.7 1.8-3 2.6-4.7 0.4-0.9-0.1-2.1 0.5-3.2 0.1-0.2 0.9 0.1 1.1 0 1.1-1.1-0.1-4.1 1.1-6.3 0.5-2-2.3-0.9-1.6-3.2 1.6-4.8-0.3-12.8-3.2-13.2 1.8-0.6-1.5-0.2-0.5-1.6 -2.5-0.6-5-1.3-7.4-2.1 -1.1 0-2.1 0-3.2 0 -0.2 1.7-3 0.8-4.7 1.1 0.4 1.4-0.9 0.7-1.6 1.1 -0.6 0.4-1.3 1.3-1.6 1.6 -0.1 0.1-1 0.4-1.1 0.5 -0.5 1.2-0.8 3.1-2.1 4.2 0.9 2.7-0.9 6.1 0.5 9 0.3 1.1-0.8 1.1-1.1 1.6 -0.9 1.5-0.4 7.5 2.1 7.9 0 3.3 1.7 5 2.6 7.4 -0.1 1.4 0 3 0 4.6 5.8 0 11.6 0 17.4 0C97.4 46.8 97.5 45.3 97.5 43.8z"/><path id="lefthand" d="M48.4 162.4c0 0.7 0 1.4 0 2.1 0.3 0 0.6 0.4 0 0.5 0 1.6 0 3.2 0 4.7 1.7-0.6 0.8 1.5 1.1 2.1 0.3 0.8 1.2 1.4 1.6 2.1 1.7 3 2.5 4 5.3 5.3 0.9 0.4 1.9 1.6 3.2 1.1 1.3-2.9-0.6-3.8-2.1-5.3 -0.2-1.3 2.4 0.3 1.6-1.6 -2.1-2.3-7.7-3.9-5.3-9 4.1-0.6 1.3 5.7 5.3 5.3 0.5-3 0-7 0.5-11.1 -0.6-1.6-2.4-3.4-2.6-5.3 0 0 0-0.1 0-0.1l-7.3 0C49.4 156.6 49 159.6 48.4 162.4z"/><path id="leftleg" d="M78 266.8c-0.7-4.4-0.5-11.2 0-16.9 0.4-4.1 1.8-7.8 2.1-11.6 0.2-3.3 0.3-6.9 0-10 -0.4-3.5-2.2-6.2-2.1-9 0.1-1.9 1.4-3.7 2.1-5.8 1.1-3.3 2.2-6.8 2.6-10 0.9-6.3 0.6-13.4 1.1-20 0.4-5 1.6-8.6 2.6-12.1 0.3-0.9 0.9-1.4 1.1-2.1 0.7-3.5-0.9-6.7 1.3-8.1 -8.6 0-17.2 0-25.9 0 -0.1 9.7 1.1 19.4 1.5 28.6 0.2 3.8-0.3 7.7 0 11.1 0.3 3.5 0.7 7.9 0 11.1 0 0.2-1 1.3-1.1 1.6 -0.2 1.6-0.3 3.2-0.5 4.7 -0.7 5.4-0.9 12.8-0.5 17.9 0.3 4.6 1.5 7.4 2.6 10.5 1.1 3.2 2 6.1 2.6 9.5 0.2 1 0.9 2 1.1 3.2 0.2 1.3-0.2 2.9 0 4.2 0.2 1.5 0.9 2.4 1.1 3.7 0 0 0 0 0 0h8.5C78 267.1 78 267 78 266.8z"/><path id="leftfoot" d="M78.1 267.3h-8.5c0.5 5.9-1.2 9.3-1.1 14.2 -1.7 3-3.8 7.9-3.2 11.6 2 2.4 9.1-0.4 11.1 2.1 0.7 0 1.4 0 2.1 0 3.9-5-0.7-15.5 2.1-21.1C80 271.9 78.6 269.8 78.1 267.3z"/><path id="leftarm" d="M63.2 59.1c-0.6 0.2-0.7 0.9-1.1 1.1 -0.4 0.2-1.2-0.2-1.6 0 -0.5 0.3-0.2 0.8-0.5 1.1 -0.4 0.2-1.2-0.2-1.6 0 -0.5 0.3-0.2 0.8-0.5 1.1 -0.2 0.2-0.8-0.2-1.1 0 -0.2 0.1-0.4 1-0.5 1.1 -1.2 0.6-0.6 0.5-1.6 1.6 -0.6 0.6-1.5 1.4-2.1 3.2 -0.3 0.8-0.3 1.2-0.5 1.6 -0.8 1.8-1 7-1.6 11.1 -0.5 2.9-1.3 6-1.6 9 -0.7 8 2.4 17.9 0 24.3 0 0.1-0.5 0-0.5 0 0 4.9 0 9.8 0 14.8 0.9 7.7 1.6 16.6 1.1 24.7l7.3 0c-0.1-1.1 0.6-3.1 1.1-5.2 0.7-2.9 1.7-6.3 2.1-7.9 0.8-3.1 1.4-6.1 1.6-9 0.5-6.1-1.2-12.9-0.5-17.9 0.3-1.8 1.2-3.6 1.6-5.3 0.5-2.1 0.8-4.2 1.1-6.3 0.5-4.2 0-8.9 2.5-11.9V59.1C65.2 59 64.1 58.8 63.2 59.1z"/><path id="rightfoot" d="M96.9 274c1.3 2.8 1.2 6.6 1.1 10.1 -0.2 4.2-0.9 8.1 1.1 11.2 0.5 0 1.1 0 1.6 0 0.5-1.3 2.2-0.9 3.7-1.1 3-0.3 6.7 0.3 8.4-1.1 0.3-4.1-2.2-7.7-3.2-11.7 -0.4-1.6-0.2-3-0.5-4.8 -0.3-1.5-1-3.2-1.1-4.8 -0.1-1.3 0-2.6 0.1-4h-9C98.6 270.2 97.9 272.3 96.9 274z"/><path id="torso" d="M89.5 161.7c8.4 0 16.9 0 25.5 0 0-1.2-0.1-2.4-0.1-3.5 -0.5-7.1-1.7-14.2-2.6-21.2 -0.5-3.6-0.9-7.1-1.6-10.6 -1.1-5.7-3-12.3-2.1-19.1 0.3-2.7 1.8-5 2.1-7.4 0.4-3.2-1-6.5 0.8-9.7v-31.1c-0.8 0-1.6 0.1-2.4 0 -1.3-1.7-3.9-1.3-5.8-2.1 -0.3-0.1-1.4-1.2-2.1-1.6 -0.9-0.4-1.9-0.4-2.6-1.1 -0.8-1.5-1-3.7-1.1-6 -5.8 0-11.6 0-17.4 0 0 2 0 4-0.6 5.5 -1 0.3-1.7 1-2.6 1.6 -0.4 0.3-1 0.2-1.6 0.5 -0.5 0.3-0.5 0.8-1.1 1.1 -0.6 0.3-1.5-0.2-2.1 0 -0.4 0.2-0.4 0.9-1.1 1.1 -0.6 0.2-1.5-0.2-2.1 0 -0.2 0.1-0.9 1-1.1 1.1 -0.6 0.1-1.2 0.1-1.8 0v30.9c0.1-0.1 0.1-0.1 0.2-0.2 0.7 2.8 0.1 5.9 0.5 9 0.4 2.8 1.8 5.2 2.1 7.9 0.3 2.8 0.2 6.4 0 9.5 -0.4 4.9-2 9.2-2.6 13.2 -0.2 1.2 0.1 2.5 0 3.7 -0.1 1.2-0.9 2.1-1.1 3.2 -0.2 1.4 0.2 2.8 0 4.2 -0.2 1.1-0.9 2.2-1.1 3.2 -0.2 1.8 0.2 3.5 0 5.3 -0.2 1.5-0.9 3.2-1.1 4.8 -0.3 2.6-0.4 5.2-0.4 7.8 8.7 0 17.3 0 25.9 0H89.5z"/><path id="rightleg" d="M114.9 217.2c-0.5-4.3-2-8.4-2.1-12.7 -0.1-4.3 0.9-9.1 1.1-13.7 0.1-2.8-0.1-5.2 0-7.9 0.3-7.2 1.3-14.5 1.2-21.8 -8.6 0-17 0-25.5 0 -0.4 6.7 3.5 13.3 4.2 20.2 0.3 3.5-0.2 6.7 0 10 0.3 4.6 0.8 9.1 1.6 13.2 0.4 2.1 1 3.9 1.6 5.8 0.2 0.5-0.1 1.1 0 1.6 0.1 0.2 0.9 0.8 1.1 1.1 0.2 0.6-0.3 1.5 0 2.1 0.1 0.1 0.9-0.1 1.1 0 0.1 0.1-0.1 0.8 0 1.1 1.2 4-0.5 6.8-1.1 10.5 -0.6 4.7-0.6 10.8 0 15.8 0.1 1.2 0.8 2.5 1.1 3.7 0.3 1.5 0.4 2.9 0.5 4.2 0.6 6.4 0.5 12.6-0.5 17.6h9c0.2-2.9 0.6-5.9 1-7.6 0.7-3.3 1.3-5.8 2.1-8.4 0.6-2.2 1.5-5 2.1-6.3 0.6-1.3 1.3-3.1 1.6-4.2C116.5 233.7 115.9 225 114.9 217.2z"/><path id="rightarm" d="M128 154c-0.5-11.9 1.1-24.4 1.6-33.7 0-1.4 0-2.8 0-4.2 -3.4-6.7 0.2-18.4-1.1-29 -0.2-2-1.2-3.8-1.6-5.8 -0.9-5.7-0.5-10-2.6-14.2 -0.2-0.3-0.3-1.2-0.5-1.6 -0.1-0.2-0.9 0.2-1.1 0 -0.2-0.2-0.6-1.6-1.1-2.1 -0.6-0.7-1-1.2-2.6-2.1 -0.7-0.4-0.6-0.1-1.1-0.5 -0.7-0.7-1.4 0-3.2-0.5 -0.7-0.2-0.5-0.9-1.6-1.1 -0.6-0.1-1.2-0.1-1.8 0v31c0.1-0.1 0.1-0.3 0.2-0.4 -0.6 0.9 1 0.9 1.1 1.1 0.3 0.6-0.2 1.5 0 2.1 1.5 4.5 1.1 11.6 2.1 15.8 0.4 1.8 1.4 3.5 1.6 5.3 0.8 6.9-1.3 15.2 0 20.6 1.7 6.9 3.4 13.1 4.2 20h7.4C128.1 154.3 128.1 154.1 128 154z"/><path id="righthand" d="M120.7 154.5c0 0 0 0 0 0 -0.9 1.5-1.9 3-2.6 4.7 -0.4 1.7 0.5 3.6 0.5 5.3 0.1 1.9-1.6 4.8 0.5 5.3 2.1 0.7 1.5-5.8 5.3-5.3 0.6 2.2-0.1 3.8-1.1 5.3 -1 1.4-3.4 2.9-4.7 3.2 -0.3 2.7 1.9 0 1.6 2.1 -0.8 0.8-1.8 1.4-2.1 2.6 -1 0.7 1.2 1.1 0 2.6 2.4 0.1 4.9-1.2 5.8-2.1 0.5-0.5 0.5-1.4 1.1-2.1 0.8-1 2-2 2.6-3.2 2.9-5.2 1-10.9 0.6-18.5H120.7z"/></svg><div id="lefthandweapon"></div><div id="righthandweapon"></div><div id="overall" class="health-full">Top Shape</div></div><div id="hp-status"><div><span>HP:</span><div class="progressbar" id="hp-bar"><div class="progressbar-text">0/0</div><div class="progressbar-value"></div></div></div><div><span>SP:</span><div class="progressbar" id="sp-bar"><div class="progressbar-text">0/0</div><div class="progressbar-value"></div></div></div><div><span>MP:</span><div class="progressbar" id="mp-bar"><div class="progressbar-text">0/0</div><div class="progressbar-value"></div></div></div></div></div><div id="experience" class="status-panel"><div><span>XP:</span><span id="xp-value">0</span></div><div><span>Needed:</span><span id="need-value">0</span><div class="progressbar" id="need-percent"><div class="progressbar-text" style="text-align:right;right:2px;color:#000">0</div><div class="progressbar-value"></div></div></div><div><span>Earned:</span><span id="earn-value">0</span></div><div><span>BankedXP:</span><span id="xp-banked">0</span></div></div><div id="bars" class="flex-grow-1"><div id="party"></div><div id="combat"></div></div><div class="progressbar" id="lagMeter"><div class="progressbar-text">0.000 s</div><div class="progressbar-value" style="width:100%"></div></div></div><div id="status-simple"><div id="status-simple-hp" data-var="hp" class="progress"><div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div></div><div id="status-simple-sp" data-var="sp" class="progress"><div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div></div><div id="status-simple-mp" data-var="mp" class="progress"><div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div></div><div id="status-simple-xp" data-var="xp" class="progress"><div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div></div></div><div id="status-simple-lagMeter" class="progress"><div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div></div>';var ki=class extends Re{constructor(t){super(t);this.xe=[];this.Je=[];this.$t=[];this.An=!1;this.an=0;this.un=!1;this.li=document.getElementById("client-container"),ue.exist("statusMode")||t.setOption("statusMode",yt()?1:0)}get splitterDistance(){return this.gt}set splitterDistance(t){t!==this.gt&&(this.gt=t,this.Gn())}get maxWidth(){return Math.floor(document.body.clientWidth*.66)}get currentLag(){return!this.zi||!this.zi.firstElementChild?"":this.zi.firstElementChild.textContent||""}Gn(){let t=parseInt(this.$i.right,10)*2;if(!this.gt||this.gt<1){let e=this.Qe.getBoundingClientRect();this.gt=e.width+document.body.clientWidth-e.right}this.client.getOption("showStatus")?(this.client.getOption("statusMode")||(this.li.style.right=this.gt+"px"),this.Qe.style.width=this.gt-t+"px",document.getElementById("status-drag-bar").style.right=this.splitterDistance+"px"):this.fi(),this.client.setOption("statusWidth",this.gt),this.emit("split-moved",this.gt)}remove(){let t=this.client.telnet.GMCPSupports.indexOf("Char 1");this.client.telnet.GMCPSupports.splice(t,1),t=this.client.telnet.GMCPSupports.indexOf("Char.Vitals 1"),this.client.telnet.GMCPSupports.splice(t,1),t=this.client.telnet.GMCPSupports.indexOf("Char.Experience 1"),this.client.telnet.GMCPSupports.splice(t,1),t=this.client.telnet.GMCPSupports.indexOf("oMUD 1"),this.client.telnet.GMCPSupports.splice(t,1),t=this.client.telnet.GMCPSupports.indexOf("Char.Skills 1"),this.client.telnet.GMCPSupports.splice(t,1),this.client.removeListenersFromCaller(this),this.client.telnet.removeListenersFromCaller(this),delete window.Xn,delete window.Yh}initialize(){document.body.insertAdjacentHTML("beforeend",zs),this.Qe=document.getElementById("status"),this.$i=getComputedStyle(this.Qe),this.client.telnet.GMCPSupports.push("oMUD 1","Char 1","Char.Vitals 1","Char.Experience 1","Char.Skills 1"),this.client.on("received-GMCP",this.lr,this),this.client.on("window",(s,n,r)=>{s==="skills"&&(n==="close"?this.Ne&&this.Ne.close():this.go())}),this.client.on("close-window",s=>{s==="skills"&&this.Ne&&this.Ne.close()}),this.zi=document.getElementById("lagMeter"),this.client.telnet.on("latency-changed",(s,n)=>{this.bo(s)}),this.client.on("closed",()=>{this.bo(0,!0)}),this.client.telnet.GMCPSupports.push("oMUD 1"),this.client.telnet.GMCPSupports.push("Char.Skills 1"),this.client.on("add-line",s=>{switch(s.line){case"Connected...":this.yo();return;case"You feel a tingle as you are surrounded by magical shield.":case"You feel a tingle as you are surrounded by a magical shield.":case"You feel a tingle as you are surrounded by magical buffer.":case"You feel a tingle as you are surrounded by a magical buffer.":case"You feel a tingle as you are surrounded by magical protection.":case"You feel a tingle as you are surrounded by a magical protection.":case"Blood flows and covers you forming a protective skin.":case"You feel your skin strengthen.":case"You feel your skin harden.":case"^You feel your skin toughen.":document.getElementById("fullbody").classList.add("aura-blue");return;case"Your aura of protection wears off.":case"You feel your skin soften.":case"Blood flows off of you.":case"You remove a spell of protection from yourself.":document.getElementById("fullbody").classList.remove("aura-blue");return;case"You feel more protected as Makkairi's Shield envelops you.":document.getElementById("fullbody").classList.add("aura-red");return;case"You feel more vulnerable as Makkairi's Shield leaves you.":document.getElementById("fullbody").classList.remove("aura-red");return}s.line.match(/^.* removes a spell of protection from you.$/)&&document.getElementById("fullbody").classList.remove("aura-blue")}),this.client.on("options-loaded",()=>{this.xe.EXPERIENCE_NEED=this.xe.EXPERIENCE_NEED_RAW-this.xe.EXPERIENCE,this.client.getOption("showArmor")&&(this.ac=!0,this.Qe.querySelector("#health").classList.remove("active"),this.Qe.querySelector("#armor").classList.add("active"));let s=client.getOption("statusWidth");s>document.body.clientWidth-this.maxWidth&&(s=document.body.clientWidth-this.maxWidth),s<184&&s!=-1&&(s=184),this.splitterDistance=s,this.fi(),this.Ti()}),this.on("debug",s=>this.client.debug(s),this),this.on("error",s=>this.client.error(s),this),document.getElementById("status-drag-bar").addEventListener("mousedown",s=>{if(s.button!==0)return;s.preventDefault(),this.un=!0;let n=document.getElementById("status-drag-bar"),r=this.Qe.style.width;this.Qe.style.width="";let o=this.Qe.getBoundingClientRect();this.Qe.style.width=r;let a=n.getBoundingClientRect(),h=document.createElement("div");h.id="status-ghost-bar",h.style.top="0",h.style.bottom="0",h.style.left=a.left+"px",h.style.cursor="ew-resize",document.body.append(h);let c=Math.min(this.maxWidth,document.body.clientWidth-o.width);this.dn=g=>{g.pageX<=c?h.style.left=c-a.width+"px":g.pageX>o.left-a.width?h.style.left=o.left+parseInt(this.$i.right,10)-a.width+"px":h.style.left=g.pageX+"px"},document.addEventListener("mousemove",this.dn)}),window.addEventListener("resize",()=>this.fe()),document.addEventListener("mouseup",s=>{if(!this.un)return;let n=this.Qe.style.width;this.Qe.style.width="";let r=this.Qe.getBoundingClientRect(),o=r.width+parseInt(this.$i.right,10),a=document.getElementById("status-drag-bar").getBoundingClientRect().width,h=Math.min(this.maxWidth,document.body.clientWidth-o);this.Qe.style.width=n,s.pageX<=h?this.splitterDistance=document.body.clientWidth-h:s.pageX>r.left-a?this.splitterDistance=o:this.splitterDistance=document.body.clientWidth-s.pageX-a,document.getElementById("status-ghost-bar").remove(),document.removeEventListener("mousemove",this.dn),this.un=!1,this.fi()}),document.getElementById("status-close").addEventListener("click",()=>{this.client.setOption("showStatus",!1),this.fi(),this.Ti()}),this.Qe.querySelector("#health").addEventListener("click",()=>{this.ac&&(this.ac=!1,this.Qe.querySelector("#health").classList.add("active"),this.Qe.querySelector("#armor").classList.remove("active"),this.client.setOption("showArmor",this.ac))}),this.Qe.querySelector("#armor").addEventListener("click",()=>{this.ac||(this.ac=!0,this.Qe.querySelector("#health").classList.remove("active"),this.Qe.querySelector("#armor").classList.add("active"),this.client.setOption("showArmor",this.ac))}),this.client.getOption("showArmor")&&(this.ac=!0,this.Qe.querySelector("#health").classList.remove("active"),this.Qe.querySelector("#armor").classList.add("active"));let t=client.getOption("statusWidth");t>document.body.clientWidth-this.maxWidth&&(t=document.body.clientWidth-this.maxWidth),t<184&&t!=-1&&(t=184),this.splitterDistance=t,Object.defineProperty(window,"$character",{get:()=>this.xe&&this.xe.name||"",configurable:!0}),Object.defineProperty(window,"$characterid",{get:function(){return-1},configurable:!0}),this.client.display.container.append(document.getElementById("status-simple-lagMeter")),this.Gn(),this.fi(),this.yo();let e=client.getWindowState("skills");e&&e.show&&this.go()}get menu(){return[{name:"-",position:5,exists:"#menu-plugins",id:"plugins"},{id:"status",name:this.client.getOption("showStatus")?" Hide status":" Show status",active:this.client.getOption("showStatus"),action:t=>{this.client.setOption("showStatus",!this.client.getOption("showStatus")),this.fi(),this.Ti()},icon:'<i class="bi bi-heart-pulse-fill"></i>',position:6},{name:" Show skills",action:()=>this.go(),icon:'<i class="bi bi-graph-up"></i>',position:"#menu-status"}]}get settings(){return[{name:" Status",action:"settings-status",icon:'<i class="bi bi-heart-pulse-fill"></i>',position:7}]}async lr(t,e){try{let s;switch(t.toLowerCase()){case"char.name":this.xe.name=e.name,this.al(e.name);break;case"char.base":this.yo(),this.xe.name=e.name,this.al(e.name);break;case"char.vitals":this.Hi("hp-bar",e.hp,e.hpmax),this.Hi("sp-bar",e.sp,e.spmax),this.Hi("mp-bar",e.mp,e.mpmax),this.xe.hp=e.hp,this.xe.hpmax=e.hpmax,this.xe.sp=e.sp,this.xe.spmax=e.spmax,this.xe.mp=e.mp,this.xe.mpmax=e.mpmax,this.Wn("status-simple-hp"),this.Wn("status-simple-sp"),this.Wn("status-simple-mp"),this.De(4);break;case"char.experience":this.xe.EXPERIENCE=e.current,this.xe.EXPERIENCE_NEED_RAW=e.need,this.xe.EXPERIENCE_NEED=e.need-e.current,this.xe.EXPERIENCE_NEED_P=e.needPercent,this.xe.EXPERIENCE_EARNED=e.earned,this.xe.EXPERIENCE_BANKED=e.banked,this.De(8);break;case"omud.ac":for(s in e)e.hasOwnProperty(s)&&(this.Ph(s,e[s]),this.hl(s));break;case"omud.limb":for(s in e)e.hasOwnProperty(s)&&(this.Oh(s,e[s]),this.hl(s));break;case"omud.weapons":for(s in e)e.hasOwnProperty(s)&&this.Bh(s,e[s]);break;case"omud.environment":if(e.weather){let n=document.getElementById("environment");n.classList.remove("weather-"+this.xe.WEATHER,"intensity-hard"),this.xe.WEATHER=e.weather,this.xe.WEATHER_INTENSITY=e.weather_intensity,e.weather!=="0"&&e.weather!=="none"&&n.classList.add("weather-"+e.weather),e.weather_intensity>6&&n.classList.add("intensity-hard")}if(e.tod){let n=document.getElementById("environment");n.classList.remove("day","night","twilight","dawn"),n.classList.add(e.tod),$("#environment").removeClass((r,o)=>(o.match(/(^|\s)moon\d(-\S+)?/g)||[]).join(" ")),e.moons&&(n.classList.add("moon1","moon1-"+e.moons[0]),n.classList.add("moon2","moon2-"+e.moons[1]),n.classList.add("moon3","moon3-"+e.moons[2]))}break;case"omud.combat":e.action==="leave"?(this.cl("combat"),this.emit("leave combat")):e.action==="add"?this.pl("#combat",this.$s(e,"combat_"),e.name,e.hp,100,this.ul(e,"monster-"),e.order):e.action==="update"?e.hp===0?this.dl(this.$s(e,"combat_")):this.pl("#combat",this.$s(e,"combat_"),e.name,e.hp,100,this.ul(e,"monster-"),e.order):e.action==="remove"&&this.dl(this.$s(e,"combat_"));break;case"omud.party":e.action==="leave"?(this.cl("party"),this.emit("leave party")):e.action==="add"?this.pl("#party",this.$s(e,"party_"),e.name,e.hp,100,this.ul(e,"party-"),e.name.replace('"',"")):e.action==="update"?e.hp===0?this.dl(this.$s(e,"party_"),!0):this.pl("#party",this.$s(e,"party_"),e.name,e.hp,100,this.ul(e,"party-"),e.name.replace('"',"")):e.action==="remove"&&this.dl(this.$s(e,"party_"),!0),(s=document.getElementById("party")).children.length?s.classList.add("hasmembers"):s.classList.remove("hasmembers");break;case"omud.skill":e.skill&&e.skill.length&&(this.xe.skills[e.skill]||(this.xe.skills[e.skill]={amount:0,bonus:0,percent:0}),e.hasOwnProperty("percent")&&(this.xe.skills[e.skill].percent=e.percent||0),e.hasOwnProperty("amount")&&(this.xe.skills[e.skill].amount=e.amount,this.xe.skills[e.skill].bonus=e.bonus||0,this.xe.skills[e.skill].category=e.category),this.Nh(e.skill,this.xe.skills[e.skill]),this.emit("skill updated",e.skill,this.xe.skills[e.skill]));break}}catch(s){this.emit("error",s)}}fi(t){if(!this.client.getOption("showStatus")){this.li.style.right="",this.Qe.style.visibility="hidden",this.Qe.style.display="none",document.getElementById("status-drag-bar").style.display="none",this.emit("updated-interface"),document.getElementById("status-simple").style.display="none",document.getElementById("status-simple-lagMeter").style.visibility=this.client.getOption("lagMeter")?"visible":"";return}if(this.client.getOption("statusMode")){this.li.style.right="",this.Qe.style.visibility="hidden",this.Qe.style.display="none",document.getElementById("status-drag-bar").style.display="none",document.getElementById("status-simple").style.display="",document.getElementById("status-simple-lagMeter").style.visibility=this.client.getOption("lagMeter")?"visible":"",this.emit("updated-interface");return}document.getElementById("status-simple").style.display="none",document.getElementById("status-simple-lagMeter").style.visibility="";let e=parseInt(this.$i.right,10)*2;this.li.style.right=this.gt+"px",this.Qe.style.width=this.gt-e+"px",this.Qe.style.visibility="",this.Qe.style.display="",document.getElementById("status-drag-bar").style.display="",this.client.getOption("statusExperienceNeededProgressbar")?($("#need-value").css("display","none"),$("#need-percent").css("display","block")):($("#need-value").css("display",""),$("#need-percent").css("display","none")),this.client.getOption("showStatusWeather")?$("#environment").css("display",""):$("#environment").css("display","none"),!this.client.getOption("showStatusLimbs")&&!this.client.getOption("showStatusHealth")?$("#body").css("display","none"):$("#body").css("display",""),this.client.getOption("showStatusLimbs")?$("#limbs").css("display",""):$("#limbs").css("display","none"),this.client.getOption("showStatusHealth")?$("#hp-status").css("display",""):$("#hp-status").css("display","none"),this.client.getOption("showStatusExperience")?$("#experience").css("display",""):$("#experience").css("display","none"),!this.client.getOption("showStatusPartyHealth")&&!this.client.getOption("showStatusCombatHealth")?$("#bars").css("min-height",""):$("#bars").css("min-height","0"),this.client.getOption("showStatusPartyHealth")?$("#party").css("display",""):$("#party").css("display","none"),this.client.getOption("showStatusCombatHealth")?$("#combat").css("display",""):$("#combat").css("display","none"),this.zi&&(this.client.getOption("lagMeter")?(this.zi.style.visibility="",this.zi.style.display="",this.bo(0,!0)):(this.zi.style.visibility="hidden",this.zi.style.display="none")),t||this.Gn(),this.emit("updated-interface")}al(t,e){!t||t.length===0?this.Qe.querySelector("#character-name").innerHTML="&nbsp;":this.Qe.querySelector("#character-name").textContent=t,this.client.connected&&e&&e.length&&(t&&t.length?t=`${t} - ${e}`:t=`${e}`),client.emit("set-title",t||"")}yo(){document.getElementById("fullbody").classList.remove("aura-red","aura-blue"),this.al(""),this.xe=[],this.xe.WEATHER="none",this.xe.WEATHER_INTENSITY=0,this.xe.EXPERIENCE=0,this.xe.EXPERIENCE_NEED=0,this.xe.EXPERIENCE_NEED_P=0,this.xe.EXPERIENCE_NEED_RAW=0,this.xe.EXPERIENCE_EARNED=0,this.xe.EXPERIENCE_BANKED=0,this.xe.skills={},this.Je=[],this.Je.head=0,this.Je.leftarm=0,this.Je.leftfoot=0,this.Je.lefthand=0,this.Je.leftleg=0,this.Je.rightarm=0,this.Je.rightfoot=0,this.Je.righthand=0,this.Je.rightleg=0,this.Je.torso=0,this.Je.overall=0,this.$t=[],this.$t.head=0,this.$t.leftarm=0,this.$t.leftfoot=0,this.$t.lefthand=0,this.$t.leftleg=0,this.$t.rightarm=0,this.$t.rightfoot=0,this.$t.righthand=0,this.$t.rightleg=0,this.$t.torso=0,document.getElementById("leftwing").style.display="none",document.getElementById("rightwing").style.display="none",document.getElementById("tail").style.display="none",this.Hi("hp-bar",0,0),this.Hi("sp-bar",0,0),this.Hi("mp-bar",0,0),this.Wn("status-simple-hp"),this.Wn("status-simple-sp"),this.Wn("status-simple-mp"),document.getElementById("xp-value").textContent="0",document.getElementById("xp-banked").textContent="0",document.getElementById("need-value").textContent="0",document.getElementById("earn-value").textContent="0",this.Hi("need-percent",0,0,"0"),this.Hi("status-simple-xp",0,0,"",!0),this.cl("combat"),this.cl("party"),document.getElementById("party").classList.remove("hasmembers"),this.Sa(),this.Ea(),this.Dh(),this.emit("skill init")}cl(t){let e=document.getElementById(t);e&&(e.innerHTML="")}Ea(){let t;if(this.An)for(t in this.Je)this.hl(t);else for(t in this.$t)this.hl(t);this.De(12)}Sa(){let t=document.getElementById("overall");if(t.className="",this.An)this.Je.overall===6.5?(t.textContent="Extensively",t.classList.add("armor-extensively")):this.Je.overall===6?(t.textContent="Completely",t.classList.add("armor-completely")):this.Je.overall===5.5?(t.textContent="Significantly",t.classList.add("armor-significantly")):this.Je.overall===5?(t.textContent="Considerably",t.classList.add("armor-considerably")):this.Je.overall===4.5?(t.textContent="Well",t.classList.add("armor-well")):this.Je.overall===4?(t.textContent="Adequately",t.classList.add("armor-adequately")):this.Je.overall===3.5?(t.textContent="Fairly",t.classList.add("armor-fairly")):this.Je.overall===3?(t.textContent="Moderately",t.classList.add("armor-moderately")):this.Je.overall===2.5?(t.textContent="Somewhat",t.classList.add("armor-somewhat")):this.Je.overall===2?(t.textContent="Slightly",t.classList.add("armor-slightly")):this.Je.overall===1?(t.textContent="Barely",t.classList.add("armor-barely")):(t.textContent="UNARMORED",t.classList.add("armor-unarmored"));else{let e=100;this.xe.hpmax!==0&&!isNaN(this.xe.hpmax)&&(e*=this.xe.hp/this.xe.hpmax),e>90?(t.textContent="Top shape",t.classList.add("health-full")):e>75?(t.textContent="Decent shape",t.classList.add("health-1-19")):e>60?(t.textContent="Slightly injured",t.classList.add("health-20-39")):e>45?(t.textContent="Hurting",t.classList.add("health-40-59")):e>30?(t.textContent="Badly injured",t.classList.add("health-60-79")):e>15?(t.textContent="Terribly injured",t.classList.add("health-80-99")):(t.textContent="Near death",t.classList.add("health-100"))}}hl(t){if(t=t.replace(/\s/g,""),t=t.toLowerCase(),t==="overall"){this.De(4);return}t==="righthoof"?t="rightfoot":t==="lefthoof"&&(t="leftfoot");let e=document.getElementById(t);e&&(e.setAttribute("class",""),e.style.display="block",this.An?this.Je[t]===6.5?e.classList.add("armor-extensively"):this.Je[t]===6?e.classList.add("armor-completely"):this.Je[t]===5.5?e.classList.add("armor-significantly"):this.Je[t]===5?e.classList.add("armor-considerably"):this.Je[t]===4.5?e.classList.add("armor-well"):this.Je[t]===4?e.classList.add("armor-adequately"):this.Je[t]===3.5?e.classList.add("armor-fairly"):this.Je[t]===3?e.classList.add("armor-moderately"):this.Je[t]===2.5?e.classList.add("armor-somewhat"):this.Je[t]===2?e.classList.add("armor-slightly"):this.Je[t]===1?e.classList.add("armor-barely"):e.classList.add("armor-unarmored"):this.$t[t]===100?e.classList.add("health-100"):this.$t[t]>=80?e.classList.add("health-80-99"):this.$t[t]>=60?e.classList.add("health-60-79"):this.$t[t]>=40?e.classList.add("health-40-59"):this.$t[t]>=20?e.classList.add("health-20-39"):this.$t[t]>=1?e.classList.add("health-1-19"):e.classList.add("health-full"))}Hi(t,e,s,n,r){let o=document.getElementById(t);if(o){let a=100;s!==0&&(a=e/s*100),r||(o.firstElementChild.textContent=n||e+"/"+s),o.lastElementChild.style.width=100-a+"%",o.lastElementChild.ariaValueNow=""+a}else return}Wn(t){let e,s=document.getElementById(t);if(!s)return;let n=s.dataset.var.toLowerCase();!this.xe||!this.xe[n+"max"]?e=100:e=this.xe[n]/this.xe[n+"max"]*100;let r=document.querySelector(`#${t}  .progress-bar`);r.style.width=100-e+"%",r.ariaValueNow=""+e}pl(t,e,s,n,r,o,a){let h=100;r!==0&&(h=n/r*100),h=Math.floor(h),e=e.replace(" ","");let c=document.getElementById(e);c?(a!==+c.getAttribute("data-order")&&(c.setAttribute("data-order",a),this.De(t==="#party"?2:1)),c.setAttribute("data-value",(100-h)/20*20),c.children[1].textContent=s,h=n/r*100,c.lastElementChild.firstElementChild.textContent=Math.ceil(h)+"%",c.lastElementChild.lastElementChild.style.width=100-h+"%"):(o||(o=s.replace(/\d+$/,"").trim().replace(" ","-")),c='<div title="'+s+'" class="combat-bar" id="'+e+'" data-value="'+(100-h)/20*20+'" data-order="'+a+'">',c+='<div class="combat-icon '+o+'"></div>',c+='<div class="combat-name"> '+s+"</div>",c+='<div class="progressbar"><div class="progressbar-text">'+h+"%</div>",c+='<div class="progressbar-value" style="width: '+(100-h)+'%"></div>',c+="</div></div>",$(t).append(c),this.De(t==="#party"?2:1))}dl(t,e){let s=document.getElementById(t);s&&(s.parentNode.removeChild(s),this.De(e?2:1))}La(t){let e=t.children("div").get();e.sort((s,n)=>{let r=+s.getAttribute("data-order"),o=+n.getAttribute("data-order");return r<o?-1:r>o?1:0}),$.each(e,(s,n)=>{t.append(n)})}bo(t,e){if(!this.zi||(this.client.getOption("showLagInTitle")&&this.al(this.xe.name||"",`${t/1e3}s`),!this.client.getOption("lagMeter")&&!e))return;let s=100;s=t/200*100,s>100&&(s=100),this.zi.lastElementChild.style.width=100-s+"%",this.zi.firstElementChild.textContent=t/1e3+"s";let n=document.querySelector("#status-simple-lagMeter .progress-bar");n.style.width=100-s+"%",n.ariaValueNow=""+s}De(t){t&&(this.Ye|=t,!(this.Ye===0||this.an)&&(this.an=window.requestAnimationFrame(()=>{(this.Ye&16)===16&&(this.Ea(),this.Ye&=-17),(this.Ye&1)===1&&(this.La($("#combat")),this.Ye&=-2),(this.Ye&2)===2&&(this.La($("#party")),this.Ye&=-3),(this.Ye&4)===4&&(this.Sa(),this.Ye&=-5),(this.Ye&8)===8&&(this.Ah(),this.Ye&=-9),this.an=0,this.De(this.Ye)})))}Ah(){$("#xp-value").text(this.xe.EXPERIENCE),$("#xp-banked").text(this.xe.EXPERIENCE_BANKED),this.xe.EXPERIENCE_NEED<0?($("#need-value").text(this.client.getOption("allowNegativeNumberNeeded")?this.xe.EXPERIENCE_NEED:0),this.Hi("need-percent",100-this.xe.EXPERIENCE_NEED_P,100,this.client.getOption("allowNegativeNumberNeeded")?this.xe.EXPERIENCE_NEED.toString():"0"),this.Hi("status-simple-xp",100-this.xe.EXPERIENCE_NEED_P,100,"",!0)):($("#need-value").text(this.xe.EXPERIENCE_NEED),this.Hi("need-percent",100-this.xe.EXPERIENCE_NEED_P,100,this.xe.EXPERIENCE_NEED.toString()),this.Hi("status-simple-xp",100-this.xe.EXPERIENCE_NEED_P,100,"",!0)),$("#earn-value").text(this.xe.EXPERIENCE_EARNED)}fe(){if(!this.client.getOption("showStatus"))return;let t=this.Qe.style.width;this.Qe.style.width="";let s=this.Qe.getBoundingClientRect().width+parseInt(this.$i.right,10),n=Math.min(document.body.clientWidth-this.maxWidth,document.body.clientWidth-s);this.Qe.style.width=t;let r=this.Qe.getBoundingClientRect();r.width<s?this.splitterDistance=s:r.width>n&&(this.splitterDistance=n)}get skills(){return this.xe.skills}getSkill(t){return t&&this.xe.skills[t]||0}get name(){return this.xe.name}get ac(){return this.An}set ac(t){this.An!==t&&(this.An=t,this.De(16),this.emit("display-changed"))}Ee(t){return t=t.replace(/\s/gi,"-"),t.replace(/[^a-zA-Z0-9_-]/gi,"")}$s(t,e){if(t)return t.id?(e||"obj_")+t.id:this.Ee(t.name||"")}ul(t,e){let s=[];return e||(e=""),t.class&&t.class.length>0&&s.push(e+this.Ee(t.class)),t.gender&&t.gender.length>0&&s.push(e+this.Ee(t.gender)),t.race&&t.race.length>0&&s.push(e+this.Ee(t.race)),t.guild&&t.guild.length>0&&s.push(e+this.Ee(t.guild)),t.name&&t.name.length>0&&s.push(e+this.Ee(t.name.replace(/\d+$/,"").trim())),s.join(" ").toLowerCase()}Bh(t,e){let s=t;t=t.replace(/\s/g,""),t=t.toLowerCase();let n=document.getElementById(t+"weapon");n&&(n.className="",e&&(n.classList.add("weapons"),e.quality&&e.quality.length>0&&n.classList.add("weapon-"+this.Ee(e.quality)),e.material&&e.material.length>0&&n.classList.add("weapon-"+this.Ee(e.material)),e.type&&e.type.length>0&&n.classList.add("weapon-"+this.Ee(e.type)),e.subtype&&e.subtype.length>0&&n.classList.add("weapon-"+this.Ee(e.subtype)),e.name&&e.name.length>0&&n.classList.add("weapon-"+this.Ee(e.name)),e.dominant&&n.classList.add("weapon-dominant"),e.subtype&&e.subtype.length>0?n.title=e.subtype+" in "+s:e.type&&e.type.length>0?n.title=e.type+" in "+s:n.title="weapon in "+s))}Ph(t,e){t=t.replace(/\s/g,""),t=t.toLowerCase(),t==="righthoof"?t="rightfoot":t==="lefthoof"&&(t="leftfoot"),this.Je[t]=e}Oh(t,e){t=t.replace(/\s/g,""),t=t.toLowerCase(),t==="righthoof"?t="rightfoot":t==="lefthoof"&&(t="leftfoot"),this.$t[t]=e}go(){this.Ne||(this.Ne=new ye(Object.assign({},client.getWindowState("skills")||{center:!0},{title:'<i class="bi bi-graph-up"></i><select id="filter-skills" class="form-select form-select-sm me-2 mb-1" title="Filter skills"><option value="All">All</option></select>',id:"win-skills",noFooter:!0,minHeight:350})),this.Ne.body.classList.add("skills"),this.Ne.on("resized",e=>{this.client.setOption("windows.skills",e)}),this.Ne.on("moved",e=>{this.client.setOption("windows.skills",e)}),this.Ne.on("maximized",()=>{this.client.setOption("windows.skills",this.Ne.windowState)}),this.Ne.on("restored",()=>{this.client.setOption("windows.skills",this.Ne.windowState)}),this.Ne.on("shown",()=>{this.client.setOption("windows.skills",this.Ne.windowState)}),this.Ne.on("closed",()=>{this.client.setOption("windows.skills",this.Ne.windowState),he("skills"),this.Ne&&!this.Ne.persistent&&(delete this.Ne,this.Ne=null)}),this.Ne.on("canceled",()=>{this.client.setOption("windows.skills",this.Ne.windowState),he("skills"),this.Ne&&!this.Ne.persistent&&(delete this.Ne,this.Ne=null)}),this.Ne.header.querySelector("#filter-skills").addEventListener("change",e=>{let s=this.Ne.body.querySelectorAll(".category"),n=this.Ne.header.querySelector("#filter-skills option:checked").textContent;n==="All"?s.forEach(r=>r.style.display=""):(s.forEach(r=>r.style.display="none"),this.Ne.body.querySelector(`#${n.toLowerCase()}`).style.display="")})),this.Gh(),this.Ne.show()}Gh(){let t=this.xe.skills,e={},s=0,n=Object.keys(t).sort();for(let o in n){let a=n[o];Object.prototype.hasOwnProperty.call(t,a)&&(e[t[a].category||"default"]?e[t[a].category||"default"]+=this.Lr(a):e[t[a].category||"default"]=this.Lr(a),s++)}var r="";if(s>0){this.ns=Object.keys(e).sort();let o="";for(let a in this.ns){let h=this.ns[a];o+=`<option value="${we(h)}">${we(h)}</option>`,!(e[h].length===0||!Object.prototype.hasOwnProperty.call(e,h))&&(r+='<div class="category" id="'+h.toLowerCase()+'">',(s>1||h!="default")&&(r+='<div class="category-title">'+we(h)+"</div>"),r+='<div class="category-body" id="'+h+'Body">'+e[h]+"</div></div>")}this.Ne.header.querySelector("#filter-skills").insertAdjacentHTML("beforeend",o)}else this.ns=[],r=r+='<div class="category" id="default">No skills</div>';this.Ne.body.innerHTML=r}Nh(t,e){if(!this.Ne)return;let s=this.Ne.body.querySelector(`#${this.Ee(t)}.label`);if(s)this.Ne.body.querySelector(`#${this.Ee(t)}Amount`).innerHTML=e.amount,e.bonus>0?this.Ne.body.querySelector(`#${this.Ee(t)}Bonus`).innerHTML="+"+e.bonus:e.bonus<0?this.Ne.body.querySelector(`#${this.Ee(t)}Bonus`).innerHTML='<span class="neg">-'+e.bonus+"</span>":this.Ne.body.querySelector(`#${this.Ee(t)}Bonus`).innerHTML=e.bonus,e.percent===100?this.Ne.body.querySelector(`#${this.Ee(t)}Percent`).innerHTML='<span class="maxed">MAX!</span>':this.Ne.body.querySelector(`#${this.Ee(t)}Percent`).innerHTML=e.percent+"%";else{s=this.Ne.body.querySelector(`#${e.category||"default"}Body`);var n=0,r;if(s){r=this.Ne.body.querySelector(`#${e.category||"default"}Body`).children,n=0;for(var a=0,h=r.length;a<h;a++)if(!(r[a].getAttribute("title")<t)){r[a].insertAdjacentHTML("beforebegin",this.Lr(t)),n=1;break}n||s.insertAdjacentHTML("beforeend",this.Lr(t))}else{var o=we(e.category||"default");this.ns.push(o.toLowerCase());let c='<div class="category" id="'+o.toLowerCase()+'">';c+='<div class="category-title">'+o+"</div>",c+='<div class="category-body" id="'+(e.category||"default")+'Body">'+this.Lr(t)+"</div></div>",r=this.Ne.body.querySelectorAll(".category");for(var a=0,h=r.length;a<h;a++)if(!(r[a].children[0].textContent<o)){r[a].insertAdjacentHTML("beforebegin",c),n=1;break}n||this.Ne.body.insertAdjacentHTML("beforeend",c),this.Wh()}}}Wh(){let t=this.Ne.header.querySelector("#filter-skills"),e=t.value;t.innerHTML='<option value="All">All</option>',this.ns.sort();let s="";for(let n in this.ns)s+=`<option value="${we(this.ns[n])}">${we(this.ns[n])}</option>`;t.insertAdjacentHTML("beforeend",s),t.value=e}Dh(){if(!this.Ne)return;this.Ne.body.innerHTML="";let t=this.Ne.header.querySelector("#filter-skills");t.innerHTML='<option value="All" selected>All</option>',this.ns=[]}Lr(t){let e=this.xe.skills[t],s=this.Ee(t),n='<div title="'+t+'" class="label" id="'+s+'">';return n+='<div class="skill" id="'+s+'Label">'+s+"</div>",n+='<div class="amount" id="'+s+'Amount">'+e.amount+"</div>",e.bonus>0?n+='<div class="bonus" id="'+s+'Bonus">+'+e.bonus+"</div>":e.bonus<0?n+='<div class="bonus" id="'+s+'Bonus"><span class="neg">-'+e.bonus+"</span></div>":n+='<div class="bonus" id="'+s+'Bonus">'+e.bonus+"</div>",e.percent===100?n+='<div class="percent" id="'+s+'Percent"><span class="maxed">MAX!</span></div>':n+='<div class="percent" id="'+s+'Percent">'+e.percent+"%</div>",n+="</div>",n}Ti(){let t=document.querySelector("#menu-status");client.getOption("showStatus")?(t.title="Hide status",t.classList.add("active"),document.querySelector("#menu-status a span").textContent=" Hide status"):(t.title="Show status",t.classList.remove("active"),document.querySelector("#menu-status a span").textContent=" Show status")}};var Hs="data:application/javascript;base64,KCgpPT57ZnVuY3Rpb24gZShlKXt0aGlzLm9rPSExLCIjIj09ZS5jaGFyQXQoMCkmJihlPWUuc3Vic3RyKDEsNikpLGU9KGU9ZS5yZXBsYWNlKC8gL2csIiIpKS50b0xvd2VyQ2FzZSgpO3ZhciBhPXthbGljZWJsdWU6ImYwZjhmZiIsYW50aXF1ZXdoaXRlOiJmYWViZDciLGFxdWE6IjAwZmZmZiIsYXF1YW1hcmluZToiN2ZmZmQ0IixhenVyZToiZjBmZmZmIixiZWlnZToiZjVmNWRjIixiaXNxdWU6ImZmZTRjNCIsYmxhY2s6IjAwMDAwMCIsYmxhbmNoZWRhbG1vbmQ6ImZmZWJjZCIsYmx1ZToiMDAwMGZmIixibHVldmlvbGV0OiI4YTJiZTIiLGJyb3duOiJhNTJhMmEiLGJ1cmx5d29vZDoiZGViODg3IixjYWRldGJsdWU6IjVmOWVhMCIsY2hhcnRyZXVzZToiN2ZmZjAwIixjaG9jb2xhdGU6ImQyNjkxZSIsY29yYWw6ImZmN2Y1MCIsY29ybmZsb3dlcmJsdWU6IjY0OTVlZCIsY29ybnNpbGs6ImZmZjhkYyIsY3JpbXNvbjoiZGMxNDNjIixjeWFuOiIwMGZmZmYiLGRhcmtibHVlOiIwMDAwOGIiLGRhcmtjeWFuOiIwMDhiOGIiLGRhcmtnb2xkZW5yb2Q6ImI4ODYwYiIsZGFya2dyYXk6ImE5YTlhOSIsZGFya2dyZWVuOiIwMDY0MDAiLGRhcmtraGFraToiYmRiNzZiIixkYXJrbWFnZW50YToiOGIwMDhiIixkYXJrb2xpdmVncmVlbjoiNTU2YjJmIixkYXJrb3JhbmdlOiJmZjhjMDAiLGRhcmtvcmNoaWQ6Ijk5MzJjYyIsZGFya3JlZDoiOGIwMDAwIixkYXJrc2FsbW9uOiJlOTk2N2EiLGRhcmtzZWFncmVlbjoiOGZiYzhmIixkYXJrc2xhdGVibHVlOiI0ODNkOGIiLGRhcmtzbGF0ZWdyYXk6IjJmNGY0ZiIsZGFya3R1cnF1b2lzZToiMDBjZWQxIixkYXJrdmlvbGV0OiI5NDAwZDMiLGRlZXBwaW5rOiJmZjE0OTMiLGRlZXBza3libHVlOiIwMGJmZmYiLGRpbWdyYXk6IjY5Njk2OSIsZG9kZ2VyYmx1ZToiMWU5MGZmIixmZWxkc3BhcjoiZDE5Mjc1IixmaXJlYnJpY2s6ImIyMjIyMiIsZmxvcmFsd2hpdGU6ImZmZmFmMCIsZm9yZXN0Z3JlZW46IjIyOGIyMiIsZnVjaHNpYToiZmYwMGZmIixnYWluc2Jvcm86ImRjZGNkYyIsZ2hvc3R3aGl0ZToiZjhmOGZmIixnb2xkOiJmZmQ3MDAiLGdvbGRlbnJvZDoiZGFhNTIwIixncmF5OiI4MDgwODAiLGdyZWVuOiIwMDgwMDAiLGdyZWVueWVsbG93OiJhZGZmMmYiLGhvbmV5ZGV3OiJmMGZmZjAiLGhvdHBpbms6ImZmNjliNCIsaW5kaWFucmVkOiJjZDVjNWMiLGluZGlnbzoiNGIwMDgyIixpdm9yeToiZmZmZmYwIixraGFraToiZjBlNjhjIixsYXZlbmRlcjoiZTZlNmZhIixsYXZlbmRlcmJsdXNoOiJmZmYwZjUiLGxhd25ncmVlbjoiN2NmYzAwIixsZW1vbmNoaWZmb246ImZmZmFjZCIsbGlnaHRibHVlOiJhZGQ4ZTYiLGxpZ2h0Y29yYWw6ImYwODA4MCIsbGlnaHRjeWFuOiJlMGZmZmYiLGxpZ2h0Z29sZGVucm9keWVsbG93OiJmYWZhZDIiLGxpZ2h0Z3JleToiZDNkM2QzIixsaWdodGdyZWVuOiI5MGVlOTAiLGxpZ2h0cGluazoiZmZiNmMxIixsaWdodHNhbG1vbjoiZmZhMDdhIixsaWdodHNlYWdyZWVuOiIyMGIyYWEiLGxpZ2h0c2t5Ymx1ZToiODdjZWZhIixsaWdodHNsYXRlYmx1ZToiODQ3MGZmIixsaWdodHNsYXRlZ3JheToiNzc4ODk5IixsaWdodHN0ZWVsYmx1ZToiYjBjNGRlIixsaWdodHllbGxvdzoiZmZmZmUwIixsaW1lOiIwMGZmMDAiLGxpbWVncmVlbjoiMzJjZDMyIixsaW5lbjoiZmFmMGU2IixtYWdlbnRhOiJmZjAwZmYiLG1hcm9vbjoiODAwMDAwIixtZWRpdW1hcXVhbWFyaW5lOiI2NmNkYWEiLG1lZGl1bWJsdWU6IjAwMDBjZCIsbWVkaXVtb3JjaGlkOiJiYTU1ZDMiLG1lZGl1bXB1cnBsZToiOTM3MGQ4IixtZWRpdW1zZWFncmVlbjoiM2NiMzcxIixtZWRpdW1zbGF0ZWJsdWU6IjdiNjhlZSIsbWVkaXVtc3ByaW5nZ3JlZW46IjAwZmE5YSIsbWVkaXVtdHVycXVvaXNlOiI0OGQxY2MiLG1lZGl1bXZpb2xldHJlZDoiYzcxNTg1IixtaWRuaWdodGJsdWU6IjE5MTk3MCIsbWludGNyZWFtOiJmNWZmZmEiLG1pc3R5cm9zZToiZmZlNGUxIixtb2NjYXNpbjoiZmZlNGI1IixuYXZham93aGl0ZToiZmZkZWFkIixuYXZ5OiIwMDAwODAiLG9sZGxhY2U6ImZkZjVlNiIsb2xpdmU6IjgwODAwMCIsb2xpdmVkcmFiOiI2YjhlMjMiLG9yYW5nZToiZmZhNTAwIixvcmFuZ2VyZWQ6ImZmNDUwMCIsb3JjaGlkOiJkYTcwZDYiLHBhbGVnb2xkZW5yb2Q6ImVlZThhYSIscGFsZWdyZWVuOiI5OGZiOTgiLHBhbGV0dXJxdW9pc2U6ImFmZWVlZSIscGFsZXZpb2xldHJlZDoiZDg3MDkzIixwYXBheWF3aGlwOiJmZmVmZDUiLHBlYWNocHVmZjoiZmZkYWI5IixwZXJ1OiJjZDg1M2YiLHBpbms6ImZmYzBjYiIscGx1bToiZGRhMGRkIixwb3dkZXJibHVlOiJiMGUwZTYiLHB1cnBsZToiODAwMDgwIixyZWQ6ImZmMDAwMCIscm9zeWJyb3duOiJiYzhmOGYiLHJveWFsYmx1ZToiNDE2OWUxIixzYWRkbGVicm93bjoiOGI0NTEzIixzYWxtb246ImZhODA3MiIsc2FuZHlicm93bjoiZjRhNDYwIixzZWFncmVlbjoiMmU4YjU3IixzZWFzaGVsbDoiZmZmNWVlIixzaWVubmE6ImEwNTIyZCIsc2lsdmVyOiJjMGMwYzAiLHNreWJsdWU6Ijg3Y2VlYiIsc2xhdGVibHVlOiI2YTVhY2QiLHNsYXRlZ3JheToiNzA4MDkwIixzbm93OiJmZmZhZmEiLHNwcmluZ2dyZWVuOiIwMGZmN2YiLHN0ZWVsYmx1ZToiNDY4MmI0Iix0YW46ImQyYjQ4YyIsdGVhbDoiMDA4MDgwIix0aGlzdGxlOiJkOGJmZDgiLHRvbWF0bzoiZmY2MzQ3Iix0dXJxdW9pc2U6IjQwZTBkMCIsdmlvbGV0OiJlZTgyZWUiLHZpb2xldHJlZDoiZDAyMDkwIix3aGVhdDoiZjVkZWIzIix3aGl0ZToiZmZmZmZmIix3aGl0ZXNtb2tlOiJmNWY1ZjUiLHllbGxvdzoiZmZmZjAwIix5ZWxsb3dncmVlbjoiOWFjZDMyIn07Zm9yKHZhciB0IGluIGEpZT09dCYmKGU9YVt0XSk7Zm9yKHZhciByPVt7cmU6L15yZ2JcKChcZHsxLDN9KSxccyooXGR7MSwzfSksXHMqKFxkezEsM30pXCkkLyxleGFtcGxlOlsicmdiKDEyMywgMjM0LCA0NSkiLCJyZ2IoMjU1LDIzNCwyNDUpIl0scHJvY2VzczpmdW5jdGlvbihlKXtyZXR1cm5bcGFyc2VJbnQoZVsxXSwxMCkscGFyc2VJbnQoZVsyXSwxMCkscGFyc2VJbnQoZVszXSwxMCldfX0se3JlOi9eKFx3ezJ9KShcd3syfSkoXHd7Mn0pJC8sZXhhbXBsZTpbIiMwMGZmMDAiLCIzMzY2OTkiXSxwcm9jZXNzOmZ1bmN0aW9uKGUpe3JldHVybltwYXJzZUludChlWzFdLDE2KSxwYXJzZUludChlWzJdLDE2KSxwYXJzZUludChlWzNdLDE2KV19fSx7cmU6L14oXHd7MX0pKFx3ezF9KShcd3sxfSkkLyxleGFtcGxlOlsiI2ZiMCIsImYwZiJdLHByb2Nlc3M6ZnVuY3Rpb24oZSl7cmV0dXJuW3BhcnNlSW50KGVbMV0rZVsxXSwxNikscGFyc2VJbnQoZVsyXStlWzJdLDE2KSxwYXJzZUludChlWzNdK2VbM10sMTYpXX19XSxzPTAsbj1yLmxlbmd0aDtzPG47cysrKXt2YXIgZj1yW3NdLnJlLGM9cltzXS5wcm9jZXNzLGk9Zi5leGVjKGUpO2lmKGkpe3ZhciBvPWMoaSk7dGhpcy5yPW9bMF0sdGhpcy5nPW9bMV0sdGhpcy5iPW9bMl0sdGhpcy5vaz0hMH19dGhpcy5yPXRoaXMucjwwfHxpc05hTih0aGlzLnIpPzA6dGhpcy5yPjI1NT8yNTU6dGhpcy5yLHRoaXMuZz10aGlzLmc8MHx8aXNOYU4odGhpcy5nKT8wOnRoaXMuZz4yNTU/MjU1OnRoaXMuZyx0aGlzLmI9dGhpcy5iPDB8fGlzTmFOKHRoaXMuYik/MDp0aGlzLmI+MjU1PzI1NTp0aGlzLmIsdGhpcy50b1JHQj1mdW5jdGlvbigpe3JldHVybiJyZ2IoIit0aGlzLnIrIiwgIit0aGlzLmcrIiwgIit0aGlzLmIrIikifSx0aGlzLnRvSGV4PWZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5yLnRvU3RyaW5nKDE2KSxhPXRoaXMuZy50b1N0cmluZygxNiksdD10aGlzLmIudG9TdHJpbmcoMTYpO3JldHVybiAxPT1lLmxlbmd0aCYmKGU9IjAiK2UpLDE9PWEubGVuZ3RoJiYoYT0iMCIrYSksMT09dC5sZW5ndGgmJih0PSIwIit0KSwiIyIrZSthK3R9fWltcG9ydFNjcmlwdHMoImh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vbW9tZW50QDIuMzAuMS9tb21lbnQubWluLmpzIik7dmFyIGEsdCxyPXtvZmZsaW5lOiExLGdhZ2dlZDohMSxlbmFibGVkOiExLHVuaXF1ZTohMCxwcmVwZW5kOiExLG5hbWU6IiIsd2hhdDoxLGRlYnVnOiExLHRpbWVzdGFtcDowLHRpbWVzdGFtcEZvcm1hdDoiW1tdTU0tREQgSEg6bW06c3MuU1NTW11dICJ9LHM9ITEsbj0iIixmPSExLGM9IiIsaT17fSxvPTAsbD17fSxiPTAsZz17fSxkPW51bGw7ZnVuY3Rpb24gdSgpe2NvbnN0IGU9YztjPXIucHJlZml4P3IucHJlZml4K246bixyLm5hbWUmJnIubmFtZS5sZW5ndGg+MCYmKGMrPSIuIityLm5hbWUpLHIucG9zdGZpeCYmKGMrPXIucG9zdGZpeCksci5kZWJ1ZyYmZSE9PWMmJnBvc3RNZXNzYWdlKHtldmVudDoiZGVidWciLGFyZ3M6J0xvZyBmaWxlOiAiJytjKyciJ30pfWZ1bmN0aW9uIG0oZSx0LHMpe3RyeXtpZihnW2VdfHwoZ1tlXT1bXSksZ1tlXS5sZW5ndGgmJiFzKXJldHVybiB2b2lkIGdbZV0ucHVzaCh7ZmlsZTplLGRhdGE6dH0pO2dbZV0udW5zaGlmdCh7ZmlsZTplLGRhdGE6dH0pLHBvc3RNZXNzYWdlKHtldmVudDoid3JpdGUiLGZpbGU6ZSxkYXRhOnQsY2hhcmFjdGVyOnIubmFtZXx8IiIsdGltZVN0YW1wOmEscG9zdGZpeDpyLnBvc3RmaXgscHJlZml4OnIucHJlZml4fSl9Y2F0Y2goZSl7cG9zdE1lc3NhZ2Uoe2V2ZW50OiJlcnJvciIsYXJnczplfSl9fWZ1bmN0aW9uIHAoZSl7ZiYmKHIub2ZmbGluZXx8cykmJihjJiYwIT09Yy5sZW5ndGh8fHUoKSxtKGMrIi50eHQiLGUpKX1mdW5jdGlvbiBoKGUpe2YmJihyLm9mZmxpbmV8fHMpJiYoYyYmMCE9PWMubGVuZ3RofHx1KCksbShjKyIuaHRtIixlKSl9ZnVuY3Rpb24gayhlKXtmJiYoci5vZmZsaW5lfHxzKSYmKGMmJjAhPT1jLmxlbmd0aHx8dSgpLG0oYysiLnJhdyIsZSkpfWZ1bmN0aW9uIHcoZSl7aWYoIXR8fCF0LmxvZ2dpbmd8fCF0Lm9mZmxpbmUmJiF0LmNvbm5lY3RlZClyZXR1cm47Y29uc3QgYT1zLG49YyxpPWY7aWYoZj10LmxvZ2dpbmcscz10LmNvbm5lY3RlZCxjPXQuY3VycmVudEZpbGUsIXQuZ2FnZ2VkKXtsZXQgYT0iIjtlJiYoYT0iXG4iKSwxJn50LndoYXR8fGgoTSh7dGV4dDp0LmxpbmUsZm9ybWF0czp0LmZvcm1hdHMsdGltZXN0YW1wOnQudGltZXN0YW1wfHxEYXRlLm5vdygpfSkpLDImfnQud2hhdCYmMCE9PXQud2hhdHx8KDI9PT1yLnRpbWVzdGFtcD9wKG1vbWVudCh0LnRpbWVzdGFtcCkuZm9ybWF0KHIudGltZXN0YW1wRm9ybWF0KSk6MCE9PXIudGltZXN0YW1wJiZwKG5ldyBEYXRlKHQudGltZXN0YW1wKS50b0lTT1N0cmluZygpKSxwKHQubGluZSthKSksNCZ+dC53aGF0fHwobW9tZW50JiYyPT09ci50aW1lc3RhbXA/cCgiG1stNzstOG0iK21vbWVudCh0LnRpbWVzdGFtcCkuZm9ybWF0KHIudGltZXN0YW1wRm9ybWF0KSsiG1swbSIpOjAhPT1yLnRpbWVzdGFtcCYmcCgiG1stNzstOG0iK25ldyBEYXRlKHQudGltZXN0YW1wKS50b0lTT1N0cmluZygpKyIbWzBtIiksayh0LnJhdythKSl9Zj1pLHM9YSxjPW4sdD1udWxsfWZ1bmN0aW9uIHYoZSx0KXtyLmVuYWJsZWQ/KGY9ITAsKHIudW5pcXVlfHwwPT09YSkmJihhPShuZXcgRGF0ZSkuZ2V0VGltZSgpLG49bmV3IG1vbWVudChhKS5mb3JtYXQoci5mb3JtYXR8fCJZWVlZTU1ERC1ISG1tc3MiKSx3KCEwKSksdSgpLHIucHJlcGVuZCYmZSYmZS5sZW5ndGg+MCYmKDEmfnIud2hhdHx8aChmdW5jdGlvbihlKXtjb25zdCBhPVtdLHQ9ZS5sZW5ndGg7Zm9yKGxldCByPTA7cjx0O3IrKylhLnB1c2goTShlW3JdKSk7cmV0dXJuIGEuam9pbigiIil9KGV8fFtdKSksMiZ+ci53aGF0JiYwIT09ci53aGF0fHwoMj09PXIudGltZXN0YW1wP3AoZS5tYXAoKGU9Pm1vbWVudChlLnRpbWVzdGFtcCkuZm9ybWF0KHIudGltZXN0YW1wRm9ybWF0KStlLnRleHQpKS5qb2luKCJcbiIpKyh0fHwwPT09ZS5sZW5ndGg/IiI6IlxuIikpOjAhPT1yLnRpbWVzdGFtcD9wKGUubWFwKChlPT5uZXcgRGF0ZShlLnRpbWVzdGFtcCkudG9JU09TdHJpbmcoKStlLnRleHQpKS5qb2luKCJcbiIpKyh0fHwwPT09ZS5sZW5ndGg/IiI6IlxuIikpOnAoZS5tYXAoKGU9PmUudGV4dCkpLmpvaW4oIlxuIikrKHR8fDA9PT1lLmxlbmd0aD8iIjoiXG4iKSkpLDQmfnIud2hhdHx8KDI9PT1yLnRpbWVzdGFtcD9wKGUubWFwKChlPT4iG1stNzstOG0iK21vbWVudChlLnRpbWVzdGFtcCkuZm9ybWF0KHIudGltZXN0YW1wRm9ybWF0KSsiG1swbSIrZS5yYXcpKS5qb2luKCIiKSk6MCE9PXIudGltZXN0YW1wP3AoZS5tYXAoKGU9PiIbWy03Oy04bSIrbmV3IERhdGUoZS50aW1lc3RhbXApLnRvSVNPU3RyaW5nKCkrIhtbMG0iK2UucmF3KSkuam9pbigiIikpOmsoZS5tYXAoKGU9PmUucmF3KSkuam9pbigiIikpKSkscG9zdE1lc3NhZ2Uoe2V2ZW50OiJzdGFydGVkIixhcmdzOmZ9KSk6ZiYmeSgpfWZ1bmN0aW9uIHkoKXtmPSExLHBvc3RNZXNzYWdlKHtldmVudDoic3RvcHBlZCIsYXJnczpmfSl9ZnVuY3Rpb24gJChlKXtyZXR1cm4gZSYmMCE9PWUubGVuZ3RoP2UucmVwbGFjZSgvWyxdL2csIi0iKS5yZXBsYWNlKC9bXChcKVxzO10vZywiIik6bnVsbH1mdW5jdGlvbiBNKGUpe2NvbnN0IGE9W107bGV0IHQscz0wO2NvbnN0IG49ZS50ZXh0LGY9ZS5mb3JtYXRzLGM9Zi5sZW5ndGg7bGV0IGc9ITE7Y29uc3QgZD1bXTtpZigwIT09ci50aW1lc3RhbXApe3Q9W107bGV0IGU9SSgtOCk7bFskKGUpXT90LnB1c2goIiBiIixsWyQoZSldKToobFskKGUpXT1iLHQucHVzaCgiIGIiLGIpLGQucHVzaChgLmIke2J9IHsgYmFja2dyb3VuZC1jb2xvcjogJHtlfTsgfWApLGIrKyksZT1JKC03KSxpWyQoZSldP3QucHVzaCgiIGMiLGlbJChlKV0pOihpWyQoZSldPW8sdC5wdXNoKCIgYyIsbyksZC5wdXNoKGAuYyR7b30geyBjb2xvcjogJHtlfTsgfWApLG8rKyl9Mj09PXIudGltZXN0YW1wJiZtb21lbnQ/YS5wdXNoKCc8c3BhbiBjbGFzcz0idGltZXN0YW1wJywuLi50LCciJywuLi50LCI+Iixtb21lbnQoZS50aW1lc3RhbXApLmZvcm1hdChyLnRpbWVzdGFtcEZvcm1hdCksIjwvc3Bhbj4iKTowIT09ci50aW1lc3RhbXAmJmEucHVzaCgnPHNwYW4gY2xhc3M9InRpbWVzdGFtcCcsLi4udCwnIicsLi4udCwiPiIsbmV3IERhdGUoZS50aW1lc3RhbXApLnRvSVNPU3RyaW5nKCksIiA8L3NwYW4+IiksdD1udWxsO2ZvcihsZXQgZT0wO2U8YztlKyspe2NvbnN0IHI9ZltlXTtsZXQgdSxtLHA7aWYoZTxjLTEpe2lmKHU9ZltlKzFdLHIub2Zmc2V0PT09dS5vZmZzZXQmJnUuZm9ybWF0VHlwZT09PXIuZm9ybWF0VHlwZSljb250aW51ZTttPXUub2Zmc2V0fWVsc2UgbT1uLmxlbmd0aDtpZihzPXIub2Zmc2V0LDA9PT1yLmZvcm1hdFR5cGUpdD1bXSxwPXIuYmFja2dyb3VuZCwibnVtYmVyIj09dHlwZW9mIHAmJihwPUkocCkpLGxbJChwKV0/dC5wdXNoKCIgYiIsbFskKHApXSk6cCYmKGxbJChwKV09Yix0LnB1c2goIiBiIixiKSxkLnB1c2goYC5iJHtifSB7IGJhY2tncm91bmQtY29sb3I6ICR7cH07IH1gKSxiKyspLHA9ci5jb2xvciwibnVtYmVyIj09dHlwZW9mIHAmJihwPUkocCkpLGlbJChwKV0/dC5wdXNoKCIgYyIsaVskKHApXSk6cCYmKGlbJChwKV09byx0LnB1c2goIiBjIixvKSxkLnB1c2goYC5jJHtvfSB7IGNvbG9yOiAke3B9OyB9YCksbysrKSxpWyQoci5mb250KV0/dC5wdXNoKCIgZiIsaVskKHIuZm9udCldKTpyLmZvbnQmJihpWyQoci5mb250KV09byx0LnB1c2goIiBmIixvKSxkLnB1c2goYC5mJHtvfSB7IGZvbnQtZmFtaWx5OiAke3IuZm9udH07IH1gKSxvKyspLGlbJChyLnNpemUpXT90LnB1c2goIiBmIixpWyQoci5zaXplKV0pOnIuc2l6ZSYmKGlbJChyLnNpemUpXT1vLHQucHVzaCgiIGYiLG8pLGQucHVzaChgLmYke299IHsgZm9udC1zaXplOiAke3Iuc2l6ZX07IH1gKSxvKyspLDAhPT1yLnN0eWxlPygxJn5yLnN0eWxlfHx0LnB1c2goIiBiIiksNCZ+ci5zdHlsZXx8dC5wdXNoKCIgaSIpLDEwMjQmfnIuc3R5bGV8fHQucHVzaCgiIG8iKSw1MTImfnIuc3R5bGUmJjgmfnIuc3R5bGV8fHQucHVzaCgiIHUiKSxwPTUxMiZ+ci5zdHlsZT9yLmJhY2tncm91bmQ6ci5jb2xvciwibnVtYmVyIj09dHlwZW9mIHAmJihwPUkocCkpLGlbImJiIiskKHApXT90LnB1c2goIiBiYiIsaVsiYmIiKyQocCldKTpwJiYoaVsiYmIiKyQocCldPW8sdC5wdXNoKCIgYmIiLG8pLGQucHVzaChgLmJiJHtvfSB7IGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAke3B9OyB9YCksbysrKSwzMiZ+ci5zdHlsZSYmMTYmfnIuc3R5bGV8fCh0aGlzLmVuYWJsZUZsYXNoaW5nP3QucHVzaCgiIGFuc2ktYmxpbmsiKTo1MTImfnIuc3R5bGUmJjgmfnIuc3R5bGUmJnQucHVzaCgiIHUiKSksMjU2Jn5yLnN0eWxlfHx0LnB1c2goIiBzIikpOihwPXIuYmFja2dyb3VuZCwibnVtYmVyIj09dHlwZW9mIHAmJihwPUkocCkpLGlbImJiIiskKHApXT90LnB1c2goIiBiYiIsaVsiYmIiKyQocCldKTpwJiYoaVsiYmIiKyQocCldPW8sdC5wdXNoKCIgYmIiLG8pLGQucHVzaChgLmJiJHtvfSB7IGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAke3B9OyB9YCksbysrKSksdD0wIT09dC5sZW5ndGg/JyBjbGFzcz0iJyt0LmpvaW4oIiIpLnRyaW0oKSsnIic6IiIsci5ocj9hLnB1c2goJzxzcGFuIHN0eWxlPSJtaW4td2lkdGg6MTAwJTt3aWR0aDoxMDAlOyInLHQsJz48ZGl2IHN0eWxlPSJwb3NpdGlvbjpyZWxhdGl2ZTt0b3A6IDUwJTt0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTUwJSk7aGVpZ2h0OjRweDt3aWR0aDoxMDAlOyBiYWNrZ3JvdW5kLWNvbG9yOicsIm51bWJlciI9PXR5cGVvZiByLmNvbG9yP0koci5jb2xvcik6ci5jb2xvciwnIj48L2Rpdj48L3NwYW4+Jyk6bS1zIT0wJiZhLnB1c2goIjxzcGFuIiwuLi50LCI+IixxKG4uc3Vic3RyaW5nKHMsbSkpLCI8L3NwYW4+Iik7ZWxzZSBpZigxPT09ci5mb3JtYXRUeXBlKXtpZihhLnB1c2goJzxhIGRyYWdnYWJsZT0iZmFsc2UiIGNsYXNzPSJVUkxMaW5rIiBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCk7IiB0aXRsZT0iJyksYS5wdXNoKHIuaHJlZi5yZXBsYWNlKC8iL2csIiZxdW90OyIpKSxhLnB1c2goJyIgb25jbGljaz0iJyx0aGlzLmxpbmtGdW5jdGlvbiwiKCciLHIuaHJlZi5yZXBsYWNlKC9cXC9nLCJcXFxcIikucmVwbGFjZSgvIi9nLCImcXVvdDsiKSwiJyk7cmV0dXJuIGZhbHNlO1wiPiIpLG0tcz09MCljb250aW51ZTthLnB1c2goIjxzcGFuIiwuLi50LCI+IiksYS5wdXNoKHEobi5zdWJzdHJpbmcocyxtKSkpLGEucHVzaCgiPC9zcGFuPiIpfWVsc2UgaWYoMj09PXIuZm9ybWF0VHlwZXx8ND09PXIuZm9ybWF0VHlwZXx8OD09PXIuZm9ybWF0VHlwZSlhLnB1c2goIjwvYT4iKTtlbHNlIGlmKDM9PT1yLmZvcm1hdFR5cGUpe2lmKGEucHVzaCgnPGEgZHJhZ2dhYmxlPSJmYWxzZSIgY2xhc3M9Ik1YUExpbmsiIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKTsiIHRpdGxlPSInKSxhLnB1c2goci5ocmVmLnJlcGxhY2UoLyIvZywiJnF1b3Q7IikpLGEucHVzaCgnIicpLHIuZXhwaXJlJiZyLmV4cGlyZS5sZW5ndGgmJmEucHVzaChgIGRhdGEtZXhwaXJlPSIke3IuZXhwaXJlfSJgKSxhLnB1c2goJyBvbmNsaWNrPSInLHRoaXMubXhwTGlua0Z1bmN0aW9uLCIodGhpcywgJyIsci5ocmVmLnJlcGxhY2UoL1xcL2csIlxcXFwiKS5yZXBsYWNlKC8iL2csIiZxdW90OyIpLCInKTtyZXR1cm4gZmFsc2U7XCI+IiksbS1zPT0wKWNvbnRpbnVlO2EucHVzaCgiPHNwYW4iLC4uLnQsIj4iKSxhLnB1c2gocShuLnN1YnN0cmluZyhzLG0pKSksYS5wdXNoKCI8L3NwYW4+Iil9ZWxzZSBpZig3PT09ci5mb3JtYXRUeXBlKXtpZihhLnB1c2goJzxhIGRyYWdnYWJsZT0iZmFsc2UiIGNsYXNzPSJNWFBMaW5rIiBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCk7IiB0aXRsZT0iJyksYS5wdXNoKHIuaGludC5yZXBsYWNlKC8iL2csIiZxdW90OyIpKSxhLnB1c2goJyInKSxyLmV4cGlyZSYmci5leHBpcmUubGVuZ3RoJiZhLnB1c2goYCBkYXRhLWV4cGlyZT0iJHtyLmV4cGlyZX0iYCksYS5wdXNoKCcgb25tb3VzZW92ZXI9IicsdGhpcy5teHBUb29sdGlwRnVuY3Rpb24sJyh0aGlzKTsiJyksYS5wdXNoKCcgb25jbGljaz0iJyx0aGlzLm14cFNlbmRGdW5jdGlvbiwiKGV2ZW50fHx3aW5kb3cuZXZlbnQsIHRoaXMsICIsci5ocmVmLnJlcGxhY2UoL1xcL2csIlxcXFwiKS5yZXBsYWNlKC8iL2csIiZxdW90OyIpLCIsICIsci5wcm9tcHQ/IjEiOiIwIiwiLCAiLHIudHQucmVwbGFjZSgvXFwvZywiXFxcXCIpLnJlcGxhY2UoLyIvZywiJnF1b3Q7IiksJyk7cmV0dXJuIGZhbHNlOyI+JyksbS1zPT0wKWNvbnRpbnVlO2EucHVzaCgiPHNwYW4iLC4uLnQsIj4iKSxhLnB1c2gocShuLnN1YnN0cmluZyhzLG0pKSksYS5wdXNoKCI8L3NwYW4+Iil9ZWxzZSBpZig5PT09ci5mb3JtYXRUeXBlJiZtLXMhPTApYS5wdXNoKCI8c3BhbiIsLi4udCwiPiIpLGEucHVzaChxKG4uc3Vic3RyaW5nKHMsbSkpKSxhLnB1c2goIjwvc3Bhbj4iKTtlbHNlIGlmKDU9PT1yLmZvcm1hdFR5cGUpe2xldCBlPSIiO3N3aXRjaChhLnB1c2goJzxpbWcgc3JjPSInKSxyLnVybC5sZW5ndGg+MCYmKGEucHVzaChyLnVybCksZSs9ci51cmwsci51cmwuZW5kc1dpdGgoIi8iKXx8KGEucHVzaCgiLyIpLGUrPSIvIikpLHIudC5sZW5ndGg+MCYmKGEucHVzaChyLnQpLGUrPXIudCxyLnQuZW5kc1dpdGgoIi8iKXx8KGEucHVzaCgiLyIpLGUrPSIvIikpLGUrPXIubmFtZSxhLnB1c2goci5uYW1lLCciICBzdHlsZT0iJyksci53Lmxlbmd0aD4wJiZhLnB1c2goIndpZHRoOiIseChyLncpLCI7Iiksci5oLmxlbmd0aD4wJiZhLnB1c2goImhlaWdodDoiLHgoci5oKSwiOyIpLHIuYWxpZ24udG9Mb3dlckNhc2UoKSl7Y2FzZSJsZWZ0IjphLnB1c2goImZsb2F0OmxlZnQ7Iik7YnJlYWs7Y2FzZSJyaWdodCI6YS5wdXNoKCJmbG9hdDpyaWdodDsiKSxnPSEwO2JyZWFrO2Nhc2UidG9wIjpjYXNlIm1pZGRsZSI6Y2FzZSJib3R0b20iOmEucHVzaCgidmVydGljYWwtYWxpZ246IixyLmFsaWduLCI7Iil9ci5oc3BhY2UubGVuZ3RoPjAmJnIudnNwYWNlLmxlbmd0aD4wPyhhLnB1c2goIm1hcmdpbjoiKSxhLnB1c2goeChyLnZzcGFjZSksIiAiKSxhLnB1c2goeChyLmhzcGFjZSksIjsiKSk6ci5oc3BhY2UubGVuZ3RoPjA/KGEucHVzaCgibWFyZ2luOiIpLGEucHVzaCgiMHB4ICIseChyLmhzcGFjZSksIjsiKSk6ci52c3BhY2UubGVuZ3RoPjAmJihhLnB1c2goIm1hcmdpbjoiKSxhLnB1c2goeChyLnZzcGFjZSksIiAwcHg7IikpLGEucHVzaCgnIicpLHIuaXNtYXAmJmEucHVzaCgnIGlzbWFwIG9uY2xpY2s9InJldHVybiBmYWxzZTsiJyksYS5wdXNoKGBzcmM9IiR7ZX0iLz5gKX19cmV0dXJuIGQubGVuZ3RoJiZhLnB1c2goIjxzdHlsZT4iLC4uLmQsIjwvc3R5bGU+IiksZz9gPHNwYW4gY2xhc3M9ImxpbmUiIHN0eWxlPSJtaW4td2lkdGg6MTAwJSI+JHthLmpvaW4oIiIpfTxicj48L3NwYW4+YDpgPHNwYW4gY2xhc3M9ImxpbmUiPiR7YS5qb2luKCIiKX08YnI+PC9zcGFuPmB9ZnVuY3Rpb24gcShlKXtpZihlJiYwIT09ZS5sZW5ndGgpcmV0dXJuIGUucmVwbGFjZSgvJi9nLCImYW1wOyIpLnJlcGxhY2UoLyIvZywiJnF1b3Q7IikucmVwbGFjZSgvJy9nLCImIzM5OyIpLnJlcGxhY2UoLzwvZywiJmx0OyIpLnJlcGxhY2UoLz4vZywiJmd0OyIpfWZ1bmN0aW9uIHgoZSl7cmV0dXJuIGU/L15cZCtjJC8udGVzdChlKT9lKyJoIjovXlxkKyQvLnRlc3QoZSk/cGFyc2VJbnQoZSwxMCkrInB4IjplOmV9ZnVuY3Rpb24gRCgpe2NvbnN0IGU9W107bGV0IGEsdCxyLHM7Zm9yKGE9MDthPDY7YSsrKWZvcih0PTA7dDw2O3QrKylmb3Iocj0wO3I8NjtyKyspcz0xNiszNiphKzYqdCtyLGVbc109InJnYigiLGVbc10rPWE+MD80MCphKzU1OiIwIixlW3NdKz0iLCIsZVtzXSs9dD4wPzQwKnQrNTU6IjAiLGVbc10rPSIsIixlW3NdKz1yPjA/NDAqcis1NToiMCIsZVtzXSs9IikiO2ZvcihhPTIzMjthPD0yNTU7YSsrKXQ9MTAqKGEtMjMyKSs4LGVbYV09WyJyZ2IoIix0LCIsIix0LCIsIix0LCIpIl0uam9pbigiIik7ZVswXT0icmdiKDAsMCwwKSIsZVsxXT0icmdiKDEyOCwgMCwgMCkiLGVbMl09InJnYigwLCAxMjgsIDApIixlWzNdPSJyZ2IoMTI4LCAxMjgsIDApIixlWzRdPSJyZ2IoMCwgMCwgMjM4KSIsZVs1XT0icmdiKDEyOCwgMCwgMTI4KSIsZVs2XT0icmdiKDAsIDEyOCwgMTI4KSIsZVs3XT0icmdiKDE4NywgMTg3LCAxODcpIixlWzhdPSJyZ2IoMTI4LCAxMjgsIDEyOCkiLGVbOV09InJnYigyNTUsIDAsIDApIixlWzEwXT0icmdiKDAsIDI1NSwgMCkiLGVbMTFdPSJyZ2IoMjU1LCAyNTUsIDApIixlWzEyXT0icmdiKDkyLCA5MiwgMjU1KSIsZVsxM109InJnYigyNTUsIDAsIDI1NSkiLGVbMTRdPSJyZ2IoMCwgMjU1LCAyNTUpIixlWzE1XT0icmdiKDI1NSwgMjU1LCAyNTUpIixlWzI1Nl09InJnYigwLCAwLCAwKSIsZVsyNTddPSJyZ2IoMTE4LCAwLCAwKSIsZVsyNThdPSJyZ2IoMCwgMTA4LCAwKSIsZVsyNTldPSJyZ2IoMTQ1LCAxMzYsIDApIixlWzI2MF09InJnYigwLCAwLCAxNjcpIixlWzI2MV09InJnYigxMDgsIDAsIDEwOCkiLGVbMjYyXT0icmdiKDAsIDEwOCwgMTA4KSIsZVsyNjNdPSJyZ2IoMTYxLCAxNjEsIDE2MSkiLGVbMjY0XT0icmdiKDAsIDAsIDApIixlWzI2NV09InJnYigxMjgsIDAsIDApIixlWzI2Nl09InJnYigwLCAxMjgsIDApIixlWzI2N109InJnYigxMjgsIDEyOCwgMCkiLGVbMjY4XT0icmdiKDAsIDAsIDIzOCkiLGVbMjY5XT0icmdiKDEyOCwgMCwgMTI4KSIsZVsyNzBdPSJyZ2IoMCwgMTI4LCAxMjgpIixlWzI3MV09InJnYigxODcsIDE4NywgMTg3KSIsZVsyNzJdPSJyZ2IoMCwwLDApIixlWzI3M109InJnYigwLCAyNTUsIDI1NSkiLGVbMjc0XT0icmdiKDAsMCwwKSIsZVsyNzVdPSJyZ2IoMjU1LCAyNTUsIDApIixlWzI3Nl09InJnYigwLCAwLCAwKSIsZVsyNzddPSJyZ2IoMjI5LCAyMjksIDIyOSkiLGVbMjc4XT0icmdiKDIwNSwgMCwgMCkiLGVbMjc5XT0icmdiKDIyOSwgMjI5LCAyMjkpIixlWzI4MF09InJnYigyNTUsMjU1LDI1NSkiLGQ9ZX1mdW5jdGlvbiBJKGUpe3N3aXRjaChudWxsPT1kJiZEKCksZSl7Y2FzZS0xMjpyZXR1cm4gZFsyNzldO2Nhc2UtMTE6cmV0dXJuIGRbMjc4XTtjYXNlLTEwOnJldHVybiBkWzI4MF07Y2FzZS04OnJldHVybiBkWzI3Ml07Y2FzZS03OnJldHVybiBkWzI3M107Y2FzZS00OnJldHVybiBkWzI3NF07Y2FzZS0zOnJldHVybiBkWzI3NV07Y2FzZSA0OTpjYXNlLTI6cmV0dXJuIGRbMjc2XTtjYXNlIDM5OmNhc2UtMTpyZXR1cm4gZFsyNzddO2Nhc2UgMDpjYXNlIDMwOnJldHVybiBkWzBdO2Nhc2UgMTpjYXNlIDMxOnJldHVybiBkWzFdO2Nhc2UgMjpjYXNlIDMyOnJldHVybiBkWzJdO2Nhc2UgMzpjYXNlIDMzOnJldHVybiBkWzNdO2Nhc2UgNDpjYXNlIDM0OnJldHVybiBkWzRdO2Nhc2UgNTpjYXNlIDM1OnJldHVybiBkWzVdO2Nhc2UgNjpjYXNlIDM2OnJldHVybiBkWzZdO2Nhc2UgNzpjYXNlIDM3OnJldHVybiBkWzddO2Nhc2UgNDA6cmV0dXJuIGRbMjY0XTtjYXNlIDQxOnJldHVybiBkWzI2NV07Y2FzZSA0MjpyZXR1cm4gZFsyNjZdO2Nhc2UgNDM6cmV0dXJuIGRbMjY3XTtjYXNlIDQ0OnJldHVybiBkWzI2OF07Y2FzZSA0NTpyZXR1cm4gZFsyNjldO2Nhc2UgNDY6cmV0dXJuIGRbMjcwXTtjYXNlIDQ3OnJldHVybiBkWzI3MV07Y2FzZSA4OmNhc2UgOTA6Y2FzZSAxMDA6Y2FzZSAzMDA6Y2FzZSA0MDA6cmV0dXJuIGRbOF07Y2FzZSA5OmNhc2UgOTE6Y2FzZSAxMDE6Y2FzZSAzMTA6Y2FzZSA0MTA6cmV0dXJuIGRbOV07Y2FzZSAxMDpjYXNlIDkyOmNhc2UgMTAyOmNhc2UgMzIwOmNhc2UgNDIwOnJldHVybiBkWzEwXTtjYXNlIDExOmNhc2UgOTM6Y2FzZSAxMDM6Y2FzZSAzMzA6Y2FzZSA0MzA6cmV0dXJuIGRbMTFdO2Nhc2UgMTI6Y2FzZSA5NDpjYXNlIDEwNDpjYXNlIDM0MDpjYXNlIDQ0MDpyZXR1cm4gZFsxMl07Y2FzZSAxMzpjYXNlIDk1OmNhc2UgMTA1OmNhc2UgMzUwOmNhc2UgNDUwOnJldHVybiBkWzEzXTtjYXNlIDE0OmNhc2UgOTY6Y2FzZSAxMDY6Y2FzZSAzNjA6Y2FzZSA0NjA6cmV0dXJuIGRbMTRdO2Nhc2UgMTU6Y2FzZSA5NzpjYXNlIDEwNzpjYXNlIDM3MDpjYXNlIDQ3MDpyZXR1cm4gZFsxNV07Y2FzZSA0ZTM6Y2FzZSAzZTM6cmV0dXJuIGRbMjU2XTtjYXNlIDQxMDA6Y2FzZSAzMTAwOnJldHVybiBkWzI1N107Y2FzZSA0MjAwOmNhc2UgMzIwMDpyZXR1cm4gZFsyNThdO2Nhc2UgNDMwMDpjYXNlIDMzMDA6cmV0dXJuIGRbMjU5XTtjYXNlIDQ0MDA6Y2FzZSAzNDAwOnJldHVybiBkWzI2MF07Y2FzZSA0NTAwOmNhc2UgMzUwMDpyZXR1cm4gZFsyNjFdO2Nhc2UgNDYwMDpjYXNlIDM2MDA6cmV0dXJuIGRbMjYyXTtjYXNlIDQ3MDA6Y2FzZSAzNzAwOnJldHVybiBkWzI2M107ZGVmYXVsdDpyZXR1cm4gZTw9LTE2JiYoZSs9MTYsZSo9LTEpLGU+PTAmJmU8MjgxP2RbZV06ZFsyNzddfX1mdW5jdGlvbiBZKGEsdCl7bnVsbD09ZCYmRCgpLGE8MHx8YT49ZC5sZW5ndGh8fCh0PW5ldyBlKHQpKS5vayYmKGRbYV09dC50b1JHQigpKX1zZWxmLmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLChlPT57bGV0IGk7aWYoZS5kYXRhKXN3aXRjaChlLmRhdGEuYWN0aW9uKXtjYXNlIm9wdGlvbnMiOmxldCBvLGw9ci5lbmFibGVkO2ZvcihvIGluIGUuZGF0YS5hcmdzKWlmKGUuZGF0YS5hcmdzLmhhc093blByb3BlcnR5KG8pKWlmKCJjb2xvcnMiIT09bylpZih0JiYid2hhdCI9PT1vJiZyW29dIT09ZS5kYXRhLmFyZ3Nbb10pe2lmKGk9MCwhKDEmfnJbb10pJiYxJn5lLmRhdGEuYXJnc1tvXSYmKGl8PTEpLCEoMiZ+cltvXSkmJjImfmUuZGF0YS5hcmdzW29dJiYoaXw9MiksISg0Jn5yW29dKSYmNCZ+ZS5kYXRhLmFyZ3Nbb10mJihpfD00KSwwIT09aSl7Y29uc3QgZT10O3Qud2hhdD1pLHcoITApLGUud2hhdD1yW29dLHQ9ZX1yW29dPWUuZGF0YS5hcmdzW29dfWVsc2UgcltvXT1lLmRhdGEuYXJnc1tvXTtlbHNle2NvbnN0IGE9ZS5kYXRhLmFyZ3Nbb107aWYoYSYmYS5sZW5ndGg+MCl7bGV0IGU7Y29uc3QgdD1hLmxlbmd0aDtmb3IoZT0wO2U8dDtlKyspYVtlXSYmMCE9PWFbZV0ubGVuZ3RoJiZZKGUsYVtlXSl9fSJib29sZWFuIj09dHlwZW9mIHIudGltZXN0YW1wJiYoci50aW1lc3RhbXA9ci50aW1lc3RhbXA/MjowKSwwIT09YSYmKG49bmV3IG1vbWVudChhKS5mb3JtYXQoci5mb3JtYXR8fCJZWVlZTU1ERC1ISG1tc3MiKSx1KCksdyghMCkpLGwhPXIuZW5hYmxlZD9sfHxmP2wmJmY/eSgpOnIub2ZmbGluZSYmcG9zdE1lc3NhZ2Uoe2V2ZW50OiJzdGFydCJ9KTpwb3N0TWVzc2FnZSh7ZXZlbnQ6InN0YXJ0In0pOnIub2ZmbGluZSYmcG9zdE1lc3NhZ2Uoe2V2ZW50OiJzdGFydCJ9KTticmVhaztjYXNlIm5hbWUiOnIubmFtZT1lLmRhdGEuYXJncyxmJiZmdW5jdGlvbigpe2NvbnN0IGU9YztpZih1KCksZT09PWMpcmV0dXJuO3Bvc3RNZXNzYWdlKHtldmVudDoiZGVidWciLGFyZ3M6J0ZpbGUgY2hhbmdlZDogIicrZSsnIiB0byAiJytjKyciJ30pLHQmJnQuY3VycmVudEZpbGUhPT1lP3coITApOnQmJih0LmN1cnJlbnRGaWxlPWMpfSgpO2JyZWFrO2Nhc2UiY29ubmVjdGVkIjpzPWUuZGF0YS5hcmdzLHUoKTticmVhaztjYXNlImxvZ2dpbmciOnBvc3RNZXNzYWdlKHtldmVudDoibG9nZ2luZyIsYXJnczpmfSk7YnJlYWs7Y2FzZSJ0b2dnbGUiOiFmdW5jdGlvbigpe3IuZW5hYmxlZD0hci5lbmFibGVkLHBvc3RNZXNzYWdlKHtldmVudDoidG9nZ2xlZCIsYXJnczpyLmVuYWJsZWR9KTtjb25zdCBlPXIudW5pcXVlO3IudW5pcXVlPSExLHIuZW5hYmxlZCYmIWY/cG9zdE1lc3NhZ2Uoe2V2ZW50OiJzdGFydEludGVybmFsIn0pOiFyLmVuYWJsZWQmJmYmJnkoKTtyLnVuaXF1ZT1lfSgpO2JyZWFrO2Nhc2Uic3RvcCI6eSgpO2JyZWFrO2Nhc2Uic3RhcnRJbnRlcm5hbCI6aT1yLnVuaXF1ZSxyLnVuaXF1ZT0hMSxlLmRhdGEuYXJncz92KGUuZGF0YS5hcmdzLmxpbmVzLGUuZGF0YS5hcmdzLmZyYWdtZW50KTp2KFtdLCExKSxyLnVuaXF1ZT1pO2JyZWFrO2Nhc2Uic3RhcnQiOmUuZGF0YS5hcmdzP3YoZS5kYXRhLmFyZ3MubGluZXMsZS5kYXRhLmFyZ3MuZnJhZ21lbnQpOnYoW10sITEpO2JyZWFrO2Nhc2UiZmx1c2giOncoZS5kYXRhLmFyZ3MpO2JyZWFrO2Nhc2UiYWRkLWxpbmUiOmNvbnN0IGI9ZS5kYXRhLmFyZ3M7aWYoYi5mcmFnbWVudClyZXR1cm4odD1iKS5sb2dnaW5nPWYsdC5maWxlPWMsdC5jb25uZWN0ZWQ9cyx0Lm9mZmxpbmU9ci5vZmZsaW5lLHQud2hhdD1yLndoYXQsdm9pZCh0LmdhZ2dlZD1iLmdhZ2dlZHx8ci5nYWdnZWQmJmIuZ2FnZ2VkKTtpZih0PW51bGwsIWZ8fCFyLm9mZmxpbmUmJiFzKXJldHVybjtpZihiLmdhZ2dlZCYmIXIuZ2FnZ2VkKXJldHVybjsxJn5yLndoYXR8fGgoTSh7dGV4dDpiLmxpbmUsZm9ybWF0czpiLmZvcm1hdHMsdGltZXN0YW1wOmIudGltZXN0YW1wfHxEYXRlLm5vdygpfSkpLDImfnIud2hhdCYmMCE9PXIud2hhdHx8KDI9PT1yLnRpbWVzdGFtcD9wKG1vbWVudChiLnRpbWVzdGFtcCkuZm9ybWF0KHIudGltZXN0YW1wRm9ybWF0KSk6MCE9PXIudGltZXN0YW1wJiZwKG5ldyBEYXRlKGIudGltZXN0YW1wKS50b0lTT1N0cmluZygpKSxwKGIubGluZSsiXG4iKSksNCZ+ci53aGF0fHwoMj09PXIudGltZXN0YW1wP3AoIhtbLTc7LThtIittb21lbnQoYi50aW1lc3RhbXApLmZvcm1hdChyLnRpbWVzdGFtcEZvcm1hdCkrIhtbMG0iKTowIT09ci50aW1lc3RhbXAmJnAoIhtbLTc7LThtIituZXcgRGF0ZShiLnRpbWVzdGFtcCkudG9JU09TdHJpbmcoKSsiG1swbSIpLGsoYi5yYXcpKTticmVhaztjYXNlIndyaXRlLWRvbmUiOmlmKCFnW2UuZGF0YS5maWxlXSlyZXR1cm47aWYoZ1tlLmRhdGEuZmlsZV0uc2hpZnQoKSxnW2UuZGF0YS5maWxlXS5sZW5ndGgpe2NvbnN0IGE9Z1tlLmRhdGEuZmlsZV0uc2hpZnQoKTttKGEuZmlsZSxhLmRhdGEsITApfWVsc2UgZGVsZXRlIGdbZS5kYXRhLmZpbGVdfX0pLCExKX0pKCk7";var Qi=`<style>body{font-family:'Courier New',Courier,monospace;text-align:left;font-size:1em;white-space:pre;background-color:#000}@-webkit-keyframes blinker{0%{opacity:1}50%{opacity:0}100%{opacity:1}}@keyframes blinker{0%{opacity:1}50%{opacity:0}100%{opacity:1}}.animate .ansi-blink{text-decoration:blink;animation-name:blinker;animation-iteration-count:infinite;animation-timing-function:cubic-bezier(1,0,0,1);animation-duration:1s;-webkit-animation-name:blinker;-webkit-animation-iteration-count:infinite;-webkit-animation-timing-function:cubic-bezier(1,0,0,1);-webkit-animation-duration:1s}.line>span{padding:0;margin:0;display:inline-block;cursor:text;padding-bottom:1px}.ansi{padding:0;margin:0;display:inline-block;padding-bottom:1px;cursor:text;line-height:normal}.line{word-wrap:break-word;word-break:break-all;min-width:100%;display:block;clear:both;line-height:normal}.line hr{border:0}.line a,.line a:link,.line a:link span{color:inherit;font-weight:inherit;text-decoration:underline}.URLLink,.URLLink:link,.URLLink:link span{text-decoration:underline;cursor:pointer}a.MXPLink:link,a.MXPLink:link span{font-weight:400;color:inherit;text-decoration:underline}a.MXPLink:visited,a.MXPLink:visited span{text-decoration:underline}a.MXPLink:active,a.MXPLink:active span{text-decoration:underline}a.MXPLink:hover,a.MXPLink:hover span{text-decoration:underline}.line .b{font-weight:700}.line .i{font-style:italic}.line .o{text-decoration:overline}.line .u{text-decoration:underline}.line .du{text-decoration:underline;border-bottom:1px solid currentColor;padding-bottom:1px}.line .s{text-decoration:line-through}.line .o.du{text-decoration:underline overline}.line .u.o{text-decoration:underline overline}.line .o.s{text-decoration:overline line-through}.line .du.s{text-decoration:underline line-through}.line .s.u{text-decoration:underline line-through}.line .du.u.o{text-decoration:underline overline}.line .du.s.u{text-decoration:underline line-through}.line .du.o.s{text-decoration:underline overline line-through}.line .u.s.o{text-decoration:underline overline line-through}.line .du.o.s.u{text-decoration:underline overline line-through}</style><script type="text/javascript">function doLink(url) {
        if (confirm('Open \\'' + url + '\\'?') === true)
            window.open(encodeURI(url), '_blank');
    }

    // eslint-disable-next-line no-unused-vars
    function doMXPLink(el, url) {
        if (url.startsWith('OoMUD://') || url.startsWith('jiMUD://') || url.startsWith('client://'))
            doMXPSend(0, el, url.substring(8));
        else if (confirm('Open \\'' + url + '\\'?') === true)
            window.open(encodeURI(url.replace('&text;', el.textContent || '')), '_blank');
    }

    function doMXPSend(e, el, url, pmt, tt) {
        let im = el.querySelector('img[ismap]');
        let extra = '';
        if (im && im.length > 0) {
            let offset = im.offset();
            let x = Math.floor(e.clientX - offset.left);
            let y = Math.floor(e.clientY - offset.top);
            extra = '?' + x + ',' + y;
        }

        if (url.constructor === Array || url.__proto__.constructor === Array || Object.prototype.toString.call(url) === '[object Array]') {
            alert('MXP Menu not supported');
        }
        else {
            url = url.replace('&text;', el.textContent || '') + extra;
            if (!pmt)
                url += '\\n';
            alert(url);
            console.log(url);
        }
    }

    // eslint-disable-next-line no-unused-vars
    function doMXPTooltip(el) {
        el.title = el.title.replace('&test;', el.textContent || '');
    }<\/script>`;var Ht=class extends Re{constructor(){super(...arguments);this.fl=[]}get manager(){return this.xt}remove(){this.client.removeListenersFromCaller(this)}initialize(){this.client.getOption("logEnabled")&&this.wo(),this.client.on("cleared",()=>{this.lt({action:"flush",args:!0})},this),this.client.on("connecting",()=>{this.lt({action:"connected",args:this.client.connected}),this.lt({action:"start",args:{lines:this.client.display.lines,fragment:this.client.display.EndOfLine||this.client.telnet.prompt}})},this),this.client.on("add-line-done",async e=>{this.client.getOption("logEnabled")&&this.lt({action:"add-line",args:e})},this),this.client.on("set-title",(e,s)=>{this.lt({action:"name",args:$character})},this),this.client.on("options-loaded",()=>{this.Ti(this.client.getOption("logEnabled")),this.client.getOption("logEnabled")?this.wo():this.Ia(),this.xt&&this.xt.resetState(client.getWindowState("log-viewer")||{center:!0})},this),this.client.on("closed",()=>{this.lt({action:"connected",args:client.connected}),this.lt({action:"stop"})},this),this.client.on("reconnect",()=>{this.client.connected||(this.lt({action:"connected",args:client.connected}),this.lt({action:"stop"}))},this),this.client.on("window",(e,s,n)=>{let r=e.split("/");if(r.length)switch(r[0]){case"log-viewer":case"logs":case"log.viewer":s==="close"?(this.xt&&this.xt.close(),he("logs")):(this.vo(),this.xt.dialog.dataset.path=e,this.xt.setBody(e),this.xt.show());break}}),this.client.on("close-window",e=>{switch(e){case"log-viewer":case"logs":case"log.viewer":this.xt&&this.xt.close(),he("logs");break}}),this.lt({action:"name",args:$character||""}),window.addEventListener("beforeunload",()=>{this.lt({action:"flush"})});let t=this.client.getWindowState("log-viewer");t&&t.show&&(this.vo(),He("logs"))}get menu(){return[{name:" Enable logging",icon:'<i class="bi bi-file-text"></i>',position:"#menu-connect",active:this.client.getOption("logEnabled"),action:()=>{client.getOption("logEnabled")||this.wo(),this.lt({action:"toggle"})}},{name:"Manage logs",icon:'<i class="fas fa-list"></i>',position:"#menu-profiles",action:()=>{this.vo(),location.hash="logs"}}]}get settings(){return[{name:" Logging",action:"settings-logging",icon:'<i class="far fa-file-alt"></i>',position:'a[href="#settings-tabCompletion"]'}]}vo(){this.xt||(this.xt=new _i,this.xt.on("closed",()=>{this.xt&&!this.xt.persistent&&(delete this.xt,this.xt=null)}),this.xt.on("canceled",()=>{this.xt&&!this.xt.persistent&&(delete this.xt,this.xt=null)}))}lt(t){this.Et&&this.Et.postMessage(t)}createLogger(){return new Worker(Hs)}wo(){this.Et||(this.Et=this.createLogger(),this.Et.addEventListener("message",t=>{switch(t.data.event){case"started":this.Ti(!0);break;case"stopped":this.Ti(!1),this.lt({action:"flush"}),this.Et.terminate(),this.Et=null;break;case"logging":break;case"error":this.client.error(t.data.args);break;case"debug":this.client?this.client.getOption("enableDebug")&&this.client.debug(t.data.args):console.log(t.data.args);break;case"toggled":this.client&&this.client.setOption("logEnabled",t.data.args),this.Ti(t.data.args),t.data.args||(this.lt({action:"flush"}),this.Et.terminate(),this.Et=null);break;case"startInternal":case"start":this.lt({action:t.data.event,args:{lines:this.client.display.lines||[],fragment:this.client.display.EndOfLine||this.client.telnet.prompt}});break;case"write":this.updateKey(t.data),localforage.getItem("OoMUDLog"+t.data.file).then(e=>{e||(e=""),e+=t.data.data,localforage.setItem("OoMUDLog"+t.data.file,e).then(()=>{this.xt&&this.xt.logChanged(t.data.file,t.data.data),this.lt({action:"write-done",file:t.data.file})})});break}}),this.Et.addEventListener("error",t=>{this.client?this.client.error(t):console.error(t)}),this.Ia())}updateKey(t){this.fl.push(t),!this.xo&&(this.xo=localforage.getItem("OoMUDLogKeys").then(e=>{if(!this.fl.length)return;let s;e?s=e:s={},this.fl.forEach(n=>{s[n.file]={character:n.character,timeStamp:n.timeStamp,postfix:t.postfix,prefix:t.prefix}}),this.fl=[],this.xo=null,localforage.setItem("OoMUDLogKeys",s)}))}Ia(){this.lt({action:"options",args:{offline:this.client.getOption("logOffline"),gagged:this.client.getOption("logGagged"),enabled:this.client.getOption("logEnabled"),unique:this.client.getOption("logUniqueOnConnect"),prepend:this.client.getOption("logPrepend"),what:this.client.getOption("logWhat"),debug:this.client.getOption("enableDebug"),format:this.client.getOption("logTimeFormat"),colors:this.client.getOption("colors"),timestamp:this.client.getOption("logTimestamp"),timestampFormat:this.client.getOption("logTimestampFormat")}})}Ti(t){let e=document.querySelector("#menu-enable-logging");t?(e.title="Disable logging",e.classList.add("active"),document.querySelector("#menu-enable-logging a span").textContent="Disable logging"):(e.title="Enable logging",e.classList.remove("active"),document.querySelector("#menu-enable-logging a span").textContent="Enable logging")}},_i=class extends ye{constructor(){super(Object.assign({},client.getWindowState("log-viewer")||{center:!0},{title:'<i class="fas fa-list"></i> Log viewer',minWidth:410}));this.we="logs";this.Rt=!1;this.on("resized",e=>{this.Jt(e.width),client.setOption("windows.log-viewer",e)}),this.on("closed",()=>{client.setOption("windows.log-viewer",this.windowState),he(this.we)}),this.on("canceled",()=>{client.setOption("windows.log-viewer",this.windowState),he(this.we)}),this.on("moved",e=>{this.Jt(this.dialog.offsetWidth||this.dialog.clientWidth),client.setOption("windows.log-viewer",e)}),this.on("maximized",()=>{client.setOption("windows.log-viewer",this.windowState)}),this.on("restored",()=>{this.Jt(this.dialog.offsetWidth||this.dialog.clientWidth),client.setOption("windows.log-viewer",this.windowState)}),this.on("shown",()=>{this.Jt(this.dialog.offsetWidth||this.dialog.clientWidth),client.setOption("windows.log-viewer",this.windowState)}),this.body.style.padding="10px",this.We=new je({id:"log-viewer",parent:this.body,orientation:1,anchor:1}),client.getOption("logger.split")>=200&&(this.We.SplitterDistance=client.getOption("logger.split")),this.We.on("splitter-moved",e=>{client.setOption("logger.split",e)}),this.pe=this.We.panel1,this.pe.style.overflow="hidden",this.pe.style.overflowY="auto",this.Se=document.createElement("iframe"),this.Se.src="about:blank",this.Se.classList.add("viewer"),this.Se.addEventListener("load",()=>{this.Se.contentWindow.document.body.onclick=()=>{this.focus(),vi()}}),this.We.panel2.append(this.Se),this.We.panel2.style.overflow="auto",this.We.panel2.style.padding="0",this.We.panel2.style.paddingLeft="4px",this.ni();let t="";t+=`<button id="${this.id}-back" type="button" class="btn-sm float-start btn btn-light" title="Go back"><i class="bi bi-arrow-left"></i><span class="icon-only"> Back</span></button>`,t+=`<button id="${this.id}-refresh" type="button" class="btn-sm float-start btn btn-light" title="Go back"><i class="bi bi-arrow-repeat"></i></i><span class="icon-only"> Refresh</span></button>`,t+='<div class="vr float-start" style="margin-right: 4px;height: 29px;"></div>',t+='<span id="logs-page-buttons"></span>',t+=`<button id="${this.id}-cancel" type="button" class="btn-sm float-end btn btn-light" title="Close dialog"><i class="bi bi-x-lg"></i><span class="icon-only"> Close</span></button>`,this.footer.innerHTML=t,this.footer.classList.add("dropup"),this.footer.querySelector(`#${this.id}-cancel`).addEventListener("click",()=>{he(this.we),this.close()}),this.footer.querySelector(`#${this.id}-refresh`).addEventListener("click",()=>{this.ni(!0).then(()=>{let e=this.pe.querySelector(`a[href="#logs/${this.te}"]`);e&&(e.classList.add("active"),pt(this.pe,e))}),this.setBody("")}),this.footer.querySelector(`#${this.id}-back`).addEventListener("click",()=>{this.Bn()}),this.dialog.dataset.path="logs",this.setBody("")}setBody(t,e){if(!this.ht){setTimeout(()=>{this.setBody(t,e)});return}this.we=this.dialog.dataset.path,this.we==="logs"?this.dialog.dataset.panel="left":this.dialog.dataset.panel="right";let s=this.we.split("/");this.te=s[s.length-1],this.title=Ke(s,{small:this.Rt,sep:"/",formatter:(r,o,a)=>{if(o===a){if(this.ht[r]&&!r.endsWith(".txt")&&!r.endsWith(".raw")&&!r.endsWith(".htm"))return`${this.ml(r)}${this.ht[r].character?", "+this.ht[r].character:""}>`;if(this.ht[r]&&this.ht[r].timeStamp)return`${this.ml(this.ht[r].timeStamp)}${this.ht[r].character?", "+this.ht[r].character:""}, ${r.substring(r.length-3,r.length)}${this.ht[r].prefix?", "+this.ht[r].prefix:""}${this.ht[r].postfix?", "+this.ht[r].postfix:""}`}return we(r)},icon:'<i class="fas fa-list" style="margin-right: 2px;"></i>'});let n=this.pe.querySelectorAll("a.active");if(n.forEach(r=>r.classList.remove("active")),n=this.pe.querySelector(`a[href="#logs/${this.te}"]`),n&&n.classList.add("active"),s.length<2){this.Pt(""),this.We.panel2Collapsed=!0,this.footer.querySelector(`#${this.id}-back`).style.display="none",this.footer.querySelector("#logs-page-buttons").innerHTML=`<button id="${this.id}-clear" type="button" class="btn-sm btn btn-danger" title="Clear logs"><i class="bi bi-trash"></i><span class="icon-only"> Clear</span></button>`,this.footer.querySelector(`#${this.id}-clear`).addEventListener("click",()=>{confirm_box("Clear logs?","Remove all logs?").then(o=>{if(o.button===4){let a=Object.keys(this.ht);for(let h=0,c=a.length;h<c;h++)localforage.removeItem("OoMUDLog"+a[h]);localforage.removeItem("OoMUDLogKeys").then(()=>{this.ni(),this.setBody("")})}})});let r=this.footer.querySelector(`#${this.id}-clear`);r&&(r.style.display=Object.keys(this.ht).length?"":"none"),document.getElementById("logs-page-buttons").previousSibling.style.display=Object.keys(this.ht).length?"":"none"}else{localforage.getItem("OoMUDLog"+s[1]).then(o=>{!s[1].endsWith(".txt")&&!s[1].endsWith(".raw")?this.Pt(Qi+(o||"").replace(/\n/g,"")):this.Pt("<style>body {font-family: 'Courier New', Courier, monospace;text-align: left;font-size: 1em;white-space: pre;background-color: white;}</style>"+(o||""))}),this.footer.querySelector(`#${this.id}-back`).style.display="",this.We.panel2Collapsed=!1;let r=`<button id="${this.id}-export" type="button" class="btn-sm float-start btn btn-light" title="Export log"><i class="bi bi-box-arrow-up"></i><span class="icon-only"> Export</span></button>`;r+=`<button id="${this.id}-remove" type="button" class="btn-sm btn btn-danger" title="Remove log"><i class="bi bi-trash"></i><span class="icon-only"> Remove</span></button>`,this.footer.querySelector("#logs-page-buttons").innerHTML=r,this.footer.querySelector(`#${this.id}-remove`).addEventListener("click",o=>{this.Ca(this.te)}),this.footer.querySelector(`#${this.id}-export`).addEventListener("click",o=>{this.Ta(this.te)})}}Pt(t){if(!this.Se.contentWindow||!this.Se.contentWindow.document||!this.Se.contentWindow.document.body){setTimeout(()=>{this.Pt(t)},10);return}this.Se.contentWindow.document.body.innerHTML=t,this.Se.contentWindow.scroll(0,0),this.emit("content-changed")}ko(t,e){if(!this.Se.contentWindow||!this.Se.contentWindow.document||!this.Se.contentWindow.document.body){setTimeout(()=>{this.ko(t,e)},10);return}e?this.Se.contentWindow.document.body.insertAdjacentHTML("beforeend",t):this.Se.contentWindow.document.body.insertAdjacentText("beforeend",t)}Bn(){let t=this.we.split("/");t.length===5?He(t.slice(0,t.length-2).join("/"),this.we):He(t.slice(0,t.length-1).join("/"),this.we)}ni(t){return new Promise((e,s)=>{t||(this.pe.innerHTML='<div class="loader"><div class="text">Loading... <div class="indicator"></div></div></div>'),localforage.getItem("OoMUDLogKeys").then(n=>{this.ht=n||{};let r=Object.keys(this.ht);if(r.sort(),r.length===0)this.pe.innerHTML='<h1 id="empty" style="width: 100%;text-align:center">No logs.</h1>';else{let o="";for(let a=0,h=r.length;a<h;a++){let c="code";r[a].endsWith(".txt")?c="text":r[a].endsWith(".raw")&&(c="binary");let g=r[a];!r[a].endsWith(".txt")&&!r[a].endsWith(".raw")&&!r[a].endsWith(".htm")?g=`${this.ml(r[a])}${this.ht[r[a]].character?", "+this.ht[r[a]].character:""}`:this.ht[r[a]].timeStamp&&(g=`${this.ml(this.ht[r[a]].timeStamp)}${this.ht[r[a]].character?", "+this.ht[r[a]].character:""}, ${r[a].substring(r[a].length-3,r[a].length)}${this.ht[r[a]].prefix?", "+this.ht[r[a]].prefix:""}${this.ht[r[a]].postfix?", "+this.ht[r[a]].postfix:""}`),o+=`<a id="${r[a]}" href="#logs/${encodeURIComponent(r[a])}" class="list-group-item list-group-item-action" title="${g}"><span class="list-badge-button badge text-bg-danger" data-key="${r[a]}" data-type="delete" title="Remove log"><i class="bi bi-trash"></i></span><span class="me-1 list-badge-button badge text-bg-secondary" data-key="${r[a]}" data-type="export" title="Export log"><i class="bi bi-box-arrow-up"></i></span><i class="bi bi-file-${c}"></i>${g}</a>`}this.pe.innerHTML='<div class="list-group" id="logs-menu">'+o+"</div>",this.pe.querySelectorAll('[data-type="delete"').forEach(a=>{a.addEventListener("click",h=>{this.Ca(h.currentTarget.dataset.key),h.stopPropagation(),h.cancelBubble=!0,h.preventDefault()})}),this.pe.querySelectorAll('[data-type="export"').forEach(a=>{a.addEventListener("click",h=>{this.Ta(h.currentTarget.dataset.key),h.stopPropagation(),h.cancelBubble=!0,h.preventDefault()})})}e("")})})}async logChanged(t,e){if(!this.ht||!this.ht[t]){await this.ni();let s=this.pe.querySelector(`a[href="#logs/${this.te}"]`);s&&(s.classList.add("active"),pt(this.pe,s));let n=this.footer.querySelector(`#${this.id}-clear`);n&&(n.style.display=""),document.getElementById("logs-page-buttons").previousSibling.style.display=""}this.te===t&&(!t.endsWith(".txt")&&!t.endsWith(".raw")?this.ko((e||"").replace(/\n/g,""),!0):this.ko(e||""))}Ca(t){confirm_box("Remove log","Remove log?").then(e=>{e.button===4&&(localforage.removeItem("OoMUDLog"+t),delete this.ht[t],localforage.setItem("OoMUDLogKeys",this.ht),document.getElementById(t).remove(),this.we!=="logs"&&this.Bn())})}Ta(t){localforage.getItem("OoMUDLog"+t).then(e=>{t.endsWith(".htm")?fileSaveAs.show(Qi+(e||""),`oiMUD.${t}l`,"text/html"):t.endsWith(".raw")?fileSaveAs.show(e||"",`oiMUD.${t}.txt`,"text/plain"):t.endsWith(".txt")?fileSaveAs.show(e||"",`oiMUD.${t}`,"text/plain"):fileSaveAs.show(e||"",`oiMUD.${t}.html`,"text/plain")})}Jt(t){if(!this.header.querySelector(".breadcrumb")){setTimeout(()=>{this.Jt(t)},10);return}if(t<430){if(this.Rt)return;this.header.querySelector(".breadcrumb").classList.add("breadcrumb-sm"),this.Rt=!0}else this.Rt&&(this.header.querySelector(".breadcrumb").classList.remove("breadcrumb-sm"),this.Rt=!1)}ml(t){typeof t=="string"&&(t=parseInt(t,10)),t=new Date(t);let e=t.getHours(),s=t.getMinutes(),n=e>=12?"pm":"am";e=e%12,e=e||12,s=s<10?"0"+s:s;let r=e+":"+s+" "+n;return t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear()+"  "+r}};var Et=class extends Re{constructor(){super(...arguments);this.Mi=0;this.Ir=0;this.Fs=[];this.fn=[];this.mn=!1;this.gn=0;this.Ma=()=>{let t=this.Cr();this.oi?(this.ae.close(),t.show=!0):t.show=!1,this.client.setOption("windows.chatWindow",t)}}remove(){this.client.removeListenersFromCaller(this),delete this.client.sendChat,window.removeEventListener("beforeunload",this.Ma)}initialize(){this.client.sendChat=e=>{let s={data:this.client.parseInline(e),raw:e};this.client.emit("send-chat",s),this.updateChat(s.data)},this.client.sendChatRaw=e=>{let s={data:e,raw:e};this.client.emit("send-chat",s),this.updateChat(s.raw)},window.addEventListener("beforeunload",this.Ma),this.client.on("function",e=>{if(!e)return;let s=e.args;switch(e.name.toLowerCase()){case"chatprompt":case"chatp":(this.client.getOption("echo")&4)===4&&this.client.echo(e.raw,-3,-4,!0,!0),s=this.client.parseInline(s.join(" ")),this.updateChat(s),e.handled=!0;break;case"chat":case"ch":(this.client.getOption("echo")&4)===4&&this.client.echo(e.raw,-3,-4,!0,!0),s=this.client.parseInline(s.join(" ")+`
`),this.updateChat(s),e.handled=!0;break}},this),this.client.on("add-line",e=>{let s,n,r;if(!(!e||typeof e.line>"u"||e.line===null)&&!(e.fragment||this.Fs.length===0)){if(s=/^(-*)\s*\[ (.*) matching (users|user) \]\s*(-*)$/.exec(e.line),s&&s.length>0){this.Mi=0,this.mn=!0;return}if(s=/^(-*)\s*\[ .* \]\s*(-*)$/.exec(e.line),this.mn&&s&&s.length>0){this.Mi=0,this.mn=!1;return}if(e.line==="Describers:"||e.line==="You supply a list of nouns so when your object is complete it can correctly build an id list to allow you to properly interact with it."||e.line==="You supply a list of adjectives so when your object is complete it can correctly build an id list to allow you to properly interact with it."||e.line==="Available sizes:"||e.line==="Available locations:"||e.line==="Available tattoos:"||e.line==="Available colors:"){this.Mi=0,this.mn=!0;return}if(this.mn&&(e.line.indexOf("Current name: ")===0||e.line.indexOf("Enter up to 2 nouns, [#] to remove, 'f' to finish, 'q' to quit:")===0||e.line.indexOf("Enter up to 3 adjectives, 'f' to finish, 'q' to quit:")===0||e.line.indexOf("Enter selection ")===0)){this.Mi=0,this.mn=!1;return}if(s=/^ {2}# {2}Item.*$/.exec(e.line),this.gn===0&&s&&s.length>0){this.Mi=0,this.gn=1;return}if(s=/^(-*)$/.exec(e.line),this.gn>0&&s&&s.length>0&&(this.Mi=0,this.gn++),this.gn>2&&(this.Mi=0,this.gn=0),!(this.mn||this.gn>0)){if(this.client.getOption("chat.CaptureOnlyOpen")){let o={open:!(this.oi||this.zn)};if(this.emit("chat-only-open",o),!o.open)return}if(this.Mi>0&&e.line.startsWith("    ")){e.gagged|=this.client.getOption("chat.gag"),this.updateChat(e);return}for(n=0,r=this.fn.length;n<r;n++)if(s=this.fn[n].exec(e.line),!(!s||s.length===0)){this.Ir=1,e.gagged|=this.client.getOption("chat.gag"),this.updateChat(e);return}if(this.Ir>0){e.gagged|=this.client.getOption("chat.gag"),this.updateChat(e),e.line=="-=-=- End Review -=-=-"&&(this.Ir=-1);return}if(this.Ir===-1){e.gagged|=this.client.getOption("chat.gag"),this.updateChat(e),this.Ir=0;return}for(n=0,r=this.Fs.length;n<r;n++)if(s=this.Fs[n].exec(e.line),!(!s||s.length===0)){this.Mi>0&&this.Mi--,this.Mi++,e.gagged|=this.client.getOption("chat.gag"),this.updateChat(e);return}this.Mi>0&&this.Mi--}}},this),this.client.on("window",(e,s,n)=>{switch(e){case"chat-dialog":case"chatdialog":case"chat":s==="close"?(this.$&&this.$.close(),he("chat")):this.showDialog();break;case"chatwin":case"chatwindow":case"chat-win":case"chat-window":s==="close"?this.oi&&this.ae.close():this.showWindow();break}}),this.client.on("close-window",e=>{switch(e){case"chat-dialog":case"chatdialog":case"chat":this.$&&this.$.close(),he("chat");break;case"chatwin":case"chatwindow":case"chat-win":case"chat-window":this.oi&&this.ae.close();break}}),this.client.on("options-loaded",()=>{this.Ra(),this._i()}),this.client.on("option-changed",(e,s)=>{(e.startsWith("chat.")||e==="enableMXP"||e==="enableURLDetection"||e==="display.showInvalidMXPTags"||e==="display.hideTrailingEmptyLine"||e.startsWith("log")||e==="enableDebug")&&this._i()}),this.client.on("set-title",(e,s)=>{this.lt({action:"name",args:$character})},this),this.client.on("connecting",()=>{this.lt({action:"connected",args:this.client.connected})},this),this.Ra(),this._i(),(this.client.getOption("showChat")||this.client.getOption("chat.persistent")||this.client.getOption("chat.captureTells")||this.client.getOption("chat.captureTalk")||this.client.getOption("chat.captureLines"))&&this.show();let t=this.client.getWindowState("chat");t&&t.show&&this.showDialog(),t=this.client.getWindowState("chatWindow"),t&&t.show&&this.showWindow()}get menu(){return[{name:"-",position:5,exists:"#menu-plugins",id:"plugins"},{name:" Show chat",action:t=>{this.client.getOption("showChatWindow")?this.show():this.showDialog()},icon:'<i class="bi bi-chat"></i>',position:"#menu-plugins"}]}get settings(){return[{name:" Chat",action:"settings-chat",icon:'<i class="bi bi-chat"></i>',position:'a[href="#settings-specialCharacters"]'},{name:" Chat display",action:"settings-chatDisplay",icon:'<i class="bi bi-chat"></i>',position:'a[href="#settings-chat"]'}]}Ra(){if(this.Fs=[],this.fn=[],this.client.getOption("chat.captureTells")&&(this.Fs.push(new RegExp("^([a-zA-Z'\\s_-]*) tells you:(.*)$"),new RegExp("^(\\([a-zA-Z'\\s_-]*\\)) tells you:(.*)$"),new RegExp("^You tell ([a-zA-Z'\\s_-]*):(.*)$"),new RegExp("^\\*([a-zA-Z'\\s_-]*)(\\s?)(.*?)$"),new RegExp("^([a-zA-Z'\\s_-]*) is idle, and may not have been paying attention.$"),new RegExp("^([a-zA-Z'\\s_-]*) is in combat and may not have heard you.$"),new RegExp("^([a-zA-Z'\\s_-]*) is in edit and may not be in a position to respond.$"),new RegExp("^([a-zA-Z'\\s_-]*) is arrested and can not respond.$"),new RegExp("^\\*You emote to ([a-zA-Z'\\s_-]*):(.*)$"),new RegExp("^([a-zA-Z'\\s_-]*) shouts in ([a-zA-Z'\\s_-]*):(.*)$"),new RegExp("^You shout in ([a-zA-Z'\\s_-]*):(.*)$")),this.client.getOption("chat.captureReviews")&&this.fn.push(new RegExp("^-=-=- Tell Review -=-=-$"))),this.client.getOption("chat.captureTalk")&&(this.Fs.push(new RegExp("^([a-zA-Z'\\s_-]*) says:(.*)$"),new RegExp("^You say:(.*)$"),new RegExp("^([a-zA-Z'\\s_-]*) whispers to you:(.*)$"),new RegExp("You whisper to ([a-zA-Z'\\s_-]*):(.*)"),new RegExp("^([a-zA-Z'\\s_-]*) yells:(.*)$"),new RegExp("^You yell:(.*)$"),new RegExp("You say in (.*):(.*)"),new RegExp("([a-zA-Z'\\s_-]*) says something in (.*)."),new RegExp("([a-zA-Z'\\s_-]*) says in (.*):(.*)")),this.client.getOption("chat.captureReviews")&&this.fn.push(new RegExp("^-=-=- Say Review -=-=-$"))),this.client.getOption("chat.captureLines"))if(this.client.getOption("chat.captureAllLines"))this.Fs.push(new RegExp("^\\[(.*)\\](.*)$")),this.client.getOption("chat.captureReviews")&&this.fn.push(new RegExp("^-=-=- ((?:(?!\\b(Say|Tell|End)\\b).)+) Review -=-=-$"));else{let t=this.client.getOption("chat.lines");for(let e=0,s=t.length;e<s;e++)t[e].trim().length!==0&&(this.Fs.push(new RegExp("\\["+t[e].trim()+"\\](.*)","i")),this.client.getOption("chat.captureReviews")&&this.fn.push(new RegExp("^-=-=- "+t[e].trim()+" Review -=-=-$","i")))}}updateChat(t){if(this.emit("update-chat",t),typeof t=="string"){let e,s=-1;this.zn&&(s=this.$.display.lines.length-1,this.$.display.append(t),e=this.$.display),this.oi&&(e||(s=this.ae.display.lines.length-1),this.ae.display.append(t),e=e||this.ae.display),e?(s<0&&(s=0),t=Object.assign({fragment:e.EndOfLine,line:e.lines[s].text},e.lines[s])):t={line:t,formats:[{formatType:0,offset:0,color:37,background:40,size:0,font:0,style:0,unicode:!1}],raw:t,timestamp:Date.now()}}else this.zn&&this.$.display.model.appendLines([t]),this.oi&&this.ae.display.model.appendLines([t]);this.client.getOption("chat.log")&&this.lt({action:"add-line",args:t})}Cr(){let t=Object.assign({},{show:!1,width:640,height:480,x:window.screenLeft+200,y:window.screenTop+200},this.client.getWindowState("chatWindow"));return this.oi&&(t.width=this.ae.document.body.clientWidth,t.height=this.ae.document.body.clientHeight,t.x=this.ae.screenLeft||this.ae.screenX,t.y=this.ae.screenTop||this.ae.screenY),t}Pa(t,e){let s=t.createElement("nav");return s.id="chat-toolbar",s.classList.add("navbar","bg-light","align-items-center"),s.innerHTML='<form class="container-fluid justify-content-start"><button id="btn-chat-clear" type="button" class="btn btn-sm btn-outline-secondary me-2 mb-1" title="Clear display"><i class="bi bi-trash"></i></button><button id="btn-chat-lock" type="button" class="btn btn-sm btn-outline-secondary me-2 mb-1" title="Lock display"><i class="bi bi-lock-fill"></i></button><div class="vr me-2" style="height: 29px;"></div><button id="btn-chat-log" type="button" class="btn btn-sm btn-outline-secondary me-2 mb-1" title="Log chat"><i class="bi bi-file-text"></i></button><div class="vr me-2" style="height: 29px;"></div><button id="btn-chat-wrap" type="button" class="btn btn-sm btn-outline-secondary me-2 mb-1" title="Toggle word wrap"><i class="bi bi-text-wrap"></i></button></form>',s.querySelector("#btn-chat-clear").addEventListener("click",()=>{e.clear()}),s.querySelector("#btn-chat-lock").addEventListener("click",()=>{this.client.setOption("chat.scrollLocked",!this.client.getOption("chat.scrollLocked")),this.oi&&(this.ae.display.scrollLock=this.client.getOption("chat.scrollLocked"),this.bn(this.ae.document.querySelector("#btn-chat-lock"),this.client.getOption("chat.scrollLocked"))),this.$&&(this.$.display.scrollLock=this.client.getOption("chat.scrollLocked"),this.bn(this.$.body.querySelector("#btn-chat-lock"),this.client.getOption("chat.scrollLocked")))}),s.querySelector("#btn-chat-log").addEventListener("click",()=>{this.client.setOption("chat.log",!this.client.getOption("chat.log")),this.client.getOption("chat.log")&&this.Oa(),this.oi&&this.ei(this.ae.document.querySelector("#btn-chat-log"),this.client.getOption("chat.log")),this.$&&this.ei(this.$.body.querySelector("#btn-chat-log"),this.client.getOption("chat.log")),this.Et&&this.lt({action:"toggle"})}),s.querySelector("#btn-chat-wrap").addEventListener("click",()=>{this.client.setOption("chat.wordWrap",!this.client.getOption("chat.wordWrap")),this.oi&&(this.ei(this.ae.document.querySelector("#btn-chat-wrap"),this.client.getOption("chat.wordWrap")),this.ae.display.wordWrap=this.client.getOption("chat.wordWrap")),this.$&&(this.ei(this.$.body.querySelector("#btn-chat-wrap"),this.client.getOption("chat.wordWrap")),this.$.display.wordWrap=this.client.getOption("chat.wordWrap"))}),this.bn(s.querySelector("#btn-chat-lock"),this.client.getOption("chat.scrollLocked")),this.ei(s.querySelector("#btn-chat-wrap"),this.client.getOption("chat.wordWrap")),this.ei(s.querySelector("#btn-chat-log"),this.client.getOption("chat.log")),s}bn(t,e){if(!t)return;let s=t.firstElementChild;e?(t.title="Unlock display",t.classList.add("active"),s.classList.add("bi-unlock-fill"),s.classList.remove("bi-lock-fill")):(t.title="Lock display",t.classList.remove("active"),s.classList.remove("bi-unlock-fill"),s.classList.add("bi-lock-fill"))}ei(t,e){t&&(e?t.classList.add("active"):t.classList.remove("active"))}showWindow(){if(!this.oi){let t=this.Cr();this.ae=window.open("window.htm","chat-window","toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width="+t.width+",height="+t.height+",top="+t.y+",left="+t.x),t.show=!0,this.ae.addEventListener("resize",()=>{this.client.setOption("windows.chatWindow",this.Cr()),ve(()=>{this.ae.display.container.style.top=this.ae.document.getElementById("chat-toolbar").offsetHeight+"px"},25,"chat-resize")}),this.ae.addEventListener("focus",()=>{this.client.setOption("windows.chatWindow",this.Cr())}),this.ae.addEventListener("blur",()=>{this.client.setOption("windows.chatWindow",this.Cr())}),this.ae.addEventListener("load",()=>{this.ae.document.querySelector("head").insertAdjacentHTML("afterbegin",'<<link id="icon1" rel="shortcut icon" href="images/chat.png" /><link id="icon2" rel="icon" href="images/chat.png" /><link id="icon3" rel="icon" type="image/x-icon" href="images/chat.png" /><link href="oiMUD.min.css" rel="stylesheet" type="text/css">>'),this.ae.document.title="Chat";let e=this.ae.document.createElement("div");e.id="chat-display",this.ae.document.body.append(e),this.ae.display=new st(e),this.ae.display.on("split-move-done",n=>{this.client.setOption("chat.splitHeight",n)}),this.Hn(this.ae.display),this.gl(this.ae.document);let s=this.Pa(this.ae.document,this.ae.display);this.ae.document.body.appendChild(s),this.ae.focus()})}}showDialog(){if(!this.$){this.$=new ye(Object.assign({},this.client.getWindowState("chat")||{center:!0},{title:'<i class="bi bi-chat"></i> Chat',minWidth:410,noFooter:!0,id:"chat-dialog"})),this.$.header.querySelector("#chat-dialog-max").insertAdjacentHTML("afterend",'<button type="button" class="btn btn-light float-end" id="chat-dialog-window" title="Open chat window" style="padding: 0 4px;margin-top: -1px;"><i class="bi bi-window"></i></button>'),this.$.header.querySelector("#chat-dialog-window").addEventListener("click",()=>{this.showWindow()});let t=document.createElement("div");t.id="chat-display",this.$.body.append(t),this.$.display=new st(t),this.$.display.on("split-move-done",s=>{this.client.setOption("chat.splitHeight",s)}),this.Hn(this.$.display),this.gl(this.$.body);let e=this.Pa(document,this.$.display);this.$.body.appendChild(e),this.$.on("resized",s=>{this.client.setOption("windows.chat",s),ve(()=>{t.style.top=e.offsetHeight+"px"},25,"chat-resize")}),this.$.on("closed",()=>{this.client.setOption("windows.chat",this.$.windowState),he("chat"),this.client.setOption("showChat",!1),this.$&&!this.$.persistent&&(delete this.$,this.$=null)}),this.$.on("canceled",()=>{this.client.setOption("windows.chat",this.$.windowState),he("chat"),this.client.setOption("showChat",!1),this.$&&!this.$.persistent&&(delete this.$,this.$=null)}),this.$.on("moved",s=>{this.client.setOption("windows.chat",s)}),this.$.on("maximized",()=>{this.client.setOption("windows.chat",this.$.windowState)}),this.$.on("restored",()=>{this.client.setOption("windows.chat",this.$.windowState)}),this.$.on("shown",()=>{this.client.setOption("windows.chat",this.$.windowState),this.client.setOption("showChat",!0)})}this.$.show()}show(){(this.client.getOption("showChatWindow")&1)==1&&this.showWindow(),(this.client.getOption("showChat")||(this.client.getOption("showChatWindow")&2)==2)&&this.showDialog()}toggleDialog(){this.zn?this.$.close():this.showDialog()}Ba(){if(!this.Us){for(let t=0,e=this.client.plugins.length;t<e;t++)if(this.client.plugins[t]instanceof Ht){this.Us=this.client.plugins[t];return}}}Oa(){this.Et||!client.getOption("chat.log")||(this.Ba(),this.Us&&(this.Et=this.Us.createLogger(),this.Et.addEventListener("message",t=>{switch(t.data.event){case"started":this.client.setOption("chat.log",!0),this.oi&&this.ei(this.ae.document.querySelector("#btn-chat-log"),!0),this.$&&this.ei(this.$.body.querySelector("#btn-chat-log"),!0);break;case"stopped":this.client.setOption("chat.log",!1),this.oi&&this.ei(this.ae.document.querySelector("#btn-chat-log"),!1),this.$&&this.ei(this.$.body.querySelector("#btn-chat-log"),!1),this.lt({action:"flush"}),this.Et.terminate(),this.Et=null;break;case"logging":break;case"error":this.client.error(t.data.args);break;case"debug":this.client?this.client.getOption("enableDebug")&&this.client.debug(t.data.args):console.log(t.data.args);break;case"toggled":this.client&&this.client.setOption("chat.log",t.data.args),this.oi&&this.ei(this.ae.document.querySelector("#btn-chat-log"),t.data.args),this.$&&this.ei(this.$.body.querySelector("#btn-chat-log"),t.data.args),t.data.args||(this.lt({action:"flush"}),this.Et.terminate(),this.Et=null);break;case"startInternal":case"start":this.zn?this.lt({action:t.data.event,args:{lines:this.$.display.lines,fragment:this.$.display.EndOfLine}}):this.oi?this.lt({action:t.data.event,args:{lines:this.ae.display.lines,fragment:this.ae.display.EndOfLine}}):this.lt({action:t.data.event});break;case"write":if(this.Ba(),!this.Us)return;this.Us.updateKey(t.data),localforage.getItem("OoMUDLog"+t.data.file).then(e=>{e||(e=""),e+=t.data.data,localforage.setItem("OoMUDLog"+t.data.file,e).then(()=>{this.Us.manager&&this.Us.manager.logChanged(t.data.file,t.data.data),this.lt({action:"write-done",file:t.data.file})})});break}}),this.Et.addEventListener("error",t=>{this.client?this.client.error(t):console.error(t)}),this.lt({action:"options",args:{offline:client.getOption("logOffline"),gagged:client.getOption("logGagged"),enabled:client.getOption("chat.log"),unique:client.getOption("logUniqueOnConnect"),prepend:client.getOption("logPrepend"),what:client.getOption("logWhat"),debug:client.getOption("enableDebug"),postfix:".chat",format:client.getOption("logTimeFormat"),timestamp:client.getOption("logTimestamp"),timestampFormat:client.getOption("logTimestampFormat")}})))}lt(t){this.Et&&this.Et.postMessage(t)}Hn(t){t.updateFont(client.getOption("chat.font"),client.getOption("chat.fontSize")),t.maxLines=client.getOption("chat.bufferSize"),t.enableFlashing=client.getOption("chat.flashing"),t.showTimestamp=client.getOption("chat.showTimestamp"),t.timestampFormat=client.getOption("chat.timestampFormat"),t.enableMXP=client.getOption("enableMXP"),t.enableURLDetection=client.getOption("enableURLDetection"),t.showInvalidMXPTags=client.getOption("display.showInvalidMXPTags"),t.hideTrailingEmptyLine=client.getOption("display.hideTrailingEmptyLine"),t.enableColors=client.getOption("chat.enableColors"),t.enableBackgroundColors=client.getOption("chat.enableBackgroundColors"),t.tabWidth=client.getOption("chat.tabWidth"),t.displayControlCodes=client.getOption("chat.displayControlCodes"),t.emulateTerminal=client.getOption("chat.emulateTerminal"),t.emulateControlCodes=client.getOption("chat.emulateControlCodes"),t.wordWrap=client.getOption("chat.wordWrap"),t.wrapAt=client.getOption("chat.wordWrapAt"),t.indent=client.getOption("chat.indent"),t.scrollLock=client.getOption("chat.scrollLocked"),t.enableSplit=client.getOption("chat.split"),t.splitLive=client.getOption("chat.splitLive"),t.splitHeight=client.getOption("chat.splitHeight"),t.scrollDisplay()}gl(t){this.bn(t.querySelector("#btn-chat-lock"),this.client.getOption("chat.scrollLocked")),this.ei(t.querySelector("#btn-chat-wrap"),this.client.getOption("chat.wordWrap")),this.ei(t.querySelector("#btn-chat-log"),this.client.getOption("chat.log"))}_i(){this.$&&(this.$.resetState(client.getWindowState("chat")||{center:!0}),this.Hn(this.$.display),this.gl(this.$.body)),this.ae&&(this.Hn(this.ae.display),this.gl(this.ae.document)),this.Et?this.lt({action:"options",args:{offline:client.getOption("logOffline"),gagged:client.getOption("logGagged"),enabled:client.getOption("chat.log"),unique:client.getOption("logUniqueOnConnect"),prepend:client.getOption("logPrepend"),what:client.getOption("logWhat"),debug:client.getOption("enableDebug"),prefix:"chat.",format:client.getOption("logTimeFormat"),timestamp:client.getOption("logTimestamp"),timestampFormat:client.getOption("logTimestampFormat")}}):this.Oa(),this.zn?this.lt({action:"start",args:{lines:this.$.display.lines,fragment:this.$.display.EndOfLine}}):this.oi?this.lt({action:"start",args:{lines:this.ae.display.lines,fragment:this.ae.display.EndOfLine}}):this.lt({action:"start"})}get oi(){return this.ae&&!this.ae.closed}get zn(){return this.$&&this.$.opened}};var Si=class extends me{constructor(t){super();this.bl=1034;this.Zs=!1;this._=t,this.initialize()}remove(){this._.removeListenersFromCaller(this)}initialize(){this._.telnet.GMCPSupports.push("Client 1"),this._.on("connected",()=>{this.bl=this._.port,this.yl(),this.bt=0,this.Zs=!1},this),this._.on("closed",()=>{this.bl=this._.port,this.yl(),this.bt=0,this.Zs=!1},this),this._.on("received-GMCP",async(t,e)=>{if(!(t.toLowerCase()!=="client"||!e))switch(this.zh(),e.action){case"save":if(this.Zs)return;this.$n=e.user,this.Na("Saving data"),this.Zs=!1,this.yt&&this.yt.map.changed?this.yt.map.save().then(()=>{this.Hs(2)}):this.Hs(2);break;case"load":this._.debug(`Starting load
    Chunks: ${e.chunks}
    Start chunk: ${e.chunk}
    Size: ${e.size}
`),this.Zs=!1,this.$n=e.user,this.bt=[e.chunks||1,e.chunk||0,e.size,""],this.Na("Loading data"),this.yt&&this.yt.map.changed?this.yt.map.save().then(()=>{this.So()}):this.So();break;case"error":this.Xi(e.error);break}}),this.bl=this._.port}get URL(){return this.bl===1039?"http://shadowmud.com:1132/client":"http://shadowmud.com:1130/client"}Hs(t){Nt.load().then(e=>{let s={version:2,profiles:this._.profiles.clone(2),settings:new ue,map:e?e.Rooms:{}},n,r,o=this._.getOption("backupSave");if((o&2)!==2&&(delete s.map,this._.debug("Backup save: setting for no mapper data enabled.")),(o&4)!==4&&(delete s.profiles,this._.debug("Backup save: setting for no profiles enabled.")),(o&16)!==16){for(n=Object.keys(s.settings),r=n.length-1;r>=0;r--)n[r].startsWith("windows.")&&delete s.settings[n[r]];this._.debug("Backup save: setting for no window data enabled.")}if((o&8)!==8){let h;if((o&16)===16)for(h={},n=Object.keys(s.settings),r=n.length-1;r>=0;r--)n[r].startsWith("windows.")&&(h[n[r]]=s.settings[n[r]]);delete s.settings,(o&16)===16&&(s.settings=h),this._.debug("Backup save: setting for no settings data enabled.")}else{let h=["chat","mapper","profiles","codeEditor","buttons","find","display","extensions"];for(let c=0,g=h.length;c<g;c++){let m={};s.settings[h[c]]&&(m=s.settings[h[c]]);let b=h[c]+".";for(n=Object.keys(s.settings),r=n.length-1;r>=0;r--)n[r].startsWith(b)&&(m[n[r].substring(b.length)]=s.settings[n[r]]);s.settings[h[c]]=m}s.settings.profiles?s.settings.profiles.find||(s.settings.profiles.find={}):s.settings.profiles={find:{}},s.settings.profiles.find.case=ue.getValue("profiles.find.case"),s.settings.profiles.find.word=ue.getValue("profiles.find.word"),s.settings.profiles.find.reverse=ue.getValue("profiles.find.reverse"),s.settings.profiles.find.regex=ue.getValue("profiles.find.regex"),s.settings.profiles.find.selection=ue.getValue("profiles.find.selection"),s.settings.profiles.find.show=ue.getValue("profiles.find.show"),s.settings.profiles.find.value=ue.getValue("profiles.find.value"),delete s.settings["profiles.find.case"],delete s.settings["profiles.find.word"],delete s.settings["profiles.find.reverse"],delete s.settings["profiles.find.regex"],delete s.settings["profiles.find.selection"],delete s.settings["profiles.find.show"],delete s.settings["profiles.find.value"]}let a=JSON.stringify(s);a=LZString.compressToEncodedURIComponent(a),this.bt=[a.match(/((\S|\s|.){1,20000})/g),0,0],this.bt[3]=this.bt[0].length,this.Da()}).catch(e=>this._.error(e))}Xi(t){t?this._.debug("client load/save aborted for"+t):this._.debug("client load/save aborted"),this.yl(),alert_box("Aborted",t||"Aborted importing or exporting data.",4),this.bt=0,this.Zs=!0,$.ajax({type:"POST",url:this.URL,data:{user:this.$n,a:"abort"}})}Aa(){this.yl(),this.bt=0,this.Zs=!1,$.ajax({type:"POST",url:this.URL,data:{user:this.$n,a:"done"}})}So(){this._.debug("Requesting client chunk "+this.bt[1]),$.ajax({type:"POST",url:this.URL,data:{user:this.$n,a:"get",c:++this.bt[1]},dataType:"json",success:t=>{this.Zs||(t?t.msg?this.Xi(t.msg||"Error"):t.error?this.Xi(t.error):(this.bt[1]=t.chunk||0,this.bt[3]+=t.data||"",this._.debug("Got client chunk "+this.bt[1]),this.Ga((this.bt[1]+1)/this.bt[0]*100),this.bt[1]>=this.bt[0]-1?this.Hh():this.So()):this.Xi("No data returned"))},error:(t,e,s)=>{this.Xi(e)}})}Da(){$.ajax({type:"POST",url:this.URL,data:{user:this.$n,a:"save",data:this.bt[0].shift(),append:this.bt[1]>0?1:0},dataType:"json",success:t=>{t?t.msg!=="Successfully saved"?this.Xi(t.msg||"Error"):t.error?this.Xi(t.error):this.bt[0].length>0?(this.Ga(this.bt[1]/this.bt[3]*100),this.bt[1]++,this.Da()):(typeof this.bt[2]=="function"&&this.bt[2](),client.raise("backup-saved"),this.Aa()):this.Xi("No data returned")},error:(t,e,s)=>{this.Xi(e)}})}Hh(){this._.debug("Got last chunk, processing data");let t=LZString.decompressFromEncodedURIComponent(this.bt[3]);if(t=JSON.parse(t),t.version===2){let e=this._.getOption("backupLoad");if(t.map&&(e&2)===2&&this.yt.import(t.map,client.getOption("mapper.importType")),t.profiles&&(e&4)===4){let r=new Bt,o=Object.keys(t.profiles),a=o.length,h,c=0;for(;c<a;c++){h=o[c];let g=new Be(h);g.priority=t.profiles[o[c]].priority,g.enabled=!!t.profiles[o[c]].enabled,g.enableMacros=!!t.profiles[o[c]].enableMacros,g.enableTriggers=!!t.profiles[o[c]].enableTriggers,g.enableAliases=!!t.profiles[o[c]].enableAliases,g.enableDefaultContext=!!t.profiles[o[c]].enableDefaultContext,g.macros=[];let m=t.profiles[o[c]].macros.length,b;if(m>0)for(let u=0;u<m;u++)b=new dt,b.key=t.profiles[o[c]].macros[u].key,b.value=t.profiles[o[c]].macros[u].value,b.style=t.profiles[o[c]].macros[u].style,b.append=!!t.profiles[o[c]].macros[u].append,b.send=!!t.profiles[o[c]].macros[u].send,b.name=t.profiles[o[c]].macros[u].name,b.group=t.profiles[o[c]].macros[u].group,b.enabled=!!t.profiles[o[c]].macros[u].enabled,b.modifiers=t.profiles[o[c]].macros[u].modifiers,b.chain=!!t.profiles[o[c]].macros[u].chain,b.notes=t.profiles[o[c]].macros[u].notes||"",g.macros.push(b);if(m=t.profiles[o[c]].aliases.length,m>0)for(let u=0;u<m;u++)b=new it,b.pattern=t.profiles[o[c]].aliases[u].pattern,b.value=t.profiles[o[c]].aliases[u].value,b.style=t.profiles[o[c]].aliases[u].style,b.multi=!!t.profiles[o[c]].aliases[u].multi,b.append=!!t.profiles[o[c]].aliases[u].append,b.name=t.profiles[o[c]].aliases[u].name,b.group=t.profiles[o[c]].aliases[u].group,b.enabled=!!t.profiles[o[c]].aliases[u].enabled,b.params=t.profiles[o[c]].aliases[u].params,b.priority=t.profiles[o[c]].aliases[u].priority,b.notes=t.profiles[o[c]].aliases[u].notes||"",g.aliases.push(b);if(m=t.profiles[o[c]].triggers.length,m>0)for(let u=0;u<m;u++){if(b=new Te,b.pattern=t.profiles[o[c]].triggers[u].pattern,b.value=t.profiles[o[c]].triggers[u].value,b.style=t.profiles[o[c]].triggers[u].style,b.verbatim=!!t.profiles[o[c]].triggers[u].verbatim,b.name=t.profiles[o[c]].triggers[u].name,b.group=t.profiles[o[c]].triggers[u].group,b.enabled=!!t.profiles[o[c]].triggers[u].enabled,b.priority=t.profiles[o[c]].triggers[u].priority,b.triggerNewline=!!t.profiles[o[c]].triggers[u].triggernewline,b.caseSensitive=!!t.profiles[o[c]].triggers[u].caseSensitive,b.triggerPrompt=!!t.profiles[o[c]].triggers[u].triggerprompt,b.raw=!!t.profiles[o[c]].triggers[u].raw,b.temp=!!t.profiles[o[c]].triggers[u].temp,b.type=t.profiles[o[c]].triggers[u].type,b.notes=t.profiles[o[c]].triggers[u].notes||"",b.state=t.profiles[o[c]].triggers[u].state||0,b.params=t.profiles[o[c]].triggers[u].params||"",b.fired=!!t.profiles[o[c]].triggers[u].fired,t.profiles[o[c]].triggers[u].triggers&&t.profiles[o[c]].triggers[u].triggers.length){let E=t.profiles[o[c]].triggers[u].triggers.length;for(let w=0;w<E;w++)b.triggers.push(new Te(t.profiles[o[c]].triggers[u].triggers[w]))}g.triggers.push(b)}if(t.profiles[o[c]].buttons&&(m=t.profiles[o[c]].buttons.length,m>0))for(let u=0;u<m;u++)b=new ke(t.profiles[o[c]].buttons[u]),g.buttons.push(b);if(t.profiles[o[c]].contexts&&(m=t.profiles[o[c]].contexts.length,m>0))for(let u=0;u<m;u++)b=new vt(t.profiles[o[c]].contexts[u]),g.contexts.push(b);r.add(g,!0)}r.update(),r.save().then(()=>{this._.loadProfiles()})}let s,n;if((e&8)===8){this._.setOption("mapper.enabled",!!t.settings.mapEnabled),this._.setOption("mapper.follow",!!t.settings.mapFollow),this._.setOption("mapper.legend",!!t.settings.legend),this._.setOption("mapper.split",!!t.settings.MapperSplitArea),this._.setOption("mapper.fill",!!t.settings.MapperFillWalls),this._.setOption("mapper.vscroll",t.settings.vscroll),this._.setOption("mapper.hscroll",t.settings.hscroll),this._.setOption("mapper.memory",!!t.settings.mapperMemory),this._.setOption("showScriptErrors",!!t.settings.showScriptErrors),this._.setOption("logWhat",t.settings?1:0),this._.setOption("showMapper",!!t.settings.MapperOpen);let r,o;for(r=0,o=Hi.length;r<o;r++){let h=Hi[r];t.settings.hasOwnProperty(h)&&(h.startsWith("profiles.")||h.startsWith("codeEditor.")||h.startsWith("buttons.")||h.startsWith("find.")||h.startsWith("extensions.")||h.startsWith("windows.")||h.startsWith("profiles.")||this._.setOption(h,t.settings[h]))}if(t.settings.windows&&(e&16)===16){if(t.settings.windows)for(s=Object.keys(t.settings.windows),n=s.length-1;n>=0;n--)this._.setOption(`windows.${s[n]}`,t.settings.windows[s[n]]);for(s=Object.keys(t.settings),n=s.length-1;n>=0;n--)s[n].startsWith("windows.")&&this._.setOption(s[n],t.settings[s[n]])}let a=["chat","mapper","profiles","codeEditor","buttons","find","display","extensions"];for(r=0,o=a.length;r<o;r++)if(!(!t.settings[a[r]]||!t.settings.hasOwnProperty(a[r])))for(s=Object.keys(t.settings[a[r]]),n=s.length-1;n>=0;n--)this._.setOption(`${a[r]}.${s[n]}`,t.settings[a[r]][s[n]]);t.settings.profiles&&t.settings.profiles.find&&(this._.setOption("profiles.find.case",t.settings.profiles.find.case),this._.setOption("profiles.find.word",t.settings.profiles.find.word),this._.setOption("profiles.find.reverse",t.settings.profiles.find.reverse),this._.setOption("profiles.find.regex",t.settings.profiles.find.regex),this._.setOption("profiles.find.selection",t.settings.profiles.find.selection),this._.setOption("profiles.find.show",t.settings.profiles.find.show),this._.setOption("profiles.find.value",t.settings.profiles.find.value)),this._.clearCache(),this._.loadOptions()}else if(t.settings&&(e&16)===16){if(t.settings.windows)for(s=Object.keys(t.settings.windows),n=s.length-1;n>=0;n--)this._.setOption(`windows.${s[n]}`,t.settings.windows[s[n]]);for(s=Object.keys(t.settings),n=s.length-1;n>=0;n--)s[n].startsWith("windows.")&&this._.setOption(s[n],t.settings[s[n]])}}client.raise("backup-loaded"),this.Aa()}Na(t){if(this.mt)throw new Error("Client save/load is already in progress");this.mt=progress_box(t||"Saving data"),this.mt.on("canceled",()=>{this.Xi()}),this.mt.on("closed",e=>{e==="canceled"&&this.Xi()}),this.mt.on("shown",()=>{}),this.mt.showModal()}yl(){this.mt&&this.mt.close(),this.mt=null}Ga(t){this.mt&&(this.mt.progress=t)}zh(){if(!this.yt){for(let t=0,e=this._.plugins.length;t<e;t++)if(this._.plugins[t]instanceof nt){this.yt=this._.plugins[t];break}}}};var Jt=class extends Re{constructor(p){super(p),this.backup=new Si(p),ue.exist("mail.timeout")||this.client.setOption("mail.timeout",5e3)}remove(){this.backup.remove(),this.client.removeListenersFromCaller(this);let p=this.client.telnet.GMCPSupports.indexOf("oMUD.Info 1");this.client.telnet.GMCPSupports.splice(p,1)}initialize(){this.client.telnet.GMCPSupports.push("oMUD.Info 1"),this.client.on("add-line",t=>{!this.Tr&&t.fragment&&t.line.startsWith("--More--")&&this.client.getOption("skipMore")&&(this.Mr=e=>{clearTimeout(this.Tr||0),this.Tr=0,this.Mr=0},this.client.once("parse-command",this.Mr,this),this.Tr=setTimeout(()=>{this.client.removeListener("parse-command",this.Mr),this.Tr=0,this.Mr=0,this.client.sendCommand(`
`)},this.client.getOption("skipMoreDelay")>=0?this.client.getOption("skipMoreDelay"):0)),this.ki&&(t.line==="Subject: "&&t.fragment?this.Rr(this.ki.subject,4):this.ki.body!==null&&t.line.length&&t.line.split("").every(e=>e==="_")?(this.Rr(this.ki.body,2),this.Rr(".",4),this.ki.body=null):t.line==="Cc: "&&t.fragment&&(this.Rr(this.ki.cc,1),this.Ae.clear(),this.ki=null,this.ve&&this.ve.close()))},this),this.client.on("window",(t,e,s)=>{switch(t){case"shadowmudhelp":case"shadowmud-help":case"smhelp":e==="close"?this.kt&&this.kt.close():this.Eo();break;case"composer":e==="close"?this.ve&&this.ve.close():this.Lo();break}},this),this.client.on("close-window",t=>{switch(t){case"shadowmudhelp":case"shadowmud-help":case"smhelp":this.kt&&this.kt.close();break;case"composer":this.ve&&this.ve.close();break}},this),this.client.on("options-loaded",()=>{if(this.kt&&this.kt.resetState(client.getWindowState("smhelp")||{center:!0,width:400,height:275}),this.ve&&(this.ve.resetState(client.getWindowState("composer")||{center:!0}),this.ve.persistent=this.ve.windowState.persistent,this.Ae.simple!=client.getOption("simpleComposer"))){let t="";this.Ae.isSimple||(t=this.Ae.getFormattedText().replace(/(?:\r)/g,"")),this.Ae.simple=client.getOption("simpleComposer"),this.Ae.isSimple?(this.Ae.value=t,this.ve.showFooter(),this.ve.header.querySelector("#composer-switch")&&(this.ve.header.querySelector("#composer-switch").title="Switch to advanced"),setTimeout(()=>this.Ae.focus(),100),this.ve.dialog.dataset.type="simple"):(this.ve.hideFooter(),this.ve.header.querySelector("#composer-switch")&&(this.ve.header.querySelector("#composer-switch").title="Switch to simple"),this.ve.dialog.dataset.type="advanced")}});let p=this.client.getWindowState("smhelp");p&&p.show&&this.Eo(),p=this.client.getWindowState("composer"),p&&p.show&&this.Lo()}Eo(){if(this.client.getOption("externalHelp")){window.open("http://www.shadowmud.com/help.php","_blank");return}if(!this.kt){this.kt=new ye(Object.assign({},this.client.getWindowState("smhelp")||{center:!0,width:500,height:375},{title:'<i class="shadowmud-icon"></i> ShadowMUD Help',id:"smhelp",noFooter:!0}));let p=document.createElement("iframe");p.src="http://shadowmud.com/OoMUD/smhelp.php",p.id="smhelp-frame",p.classList.add("full-page"),this.kt.body.append(p),this.kt.on("closed",()=>{this.client.setOption("windows.smhelp",this.kt.windowState),this.kt=null,he("smhelp")}),this.kt.on("canceled",()=>{this.client.setOption("windows.smhelp",this.kt.windowState),this.kt=null,he("smhelp")}),this.kt.on("resized",t=>{this.client.setOption("windows.smhelp",t)}),this.kt.on("moved",t=>{this.client.setOption("windows.smhelp",t)}),this.kt.on("maximized",()=>{this.client.setOption("windows.smhelp",this.kt.windowState)}),this.kt.on("restored",()=>{this.client.setOption("windows.smhelp",this.kt.windowState)}),this.kt.on("shown",()=>{this.client.setOption("windows.smhelp",this.kt.windowState)})}this.kt.show()}Lo(){if(!this.ve){this.ve=new ye(Object.assign({},this.client.getWindowState("composer")||{center:!0},{title:'<i class="bi bi-envelope"></i> Compose mail',id:"composer"})),this.ve.on("resized",e=>{this.client.setOption("windows.composer",e)}),this.ve.on("moved",e=>{this.client.setOption("windows.composer",e)}),this.ve.on("maximized",()=>{this.client.setOption("windows.composer",this.ve.windowState)}),this.ve.on("restored",()=>{this.client.setOption("windows.composer",this.ve.windowState)}),this.ve.on("shown",()=>{if(this.client.setOption("windows.composer",this.ve.windowState),this.Ae.initialize(),this.ki&&(this.Pr(!0),document.getElementById("composer-to").value=this.ki.to,document.getElementById("composer-cc").value=this.ki.cc,document.getElementById("composer-subject").value=this.ki.subject,this.Ae.value=this.ki.body||"",!this.ks)){let e=this.client.getOption("mail.timeout");e<1e3&&(e=1e3),e>2e4&&(e=2e4),this.ks=setTimeout(()=>{alert_box("Error","Sendmail timed out try again.",3),this.ki=null,this.Pr(!1),this.ks=0},e)}}),this.ve.on("closing",()=>{this.ve.windowState.persistent?this.Ae.clear():this.Ae.remove()}),this.ve.on("closed",()=>{this.client.setOption("windows.composer",this.ve.windowState),this.ve.windowState.persistent?this.Pr(!1):(this.ve.dialog.composer.removeAllListeners(),delete this.ve.dialog.composer,this.ve.removeAllListeners(),this.Ae.remove(),this.Ae=null,this.ve=null),he("composer")}),this.ve.on("canceling",()=>{this.ve.windowState.persistent?this.Ae.clear():this.Ae.remove()}),this.ve.on("canceled",()=>{this.client.setOption("windows.composer",this.ve.windowState),this.ve.windowState.persistent||(this.ve.dialog.composer.removeAllListeners(),delete this.ve.dialog.composer,this.Ae.removeAllListeners(),this.Ae.remove(),this.Ae=null,this.ve=null),he("composer")}),this.ve.on("focus",()=>this.Ae.focus()),this.ve.body.innerHTML='<div class="m-1 input-group has-validation" style="width: auto"><div class="input-group-text" style="width: 85px"><label class="form-check-label ms-1" for="composer-to" style="width: 100%;text-align: left;">To</label></div><input type="text" class="form-control" id="composer-to" required><div class="invalid-tooltip" id="composer-to-feedback" style="left: 85px;z-index:100;"></div></div><div class="m-1 input-group" style="width: auto"><div class="input-group-text" style="width: 85px"><label class="form-check-label ms-1" for="composer-cc" style="width: 100%;text-align: left;">CC</label></div><input type="text" class="form-control" id="composer-cc"></div><div class="m-1 input-group" style="width: auto"><div class="input-group-text" style="width: 85px"><label class="form-check-label ms-1" for="composer-subject" style="width: 100%;text-align: left;">Subject</label></div><input type="text" class="form-control" id="composer-subject"></div>';let p=document.createElement("div");p.id="composer-body",this.ve.body.appendChild(p);let t=document.createElement("textarea");t.classList.add("form-control","form-control-sm"),t.id="composer-txt",p.appendChild(t),this.ve.body.style.overflow="hidden",this.Ae||(this.Ae=new Wt(t,!this.client.getOption("simpleComposer"),{sendTitle:"Send mail",sendFetch:[{text:"Formatted",value:"rawformatted",type:"choiceitem"},{text:"Text",value:"rawtext",type:"choiceitem"}]})),this.Ae.on("send-action",e=>{e.preventDefault=!0,this.wl(this.Ae.getFormattedText().replace(/(?:\r)/g,""),3)}),this.Ae.on("send-item-action",e=>{switch(e.preventDefault=!0,e.value){case"rawformatted":this.wl(this.Ae.getFormattedText().replace(/(?:\r)/g,""),3);break;case"rawtext":this.wl(this.Ae.getText().replace(/(?:\r)/g,""),3);break}}),this.Ae.on("close",()=>{this.ve.close()}),this.Ae.on("editor-init",()=>this.Ae.focus()),this.Ae.on("click",()=>this.ve.focus()),this.ve.dialog.composer=this.Ae,tinymce&&this.ve.header.querySelector("#composer-max").insertAdjacentHTML("afterend",'<button type="button" class="btn btn-light float-end" id="composer-switch" title="Switch to advanced" style="padding: 0 4px;margin-top: -1px;"><i class="bi-shuffle"></i></button>'),this.ve.footer.innerHTML='<button id="btn-composer-clear" type="button" class="btn-sm float-start btn btn-light" title="Clear composer"><i class="bi bi-journal-x"></i><span class="icon-only"> Clear</span></button><button id="btn-composer-append" type="button" class="btn-sm float-start btn btn-light" title="Append file..."><i class="bi bi-box-arrow-in-down"></i><span class="icon-only"> Append file...</span></button><button id="btn-composer-send" type="button" class="btn-sm float-end btn btn-primary" title="Send"><i class="bi bi-send-fill"></i><span class="icon-only"> Send</span></button>',this.ve.header.querySelector("#composer-switch")&&(this.Ae.isSimple||(this.ve.header.querySelector("#composer-switch").title="Switch to simple",this.ve.dialog.dataset.type="advanced"),this.ve.header.querySelector("#composer-switch").addEventListener("click",()=>{this.client.setOption("simpleComposer",!this.Ae.simple);let e="";this.Ae.isSimple||(e=this.Ae.getFormattedText().replace(/(?:\r)/g,"")),this.Ae.simple=!this.Ae.simple,this.Ae.isSimple?(this.Ae.value=e,this.ve.showFooter(),this.ve.header.querySelector("#composer-switch").title="Switch to advanced",setTimeout(()=>this.Ae.focus(),100),this.ve.dialog.dataset.type="simple"):(this.ve.hideFooter(),this.ve.header.querySelector("#composer-switch").title="Switch to simple",this.ve.dialog.dataset.type="advanced")})),document.getElementById("btn-composer-append").addEventListener("click",()=>{Se("Append file",!1).then(e=>{Ee(e[0]).then(s=>{this.Ae.insert(s)}).catch(s=>this.client.error(s))}).catch(()=>{})}),document.getElementById("btn-composer-send").addEventListener("click",()=>{this.wl(this.Ae.getFormattedText().replace(/(?:\r)/g,""),3)}),document.getElementById("btn-composer-clear").addEventListener("click",()=>{this.Ae.clear(),this.Ae.focus()}),this.Ae.isSimple||this.ve.hideFooter()}this.ve.show(),this.Ae.isSimple&&this.Ae.focus()}get menu(){return[{name:" ShadowMUD help",action:()=>this.Eo(),icon:'<i class="shadowmud-icon-light"></i>',position:-4},{name:" Compose mail",action:()=>this.Lo(),icon:'<i class="bi bi-envelope"></i>',position:"#menu-editor"}]}get settings(){return[{name:" ShadowMUD",action:"settings-shadowmud",icon:'<i class="shadowmud-icon"></i>'}]}async wl(p,t){if(!this.client.connected){alert_box("Not connected","Must be connected to mud to send mail.",3);return}try{if(await this.$h()){alert_box("In editor","Can not send mail while in editor.",3);return}}catch(n){alert_box("Error",n,3),this.Pr(!1);return}var e=document.getElementById("composer-to"),s=(e.value.split(/ |,/)||[]).filter(n=>n.length>0);if(e.classList.remove("is-invalid"),s.length===0){e.classList.add("is-invalid"),this.ve.body.querySelector("#composer-to-feedback").textContent="Must supply at least one recipient",e.focus();return}this.Pr(!0),this.Rr("mail "+s.join(" "),t),this.ki={to:s.join(" "),body:p||"",subject:document.getElementById("composer-subject").value||"",cc:(document.getElementById("composer-cc").value.split(/ |,/)||[]).filter(n=>n.length>0).join(" ")}}Rr(p,t){switch(p+=`
`,t){case 1:this.client.sendBackground(p,!0);break;case 2:this.client.send(p,!1);break;case 3:this.client.sendRaw(p);break;case 4:this.client.send(p,!0);break;default:this.client.sendCommand(p);break}}async $h(){return new Promise((p,t)=>{let e=this.client.getOption("mail.timeout");e<1e3&&(e=1e3),e>2e4&&(e=2e4),this.ks=setTimeout(()=>{t("Sendmail timed out try again."),this.ks=0},e),this.client.sendGMCP("oMUD.inEdit"),this.client.on("received-GMCP",(s,n)=>{s.toLowerCase()==="omud.info"?(clearTimeout(this.ks),this.client.removeListenersFromCaller(this,"received-GMCP"),this.ks=0,p(n.inEdit||!1)):s.toLowerCase()==="core.goodbye"&&(clearTimeout(this.ks),this.ks=0,this.client.removeListenersFromCaller(this,"received-GMCP"),t("Disconnected"))},this)})}Pr(p){this.Ae.readOnly=p,document.getElementById("composer-to").disabled=p,document.getElementById("composer-cc").disabled=p,document.getElementById("composer-subject").disabled=p}};window.ShadowMUD=Jt;var Ei=class extends Re{constructor(t){super(t instanceof Ve?t:t?.client);this.un=!1;this.jt=1;t&&(t.mapper&&t.mapper instanceof nt&&(this.yt=t.mapper),t.chat&&t.chat instanceof Et&&(this.Ri=t.chat)),t&&"location"in t&&(this.jt=t.location),ue.exist("showPanelBar")||this.client.setOption("showPanelBar",!yt()),ue.exist("panelBar.panels")||this.client.setOption("panelBar.panels",6),ue.exist("panelBar.location")||this.client.setOption("panelBar.location",yt()?0:1),ue.exist("panelBar.order")||this.client.setOption("panelBar.order",0),ue.exist("panelBar.mapScale")||this.client.setOption("panelBar.mapScale",100),this.li=document.getElementById("client-container"),this.Fh()}get location(){return this.jt}set location(t){t!==this.jt&&(this.jt===1?(this.li.style.top="",this.pt.style.height="",this.pt.style.right="",document.getElementById("panel-bar-drag-bar").style.right=""):(this.li.style.left="",this.pt.style.width=""),this.jt=t,this.pt.dataset.location=""+t,document.getElementById("panel-bar-drag-bar").dataset.location=""+t,this.We.orientation=this.jt===0?0:1,this.fi())}Fh(){document.body.insertAdjacentHTML("beforeend",`<div id="panel-bar-drag-bar" data-location="${this.jt}"></div><div id="panel-bar" data-location="${this.jt}"><button id="panel-bar-close" style="padding: 4px;" type="button"
        class="button button-sm btn-close" title="Hide panel bar"></button></div>`),this.pt=document.getElementById("panel-bar"),this.We=new je({id:"panel-bar",parent:this.pt,orientation:this.jt===0?0:1,anchor:1}),this.We.splitterWidth=3,this.We.live=!1,this.client.getOption("panelBar.separator")>=200&&(this.We.SplitterDistance=this.client.getOption("panelBar.separator")),this.We.on("splitter-moved",t=>{this.client.setOption("panelBar.separator",t)})}remove(){this.za(),this.Ha(),this.client.removeListenersFromCaller(this),this.client.display.removeListenersFromCaller(this)}initialize(){this.Uh(),this.$a(),this.Fa(),this.client.on("plugin-added",s=>{!this.Ri&&s instanceof Et&&(this.Ri=s,this.$a()),!this.yt&&s instanceof nt&&(this.yt=s,this.Fa())},this),this.client.on("plugin-removed",s=>{this.Ri===s&&(this.Ha(),this.Ri=null),this.yt===s&&(this.za(),this.yt=null)},this),this.client.on("options-loaded",()=>{let s=client.getOption("panelBarSize");s>this.maxWidth&&(s=this.maxWidth),s<184&&s!=-1&&(s=184),this.splitterDistance=s,this.fi(),this._i(),this.Ti()},this),this.client.on("option-changed",(s,n)=>{(s.startsWith("mapper.")||s.startsWith("chat.")||s==="commandDelay"||s==="commandDelayCount"||s==="enableMXP"||s==="enableURLDetection"||s==="display.showInvalidMXPTags"||s==="display.hideTrailingEmptyLine")&&(this._i(),this.Ti())}),this.client.display.on("resize",()=>{this.fi()},this),document.getElementById("panel-bar-drag-bar").addEventListener("mousedown",s=>{if(s.button!==0)return;s.preventDefault(),this.un=!0;let n=document.getElementById("panel-bar-drag-bar"),r="width",o="left",a="pageX",h="right";this.jt===1&&(r="height",o="top",a="pageY",h="bottom");let c=this.pt.style[r];this.pt.style[r]="";let g=this.pt.getBoundingClientRect();this.pt.style[r]=c;let m=n.getBoundingClientRect(),b=document.createElement("div");b.id="panel-bar-ghost-bar",this.jt===1?(b.style.left="0",b.style.right="0",b.style.top=m.top+"px",b.style.cursor="ns-resize",b.style.right=this.li.style.right):(b.style.top="0",b.style.bottom="0",b.style.left=m.left+"px",b.style.cursor="ew-resize"),b.dataset.location=""+this.jt,document.body.append(b);let u=Math.max(this.maxWidth,g[r]);this.dn=E=>{E[a]>=u?b.style[o]=u+"px":E[a]<g[h]?b.style[o]=g[h]+"px":b.style[o]=E[a]+"px"},document.addEventListener("mousemove",this.dn)}),window.addEventListener("resize",()=>this.fe()),document.addEventListener("mouseup",s=>{if(!this.un)return;let n="width",r="pageX",o="right";this.jt===1&&(n="height",r="pageY",o="bottom");let a=this.pt.style[n];this.pt.style[n]="";let h=this.pt.getBoundingClientRect()[o],c=document.getElementById("panel-bar-drag-bar").getBoundingClientRect()[n],g=Math.max(this.maxWidth,h);this.pt.style[n]=a,s[r]>=g?this.splitterDistance=g:s[r]<h?this.splitterDistance=h:this.splitterDistance=s[r]-c,document.getElementById("panel-bar-ghost-bar").remove(),document.removeEventListener("mousemove",this.dn),this.un=!1,this.fi()}),document.getElementById("panel-bar-close").addEventListener("click",()=>{this.client.setOption("showPanelBar",!1),this.fi(),this.Ti()});let t=client.getOption("panelBarSize");t>this.maxWidth&&(t=this.maxWidth),t<184&&t!=-1&&(t=184),this.splitterDistance=t,this.Gn(),this.fi(),this.vl=document.createElement("div"),this.vl.id="mini-map-title",this.qi=document.createElement("input"),this.qi.id="mini-map-zoom",this.qi.classList.add("form-range"),this.qi.type="range",this.qi.min="25",this.qi.max="300",this.qi.step="5",this.qi.addEventListener("input",s=>{this._e.scale=+s.currentTarget.value,this.Ua()}),this._e=new Gt(document.createElement("div"),{map:this.yt?this.yt.map:null}),this._e.showNavigation=!1,this._e.container.classList.add("mini-map","map","panel-container"),this._e.container.insertAdjacentHTML("afterbegin",'<button id="btn-mini-map-focus" type="button" class="float-start me-2 button button-sm" title="Focus on current room"><i class="fa fa-crosshairs"></i></button>'),this._e.container.querySelector("#btn-mini-map-focus").addEventListener("click",()=>{this._e.focusCurrentRoom()}),this._e.on("active-room-changed",s=>{this.xl(s?s.area:"")}),this._e.on("current-changed",s=>{this.xl(s?s.area:"")}),this._e.on("setting-changed",(s,n)=>{s==="scale"&&(this.qi.value=n,this.Ua(),this.client.setOption("panelBar.mapScale",n))}),this._e.active=new Ie(client.getOption("mapper.active")),this._e.active.num=this._e.active.num||this._e.active.ID,this.Si=new st(document.createElement("div")),this.Si.on("split-move-done",s=>{this.client.setOption("chat.splitHeight",s)}),this.Si.container.classList.add("panel-container"),this.Za();let e=document.createElement("div");e.id="panel-bar-chat-toolbar",e.classList.add("navbar","bg-light","align-items-center"),e.innerHTML='<form class="container-fluid justify-content-start"><button id="btn-chat-panel-clear" type="button" class="ms-2 me-2 button button-sm" title="Clear display"><i class="bi bi-trash"></i></button><button id="btn-chat-panel-lock" type="button" class="me-2  button button-sm" title="Lock display"><i class="bi bi-lock-fill"></i></button><div class="vr me-2" style="height: 29px;"></div><button id="btn-chat-panel-wrap" type="button" class="me-2  button button-sm" title="Toggle word wrap"><i class="bi bi-text-wrap"></i></button></form>',this.Si.container.append(e),e.querySelector("#btn-chat-panel-clear").addEventListener("click",()=>{this.Si.clear()}),e.querySelector("#btn-chat-panel-lock").addEventListener("click",()=>{this.client.setOption("chat.scrollLocked",!this.client.getOption("chat.scrollLocked")),this.Si.scrollLock=this.client.getOption("chat.scrollLocked"),this.bn(e.querySelector("#btn-chat-panel-lock"),this.client.getOption("chat.scrollLocked"))}),e.querySelector("#btn-chat-panel-wrap").addEventListener("click",()=>{this.client.setOption("chat.wordWrap",!this.client.getOption("chat.wordWrap")),this.ei(e.querySelector("#btn-chat-panel-wrap"),this.client.getOption("chat.wordWrap")),this.Si.wordWrap=this.client.getOption("chat.wordWrap")}),this._e.map&&this.xl(this._e.current?this._e.current.area:""),this._i()}get menu(){return[{name:"-",position:5,exists:"#menu-plugins",id:"plugins"},{id:"panel-bar",name:this.client.getOption("showPanelBar")?" Hide panel bar":" Show panel bar",active:this.client.getOption("showPanelBar"),action:t=>{this.client.setOption("showPanelBar",!this.client.getOption("showPanelBar")),this.fi(),this.Ti()},icon:'<i class="bi bi-layout-sidebar"></i>',position:"#menu-plugins",hidden:this.client.getOption("panelBar.panels")===0}]}get settings(){return[{name:" Panel bar",action:"settings-panelBar",icon:'<i class="bi bi-layout-sidebar"></i>',position:'a[href="#settings-specialCharacters"]'}]}Uh(){if(!(this.Ri&&this.yt))for(let t=0,e=this.client.plugins.length;t<e;t++)!this.Ri&&this.client.plugins[t]instanceof Et&&(this.Ri=this.client.plugins[t]),!this.yt&&this.client.plugins[t]instanceof nt&&(this.yt=this.client.plugins[t])}$a(){this.Ri&&(this.Ri.on("update-chat",t=>{this.Si&&(typeof t=="string"?this.Si.append(t):this.Si.model.appendLines([t]))},this),this.Ri.on("chat-only-open",t=>{this.Si&&(this.client.getOption("panelBar.panels")&4)===4&&(t.open=!0)},this))}Fa(){this.yt&&this.yt.on("map-loaded",()=>{this._e&&(this._e.map=this.yt.map,this.xl(this._e.active?this._e.active.area:""))},this)}za(){this.yt&&(this.yt.map.removeListenersFromCaller(this),this.yt.removeListenersFromCaller(this))}Ha(){this.Ri&&this.Ri.removeListenersFromCaller(this)}get splitterDistance(){return this.gt}set splitterDistance(t){t!==this.gt&&(this.gt=t,this.Gn())}get maxWidth(){return this.jt===1?Math.floor(document.body.clientHeight*.33):Math.floor(document.body.clientWidth*.33)}Gn(){if(!this.gt||this.gt<1){let t=this.pt.getBoundingClientRect();this.jt===1?this.gt=t.bottom:this.gt=t.right}this.fi(),this.client.setOption("panelBarSize",this.gt),this.emit("split-moved",this.gt)}fe(){if(!this.client.getOption("showPanelBar")||this.client.getOption("panelBar.panels")===0)return;let t="width",e="right";this.jt===1&&(t="height",e="bottom");let s=this.pt.style[t];this.pt.style[t]="";let n=this.pt.getBoundingClientRect()[e],r=Math.max(this.maxWidth,n);this.pt.style[t]=s;let o=this.pt.getBoundingClientRect();o[t]<n?this.splitterDistance=n:o[t]>r&&(this.splitterDistance=r)}fi(){if(!this.client.getOption("showPanelBar")||this.client.getOption("panelBar.panels")===0){this.jt===1?this.li.style.top="":this.li.style.left="",this.pt.style.visibility="hidden",this.pt.style.display="none",document.getElementById("panel-bar-drag-bar").style.display="none",this.emit("updated-interface");return}this.jt===1?(this.li.style.top=this.gt+"px",this.pt.style.height=this.gt+"px",this.pt.style.right=this.li.style.right,document.getElementById("panel-bar-drag-bar").style.right=this.li.style.right,document.getElementById("panel-bar-drag-bar").style.top=this.splitterDistance+"px"):(this.li.style.left=this.gt+"px",this.pt.style.width=this.gt+"px",this.pt.style.right="",document.getElementById("panel-bar-drag-bar").style.left=this.splitterDistance+"px"),this.pt.style.visibility="",this.pt.style.display="",document.getElementById("panel-bar-drag-bar").style.display="",this.emit("updated-interface")}Hn(t){t&&(t.updateFont(client.getOption("chat.font"),client.getOption("chat.fontSize")),t.maxLines=client.getOption("chat.bufferSize"),t.enableFlashing=client.getOption("chat.flashing"),t.showTimestamp=client.getOption("chat.showTimestamp"),t.timestampFormat=client.getOption("chat.timestampFormat"),t.enableMXP=client.getOption("enableMXP"),t.enableURLDetection=client.getOption("enableURLDetection"),t.showInvalidMXPTags=client.getOption("display.showInvalidMXPTags"),t.hideTrailingEmptyLine=client.getOption("display.hideTrailingEmptyLine"),t.enableColors=client.getOption("chat.enableColors"),t.enableBackgroundColors=client.getOption("chat.enableBackgroundColors"),t.tabWidth=client.getOption("chat.tabWidth"),t.displayControlCodes=client.getOption("chat.displayControlCodes"),t.emulateTerminal=client.getOption("chat.emulateTerminal"),t.emulateControlCodes=client.getOption("chat.emulateControlCodes"),t.wordWrap=client.getOption("chat.wordWrap"),t.wrapAt=client.getOption("chat.wrapAt"),t.indent=client.getOption("chat.indent"),t.scrollLock=client.getOption("chat.scrollLocked"),t.scrollDisplay())}_i(){this.Hn(this.Si),this._e.commandDelay=client.getOption("commandDelay"),this._e.commandDelayCount=client.getOption("commandDelayCount"),this._e.enabled=this.client.getOption("mapper.enabled"),this._e.follow=this.client.getOption("mapper.follow"),this._e.splitArea=this.client.getOption("mapper.split"),this._e.fillWalls=this.client.getOption("mapper.fill"),this._e.scale=this.client.getOption("panelBar.mapScale"),this._e.follow&&this._e.focusCurrentRoom(),this.We.panel1Collapsed=(this.client.getOption("panelBar.panels")&2)!==2,this.We.panel2Collapsed=(this.client.getOption("panelBar.panels")&4)!==4,this.location=this.client.getOption("panelBar.location"),this.Za(),this.bn(this.We.panel2.querySelector("#btn-chat-panel-lock"),this.client.getOption("chat.scrollLocked")),this.ei(this.We.panel2.querySelector("#btn-chat-panel-wrap"),this.client.getOption("chat.wordWrap"))}Ti(){let t=document.querySelector("#menu-panel-bar");client.getOption("showPanelBar")?(t.title="Hide panel bar",t.classList.add("active"),document.querySelector("#menu-panel-bar a span").textContent=" Hide panel bar"):(t.title="Show panel bar",t.classList.remove("active"),document.querySelector("#menu-panel-bar a span").textContent=" Show panel bar"),this.client.getOption("panelBar.panels")===0?(t.style.display="none",t.style.visibility="hidden"):(t.style.display="list-item",t.style.visibility="visible")}bn(t,e){if(!t)return;let s=t.firstElementChild;e?(t.title="Unlock display",t.classList.add("active"),s.classList.add("bi-unlock-fill"),s.classList.remove("bi-lock-fill")):(t.title="Lock display",t.classList.remove("active"),s.classList.remove("bi-unlock-fill"),s.classList.add("bi-lock-fill"))}ei(t,e){t&&(e?t.classList.add("active"):t.classList.remove("active"))}xl(t){this.vl.textContent=t||""}Za(){this.pt.dataset.order=""+this.client.getOption("panelBar.order"),this.client.getOption("panelBar.order")===1?(this.We.panel2.append(this._e.container),this.We.panel1.append(this.Si.container)):(this.We.panel1.append(this._e.container),this.We.panel2.append(this.Si.container)),this._e.container.insertAdjacentElement("beforebegin",this.vl),this._e.container.insertAdjacentElement("beforebegin",this.qi)}Ua(){let t=document.getElementById("mini-map-display");t?t.textContent=this._e.scale+"%":this.qi.parentElement.insertAdjacentHTML("beforeend",`<label id="mini-map-display">${this._e.scale}%</label>`),clearTimeout(this.Wa),this.Wa=setTimeout(()=>document.getElementById("mini-map-display").remove(),1500)}};var Ve=class extends me{constructor(t){super();this.Sn=!1;this.ye={triggers:null,aliases:null,macros:null,buttons:null,contexts:null,defaultContext:null,alarms:null,alarmPatterns:[]};this.Zh={};this.Xe={};this.active=!0;this.connecting=!1;this.version=gs;this.connectTime=0;this.disconnectTime=0;this.lastSendTime=0;this.defaultTitle="oiMUD";if(window.client=this,window.oiMUD=this,this.Ya=[],t=Object.assign({display:"#display",commandInput:"#commandInput"},t||{}),(!("display"in t)||typeof t.display===void 0)&&(t.display="#display"),(!("commandInput"in t)||typeof t.commandInput===void 0)&&(t.commandInput="#commandInput"),this.ge=new st(t.display),this.display.on("click",s=>{this.getOption("CommandonClick")&&this.be.focus()}),this.display.on("scroll-lock",s=>{this.scrollLock=s}),this.display.on("split-move-done",s=>{this.setOption("display.splitHeight",s)}),this.display.on("update-window",(s,n)=>{this.telnet.updateWindow(s,n)}),this.display.on("update-window",(s,n)=>{this.telnet.updateWindow(s,n)}),this.display.on("debug",s=>{this.debug(s)}),this.display.on("add-line",s=>{this.emit("add-line",s)}),this.display.on("add-line-done",s=>{this.emit("add-line-done",s)}),this.display.on("MXP-tag-reply",(s,n)=>{let r={tag:s,args:n,preventDefault:!1};if(this.emit("MXP-tag-reply",r),!r.preventDefault)switch(s){case"VERSION":this.display.MXPStyleVersion&&this.display.MXPStyleVersion.length?(this.debug(`MXP Tag REPLY: <VERSION MXP=1.0 STYLE=${this.display.MXPStyleVersion} CLIENT=jiMUD VERSION=${this.version} REGISTERED=no>`),this.send(`\x1B[1z<VERSION MXP=1.0 STYLE=${this.display.MXPStyleVersion} CLIENT=jiMUD VERSION=${this.version} REGISTERED=no>\r
`)):(this.debug(`MXP Tag REPLY: <VERSION MXP=1.0 CLIENT=jiMUD VERSION=${this.version} REGISTERED=no>`),this.send(`\x1B[1z<VERSION MXP=1.0 CLIENT=jiMUD VERSION=${this.version} REGISTERED=no>\r
`));break;case"SUPPORT":this.debug(`MXP Tag REPLY: <SUPPORTS ${n.join(" ")}>`),this.send(`\x1B[1z<SUPPORTS ${n.join(" ")}>\r
`);break;case"USER":this.emit("sendUsername",r);break;case"PASSWORD":this.emit("sendPassword",r);break}}),this.display.on("expire-links",s=>{this.emit("expire-links",s)}),this.display.on("parse-done",()=>{this.emit("parse-done")}),this.display.on("set-title",(s,n)=>{typeof s>"u"||s==null||s.length===0?this.emit("set-title",this.getOption("title").replace("$t",this.defaultTitle)||this.defaultTitle):n!==1&&this.emit("set-title",this.getOption("title").replace("$t",s)||"")}),this.display.on("music",s=>{this.emit("music",s)}),this.display.on("sound",s=>{this.emit("sound",s)}),this.display.on("bell",()=>{this.emit("bell")}),typeof t.commandInput=="string"){if(this.be=document.querySelector(t.commandInput),!this.be)throw new Error("Invalid selector for command input.")}else if(t.commandInput instanceof $)this.be=t.commandInput[0];else if(t.commandInput instanceof HTMLElement)this.be=t.commandInput;else throw new Error("Command input must be a selector, element or jquery object");this.Nt=new Yt({protocol:t.protocol,scheme:t.scheme}),this.Nt.terminal="oiMUD",this.Nt.version=this.version,this.Nt.GMCPSupports.push("oMUD 1"),this.Nt.on("error",s=>{if(this.enableDebug&&this.debug(s),s){if(s.type==="close"&&s.code===1006)return;let n=[];s.type&&n.push(s.type),s.text&&n.push(s.text),s.message&&n.push(s.message),s.reason&&n.push(s.reason),s.code?this.error(s.code+" : "+n.join(", ")):this.error(n.join(", "))}else this.error("Unknown telnet error.");this.autoConnect(),this.emit("reconnect")}),this.telnet.on("connecting",()=>{this.connecting=!0,this.echo("Trying to connect to "+this.host+":"+this.port,-7,-8,!0,!0)}),this.telnet.on("connect",()=>{this.connecting=!1,this.echo("Connected...",-7,-8,!0,!0),this.connectTime=Date.now(),this.disconnectTime=0,this.lastSendTime=Date.now(),this.Fn&&(clearTimeout(this.Fn),this.Fn=null),this.emit("connected"),this.raise("connected")}),this.telnet.on("debug",s=>{this.debug(s)}),this.telnet.on("receive-option",s=>{this.emit("received-option",s)}),this.telnet.on("close",()=>{this.connecting=!1,this.echo("Connection closed to "+this.host+":"+this.port,-7,-8,!0,!0),this.disconnectTime=Date.now(),this.emit("closed"),this.raise("disconnected"),this.connectTime=0,this.lastSendTime=0}),this.telnet.on("received-data",s=>{s={value:s},this.emit("received-data",s),!(s==null||typeof s>"u"||s.value==null||typeof s.value>"u")&&(this.Xa(s.value,!1,!0),this.debug("Latency: "+this.telnet.latency+"ms"),this.debug("Latency: "+this.telnet.latency/1e3+"s"))}),this.telnet.on("received-MSDP",s=>{this.emit("received-MSDP",s)}),this.telnet.on("received-GMCP",s=>{let n=s.value,r,o=0,a=n.length,h;if(a===0)return;for(o=0;o<a&&(h=n.charAt(o),!(h===" "||h==="{"||h==="["));o++);r=n.substr(0,o).trim(),n=n.substr(o).trim(),this.debug("GMCP Module: "+r),this.debug("GMCP Data: "+n);let c;if(r.toLowerCase()==="client.gui"){c=n.split("/n"),n.length>=2?c={version:parseInt(c[0],10),url:c[1]}:n.length>0?c={version:parseInt(c[0],10),url:c[1]}:c={version:c,url:""},this.emit("received-GMCP",r,c);return}try{n.length>0&&(c=JSON.parse(n))}catch{this.error("Invalid GMCP");return}this.emit("received-GMCP",r,c)}),this.telnet.on("windowSize",()=>{this.UpdateWindow()});let e=Wi("host");e!==null&&e.length?this.host=e:t&&"host"in t?this.host=t.host:this.host="127.0.0.1",e=+Wi("port"),!isNaN(e)&&e>0?this.port=e:t&&"port"in t?this.port=t.port:this.port=23,this.st=new li(this),this.st.on("scroll-lock",s=>{this.display.scrollLock=s,this.emit("scroll-lock",s)}),this.st.on("command-history-changed",s=>this.emit("command-history-changed",s)),this.st.on("item-added",(s,n,r,o)=>{this.emit("item-added",s,n,r,o)}),this.st.on("item-updated",(s,n,r,o)=>{this.emit("item-updated",s,n,r,o)}),this.st.on("item-removed",(s,n,r,o)=>{this.emit("item-removed",s,n,r,o)}),this.loadOptions(),this.be.value="",this.be.focus(),window.addEventListener("blur",()=>{this.active=!1,this.emit("blur"),this.raise("blur")}),window.addEventListener("focus",()=>{this.active=!0,this.emit("focus"),this.raise("focus")}),window.addEventListener("beforeunload",s=>{if(this.connected)return s&&(s.returnValue="Closing or reloading will disconnect you from the mud."),"Closing or reloading will disconnect you from the mud.";this.raise("closed")}),window.addEventListener("unload",()=>{this.connected&&this.close()}),this.addPlugin(new di(this)),this.addPlugin(new nt(this)),this.addPlugin(new ki(this)),this.addPlugin(new Ht(this)),this.addPlugin(new Et(this)),this.addPlugin(new Ei(this)),this.addPlugin(new Jt(this)),this.addPlugin(new fi(this)),this.autoConnect(),this.emit("initialized")}get telnet(){return this.Nt}get variables(){return this.Zh}get commandInput(){return this.be}get display(){return this.ge}get profiles(){return this.ee}get plugins(){return this.Ya}get options(){return this.Xe}get input(){return this.st}set simpleAlarms(t){this.setOption("simpleAlarms",t)}get simpleAlarms(){return this.getOption("simpleAlarms")}set enableParsing(t){this.setOption("enableParsing",t),this.st.enableParsing=t}get enableParsing(){return this.getOption("enableParsing")}set enableTriggers(t){this.setOption("enableTriggers",t),this.st.enableTriggers=t,this.startAlarms()}get enableTriggers(){return this.getOption("enableTriggers")}get enableDebug(){return this.Sn}set enableDebug(t){this.Sn=t,this.Nt.enableDebug=t,this.ge.enableDebug=t}get host(){return this.Nt.host}set host(t){this.Nt.host=t}get port(){return this.Nt.port}set port(t){this.Nt.port=t}get connected(){return this.Nt.connected}get activeProfile(){return this.ee.active}get commandHistory(){return this.st.commandHistory}get indices(){return this.st.indices}get repeatnum(){return this.st.repeatnum}get aliases(){if(this.ye.aliases)return this.ye.aliases;let t=this.profiles.keys,e=[],s=0,n=t.length;if(n===0)return[];if(n===1)return!this.profiles.items[t[0]].enabled||!this.profiles.items[t[0]].enableAliases?this.ye.aliases=[]:this.ye.aliases=se(this.profiles.items[t[s]].aliases),this.ye.aliases;for(;s<n;s++)!this.profiles.items[t[s]].enabled||!this.profiles.items[t[s]].enableAliases||this.profiles.items[t[s]].aliases.length===0||e.push.apply(e,se(this.profiles.items[t[s]].aliases));return this.ye.aliases=e,this.ye.aliases}get macros(){if(this.ye.macros)return this.ye.macros;let t=this.profiles.keys,e=[],s=0,n=t.length;if(n===0)return[];if(n===1)return!this.profiles.items[t[0]].enabled||!this.profiles.items[t[0]].enableMacros?this.ye.macros=[]:this.ye.macros=se(this.profiles.items[t[s]].macros),this.ye.macros;for(;s<n;s++)!this.profiles.items[t[s]].enabled||!this.profiles.items[t[s]].enableMacros||this.profiles.items[t[s]].macros.length===0||e.push.apply(e,se(this.profiles.items[t[s]].macros));return this.ye.macros=e,this.ye.macros}get triggers(){if(this.ye.triggers)return this.ye.triggers;let t=this.profiles.keys,e=[],s=0,n=t.length;if(n===0)return[];if(n===1)return!this.profiles.items[t[0]].enabled||!this.profiles.items[t[0]].enableTriggers?this.ye.triggers=[]:this.ye.triggers=se(this.profiles.items[t[0]].triggers),this.ye.triggers;for(;s<n;s++)!this.profiles.items[t[s]].enabled||!this.profiles.items[t[s]].enableTriggers||this.profiles.items[t[s]].triggers.length===0||e.push.apply(e,se(this.profiles.items[t[s]].triggers));return this.ye.triggers=e,this.ye.triggers}removeTrigger(t){let e=this.profiles.keys,s=0,n=e.length,r=-1;if(n!==0){if(n===1){if(!this.profiles.items[e[0]].enabled||!this.profiles.items[e[0]].enableTriggers)return;r=this.profiles.items[e[s]].triggers.indexOf(t)}else for(;s<n&&r!==-1&&!(!(!this.profiles.items[e[s]].enabled||!this.profiles.items[e[s]].enableTriggers||this.profiles.items[e[s]].triggers.length===0)&&(r=this.profiles.items[e[s]].triggers.indexOf(t),r!==-1));s++);r!==-1&&(this.profiles.items[e[s]].triggers.splice(r,1),this.ye.triggers=null,(t.triggers.length||t.type===3)&&this.ye.alarms&&(r=this.ye.alarms.indexOf(t),r!==-1&&(this.ye.alarms.splice(r,1),this.ye.alarmPatterns.splice(r,1))),this.saveProfiles(),this.emit("item-removed","trigger",e[s],r,t))}}get alarms(){if(this.ye.alarms)return this.ye.alarms;let t=this.profiles.keys,e=[],s=0,n=t.length;if(n===0)return[];if(n===1)return!this.profiles.items[t[0]].enabled||!this.profiles.items[t[0]].enableTriggers?this.ye.alarms=[]:this.ye.alarms=se(this.profiles.items[t[s]].triggers).filter(r=>{if(r&&r.enabled&&r.triggers.length){if(r.type===3)return!0;for(let o=0,a=r.triggers.length;o<a;o++)if(r.triggers[o].enabled&&r.triggers[o].type===3)return!0;return!1}return r&&r.enabled&&r.type===3}),this.ye.alarms.reverse(),this.ye.alarms;for(;s<n;s++)!this.profiles.items[t[s]].enabled||!this.profiles.items[t[s]].enableTriggers||this.profiles.items[t[s]].triggers.length===0||e.push.apply(e,se(this.profiles.items[t[s]].triggers));return this.ye.alarms=e.filter(r=>{if(r&&r.enabled&&r.triggers.length){if(r.type===3)return!0;for(let o=0,a=r.triggers.length;o<a;o++)if(r.triggers[o].enabled&&r.triggers[o].type===3)return!0;return!1}return r&&r.enabled&&r.type===3}),this.ye.alarms.reverse(),this.ye.alarms}get buttons(){if(this.ye.buttons)return this.ye.buttons;let t=this.profiles.keys,e=[],s=0,n=t.length;if(n===0)return[];if(n===1)return!this.profiles.items[t[0]].enabled||!this.profiles.items[t[0]].enableButtons?this.ye.buttons=[]:this.ye.buttons=se(this.profiles.items[t[s]].buttons),this.ye.buttons;for(;s<n;s++)!this.profiles.items[t[s]].enabled||!this.profiles.items[t[s]].enableButtons||this.profiles.items[t[s]].buttons.length===0||e.push.apply(e,se(this.profiles.items[t[s]].buttons));return this.ye.buttons=e,this.ye.buttons}get contexts(){if(this.ye.contexts)return this.ye.contexts;let t=this.profiles.keys,e=[],s=0,n=t.length;if(n===0)return[];if(n===1)return!this.profiles.items[t[0]].enabled||!this.profiles.items[t[0]].enableContexts?this.ye.contexts=[]:this.ye.contexts=se(this.profiles.items[t[s]].contexts),this.ye.contexts;for(;s<n;s++)!this.profiles.items[t[s]].enabled||!this.profiles.items[t[s]].enableContexts||this.profiles.items[t[s]].contexts.length===0||e.push.apply(e,se(this.profiles.items[t[s]].contexts));return this.ye.contexts=e,this.ye.contexts}get defaultContext(){return this.ye.defaultContext!==null?this.ye.defaultContext:(this.ye.defaultContext=this.profiles.defaultContext,this.ye.defaultContext)}addPlugin(t){t&&(this.plugins.push(t),t.initialize(),this.emit("plugin-added",t))}removePlugin(t){if(!this.plugins.length)return;let e=this.plugins.indexOf(t);e!==-1&&(t.remove(),this.plugins.splice(e,1),this.emit("plugin-removed",t))}getVariable(t){return this.variables[t]}setVariable(t,e){this.variables[t]=e}setVariables(t){let e=Object.keys(t);if(e.length===0)return;let s=e.length,n;for(let r=0;r<s;r++)n=e[r],this.variables[n]=t[n]}hasVariable(t){return this.variables.hasOwnProperty(t)}removeVariable(t){this.variables.hasOwnProperty(t)&&delete this.variables[t]}setHistoryIndex(t){this.st.setHistoryIndex(t)}clearCommandHistory(){this.st.clearCommandHistory()}AddCommandToHistory(t){this.st.AddCommandToHistory(t)}loadProfiles(){return new Promise(t=>{Bt.load().then(e=>{this.ee=e,this.profiles.contains("default")||(this.profiles.add(Be.Default),this.saveProfiles()),this.clearCache(),this.startAlarms(),this.emit("profiles-loaded"),t(this.ee)})})}removeProfile(t){t&&(this.profiles.remove(t),this.clearCache(),this.startAlarms(),this.emit("profile-removed",t))}saveProfiles(){this.ee.save(),this.clearCache(),this.emit("profiles-updated")}toggleProfile(t){this.profiles.toggle(t),this.saveProfiles(),this.clearCache(),this.startAlarms(),this.emit("profile-toggled",t,this.profiles[t].enabled)}startAlarms(){let t=this.alarms.length;(t===0||!this.getOption("enableTriggers"))&&this.Ys?(clearInterval(this.Ys),this.Ys=null):t&&!this.Ys&&(this.Ys=setInterval(e=>{e.process_alarms()},1e3,this))}setAlarmState(t,e){if(typeof t=="object"&&(t=this.alarms.indexOf(t)),t===-1||t>=this.alarms.length)return;let s=this.ye.alarmPatterns[t];if(!s){s={},this.alarms[t].type===3&&(s[0]=$e.parse(this.alarms[t]));for(let n=0,r=this.alarms[t].triggers.length;n<r;n++)this.alarms[t].triggers[n].enabled&&this.alarms[t].triggers[n].type===3&&(s[n]=$e.parse(this.alarms[t].triggers[n]));this.ye.alarmPatterns[t]=s}for(let n in s)s.hasOwnProperty(n)&&(e?(s[n].startTime+=Date.now()-s[n].suspended,s[n].prevTime+=Date.now()-s[n].suspended,s[n].tempTime&&(s[n].tempTime+=Date.now()-s[n].suspended),s[n].suspended=0):s[n].suspended=Date.now())}setAlarmTempTime(t,e){if(typeof t=="object"&&(t=this.alarms.indexOf(t)),t===-1||t>=this.alarms.length)return;let s=this.ye.alarmPatterns[t];if(!s){s={},this.alarms[t].type===3&&(s[0]=$e.parse(this.alarms[t]));for(let n=0,r=this.alarms[t].triggers.length;n<r;n++)this.alarms[t].triggers[n].enabled&&this.alarms[t].triggers[n].type===3&&(s[n]=$e.parse(this.alarms[t].triggers[n]));this.ye.alarmPatterns[t]=s}s[0]&&s[0].setTempTime(e)}restartAlarmState(t,e,s){if(e===s||(typeof t=="object"&&(t=this.alarms.indexOf(t)),t===-1||t>=this.alarms.length))return;let n=this.ye.alarmPatterns[t];if(!n){n={},this.alarms[t].type===3&&(n[0]=$e.parse(this.alarms[t]));for(let r=0,o=this.alarms[t].triggers.length;r<o;r++)this.alarms[t].triggers[r].enabled&&this.alarms[t].triggers[r].type===3&&(n[r]=$e.parse(this.alarms[t].triggers[r]));this.ye.alarmPatterns[t]=n}n[e]&&(n[e].restart=Date.now()),n[s]&&(n[s].restart=Date.now())}getRemainingAlarmTime(t){if(typeof t=="object"&&(t=this.alarms.indexOf(t)),t===-1||t>=this.alarms.length||!this.alarms[t].enabled)return 0;let e=this.ye.alarmPatterns[t];if(!e){e={},this.alarms[t].type===3&&(e[0]=$e.parse(this.alarms[t]));for(let s=0,n=this.alarms[t].triggers.length;s<n;s++)this.alarms[t].triggers[s].enabled&&this.alarms[t].triggers[s].type===3&&(e[s]=$e.parse(this.alarms[t].triggers[s]));this.ye.alarmPatterns[t]=e}if(e[0]){let s=e[0],n=Date.now(),r=new Date,o=n,a=o+9e7,h=1e3;if(s.seconds!==-1?h=1e3:s.minutes!==-1?h=6e4:s.hours!==-1&&(h=36e5),s.tempTime)return s.tempTime-n>0?s.tempTime-n:0;for(;o<a;){if(this.ja(s,o,r))return o-n;o+=h,r.setTime(r.getTime()+h)}return-1}return 0}updateAlarms(){if(this.ye.alarmPatterns){let t=this.ye.alarmPatterns,e=this.alarms;this.ye.alarmPatterns=[],this.ye.alarms=null;let s=this.alarms.length,n=-1;for(let r=0;r<s;r++)n=e.indexOf(this.alarms[r]),n!==-1&&(this.ye.alarmPatterns[r]=t[n])}this.startAlarms()}process_alarms(){if(!this.getOption("enableTriggers"))return;let t=0,e=!1,s=this.alarms.length;if(s===0&&this.Ys){clearInterval(this.Ys),this.Ys=null;return}let n=this.ye.alarmPatterns,r=Date.now(),o=this.alarms,a=new Date;for(t=s-1;t>=0;t--){let h=o[t],c=h;if(!h.enabled)continue;if(h.state>h.triggers.length&&(h.state=0),h.state!==0&&h.triggers&&h.triggers.length){for(h=h.triggers[h.state-1];!h.enabled&&c.state!==0;){if(c.state++,c.state>c.triggers.length){c.state=0,h=h.triggers[c.state-1];break}c.state?h=h.triggers[c.state-1]:h=c,e=!0}if(e&&(this.getOption("saveTriggerStateChanges")&&this.saveProfiles(),this.emit("item-updated","trigger",c.profile.name,c.profile.triggers.indexOf(c),c)),!h.enabled)continue}if(h.type===131072||h.type===262144){let b=this.st.adjustLastLine(this.display.lines.length,!0),u=this.display.lines[b];t=this.st.TestTrigger(h,c,t,u,this.display.lines[b].raw||u,b===this.display.lines.length-1);continue}if(h.type!==3)continue;let g=n[t];if(!g){try{n[t]={},h.type===3&&(n[t][0]=$e.parse(h));for(let b=0,u=h.triggers.length;b<u;b++)h.triggers[b].type===3&&(n[t][b]=$e.parse(h.triggers[b]))}catch(b){throw n[t]=null,this.getOption("disableTriggerOnError")&&(h.enabled=!1,setTimeout(()=>{this.saveProfiles(),this.emit("item-updated","trigger",c.profile,c.profile.triggers.indexOf(c),c)})),b}if(g=n[t],!g)continue}g=g[h.state],g.restart&&(g.startTime=Date.now(),g.prevTime=g.startTime,g.tempTime&&(g.tempTime+=Date.now()-g.restart),g.restart=0);let m=!0;if(g.tempTime?(m=r>=g.tempTime,m&&(g.tempTime=0)):m=this.ja(g,r,a),m&&!g.suspended){g.prevTime=r;let b=c.state;if(this.st.lastTriggered=g.pattern,this.st.ExecuteTrigger(h,[g.pattern],!1,-t,null,null,c),b!==c.state&&(g.restart=Date.now()),g.temp)if(c.triggers.length)if(b===0){let u=c.triggers.shift();u.state=b,u.priority=c.priority,u.name=c.name,u.profile=c.profile,u.state>u.triggers.length&&(u.state=0),u.triggers=c.triggers,o[t]=u,n[t]=null,this.saveProfiles();let E=c.profile.triggers.indexOf(c);c.profile.triggers[E]=u,this.emit("item-updated","trigger",c.profile.name,E,u)}else{c.triggers.splice(b-1,1),n[t].splice(b-1,1),c.state=b,c.state>c.triggers.length&&(c.state=0),this.saveProfiles();let u=c.profile.triggers.indexOf(c);this.emit("item-updated","trigger",c.profile.name,u,c)}else this.st.clearTriggerState(t),this.removeTrigger(c);t=-this.st.cleanUpTriggerState(-t)}}}ja(t,e,s){if(!t||t.suspended)return!1;let n=!0,r,o,a,h,c,g,m;if(!moment||this.simpleAlarms){if(r=e-this.connectTime,r<1e3)return!1;o=Math.round(r/1e3),a=Math.floor(o/60),h=Math.floor(a/60),c=h,g=Math.floor(a%60),m=Math.floor(o%60)}else{if(t.start?r=moment.duration(e-this.connectTime):r=moment.duration(e-t.startTime),r.asMilliseconds()<1e3)return!1;o=Math.round(r.asMilliseconds()/1e3),a=Math.floor(o/60),h=Math.floor(a/60),c=r.hours(),g=r.minutes(),m=r.seconds()}return t.hoursWildCard?t.hours===0?n=n&&c===0:t.hours!==-1&&(n=n&&h!==0&&h%t.hours===0):t.hours!==-1&&(n=n&&t.hours===(t.start?c:s.getHours())),t.minutesWildcard?t.minutes===0?n=n&&g===0:t.minutes!==-1&&(n=n&&a!==0&&a%t.minutes===0):t.minutes!==-1&&(n=n&&t.minutes===(t.start?g:s.getMinutes())),t.secondsWildcard?t.seconds===0?n=n&&m===0:t.seconds!==-1&&(n=n&&o%t.seconds===0):t.seconds!==-1&&(n=n&&t.seconds===(t.start?m:s.getSeconds())),n}loadOptions(){this.Xe=new ue,this.enableDebug=this.Xe.enableDebug,this.display.maxLines=this.Xe.bufferSize,this.display.enableFlashing=this.Xe.flashing,this.display.enableMXP=this.Xe.enableMXP,this.display.showInvalidMXPTags=this.Xe["display.showInvalidMXPTags"],this.display.enableURLDetection=this.Xe.enableURLDetection,this.display.enableMSP=this.Xe.enableMSP,this.display.enableColors=this.Xe["display.enableColors"],this.display.enableBackgroundColors=this.Xe["display.enableBackgroundColors"],this.display.wordWrap=this.Xe["display.wordWrap"],this.display.wrapAt=this.Xe["display.wrapAt"],this.display.indent=this.Xe["display.indent"],this.display.showTimestamp=this.Xe["display.showTimestamp"],this.display.tabWidth=this.Xe["display.tabWidth"],this.display.timestampFormat=this.Xe["display.timestampFormat"],this.display.splitHeight=this.Xe["display.splitHeight"],this.display.enableSplit=this.Xe["display.split"],this.display.splitLive=this.Xe["display.splitLive"];let t=this.getOption("colors");if(t&&t.length>0){let e,s=t.length;for(e=0;e<s;e++)!t[e]||t[e].length===0||this.display.SetColor(e,t[e])}this.Nt&&(this.Nt.options.MCCP=this.Xe.enableMCCP,this.Nt.options.MXP=this.Xe.enableMXP,this.Nt.UTF8=this.Xe.enableUTF8,this.Nt.options.ECHO=this.Xe.enableEcho,this.Nt.enableLatency=this.Xe.lagMeter,this.Nt.enablePing=this.Xe.enablePing),this.st.scrollLock=this.Xe.scrollLocked,this.st.enableParsing=this.Xe.enableParsing,this.st.enableTriggers=this.Xe.enableTriggers,this.display.scrollLock=this.Xe.scrollLocked,this.display.hideTrailingEmptyLine=this.Xe["display.hideTrailingEmptyLine"],this.display.displayControlCodes=this.getOption("display.displayControlCodes"),this.display.emulateTerminal=this.getOption("display.emulateTerminal"),this.display.emulateControlCodes=this.getOption("display.emulateControlCodes"),this.be.wrap=this.getOption("commandWordWrap")?"on":"off",this.UpdateFonts&&this.UpdateFonts(),this.display.scrollDisplay(),this.loadProfiles(),this.emit("options-loaded")}setOption(t,e){t===-1||t==="-1"||(this.Xe[t]=e,ue.setValue(t,e),this.emit("option-changed",t,e))}getOption(t){return this.Xe&&t in this.Xe?this.Xe[t]:this.Xe[t]=ue.getValue(t)}UpdateFonts(){this.display&&(this.display.updateFont(this.Xe.font+", monospace",this.Xe.fontSize),this.be.style.fontSize=this.Xe.cmdfontSize,this.be.style.fontFamily=this.Xe.cmdfont+", monospace")}parse(t){this.qa(t,!1,!1,!0)}qa(t,e,s,n){this.display.append(t,e,s,n)}error(t){this.enableDebug&&this.debug(t);let e="";t==null||typeof t>"u"?t=new Error("Unknown"):typeof t=="string"&&t.length===0&&(t=new Error("Unknown")),t.stack&&this.getOption("showErrorsExtended")?e=t.name+": "+t.message+`
`+t.stack:t instanceof Error||t instanceof TypeError?e=t.name+": "+t.message:t.message?e=t.message:e=""+t,e.match(/^.*Error: /g)||e.match(/^.*Error - /g)?this.echo(e,-11,-12,!0,!0):this.echo("Error: "+e,-11,-12,!0,!0),this.getOption("logErrors")&&(this.getOption("showErrorsExtended")?t.stack||(t=new Error(t||e),e+=`
`+t.stack):(t.stack||(t=new Error(t||e)),e+=`
`+t.stack),window.console.log(new Date().toLocaleString()),window.console.log(e),localforage.getItem("oiMUDErrorLog").then(s=>{localforage.setItem("oiMUDErrorLog",s=(s||"")+new Date().toLocaleString()+`
`+e+`
`)}).catch(s=>this.error(s))),t==="Error: ECONNRESET - read ECONNRESET."&&this.telnet.connected&&this.close(),this.raise("error",e)}echo(t,e,s,n,r){t==null&&(t=""),n==null&&(n=!1),r==null&&(r=!1),e==null&&(e=-3),s==null&&(s=-4);let o="\x1B[0m"+this.display.CurrentAnsiCode()+`
`;t=""+t,t.endsWith(`
`)&&(t=t.substr(0,t.length-1)),this.telnet.prompt&&r?(this.print(`
\x1B[`+e+";"+s+"m"+t+o,n),this.telnet.prompt=!1):this.print("\x1B["+e+";"+s+"m"+t+o,n)}print(t,e){this.Xa(t,e,!1,!0)}Xa(t,e,s,n){t==null||typeof t>"u"||(e==null&&(e=!1),s==null&&(s=!1),e&&this.display.textLength>0&&!this.display.EndOfLine&&this.display.EndOfLineLength!==0&&!this.telnet.prompt&&!this.display.parseQueueEndOfLine&&(t=`
`+t),this.emit("print"),this.qa(t,s,!1,n))}send(t,e){this.telnet.sendData(t),this.lastSendTime=Date.now(),e&&this.telnet.echo&&this.getOption("commandEcho")?this.echo(t):e&&this.echo(`
`)}sendRaw(t){this.telnet.sendData(t,!0),this.lastSendTime=Date.now()}sendGMCP(t){this.telnet.sendGMCP(t),this.lastSendTime=Date.now()}debug(t,e){let s={value:t};this.emit("debug",s),!(!this.Sn||s==null||typeof s>"u"||s.value==null||typeof s.value>"u"||s.value.length===0)&&window.console&&(e?window.console.log("%c"+t,e):window.console.log(s.value))}sendCommand(t,e,s){t==null&&(t=this.be.value,this.telnet.echo?this.st.AddCommandToHistory(t):this.be.value=""),t=""+t,t.endsWith(`
`)||(t=t+`
`);let n={value:t,handled:!1,comments:s};this.emit("parse-command",n),!(n==null||typeof n>"u")&&(n.handled||n.value==null||typeof n.value>"u"||(n.value.length>0&&this.send(n.value,!e),this.getOption("keepLastCommand")?this.getOption("selectLastCommand")&&as(this.be):this.be.value=""))}sendBackground(t,e,s){t==null&&(t=this.be.value,this.telnet.echo?this.st.AddCommandToHistory(t):this.be.value=""),t=""+t,t.endsWith(`
`)||(t=t+`
`);let n={value:t,handled:!1,comments:s};this.emit("parse-command",n),!(n==null||typeof n>"u")&&(n.value==null||typeof n.value>"u"||!n.handled&&n.value.length>0&&this.send(n.value,!e))}get scrollLock(){return this.st.scrollLock}set scrollLock(t){this.st.scrollLock=t}toggleScrollLock(){this.st.toggleScrollLock()}UpdateWindow(){this.display.updateWindow()}close(){this.telnet.close()}connect(){this.emit("connecting"),this.display.ClearMXP(),this.display.ResetMXPLine(),this.telnet.connect(),this.emit("connect"),this.be.focus()}receivedData(t){this.telnet.receivedData(t)}notify(t,e,s){this.enableDebug&&(this.emit("debug","notify title: "+t),this.emit("debug","notify msg: "+e)),this.emit("notify",t,e,s)}clear(){this.display.clear(),this.emit("cleared")}parseInline(t){return this.st.parseInline(t)}parseOutgoing(t,e,s,n){return this.st.parseOutgoing(t,e,s,n)}clearCache(){this.st.clearCaches(),this.ye={triggers:null,aliases:null,macros:null,buttons:null,contexts:null,defaultContext:null,alarms:null,alarmPatterns:[]}}beep(){this.emit("bell")}raise(t,e,s){if(!this.profiles){setTimeout(()=>{this.raise(t,e,s)},100);return}!s||s<1?this.st.triggerEvent(t,e):setTimeout(()=>{this.st.triggerEvent(t,e)},s)}show(){this.emit("show")}hide(){this.emit("hide")}toggle(){this.emit("toggle")}autoConnect(){!this.Fn&&this.getOption("autoConnect")&&!this.Nt.connected&&(this.Fn=setTimeout(()=>{this.connect(),this.Fn=null},this.getOption("autoConnectDelay")))}getWindowState(t){let e=this.getOption("windows."+t);return e&&this.getOption("fixHiddenWindows")&&(e.x+e.width/2>document.body.clientWidth&&(e.x=document.body.clientWidth-e.width/2),e.x<0&&(e.x=0),e.y+e.height/2>document.body.clientHeight&&(e.y=document.body.clientHeight-e.height/2),e.y<0&&(e.y=0)),e}};window.Client=Ve;window.Display=st;})();
/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */
/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * @link   http://www.phpied.com/rgb-color-parser-in-javascript/
 * @license Use it if you like it
 */
//# sourceMappingURL=oiMUD.min.js.map
